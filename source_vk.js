lilo.viewFactories.___ = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["a-temp-view"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["active-comments-view"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = "loading"
      , o = i.$(".load");
    return i.showLoader = function() {
        o.addClass(n)
    }
    ,
    i.hideLoader = function() {
        o.removeClass(n)
    }
    ,
    o.click(function() {
        o.hasClass(n) || i.trigger("load-more")
    }),
    i.els["batch-delete"].click(function() {
        i.trigger("batch-delete", {
            $btn: i.els["batch-delete"]
        })
    }),
    i.createViewModel = function(a) {
        var s = {
            noItems: 0 === a.comments.length,
            comments: []
        };
        function r() {
            s.setAttr({
                noItems: 0 === s.comments.length
            })
        }
        var o = !1;
        return a.comments.on("add", "self", function(e, t, i) {
            var n;
            o ? s.comments.add(e.newValue, 0) : (n = [],
            e.newValue.each(function(e, t) {
                return !(50 <= e) && void n.push(t)
            }),
            s.comments.add(n),
            o = !0),
            r()
        }),
        a.comments.on("remove", "self", function(e, t, i) {
            if (s.comments.remove(e.newValue),
            s.comments.length < 50 && s.comments.length < a.comments.length)
                for (var n = s.comments.length; n < 50; n += 1) {
                    var o = a.comments[n];
                    o && s.comments.add(o)
                }
            r()
        }),
        a.comments.on("removeAll", "self", function(e, t, i) {
            s.comments.removeAll(e.newValue),
            r()
        }),
        s
    }
    ,
    i
}
,
lilo.viewFactories["chat-recipient-node"] = function(e, t) {
    var t = lilo.baseViewFactory(e, t)
      , i = t.el[0];
    return t.isOnScreen = function() {
        return !!i.parentNode
    }
    ,
    t
}
,
lilo.viewFactories["comments-pagination2"] = function(e, t) {
    function a(e, t, i) {
        return $("<span/>").html(e).attr(n, t).addClass(i ? "selected" : "")
    }
    function i() {
        var e = s.model.currentPageIndex
          , t = s.model.pagesCount
          , i = s.el;
        if (i.empty(),
        !(t <= 1)) {
            for (r < e && i.append(a("&laquo;", 0)),
            (o = e - r) < 0 && (o = 0); o < e; )
                i.append(a(o + 1 + "", o)),
                o += 1;
            i.append(a(e + 1 + "", e, !0));
            for (var n = Math.min(t, e + r + 1), o = e + 1; o < n; )
                i.append(a(o + 1 + "", o)),
                o += 1;
            n < t && i.append(a("&raquo;", t - 1))
        }
    }
    var s = lilo.baseViewFactory(e, t)
      , e = "span"
      , n = "index"
      , r = t.itemsPerBound || 2;
    return s.el.on("click", e, function(e) {
        e = parseInt($(e.target).attr(n), 10);
        s.trigger("show-page", {
            pageIndex: e
        })
    }),
    s.createViewModel = function(e) {
        e.onChange("currentPageIndex", i),
        e.onChange("pagesCount", i),
        i()
    }
    ,
    s.render = i,
    s
}
,
lilo.viewFactories["comments-view"] = function(e, t) {
    var o = lilo.baseViewFactory(e, t)
      , a = app.info.viewer_id
      , i = o.$(".loader");
    return o.showLoader = function() {
        i.show()
    }
    ,
    o.hideLoader = function() {
        i.hide()
    }
    ,
    o.handlers = {
        "click@$.add-comment": function() {
            this.trigger("add-comment")
        }
    },
    o.createViewModel = function(t) {
        t.ownerId !== app.info.viewer_id || o.$(".add-comment-form").remove();
        var e = {
            ownerFirstName: "",
            showNewBtnIsVisible: i(0),
            showAllLinkIsVisible: n(),
            unansweredCount: 0
        };
        function i(e) {
            return t.currentIsAll && t.ownerId === a && 0 < e
        }
        function n() {
            return !t.currentIsAll && t.ownerId === a
        }
        return e.update = function() {
            e.setAttr({
                showNewBtnIsVisible: i(0),
                showAllLinkIsVisible: n(),
                unansweredCount: 0
            })
        }
        ,
        a === t.ownerId && t.onChange("currentIsAll", e.update),
        e
    }
    ,
    o
}
,
lilo.viewFactories["couple-match-view"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.close": function() {
            i.remove()
        },
        "click@$.message": function() {
            i.trigger("send-message", {
                model: this.model
            }),
            i.remove()
        }
    },
    i
}
,
lilo.viewFactories["couples-round"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = i.$(".self-matches")
      , o = i.$(".total-matches")
      , a = i.$(".random-choice");
    return i.showStage1 = function() {
        i.el.hide()
    }
    ,
    i.showStage2 = function() {
        i.el.show(),
        n.css("opacity", 0),
        a.css("opacity", 0),
        o.css("transform", "translateX(-80px)"),
        o.css("opacity", 1)
    }
    ,
    i.showStage3 = function() {
        i.el.show(),
        n.css("opacity", 1),
        a.css("opacity", 0),
        o.css("transform", "translateX(0px)"),
        o.css("opacity", 1)
    }
    ,
    i.showStage4 = function() {
        i.el.show(),
        n.css("opacity", 0),
        a.css("opacity", 1),
        o.css("opacity", 0)
    }
    ,
    i.showStage5 = i.showStage4,
    i
}
,
lilo.viewFactories["dialog-add-comment"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = i.$(".check-box")
      , o = !1
      , a = "selected"
      , s = i.$(".loader")
      , r = i.$("input");
    function l(e) {
        n[(o = !!e) ? "addClass" : "removeClass"](a),
        i.els["anonymous-hint"][o ? "hide" : "show"]()
    }
    function d() {
        i.trigger("ok", {
            text: r.val(),
            isAnonymous: o
        })
    }
    i.els.input = r,
    (i.els.checkBox = n)[o ? "addClass" : "removeClass"](a),
    i.setCheckboxSelected = l,
    i.showLoader = function() {
        s.css("display", "block")
    }
    ,
    i.hideLoader = function() {
        s.hide()
    }
    ,
    i.handlers = {
        "click@$.ok": function() {
            d()
        },
        "click@$.check-box": function() {
            l(!o)
        },
        "click@$.enable-invis": function() {
            i.trigger("enable-invis")
        }
    };
    return i.createViewModel = function(e) {
        var t = {
            left: 140
        };
        return r.on("keydown", function(e) {
            return 13 === e.which ? (d(),
            e.preventDefault(),
            !1) : 8 !== e.which && 46 !== e.which && 140 <= r.val().length ? (e.preventDefault(),
            !1) : void e.which
        }),
        r.on("keyup", function(e) {
            t.setAttr({
                left: 140 - r.val().length
            })
        }),
        r.on("paste", function(e) {
            e.preventDefault();
            var t = (e.originalEvent.clipboardData || window.clipboardData).getData("Text")
              , i = util.replaceAppProfileLinks(t);
            r.focus();
            var n, n = (n = r[0],
            e = 0,
            document.selection ? (n.focus(),
            (t = document.selection.createRange()).moveStart("character", -n.value.length),
            e = t.text.length) : !n.selectionStart && "0" != n.selectionStart || (e = "backward" == n.selectionDirection ? n.selectionStart : n.selectionEnd),
            e), e = r.val();
            return r.val(e.substr(0, n) + i + e.substr(n)),
            !1
        }),
        t
    }
    ,
    i
}
,
lilo.viewFactories["dialog-add-cool-like"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.submit": function() {
            i.trigger("submit")
        },
        "click@$.cool-like-subscribe": function() {
            i.trigger("subscribe")
        },
        "click@$.cancel": function() {
            i.trigger("cancel")
        }
    },
    i.$(".track-nom").html(util.radioText("трек", "клип")),
    i.$(".track-acc").html(util.radioText("трекa", "клипa")),
    i
}
,
lilo.viewFactories["dialog-add-friend-deposit"] = function(e, t) {
    var c = lilo.baseViewFactory(e, t);
    return c.appFriendsEls = c.$(".app-friends-el"),
    c.createViewModel = function(d) {
        var e, n;
        function t(e) {
            c.trigger("search", {
                word: e
            })
        }
        302867339 === app.info.viewer_id && "test302867339" === app.info.hash ? (e = $(document.createElement("div")),
        n = !1,
        e.addClass("btn green").click(function() {
            var i;
            n || (n = !0,
            i = socialApi.getAppUsersUids().length,
            VKApi("friends.getAppUsers", {}, function(e) {
                n = !1;
                var t = ""
                  , t = e && e.response ? "Размер списка друзей: {0}, debug: {1}".format(i, e.response.length) : "При отправке запроса произошла ошибка";
                dialogController.fadePopup({
                    message: t,
                    duration: 5e3
                })
            }))
        }).appendTo(c.els.test).html("Проверить список друзей")) : c.els.test.remove();
        function i() {
            t(a.val())
        }
        var o, a = c.$(".search-panel input");
        a.on("keypress", function() {
            clearTimeout(o),
            o = setTimeout(i, 500)
        }),
        a.on("keydown", function() {
            a.val() ? (clearTimeout(o),
            o = setTimeout(i, 500)) : t("")
        }),
        a.on("keyup", function() {
            a.val() || t("")
        }),
        c.el.on("mousewheel", ".result-list", function(e) {
            e.preventDefault()
        }),
        [["searchResultAppFriends", "app-friends-list", 220], ["searchResultOtherFriends", "friends-list", 170]].each(function(e, t) {
            var i, n = t[0], o = t[1], a = t[2], s = {
                mouseWheelSpeed: util.jsScrollPaneSpeed(50),
                trackClickSpeed: util.jsScrollPaneSpeed(50)
            };
            function r() {
                var e = Math.min(Math.ceil(d[n].length / 5), 3);
                c.els[o].height(e * a),
                i ? i.reinitialise(s) : (c.els[o].jScrollPane(s),
                i = c.els[o].data("jsp"))
            }
            r();
            var l, t = function() {
                clearTimeout(l),
                l = setTimeout(r, 100)
            };
            d[n].on("add", "self", t),
            d[n].on("remove", "self", t)
        })
    }
    ,
    c.copyTextToBuffer = function(e) {
        var t = c.__subViews.lastEl();
        t && t.copyTextToBuffer(e)
    }
    ,
    window.ddd1 = c
}
,
lilo.viewFactories["dialog-add-my-yt-track"] = function(e, t) {
    var i, n = lilo.baseViewFactory(e, t), o = n.$(".loader"), a = n.$("input"), s = n.$(".errors"), r = "highlight", e = n.$(".btn.submit-link"), t = n.$(".btn.submit-track");
    function l() {
        var e = $.trim(a.val() || "");
        e && n.trigger("submit-link", {
            link: e
        })
    }
    return n.showLoader = function(e) {
        o.html(e = "<span>" + e + "</span>").show(),
        n.el.addClass("pending")
    }
    ,
    n.hideLoader = function() {
        o.hide(),
        n.el.removeClass("pending")
    }
    ,
    n.hightLightErrors = function() {
        clearTimeout(i),
        i = setTimeout(function() {
            s.addClass(r),
            i = setTimeout(function() {
                s.removeClass(r)
            }, 300)
        }, 100)
    }
    ,
    a.on("keydown", function(e) {
        13 === e.which && l()
    }),
    e.click(l),
    t.click(function() {
        n.trigger("submit")
    }),
    n
}
,
lilo.viewFactories["dialog-agg-profile"] = function(e, t) {
    var d = lilo.baseViewFactory(e, t);
    d.$(".min-price-hint");
    function c(e, t, i, n, o) {
        var a = e[t]
          , s = $("<div/>")
          , r = $("<div/>", {
            class: "plus"
        })
          , l = $("<div/>", {
            class: "minus"
        })
          , d = $("<input/>").val(a);
        return e.onChange(t, function() {
            d.val(e[t])
        }),
        r.click(function() {
            i(d)
        }),
        l.click(function() {
            n(d)
        }),
        d.on("change", function() {
            o(d)
        }).on("blur", function() {
            o(d)
        }).on("keypress", function(e) {
            if (!util.pressedKeyIsNumber(e))
                return e.preventDefault(),
                !1
        }),
        s.append(l).append(d).append(r)
    }
    function u(e, a, s) {
        var r = document.createDocumentFragment()
          , l = null
          , d = "selected";
        return $.each(e, function(e, t) {
            var i = $("<div/>", {
                class: "radio-wrap"
            })
              , n = $("<div/>", {
                class: "radio"
            })
              , o = $("<span/>", {
                text: t.text
            });
            t.value === a && (l = i).addClass(d),
            i.append(n).append(o).click(function() {
                i !== l && (l && l.removeClass(d),
                (l = i).addClass(d),
                s(t.value))
            }),
            r.appendChild(i[0])
        }),
        r
    }
    return d.handlers = {
        "change@$.region-checkbox input": function(e) {},
        "click@$.btn": function() {
            this.trigger("submit")
        }
    },
    d.createViewModel = function(i) {
        i.leftValues <= 10 && (i.leftValues = 10);
        var e = {
            totalPrice: n()
        };
        d.$(".controls.values").append(c(i, "leftValues", function(e) {
            var t = i.leftValues + 10;
            i.setAttr({
                leftValues: 300 < t ? 300 : t
            })
        }, function(e) {
            i.setAttr({
                leftValues: i.leftValues <= 10 ? i.leftValues : i.leftValues - 10
            })
        }, function(e) {
            var t = parseInt(e.val(), 10);
            isNaN(t) || t % 10 != 0 ? e.val(i.leftValues) : (i.setAttr({
                leftValues: t = 300 < (t = t < 10 ? 10 : t) ? 300 : t
            }),
            e.val(t))
        })),
        d.$(".controls.price").append(c(i, "price", function(e) {
            i.targetSex;
            var t = Math.floor(i.price + 5);
            i.setAttr({
                price: t = 200 < t ? 200 : t
            }),
            0
        }, function(e) {
            i.targetSex,
            i.targetSex;
            var t = Math.floor(i.price - 5);
            i.setAttr({
                price: t < 5 ? 5 : t
            }),
            0
        }, function(e) {
            var t = parseInt(e.val(), 10);
            isNaN(t) ? e.val(i.price) : (i.targetSex,
            (t = 5 * parseInt(t / 5, 10)) < 5 ? t = 5 : 200 < t && (t = 200),
            i.setAttr({
                price: t
            }),
            e.val(t),
            0)
        }));
        function t() {
            e.setAttr({
                totalPrice: n()
            })
        }
        function n() {
            return i.price * i.leftValues
        }
        d.$(".controls.sex").append(u([{
            text: "Всем",
            value: 0
        }, {
            text: "Парням",
            value: 2
        }, {
            text: "Девушкам",
            value: 1
        }], i.targetSex, function(e) {
            0 === i.targetSex && 0 !== e && i.price,
            i.setAttr({
                targetSex: e
            }),
            0 !== e && (e = i.price,
            i.setAttr({
                price: e = e < 5 ? 5 : e
            }))
        })),
        d.$(".region-checkbox").append(u([{
            text: "Везде",
            value: 0
        }, {
            text: "В моем регионе",
            value: 1
        }], d.model.adByRegion ? 1 : 0, function(e) {
            d.model.adByRegion = !!e
        })),
        i.onChange("targetSex", t),
        i.onChange("price", t),
        i.onChange("leftValues", t);
        function o(e) {
            return (e - 14) / 36 * 100
        }
        function a() {
            r.text(i.adAgeMin).css("left", o(i.adAgeMin) + "%"),
            l.text(i.adAgeMax).css("left", o(i.adAgeMax) + "%")
        }
        var s = d.$(".age-range")
          , r = $(document.createElement("div")).addClass("age-caption")
          , l = $(document.createElement("div")).addClass("age-caption");
        return s.slider({
            range: !0,
            min: 14,
            max: 50,
            minRangeSize: 2,
            maxRangeSize: 36,
            lowMax: 48,
            topMin: 16,
            autoShift: !0,
            values: [i.adAgeMin, i.adAgeMax],
            slide: function(e, t) {
                i.adAgeMin = parseInt(t.values[0], 10),
                i.adAgeMax = parseInt(t.values[1], 10),
                a()
            }
        }),
        s.append(r).append(l),
        a(),
        e
    }
    ,
    d
}
,
lilo.viewFactories["dialog-audios-list"] = function(e, t) {
    var u = lilo.baseViewFactory(e, t)
      , p = t.isStaticTrackList;
    return p && (u.$(".search").remove(),
    u.$(".add-to-chat").remove(),
    u.el.addClass("is-static-list")),
    u.showLoader = function() {
        u.els.loader.show()
    }
    ,
    u.hideLoader = function() {
        u.els.loader.hide()
    }
    ,
    u.showVKPrivacyHint = function() {
        u.el.addClass("show-vk-privacy-hint")
    }
    ,
    u.createViewModel = function(t) {
        var e = t.type === RadioPlayerType.YOUTUBE;
        e && u.el.addClass("youtube"),
        $.each(t.items, function(e, t) {
            t.name = "{0} - {1}".format(t.artist || "", t.title || ""),
            t.__testString = t.name.toLowerCase()
        });
        var o, a = {
            resultList: null,
            selectedModel: null
        }, s = 1;
        function i(i, e) {
            var n;
            o !== i && (i = (o = i).toLowerCase(),
            n = [],
            s++,
            $.each(t.items, function(e, t) {
                if ((!i || -1 !== t.__testString.indexOf(i)) && (n.push(t),
                100 === n.length))
                    return !1
            }),
            a.resultList ? (a.resultList.removeAll(),
            a.resultList.add(n),
            a.setAttr({
                selectedModel: null
            })) : a.resultList = n,
            i && 2 < i.length && (app.eventBus.trigger(app.EVENTS.AUDIO_PREVIEW_STOP),
            u.trigger("search-audio-by-world", {
                key: i,
                searchId: s
            })),
            e || u.trigger("search"))
        }
        u.displaySearchResult = function(e, t) {
            var n, o;
            e === s && t && t.length && (n = document.createDocumentFragment(),
            o = u.els.list.attr("renderer"),
            (e = document.createElement("div")).className = "vk-search-result",
            e.innerHTML = "Найдены аудиозаписи",
            n.appendChild(e),
            $.each(t, function(e, t) {
                t.__allowableFromSearch = !0,
                t.isPlaying = !1;
                var i = lilo.createView(o);
                i.setModel(t),
                n.appendChild(i.el[0])
            }),
            u.els.list.append(n))
        }
        ;
        var n, r, l = u.$("input");
        e ? (l.on("keypress", function(e) {}),
        l.on("keydown", function(e) {
            13 === e.which && i(l.val())
        }),
        u.el.find("[do-search]").click(function() {
            i(l.val())
        })) : (r = function() {
            i(l.val())
        }
        ,
        l.on("keypress", function() {
            clearTimeout(n),
            n = setTimeout(r, 500)
        }),
        l.on("keydown", function() {
            l.val() ? (clearTimeout(n),
            n = setTimeout(r, 500)) : i("")
        }),
        l.on("keyup", function() {
            l.val() || i("")
        })),
        t.items.length && setTimeout(function() {
            l.focus()
        }, 100),
        p ? a.resultList = t.items : i("", !0);
        var d, c = "selected";
        return u.on("click:" + (e ? "item-yt-track" : "item-audio"), function(e) {
            e.extraData.model !== a.selectedModel && (d && d.removeClass(c),
            (d = e.extraData.el).addClass(c),
            a.setAttr({
                selectedModel: e.extraData.model
            }))
        }),
        u.el.on("click", ".add-to-chat", function(e) {
            a.selectedModel && u.trigger("submit", {
                model: a.selectedModel
            })
        }),
        a
    }
    ,
    u
}
,
lilo.viewFactories["dialog-buy-deposit"] = function(e, t) {
    var o = lilo.baseViewFactory(e, t);
    return o.handlers = {
        "click@$.submit": function() {
            o.trigger("submit")
        },
        "click@$.open-deposits": function() {
            o.trigger("open-deposits")
        }
    },
    o.updateViewModel = function() {
        var e = o.model;
        e.hasOwner && !e.isFriend && o.$(".submit").remove()
    }
    ,
    o.createViewModel = function(e) {
        function t() {
            return Math.max(e.estimatedTimeOfEnd - util.serverUtc(), 0)
        }
        var i = function() {
            o.isVisible && (n.setAttr({
                leftMillis: t()
            }),
            setTimeout(i, 1e3))
        }
          , n = {
            leftMillis: t()
        };
        return setTimeout(i, 1e3),
        o.updateViewModel(),
        n
    }
    ,
    o
}
,
lilo.viewFactories["dialog-change-text-status"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = i.$(".loader")
      , o = i.$("input");
    return i.els.input = o,
    i.showLoader = function() {
        n.css("display", "block")
    }
    ,
    i.hideLoader = function() {
        n.hide()
    }
    ,
    i.handlers = {
        "click@$.ok": function() {
            this.trigger("ok", {
                text: o.val()
            })
        }
    },
    i.createViewModel = function(e) {
        var t = {
            left: 200 - e.text.length
        };
        return o.on("keydown", function(e) {
            return 13 === e.which ? (i.trigger("ok", {
                text: o.val()
            }),
            e.preventDefault(),
            !1) : 8 !== e.which && 46 !== e.which && 200 <= o.val().length ? (e.preventDefault(),
            !1) : void 0
        }),
        o.on("keyup", function(e) {
            t.setAttr({
                left: 200 - o.val().length
            })
        }),
        t
    }
    ,
    i
}
,
lilo.viewFactories["dialog-color-picker"] = function(e, t) {
    var o = lilo.baseViewFactory(e, t)
      , a = app.SUBSCRIBE_TYPES
      , s = null
      , r = null
      , l = null
      , d = null
      , c = "selected";
    return o.on("pick-color:" + o.id, function(e) {
        var t = e.extraData.$el
          , e = e.extraData.colorId;
        e !== s && (s = e,
        l && l.removeClass(c),
        l = t.addClass(c),
        o.viewModel.setAttr({
            color: e
        }),
        o.model.isRatingColorUpdate || o.model.setAttr({
            textColor: e
        }))
    }),
    o.on("pick-avatar:" + o.id, function(e) {
        var t = e.extraData.$el
          , e = e.extraData.id;
        e !== r && (r = e,
        d && d.removeClass(c),
        d = t.addClass(c),
        o.viewModel.setAttr({
            abg: e
        }))
    }),
    o.handlers = {
        "click@$.cancel": function() {
            this.trigger("cancel")
        },
        "click@$.ok": function() {
            this.trigger("ok", {
                colorId: s,
                abg: r
            })
        }
    },
    o.createViewModel = function(e) {
        var t = {
            photoUrl: app.info.photo_100,
            firstName: app.info.first_name + util.formatProfileBdate(null, app.info.age),
            showPrices: !1,
            abg: e.abg,
            color: e.type === a.RATING_COLOR ? e.ratingColor : e.textColor
        };
        s = e.textColor,
        r = e.abg,
        o.els.user[e.type === a.RATING_COLOR ? "hide" : "show"](),
        o.els.avatars[e.type,
        a.RATING_COLOR,
        "hide"](),
        e.type === a.RATING_COLOR && o.$(".picker-area .title").remove(),
        (!util.isDef(s) || null == s || s < 0 || s >= app.GLOBAL_COLORS.length) && (s = 0,
        t.color = s),
        setTimeout(function() {
            l = $(o.$(".item-color-picker").get(s)).addClass(c),
            d = $(o.$(".avatar" + e.abg)).addClass(c)
        }, 0);
        var i = e.colorTs
          , n = e.colorPeriod;
        return i && n ? (n = new Date(i + n),
        e.type,
        a.AVATAR_BG,
        n = "Цвет доступен до " + moment(n.getTime() + app.info.timeDiff).format("Do MMMM YYYY"),
        o.els.expires.text(n)) : (o.els.expires.hide(),
        t.showPrices = !0),
        t
    }
    ,
    o
}
,
lilo.viewFactories["dialog-complaint"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.cancel": function() {
            this.trigger("close")
        },
        "click@$.ok": function() {
            this.trigger("ok", {
                value: parseInt(i.$(".reason-list").attr("value"), 10)
            })
        }
    },
    i
}
,
lilo.viewFactories["dialog-create-self-room"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , t = t.price || 1;
    return i.els.price.text(t),
    i.handlers = {
        "click@$.submit": function(e) {
            i.trigger("submit")
        }
    },
    i
}
,
lilo.viewFactories["dialog-edit-room-question"] = function(e, t) {
    var i, r = lilo.baseViewFactory(e, t), n = r.$(".loader"), l = r.$("input.text");
    return r.swapInputImage = function() {
        util.swapInputImage(r.$("#input-file"), "input-file")
    }
    ,
    r.handlers = {
        "keydown@$.text": function(e) {
            clearTimeout(i),
            i = setTimeout(function() {
                r.trigger("text-changed", {
                    value: e.target.value
                })
            }, 600)
        },
        "change@$#input-file": function(e) {
            this.trigger("select-img", {
                fileList: e.target.files
            })
        },
        "click@$.add-answer .overlay": function() {
            this.trigger("open-image-editor")
        },
        "click@$.public": function(e) {
            this.trigger("public")
        },
        "click@$.delete": function(e) {
            this.trigger("delete", {
                model: this.model
            })
        },
        "click@$.go-back": function(e) {
            this.trigger("go-back")
        }
    },
    r.showLoader = function() {
        n.show()
    }
    ,
    r.hideLoader = function() {
        n.hide()
    }
    ,
    r.createViewModel = function(e) {
        l.val(e.text);
        var t = {
            canDelete: i(),
            canPublic: o(),
            canAddAnswer: n()
        };
        function i() {
            return e._id
        }
        function n() {
            return e.answers.length < 20
        }
        function o() {
            return e.isValid() && e.status !== app.UsersRoundQuestionStatus.ON_MODERATION
        }
        function a() {
            t.setAttr({
                canAddAnswer: n(),
                canPublic: o()
            })
        }
        function s() {
            t.setAttr({
                canDelete: i()
            })
        }
        return e.answers.on("add", "self", a),
        e.answers.on("remove", "self", a),
        e.onChange("text", a),
        e.onChange("status", a),
        e.onChange("_id", s),
        r.onRemove(function() {
            e.answers.off("add", "self", a),
            e.answers.off("remove", "self", a),
            e.offChange("text", a),
            e.offChange("status", a),
            e.offChange("_id", s)
        }),
        t
    }
    ,
    r
}
,
lilo.viewFactories["dialog-edit-users-question"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["dialog-ef-invite"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["dialog-enter-age"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = new Date
      , e = new Date;
    app.info.selfBdate && app.info.selfBdate.split ? (t = app.info.selfBdate.split("_"),
    a = parseInt(t[0], 10),
    o = parseInt(t[1], 10) - 1,
    t = parseInt(t[2], 10),
    e.setFullYear(t),
    e.setMonth(o),
    e.setDate(a)) : e = new Date(0);
    var o = new Date
      , a = new Date;
    o.setFullYear(n.getFullYear() - 7),
    o.setMonth(n.getMonth()),
    o.setDate(n.getDate() - 1),
    a.setFullYear(n.getFullYear() - 70),
    a.setMonth(0),
    a.setDate(1);
    var s = i.$(".date-picker-wrap");
    function r(e) {
        i.els.submit[app.info.selfBdate === e ? "hide" : "show"]()
    }
    return s.datepicker({
        defaultDate: e,
        maxDate: o,
        minDate: a,
        yearRange: a.getFullYear() + ":" + o.getFullYear(),
        changeMonth: !0,
        changeYear: !0,
        onSelect: function(e, t) {
            r("{0}_{1}_{2}".format(parseInt(t.selectedDay, 10), parseInt(t.selectedMonth, 10) + 1, parseInt(t.selectedYear, 10)))
        }
    }),
    i.el.on("click", ".submit", function() {
        var e = s.datepicker("getDate");
        i.trigger("submit", {
            date: e
        })
    }),
    r(app.info.selfBdate),
    i
}
,
lilo.viewFactories["dialog-enter-keyword"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.showErrorHint = function() {
        i.els.error.css("visibility", "visible")
    }
    ,
    i.handlers = {
        "click@$.submit": function() {
            this.trigger("submit", {
                value: this.els.input.val()
            })
        },
        "keypress@$input": function(e) {
            if (i.els.error.css("visibility", "hidden"),
            13 === e.which)
                return e.preventDefault(),
                e.stopPropagation(),
                this.trigger("submit", {
                    value: this.els.input.val()
                }),
                !1
        }
    },
    i
}
,
lilo.viewFactories["dialog-exp-booster-success-purchase"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["dialog-free-spin-gifts"] = function(e, t) {
    var l = lilo.baseViewFactory(e, t);
    return l.createViewModel = function(e) {
        function s(e) {
            var t = document.createElement("div");
            return t.className = e || "",
            t
        }
        var r = document.createDocumentFragment();
        e.items.each(function(e, t) {
            var i = s("item")
              , n = s("avatar")
              , o = s("first-name")
              , a = s("btn");
            n.style.backgroundImage = "url(" + t.p100 + ")",
            o.innerHTML = util.escapeHtml(t.fn),
            a.innerHTML = "Получить/отправить в ответ",
            i.appendChild(n),
            i.appendChild(o),
            i.appendChild(a),
            a.onclick = function() {
                l.trigger("get-free-spin", {
                    model: t
                })
            }
            ,
            t.onChange("disabled", function() {
                t.disabled && (i.className += " disabled")
            }),
            r.appendChild(i)
        }),
        l.$(".list").append(r)
    }
    ,
    l
}
,
lilo.viewFactories["dialog-friends-echange-explain"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.$(".exp-rate-value").html(Constants.FRIENDS_EXCHANGE_EXP_RATE),
    t
}
,
lilo.viewFactories["dialog-gain-moneybox"] = function(e, t) {
    var n = lilo.baseViewFactory(e, t);
    n.el.on("click", ".submit", function() {
        n.trigger("submit")
    }),
    n.el.on("click", ".cancel", function() {
        n.trigger("close")
    }),
    util.isOKPlatform() ? n.els.price.html("Стоимость 70 ОК") : n.els.price.html("Стоимость 10 голосов");
    var o = []
      , i = n.$(".pig");
    return util.repeat(4, function(e) {
        var t = document.createElement("div");
        t.className = "item-frame",
        t.style.opacity = 0 === e ? 1 : 0,
        t.style.backgroundPosition = "0 -" + 384 * e + "px",
        o.push(t),
        i.append(t)
    }),
    n.complete = function() {
        n.el.addClass("complete");
        var t = 0
          , i = function() {
            o[t].style.opacity = 0;
            var e = o[t + 1];
            e && (e.style.opacity = 1,
            ++t < o.length - 1 ? setTimeout(i, 1499) : setTimeout(function() {
                n.el.addClass("animation-complete")
            }, 1600))
        };
        i()
    }
    ,
    n
}
,
lilo.viewFactories["dialog-game-gifts-v2"] = function(e, t) {
    var o = lilo.baseViewFactory(e, t)
      , s = (o.$(".list-wrap"),
    o.$(".gifts-line"))
      , a = o.$(".tabs-block")
      , r = []
      , l = {};
    function i() {}
    function n(e) {
        var a = 0;
        $.each(e, function(e, o) {
            $.each(o.pages, function(e, t) {
                function i() {
                    t.selected && s.css("left", 100 - n + "px")
                }
                var n = a;
                s.append(function(e, t) {
                    var i = $("<div></div>", {
                        class: "gifts-item-page"
                    });
                    t.subTitle.text && i.append($("<div></div>", {
                        html: t.subTitle.text,
                        class: "bonus-hint " + (t.subTitle.className || "")
                    }));
                    var o = document.createDocumentFragment();
                    return $.each(e.items, function(e, t) {
                        var i = lilo.createView("item-game-gift");
                        i.setModel(t);
                        var n = lilo.createView("item-game-gift");
                        n.setModel(t),
                        l[t.id] = n,
                        o.appendChild(i.el[0])
                    }),
                    i.append(o)
                }(t, o)),
                i(),
                t.onChange("selected", i),
                a = n + 360
            })
        }),
        s.width(a)
    }
    return t && t.privateMessageHeader && o.$(".add-private-message").html(t.privateMessageHeader),
    o.handlers = {
        "click@$.left-arrow": function() {
            o.trigger("show-prev")
        },
        "click@$.right-arrow": function() {
            o.trigger("show-next")
        },
        "click@$.add-private-message": function() {
            o.trigger("add-private-message")
        }
    },
    o.applyFreqGifts = function(e) {
        var i = document.createDocumentFragment();
        $.each(e, function(e, t) {
            t = l[t.id];
            t && i.appendChild(t.el[0])
        }),
        i.childNodes.length ? (o.els["freq-gifts"].html("").append(i).show(),
        o.el.addClass("freq-shown")) : (o.els["freq-gifts"].hide(),
        o.el.removeClass("freq-shown"))
    }
    ,
    o.applyTabs = function(e) {
        var t;
        t = e,
        $.each(t, function(e, t) {
            function i() {
                n[t.selected ? "addClass" : "removeClass"]("selected")
            }
            var n = $("<span></span>", {
                class: "item-tab " + (t.opts.tabClassName || ""),
                html: t.tabName
            });
            n.click(function() {
                o.trigger("show-tab", {
                    tab: t
                })
            }),
            i(),
            t.onChange("selected", i),
            a.append(n),
            r.push(n)
        }),
        setTimeout(i, 100),
        n(e)
    }
    ,
    o.definePositionsOfTabs = function() {
        var e = a.outerHeight()
          , i = 0;
        $.each(r, function(e, t) {
            i += t.outerHeight()
        }),
        r[0].css("margin-top", (e - i) / 2 + "px")
    }
    ,
    o
}
,
lilo.viewFactories["dialog-gifts-shop"] = function(e, t) {
    var s = lilo.baseViewFactory(e, t)
      , i = s.$("input")
      , n = s.$(".hint")
      , o = s.$(".loader")
      , r = s.$(".list")
      , a = s.$(".open-message-block")
      , l = s.$(".check-box")
      , d = !1
      , c = "selected";
    function u(e) {
        l[(d = e) ? "addClass" : "removeClass"](c),
        s.els["anonymous-hint"][d ? "hide" : "show"]()
    }
    function p() {
        s.trigger("ok", {
            giftId: m._id,
            price: m.price,
            message: i.val(),
            isAnonymousCheck: d
        })
    }
    l[d ? "addClass" : "removeClass"](c),
    s.setCheckboxSelected = u,
    i.attr("maxlength", 140),
    n.text(140),
    i.on("keypress", function(e) {
        return 13 === e.which ? (p(),
        e.preventDefault(),
        !1) : 140 <= i.val().length ? (e.preventDefault(),
        !1) : void 0
    }),
    i.on("keyup", function(e) {
        n.text(140 - i.val().length)
    }),
    s.showLoader = function() {
        o.css("display", "block")
    }
    ,
    s.hideLoader = function() {
        o.hide()
    }
    ,
    s.handlers = {
        "click@$.open-message-block .link": function(e) {
            a.remove(),
            i.focus()
        },
        "click@$.ok": function() {
            p()
        },
        "click@$.check-box": function() {
            u(!d)
        }
    },
    s.createViewModel = function(e) {
        var o, a;
        e = e.gifts,
        o = util.random(0, e.length - 1),
        a = "selected",
        $.each(e, function(e, t) {
            var i = $("<div/>").addClass("gift no-select")
              , n = util.fixImagePath(t.img);
            i.css({
                backgroundImage: "url(" + n + ")"
            }),
            $("<div/>").addClass("item-gift-price").text(t.price).appendTo(i),
            e === o && (i.addClass(a),
            f = i,
            m = t),
            i.click(function() {
                m !== t && (m = t,
                s.viewModel.update(),
                f.removeClass(a),
                f = i.addClass(a))
            }),
            r.append(i)
        });
        var t = {
            selectedImg: m.img,
            selectedTitle: m.title,
            update: function() {
                m && t.setAttr({
                    selectedImg: m.img,
                    selectedTitle: m.title
                })
            }
        };
        return t
    }
    ;
    var f = null
      , m = null;
    return s
}
,
lilo.viewFactories["dialog-group-subscribe"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.get-bonus": function() {
            i.trigger("get-bonus")
        }
    },
    i
}
,
lilo.viewFactories["dialog-image-cropper"] = function(e, t) {
    var _ = lilo.baseViewFactory(e, t);
    _.el.on("click", ".btn", function(e) {
        _.trigger(e.currentTarget.getAttribute("action"))
    });
    function i(e, t) {
        _.$(".image-loading").remove(),
        _.$(".area").show();
        var i = e / t
          , n = "url(" + _.model.sourceImageUrl + ")";
        y.attr("src", _.model.sourceImageUrl),
        D.attr("src", _.model.sourceImageUrl),
        E.css("background-image", n);
        var o, a, s = e, r = t, l = 200, d = 200, c = 0, u = 0, p = 0, f = 0, m = !0, n = !0;
        if (_.getData = function() {
            return {
                rect1: {
                    x: p,
                    y: f,
                    width: o,
                    height: a
                },
                rect2: {
                    x: c,
                    y: u,
                    width: l,
                    height: d
                }
            }
        }
        ,
        e <= 200 && t <= 200)
            p = (200 - e) / 2,
            f = (200 - t) / 2,
            m = n = !(a = o = 200);
        else {
            var v = e
              , h = t
              , g = 590 - v
              , b = 700 - h;
            if (590 < v || 700 < h)
                for (; g < 0 || b < 0; )
                    g < 0 ? h = (v = 590) / i : b < 0 && (v = (h = 700) * i),
                    g = 590 - v,
                    b = 700 - h;
            o = s = v,
            a = r = h
        }
        function C(e) {
            w.css({
                width: l,
                height: d
            }),
            y.css({
                "margin-left": -c - 1 + p + "px",
                "margin-top": -u - 1 + f + "px"
            }),
            e && e.element && e.element.css({
                left: e.position.left = c,
                top: e.position.top = u,
                width: e.size.width = l,
                height: e.size.height = d
            }),
            e = l / 100,
            D.css({
                "margin-left": (-c - 1 + p) / e + "px",
                "margin-top": (-u - 1 + f) / e + "px",
                width: s / e,
                height: r / e
            })
        }
        n && w.draggable({
            containment: E,
            drag: function(e, t) {
                c = t.position.left,
                u = t.position.top,
                C(t)
            },
            start: function(e, t) {
                c = t.position.left,
                u = t.position.top,
                C(t)
            },
            stop: function(e, t) {
                c = t.position.left,
                u = t.position.top,
                C(t)
            }
        }),
        m && (t = Math.ceil(200 / (e / o)),
        e = Math.min(a, o) - 2,
        w.resizable({
            containment: E,
            aspectRatio: 1,
            minWidth: t,
            minHeight: t,
            maxWidth: e,
            maxHeight: e,
            resize: function(e, t) {
                l = t.size.width,
                d = t.size.height,
                C(t)
            },
            start: function(e, t) {
                l = t.size.width,
                d = t.size.height,
                C(t)
            },
            stop: function(e, t) {
                l = t.size.width,
                d = t.size.height,
                C(t)
            }
        })),
        E.css({
            width: o,
            height: a,
            backgroundSize: "{0}px {1}px".format(s, r),
            backgroundPosition: "{0}px {1}px".format(p, f)
        }),
        y.css({
            width: s,
            height: r
        }),
        D.css({
            width: s,
            height: r
        }),
        m || n || _.el.addClass("without-handler"),
        C()
    }
    var w = _.$(".cropper")
      , E = (_.$(".result"),
    _.$(".bg"))
      , y = _.$(".bg img")
      , D = _.$(".result img");
    return _.createViewModel = function(e) {
        var t = new Image;
        t.onerror = function() {
            _.isVisible && dialogController.fadePopup("Не удалось загрузить изображение")
        }
        ,
        t.onload = function() {
            _.isVisible && (util.isValidImage(t) ? (_.els.status.hide(),
            i(t.width, t.height)) : _.els.status.show().html("Нельзя использовать фотографию, у которой одна из сторон в несколько раз превышает другую. Фотография должна иметь размер не менее 200 пикселей и не больше 7000 пикселей по каждой из сторон."))
        }
        ,
        _.els.status.show().html("Загрузка изображения"),
        t.src = e.sourceImageUrl
    }
    ,
    _
}
,
lilo.viewFactories["dialog-image-editor"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.ok": function() {
            this.trigger("ok")
        },
        "click@$.cancel": function() {
            this.trigger("cancel")
        }
    },
    t
}
,
lilo.viewFactories["dialog-insufficiently-balance"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.buy": function(e) {
            this.trigger("buy")
        },
        "click@$.free": function(e) {
            this.trigger("free")
        }
    },
    t.createViewModel = function(e) {
        return {
            isCoins: 1 === e.currency
        }
    }
    ,
    t
}
,
lilo.viewFactories["dialog-insufficiently-level"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["dialog-invis-setiings"] = function(e, t) {
    var l = lilo.baseViewFactory(e, t);
    return l.el.on("click", ".extend-period", function() {
        l.trigger("extend-period")
    }),
    l.el.on("click", ".save", function() {
        l.trigger("save")
    }),
    l.el.on("click", ".cancel", function() {
        dialogController.close(l)
    }),
    l.createExpirationText = function(e) {
        return "Режим невидимки доступен до " + e
    }
    ,
    l.addOption = function(e, t, n, i, o) {
        var a = document.createElement("div");
        a.className = "option",
        o = o || {};
        o = document.createElement("label");
        o.className = "control";
        var s = document.createElement("input");
        s.type = "checkbox",
        s.checked = !!t,
        s.onchange = function() {
            i(s.checked)
        }
        ;
        t = document.createElement("div");
        t.className = "option-title",
        t.innerHTML = e;
        var r = document.createElement("div");
        r.className = "option-descr",
        n.each(function(e, t) {
            var i = 1 < n.length ? e + 1 + ". " : ""
              , e = document.createElement("div");
            e.innerHTML = i + t,
            r.appendChild(e)
        }),
        a.appendChild(o),
        o.appendChild(s),
        o.appendChild(t),
        o.appendChild(r),
        l.els.options.append(a)
    }
    ,
    l.createViewModel = function(e) {
        function t() {
            return l.createExpirationText(moment(e.expired + app.info.timeDiff).format("Do MMMM YYYY"))
        }
        var i = {
            expirationText: t()
        };
        return e.onChange("expired", function() {
            i.setAttr({
                expirationText: t()
            })
        }),
        e.onChange("pending", function() {
            l.el[e.pending ? "addClass" : "removeClass"]("pending")
        }),
        i
    }
    ,
    l
}
,
lilo.viewFactories["dialog-invite-users-into-self-room"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = i.$(".result-list");
    function o(e) {
        i.trigger("search", {
            word: e
        })
    }
    function a() {
        o(r.val())
    }
    var s, r = i.els.search_input;
    r.on("keypress", function() {
        clearTimeout(s),
        s = setTimeout(a, 500)
    }),
    r.on("keydown", function() {
        r.val() ? (clearTimeout(s),
        s = setTimeout(a, 500)) : o("")
    }),
    r.on("keyup", function() {
        r.val() || o("")
    });
    var l, d = {
        mouseWheelSpeed: util.jsScrollPaneSpeed(50),
        trackClickSpeed: util.jsScrollPaneSpeed(50)
    };
    function c() {
        var a = document.createDocumentFragment()
          , s = 2 === i.model.currentTab;
        $.each(i.model.resultList, function(e, t) {
            var i = document.createElement("div")
              , n = document.createElement("div")
              , o = document.createElement("div");
            i.className = "item",
            n.className = "avatar",
            o.className = "full-name",
            i.setAttribute("uid", t.id),
            t.roomId && i.setAttribute("room-id", t.roomId),
            t.can_post && i.setAttribute("can_post", "1"),
            n.style.backgroundImage = "url(" + t.photo_100 + ")",
            o.innerHTML = s ? t.first_name + " " + t.last_name : t.first_name,
            i.appendChild(n),
            i.appendChild(o),
            t.online && ((t = document.createElement("span")).className = "online",
            i.appendChild(t),
            i.className += " online"),
            a.appendChild(i)
        }),
        n.empty().append(a),
        l ? l.reinitialise(d) : (i.els.scroll.jScrollPane(d),
        l = i.els.scroll.data("jsp"))
    }
    return i.handlers = {
        "click@$.item-tab": function(e) {
            e = parseInt($(e.currentTarget).attr("index"), 10);
            isNaN(e) || this.trigger("show-tab", {
                index: e
            })
        },
        "click@$.item": function(e) {
            var t = parseInt(e.currentTarget.getAttribute("uid"), 10);
            e.currentTarget.getAttribute("room-id");
            this.trigger("invite-user", {
                uid: t,
                targetEl: e.currentTarget
            })
        }
    },
    i.createViewModel = function(e) {
        e.resultList.on("add", "self", c),
        e.resultList.on("removeAll", "self", c)
    }
    ,
    i
}
,
lilo.viewFactories["dialog-kick-user"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.cancel": function() {
            this.trigger("close")
        },
        "click@$.ok": function() {
            this.trigger("ok", {
                id: parseInt(i.$(".reason-list").attr("value"), 10),
                anon: !1,
                price: parseInt(i.$('input[name="kick-price"]:checked').val(), 10)
            })
        }
    },
    i.createViewModel = function(e) {
        roomModel.ownerId === app.info.viewer_id && i.$(".line").hide()
    }
    ,
    i
}
,
lilo.viewFactories["dialog-level-complete"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    i.startAnimation = function() {
        setTimeout(function() {
            i.el.addClass("animate"),
            setTimeout(function() {
                i.el.addClass("hide-prev-level")
            }, 1e3)
        }, 500)
    }
    ;
    function n(e, t) {
        var i = app.getTextAndBorderColorAndByLevel(t);
        240 <= t ? e.addClass("gold-level-gradient").html("<div class='gold-level-inner'>" + t + "</div>") : e.css({
            "box-shadow": "0 2px 1px " + i.border,
            border: "1px solid " + i.border,
            "background-color": i.border,
            color: "#fff"
        }).html(t)
    }
    return i.createViewModel = function(e) {
        n(i.$(".prev-level"), e.prevLevel),
        n(i.$(".next-level"), e.nextLevel)
    }
    ,
    i
}
,
lilo.viewFactories["dialog-mobi-chat__old"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["dialog-mobi-top-list"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["dialog-name-secret"] = function(e, t) {
    var a = lilo.baseViewFactory(e, t);
    return a.el.on("click", ".btn", function(e) {
        e = e.currentTarget.getAttribute("action");
        e && a.trigger(e)
    }),
    a.showPending = function(e) {
        a.els.preview.html("<p class='pending'>Идет расшифровка</p>"),
        setTimeout(e, 3e3)
    }
    ,
    a.startAnimation = function(e, n, t) {
        var o = []
          , i = function() {
            var e = o.shift();
            e ? (e.className = "fade",
            setTimeout(i, 1e3)) : t()
        };
        util.repeat(e, function(e) {
            var t = document.createElement("div")
              , i = t.style;
            i.width = n + "px",
            i.left = n * e + "px",
            o.push(t),
            a.els["canvas-wrap"].append(t)
        }),
        a.els.preview.hide(),
        a.els.result.show(),
        setTimeout(i, 1e3)
    }
    ,
    a.animateCoin = function() {
        var e = $(document.createElement("div")).addClass("coin-icon-el transition-500").css("z-index", 1e3)
          , t = a.els.coin.offset();
        e.css({
            left: t.left + "px",
            top: t.top + "px"
        }).appendTo($contextArea),
        setTimeout(function() {
            e.css({
                left: "890px",
                top: "9px"
            }),
            setTimeout(function() {
                e.remove()
            }, 600)
        }, 100)
    }
    ,
    a.$(".first-name").html(app.info.first_name + "!"),
    a
}
,
lilo.viewFactories["dialog-news"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["dialog-offers"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$button": function(e) {
            this.trigger("submit")
        }
    },
    t
}
,
lilo.viewFactories["dialog-open-viral-answer"] = function(e, t) {
    var i, n = lilo.baseViewFactory(e, t);
    return n.handlers = {
        "click@$.close": function() {
            this.trigger("close")
        },
        "click@$.answer": function() {
            this.trigger("go-to-answers")
        }
    },
    n.animateLock = function(e) {
        setTimeout(function() {
            i.animateLock(e)
        }, 350)
    }
    ,
    n.createViewModel = function(e) {
        return (i = lilo.createView("item-viral-self-answer")).setModel(e),
        i.$(".open").remove(),
        n.$(".answer-bubble").append(i.el),
        {
            questionText: '"' + e.questionText + '"',
            answerTitle: e.fullName + " " + (2 === e.sex ? "ответил" : "ответила") + ":"
        }
    }
    ,
    n
}
,
lilo.viewFactories["dialog-photos-availability-settings"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".save", function() {
        i.trigger("save", {
            checked: i.els.checkbox.prop("checked")
        })
    }),
    i.createViewModel = function(e) {
        i.els.checkbox.prop("checked", e.photosIsNotAvailableForRoom)
    }
    ,
    i
}
,
lilo.viewFactories["dialog-photos-gallery"] = function(e, t) {
    var u = lilo.baseViewFactory(e, t);
    function p(t) {
        var e, i;
        t.img && t.img.likesView && (t.img.likesView.remove(),
        t.img.likesView = null),
        3 === t.status && (e = function() {
            t.img.likesView.el[t.liked ? "addClass" : "removeClass"]("liked"),
            0 < t.likeType ? t.img.likesView.el.addClass("like-type like-type-" + t.likeType) : t.img.likesView.el.removeClass("like-type")
        }
        ,
        (i = lilo.createView("photo-likes")).setModel(t),
        i.setWrapWidth(parseInt(t.img.wrap.style.width)),
        t.img.wrap.appendChild(i.el[0]),
        (t.img.likesView = i).bind("like", function(e) {
            u.trigger("like", {
                type: e.extraData.type,
                photo: t
            })
        }),
        t.onChange("liked", e),
        t.onChange("likeType", e),
        e(),
        i.onRemove(function() {
            t.offChange("liked", e),
            t.offChange("likeType", e)
        }))
    }
    return u.createViewModel = function(n) {
        app.info.bootData.invis && u.el.addClass("enable-invis-state");
        function o() {
            d && d.wrap.parentNode && d.wrap.parentNode.removeChild(d.wrap),
            d && d.likesView && (d.likesView.remove(),
            d.likesView = null),
            d = null
        }
        function a(e) {
            var t = util.fit(e.width, e.height, 580, 460, !0)
              , i = document.createElement("div");
            i.className = "img-outer";
            var n = i.style;
            n.left = t.x + "px",
            n.top = t.y + "px",
            n.width = t.w + "px",
            n.height = t.h + "px",
            (e.wrap = i).appendChild(e),
            s.append(i),
            d = e
        }
        var s = u.$(".img-area")
          , r = u.$(".info")
          , l = n.index
          , d = null
          , c = function() {
            o(),
            r.html(l + 1 + " из " + n.photos.length);
            var e, t, i = n.photos[l];
            i.img ? (a(i.img),
            p(i)) : i.__pending || (e = new Image,
            i.__pending = !0,
            t = l,
            e.onload = function() {
                i.__pending = !1,
                i.img = e,
                t === l && (a(i.img),
                p(i))
            }
            ,
            e.onerror = function() {
                i.__pending = !1,
                t === l && setTimeout(c, 200)
            }
            ,
            e.src = i.url)
        };
        c();
        function t() {
            --l < 0 && (l = n.photos.length - 1),
            c()
        }
        function i() {
            ++l >= n.photos.length && (l = 0),
            c()
        }
        u.$(".left-arrow").click(t),
        u.$(".right-arrow").click(i);
        function e(e) {
            switch (e.which) {
            case 37:
                t();
                break;
            case 39:
                i()
            }
        }
        $document.on("keydown", e),
        u.onRemove(function() {
            $document.off("keydown", e),
            o()
        })
    }
    ,
    u
}
,
lilo.viewFactories["dialog-popularity"] = function(e, t) {
    var r = lilo.baseViewFactory(e, t)
      , l = r.$(".progress")
      , d = r.$(".left.round")
      , c = r.$(".center.round")
      , u = r.$(".right.round");
    return r.createViewModel = function(e) {
        var t = "#93278f"
          , i = e.rating || 0
          , n = Math.floor(i / 10)
          , o = n - 1
          , a = n + 1;
        o < 0 && (o = 0,
        n = 1,
        a = 2);
        var e = 10 * o
          , s = ((i = 0 === i ? 1 : i) - e) / (10 * a - e) * 100;
        100 < (s = s < 0 ? 0 : s) && (s = 100),
        l.css({
            width: "0%",
            background: t
        }),
        d.text(o).css({
            border: 0 <= s ? "1px solid " + t : ""
        }),
        c.text(n),
        u.text(a).css({
            border: 100 <= s ? "1px solid " + t : ""
        });
        r.animateProgress = function(e) {
            e = e || $.noop,
            50 < s ? (setTimeout(function() {
                c.css({
                    border: 50 <= s ? "2px solid " + t : ""
                })
            }, 2e3 - (s - 40) / 100 * 2e3),
            l.animate({
                width: s + "%"
            }, 2e3, e)) : l.animate({
                width: s + "%"
            }, 2e3, function() {
                c.css({
                    border: 50 <= s ? "2px solid " + t : ""
                }),
                e()
            })
        }
    }
    ,
    r
}
,
lilo.viewFactories["dialog-primary-offer"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.btn": function() {
            this.trigger("submit")
        }
    },
    t
}
,
lilo.viewFactories["dialog-purchase3"] = function(e, t) {
    var o, a = lilo.baseViewFactory(e, t);
    a.handlers = {
        "click@$.show-offers": function(e) {
            this.trigger("show-offers")
        }
    };
    var s, r = 1;
    function i(e) {
        return 48 <= e && e <= 57 || 96 <= e && e <= 105
    }
    function n(e) {
        return 8 === e || 46 === e
    }
    function l(e) {
        return 37 === e || 40 === e || 38 === e || 39 === e
    }
    function d(e) {
        e = e || {};
        var t = parseInt(a.els["ruby-input"].val(), 10)
          , i = !1;
        (!$.isNumeric(t) || t < 0) && (i = !0,
        t = 0),
        i && !e.withoutUpdateRuby && a.els["ruby-input"].val(t),
        a.els["coin-input"].html(2 * t)
    }
    return a.startTimer = function() {
        var t, i = a.model.stock, n = r += 1;
        i && (i.type === StockType.EXTRA_LIMITED_COINS ? setTimeout(function() {
            var i = function() {
                var e, t;
                a.isVisible && n === r && (e = "block" !== a.els.ruby.css("display") ? (t = [13, 78, 162, 910],
                2 * util.random(1e3, 2500)) : (t = [1, 9, 18, 16],
                2 * util.random(1e3, 5e3)),
                t = Math.max(a.viewModel.leftCoins - t[util.random(0, 3)], 0),
                a.viewModel.setAttr({
                    leftCoins: t
                }),
                0 < t && (clearTimeout(o),
                o = setTimeout(i, e)))
            };
            i()
        }, 1e3) : i.type === StockType.EXTRA_COINS_WITH_TIMER && (t = function() {
            var e = app.controllers.dialog.Purchase.calcStockLeftMillis(i);
            a.viewModel.setAttr({
                leftMillis: e
            }),
            0 !== e && a.isVisible ? s = setTimeout(t, 1e3) : 0 === e && app.eventBus.trigger(app.EVENTS.CHANGE_STOCK_LIST)
        }
        ,
        clearTimeout(s),
        t()))
    }
    ,
    a.setTheme = function(e) {
        $.each(window.StockTheme, function(e, t) {
            a.el.removeClass(t.className)
        });
        e = window.StockTheme[e];
        e && a.el.addClass(e.className)
    }
    ,
    a.createViewModel = function(e) {
        function t() {
            return i = i || {},
            a.el[i.type !== StockType.FIRST_PAYMENT ? "addClass" : "removeClass"]("v2"),
            a.setTheme(i.theme),
            {
                hasStock: !!e.stock,
                currencyGen: 2 === i.currency ? "рубинов" : "монет",
                dialogPurchaseTitle: i.dialogPurchaseTitle,
                stockType1: i.type === StockType.FIRST_PAYMENT,
                stockType2: i.type === StockType.EXTRA_LIMITED_COINS,
                stockType3: i.type === StockType.EXTRA_COINS_WITH_TIMER,
                stock5: 5 === i.type,
                leftCoins: i && i.leftCoins ? i.leftCoins : 0
            }
        }
        var i = e.stock
          , n = t();
        return n.leftMillis = 1,
        e.onChange("stock", function() {
            i = e.stock,
            a.viewModel.setAttr(t())
        }),
        n
    }
    ,
    a.els["ruby-input"].on("keydown", function(e) {
        i(e.which) || n(e.which) || l(e.which) || e.preventDefault()
    }).on("keypress", function(e) {
        var t;
        n(e.which) || l(e.which) || (t = this.value) && 6 <= t.length && e.preventDefault()
    }).on("keyup", function(e) {
        i(e.which) ? d() : 8 !== e.which && 46 !== e.which || d({
            withoutUpdateRuby: !0
        })
    }).on("change", d).on("focus", function() {
        "0" === this.value && (this.value = "")
    }).on("paste", function(e) {
        return e.preventDefault(),
        !1
    }).on("blur", function() {
        this.value || (this.value = "0")
    }).val(0),
    a.els["coin-input"].html(0),
    a.$(".do-exchange").click(function() {
        var e = parseInt(a.els["ruby-input"].val(), 10);
        0 < e && a.trigger("do-exchange", {
            ruby: e
        })
    }),
    a
}
,
lilo.viewFactories["dialog-recent-gifts"] = function(e, t) {
    var r = lilo.baseViewFactory(e, t);
    return r.createViewModel = function(e) {
        function s(e) {
            var t = document.createElement("div");
            return t.className = e || "",
            t
        }
        e.gifts.each(function(e, t) {
            var i = s("item-recent-gift")
              , n = s("img")
              , o = s("caption")
              , a = s("price");
            n.style.backgroundImage = "url(" + t.img + ")",
            o.innerHTML = t.title,
            a.innerHTML = t.price + '<i class="coin-icon-el"></i>',
            i.appendChild(n),
            i.appendChild(o),
            i.appendChild(a),
            r.els.gifts.append(i)
        })
    }
    ,
    r
}
,
lilo.viewFactories["dialog-referral"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.btn": function() {
            this.trigger("invite-friends")
        }
    },
    t.createViewModel = function(e) {
        return {
            bonus: Constants.BONUS_PER_REFERRAL
        }
    }
    ,
    t
}
,
lilo.viewFactories["dialog-resque-self"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.resque": function() {
            i.trigger("submit")
        }
    },
    i
}
,
lilo.viewFactories["dialog-resque-user"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.resque": function() {
            i.trigger("submit")
        }
    },
    i
}
,
lilo.viewFactories["dialog-room-gifts-for-beginner"] = function(e, t) {
    function s(e) {
        var t, i, n = $((t = "list",
        (i = document.createElement("div")).className = t || "",
        i));
        e.each(function(e, t) {
            var i;
            i = t,
            (t = lilo.createView(o.ITEM_VIEW_NAME)).setModel(i),
            n.append(t.el)
        }),
        o.els["gifts-container"].append(n)
    }
    var i, o = lilo.baseViewFactory(e, t), r = 0, n = {
        mouseWheelSpeed: util.jsScrollPaneSpeed(50),
        trackClickSpeed: util.jsScrollPaneSpeed(50)
    };
    return o.scrollToTabSublist = function(e) {}
    ,
    o.updateScroll = function() {
        var e;
        i ? i.reinitialise(n) : (o.els.scroll.height((e = 3 < r) ? 360 : 180).jScrollPane(n),
        i = o.els.scroll.data("jsp"),
        o.els.scroll.bind("mousewheel", function(e) {
            e.preventDefault()
        }),
        o.el[e ? "addClass" : "removeClass"]("large"))
    }
    ,
    o.setTabs = function(e, t) {
        t = 2 === (t = t || {}).targetUserSex;
        lilo.makeObservable(e);
        var i = []
          , n = {};
        e.each(function(e, t) {
            t.gifts.each(function(e, t) {
                n[t.id] || (n[t.id] = !0,
                i.push(t))
            })
        });
        var t = app.info.giftsOrder[function(e) {
            e = 2 === app.info.sex ? 2 === e ? 1 : 2 : 2 === e ? 3 : 4;
            return e
        }(t ? 2 : 1)]
          , o = [];
        t.each(function(e, t) {
            if (-15 === t._id)
                return o = t.g,
                !1
        });
        var a = {};
        o.each(function(e, t) {
            a[t] = e
        }),
        i.sort(function(e, t) {
            e = a[e.id] || 0,
            t = a[t.id] || 0;
            return e === t ? 0 : e < t ? -1 : 1
        }),
        s(i),
        r = i.length
    }
    ,
    o
}
,
lilo.viewFactories["dialog-room-gifts-v3"] = function(e, t) {
    function r(e) {
        var t = document.createElement("div");
        return t.className = e || "",
        t
    }
    function l(e) {
        var t = r("category-icon");
        return t.style.backgroundPosition = "0px " + -23 * e + "px",
        t
    }
    function d(e) {
        var t = r("sub-list-title")
          , n = $(r("sub-list"))
          , i = document.createElement("span")
          , o = [];
        t.appendChild(l(e.iconIndex)),
        t.appendChild(i),
        i.innerHTML = e.title,
        n.append(t),
        e.gifts.each(function(e, t) {
            var i;
            i = t,
            (t = lilo.createView(c.ITEM_VIEW_NAME)).setModel(i),
            o.push(t),
            n.append(t.el)
        }),
        c.els["gifts-container"].append(n),
        s.push({
            tabModel: e,
            $subListContainerEl: n
        })
    }
    var n, c = lilo.baseViewFactory(e, t), i = {
        mouseWheelSpeed: util.jsScrollPaneSpeed(50),
        trackClickSpeed: util.jsScrollPaneSpeed(50)
    }, s = [];
    return c.scrollToTabSublist = function(i) {
        s.each(function(e, t) {
            if (t.tabModel === i)
                return n && n.scrollToElement(t.$subListContainerEl, !0),
                !1
        })
    }
    ,
    c.updateScroll = function() {
        n ? n.reinitialise(i) : (c.els.scroll.height(434).jScrollPane(i),
        n = c.els.scroll.data("jsp"),
        c.els.scroll.bind("mousewheel", function(e) {
            e.preventDefault()
        })),
        c.els["gifts-wrap"].height(),
        s.each(function(e, t) {
            t.$subListContainerEl.topPosition = t.$subListContainerEl.position().top
        })
    }
    ,
    c.els.scroll.bind("jsp-scroll-y", function(e, n, t, i) {
        var o = 1e13
          , a = null;
        s.each(function(e, t) {
            var i = Math.abs(t.$subListContainerEl.topPosition - n);
            i < o && (o = i,
            n >= t.$subListContainerEl.topPosition - 100 && (a = t.tabModel))
        }),
        a || s.each(function(e, t) {
            if (0 < t.tabModel.gifts.length)
                return a = t.tabModel,
                !1
        }),
        a && c.trigger("select-tab-by-scroll", {
            model: a
        })
    }),
    c.el.on("click", ".btn-private-message", function() {
        c.trigger("send-private-message")
    }),
    c.setTabs = function(e) {
        lilo.makeObservable(e),
        e.each(function(e, t) {
            var i, n, o, a, o = (i = t,
            n = $(r("item-tab")),
            o = r("tab-caption"),
            a = l(i.iconIndex),
            o.innerHTML = i.title + " (" + i.gifts.length + ")",
            s(),
            i.onChange("selected", s),
            n.append(a).append(o).click(function() {
                c.trigger("tab-click", {
                    tab: i
                })
            }),
            n.click(function() {
                c.trigger("click-tab", {
                    model: i
                })
            }),
            n);
            function s() {
                n[i.selected ? "addClass" : "removeClass"]("selected")
            }
            c.els["tabs-container"].append(o),
            d(t)
        })
    }
    ,
    c
}
,
lilo.viewFactories["dialog-room-list"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.left-arr": function() {
            this.trigger("show-prev")
        },
        "click@$.right-arr": function() {
            this.trigger("show-next")
        },
        "click@$.btn": function() {
            this.trigger("submit")
        },
        "click@$.btns span": function(e) {
            e = $(e.target);
            e.hasClass("selected") || this.trigger("sort", {
                sort: e.attr("sort_by")
            })
        }
    },
    t.createViewModel = function(e) {
        var t = {
            canSubmit: i()
        };
        function i() {
            return !e.lock && e.selectedRoom
        }
        function n() {
            t.setAttr({
                canSubmit: i()
            })
        }
        var o = (new Date).getHours()
          , a = 22 < o || o < 10
          , o = function() {
            $.each(e.items, function(e, t) {
                var i = 0
                  , n = 0;
                $.each(t.users, function(e, t) {
                    t.male ? i++ : n++
                }),
                3 === t.accessDescr.type || 4 === t.accessDescr.type || 5 === t.accessDescr.type || 6 === t.accessDescr.type ? t.isNotEnough = !1 : t.isNotEnough = !a && (i < 3 || n < 3) && !t.roomId.startWith("10_")
            })
        };
        return e.items.on("add", "self", o),
        o(),
        e.onChange("lock", n),
        e.onChange("selectedRoom", n),
        t
    }
    ,
    t
}
,
lilo.viewFactories["dialog-room-popularity"] = function(e, t) {
    var r = lilo.baseViewFactory(e, t)
      , l = r.$(".gifts-rating")
      , d = null
      , c = null;
    return r.createViewModel = function(e) {
        e.isDJ ? r.el.addClass("is-dj") : e.isFortunate ? r.el.addClass("is-fortunate") : e.isPopular ? r.el.addClass("is-popular") : r.el.addClass("is-wasteful");
        var t, i, n, o, a, s = e.isWin;
        1 === e.users.length ? (o = e.users[0],
        i = e.isPopular ? (l.text(o.male ? "Популярный" : "Популярная"),
        t = "Поздравляем, Вы {0} в комнате!".format(o.male ? "Самый Популярный" : "Самая Популярная"),
        d) : e.isWasteful ? (l.text(o.male ? "Щедрый" : "Щедрая"),
        t = "Поздравляем, Вы {0} в комнате!".format(o.male ? "Самый Щедрый" : "Самая Щедрая"),
        d) : e.isFortunate ? (l.text(o.male ? "Удачливый" : "Удачливая"),
        t = "Поздравляем, Вы {0} в комнате!".format(o.male ? "Самый Удачливый" : "Самая Удачливая"),
        d) : (t = "Поздравляем, Вы DJ в комнате!",
        c)) : (n = e.users[0],
        o = e.users[1],
        s ? (i = e.isPopular ? (l.text(o.male ? "Популярный" : "Популярная"),
        a = n.male ? "Популярный" : "Популярная",
        t = "Теперь Вы {0} в комнате!".format(n.male ? "Самый Популярный" : "Самая Популярная"),
        d) : e.isWasteful ? (l.text(o.male ? "Щедрый" : "Щедрая"),
        a = n.male ? "Щедрый" : "Щедрая",
        t = "Теперь Вы {0} в комнате!".format(n.male ? "Самый Щедрый" : "Самая Щедрая"),
        d) : e.isFortunate ? (l.text(o.male ? "Удачливый" : "Удачливая"),
        a = n.male ? "Удачливый" : "Удачливая",
        t = "Теперь Вы {0} в комнате!".format(n.male ? "Самый Удачливый" : "Самая Удачливая"),
        d) : (t = "Теперь Вы DJ в комнате!",
        c),
        s = !0) : t = e.isPopular ? (l.text(n.male ? "Популярный" : "Популярная"),
        a = o.male ? "Популярный" : "Популярная",
        "У Вас отобрали звание {0}".format(n.male ? "Самого Популярного" : "Самой Популярной")) : e.isWasteful ? (l.text(n.male ? "Щедрый" : "Щедрая"),
        a = o.male ? "Щедрый" : "Щедрая",
        "У Вас отобрали звание {0}!".format(o.male ? "Самого Щедрого" : "Самой Щедрой")) : e.isFortunate ? (l.text(n.male ? "Удачливый" : "Удачливая"),
        a = o.male ? "Удачливый" : "Удачливая",
        "У Вас отобрали звание {0}!".format(o.male ? "Самого Удачливого" : "Самой Удачливой")) : "У Вас отобрали звание DJ!",
        a && setTimeout(function() {
            l.text(a)
        }, 1700)),
        r.$(".dialog-header").text(t),
        r.el.addClass(1 === e.users.length ? "one-user" : "two-users"),
        i && setTimeout(function() {
            var e = document.createElement("div");
            e.innerHTML = i,
            e.className = "hint",
            r.el.append(e)
        }, 1 === e.users.length ? 1e3 : 1700),
        setTimeout(function() {
            r.el.addClass("animate")
        }, 1 === e.users.length ? 100 : 1e3),
        s && r.el.addClass("is-win")
    }
    ,
    r
}
,
lilo.viewFactories["dialog-room-private-message-v2"] = function(e, t) {
    function i() {
        var e = n();
        N.trigger("submit", {
            text: e
        })
    }
    var N = lilo.baseViewFactory(e, t)
      , n = function() {
        var e = L.createAndParseResultText()
          , t = L.getLastEnteredEmoji();
        return o(s, t),
        setTimeout(function() {
            app.eventBus.trigger(app.EVENTS.UPDATE_RECENT_EMOJI, {
                emojiHash: s
            })
        }, 100),
        e
    };
    N.handlers = {
        "click@$.anonymous-btn": function() {
            N.model.setAttr({
                sendAnonymous: !N.model.sendAnonymous
            })
        },
        "click@$.ok": function() {
            i()
        },
        "click@$.private-message-option": function(e) {
            this.trigger("again", {
                type: parseInt(e.currentTarget.getAttribute("type"))
            })
        },
        "click@$.take-photo": function() {
            this.trigger("take-photo")
        },
        "click@$.remove-photo-preview": function() {
            this.trigger("remove-photo-preview")
        },
        "click@$.toggle-ban": function(e) {
            this.trigger("toggle-ban", {
                $btnEl: $(e.currentTarget)
            })
        },
        "keypress@$textarea": function(e) {
            if (13 === e.which)
                return e.preventDefault(),
                e.stopPropagation(),
                i(),
                !1
        },
        "click@$.cancel": function(e) {
            this.trigger("do-cancel", {
                text: n()
            }),
            this.trigger("close")
        },
        "click@$.open-profile": function(e) {
            this.trigger("open-profile")
        }
    };
    var a = "recentEmoji-v3"
      , s = {};
    function o(i, e) {
        s = i = i || s;
        var n = [];
        (e = e || []).each(function(e, t) {
            i[t] = (i[t] || 0) + 1
        }),
        $.each(i, function(e, t) {
            n.push({
                emojiCode: e,
                counter: t
            })
        }),
        n = n.sort(function(e, t) {
            return e.counter === t.counter ? 0 : e.counter > t.counter ? -1 : 1
        }),
        util.lStorage.save(a, JSON.stringify(i));
        var o = [];
        return n.each(function(e, t) {
            o.push(t.emojiCode)
        }),
        o
    }
    N.renderRecentEmoji = function() {
        var e = util.lStorage.find(a);
        e && ((e = o(JSON.parse(e))).length = Math.min(e.length, 15),
        N.els["recent-emoji"].empty(),
        e.each(function(e, t) {
            N.els["recent-emoji"].append(app.controllers.Emoji.createImgNode(t))
        }))
    }
    ,
    N.renderRecentEmoji();
    var r = app.sdk.viewComponents.togglePopupBtn(N.$(".send-again-btn"), N.$(".private-message-select-popup "));
    N.onRemove(function() {
        r.dispose()
    });
    var U = N.$(".textarea")
      , L = new app.controllers.ContentEditableController({
        $input: U,
        maxLength: 200,
        $placeHolderEl: N.$(".placeholder")
    });
    U.on("keydown", function(e) {
        if (L.isPrintableKeyCode(e.which) && L.maxLengthIsReached())
            return e.preventDefault(),
            !1
    });
    var t = N.$(".toggle-emoji")
      , l = lilo.createView("emoji-popup-2");
    t.append(l.el),
    setTimeout(function() {
        l.updateScroll()
    }, 100);
    var d = app.sdk.viewComponents.togglePopupBtn(t, l.el, {
        onOpen: function() {
            l.updateScroll()
        }
    });
    N.onRemove(function() {
        d.dispose()
    });
    function c(e) {
        L.maxLengthIsReached() || L.insertEmoji(e)
    }
    return N.el.on("click", ".recent-emoji-list .emoji", function(e) {
        e = e.currentTarget.getAttribute("code");
        c(e)
    }),
    N.el.on("mousedown mouseup click", ".recent-emoji-list .emoji", util.cancelEvent),
    t.on("mousedown mouseup click", util.cancelEvent),
    l.bind("add-emoji", function(e) {
        c(e.extraData.code)
    }),
    N.createViewModel = function(e) {
        e.onChange("sendAnonymous", function() {
            N.el[e.sendAnonymous ? "addClass" : "removeClass"]("anonym-bg"),
            e.type === _.TYPE_GOLD ? S.header.html(e.sendAnonymous ? "Золотая валентинка" : "Золотое сообщение*") : S.header.html(e.sendAnonymous ? "Новая валентинка" : "Новое сообщение")
        });
        var t, i, n, o, a, s, r, l, d, c, u, p = !1, f = e.senderAvatar, m = e.viewerAvatar, v = e.viewerVF, h = e.viewerFullName, g = e.senderFullName, b = e.senderVF, C = app.PrivateMessageState, _ = app.PrivateMessageType, w = "add-message", E = "add-answer", y = "review", D = [E, w, y].join(" "), T = N.el, S = N.els, A = e.__privateMessage, I = e.type === _.P2P_INVITE, M = !1;
        u = e.type === _.TYPE_GOLD || e.type === _.TYPE_GOLD_RECEIVED,
        I = e.type === _.P2P_INVITE,
        A.state ? A.state === C.STATE_REQUEST ? (T.removeClass(D).addClass(E),
        S.header.html(u ? "Вам золотое сообщение" : "Вам приватное сообщение"),
        -1 === A.from && A.z1 && (S.header.html("Ответ на валентинку"),
        f = CDN_PREFIX + "iconfinder_heart-arrow_2903242.svg",
        b = !(g = "Анонимно"),
        N.el.addClass("is-anonymous")),
        n = t = "Ответить",
        o = i = "Закрыть",
        I && (S.header.html("Приглашение в чат"),
        s = 0,
        (r = function() {
            var e;
            !N.isVisible && 5 == ++s || (clearTimeout(a),
            e = util.serverUtc() - A.requestTs,
            11e4 < e ? (N.els.header.append("<div class='sub-header-red'>Время ответа истекло. Приглашение устарело</div>"),
            S.btnOk.removeClass("green").html(t),
            S.btnCancel.removeClass("red2").html(i)) : (S.btnOk.addClass("green"),
            S.btnCancel.addClass("red2"),
            n = "Принять",
            o = "Отклонить",
            a = setTimeout(r, 1e3)))
        }
        )()),
        S.top.hide(),
        S.bottom.show(),
        S.form.show(),
        S.btnOk.css("display", "inline-block").text(n),
        S.btnCancel.css("display", "inline-block").text(o),
        S.btnAgain.hide(),
        S.label.show(),
        S.delimiter.show(),
        S.cross.remove()) : (T.removeClass(D).addClass(y),
        S.top.show(),
        S.header.html(I ? "Ответ на ваше приглашение" : "Ответ на ваше сообщение"),
        c = function() {
            var e = N.$(".no-answer")
              , t = A.p2pStatus;
            1 === t ? e.html("Приглашение принято! Скоро вы будете перенаправлены в переговорную комнату").addClass("white-msg") : 2 == t ? e.html("Приглашение отклонено.").addClass("red-msg") : 3 == t && e.html("Приглашение устарело, пользователь проспал ответ").addClass("red-msg"),
            e.show()
        }
        ,
        e.sentText || e.sentBase64 ? (S.bottom.show(),
        I && c()) : (d = N.$(".no-answer"),
        A.state === C.STATE_RESPONSE_REMOVE ? (l = I ? A.readed ? "Пользователь удалил ваше приглашение, прочитав его" : "Пользователь удалил ваше приглашение, не прочитав" : A.readed ? "Пользователь удалил ваше сообщение, прочитав его" : "Пользователь удалил ваше сообщение, не прочитав",
        d.html(l)) : I && c(),
        d.show(),
        S.bottom.hide()),
        S.form.hide(),
        S.btnOk.hide(),
        S.btnCancel.css("display", "inline-block").text("Закрыть"),
        !I || 2 === A.p2pStatus ? S.btnAgain.css("display", "inline-block") : S.btnAgain.hide(),
        S.label.hide(),
        S.cross.remove(),
        A.z1 && (S.header.html("Ответ на валентинку"),
        m = CDN_PREFIX + "iconfinder_heart-arrow_2903242.svg",
        v = !1,
        h = "Анонимно",
        N.el.addClass("is-reply-anonymous"))) : (T.removeClass(D).addClass(w),
        S.top.hide(),
        S.bottom.hide(),
        S.label.hide(),
        S.form.show(),
        l = new Date(2022,1,6),
        c = new Date(2022,1,17),
        d = +new Date,
        p = l < d && d < c,
        c = I ? "Пригласить" : "Отправить",
        e.price && (c += " " + e.price,
        2 === e.currency ? c += "<span class='smart-ruby'></span>" : c += "<span class='smart-coin'></span>"),
        S.btnOk.css("display", "inline-block").html(c).removeClass("white").addClass("green"),
        S.btnAgain.hide(),
        e.type === _.TYPE_GOLD ? (S.header.html("Золотое сообщение*").addClass("header-envelope-gold"),
        S["gold-message-hint"].show()) : e.type === _.P2P_INVITE ? S.header.html("Приглашение в чат").addClass("header-envelope-video") : S.header.html("Новое сообщение").addClass("header-envelope-regular"),
        N.els.btnCancel.remove(),
        M = !0),
        u && N.el.addClass("has-gold-bg"),
        I && N.el.addClass("p2p-invite");
        function O() {
            return [A.from, A.to].filter(function(e) {
                return A.owner !== e
            })[0]
        }
        function x() {
            return A.state === C.STATE_REQUEST && !(-1 === A.from && A.z1)
        }
        function R() {
            if (!A.id)
                return !1;
            var e = O();
            return !app.info.blockedUids[e] && x()
        }
        function k() {
            if (!A.id)
                return !1;
            var e = O();
            return !!app.info.blockedUids[e] && x()
        }
        var P = {
            senderVF: b,
            senderFullName: g,
            viewerVF: v,
            viewerFullName: h,
            viewerAvatar: m,
            senderAvatar: f,
            showAnonymousCheck: p && !e.isFreePrivateMessage,
            price: e.type === app.PrivateMessageType.TYPE_GOLD ? 3 : 1,
            canUnban: k(),
            canBan: R(),
            has10Level: 10 <= expController.getCurrentLevel()
        };
        return e.onChange("hasBan", function() {
            P.setAttr({
                canUnban: k(),
                canBan: R()
            })
        }),
        setTimeout(function() {
            I ? M && (L.editableFocus(),
            L.insertHTML("Привет. Приглашаю тебя в Видео чат!"),
            L.handlePlaceholder(),
            U.blur()) : L.editableFocus()
        }, 150),
        P
    }
    ,
    N
}
,
lilo.viewFactories["dialog-room-questions"] = function(e, t) {
    var n = lilo.baseViewFactory(e, t);
    return n.showLoader = function() {
        n.els.loader.show()
    }
    ,
    n.createViewModel = function(e) {
        e = e.questions,
        $.each(e, function(e, t) {
            var i = $(document.createElement("div")).text(t.text).click(function() {
                n.trigger("select-question", {
                    questionId: t.id
                })
            });
            n.els.list.append(i)
        })
    }
    ,
    n
}
,
lilo.viewFactories["dialog-select-photos"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = i.$(".content");
    return i.handlers = {
        "click@$.show-albums": function() {
            i.trigger("show-albums")
        },
        "click@$.submit": function() {
            i.trigger("submit")
        }
    },
    i.showSlide = function(i) {
        i--,
        n.each(function(e, t) {
            t.style.display = e === i ? "block" : "none"
        })
    }
    ,
    i.createViewModel = function(t) {
        function e() {
            var e = t.maxSelectedPhotosSize - t.selectedPhotosSize;
            return {
                leftValue: "{0} {1}".format(e, util.pluralize(e, "фотографию", "фотографии", "фотографий"))
            }
        }
        var i = e();
        return t.onChange("selectedPhotosSize", function() {
            i.setAttr(e())
        }),
        i
    }
    ,
    i
}
,
lilo.viewFactories["dialog-select-region"] = function(e, t) {
    var n = lilo.baseViewFactory(e, t);
    return n.el.on("click", ".btn", function(e) {
        n.trigger("submit")
    }),
    n.createViewModel = function(e) {
        e.regions.on("add", function() {
            n.els["regions-list"].scrollTop(0)
        });
        function t() {
            return e.isCountryWithRegions ? "3." : "2."
        }
        var i = {
            number: t()
        };
        return e.onChange("isCountryWithRegions", function() {
            i.setAttr({
                number: t()
            })
        }),
        i
    }
    ,
    n.scrollToRegion = function(e) {
        n.els["regions-list"].scrollTop(23 * e)
    }
    ,
    n.scrollToCountry = function(e) {
        n.els["countries-list"].scrollTop(23 * e)
    }
    ,
    n
}
,
lilo.viewFactories["dialog-self-room-control"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.item-action": function(e) {
            this.trigger("do-action", {
                action: $(e.target).attr("action")
            })
        }
    },
    t
}
,
lilo.viewFactories["dialog-shooter-range"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.submit": function() {
            i.trigger("submit")
        },
        "click@$.clear": function() {
            i.trigger("clear")
        }
    },
    i
}
,
lilo.viewFactories["dialog-simple"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.createViewModel = function(e) {
        e.title || this.$(".head").hide(),
        e.message || this.$(".message").hide()
    }
    ,
    t
}
,
lilo.viewFactories["dialog-special-users"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , a = i.$(".result-list");
    i.handlers = {
        "click@$.delete": function(e) {
            var t = parseInt(e.currentTarget.getAttribute("uid"), 10);
            return this.trigger("delete", {
                uid: t,
                targetEl: e.currentTarget
            }),
            e.stopPropagation(),
            e.preventDefault(),
            !1
        },
        "click@$.item": function(e) {
            var t = parseInt(e.currentTarget.getAttribute("uid"), 10);
            return this.trigger("open-profile", {
                uid: t,
                targetEl: e.currentTarget
            }),
            e.stopPropagation(),
            e.preventDefault(),
            !1
        }
    };
    var n, o = {
        mouseWheelSpeed: util.jsScrollPaneSpeed(50),
        trackClickSpeed: util.jsScrollPaneSpeed(50)
    };
    function s() {
        var s = document.createDocumentFragment();
        $.each(i.model.resultArray, function(e, t) {
            var i = document.createElement("div")
              , n = document.createElement("div")
              , o = document.createElement("div")
              , a = document.createElement("div");
            i.className = "item",
            n.className = "avatar",
            a.className = "full-name",
            o.className = "delete",
            i.setAttribute("uid", t.id),
            o.setAttribute("uid", t.id),
            n.style.backgroundImage = "url(" + t.avatar + ")",
            a.innerHTML = util.escapeHtml(t.fullName),
            o.innerHTML = "Удалить",
            i.appendChild(n),
            i.appendChild(a),
            i.appendChild(o),
            s.appendChild(i)
        }),
        a.empty().append(s),
        n ? n.reinitialise(o) : (i.els.scroll.jScrollPane(o),
        n = i.els.scroll.data("jsp"))
    }
    return i.createViewModel = function(t) {
        var i = {
            hasResult: 0 < t.resultArray.length
        };
        return t.resultArray.on("add", "self", function() {
            i.setAttr({
                hasResult: 0 < t.resultArray.length
            }),
            s()
        }),
        t.resultArray.on("removeAll", "self", function() {
            i.setAttr({
                hasResult: 0 < t.resultArray.length
            }),
            s()
        }),
        t.resultArray.on("remove", "self", function(e) {
            var o = [];
            e.newValue.each(function(e, n) {
                a.children().each(function(e, t) {
                    var i = parseInt(t.getAttribute("uid"), 10);
                    return n.id === i && o.push(t),
                    !1
                })
            }),
            o.each(function(e, t) {
                t.parentNode && t.parentNode.removeChild(t)
            }),
            i.setAttr({
                hasResult: 0 < t.resultArray.length
            }),
            s()
        }),
        i
    }
    ,
    i
}
,
lilo.viewFactories["dialog-stickers-editor"] = function(e, t) {
    var d = lilo.baseViewFactory(e, t);
    return d.el.on("click", ".save", function() {
        d.trigger("save")
    }),
    d.el.on("click", ".cancel", function() {
        dialogController.close(d)
    }),
    d.createViewModel = function(l) {
        function e() {
            var e = l.toDocumentFragment();
            t.empty().append(e)
        }
        var t = d.$(".result");
        e(),
        l.onChange("*", e),
        function() {
            var s = d.$(".settings")
              , t = [];
            [["Прическа", "hairId", "hairColor", "hair"], ["Борода", "beardId", "beardColor", "beards"], ["Цвет волос", "hairColor", 2 === l.v ? ["#212121", "#df9d59", "#743e1f"] : ["#312a26", "#df9d59", "#6b2f27", "#cf5b1b"]], ["Цвет бороды", "beardColor", ["#212121", "#df9d59", "#743e1f"]], ["Цвет глаз", "eyeColor", 2 === l.v ? ["#75a4cc", "#6b3124", "#7eb327", "#809393"] : ["#71b0d6", "#6b3124", "#7eb327", "#809393"]], ["Цвет одежды", "bodyColor", 2 === l.v ? ["#5275a7", "#677b21", "#cfcfcf", "#d47e0f"] : ["#75a4cc", "#81992c", "#ee0166", "#b0b0b0", "#d47e0f"]]].each(function(e, o) {
                var i;
                util.isDef(l[o[1]]) && (i = {
                    caption: o[0],
                    propertyName: o[1],
                    items: [],
                    eqComparator: function(e) {
                        return l[this.propertyName] === e.value
                    }
                },
                $.isArray(o[2]) ? o[2].each(function(e, t) {
                    i.items.push({
                        value: e,
                        getCss: function() {
                            return {
                                backgroundColor: t,
                                borderRadius: "100px",
                                border: "5px solid transparent",
                                width: "24px",
                                height: "24px",
                                backgroundClip: "content-box"
                            }
                        }
                    })
                }) : (i.observeProperty = o[2],
                "beardId" === o[1] && i.items.push({
                    value: -1,
                    getElement: function() {
                        return document.createElement("div")
                    }
                }),
                util.repeat(5, function(n) {
                    i.items.push({
                        value: n,
                        getElement: function() {
                            if ("hairId" !== o[1] || 2 !== l.v)
                                return e = l.getUrl(o[3], l[o[2]], n),
                                t = document.createElement("div"),
                                $.extend(t.style, {
                                    backgroundImage: "url(" + e + ")",
                                    backgroundPosition: "center",
                                    backgroundSize: "100% 100%",
                                    backgroundRepeat: "no-repeat"
                                }),
                                t;
                            var e = l.getUrl("hair-back", l[o[2]], n)
                              , t = document.createElement("div");
                            $.extend(t.style, {
                                backgroundImage: "url(" + e + ")",
                                backgroundPosition: "center",
                                backgroundSize: "100% 100%",
                                backgroundRepeat: "no-repeat"
                            });
                            var e = l.getUrl(o[3], l[o[2]], n)
                              , i = document.createElement("div");
                            return $.extend(i.style, {
                                backgroundImage: "url(" + e + ")",
                                backgroundPosition: "center",
                                backgroundSize: "100% 100%",
                                backgroundRepeat: "no-repeat"
                            }),
                            t.appendChild(i),
                            t
                        }
                    })
                })),
                t.push(i))
            });
            function r(e, t) {
                var i = document.createElement("div");
                return e && (i.className = e),
                t && (i.innerHTML = t),
                i
            }
            t.each(function(e, o) {
                function t() {
                    var n = document.createDocumentFragment();
                    o.items.each(function(e, t) {
                        var i;
                        t.getElement ? (i = t.getElement()).className += " item" : (i = r("item"),
                        $.extend(i.style, t.getCss())),
                        o.eqComparator(t) && (i.className += " selected"),
                        i.onclick = function() {
                            d.trigger("change-property", {
                                propertyName: o.propertyName,
                                value: t.value
                            })
                        }
                        ,
                        n.appendChild(i)
                    }),
                    a.innerHTML = "",
                    a.appendChild(n)
                }
                var i = r()
                  , n = r("caption", o.caption + ":")
                  , a = r("items");
                t(),
                l.onChange(o.propertyName, t),
                l.onChange("id", t),
                o.observeProperty && l.onChange(o.observeProperty, t),
                i.appendChild(n),
                i.appendChild(a),
                s.append(i)
            })
        }()
    }
    ,
    d
}
,
lilo.viewFactories["dialog-stickers-super-victor-preview"] = function(e, t) {
    var a = lilo.baseViewFactory(e, t);
    return a.el.on("click", ".btn", function() {
        a.trigger("close")
    }),
    a.createViewModel = function(i) {
        var n = [];
        i.items.each(function(e, t) {
            n.push(CDN_PREFIX + "stickers/" + i.path + "/stick" + (t - 1) + "/base/color0/0.png")
        });
        var o = a.els.wrap[0];
        n.each(function(e, t) {
            var i = document.createElement("div");
            i.className = "item",
            i.style.backgroundImage = "url(" + t + ")",
            o.appendChild(i)
        })
    }
    ,
    a
}
,
lilo.viewFactories["dialog-stock-preview"] = function(e, t) {
    var a = lilo.baseViewFactory(e, t);
    return a.startTimer = function() {
        var t, o = a.model;
        o.type === StockType.EXTRA_COINS_WITH_TIMER ? (t = function() {
            var e = app.controllers.dialog.Purchase.calcStockLeftMillis(o);
            a.viewModel.setAttr({
                leftMillis: e
            }),
            0 < e && a.isVisible && setTimeout(t, 1e3)
        }
        )() : o.type === StockType.EXTRA_LIMITED_COINS && setTimeout(function() {
            var t, i;
            i = 1 === o.currency ? (t = [13, 78, 162, 910],
            2 * util.random(1e3, 2500)) : (t = [1, 9, 18, 16],
            2 * util.random(1e3, 5e3));
            var n = function() {
                var e;
                a.isVisible && (e = Math.max(a.viewModel.leftCoins - t[util.random(0, 3)], 0),
                a.viewModel.setAttr({
                    leftCoins: e
                }),
                0 < e && setTimeout(n, i))
            };
            n()
        }, 1e3)
    }
    ,
    a.setTheme = function(e) {
        $.each(window.StockTheme, function(e, t) {
            a.el.removeClass(t.className)
        });
        e = window.StockTheme[e];
        e && a.el.addClass(e.className)
    }
    ,
    a.createViewModel = function(e) {
        return a.setTheme(e.theme),
        e.type === StockType.FIRST_PAYMENT ? a.el.addClass("stock-first-payment") : a.el.addClass("normal-stock"),
        {
            currencyGen: 1 === e.currency ? "монет" : "рубинов",
            leftMillis: 1,
            leftCoins: e.type === StockType.EXTRA_LIMITED_COINS ? e.leftCoins : 0,
            stockType1: e.type === StockType.FIRST_PAYMENT,
            stockType2: e.type === StockType.EXTRA_LIMITED_COINS,
            stockType3: e.type === StockType.EXTRA_COINS_WITH_TIMER
        }
    }
    ,
    a
}
,
lilo.viewFactories["dialog-subscribe"] = function(e, t) {
    var d = lilo.baseViewFactory(e, t);
    return d.handlers = {
        "click@$.cancel": function() {
            this.trigger("cancel")
        },
        "click@$.ok": function() {
            var e = parseInt(d.$("input[name=period]:checked").val(), 10);
            this.trigger("ok", {
                description: d.model.descriptions[e]
            })
        }
    },
    d.createViewModel = function(e) {
        var l = !0;
        $.each(e.descriptions, function(e, t) {
            var n, i, o, a, s, r;
            t.checkBoxes ? (i = d.els.descriptions[0],
            o = t.checkBoxes,
            a = document.createElement("div"),
            s = document.createElement("div"),
            (r = document.createElement("div")).className = "checkboxes-horizontal",
            s.className = "descr-sub-title",
            s.innerHTML = o.title,
            o.list.each(function(e, t) {
                var i = document.createElement("label")
                  , n = document.createElement("input")
                  , o = document.createElement("span");
                i.appendChild(n),
                i.appendChild(o),
                n.type = "checkbox",
                n.checked = t.value,
                t.disabled && (n.disabled = !0),
                n.onchange = function() {
                    t.onchange(n.checked)
                }
                ,
                o.innerHTML = t.text,
                r.appendChild(i),
                i.className = "checkbox-label"
            }),
            a.appendChild(s),
            a.appendChild(r),
            i.appendChild(a)) : (n = document.createElement("div"),
            o = document.createElement("label"),
            s = document.createElement("input"),
            i = document.createElement("span"),
            a = document.createElement("span"),
            (t.subTitles || []).each(function(e, t) {
                var i = document.createElement("div");
                i.className = "descr-sub-title",
                i.innerHTML = t.text,
                t.__css && $(i).css(t.__css),
                n.appendChild(i)
            }),
            s.type = "radio",
            s.name = "period",
            s.value = e + "",
            i.innerHTML = t.title,
            i.className = "item-title",
            t.voices ? (util.isOKPlatform() ? a.innerHTML = "{0} OK".format(7 * t.price) : a.innerHTML = "{0} {1}".format(t.price, util.pluralize(t.price, "голос", "голоса", "голосов")),
            a.className = "price voices") : t.rubies ? (a.innerHTML = t.price,
            a.className = "price rubies") : (a.innerHTML = t.price,
            a.className = "price"),
            l && (l = !1,
            s.setAttribute("checked", "true")),
            n.appendChild(o),
            o.appendChild(s),
            o.appendChild(i),
            o.appendChild(a),
            o.className = "label",
            d.els.descriptions.append(n))
        })
    }
    ,
    d
}
,
lilo.viewFactories["dialog-subscription-settings"] = function(e, t) {
    var s = lilo.baseViewFactory(e, t);
    s.el.on("click", ".extend-period", function() {
        s.trigger("extend-period")
    }),
    s.el.on("click", ".save", function() {
        s.trigger("save")
    }),
    s.el.on("click", ".cancel", function() {
        dialogController.close(s)
    }),
    s.createExpirationText = function(e) {
        return "Режим невидимки доступен до " + e
    }
    ;
    function a(e, t) {
        return (e = document.createElement(e || "div")).className = t || "",
        e
    }
    return s.applyDescr = function(e) {
        e.each(function(e, t) {
            var i, n, o;
            t.option ? function(n) {
                var e = document.createElement("div");
                e.className = "option " + (n.className || "");
                var t = document.createElement("label");
                t.className = "control label-block";
                var i = document.createElement("input");
                i.className = "left-side {0}".format(n.checkBoxClassName || ""),
                i.type = "checkbox",
                i.checked = !!n.checked,
                i.onchange = function() {
                    n.onchange(i.checked)
                }
                ,
                n.checkBoxEl = i;
                var o = document.createElement("div");
                o.className = "option-title",
                o.innerHTML = n.title;
                var a = document.createElement("div");
                a.className = "option-descr",
                n.descriptions && n.descriptions.each(function(e, t) {
                    var i = 1 < n.descriptions.length ? e + 1 + ". " : ""
                      , e = document.createElement("div");
                    e.innerHTML = i + t,
                    a.appendChild(e)
                }),
                e.appendChild(t),
                t.appendChild(i),
                t.appendChild(o),
                t.appendChild(a),
                s.els.options.append(e)
            }(t.option) : t.header ? s.$(".gray-header").html(t.header) : t.subTitle ? t.subTitle.$el ? s.els.options.append(t.subTitle.$el.addClass("sub-title")) : t.subTitle.text && ((i = a("div", "sub-title")).innerHTML = t.subTitle.text,
            s.els.options.append(i)) : t.hint ? ((i = a("div", "hint")).innerHTML = t.hint.text,
            s.els.options.append(i)) : t.expirationText ? (n = s.$(".expiration"),
            (o = function() {
                n.html(t.expirationText.format(moment(s.model.expirationTs).format("Do MMMM YYYY")))
            }
            )(),
            s.model.onChange("expirationTs", o)) : t.expirationTextUpdater ? (n = s.$(".expiration"),
            (o = function() {
                t.expirationTextUpdater(s.model.expirationTs, n)
            }
            )(),
            s.model.onChange("expirationTs", o)) : t.extendPrice && s.$(".extend-price").html(t.extendPrice)
        })
    }
    ,
    s
}
,
lilo.viewFactories["dialog-success-purchase"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".btn", function() {
        dialogController.close(i)
    }),
    i
}
,
lilo.viewFactories["dialog-success-purchase-stock"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".btn", function() {
        dialogController.close(i)
    }),
    i.createViewModel = function(e) {
        2 === e.item.currency && i.el.addClass("ruby")
    }
    ,
    i
}
,
lilo.viewFactories["dialog-tickets"] = function(e, t) {
    var n = lilo.baseViewFactory(e, t)
      , o = n.$(".progress");
    return n.handlers = {
        "click@$.cancel": function() {
            this.trigger("cancel")
        },
        "click@$.results": function() {
            this.trigger("results")
        },
        "click@$.rules": function() {
            this.trigger("rules")
        }
    },
    n.createViewModel = function(i) {
        function e() {
            var e, t = i.tickets && i.total;
            n.els.chance.css("display", t ? "block" : "none"),
            t && (e = i.tickets,
            t = Math.max(i.total, e),
            (e = Math.round(t / e)) < 100 ? e = 100 : e -= e % 100,
            n.els.chance.html("Всего билетов участвует: <b>{0}</b><br>Вероятность выигрыша <b>1</b> на <b>{1}</b>".format(i.total, e)))
        }
        return e(),
        i.onChange("total", e),
        i.onChange("tickets", e),
        o.css("width", i.progress + "%"),
        {
            hint: "Нужно " + i.left + " опыта до след.билета"
        }
    }
    ,
    n
}
,
lilo.viewFactories["dialog-tickets-complete"] = function(e, t) {
    t = lilo.baseViewFactory(e, t),
    t.$(".progress");
    return t.handlers = {
        "click@$.cancel": function() {
            this.trigger("cancel")
        },
        "click@$.results": function() {
            this.trigger("results")
        }
    },
    t
}
,
lilo.viewFactories["dialog-tickets-results"] = function(e, t) {
    var n = lilo.baseViewFactory(e, t)
      , o = n.$(".progress");
    return n.handlers = {
        "click@$.cancel": function() {
            this.trigger("cancel")
        },
        "click@$.results": function() {
            this.trigger("results")
        },
        "click@$.rules": function() {
            this.trigger("rules")
        }
    },
    n.createViewModel = function(i) {
        function e() {
            var e, t = i.tickets && i.total;
            n.els.chance.css("display", t ? "block" : "none"),
            t && (e = i.tickets,
            t = Math.max(i.total, e),
            (e = Math.round(t / e)) < 100 ? e = 100 : e -= e % 100,
            n.els.chance.html("Всего билетов участвует: <b>{0}</b><br>Вероятность выигрыша <b>1</b> на <b>{1}</b>".format(i.total, e)))
        }
        return e(),
        i.onChange("total", e),
        i.onChange("tickets", e),
        o.css("width", i.progress + "%"),
        {
            hint: "Нужно " + i.left + " опыта до след.билета"
        }
    }
    ,
    n
}
,
lilo.viewFactories["dialog-toggle-deposits"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".save", function() {
        i.trigger("save", {
            checked: i.els.checkbox.prop("checked")
        })
    }),
    i.createViewModel = function(e) {
        i.els.checkbox.prop("checked", e.isChecked)
    }
    ,
    i
}
,
lilo.viewFactories["dialog-toggle-vk-levels"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".save", function() {
        i.trigger("save", {
            checked: i.els.checkbox.prop("checked")
        })
    }),
    i.createViewModel = function(e) {
        i.els.checkbox.prop("checked", e.checked),
        e.disabled && i.$(".option-title").css("color", "#ccc"),
        i.els.checkbox.prop("disabled", e.disabled)
    }
    ,
    i
}
,
lilo.viewFactories["dialog-toggle-vklink-access"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".save", function() {
        i.trigger("save", {
            checked: i.els.checkbox.prop("checked")
        })
    }),
    i.createViewModel = function(e) {
        i.els.checkbox.prop("checked", e.checked),
        e.disabled && i.$(".option-title").css("color", "#ccc"),
        i.els.checkbox.prop("disabled", e.disabled)
    }
    ,
    i
}
,
lilo.viewFactories["dialog-verification-photo"] = function(e, t) {
    var s = lilo.baseViewFactory(e, t)
      , n = s.$(".content");
    s.el.on("click", ".btn", function(e) {
        s.trigger(e.currentTarget.getAttribute("action"))
    }),
    s.showSlide = function(i) {
        i--,
        n.each(function(e, t) {
            t.style.display = e === i ? "block" : "none"
        })
    }
    ;
    var o = s.$(".result-image-wrap");
    return s.createViewModel = function(a) {
        a.onChange("resultImg", function() {
            var i = a.resultImg ? "<div class='result-image' style='background-image:url(" + a.resultImg + ")'></div>" : "";
            o.each(function(e, t) {
                t.innerHTML = i
            })
        });
        function e() {
            var e, t, i, n, o = a.viewerAvatarWithRect;
            o && (e = o.__image,
            t = o.rect,
            n = (i = document.createElement("img")).style,
            i.setAttribute("src", e.src),
            o = t.width / 176,
            n.marginLeft = -t.x / o + "px",
            n.marginTop = -t.y / o + "px",
            n.width = e.width / o + "px",
            n.height = e.height / o + "px",
            s.els["avatar-rect"].html("").append(i))
        }
        a.onChange("viewerAvatarWithRect", e),
        e()
    }
    ,
    s
}
,
lilo.viewFactories["dialog-verification-status"] = function(e, t) {
    var o = lilo.baseViewFactory(e, t);
    o.el.on("click", ".btn", function(e) {
        o.trigger(e.currentTarget.getAttribute("action"))
    });
    function i() {
        o.$("[h-visible]").each(function(e, t) {
            var i = t.hasAttribute("inverse");
            t.style.display = function(e, t) {
                for (var i = e.getAttribute(t).split(","), n = 0; n < i.length; n += 1)
                    if (a[i[n]] === o.model.status)
                        return !0
            }(t, "h-visible") ? i ? "none" : "block" : i ? "block" : "none"
        }),
        o.$("[h-class-completed]").each(function(e, t) {
            for (var i = t.getAttribute("h-class-completed").split(","), n = 0; n < i.length; n += 1)
                a[i] <= o.model.status && (t.className += " completed")
        })
    }
    function n() {
        var e = o.model.photo
          , t = o.model.status === a.VERIFICATION_PHOTO_CONFIRMED;
        switch (o.model.status) {
        case a.VERIFICATION_PHOTO_CONFIRMED:
        case a.VERIFICATION_PHOTO_ON_MODERATION:
        case a.VERIFICATION_PHOTO_REJECTED:
            e ? (o.els["photo-send-to-moderation"].hide(),
            2 === e.s ? o.$('[h-visible="PHOTO_ON_MODERATION"]').show() : 3 === e.s ? (o.$('[h-class-completed="PHOTO_CONFIRMED"]').addClass("completed"),
            t && (o.$('[h-visible="VERIFIED,PHOTO_CONFIRMED"]').show(),
            o.model.setAttr({
                verificationError: "У вас отображается аватарка ВК"
            }),
            o.$('[h-visible="PHOTO_CONFIRMED"]').show())) : 4 === e.s && o.$('[h-visible="PHOTO_REJECTED"]').show()) : window.selfProfileController && window.selfProfileController.photosController && window.selfProfileController.photosController.canAddFirstPhoto() && o.model.status !== a.VERIFICATION_PHOTO_REJECTED && o.els["photo-send-to-moderation"].show()
        }
    }
    var t = 1
      , a = {
        INITIAL: t++,
        VERIFICATION_PHOTO_ON_MODERATION: t++,
        VERIFICATION_PHOTO_REJECTED: t++,
        VERIFICATION_PHOTO_CONFIRMED: t++,
        PHOTO_ADDED: t++,
        PHOTO_ON_MODERATION: t++,
        PHOTO_REJECTED: t++,
        PHOTO_CONFIRMED: t++,
        VERIFIED: 9
    };
    return o.createViewModel = function(e) {
        e.onChange("status", i),
        e.onChange("photo", n)
    }
    ,
    o
}
,
lilo.viewFactories["dialog-webcam"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.take-photo": function() {
            i.trigger("take-photo")
        }
    },
    i
}
,
lilo.viewFactories["dialog-wf-exchange"] = function(e, t) {
    var d = lilo.baseViewFactory(e, t);
    return d.createViewModel = function(e) {
        function t(e) {
            d.trigger("search", {
                word: e
            })
        }
        function i() {
            t(o.val())
        }
        var n, o = d.$("input");
        o.on("keypress", function() {
            clearTimeout(n),
            n = setTimeout(i, 500)
        }),
        o.on("keydown", function() {
            o.val() ? (clearTimeout(n),
            n = setTimeout(i, 500)) : t("")
        }),
        o.on("keyup", function() {
            o.val() || t("")
        });
        var a, s = {
            mouseWheelSpeed: util.jsScrollPaneSpeed(50),
            trackClickSpeed: util.jsScrollPaneSpeed(50)
        };
        function r() {
            a ? a.reinitialise(s) : (d.els.scroll.height(370).jScrollPane(s),
            a = d.els.scroll.data("jsp"))
        }
        r();
        var l;
        e.friendsResultList.on("add", "self", function() {
            clearTimeout(l),
            l = setTimeout(r, 100)
        })
    }
    ,
    d
}
,
lilo.viewFactories["dialog-wf-gift"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.send-to-friends": function() {
            i.trigger("send-to-friends")
        },
        "click@$.take": function() {
            i.trigger("take")
        },
        "click@$.dismiss": function() {
            i.trigger("dismiss")
        }
    },
    i
}
,
lilo.viewFactories["dialog-wf-rg"] = function(e, t) {
    var a = lilo.baseViewFactory(e, t);
    return a.createViewModel = function(e) {
        var t, i = {
            mouseWheelSpeed: util.jsScrollPaneSpeed(50),
            trackClickSpeed: util.jsScrollPaneSpeed(50)
        };
        function n() {
            t ? t.reinitialise(i) : (a.els.scroll.height(420).jScrollPane(i),
            t = a.els.scroll.data("jsp"))
        }
        n();
        var o;
        e.items.on("add", "self", function() {
            clearTimeout(o),
            o = setTimeout(n, 100)
        })
    }
    ,
    a
}
,
lilo.viewFactories["dialog-wf-spins-deficit"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["dialog-wheel-of-fortune"] = function(e, t) {
    function f(e) {
        var t = document.createElement("div");
        return t.className = e || "",
        t
    }
    var m = lilo.baseViewFactory(e, t);
    return m.showWin = function(e, t) {
        var i = f("win-value-wrap")
          , n = f("title")
          , o = f("content")
          , a = f("value")
          , s = f("spin-gift-icon")
          , r = f("free-spins-icon")
          , l = f("coin");
        n.innerHTML = "Вы выиграли:",
        o.appendChild(a),
        e.freeSpins ? (a.innerHTML = e.freeSpins,
        o.appendChild(r)) : e.spinGifts ? (a.innerHTML = e.spinGifts,
        o.appendChild(s)) : (a.innerHTML = e.bonus,
        o.appendChild(l)),
        i.appendChild(n),
        i.appendChild(o),
        m.els.win.empty().append(i).css("opacity", "0"),
        m.els.win.fadeTo(300, 1, t)
    }
    ,
    m.hideWin = function() {
        m.els.win.empty()
    }
    ,
    m.goodLuck = function() {
        var e = f("good-luck");
        m.els.win.empty().append(e)
    }
    ,
    m.ready = function() {
        var e = f("make-spin");
        m.els.win.empty().append(e)
    }
    ,
    m.niceGame = function() {
        var e = f("nice-game");
        m.els.win.empty().append(e)
    }
    ,
    m.createViewModel = function(i) {
        i.onChange("power", function() {
            m.els.power.removeClass("no-transition"),
            m.els.power.css("width", parseInt(i.power / 100 * 131, 10) + "px")
        });
        var e, n, o, t, a = m.stageInstance;
        e = m.$(".start-spin"),
        n = !1,
        o = 0,
        t = function() {
            n && (i.setAttr({
                power: function(e) {
                    e < 300 ? e = 0 : e -= 300;
                    e = e * e * 3e-4;
                    return e = 100 < (e = 10 * Math.floor(e / 10)) ? 100 : e
                }(util.currentMillis() - o)
            }),
            setTimeout(t, 70))
        }
        ,
        e.mousedown(function(e) {
            i.spinDisabled || a.isStarted() || (n = !0,
            i.setAttr({
                power: 0
            }),
            o = util.currentMillis(),
            t())
        }),
        e.mouseup(function(e) {
            var t;
            i.spinDisabled || (a.isStarted() ? a.stop() : (n && ((t = util.currentMillis() - o) < 300 && i.setAttr({
                power: 10 * util.random(5, 10)
            }),
            m.trigger("start-spin", {
                power: i.power,
                millisOfBtnPress: t
            })),
            n = !1))
        }),
        e.mouseout(function(e) {
            i.spinDisabled || a.isStarted() || (n = !1)
        });
        var u, p = 0;
        function s() {
            var c = document.createDocumentFragment();
            i.dailyItems.each(function(e, t) {
                var i, n, o, a, s = f("daily-item"), r = f("time"), l = f("bonus"), d = f("caption");
                d.style.backgroundPosition = "0px {0}px".format(-16 * t.dayTextIndex),
                l.innerHTML = t.bonus + "<span class='bonus-icon'></span>",
                t.isComplete && (s.className += " completed",
                i = f("icon-complete"),
                s.appendChild(i)),
                t.isTargetDay ? (i = f("wrap"),
                s.className += " is-target",
                n = t.millis - util.currentMillis(),
                o = r,
                a = function() {
                    o.innerHTML = util.formatMillisToTime(n, function(e, t, i) {
                        return e + ":" + t + ":" + i
                    }),
                    !m.isVisible && 30 <= (p += 1) || -1e3 !== (n -= 1e3) && (n < 0 && (n = 0),
                    u = setTimeout(a, 1e3))
                }
                ,
                clearTimeout(u),
                p = 0,
                a(),
                i.appendChild(l),
                i.appendChild(d),
                i.appendChild(r),
                s.appendChild(i)) : (s.appendChild(l),
                s.appendChild(d)),
                c.appendChild(s)
            }),
            m.els["daily-info"].empty().append(c)
        }
        s(),
        i.dailyItems.on("add", "self", s)
    }
    ,
    m
}
,
lilo.viewFactories["dialog-win-in-room-top-list"] = function(e, t) {
    var r = lilo.baseViewFactory(e, t);
    return r.createViewModel = function(e) {
        var t = {
            hint: "Вы собрали <b>{0}</b> из <b>5</b> за {1} место!".format(e.placeProgress, 3 === e.place ? "3-e" : e.place + "-oe")
        };
        2 === e.currency && r.el.addClass("ruby"),
        r.el.css("background-image", "url({0})".format(e.bgImg));
        for (var i, n, o = r.$(".progress"), a = 1; a <= 5; a += 1) {
            var s = document.createElement("span");
            s.style.backgroundImage = "url(" + e.smallPlaceImg + ")",
            e.placeProgress >= a || (s.className = "disabled"),
            o.append(s)
        }
        return (5 < e.place || e.isTopWithoutProgress) && r.$(".extra").remove(),
        "wpthh" !== e.topId && !e.isExtraBonus || (n = (i = r.$(".title")).find("b"),
        i.empty().append(n),
        e.isExtraBonus && n.css("font-size", "22px")),
        t
    }
    ,
    r
}
,
lilo.viewFactories["dialog-window"] = function(e, t) {
    e = lilo.baseViewFactory(e, t);
    e.handlers = {
        "click@close": function(e) {
            this.trigger("close")
        },
        "click@$.close-dialog": function(e) {
            this.trigger("close"),
            e.preventDefault(),
            e.stopPropagation()
        }
    };
    var s = isMobi ? 0 : 70
      , r = isMobi ? 35 : 15
      , l = t.staticTop
      , d = t.minTopOffset
      , c = {
        left: 0,
        top: 0,
        width: 0,
        height: 0
    };
    return e.toCenter = function(e, t, i, n) {
        var o = this.dialog.el
          , a = o.outerWidth()
          , o = o.outerHeight();
        n = d || (util.isDef(n) ? n : r),
        c.top = l || (s < e ? e - s + n : n),
        c.width = a,
        c.height = o;
        n = parseInt(this.els.dialogWrap.css("padding-left"), 10),
        n = isNaN(n) ? 10 : n,
        o = parseInt(this.els.dialogWrap.css("border-left-width"), 10),
        o = isNaN(n) ? 10 : o;
        c.left = -a / 2 - (n + o),
        this.els.dialogWrap.css(c)
    }
    ,
    e.getTotalHeight = function() {
        return c.height = this.dialog.el.outerHeight(),
        this.els.dialogWrap.css(c),
        c.top + c.height + 100
    }
    ,
    e.close = function() {
        this.dialog && (this.dialog.detachWhenRemove ? this.dialog.el.detach() : this.dialog.remove()),
        this.remove()
    }
    ,
    e
}
,
lilo.viewFactories["dialog-window-mobi"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@close": function(e) {
            this.trigger("click-close"),
            this.trigger("close"),
            e.preventDefault(),
            e.stopPropagation()
        },
        "click@$.close-dialog": function(e) {
            this.trigger("close"),
            e.preventDefault(),
            e.stopPropagation()
        },
        "click@$.close-button-container": function(e) {
            this.trigger("close"),
            e.preventDefault(),
            e.stopPropagation()
        }
    },
    t.toCenter = function(e, t, i, n) {}
    ,
    t.getTotalHeight = function() {
        return 0
    }
    ,
    t.close = function() {
        this.dialog && (this.dialog.detachWhenRemove ? this.dialog.el.detach() : this.dialog.remove()),
        this.remove()
    }
    ,
    t
}
,
lilo.viewFactories["dialog-yt-preview"] = function(e, t) {
    var p = lilo.baseViewFactory(e, t);
    return p.handlers = {
        "click@$.volume-on": function() {
            p.trigger("off-volume")
        },
        "click@$.volume-off": function() {
            p.trigger("on-volume")
        },
        "click@$.play": function() {
            p.trigger("play")
        },
        "click@$.pause": function() {
            p.trigger("pause")
        }
    },
    p.createViewModel = function(t) {
        function e() {
            var e = t.preview;
            p.el.css("backgroundImage", e ? "url(" + e + ")" : "")
        }
        e();
        function i(e, t, i) {
            return t + ":" + i
        }
        function n() {
            d.slider("value", Math.floor(1e3 * t.progress / t.duration)),
            l.html(util.formatMillisToTime(Math.min(t.progress + 1e3, t.duration), i) + " / " + u)
        }
        function o() {
            c.slider("value", t.volume)
        }
        var a, s, r, l = p.$(".progress-text"), d = p.$(".progress-control").empty().slider({
            step: 1,
            min: 0,
            max: 1e3,
            range: "min",
            value: t.progress,
            slide: function(e, t) {
                clearTimeout(a),
                a = setTimeout(function() {
                    p.trigger("change-progress", {
                        value: t.value / 1e3
                    })
                }, 100)
            }
        }), c = p.$(".volume-control").empty().slider({
            step: 1,
            min: 0,
            max: 100,
            range: "min",
            value: t.volume,
            slide: function(e, t) {
                clearTimeout(a),
                setTimeout(function() {
                    p.trigger("change-volume", {
                        value: t.value
                    })
                }, 100)
            }
        }), u = util.formatMillisToTime(t.duration, i);
        t.onChange("progress", function() {
            clearTimeout(s),
            s = setTimeout(n, 50)
        }),
        t.onChange("volume", function() {
            clearTimeout(r),
            r = setTimeout(o, 50)
        }),
        t.onChange("preview", e)
    }
    ,
    p
}
,
lilo.viewFactories["dialog-yt-tracks"] = function(e, t) {
    var l = lilo.baseViewFactory(e, t)
      , i = l.$(".loader");
    return l.handlers = {
        "click@$.add-track-by-link": function() {
            l.trigger("add-track-by-link")
        }
    },
    l.showLoader = function(e) {
        i.html(e = "<span>" + (e || "&nbsp;") + "</span>").show(),
        l.el.addClass("pending")
    }
    ,
    l.hideLoader = function() {
        i.hide(),
        l.el.removeClass("pending")
    }
    ,
    l.createViewModel = function(t) {
        l.el.addClass("youtube");
        function e() {
            var e;
            i || !t.hasTags || (e = util.cache.find("yt_video_tags")) && e.length && (i = !0)
        }
        var i = !1;
        e(),
        t.onChange("hasTags", e);
        var n, o = 1, a = !1;
        function s(e) {
            a || (e = $.trim(e || "").toLowerCase(),
            n !== e && (n = e,
            a = !0,
            setTimeout(function() {
                a = !1
            }, 250),
            o++,
            l.trigger("search-yt-track", {
                key: e,
                searchId: o
            })))
        }
        var r = l.$("input");
        return r.on("keydown", function(e) {
            13 === e.which && s(r.val())
        }),
        l.el.find("[do-search]").click(function() {
            s(r.val())
        }),
        l.$(".buttons").remove(),
        {
            selectedModel: null
        }
    }
    ,
    l
}
,
lilo.viewFactories["emoji-form"] = function(e, t) {
    var c = lilo.baseViewFactory(e, t)
      , s = app.controllers.Emoji
      , n = "stickers-was-open"
      , t = app.controllers.dialog.Stickers
      , u = t.Configuration
      , p = t.SET_TYPE
      , r = t.getFolderOfSetType
      , i = !1
      , o = {
        mouseWheelSpeed: util.jsScrollPaneSpeed(50),
        trackClickSpeed: util.jsScrollPaneSpeed(50)
    }
      , l = !1
      , a = !1
      , f = "recentStickersTab_" + +new Date;
    function d() {
        a && (a = !1,
        c.els["popup-stickers"].hide(),
        c.el.removeClass(n))
    }
    function m() {
        var e, t, n, o, a;
        l || (c.els.popup.show(),
        l = !0,
        i || (i = !0,
        n = 0,
        o = s.getAllHexCodes().array,
        (a = function() {
            var i, e = o.slice(n, n + 90);
            n += 90,
            e.length ? (i = document.createDocumentFragment(),
            $.each(e, function(e, t) {
                i.appendChild(s.createImgNode(t))
            }),
            c.els.scroll.append(i),
            _(),
            setTimeout(a, 400)) : ((e = document.createElement("div")).className = "clear-recent-emoji",
            e.onclick = function() {
                c.trigger("clear-recent-emoji")
            }
            ,
            e.innerHTML = "Очистить часто используемые смайлы",
            c.els.scroll.append(e),
            _())
        }
        )()),
        e = 0,
        (t = function() {
            e < 5 && l && (_(),
            e++,
            setTimeout(t, 1e3))
        }
        )(),
        d())
    }
    function v() {
        l && (c.els.popup.hide(),
        l = !1)
    }
    function h() {
        c.els.recent.empty();
        var i = c.model.hasSubscribe ? isMobi ? 6 : 8 : 0;
        $.each(c.model.__recentItems, function(e, t) {
            return e < i && void c.els.recent.append(s.createImgNode(t))
        })
    }
    c.closePopup = function() {
        d()
    }
    ,
    c.hideEmojiPopup = function() {
        v()
    }
    ;
    var g, b, C = {};
    function _() {
        g ? g.reinitialise(o) : (c.els.popup.jScrollPane(o),
        g = c.els.popup.data("jsp"),
        c.els.popup.append($('<div class="lock-overlay"><span class="buy-emoji">Разблокировать сразу</span></div>')))
    }
    function w() {
        b ? b.reinitialise(o) : (c.els["scroll-stickers"].jScrollPane(o),
        b = c.els["scroll-stickers"].data("jsp"))
    }
    var E = {};
    function y(e) {
        var a, s, n, o, t, i, r, l, d = c.viewModel.tabId;
        (a = !e ? E[d] : a) && d !== f || (a = document.createElement("div"),
        s = function() {
            var e = parseInt(this.getAttribute("item-id"), 10)
              , t = parseInt(this.getAttribute("tab-id"), 10);
            c.trigger("add-sticker", {
                id: e,
                tabId: t
            })
        }
        ,
        n = function(e) {
            var t = e.toDocumentFragment()
              , i = document.createElement("div")
              , n = document.createElement("div")
              , o = document.createElement("div");
            o.innerHTML = "1<i class='coin-icon-el'></i>",
            i.setAttribute("item-id", e.id + ""),
            i.setAttribute("tab-id", e.v + ""),
            i.className = "item-sticker",
            n.className = "sticker-wrap",
            o.className = "sticker-price",
            n.appendChild(t),
            i.appendChild(n),
            i.appendChild(t),
            i.appendChild(o),
            a.appendChild(i),
            i.onclick = s
        }
        ,
        d === p.GIRL || d === p.BOY ? (o = 2 === u.getViewerConfig().v ? [3, 1, 2, 0, 7, 5, 6, 4, 11, 9, 10, 8, 15, 13, 14, 12] : [0, 8, 9, 10, 11, 12, 13, 14, 15, 1, 2, 3, 4, 5, 6, 7],
        [1, 15, 2, 3, 7, 5, 9, 8, 6, 12, 13, 14, 16, 4, 11, 10].each(function(e, t) {
            var i = o[t - 1]
              , t = u.getViewerConfig(i, d);
            t.id = i,
            n(t)
        })) : (t = 0,
        i = null,
        d === p.MEM ? t = 28 : d === p.MEM2 ? (t = 24,
        i = [20, 21, 22, 23, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]) : d === p.NICHOSI ? t = 6 : d === p.SNEZHOK || d === p.CIPA ? t = 20 : d === p.HARLEY ? t = 16 : d === p.HALLOWEEN || d === p.ZOLOTOI ? t = 20 : d === p.FENEK ? t = 24 : d === p.KOKO || d === p.ZAZA || d === p.RED_PANDA ? t = 20 : d === p.SIBU ? (i = [0, 1, 20, 21, 22, 23, 24, 25, 26, 27, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19],
        t = 28) : d === p.KHASKI ? t = 20 : d === p.KOALA_GIRL ? t = 16 : d === p.EZH ? t = 20 : d === p.DANCE_MALE || d === p.DANCE_FEMALE ? (t = 17,
        i = [10, 11, 12, 13, 14, 15, 16, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9]) : d === p.DANCE_RESULT ? t = 17 : d === p.SKANI || d === p.B_BO || d === p.KATERINA || d === p.STALIN || d === p.PINGVI ? t = 20 : d === p.KOALA_MAN || d === p.F_2016 ? t = 16 : d === p.COMBO_MALE || d === p.COMBO_FEMALE ? t = 20 : d === p.ZABIVAKA ? t = 16 : d === p.RED_CAT ? t = 20 : d === p.HRU ? t = 16 : d === p.TEDDY ? t = 20 : d === p.PUTIN_23 ? t = 12 : d === p.ZVEREK ? (t = 22,
        i = [0, 21, 20, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]) : d === p.CAT1 || d === p.CAT2 ? (t = 22,
        i = [],
        util.repeat(t, function(e) {
            1 === e ? i.push(t - 1) : 0 === e ? i.push(e) : i.push(e - 1)
        })) : d === p.MUZHIK ? i = [0, 1, 2, 3, t = 16, 17, 18, 19, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15] : d === p.SEXY_GIRL && (t = 20),
        d === f ? (r = 0,
        c.model.__recentStickers.each(function(e, t) {
            var i = t.parsedConfig || (t.parsedConfig = JSON.parse(t.v))
              , t = i.v
              , i = i.id;
            if (C[t]) {
                t = u.getViewerConfig(i, t);
                if (t.id = i,
                n(t),
                20 === (r += 1))
                    return !1
            }
        }),
        0 < r && a.appendChild(((e = document.createElement("div")).className = "clear-recent-stickers gray-button",
        e.onclick = function() {
            c.trigger("clear-recent-stickers")
        }
        ,
        e.innerHTML = "Очистить часто используемые стики",
        e))) : (l = function(e) {
            var t = u.getViewerConfig(e, d);
            t.id = e,
            n(t)
        }
        ,
        i ? i.each(function(e, t) {
            l(t)
        }) : util.repeat(t, l)))),
        E[d] = a,
        c.els["stickers-container"].empty().append(a),
        w()
    }
    c.renderRecentEmoji = h;
    function D() {
        var i = !1;
        return c.model.__recentStickers.each(function(e, t) {
            t = (t.parsedConfig || (t.parsedConfig = JSON.parse(t.v))).v;
            if (C[t])
                return !(i = !0)
        }),
        i
    }
    c.renderRecentStickersIfNeed = function() {
        c.viewModel.setAttr({
            hasRecentStickers: D()
        }),
        c.viewModel.tabId === f && y(!0)
    }
    ,
    c.el.on("click", ".buy-emoji", function(e) {
        c.trigger("buy")
    }),
    c.el.on("click", ".emoji", function(e) {
        e = e.currentTarget.getAttribute("code");
        c.trigger("add-emoji", {
            code: e
        }),
        d()
    }),
    c.el.on("click mousedown mouseup", ".emoji", util.cancelEvent),
    c.el.on("click", ".emoji-popup,.popup-stickers", function(e) {
        return e.stopPropagation(),
        !1
    }),
    c.el.on("click", ".sticker-settings", function(e) {
        return e.stopPropagation(),
        (new app.controllers.dialog.Stickers).openEditor(),
        !1
    }),
    c.el.on("click", ".open-emoji-popup", function(e) {
        return e.stopPropagation(),
        (l ? v : m)(),
        !1
    }),
    c.el.on("click mousedown mouseup", ".open-emoji-popup", util.cancelEvent),
    c.el.on("click", ".open-stickers-popup", function(e) {
        var t, i;
        return e.stopPropagation(),
        a ? d() : a || (a = !0,
        c.els["popup-stickers"].show(),
        c.el.addClass(n),
        y(),
        t = 0,
        (i = function() {
            t < 5 && a && (w(),
            t++,
            setTimeout(i, 1e3))
        }
        )(),
        v()),
        !1
    }),
    $contextArea.on("click", function() {
        d(),
        v()
    }),
    c.createViewModel = function(e) {
        var n = {
            stickersIsEditable: !1,
            tabId: 1 === app.info.sex ? p.GIRL : p.BOY,
            hasRecentStickers: !1
        };
        lilo.makeObservable(n);
        var o = []
          , t = [];
        t.push(f);
        new Date,
        new Date(2021,1,12,6,0,0,0);
        t.push(app.info.sex),
        t.push(1 === app.info.sex ? p.DANCE_FEMALE : p.DANCE_MALE),
        t.push(1 === app.info.sex ? p.COMBO_FEMALE : p.COMBO_MALE),
        t.push(p.TEDDY),
        t.push(p.HRU),
        t.push(p.RED_CAT),
        t.push(p.SIBU),
        t.push(p.PINGVI),
        t.push(1 === app.info.sex ? p.KATERINA : p.STALIN),
        t.push(p.B_BO),
        t.push(p.SKANI),
        t.push(p.EZH),
        t.push(1 === app.info.sex ? p.KOALA_GIRL : p.KOALA_MAN),
        t.push(p.KHASKI),
        t.push(p.RED_PANDA),
        t.push(p.ZAZA),
        1 === app.info.sex && t.push(p.HARLEY),
        t.push(p.KOKO),
        t.push(p.FENEK),
        t.push(p.ZOLOTOI),
        t.push(p.CIPA),
        t.push(p.SNEZHOK),
        t.push(p.ZVEREK),
        t.push(p.CAT1),
        2 === app.info.sex ? t.push(p.MUZHIK) : 1 === app.info.sex && 17 < app.info.age && t.push(p.SEXY_GIRL),
        t.push(p.MEM),
        t.push(p.MEM2),
        2 === app.info.sex && t.push(p.F_2016),
        t.push(p.PUTIN_23);
        var i = function() {
            c.els["sticker-tabs"].empty(),
            o.length = 0,
            t.each(function(e, t) {
                if (t === f) {
                    if (!n.hasRecentStickers)
                        return;
                    i = "url(" + CDN_PREFIX + "stickers/popular-stick-icon.png)"
                } else
                    i = "url(" + CDN_PREFIX + "stickers/" + r(t) + "/icon.png?v=1)",
                    C[t] = !0;
                var i = $(document.createElement("div")).addClass("item-sticker-tab").css({
                    backgroundImage: i
                });
                i.tabId = t,
                c.els["sticker-tabs"].append(i),
                i.click(function() {
                    n.tabId !== t && n.setAttr({
                        tabId: t
                    })
                }),
                t === n.tabId && i.addClass("selected"),
                o.push(i)
            }),
            app.sdk.viewComponents.stickersSlider({
                $container: c.els["sticker-tabs"],
                itemWidth: 43,
                btnWidth: 43,
                maxItems: 5
            }),
            n.hasRecentStickers || n.tabId !== f || n.setAttr({
                tabId: 1 === app.info.sex ? p.GIRL : p.BOY
            })
        };
        i(),
        n.onChange("hasRecentStickers", i),
        n.setAttr({
            hasRecentStickers: D()
        });
        var a = !0
          , i = function() {
            var e = n.tabId === p.GIRL || n.tabId === p.BOY;
            n.setAttr({
                stickersIsEditable: e
            }),
            o.each(function(e, t) {
                t[t.tabId === n.tabId ? "addClass" : "removeClass"]("selected")
            }),
            a ? a = !1 : y(1)
        };
        return i(),
        n.onChange("tabId", i),
        e.onChange("hasSubscribe", function() {
            h()
        }),
        n
    }
    ,
    app.eventBus.on(app.EVENTS.STICKER_CONFIG_CHANGED, function() {
        y(!0)
    });
    function T(e) {
        c.els["popup-stickers"][10 <= e ? "removeClass" : "addClass"]("stickers-disabled")
    }
    return T(expController.getCurrentLevel()),
    app.eventBus.on(app.EVENTS.VIEWER_LEVEL_CHANGED, function(e) {
        T(e.level)
    }),
    c.el.on("mousewheel", function(e) {
        e.preventDefault()
    }),
    c
}
,
lilo.viewFactories["emoji-popup-2"] = function(e, t) {
    function a() {
        return "block" === s.el.css("display")
    }
    var i, s = lilo.baseViewFactory(e, t), r = app.controllers.Emoji, n = {
        mouseWheelSpeed: util.jsScrollPaneSpeed(50),
        trackClickSpeed: util.jsScrollPaneSpeed(50)
    };
    function l() {
        i ? i.reinitialise(n) : (s.els.scroll.jScrollPane(n),
        i = s.els.scroll.data("jsp"))
    }
    var d = !1
      , c = !1;
    s.el.on("click", ".emoji", function(e) {
        e = e.currentTarget.getAttribute("code");
        s.trigger("add-emoji", {
            code: e
        })
    }),
    s.el.on("click mousedown mouseup", ".emoji", util.cancelEvent);
    var u = !1;
    return s.updateScroll = function() {
        var t, n, o;
        c || (c = !0,
        t = 0,
        n = app.controllers.Emoji.getAllHexCodes().array,
        (o = function() {
            var i, e = n.slice(t, t + 55);
            t += 55,
            e.length ? (i = document.createDocumentFragment(),
            $.each(e, function(e, t) {
                i.appendChild(r.createImgNode(t))
            }),
            s.els.container.append(i),
            a() && l(),
            setTimeout(o, 200)) : d = !0
        }
        )()),
        d && !u && a() && (u = !0,
        l())
    }
    ,
    s.el.on("mousewheel", function(e) {
        e.preventDefault()
    }),
    s.el.on("click", util.cancelEvent),
    s
}
,
lilo.viewFactories["evaluation-photo"] = function(e, t) {
    function s(e) {
        var t = document.createElement("div");
        return t.className = e ? r.id + "-" + e : "",
        t
    }
    var r = lilo.baseViewFactory(e, t)
      , l = (app.info.sex,
    ["Класс", "Супер", "Влюбляет", "Сексуально", "Круто", "Удивительно"])
      , d = r.$("." + r.id + "-likes");
    return util.repeat(5, function(t) {
        var e = 1 < ++t ? 1 : 0
          , i = l[t - 1]
          , n = CDN_PREFIX + "/likes/" + t + ".png?v=1"
          , o = s("like")
          , a = s("like-title");
        o.style.backgroundImage = "url(" + n + ")",
        a.innerHTML = "<div>" + i + "</div>",
        o.appendChild(a),
        0 < e && ((a = s("like-price")).innerHTML = e + "<div class='smart-coin'><div>",
        o.appendChild(a)),
        !!!app.commonState.verified && 1 === t || (d.append(o),
        o.onclick = function(e) {
            r.trigger("like", {
                type: t,
                $loadingEl: d,
                browserEvent: e
            })
        }
        )
    }),
    r.createViewModel = function(o) {
        var a = new Image;
        a.onload = function() {
            var e = util.fit(a.width, a.height, 636, 184)
              , t = document.createElement("img")
              , i = s("img-content")
              , n = i.style;
            n.left = e.x + "px",
            n.top = e.y + "px",
            n.width = e.w + "px",
            n.height = e.h + "px",
            (n = t.style).width = e.w + "px",
            n.height = e.h + "px",
            t.setAttribute("src", o.photoUrl),
            i.appendChild(t),
            r.$("." + r.id + "-img-wrap").append(i),
            r.el.removeClass("loading"),
            i.onclick = function() {
                r.trigger("img-click")
            }
        }
        ;
        function e() {
            r.el[0 < o.likeType ? "addClass" : "removeClass"]("has-like")
        }
        e(),
        o.onChange("likeType", e),
        a.src = o.photoUrl
    }
    ,
    r
}
,
lilo.viewFactories["exchange-friends-header"] = function(e, t) {
    function i(e) {
        return "3ruby" === e ? ["«Помоги мне, зайди в игру по этой ссылке, за это мне дадут 3 рубина", "«Привет. У меня просьба, зайди, пожалуйста, в эту игру, мне за это дадут бонус 3 рубина", "Прости что беспокою, потратить пару секунд, если не трудно, зайди в эту игру, за это мне дадут бонус 3 рубина", "Удели мне пару секунд, зайди, пожалуйста, в эту игру, за это я получу бонус 3 рубина", "Выдели мне несколько секунд своего времени, зайди если не трудно в эту игру, за это я получу 3 игровых рубина", "Привет. Прости если отвлекаю, не мог бы ты потратить пару секунд, и зайти в эту игру, за это я получу подарок в игре"] : ["Помоги мне, установи игру по этой ссылке, за это мне дадут {0}".format("10 монет"), "Привет. У меня просьба, установи, пожалуйста, эту игру, мне за это дадут бонус {0}".format("10 монет"), "Прости что беспокою,  потрать пару секунд, если не сложно,  и установить эту игру, за это мне дадут бонус {0}".format("10 игровых монет"), "Удели мне пару секунд, установи, пожалуйста,  эту игру, за это я получу бонус {0}".format("10 монет"), "Выдели мне несколько секунд своего времени, установи если не трудно эту игру, за это я получу бесплатно {0}".format("10 игровых монет")]
    }
    var n = lilo.baseViewFactory(e, t)
      , o = util.createAppLink({
        queryParams: {
            mid: app.info.viewer_id
        },
        protocol: "https"
    })
      , a = n.$("input").val(o)
      , s = i();
    return n.$(".exp-rate-value").html(Constants.FRIENDS_EXCHANGE_EXP_RATE),
    n.createViewModel = function(e) {
        s = i(e.bonusType)
    }
    ,
    n.copyTextToBuffer = function(e) {
        e = e || {};
        function t() {
            var e = 0 <= navigator.platform.toUpperCase().indexOf("MAC");
            window.prompt("Чтобы скопировать нажмите: {0}, Enter".format(e ? "Cmd+C" : "Ctrl+C"), i)
        }
        var i = s[util.random(0, s.length - 1)] + " " + o;
        try {
            a.val(i),
            a[0].select();
            var n = document.execCommand("copy");
            a.val(o),
            n ? e.withoutHint || dialogController.fadePopup("Ссылка скопирована в буфер") : t()
        } catch (e) {
            a.val(o),
            t()
        }
    }
    ,
    n.el.on("click", ".copy-link", function(e) {
        n.copyTextToBuffer()
    }),
    n
}
,
lilo.viewFactories["exchange-friends-view"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.read-more": function(e) {
            dialogController.open(lilo.createView("dialog-friends-echange-explain"), {
                dialogClass: "no-padding small-close"
            })
        }
    },
    t
}
,
lilo.viewFactories["exp-line"] = function(e, t) {
    var r = lilo.baseViewFactory(e, t)
      , o = r.$(".progress-bar");
    r.els.progressbar = o,
    r.el.on("click", ".enable-exp-booster", function() {
        r.trigger("enable-exp-booster")
    }),
    r.createViewModel = function(o) {
        var a = r.$(".progress")
          , e = r.$(".progress-value");
        function t() {
            a.css("width", o.progress + "%"),
            e.html(Math.round(o.progress) + "%"),
            o.progress < 5 ? e.css("right", -15 - 15 * (5 - o.progress) / 5 + "px") : 95 < o.progress ? e.css("right", -15 - 16 * (95 - o.progress) / 5 + "px") : e.css("right", ""),
            r.els.hint.html("До след. уровня нужно <b>{0}</b> рейтинга. Всего {1}".format(o.remainder, o.exp))
        }
        function i() {
            var e, t = o.min, i = r.els.min, n = app.getTextAndBorderColorAndByLevel(t);
            i.attr("level", t),
            t >= LEVEL_PURPLE ? (n.border = "#000",
            i.addClass("gold-level-gradient").addClass("purple-level").css({
                "background-color": ""
            }).html(`<div class='gold-level-inner' style="background-color: ">${t}</div>`)) : 240 <= t ? (n.border = "#000",
            e = t >= window.LEVEL_PURPLE ? colorPurple : "",
            i.addClass("gold-level-gradient").removeClass("purple-level").css({
                "background-color": ""
            }).html(`<div class='gold-level-inner' style="background-color: ${e}">${t}</div>`)) : i.removeClass("gold-level-gradient").removeClass("purple-level").css({
                "background-color": n.border
            }).html(t),
            a.css({
                "background-color": t >= window.LEVEL_PURPLE ? colorPurple : n.border
            })
        }
        (window.progressModel = o).onChange("progress", t),
        o.onChange("min", i),
        t(),
        i();
        function n() {
            if (0 <= o.boosterLeftTime) {
                var e = util.millisToDateComponents(o.boosterLeftTime);
                return e.days ? "{0} д. {1} ч.".format(e.days, e.hours) : e.hours ? "{0} ч. {1} м.".format(e.hours, e.minutes) : Math.max(e.minutes, 1) + " мин."
            }
            return ""
        }
        var s = {
            leftTime: n()
        };
        return o.onChange("boosterLeftTime", function() {
            s.setAttr({
                leftTime: n()
            })
        }),
        s
    }
    ,
    r.getProgressAbsoluteCoordinates = function(e) {
        return {
            leftOffset: 88,
            topOffset: 606,
            top: 0,
            left: e / 100 * a
        }
    }
    ;
    var a = 296;
    return r.$(".bar").width(a),
    r.animateBonus = function(e, t, i) {
        var n = $(document.createElement("span")).addClass("bonus").text("+" + t).css({
            left: e / 100 * a + "px"
        });
        o.append(n),
        setTimeout(function() {
            n.addClass("animate"),
            setTimeout(function() {
                n.remove(),
                i()
            }, 1200)
        }, 50)
    }
    ,
    window.animateBonus = r.animateBonus,
    r
}
,
lilo.viewFactories["fade-popup"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["footer-request-timing"] = function(e, t) {
    var a = lilo.baseViewFactory(e, t);
    return a.createViewModel = function(e) {
        $.each(e.values, function(e, t) {
            var i = $(document.createElement("span")).addClass("item-counter")
              , n = $(document.createElement("b")).text(t.name + ":")
              , o = $(document.createElement("i")).text(t.percents + "%");
            i.append(n).append(o),
            t.onChange("percents", function() {
                o.text(t.percents + "%")
            }),
            a.els.list.append(i)
        })
    }
    ,
    a
}
,
lilo.viewFactories["footer-view"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.invite-friends": function() {
            this.trigger("invite-friends")
        },
        "click@$.add-to-fav": function() {
            this.trigger("add-to-fav")
        }
    },
    t.createViewModel = function(e) {
        return {
            bonusPerFriendInvite: Constants.BONUS_PER_REFERRAL,
            bonusPerAddToFav: Constants.BONUS_PER_ADD_TO_FAV
        }
    }
    ,
    t
}
,
lilo.viewFactories["game-results-list"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = "loading"
      , o = i.$(".load-more");
    return i.showLoader = function() {
        o.addClass(n)
    }
    ,
    i.hideLoader = function() {
        o.removeClass(n)
    }
    ,
    i.handlers = {
        "click@$.load-more": function(e) {
            $(e.target).hasClass(n) || i.trigger("load-more")
        }
    },
    i
}
,
lilo.viewFactories["guests-view"] = function(e, t) {
    var t = lilo.baseViewFactory(e, t)
      , i = "loading"
      , n = t.$(".load-guests");
    return t.showLoader = t.showGuestsLoader = function() {
        n.addClass(i)
    }
    ,
    t.hideLoader = t.hideGuestsLoader = function() {
        n.removeClass(i)
    }
    ,
    t.handlers = {
        "click@$.load-guests": function(e) {
            n.hasClass(i) || this.trigger("load-guests")
        }
    },
    t
}
,
lilo.viewFactories["harem-view"] = function(e, t) {
    var a = lilo.baseViewFactory(e, t)
      , s = a.$(".buy")
      , r = a.$(".out-buy")
      , l = a.$(".buy-back");
    a.$(".owner");
    return a.handlers = {
        "click@$.load-harem": function() {
            this.trigger("load-more")
        }
    },
    s.click(function(e) {
        a.trigger("buy", {
            event: e
        })
    }),
    r.click(function(e) {
        a.trigger("out-buy", {
            event: e
        })
    }),
    l.click(function(e) {
        a.trigger("buy-back", {
            event: e
        })
    }),
    a.createViewModel = function(t) {
        t.isSelfProfile ? a.on = function(e, t) {
            a.el.on(e, t),
            a.els["owner-list"].on(e, t)
        }
        : a.$(".owner-list").remove();
        function e() {
            var e;
            t.profileModel.uid === app.info.viewer_id ? (e = 0 === t.items.length,
            i.__isObservable ? i.setAttr({
                showHint: e
            }) : i.showHint = e,
            a.el.addClass("has-items")) : a.el[t.items.length ? "addClass" : "removeClass"]("has-items"),
            i.setAttr({
                subTitle: 2 === app.info.sex ? "Мой список ухаживаний" : "Мой список симпатий"
            }),
            a.$(".lead").css("display", t.items.length ? "block" : "none")
        }
        var i = {
            hasOwner: !1,
            ownerExp: 0,
            ownerPhoto: "",
            ownerVF: !1,
            ownerFullName: "",
            showHint: !1,
            subTitle: "Любимицы"
        };
        t.items.on("add", "self", e),
        t.items.on("remove", "self", e),
        t.items.on("removeAll", "self", e);
        var n = function() {
            app.sdk.viewComponents.profileMenu(a.$("[bind='viewModel.hasOwner']"), t.owner._id),
            n = $.noop
        };
        function o() {
            t.ownerData ? (i.setAttr({
                ownerPhoto: t.ownerData.photo_100,
                ownerExp: t.owner.exp,
                ownerVF: t.owner.vf,
                ownerFullName: t.ownerData.first_name + util.formatProfileBdate(t.ownerData.bdate, t.owner.age),
                hasOwner: !0
            }),
            t.owner && t.owner._id === app.info.viewer_id ? (s.hide(),
            r.hide(),
            l.hide(),
            a.el.on("click", ".owner-avatar", function(e) {
                a.trigger("show-owner", {
                    event: e
                })
            })) : (n(),
            t.isSelfProfile ? (s.hide(),
            r.hide(),
            l.show()) : (s.hide(),
            r.css("display", app.info.sex !== t.sex ? "block" : "none"),
            l.hide()))) : (i.setAttr({
                hasOwner: !1
            }),
            t.isSelfProfile ? s.hide() : s.css("display", app.info.sex !== t.sex ? "block" : "none"),
            r.hide(),
            l.hide())
        }
        return t.onChange("ownerData", o),
        1 === app.info.sex && a.el.addClass("viewer-is-female"),
        a.el[1 === t.sex ? "removeClass" : "addClass"]("red-ribbon"),
        setTimeout(o, 0),
        i
    }
    ,
    a
}
,
lilo.viewFactories.header = function(e, t) {
    var i, n, o, c = lilo.baseViewFactory(e, t), a = c.$(".close-answers-count"), s = c.$(".active-comments-count"), r = c.$(".active-comments"), u = c.$("#balance-icon-el"), p = c.$("#balance2-icon-el"), l = c.$(".number-of-closed-answers"), d = c.$(".room-link"), f = c.$(".new-guests-counter"), m = (c.$(".balance"),
    "animated"), v = "room-is-active";
    function h() {
        o = !1,
        n.css("display", "none"),
        app.recentPrivateMessagesView && app.recentPrivateMessagesView.onClose()
    }
    n = c.$(".private-messages-popup").click(function(e) {
        return util.cancelEvent(e)
    }),
    o = !1,
    c.$(".private-messages-btn").click(function(e) {
        return (o = !o) ? (o = !1,
        n.css("display", "block"),
        app.recentPrivateMessagesView && app.recentPrivateMessagesView.onOpen()) : h(),
        util.cancelEvent(e)
    }),
    c.closePrivateMessagesPopup = h,
    $body.click(h);
    var g = !1;
    c.showViralTabHint = function() {
        g = !0,
        c.els["viral-popup"].addClass("fade").css("display", "block"),
        setTimeout(function() {
            g && c.els["viral-popup"].removeClass("fade")
        }, 200)
    }
    ,
    c.hideViralTabHint = function() {
        g = !1,
        c.els["viral-popup"].addClass("fade"),
        setTimeout(function() {
            g || c.els["viral-popup"].hide()
        }, 500)
    }
    ,
    (window.headerView = c).onChangeSuperLikeSubscription = function(e) {
        c.els["super-like"].html(e ? "Наст. СуперЛайк" : "СуперЛайк")
    }
    ,
    c.onChangePrivacySubscription = function(e) {
        var t = c.els["privacy-subscription"]
          , i = "has-subscription";
        e ? t.html("Настройка").addClass(i) : t.html("Закрытый профиль").removeClass(i)
    }
    ,
    c.els["privacy-subscription"].click(function() {
        c.trigger("privacy-settings-click")
    }),
    c.els["super-like"].click(function() {
        c.trigger("super-like-click")
    });
    var b = "photos-availability-settings";
    c.els[b].click(function() {
        c.trigger(b)
    }),
    c.handleSelected = function(e) {
        i !== e && (i = e,
        c.$(".menu-item").removeClass("selected"),
        c.$(".menu-item[action='" + e + "']").addClass("selected"),
        "game" === e && d.removeClass(v),
        T())
    }
    ,
    app.eventBus.on(app.EVENTS.ROOM_STAY_ACTIVE, function() {
        d.addClass(v)
    }),
    app.eventBus.on(app.EVENTS.ROOM_IS_DEACTIVATED, function() {
        d.removeClass(v)
    }),
    app.eventBus.on("closeAnswersCountChange", function(e) {
        e = e.count;
        0 < e ? a.css("display", "inline-block").text(e) : a.hide()
    });
    var C = -1
      , _ = !1;
    function w(e) {
        e = e || app.info.age,
        !(isMobi || e < 18) && window.selfProfileController && selfProfileController.photosController.hasPublicPhotos() ? c.els[b].css("display", "inline-block") : c.els[b].hide()
    }
    function E(e) {
        c.updateVisibilityOfViralTab(),
        w(e)
    }
    function y(e, t) {
        e ? (f.css("display", "inline-block").text(e),
        f.isVisible = !0,
        t || setTimeout(function() {
            f.isVisible && (f.addClass(m),
            setTimeout(function() {
                f.removeClass(m)
            }, 600))
        }, 150)) : (f.isVisible = !1,
        f.hide().removeClass(m))
    }
    app.eventBus.on(app.EVENTS.ACTIVE_COMMENTS_COUNT_CHANGED, function(e) {
        var t = e.count
          , e = e.total;
        !function(e) {
            if (C < -1)
                C = e;
            else {
                if (C < e) {
                    if (_)
                        return;
                    s.addClass(m),
                    _ = !0,
                    setTimeout(function() {
                        _ = !1,
                        s.removeClass(m)
                    }, 600)
                }
                C = e
            }
        }(t),
        s.css("display", t ? "inline-block" : "none").text(t),
        r.css("display", e ? "inline-block" : "")
    }),
    app.eventBus.on(app.EVENTS.GET_BOOT_DATA, function(e) {
        e.bootData.invisTs ? c.$(".invis-icon").addClass("activated").text("Настройка") : c.$(".invis-icon").removeClass("activated").text("Стать невидимкой")
    }),
    app.eventBus.on(app.EVENTS.INVISIBILITY_STATE_CHANGED, function(e) {
        e.invisTs ? c.$(".invis-icon").addClass("activated").text("Настройка") : c.$(".invis-icon").removeClass("activated").text("Стать невидимкой")
    }),
    app.eventBus.on(app.EVENTS.PHOTOS_CHANGED, function() {
        w()
    }),
    c.updateVisibilityOfViralTab = function() {
        var e = !1;
        app.info.viralDataHandled && app.canShowViralTab(app.info.age) && (app.info.needShowViralTab || 10 <= app.viralTabController.questionsController.getFriendsSize()) && (e = !0),
        c.els.viral.css("display", e ? "inline-block" : "none")
    }
    ,
    app.eventBus.on(app.EVENTS.AGE_CHANGED, function(e) {
        E(e.age)
    }),
    c.handlers = {
        "click@$.menu-item": function(e) {
            e = $(e.target).attr("action");
            e && e.length && this.trigger("menu-click", {
                action: e
            })
        },
        "click@$.purchase": function(e) {
            isMobi || this.trigger("purchase", {
                currency: 1
            })
        },
        "click@$[purchase-coins]": function(e) {
            isMobi || this.trigger("purchase", {
                currency: 1
            })
        },
        "click@$[purchase-ruby]": function(e) {
            isMobi || this.trigger("purchase", {
                currency: 2
            })
        },
        "click@$.invis-icon": function(e) {
            this.trigger("invise-click")
        }
    },
    isMobi ? c.handlers["click@$.balance"] = function(e) {
        c.trigger("purchase", {
            currency: 1
        })
    }
    : c.handlers["click@$.exchange-friends-settings"] = function() {
        c.trigger("exchange-friends-settings")
    }
    ;
    var D, T = function() {
        var e = app.balanceModel.bonusCoins;
        0 < e && "viral" !== i ? l.css("display", "inline-block").text(e) : l.hide()
    };
    return c.animateCoinsBonus = function(e, t, i) {
        var n = $(document.createElement("span")).text("+" + e).addClass("bonus-element").addClass("coins-win").append(document.createElement("i"))
          , o = u.offset()
          , e = t.left - (o = o || {
            left: 0,
            top: 0
        }).left
          , o = t.top - o.top;
        n.css("transform", "translateX(" + e + "px) translateY(" + o + "px)"),
        u.append(n),
        setTimeout(function() {
            n.css("transform", ""),
            setTimeout(function() {
                i && i(),
                n.remove()
            }, 1500)
        }, 80)
    }
    ,
    c.createViewModel = function(t) {
        var e;
        util.isOKPlatform() ? ["viral", "room_questions_editor"].each(function(e, t) {
            c.$("[action='" + t + "']").detach()
        }) : ["ok-invitations"].each(function(e, t) {
            c.$("[action='" + t + "']").detach()
        }),
        isMobi || ((e = function() {
            var e = !1;
            window.expController && 15 <= window.expController.getCurrentLevel() && (app.commonState.isDepositsDisabledByAdmin || (e = !0)),
            c.els["exchange-friends-settings"].css("display", e ? "" : "none")
        }
        )(),
        app.commonState.onChange("isDepositsDisabledByAdmin", e),
        app.eventBus.on(app.EVENTS.VIEWER_LEVEL_CHANGED, function() {
            setTimeout(function() {
                e()
            }, 100)
        })),
        E(app.info.age);
        function i() {
            var e;
            isMobi || ((e = app.controllers.dialog.Purchase.getStock({
                currency: 2
            }) || app.controllers.dialog.Purchase.getStock({
                currency: 1
            })) ? (n.addClass("has-stock"),
            n[1 !== e.type ? "addClass" : "removeClass"]("stock-3")) : n.removeClass("has-stock stock-3"))
        }
        var n = c.$(".purchase");
        i(),
        app.eventBus.on(app.EVENTS.PURCHASE, i),
        app.eventBus.on(app.EVENTS.CHANGE_STOCK_LIST, i);
        var o = t.balance;
        t.onChange("balance", function(e) {
            o < t.balance && (clearTimeout(D),
            u.removeClass("animate").addClass("animate"),
            D = setTimeout(function() {
                u.removeClass("animate")
            }, 600)),
            o = t.balance
        });
        var a, s, r = t.balance2;
        t.onChange("balance2", function(e) {
            r < t.balance2 && (clearTimeout(D),
            p.removeClass("animate").addClass("animate"),
            D = setTimeout(function() {
                p.removeClass("animate")
            }, 600)),
            r = t.balance2
        }),
        y(app.viewerProfile.newGuestsCount, !0),
        app.viewerProfile.onChange("newGuestsCount", function() {
            y(app.viewerProfile.newGuestsCount)
        }),
        socialApi.isUsersMemberOfDevClubs() && c.$("[action=''],.exchange-friends-settings").remove(),
        app.viewerIsBeginner() && (app.info.canShowBonus ? c.els.viral.removeClass("high-level") : (a = c.els.viral.detach(),
        s = !1,
        app.eventBus.on(app.EVENTS.VIEWER_LEVEL_CHANGED, function(e) {
            5 <= e.level && !s && (s = !0,
            c.$(".panel .top-panel").append(a))
        })),
        c.$(".high-level").remove()),
        isMobi ? c.$(".app-only").remove() : (d = function() {
            app.commonState.isDepositsDisabled ? c.$("[action='exchange_friends']").hide() : c.$("[action='exchange_friends']").css("display", "")
        }
        ,
        app.commonState.onChange("isDepositsDisabled", d),
        d()),
        c.el.on("click", ".test-item", function() {
            (new app.controllers.dialog.WheelOfFortune).openWheelDialog()
        });
        var l = "header.select-region-panel-is-closed"
          , d = function() {
            var e = util.lStorage.find(l)
              , t = !0;
            e || !(e || app.info.regionId < -1 || 0 < app.info.regionId) && app.info.regionId || (t = !1),
            c.els["select-region-panel"].css("display", (t = e ? !1 : t) ? "block" : "none")
        };
        d(),
        app.eventBus.on(app.EVENTS.REGION_CHANGED, d),
        c.el.on("click", ".close-region-panel", function(e) {
            util.lStorage.save(l, "1"),
            c.els["select-region-panel"].hide()
        }),
        c.el.on("click", ".select-region", function(e) {
            new app.controllers.dialog.Regions({
                currentCountryId: app.info.countryId,
                currentRegionId: app.info.regionId
            })
        });
        d = function() {
            T()
        }
        ;
        d(),
        app.balanceModel.onChange("bonusCoins", d)
    }
    ,
    c
}
,
lilo.viewFactories["item-active-comment-content-18"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".show-profile", function(e) {
        return i.trigger("show-profile", {
            uid: i.model.from
        }),
        util.cancelEvent(e)
    }),
    i.el.on("click", ".open-photo", function(e) {
        return i.trigger("open-photo", {
            pid: i.model.b
        }),
        util.cancelEvent(e)
    }),
    i.createViewModel = function(e) {
        i.$(".like-type").css("background-image", "url(" + CDN_PREFIX + "/likes/" + e.a + ".png)"),
        !0 === e.d && e.setAttr({
            from: -1,
            inviterExp: 0,
            inviterFirstName: "Невидимка",
            inviterSex: 2,
            inviterAvatar: app.ANONYMOUS_IMG
        })
    }
    ,
    i
}
,
lilo.viewFactories["item-active-comment-view"] = function(e, t) {
    var n = lilo.baseViewFactory(e, t);
    n.handlers = {
        "click@$.delete": function(e) {
            return e.stopPropagation(),
            this.trigger("delete", {
                model: this.model
            }),
            !1
        },
        "click@$.user-info, .ask-name": function() {
            -1 === this.model.from || this.trigger("show-profile", {
                uid: this.model.from
            })
        },
        "click@el": function(e) {
            this.model.upd ? this.trigger("go-to-comment", {
                view: this,
                model: this.model
            }) : this.model.t === NotificationType.ROOM_INVITE ? this.trigger("open-room-invite", {
                model: this.model
            }) : this.model.t === NotificationType.VERIFICATION_PHOTO_ALLOW || this.model.t === NotificationType.VERIFICATION_PHOTO_DENY || this.model.t === NotificationType.PHOTO_ALLOW || this.model.t === NotificationType.PHOTO_DENY || this.trigger("go-to-user", {
                view: this,
                model: this.model
            })
        },
        "click@$.girl-avatar": function(e) {
            this.trigger("show-girl", {
                view: this,
                model: this.model,
                uid: this.model.girlId
            })
        }
    };
    var o = {};
    function i(e) {
        var t = lilo.createView("item-active-comment-with-bonus");
        return t.setModel(e),
        n.el.addClass("notification-with-bonus"),
        n.els["icon-warn"].css("background-image", "url(" + t.viewModel.icon + ")"),
        t.el[0]
    }
    function a(e) {
        var t, i;
        e.upd ? (-1 === e.from && n.el.addClass("is-anonymous"),
        e.comments.length && n.el.addClass("has-comments"),
        n.$(".notification").remove(),
        n.el.addClass("is-dialog")) : (n.$(".dialog").remove(),
        e.t === NotificationType.FOR_GIRL ? n.$(".bought-out-view,.gift-for-girl,.invis-expired,.room-invite,.notification-message").remove() : e.t === NotificationType.GIFT_FOR_GIRL ? n.$(".bought-out-view,.for-girl,.invis-expired,.room-invite,.notification-message").remove() : e.t === NotificationType.BOUGHT_UP_GIRL ? n.$(".for-girl,.gift-for-girl,.invis-expired,.room-invite,.notification-message").remove() : e.t === NotificationType.INVISIBILITY_EXPIRED || e.t === NotificationType.PROFILE_PRIVACY_SUBSCRIPTION_IS_EXPIRED ? (n.$(".for-girl,.gift-for-girl,.bought-out-view,.room-invite,.notification-message").remove(),
        e.t === NotificationType.PROFILE_PRIVACY_SUBSCRIPTION_IS_EXPIRED && n.$(".invis-expired").html('Услуга "Закрытый профиль" истекла. Ваш профиль открыт для всех пользователей')) : e.t === NotificationType.ROOM_INVITE ? (n.el.addClass("room-invite"),
        n.$(".for-girl,.gift-for-girl,.bought-out-view,.invis-expired,.notification-message").remove()) : e.t !== NotificationType.BOUGHT_DEPOSIT && e.t !== NotificationType.BONUS_ROOM_TOP_LIST && e.t !== NotificationType.BONUS_NEW_LEVEL && e.t !== NotificationType.BOUGHT_UP_DEPOSIT && e.t !== NotificationType.DEPOSIT_V2_PROFIT && e.t !== NotificationType.RESERVE_DEPOSIT && e.t !== NotificationType.BOUGHT_DEPOSIT_WITH_BONUS && e.t !== NotificationType.VERIFICATION_PHOTO_ALLOW && e.t !== NotificationType.VERIFICATION_PHOTO_DENY && e.t !== NotificationType.VK_OFFER_IS_COMPLETE && e.t !== NotificationType.PHOTO_ALLOW && e.t !== NotificationType.PHOTO_DENY && e.t !== NotificationType.VERIFICATION_PHOTO_BLOCKED && e.t !== NotificationType.PHOTO_LIKE && e.t !== NotificationType.ADMIN_CHANGE_STATUS_OF_QUESTION || (n.$(".for-girl,.gift-for-girl,.bought-out-view,.invis-expired,.room-invite").remove(),
        (t = function(e) {
            var t = o[e.t];
            if (t)
                return t(e)
        }(e)) ? n.$(".notification-message td").append(t).attr("ntype", e.t) : (i = e.t === NotificationType.BOUGHT_DEPOSIT_WITH_BONUS ? "Ваш друг {0} инвестировал{1} в вас на Бирже".format(e.nextOwnerFirstName, 1 === e.nextOwnerSex ? "a" : "") : e.t === NotificationType.BOUGHT_DEPOSIT ? "В вас инвестировал один из ваших друзей" : e.t === NotificationType.RESERVE_DEPOSIT ? "Ваш друг {0} забронировал{1} вас на {2} {3} на Бирже".format(e.ownerFirstName, 1 === e.ownerSex ? "a" : "", e.d, util.pluralize(e.d, {
            one: "день",
            two: "дня",
            many: "дней"
        })) : e.t === NotificationType.DEPOSIT_V2_PROFIT ? "Вы заработали на инвестиции в игрока {0} {1} {2}".format(e.depositFN, e.s, util.pluralize(e.s, "монету", "монеты", "монет")) : e.t === NotificationType.BOUGHT_UP_DEPOSIT ? e.v2 ? "Игрок {0} автоматически удалён с Биржи, вам возвращены монеты за покупку, бронирование и все заработанные монеты. Количество возвращённых монет - {1}.".format(e.depositFN, e.pr) : (i = e.pr ? " Вы успели заработать {0} {1}".format(e.pr, util.pluralize(e.pr, "монету", "монеты", "монет")) : "",
        e.b ? "Ваш забронированный игрок {0} перекуплен{2} на Бирже. Вам возвращены {1} монет, потраченных на бронь.{3}".format(e.depositFN, e.b, 1 === e.depositSex ? "a" : "", i) : "Ваш игрок {0} был{1} перекуплен{1} на Бирже.{2}".format(e.depositFN, 1 === e.depositSex ? "a" : "", i)) : e.t === NotificationType.VERIFICATION_PHOTO_ALLOW ? 'Верификация фотографий. Ответ модератора: "Ваше проверочное фото с жестом было одобрено, зайдите в профиль, чтобы узнать подробнее"' : e.t === NotificationType.VERIFICATION_PHOTO_DENY ? 'Верификация фотографий. Ответ модератора: "Ваше проверочное фото с жестом отклонено, зайдите в профиль, чтобы посмотреть причину"' : e.t === NotificationType.PHOTO_ALLOW ? 'Верификация фотографий. Ответ модератора: "Ваше фото было одобрено, зайдите в профиль, чтобы узнать подробнее"' : e.t === NotificationType.PHOTO_DENY ? 'Верификация фотографий. Ответ модератора: "Ваше фото не прошло модерацию, зайдите в профиль, чтобы посмотреть причину"' : e.t === NotificationType.VK_OFFER_IS_COMPLETE ? "Вы успешно выполнили задание и скоро получите голоса!" : e.t === NotificationType.VERIFICATION_PHOTO_BLOCKED ? Constants.PHOTO_VERIFICATION_BLOCK_TEXT + util.formatDate(e.a, s) : 'Ваш вопрос "{0}" {1}'.format(util.escapeHtml(e.txt), e.v ? "Успешно прошел проверку" : "был отклонен"),
        n.$(".notification-message td").html(i).attr("ntype", e.t))))
    }
    o[NotificationType.PHOTO_LIKE] = function(e) {
        var t = lilo.createView("item-active-comment-content-" + e.t);
        return t.setModel(e),
        n.el.addClass("notification-like"),
        t.el[0]
    }
    ,
    o[NotificationType.BONUS_NEW_LEVEL] = i,
    o[NotificationType.BONUS_ROOM_TOP_LIST] = i,
    o[NotificationType.BONUS_ROOM_TOP_LIST_MULTI] = i;
    function s(e, t, i, n, o) {
        return e + "." + t + "." + i + " " + n + ":" + o
    }
    return n.createViewModel = function(e) {
        a(e)
    }
    ,
    n
}
,
lilo.viewFactories["item-active-comment-with-bonus"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    function s(e) {
        var t = [];
        return e.c && t.push(e.c + " <span class='smart-coin'></span>"),
        e.r && t.push(e.r + " <span class='smart-ruby'></span>"),
        t.join(", ")
    }
    return t.createViewModel = function(e) {
        var t = ""
          , i = "";
        switch (e.t) {
        case NotificationType.BONUS_NEW_LEVEL:
            var n = []
              , i = "levelup.png";
            n.push("Вы получили новый уровень. Награда: " + s(e)),
            t = n.join("<br>");
            break;
        case NotificationType.BONUS_ROOM_TOP_LIST:
            i = "topX.png";
            var t = "bonus top list"
              , o = e.p
              , a = (e.cp,
            e.tid)
              , a = app.getTopListTitle(a, app.info.sex, o + 1);
            1 === o ? i = "top1.png" : 2 !== o && 3 !== o || (i = "top2.png"),
            (n = []).push('Вы заняли {0} место в номинации "{1}"'.format(o, a) + ". Награда: " + s(e)),
            t = n.join("<br>")
        }
        return {
            msg: t,
            icon: CDN_PREFIX + "notification/" + i
        }
    }
    ,
    t
}
,
lilo.viewFactories["item-agg"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@el": function() {
            this.trigger("show-profile", {
                model: this.model
            })
        }
    },
    t
}
,
lilo.viewFactories["item-album"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@el": function() {
            this.trigger("select-album", {
                model: this.model
            })
        }
    },
    t
}
,
lilo.viewFactories["item-answer"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@el": function(e) {
            i.el.hasClass("loading") || this.trigger("answer", {
                $el: i.el,
                model: this.model,
                index: i.el.index()
            })
        }
    },
    i.createViewModel = function(t) {
        var e;
        t.imgUrl || i.el.addClass("no-img"),
        t.vkUrl && t.sapsUrl && t.imgUrl === t.sapsUrl && ((e = new Image).onerror = function(e) {
            t.setAttr({
                imgUrl: t.vkUrl
            }),
            hashOfInvalidSapsImages[t.sapsUrl] = !0
        }
        ,
        e.src = t.sapsUrl),
        t.text || i.el.addClass("no-text")
    }
    ,
    i
}
,
lilo.viewFactories["item-answer-in-editor"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.remove": function() {
            this.trigger("delete", {
                model: this.model
            })
        }
    },
    t
}
,
lilo.viewFactories["item-audio"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.stop": function(e) {
            return this.trigger("stop", {
                model: this.model
            }),
            e.stopPropagation(),
            e.preventDefault(),
            !1
        },
        "click@$.play": function(e) {
            return this.trigger("play", {
                model: this.model
            }),
            e.stopPropagation(),
            e.preventDefault(),
            !1
        },
        "click@el": function() {
            this.trigger("click", {
                model: this.model,
                el: this.el
            })
        }
    },
    t
}
,
lilo.viewFactories["item-chat-message"] = function(e, t) {
    function u(e) {
        var t = document.createElement("div");
        return t.className = e || "",
        t
    }
    var r = lilo.baseViewFactory(e, t)
      , l = app.ChatMessageType
      , c = lilo.getSimpleBindHandler("exp-level-v2");
    app.controllers.Emoji;
    function d(l) {
        var e = u("system-message local-top-rewards pe-none1")
          , t = u("lottery-win-header")
          , d = u("rewards-list");
        t.innerHTML = "Призы за титул",
        e.appendChild(t),
        e.appendChild(d),
        l._users.each(function(e, a) {
            var t, i, n, o, s, r;
            a._isVisible && (t = u("item-chat-message-v2 cf item-local-top-result"),
            i = u("owner-avatar"),
            r = u("avatar-wrapper"),
            n = u("owner-full-name"),
            o = u("exp-level"),
            s = u("reward-result"),
            c($(o), a.exp),
            i.appendChild(o),
            a.rewards.each(function(e, t) {
                var i, n, o;
                t.value && ((i = u("item-reward-value")).innerHTML = "<i class='reward-icon reward-icon-type-{0}'></i> <i class='reward-title'>{1}</i> <b>+{2}</b><i class='smart-coin'></i>".format(t.type, (n = a.male,
                o = t.type,
                n = 1 === o ? n ? "Щедрый" : "Щедрая" : 2 === o ? n ? "Популярный" : "Популярная" : 3 === o ? "DJ" : n ? "Удачливый" : "Удачливая"), t.value),
                s.appendChild(i))
            }),
            n.innerHTML = util.escapeHtml(a.firstName + " " + a.age, null, !0),
            i.style.backgroundImage = "url(" + a.avatar + ")",
            r.appendChild(i),
            r.appendChild(n),
            r.appendChild(s),
            t.appendChild(r),
            t.appendChild(s),
            a.uid === app.info.viewer_id && l.hasViewerResult && ((r = u("left-coins")).innerHTML = "*Вы сможете выиграть в этой комнате еще {0} {1}".format(l.leftCoinsInLocalRoomTop, util.pluralize(l.leftCoinsInLocalRoomTop, "монету", "монеты", "монет")),
            t.append(r)),
            d.appendChild(t))
        });
        t = u();
        return t.appendChild(e),
        t.innerHTML
    }
    return r.createViewModel = function(n) {
        var e;
        if (n.type === l.NORMAL || n.type === l.TALK || n.type === l.STICKER)
            return (e = lilo.createView("item-chat-message-v2")).setModel(n),
            void r.el.empty().append(e.el);
        if (n.type === l.UNITED_STICKER)
            return (e = lilo.createView("item-chat-message-sticker-merge")).setModel(n),
            void r.el.empty().append(e.el);
        switch (n.from === app.info.viewer_id && r.el.addClass("from-viewer"),
        n.type) {
        case l.NORMAL:
            r.$(".to,.chat-gift,.audio,.system-message").remove();
            break;
        case l.TALK:
            r.$(".audio,.chat-gift,.system-message").remove();
            break;
        case l.PHOTO_LIKE:
        case l.SYSTEM_BAN_USER:
        case l.SYSTEM_USER_CAME:
        case l.SYSTEM_USER_OUT:
        case l.SYSTEM_NEW_LEVEL:
        case l.LOTTERY_WIN:
        case l.LOTTERY_COMMON_RESULT:
        case l.SYSTEM_USER_REMOVE_BY_USER:
        case l.SYSTEM_USER_SAVED_BY_USER:
        case l.GIFT:
        case l.BATCH_GIFT:
        case l.PROMOTION_TRACK:
        case l.SYSTEM_USER_STATUS:
        case l.SYSTEM_REPLACE_CURRENT_TRACK:
        case l.SYSTEM_REWARD_IN_TOP_LIST:
        case l.SYSTEM_REWARD_IN_LOCAL_ROOM_TOP:
            r.$(".name,.audio,.message").remove();
            var o, a, t, s = r.$(".system-message span");
            n.type === l.SYSTEM_NEW_LEVEL && (o = expController.calcMinLevelAndProgress(n.fromExp).level,
            a = app.getTextAndBorderColorAndByLevel(o)),
            (t = function() {
                var e, c, t;
                if (n.type === l.SYSTEM_NEW_LEVEL) {
                    var i = 100 <= o ? "font-size: 10px;width: 21px;height: 21px;line-height: 21px;" : "";
                    240 <= o && (i += "border:2px solid #ffb600;",
                    a.border = "#000"),
                    i = ("<b>{0}</b> получил{1} <i class='level-round' style='background:{3}; color:#fff;" + i + "'>{2}</i> уровень").format(util.escapeHtml(n.firstName, 0, 1), n.fromMale ? "" : "a", o, a.border, a.text)
                } else if (n.type === l.PHOTO_LIKE)
                    i = "Ваша оценка <b class='like-type' style='background-image:url({0}); '></b> для <b class='link open-profile' target-uid='{1}'>фото</b>".format(CDN_PREFIX + "/likes/" + n.likeType + ".png?v=1", n.recipientUid);
                else if (n.type === l.LOTTERY_WIN)
                    i = "<b>{0}</b> выиграл{1} {2} {3}{4}".format(util.escapeHtml(n.firstName, 0, 1), n.fromMale ? "" : "a", n.winValue, util.pluralize(n.winValue, {
                        one: "монету",
                        two: "монеты",
                        many: "монет"
                    }), n.matches ? ", угадав {0} {1}".format(n.matches, util.pluralize(n.matches, {
                        one: "число",
                        two: "числа",
                        many: "чисел"
                    })) : "");
                else if (n.type === l.LOTTERY_COMMON_RESULT)
                    e = n,
                    c = u("system-message"),
                    (t = u("lottery-win-header")).innerHTML = "Таблица выигрышей в Лото",
                    c.appendChild(t),
                    e.items.each(function(e, t) {
                        var i = u("item-chat-message-v2 cf item-lottery-result")
                          , n = u("owner-avatar")
                          , o = u("float-wrapper")
                          , a = u("owner-full-name")
                          , s = u("lottery-results")
                          , r = u("exp-level")
                          , l = u("numbers-wrap")
                          , d = u("coin-win " + (2 === t.winCurrency ? "ruby" : ""));
                        lilo.getSimpleBindHandler("exp-level-v2")($(r), t.fromExp),
                        t.matchNumbers.each(function(e, t) {
                            var i = u("item-lottery-win-number");
                            i.innerHTML = t + "",
                            l.appendChild(i)
                        }),
                        d.innerHTML = t.winValue + "",
                        a.innerHTML = util.escapeHtml(t.firstName + " " + t.fromAge, null, !0),
                        n.style.backgroundImage = "url(" + t.fromAvatar + ")",
                        o.appendChild(a),
                        o.appendChild(s),
                        s.appendChild(l),
                        s.appendChild(d),
                        i.appendChild(n),
                        i.appendChild(o),
                        n.appendChild(r),
                        c.appendChild(i)
                    }),
                    (e = u()).appendChild(c),
                    i = e.innerHTML;
                else if (n.type === l.SYSTEM_BAN_USER)
                    i = "<b>{0}</b> {1} <b>{2}</b>".format(util.escapeHtml(n.firstName, 0, 1), (n.isBanned ? "заблокировал" : "разблокировал") + (n.fromMale ? "" : "a"), util.escapeHtml(n.toFirstNameAcc, 0, 1));
                else if (n.type === l.PROMOTION_TRACK)
                    i = "<b>{0}</b> {1} свою песню".format(util.escapeHtml(n.firstName, 0, 1), n.fromMale ? "продвинул" : "продвинулa");
                else if (n.type === l.SYSTEM_REPLACE_CURRENT_TRACK)
                    i = "<b>{0}</b> {1} песню вне очереди".format(util.escapeHtml(n.firstName, 0, 1), n.fromMale ? "добавил" : "добавила");
                else if (n.type === l.GIFT || n.type === l.BATCH_GIFT)
                    i = util.createChatMessageText(n),
                    n.to === app.info.viewer_id && (s.addClass("gift-to-viewer"),
                    i += "<div class='send-gift-back'>Подарить в ответ</div>",
                    s.click(function() {
                        roomView.trigger("send-gift-back", {
                            targetUid: n.from
                        })
                    }));
                else if (n.type === l.SYSTEM_USER_REMOVE_BY_USER)
                    i = (n.isKickAsRoomOwner ? "<b>{0}</b> исключил игрока <b>{1}</b>" : "<b>{0}</b> хочет исключить игрока <b>{1}</b>").format(n.isAnon ? "Аноним" : util.escapeHtml(n.firstName) + " " + n.fromAge, util.escapeHtml(n.targetUserFirstName) + " " + n.recipientAge),
                    n.reasonId && KickReasonId[n.reasonId] && (i += ' Причина: "{0}"'.format(KickReasonId[n.reasonId]));
                else if (n.type === l.SYSTEM_USER_SAVED_BY_USER)
                    i = n.from === n.targetUserId ? "<b>{0}</b> {1} себя от исключения".format(util.escapeHtml(n.firstName) + " " + n.fromAge, n.fromMale ? "спас" : "спасла") : "<b>{0}</b> {1} игрока <b>{2}</b> от исключения".format(util.escapeHtml(n.firstName) + " " + n.fromAge, n.fromMale ? "спас" : "спасла", util.escapeHtml(n.targetUserFirstName) + " " + n.targetUserAge);
                else if (n.type === l.SYSTEM_REWARD_IN_LOCAL_ROOM_TOP)
                    try {
                        n._isVisible ? i = d(n) : (i = "",
                        r.el.hide())
                    } catch (e) {
                        console.info(e)
                    }
                else
                    n.type === l.SYSTEM_USER_STATUS ? (1 === n.statusId && (i = "<b>{0}</b> {1} в комнате!".format(util.escapeHtml(n.firstName, null, !0), n.fromMale ? 'стал самым "Щедрым"' : 'стала самой "Щедрой"')),
                    2 === n.statusId && (i = "<b>{0}</b> {1} в комнате!".format(util.escapeHtml(n.firstName, null, !0), n.fromMale ? 'стал самым "Популярным"' : 'стала самой "Популярной"')),
                    3 === n.statusId && (i = "<b>{0}</b> {1} в комнате!".format(util.escapeHtml(n.firstName, null, !0), n.fromMale ? 'стал "Диджеем"' : 'стала "Диджеем"')),
                    4 === n.statusId && (i = "<b>{0}</b> {1} в комнате!".format(util.escapeHtml(n.firstName, null, !0), n.fromMale ? 'стал самым "Удачливым"' : 'стала самой "Удачливой"'))) : i = n.type === l.SYSTEM_REWARD_IN_TOP_LIST ? (t = n.place,
                    e = app.RoomTopListRewards.roomTeems[t] || 0,
                    "Ваша комната заняла <b>{0} место</b> среди всех комнат. Приз <b>{1} {2}</b> каждому!".format(t + 1, e, util.pluralize(e, "монета", "монеты", "монет"))) : "<b>{0}</b> {1}".format(util.escapeHtml(n.firstName, null, !0), n.fromMale ? n.type === l.SYSTEM_USER_CAME ? "зашел" : "вышел" : n.type === l.SYSTEM_USER_CAME ? "зашла" : "вышла");
                s.html(i).attr("message-type", n.type)
            }
            )();
            break;
        case l.LIKE_SOUND:
            r.$(".name,.audio,.message").remove(),
            (s = r.$(".system-message span")).addClass("like-sound-message"),
            (t = function() {
                var e = "<b>{0}</b> {2} {1}".format(util.escapeHtml(n.firstName, null, !0), util.escapeHtml(n.artist + " - " + n.title), 0 < n.likeValue ? "нравится" : "не нравится");
                s.html(e)
            }
            )(),
            n.onChange("firstName", t)
        }
        function i() {
            r.els["message-body"].css("color", n.fromMale ? "#6d6df4" : "#FF55D4")
        }
        i(),
        n.onChange("fromMale", i)
    }
    ,
    isMobi ? r.el.on("click", ".push-to-textarea-mobi", function() {
        r.trigger("click-first-name", {
            model: r.model
        })
    }) : (r.el.on("click", ".first-name", function() {
        r.trigger("click-first-name", {
            model: r.model
        })
    }),
    r.el.on("click", ".open-profile", function(e) {
        r.trigger("open-profile", {
            uid: parseInt(e.currentTarget.getAttribute("target-uid"))
        })
    }),
    r.el.on("click", ".push-to-textarea", function() {
        r.trigger("click-first-name", {
            model: r.model
        })
    })),
    r
}
,
lilo.viewFactories["item-chat-message-new-level"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = null;
    return i.createViewModel = function(e) {
        e.from === app.info.viewer_id && (n = activeCommentsController.findNewLevelNotification(e.fromExp)) || i.$(".level-reward").remove()
    }
    ,
    i.el.on("click", ".level-reward", function() {
        i.trigger("level-reward", {
            view: this,
            notificationModel: n
        })
    }),
    i
}
,
lilo.viewFactories["item-chat-message-sticker-merge"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    app.ChatMessageType;
    return i.el.on("click", ".message-like-wrap", function() {
        i.trigger("toggle-like", {
            model: i.model
        })
    }),
    i.createViewModel = function(e) {
        var t = app.controllers.dialog.Stickers.Configuration.parseOrDefault(e.message, e.fromMale).toDocumentFragment()
          , e = document.createElement("div");
        e.className = "sticker-wrap",
        e.appendChild(t),
        i.$(".message-wrap").addClass("sticker").append(e)
    }
    ,
    i
}
,
lilo.viewFactories["item-chat-message-v2"] = function(e, t) {
    var r = lilo.baseViewFactory(e, t)
      , l = app.ChatMessageType;
    r.el.on("click", ".message-like-wrap", function() {
        r.trigger("toggle-like", {
            model: r.model
        })
    });
    var e = "exp_240_level"
      , t = "exp_230_level"
      , d = util.cache.find(e)
      , c = util.cache.find(t);
    return d || (d = expController.levelToExp(240),
    util.cache.save(e, d, 864e5)),
    c || (c = expController.levelToExp(LEVEL_PURPLE),
    util.cache.save(t, c, 864e5)),
    r.createViewModel = function(e) {
        e.from === app.info.viewer_id && r.el.addClass("from-viewer"),
        !e.isReply && (e.to === app.info.viewer_id || e.reply && e.reply.from === app.info.viewer_id) && r.el.addClass("is-to-viewer");
        var t = e.reply;
        t && ((a = lilo.createView("item-chat-message-v2")).setModel(t),
        r.$(".reply-container").append(a.el),
        lilo.getSimpleBindHandler("border-by-level-v2")(a.el, t.fromExp));
        var i, n, o, a, s = e.type === l.STICKER;
        s ? (r.el.addClass("is-sticker"),
        i = app.controllers.dialog.Stickers.Configuration.parseOrDefault(e.message, e.fromMale).toDocumentFragment(),
        n = document.createElement("div"),
        o = document.createElement("div"),
        a = document.createElement("div"),
        o.className = "bubble-triangle",
        a.className = "sticker-wrap",
        e.recipientFirstName && ((t = document.createElement("span")).className = "recipient-node",
        t.innerHTML = util.escapeHtml(e.recipientFirstName, e.from, !0),
        n.appendChild(t)),
        a.appendChild(i),
        n.appendChild(a),
        r.els["message-container"].empty().addClass("sticker").append(o).append(n)) : e.type !== l.TALK && r.$(".address").remove(),
        !s && e.fromExp >= d && (e.fromExp >= c ? r.el.addClass("purple-message") : r.el.addClass("gold-message"))
    }
    ,
    r
}
,
lilo.viewFactories["item-comment"] = function(e, t) {
    var p = lilo.baseViewFactory(e, t)
      , f = app.info.viewer_id
      , i = "loading"
      , n = p.$(".form");
    return p.showLoader = function() {
        n.addClass(i)
    }
    ,
    p.hideLoader = function() {
        n.removeClass(i)
    }
    ,
    p.handlers = {
        "click@$.user-info, .ask-name": function() {
            this.model.isAnonymous || this.trigger("show-profile", {
                uid: this.model.from
            })
        },
        "click@$.form .link": function(e) {
            this.trigger($(e.target).attr("action"), {
                view: this,
                model: this.model
            })
        },
        "click@$.add-comment-link": function(e) {
            this.trigger("add-sub-comment", {
                view: this,
                model: this.model
            })
        }
    },
    p.on("delete-sub-comment:item-sub-comment", function(e) {
        p.trigger("delete-sub-comment", {
            comment: p.model,
            subComment: e.extraData.model
        })
    }),
    p.createViewModel = function(e) {
        var t;
        (t = e).isAnonymous && p.el.addClass("is-anonymous"),
        t.from === app.info.viewer_id && p.el.addClass("is-self"),
        t.to === app.info.viewer_id && p.el.addClass("is-owner");
        var i = {
            canAddCommentTopLink: o(),
            canAddCommentBottomLink: a(),
            canDelete: s(),
            canBan: r(),
            canRemoveBan: l(),
            isHide: n(),
            showAddCommentInTop: c(),
            isNotConfirm: e.fromReal === f && !e.pub
        };
        function n() {
            return 0 === e.comments.length
        }
        function o() {
            return e.to === f ? e.lastReply !== f && 0 === e.comments.length : e.from === f && e.lastReply === e.to && 0 === e.comments.length
        }
        function a() {
            return e.to === f ? e.lastReply !== f && 0 < e.comments.length : e.from === f && e.lastReply === e.to && 0 < e.comments.length
        }
        function s() {
            return e.to === app.info.viewer_id || e.fromReal === f
        }
        function r() {
            return e.to === app.info.viewer_id && !e.isBlock
        }
        function l() {
            return e.to === app.info.viewer_id && e.isBlock && !e.isAnonymous
        }
        function d() {
            return i.canAddCommentTopLink || i.canAddCommentBottomLink || i.canBan || i.canDelete || i.canRemoveBan
        }
        function c() {
            return 0 === e.comments.length
        }
        function u() {
            i.setAttr({
                isHide: n(),
                canAddCommentTopLink: o(),
                canAddCommentBottomLink: a(),
                canDelete: s(),
                canBan: r(),
                canRemoveBan: l(),
                showAddCommentInTop: c()
            }),
            i.setAttr({
                formIsVisible: d()
            })
        }
        return i.formIsVisible = d(),
        e.comments.on("add", "self", u),
        e.comments.on("remove", "self", u),
        e.onChange("isBlock", u),
        e.onChange("lastReply", u),
        e.onChange("pub", u),
        p.onRemove(function() {
            e.comments.off("add", "self", u),
            e.comments.off("remove", "self", u),
            e.offChange("isBlock", u),
            e.offChange("lastReply", u),
            e.offChange("pub", u)
        }),
        i
    }
    ,
    p
}
,
lilo.viewFactories["item-comment-for-notification"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.createViewModel = function(e) {}
    ,
    t
}
,
lilo.viewFactories["item-daily-bonus-v2"] = function(e, t) {
    var s = lilo.baseViewFactory(e, t);
    return s.createViewModel = function(e) {
        for (var t = s.$(".coins"), i = 3, n = 0, o = 0; o < e.bonus; o += 1) {
            var a = document.createElement("i");
            a.style.zIndex = i--,
            t.append(a),
            n += 36,
            0 < o && (a.style.marginLeft = "-15px",
            n -= 15)
        }
        t.width(n),
        e.text || s.$(".label").remove()
    }
    ,
    s
}
,
lilo.viewFactories["item-deposit-friend"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.invite-personal": function() {
            this.trigger("invite-personal", {
                model: this.model
            })
        },
        "click@$.btn-add": function() {
            this.trigger("add", {
                model: this.model
            })
        }
    },
    i.createViewModel = function(e) {
        10 < e.price && i.el.addClass("has-reserving")
    }
    ,
    i
}
,
lilo.viewFactories["item-free-spin-gift"] = function(e, t) {
    var d = lilo.baseViewFactory(e, t);
    return d.createViewModel = function(e) {
        function t() {
            o.css("display", 1 === e.flag || 4 === e.flag ? "block" : "none"),
            a.css("display", 2 === e.flag ? "block" : "none"),
            s.css("display", 3 === e.flag ? "block" : "none"),
            r.css("display", 5 === e.flag ? "block" : "none")
        }
        var i, n, o = d.$(".state-initial"), a = d.$(".state-received"), s = d.$(".state-complete"), r = d.$(".state-reply-received"), l = {
            caption: (i = 4 === e.flag || 5 === e.flag,
            n = (2 === e.senderSex ? "прислал" : "прислала") + " вам",
            n += i ? " ответный подарок" : " 1 бесплатное вращение")
        };
        return t(),
        e.onChange("flag", t),
        d.el.on("click", ".receive", function() {
            d.trigger("receive", {
                model: d.model,
                view: d
            })
        }),
        d.el.on("click", ".reply", function() {
            d.trigger("reply", {
                model: d.model,
                view: d
            })
        }),
        l
    }
    ,
    d
}
,
lilo.viewFactories["item-friend-deposit"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.add-friend": function(e) {
            this.trigger("add-friend", {
                withPayment: $(e.target).hasClass("with-payment")
            })
        },
        "click@$.delete": function(e) {
            this.trigger("delete", {
                model: this.model
            })
        },
        "click@$.unlock": function(e) {
            this.trigger("unlock")
        },
        "click@$.profile-click": function(e) {
            this.trigger("profile-click", {
                model: this.model
            })
        },
        "click@$.extend-period": function(e) {
            this.trigger("extend-period", {
                model: this.model
            })
        }
    },
    i.createViewModel = function(e) {
        e.isPre && i.el.addClass("is-pre"),
        e.isFriend && i.el.addClass("can-extend-period"),
        i.$(".if-has-user")[e.isEmptyAndAllowable || e.isLocked ? "hide" : "show"](),
        i.$(".if-allowable")[e.isEmptyAndAllowable ? "show" : "hide"](),
        i.$(".if-locked")[e.isLocked ? "show" : "hide"](),
        e.id < 0 && i.el.addClass("is-fake")
    }
    ,
    i
}
,
lilo.viewFactories["item-friend-in-wf-exchange-dialog"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".button", function() {
        i.trigger("send", {
            model: i.model
        })
    }),
    i
}
,
lilo.viewFactories["item-gift"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.open-profile": function() {
            -1 !== this.model.from && i.trigger("show-profile", {
                uid: this.model.from
            })
        },
        "click@$.delete": function() {
            i.trigger("delete", {
                model: this.model
            })
        }
    },
    i.createViewModel = function(e) {
        var t;
        e.from ? ((t = lilo.createView("item-gift-popup")).setModel(e),
        i.$(".bubble").append(t.el),
        -1 === e.from && t.el.addClass("anonymous")) : i.$(".bubble").remove()
    }
    ,
    i
}
,
lilo.viewFactories["item-gift-popup"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["item-guest"] = function(e, t) {
    var i, n = lilo.baseViewFactory(e, t);
    return n.createViewModel = function(e) {
        var t;
        e.ad && n.$(".item-user").append($("<div/>").addClass("is-ad").attr("title", (2 === e.sex ? "Зашел" : "Зашла") + " из продвижения")),
        (i = (e.gid + "").contains("_")) && n.el.addClass("is-invisible"),
        e.firstName || e.photoUrl ? i || (t = !0,
        app.sdk.viewComponents.profileMenu(n.$(".item-user"), e.gid)) : n.el.hide(),
        t || n.el.on("click", ".item-user", function() {
            this.trigger("show-profile", {
                uid: this.model.gid
            })
        })
    }
    ,
    n
}
,
lilo.viewFactories["item-harem"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.remove": function(e) {
            return this.trigger("delete", {
                model: this.model
            }),
            e.stopPropagation(),
            !1
        },
        "click@$.item-user": function() {
            this.trigger("show-profile", {
                model: this.model
            })
        },
        "click@$.out-buy": function(e) {
            return this.trigger("out-buy", {
                model: this.model
            }),
            e.stopPropagation(),
            !1
        },
        "click@$.send-gift": function(e) {
            return this.trigger("send-gift", {
                model: this.model
            }),
            e.stopPropagation(),
            !1
        }
    },
    i.createViewModel = function(e) {
        1 === app.info.sex && i.el.addClass("viewer-is-female"),
        e.canSendMoney || i.$(".send-gift").remove()
    }
    ,
    i
}
,
lilo.viewFactories["item-in-dialog-select-region"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", function() {
        i.trigger("select", {
            model: i.model
        })
    }),
    i.createViewModel = function(e) {
        var t = {
            flag: null
        };
        return e.isCountry && 0 < e.id && e.id < 5 ? t.flag = "../res/flags/{0}.png".format(e.id) : i.$(".flag").remove(),
        t
    }
    ,
    i
}
,
lilo.viewFactories["item-offer"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@el": function(e) {
            this.trigger("selectItem", {
                model: this.model
            })
        }
    },
    t
}
,
lilo.viewFactories["item-photo"] = function(e, t) {
    var r = lilo.baseViewFactory(e, t);
    return r.handlers = {
        "click@el": function() {
            this.trigger("open-photo", {
                model: this.model
            })
        },
        "click@$.send-to-moderation": function(e) {
            return this.trigger("send-to-moderation", {
                model: this.model
            }),
            e.stopPropagation(),
            e.preventDefault(),
            !1
        },
        "click@$.set-as-avatar": function(e) {
            return this.trigger("set-as-avatar", {
                model: this.model
            }),
            e.stopPropagation(),
            e.preventDefault(),
            !1
        },
        "click@$.delete-photo": function(e) {
            return e.stopPropagation(),
            e.preventDefault(),
            this.trigger("delete-photo", {
                model: this.model
            }),
            !1
        }
    },
    r.createViewModel = function(n) {
        function e() {
            var i = 0;
            return a.each(function(e, t) {
                i += n[t]
            }),
            i
        }
        var o, t, a = ["c1", "c2", "c3", "c4", "c5", "c6"], i = {
            totalCounter: e()
        };
        n.ownerId === app.info.viewer_id ? ((o = document.createElement("div")).className = "status",
        r.el.append(o),
        n.onChange("status", t = function() {
            r.el[3 === n.status ? "addClass" : "removeClass"]("confirmed");
            var e = app.commonState.verificationPhoto
              , t = e && 3 === e.s;
            switch (n.status) {
            case 1:
                o.innerHTML = "<div class='initial'> <table><tr><td><div>Это фото не проверено<br>Кроме вас никто его не видит</div></td></tr></table> <div class='btn white send-to-moderation'>Отпрaвить на проверку</div></div>";
                break;
            case 2:
                o.innerHTML = "<div class='on-moderation'>На проверке</div>";
                break;
            case 3:
                n.isAvatar ? o.innerHTML = "" : o.innerHTML = t ? "<div class='confirmed'><div class='btn white set-as-avatar'>Использ. как авку</div></div>" : "";
                break;
            case 4:
                var i = VerificationRejectReasons.get(n.rejectReasonId) || "";
                o.innerHTML = "<table class='rejected'><tr><td><div><span>Отклонено</span>{0}</div></td></tr></table>".format(i ? "<div class='reason'>" + i + "</div>" : "")
            }
        }
        ),
        n.onChange("rejectReasonId", t),
        n.onChange("isAvatar", t),
        t(),
        window.profileModel && window.profileModel.onChange("avatar", t),
        app.commonState.onChange("pid", t),
        app.commonState.onChange("verificationPhoto", t)) : r.el.addClass("confirmed");
        function s() {
            i.setAttr({
                totalCounter: e()
            })
        }
        return a.each(function(e, t) {
            n.onChange(t, s)
        }),
        i
    }
    ,
    r
}
,
lilo.viewFactories["item-photo-for-select"] = function(e, t) {
    var i, n = lilo.baseViewFactory(e, t), o = !1;
    return n.handlers = {
        "click@el": function() {
            n.model.existing ? dialogController.showMessageDialog({
                message: "Вы уже добавляли это фото"
            }) : i && (o ? this.trigger("select-photo", {
                model: this.model
            }) : dialogController.showMessageDialog({
                message: "Нельзя добавлять фотографию, у которой одна из сторон в несколько раз превышает другую. Фотография должна иметь размер не менее 200 пикселей и не больше 7000 пикселей по каждой из сторон."
            }))
        }
    },
    n.createViewModel = function(e) {
        var t = new Image;
        t.onload = function() {
            o = util.isValidImage(t),
            i = !0,
            o || n.el.addClass("invalid")
        }
        ,
        t.src = e.photo_604,
        e.existing && n.el.addClass("existing")
    }
    ,
    n
}
,
lilo.viewFactories["item-purchase-v3"] = function(e, t) {
    var n = lilo.baseViewFactory(e, t);
    return n.handlers = {
        "click@$.btn": function() {
            this.trigger("purchase", {
                model: this.model
            })
        }
    },
    n.createViewModel = function(e) {
        "item_206" === e.itemName || "item_506" === e.itemName ? n.$(".icon").addClass("profit") : "item_203" !== e.itemName && "item_503" !== e.itemName || n.$(".icon").addClass("popular"),
        0 === e.freeBonus && n.$(".free-bonus-wrap").css("visibility", "hidden"),
        n.el.addClass((1 === e.currency ? "coins_" : "rubies_") + e.index);
        function t() {
            return e.bonusRatio ? "+{0} в подарок по акции!".format(Math.floor((e.bonus + e.freeBonus) * e.bonusRatio)) : ""
        }
        var i = {
            extraBonusText: t(),
            isCoins: 1 === e.currency
        };
        return e.onChange("multiplier", function() {
            i.setAttr({
                extraBonusText: t()
            })
        }),
        e.onChange("bonusRatio", function() {
            i.setAttr({
                extraBonusText: t()
            })
        }),
        i
    }
    ,
    n
}
,
lilo.viewFactories["item-recent-like-v2"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.click(function() {
        i.trigger("click", {
            model: i.model
        })
    }),
    i
}
,
lilo.viewFactories["item-recent-photo"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@el": function() {
            this.trigger("open", {
                model: this.model
            })
        }
    },
    t
}
,
lilo.viewFactories["item-recent-private-message"] = function(e, t) {
    var p = lilo.baseViewFactory(e, t);
    return p.el.on("click", ".delete", function(e) {
        return p.trigger("delete", {
            model: p.model,
            $btnEl: $(e.currentTarget)
        }),
        e.preventDefault(),
        e.stopPropagation(),
        !1
    }),
    p.el.click(function() {
        p.trigger("open", {
            model: p.model
        })
    }),
    p.createViewModel = function(t) {
        function e() {
            var e = "";
            switch (p.el.removeClass("has-bonus"),
            t.state) {
            case n.STATE_REQUEST:
                t.type === o.TYPE_GOLD ? (c = "<span class='gold'>Золотое сообщение</span>",
                e = "gold-request",
                p.el.addClass("has-bonus")) : e = t.type === o.TYPE_GOLD_RECEIVED ? (c = "<span class='gold'>Золотое сообщение</span>",
                "gold-request") : t.type === o.P2P_INVITE ? (c = "Новое сообщение",
                "video-request") : (c = "Новое сообщение",
                "request");
                break;
            case n.STATE_RESPONSE:
            case n.STATE_RESPONSE_REMOVE:
                switch (c = "Ответное сообщение",
                t.type) {
                case o.TYPE_GOLD:
                case o.TYPE_GOLD_RECEIVED:
                    e = "response-gold";
                    break;
                case o.P2P_INVITE:
                    e = "response-video";
                    break;
                default:
                    e = "response"
                }
                break;
            default:
                c = ""
            }
            -1 === t.from && t.z1 && (c = t.type === o.TYPE_GOLD ? "<span class='gold'>Золотая валентинка</span>" : "<span class='valentine'>Валентинка</span>"),
            u && u.__isObservable && u.setAttr({
                messageTypeText: c
            }),
            p.el.removeClass("gold-request request response gold-response").addClass(e)
        }
        var i = app.info.viewer_id
          , n = app.PrivateMessageState
          , o = app.PrivateMessageType
          , a = ""
          , s = t.from === i ? t.toAvatar : t.fromAvatar
          , r = t.from === i ? t.toExp : t.fromExp
          , l = t.from === i ? t.toFirstName : t.fromFirstName
          , d = !!(t.from === i ? t.toVF : t.fromVF)
          , c = ""
          , a = -1 === t.from && t.z1 ? (s = CDN_PREFIX + "iconfinder_heart-arrow_2903242.svg",
        c = t.type === o.TYPE_GOLD ? "<span class='gold'>Золотая валентинка</span>" : "<span class='valentine'>Валентинка</span>",
        "aнонимно") : (i = document.createElement("div"),
        lilo.getSimpleBindHandler("date-with-time")($(i), t.ts),
        i.innerHTML);
        e(),
        t.onChange("type", e),
        t.onChange("state", e);
        var u = {
            avatar: s,
            exp: r,
            name: l,
            vf: d,
            messageTypeText: c,
            timeText: a
        };
        return u
    }
    ,
    p
}
,
lilo.viewFactories["item-room-gift-v3"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.createViewModel = function(e) {
        var t;
        return e.bonus && i.$(".bonus").html("<span>Бонус</span> <b>+{0}</b><i class='coin-icon-el'></i>".format(e.bonus)).show(),
        e.isForBeginner ? (i.el.addClass("beginner"),
        e.setAttr({
            price: "Бесплатно"
        }),
        i.el.bind("click", ".hint-area", function(e) {
            return i.trigger("click", {
                model: i.model,
                view: i
            }),
            e.stopPropagation(),
            e.preventDefault(),
            !1
        })) : (i.el.bind("click", ".hint-area", function(e) {
            return i.trigger("hover", {
                model: i.model,
                view: i
            }),
            e.stopPropagation(),
            e.preventDefault(),
            !1
        }),
        t = function() {
            i.trigger("blur", {
                model: i.model,
                view: i,
                toElement: null
            })
        }
        ,
        $document.on("click", t),
        i.onRemove(function() {
            $document.off("click", t)
        })),
        {
            isRubyPrice: !!e.rubyPrice,
            isCoinsPrice: !!e.price || app.info.roomGiftMelodyId === e.id
        }
    }
    ,
    i
}
,
lilo.viewFactories["item-room-preview"] = function(e, t) {
    var o = lilo.baseViewFactory(e, t);
    return o.$(".bg").each(function(e, t) {
        for (var i = 0; i < 6; i += 1)
            this.appendChild(document.createElement("i"))
    }),
    o.handlers = {
        "click@el": function() {
            this.trigger("select", {
                model: this.model
            })
        }
    },
    o.createViewModel = function(n) {
        o.el.attr({
            room_id: n.roomId,
            spent: n.spent,
            messages: n.chatMessagesCount,
            tracks: n.tracksCount
        }),
        n.isNotEnough && o.el.addClass("is-not-enough"),
        n.roomId.startWith("10_") && (o.el.addClass("is-private-room"),
        o.el.append($("<div/>").addClass("delete-invite").click(function() {
            o.trigger("delete", {
                model: n
            })
        })));
        var e, t = {
            expLimit: 0
        };
        return n.accessDescr ? (2 === n.accessDescr.type ? e = "Песочница" : 1 === n.accessDescr.type ? e = "" : 3 === n.accessDescr.type ? e = "Только игроки {0}+ уровня".format(n.accessDescr.level) : 4 === n.accessDescr.type ? e = "Только " + util.fixRegionName(n.accessDescr.regionId, n.accessDescr.regionName) : 5 === n.accessDescr.type ? e = "Только " + n.accessDescr.countryName : 6 === n.accessDescr.type && (e = "lottery round"),
        e ? (t.expLimit = "<div>" + e + "</div>" + (n.radioType === RadioPlayerType.YOUTUBE ? "<i class='yt-icon-container'><i class='yt-icon'></i></i>" : ""),
        o.el.addClass("has-exp-limit")) : n.radioType === RadioPlayerType.YOUTUBE && (t.expLimit = "<i class='yt-icon-container'><i class='yt-icon'></i></i>",
        o.el.addClass("show-exp-limit"))) : n.radioType === RadioPlayerType.YOUTUBE && (t.expLimit = "<i class='yt-icon-container'><i class='yt-icon'></i></i>",
        o.el.addClass("show-exp-limit")),
        n.roomId && n.roomId.startWith("10_") && (n.updateView = function() {
            var e, t, i;
            n.roomOwnerAvatar && n.roomOwnerFirstName ? (e = $(document.createElement("span")).addClass("owner-avatar").css("background-image", "url(" + n.roomOwnerAvatar + ")"),
            t = $(document.createElement("span")).addClass("owner-first-name").html(util.escapeHtml(n.roomOwnerFirstName, 0, 1) + " " + (n.roomOwnerLastName ? util.escapeHtml(n.roomOwnerLastName, 0, 1) : "")),
            i = $("<b>Хозяин:</b>"),
            o.$(".owner-info").empty().append(i).append(e).append(t).show()) : util.isDef(n.isActivePrivateRoom) && !n.isActivePrivateRoom ? o.$(".owner-info").empty().html("<span>Пустая комната</span>").show() : o.$(".owner-info").empty().hide()
        }
        ),
        t
    }
    ,
    o
}
,
lilo.viewFactories["item-room-questions-editor-answer"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.remove": function() {
            this.trigger("delete")
        }
    },
    t
}
,
lilo.viewFactories["item-room-top-list"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = i.$(".gifts-rating-popup");
    return i.el.on("click", ".avatar", function() {
        i.trigger("show-profile", {
            model: i.model
        })
    }),
    i.createViewModel = function(e) {
        -1 === e.uid && (i.el.addClass("anonymous-user"),
        e.setAttr({
            avatar: app.ANONYMOUS_IMG
        }));
        function t() {
            n.css("display", e.popupHtmlText ? "" : "none")
        }
        t(),
        e.onChange("popupHtmlText", t),
        i.el.attr("win-value", e.winValue)
    }
    ,
    i
}
,
lilo.viewFactories["item-room-user-v3"] = function(e, t) {
    var Ue = lilo.baseViewFactory(e, t)
      , Le = Ue.$(".gifts-area")
      , Fe = Ue.$(".gifts-canvas").attr("canvas-id", util.nextCounter() + "")
      , Ve = Ue.$(".gifts-extra-area")
      , Be = Ue.$(".message-in-icon")
      , $e = Ue.$(".message-out-icon")
      , Ge = Ue.$(".message-out-icon .triangle")
      , He = Ue.els["out-chat-message-text"]
      , We = (Ue.$(".away"),
    Ue.$(".away-status"))
      , je = app.info.viewer_id
      , h = 2 === app.info.sex
      , Ke = Ue.$(".popup-mouse-overlay")
      , Ye = Ue.$(".recent-gifts-popup")
      , qe = Ue.$(".vote-info")
      , ze = Ue.$(".couple-counter")
      , Xe = Ue.$(".name span")
      , Qe = Ue.$(".user-area")
      , Je = Ue.$(".bets")
      , Ze = Ue.$(".ranks-badges")
      , et = Ue.$(".ranks-lines")
      , tt = Ue.$(".rank-room-owner")
      , it = Ue.$(".rank-wastefulness")
      , nt = Ue.$(".rank-popularity")
      , ot = Ue.$(".rank-fortunate")
      , at = Ue.$(".rank-dj")
      , st = Ue.$(".rank-cool-likes")
      , rt = Ue.$(".gifts-rating")
      , lt = Ue.$(".gifts-rating .popularity>span")
      , dt = Ue.$(".gifts-rating .fortunate>span")
      , ct = Ue.$(".gifts-rating .wastefulness>span")
      , ut = Ue.$(".gifts-rating .room-owner>span")
      , pt = Ue.$(".ranks-lines .rank-room-owner span")
      , ft = Ue.$(".item-rank.popularity")
      , mt = Ue.$(".item-rank.fortunate")
      , vt = Ue.$(".item-rank.wastefulness")
      , ht = Ue.$(".item-rank.dj")
      , gt = Ue.$(".item-rank.room-owner")
      , bt = Ue.$(".popup")
      , Ct = Ue.$(".popularity .gifts-rating-popup span, .rank-popularity .gifts-rating-popup span")
      , _t = Ue.$(".fortunate .gifts-rating-popup span, .rank-fortunate .gifts-rating-popup span")
      , wt = Ue.$(".wastefulness .gifts-rating-popup span, .rank-wastefulness .gifts-rating-popup span")
      , Et = Ue.$(".dj .gifts-rating-popup span, .rank-dj .gifts-rating-popup span")
      , yt = Ue.$(".show-fade-arrows")
      , Dt = (Ue.$(".name"),
    Ue.$(".select"))
      , Tt = Ue.$(".house")
      , St = Ue.$(".mobi-status")
      , At = Ue.$(".cake")
      , It = Ue.$(".verified")
      , Mt = Ue.$(".btn-send-gift-for-beginner")
      , Ot = !1
      , xt = app.controllers.Emoji;
    Ue.el.addClass(2 === app.info.sex ? "viewer-is-male" : "viewer-is-female");
    var Rt, kt, Pt = "animated", Nt = 2500, Ut = 0, Lt = 0;
    function Ft(t, l) {
        l = l || {},
        this.abort = function() {
            p && p.parentNode && p.parentNode.removeChild(p)
        }
        ;
        function d() {
            var e;
            u === je && t.expBonus && (e = roomView.getViewerOffset(),
            expController.animateBonus({
                incValue: t.expBonus,
                sourceOffset: {
                    left: e.left + 35,
                    top: e.top - 20
                }
            }))
        }
        var c = t.from
          , u = t.to;
        if (c === je && u === je || c === u)
            return this.start = d,
            this;
        var p = document.createElement("div")
          , f = p.style
          , m = roomView.findElByUid(c);
        p.className = "icon-cool-animated pe-none",
        l.elementClass && p.classList.add(l.elementClass),
        m && (l.fromCenter && (f.top = "30px"),
        m.children().append(p));
        function v() {
            p.parentNode && p.parentNode.removeChild(p)
        }
        this.start = function() {
            try {
                var e, t, i, n, o, a, s, r = roomView.findElByUid(u);
                m && r ? (e = m.children().offset(),
                t = r.children().offset(),
                i = !1,
                (n = roomModel.findUser(c)) && h !== n.male && (i = !0),
                e.left += 27,
                l.fromCenter ? e.top += 30 : e.top += i ? 80 : -86,
                o = e.left - t.left,
                a = e.top - t.top,
                f.left = "0px",
                f.top = "0px",
                (s = $(p)).css("transform", "translate(" + o + "px," + a + "px)"),
                r.children().append(p),
                setTimeout(function() {
                    s.css("transform", "translate(27px,30px)"),
                    setTimeout(function() {
                        v(),
                        d()
                    }, 1500)
                }, 100)) : v()
            } catch (e) {
                v()
            }
        }
    }
    var Vt = 7100
      , Bt = app.ChatMessageType
      , i = null;
    function $t() {
        i && (i.abort(),
        i = null)
    }
    function Gt() {
        $t(),
        clearTimeout(kt),
        $e.hide().removeClass(Pt).removeClass("like-sound  sticker"),
        He.html(""),
        Lt = 0
    }
    var Ht = t.containerEl.hasClass("top-users");
    Ue.el.addClass(Ht ? "top" : "bottom"),
    Ue.handlers = {
        "mouseover@$.close-area": function() {
            bt.css("display", "none"),
            setTimeout(function() {
                bt.css("display", "")
            }, 100)
        },
        "mousemove@$.close-area": function() {
            bt.css("display", "none"),
            setTimeout(function() {
                bt.css("display", "")
            }, 100)
        },
        "click@$.resque-btn": function() {
            Ue.trigger("resque", {
                model: this.model
            })
        },
        "click@$.show-fade-arrows": function() {
            this.trigger("show-fade-arrows", {
                model: this.model
            })
        },
        "click@$.close-area": function() {
            bt.css("display", "none"),
            setTimeout(function() {
                bt.css("display", "")
            }, 100)
        },
        "click@$.name span": function(e) {
            return this.trigger("select-first-name", {
                model: this.model
            }),
            e.stopPropagation(),
            !1
        },
        "click@$.popup-mouse-overlay": function(e) {
            return e.preventDefault(),
            e.stopPropagation(),
            this.trigger("choice", {
                model: this.model,
                $el: Ue.el
            }),
            !1
        },
        "click@$.select": function(e) {
            return e.stopPropagation(),
            this.trigger("select", {
                model: this.model,
                $btn: Dt
            }),
            !1
        },
        "click@$.open-avatar-dialog": function(e) {
            e.stopPropagation(),
            this.trigger("open-avatar-dialog")
        }
    };
    e = Ue.handlers,
    t = "click";
    e[t + "@$.open-profile-btn"] = function(e) {
        return e.stopPropagation(),
        this.trigger("open-profile", {
            model: this.model
        }),
        !1
    }
    ,
    e[t + "@$.add-gift-btn"] = function(e) {
        return e.stopPropagation(),
        this.trigger("add-gift", {
            model: this.model
        }),
        !1
    }
    ,
    e[t + "@$.btn-send-gift-for-beginner"] = function(e) {
        return e.stopPropagation(),
        this.trigger("add-gift-beginner", {
            model: this.model
        }),
        2 <= roomView.incCountOfClicksOnBeginnerHint() && roomView.toggleBeginnersHint(),
        !1
    }
    ,
    e[t + "@$.fav-btn"] = function(e) {
        return e.stopPropagation(),
        this.trigger("toggle-fav", {
            $targetEl: $(e.target),
            model: this.model
        }),
        !1
    }
    ,
    e[t + "@$.p2p-invite-btn"] = function(e) {
        return e.stopPropagation(),
        this.trigger("p2p-invite", {
            $targetEl: $(e.target),
            model: this.model
        }),
        !1
    }
    ,
    e[t + "@$.send-private-message"] = function(e) {
        return e.stopPropagation(),
        Ue.trigger("send-private-message", {
            model: Ue.model
        }),
        !1
    }
    ,
    e[t + "@$.ban-btn"] = function(e) {
        e.stopPropagation();
        e = $(e.target);
        return this.trigger("toggle-ban", {
            model: this.model,
            $targetEl: e
        }),
        !1
    }
    ,
    e[t + "@$.complain-age-btn"] = function(e) {
        e.stopPropagation();
        e = $(e.target);
        return this.trigger("complain-age", {
            model: this.model,
            $targetEl: e
        }),
        !1
    }
    ,
    e[t + "@$.kick"] = function(e) {
        e.stopPropagation(),
        this.trigger("kick", {
            $targetEl: $(e.target),
            model: this.model,
            view: Ue
        })
    }
    ;
    var Wt = 1
      , jt = 2
      , Kt = 3;
    Ue.animateLuckyBonus = function(e, t) {
        new Ft({
            from: e,
            to: je,
            expBonus: t
        },{
            elementClass: "lucky-bonus"
        }).start()
    }
    ;
    var Yt = "answered";
    return Ue.createViewModel = function(v) {
        IS_DESKTOP || ($body.click(function() {
            Ue.el.removeClass("open-popup")
        }),
        app.eventBus.on("open-room-user-popup", function(e) {
            e.uid !== v.uid && Ue.el.removeClass("open-popup")
        }));
        function t() {
            e(Ue.els.wins, o)
        }
        var i, n, h = {
            isFav: d(),
            isFavVisible: d() && !v.hasBDate,
            isBlockVisible: c() && !v.hasBDate,
            favText: u(),
            isBlocked: p(),
            banText: f()
        }, o = 0, a = function() {
            function e(e, t, i) {
                return i = {
                    $el: e,
                    height: t,
                    primary: !!(i = i || {}).primary,
                    isToggleBtn: !!i.isToggleBtn,
                    textForMobi: "",
                    handlerForMobi: $.noop
                },
                e.addClass("popup-menu-item"),
                o.push(i),
                e.__itemData = i,
                e
            }
            function n() {
                var i = 0;
                v.uid === je ? i = 30 : $.each(o, function(e, t) {
                    "none" !== t.$el.css("display") && (!t.primary && (t.isToggleBtn ? a : !a) || (i += t.height))
                }),
                bt.height(i).css("top", (100 - i) / 2 + "px"),
                p.css("top", (i - 8) / 2 + "px")
            }
            var o = [];
            bt.append(e($('<span class="open-profile-btn">Открыть профиль</span>'), 30, {
                primary: !0
            })),
            bt.append(e($('<span class="send-private-message"><span class="send-private-message-envelope"></span>Сообщение</span>'), 30, {
                primary: !0
            })),
            bt.append(e($('<span class="add-gift-btn"><i></i>Подарок <em>*клик на авку</em> </span>'), 37, {
                primary: !0
            }));
            function t(e) {
                (a = e) ? (s.css("display", "none"),
                i.css("display", "block")) : (i.css("display", "none"),
                s.css("display", "block")),
                n()
            }
            var i = $(document.createElement("div")).addClass("extra-items").appendTo(bt)
              , a = !1
              , s = e($('<span class="open-extra-menu"><i></i>Еще...</span>'), 30, {
                isToggleBtn: !0
            });
            bt.append(s),
            s.click(function(e) {
                return t(!0),
                e.preventDefault(),
                e.stopPropagation(),
                !1
            });
            var r = e($('<span class="fav-btn">' + h.favText + "</span>"), 30);
            i.append(r);
            var l = e($('<span class="p2p-invite-btn">Видео чат</span>'), 30);
            i.append(l);
            var d = e($('<span class="ban-btn">' + h.banText + "</span>"), 30);
            i.append(d),
            setTimeout(function() {
                d.text(h.banText),
                r.text(h.favText),
                h.onChange("banText", function() {
                    d.text(h.banText),
                    d.__itemData.textForMobi = h.banText
                }),
                h.onChange("favText", function() {
                    r.text(h.favText),
                    r.__itemData.textForMobi = h.favText
                }),
                n()
            }, 0);
            var c = e($('<span class="complain-age-btn">Пожаловаться</span>'), 30);
            i.append(c);
            var u = e($('<span class="kick">Исключить из<br/>комнаты</span>'), 30);
            i.append(u);
            var p = $("<div class='arrow'></div>");
            IS_DESKTOP && (bt.append(p),
            bt.append($("<div class='close-area'></div>"))),
            t(!1);
            var f, m = Ke[0];
            return Ke.on("mouseout", function(e) {
                !function(e) {
                    var t = e.toElement;
                    if (t = t || e.originalEvent.relatedTarget) {
                        if (t === m)
                            return !0;
                        for (; t.parentNode; ) {
                            if (t.parentNode === m)
                                return !0;
                            t = t.parentNode
                        }
                    }
                    return !1
                }(e) && (clearTimeout(f),
                f = setTimeout(function() {
                    t(!1)
                }, 200))
            }),
            {
                getButtonsForMobi: function() {
                    var i = [];
                    return Ue.model.uid === je ? Ue.el.hasClass("can-clear-gifts") && i.push({
                        title: "Очистить аватарку <b>3</b><b class='smart-coin'></b>",
                        handler: function() {
                            return Ue.trigger("clear-avatar"),
                            !1
                        }
                    }) : $.each(o, function(e, t) {
                        "none" !== t.$el.css("display") && i.push({
                            title: t.textForMobi,
                            handler: function() {
                                return t.handlerForMobi(),
                                !1
                            }
                        })
                    }),
                    i
                },
                toggleCompliant: function(e) {
                    c.css("display", e ? "block" : "none"),
                    n()
                },
                updateInviteToConferenceView: function() {
                    var e = v.uid && !roomModel.isConference();
                    l.css("display", e ? "block" : "none"),
                    n()
                },
                toggleVisibilityOfP2PInviteBtn: function(e) {
                    l.css("display", e ? "block" : "none")
                },
                toggleKick: function(e) {
                    var t = !1;
                    e = e || {};
                    var i = Ue.model.deportationModel;
                    i && !i.initiatorId && (v.uid !== je && (t = !v.isRoomOwner && (roomModel.wastefulUid === app.info.viewer_id || roomModel.popularUid === app.info.viewer_id || (!!(e.level && 30 <= e.level) || 30 <= expController.getCurrentLevel()))),
                    roomModel.viewerIsOwnerOfRoom && v.uid !== je && (t = !0)),
                    u.css("display", t ? "block" : "none"),
                    n()
                },
                hideKick: function() {
                    u.css("display", "none"),
                    n()
                }
            }
        }();
        function e(e, t) {
            0 < (t = t || 0) ? (e.$icon || (e.$icon = e.find("i")),
            (e.$text || (e.$text = e.find("span"))).text(t),
            e.show()) : e.hide()
        }
        Ue.popupModel = a;
        var s, r = expController.levelToExp(7);
        function l() {
            var e = !1;
            v.uid && v.uid !== je && v.exp < r && expController.getCurrentExp() >= r && roomModel.accessDescr && 2 === roomModel.accessDescr.type && (v.male && app.info.giftsMeta.hasGiftsForMalesBeginners || !v.male && app.info.giftsMeta.hasGiftsForFemalesBeginners) && (v.counterMapOfGiftsForBeginners[je] || (e = !0));
            var t = !1;
            return s !== e && (t = !0,
            s = e,
            Mt.css("display", e ? "block" : "none"),
            Ue.el[e ? "addClass" : "removeClass"]("has-beginner-btn")),
            {
                stateIsChanges: t,
                isVisible: e
            }
        }
        function d() {
            return !!app.info.favUsersUids[v.uid]
        }
        function c() {
            return !!app.info.blockedUids[v.uid]
        }
        function u() {
            return d() ? "Удалить из избр." : "Добавить в избр."
        }
        function p() {
            return !!app.info.blockedUids[v.uid]
        }
        function f() {
            return p() ? "Разблокировать" : "Заблокировать"
        }
        function m() {
            v.state === jt ? We.removeClass("gray").addClass("green") : v.isAway ? We.removeClass("green").addClass("gray") : We.removeClass("green gray"),
            Ne()
        }
        function g() {
            var e;
            v.state === Wt ? Ue.el.removeClass(Yt) : v.state === Kt || (v.state === jt ? v.uid === je ? Ue.el.addClass(Yt) : (e = 110 + util.nextCounter() % 4 * 60,
            clearTimeout(i),
            i = setTimeout(function() {
                v.state === jt ? Ue.el.addClass(Yt) : Ue.el.removeClass(Yt)
            }, e)) : Ue.el.removeClass(Yt)),
            m()
        }
        function b() {
            h.__isObservable ? h.setAttr({
                isFav: d(),
                isFavVisible: d() && !v.hasBDate,
                favText: u()
            }) : (h.isFav = d(),
            h.isFavVisible = d() && !v.hasBDate,
            h.favText = u()),
            Ne()
        }
        function C() {
            h.__isObservable ? h.setAttr({
                isBlocked: p(),
                banText: f(),
                isBlockVisible: c()
            }) : (h.isBlocked = p(),
            h.banText = f(),
            h.isBlockVisible = c())
        }
        function _() {
            window.prevGiftPopupView && (window.prevGiftPopupView.remove(),
            window.prevGiftPopupView = null)
        }
        window.prevGiftPopupView = null;
        var w = "popup-of-game-gift";
        function E(e, t) {
            _();
            var i = new app.models.PopupModel(t,Ue.model.uid,Ue.model.male ? 2 : 1,{
                rawGiftsHash: rawGiftsHash
            })
              , n = lilo.createView(w);
            n.setModel(i),
            window.prevGiftPopupView = n,
            e.appendChild(n.el[0]),
            n.el.css({
                left: "45px",
                top: 0,
                opacity: 0,
                "margin-top": "50%"
            }),
            setTimeout(function() {
                var e = n.el.outerHeight() / 2;
                Ht && (e = Math.min(e, 45)),
                n.el.css({
                    top: -e + "px",
                    opacity: 1
                }),
                n.arrowToCenter(2 * e)
            }, 120),
            n.el.on("mouseout", function(e) {
                !function(e) {
                    var t = e.toElement;
                    if (t = t || e.originalEvent.relatedTarget) {
                        if ("arrow" === t.className || t.className === w)
                            return 1;
                        for (; t.parentNode; ) {
                            if (t.parentNode.className === w)
                                return 1;
                            t = t.parentNode
                        }
                    }
                }(e) && _()
            }),
            n.bind("click-item", function(e) {
                Ue.trigger("send-gift-from-popup", {
                    model: Ue.model,
                    popupItemModel: e.extraData.model,
                    gift: t
                }),
                e.extraData.event.stopPropagation(),
                e.extraData.event.preventDefault(),
                Ke.css("display", "none"),
                setTimeout(function() {
                    Ke.css("display", "block")
                }, 250)
            }),
            n.el.click(function(e) {
                return e.stopPropagation(),
                !1
            })
        }
        app.eventBus.on(app.EVENTS.UPDATE_FREQ_GIFTS, function() {
            v.uid && v.uid !== je && (_(),
            D())
        });
        var y = function(e) {
            e = 2 === app.info.sex ? 2 === e ? 1 : 2 : 2 === e ? 3 : 4;
            return e
        };
        function D() {
            var e, a = document.createDocumentFragment(), s = 0;
            v.uid && v.uid !== je && (e = y(v.male ? 2 : 1),
            (e = app.info.freqGiftsData[e]).length = Math.min(e.length, 3),
            e.each(function(e, t) {
                var i, n, o = rawGiftsHash[t];
                o && ((i = document.createElement("div")).style.backgroundImage = "url(" + o.img + ")",
                i.className = "item-recent-gift",
                i.onclick = function(e) {
                    return E(i, o),
                    e.stopPropagation(),
                    e.preventDefault(),
                    !1
                }
                ,
                n = document.createElement("div"),
                t = o.price || app.info.roomGiftMelodyId === o.id ? 1 : 2,
                n.innerHTML = "<b>{0}</b> <span class='{1}'></span>".format(1 == t ? o.price : o.rubyPrice, 1 == t ? "smart-coin" : "smart-ruby"),
                n.className = "recent-gift-price",
                i.appendChild(n),
                a.appendChild(i),
                s += 1)
            })),
            Ye.empty().append(a).css("display", s ? "" : "none"),
            s && (Ye.css({
                height: (e = 50 * s + (s ? s - 1 : 0)) + "px",
                top: -e / 2 + "px"
            }),
            Ye[1 === s ? "addClass" : "removeClass"]("has-one-item"))
        }
        function T() {
            var e = !1;
            v.uid && util.isVKPlatform() && 1 === v.clientType && (e = !0),
            a.toggleVisibilityOfP2PInviteBtn(e)
        }
        function S() {
            Ue.el.attr("uid", v.uid),
            o = 0,
            t(),
            Ue.els.wins.uid = null,
            n = v.uid,
            roomView.removeUsersGiftsDataByElementId(Fe.attr("canvas-id")),
            Ue.el[v.uid === app.info.viewer_id ? "addClass" : "removeClass"]("is-viewer"),
            Ue.el[app.missLovesUids[v.uid] ? "addClass" : "removeClass"]("miss-victress"),
            b(),
            C(),
            De(),
            a.toggleKick(),
            v.uid || Ue.el.removeClass("show-beginner-hint");
            var e = l();
            IS_DESKTOP || Ue.el.removeClass("open-popup"),
            $t(),
            e.stateIsChanges && roomView.toggleBeginnersHint(),
            D(),
            a.updateInviteToConferenceView(),
            T()
        }
        var A, I, M, O, x, R, k, P, N, U, L, F, V, B, G, H, W, j, K, Y, q, z, X, Q, J, Z, ee = Fe[0].getContext("2d");
        function te() {
            v.isEmpty ? (Ue.el.addClass("is-empty").removeClass("selected-by-user hovered"),
            ee.clearRect(0, 0, Fe[0].width, Fe[0].height),
            Fe.empty().removeData(),
            roomView.removeUsersGiftsDataByElementId(Fe.attr("canvas-id")),
            Le.empty(),
            Ve.empty(),
            clearTimeout(Rt),
            Be.hide().removeClass(Pt),
            Ut = 0,
            Gt(),
            Ue.el.removeClass("has-note-gift")) : Ue.el.removeClass("is-empty")
        }
        function ie() {
            Ue.el[v.vkDataIsLoading ? "addClass" : "removeClass"]("vk-data-is-loading")
        }
        function ne() {
            v.isSelectedByViewer ? Dt.addClass("blue").removeClass("loading").html("Выбрано") : Dt.removeClass("blue loading").html("Выбрать")
        }
        function oe() {
            Ue.el[v.isSelectableByFirstPos ? "addClass" : "removeClass"]("is-selectable-by-first-pos")
        }
        function ae() {
            Ue.el[v.isSelectableBySecondPos ? "addClass" : "removeClass"]("is-selectable-by-second-pos")
        }
        function se() {
            Ue.el[v.isLocking ? "addClass" : "removeClass"]("is-locking")
        }
        function re() {
            Ue.el[v.isWinner ? "addClass" : "removeClass"]("is-winner"),
            v.isWinner && (setTimeout(function() {
                v.uid === n && (o++,
                t())
            }, 2800),
            app.soundManager.play(app.soundManager.SOUND_IDS.WIN_CROWN))
        }
        function le() {
            var e, t, i, n, o, a, s, r;
            !v.outgoingMessage || v.outgoingMessage.type !== Bt.NORMAL && v.outgoingMessage.type !== Bt.TALK && v.outgoingMessage.type !== Bt.COOL_TRACK && v.outgoingMessage.type !== Bt.LIKE_SOUND || (e = v.outgoingMessage,
            s = util.currentMillis(),
            (r = e.type === Bt.COOL_TRACK) && Gt(),
            roomController.canShowMessagePopups() ? Vt < s - Lt && (Lt = s,
            t = r ? new Ft(e) : null,
            kt = setTimeout(function() {
                $e.hide().removeClass(Pt).removeClass("like-sound unlike cool sticker"),
                t && (t.start(),
                t = null)
            }, Vt),
            i = document.createElement("span"),
            n = expController.calcMinLevelAndProgress(Ue.model.exp).level,
            s = app.getTextAndBorderColorAndByLevel(expController.calcMinLevelAndProgress(Ue.model.exp).level),
            240 <= n && (s.border = "#000"),
            $e.css({
                border: "1px solid " + s.border,
                color: "#fff",
                "background-color": s.border
            }),
            Ht ? Ge.css({
                "border-bottom": "10px solid " + s.border
            }) : Ge.css({
                "border-top": "10px solid " + s.border
            }),
            e.type === Bt.LIKE_SOUND || r ? ($e.addClass("like-sound " + (r ? "cool" : "")),
            a = util.radioText(r ? "Отличный трек" : "Хороший трек", r ? "Отличный клип" : "Хороший клип"),
            $e.css({
                border: "1px solid " + (o = "#eee"),
                color: "#000",
                "background-color": o
            }),
            Ht ? Ge.css({
                "border-bottom": "10px solid " + o
            }) : Ge.css({
                "border-top": "10px solid " + o
            }),
            i.innerHTML = a,
            He.empty().append(i),
            $e.show().addClass(Pt)) : e.type === Bt.NORMAL ? (a = e.message,
            i.innerHTML = xt.replaceAllUTF8Symbols(a, {
                ownerUid: Ue.model.uid
            }),
            He.empty().append(i),
            $e.show().addClass(Pt),
            0) : e.type === Bt.TALK ? (a = "<i>{0}</i>, {1}".format(util.escapeHtml(e.toFirstName, null, !0), xt.replaceAllUTF8Symbols(e.message, {
                ownerUid: Ue.model.uid
            })),
            i.innerHTML = a,
            He.empty().append(i),
            $e.show().addClass(Pt),
            0) : e.type === Bt.STICKER && (o = app.controllers.dialog.Stickers.Configuration.parseOrDefault(e.message, e.fromMale).toDocumentFragment(),
            (a = document.createElement("div")).className = "sticker-wrap",
            a.appendChild(o),
            $e.addClass("sticker "),
            i.appendChild(a),
            He.empty().append(i),
            $e.show().addClass(Pt),
            0)) : r && setTimeout(function() {
                new Ft(e,{
                    fromCenter: !0
                }).start()
            }, 100))
        }
        function de() {
            Ue.el[v.isCoupleMale ? "addClass" : "removeClass"]("is-couple-male")
        }
        function ce() {
            Ue.el[v.isCoupleFemale ? "addClass" : "removeClass"]("is-couple-female")
        }
        function ue() {
            Se()
        }
        function pe() {
            Se(),
            Ue.el.removeClass("is-male is-female").addClass(v.male ? "is-male" : "is-female"),
            lt.text(v.male ? "популярный" : "популярная"),
            dt.text(v.male ? "удачливый" : "удачливая"),
            ct.text(v.male ? "щедрый" : "щедрая"),
            ut.text(v.male ? "хозяин" : "хозяйка");
            var e = "<div class='small-title'>" + (v.male ? "Хозяин" : "Хозяйка") + "</div>";
            pt.html(e),
            l(),
            a.updateInviteToConferenceView()
        }
        function fe(e) {
            e.css("display", "inline-block")
        }
        function me(e) {
            e.hide()
        }
        function ve(e) {
            e.show()
        }
        function he() {
            var e = 0
              , t = !1;
            v.isFortunate ? (e++,
            ve(mt),
            fe(ot)) : (me(mt),
            me(ot)),
            v.isPopular ? (e++,
            ve(ft),
            fe(nt)) : (me(ft),
            me(nt)),
            v.isWasteful ? (e++,
            ve(vt),
            fe(it)) : (me(vt),
            me(it)),
            v.isDJ ? (e++,
            ve(ht),
            fe(at)) : (me(ht),
            me(at)),
            v.isRoomOwner ? (e++,
            ve(gt),
            fe(tt)) : (me(gt),
            me(tt)),
            0 < v.coolLikes ? (t = !0,
            fe(st),
            st.html("x" + v.coolLikes)) : me(st),
            Ze.css("display", (t = t || 1 < e) ? "none" : "block"),
            et.css("display", t ? "inline-block" : "none")
        }
        function ge() {
            var e = v.canShowSelectBtn && v.voteCounter < 3;
            Dt.css("display", e ? "inline-block" : ""),
            e ? roomModel.subStateId === app.RoundSubState.CHOOSING_PARTNER_FOR_KISS ? v.isSelectedByViewer ? Dt.addClass("blue").removeClass("loading").html("Выбрано") : Dt.removeClass("blue loading").html("Выбрать <i class='coin-icon-el'>1</i>") : (e = (e = window.choiceEachOtherRoundProbabilityList[v.voteCounter]) ? e.price : 1,
            Dt.removeClass("blue loading").html("Повысить &nbsp;<i  style='display: inline-block' class='coin-icon-el'>" + e + "</i>")) : Dt.removeClass("blue loading").html("Выбрать")
        }
        function be() {
            if (v.canShowVoteInfo) {
                var e = window.choiceEachOtherRoundProbabilityList[v.voteCounter]
                  , t = e ? e.probability : 1;
                qe.css("display", "").html("");
                for (var i = 0; i < 3; i += 1) {
                    var n = document.createElement("span");
                    n.className = "item-vote-counter",
                    i + 1 <= t && (n.className += " selected"),
                    qe.append(n)
                }
            } else
                qe.css("display", "none")
        }
        function Ce(e, t, i) {
            return "<div class='small-title'>" + (e.male ? t : i) + "</div>"
        }
        function _e() {
            var e = Ce(v, "Щедрый", "Щедрая");
            v.uid === je ? wt.html(e + "Всего <b>{0}</b> {1}".format(v.sentGiftsPerRoom, util.pluralize(v.sentGiftsPerRoom, {
                one: "подарок",
                two: "подарка",
                many: "подарков"
            }))) : wt.html(e + "Чтобы отобрать это звание, нужно сделать <b>{0}</b> {1}<br>Всего <b>{2}</b>".format(v.remindSentGifts, util.pluralize(v.remindSentGifts, {
                one: "подарок",
                two: "подарка",
                many: "подарков"
            }), v.sentGiftsPerRoom))
        }
        function we() {
            var e = Ce(v, "Популярный", "Популярная");
            v.uid === je ? Ct.html(e + "Всего <b>{0}</b> {1}".format(v.receivedGiftsPerRoom, util.pluralize(v.receivedGiftsPerRoom, {
                one: "подарок",
                two: "подарка",
                many: "подарков"
            }))) : Ct.html(e + "Чтобы отобрать это звание, нужно получить <b>{0}</b> {1}<br>Всего <b>{2}</b>".format(v.remindReceivedGifts, util.pluralize(v.remindReceivedGifts, {
                one: "подарок",
                two: "подарка",
                many: "подарков"
            }), v.receivedGiftsPerRoom))
        }
        function Ee() {
            var e = Ce(v, "Удачливый", "Удачливая");
            v.uid === je ? _t.html(e + "Всего <b>{0}</b> {1}".format(v.lotteryWinsPerRoom, util.pluralize(v.lotteryWinsPerRoom, {
                one: "монета",
                two: "монеты",
                many: "монет"
            }))) : _t.html(e + "Чтобы отобрать это звание, нужно выиграть <b>{0}</b> {1}<br>Всего <b>{2}</b>".format(v.remainingFortunateCounter, util.pluralize(v.remainingFortunateCounter, {
                one: "монету",
                two: "монеты",
                many: "монет"
            }), v.lotteryWinsPerRoom))
        }
        function ye() {
            var e = Ce(v, "DJ", "DJ");
            v.uid === je ? Et.html(e + "Всего <b>{0}</b> {1}".format(v.djCounter, util.pluralize(v.djCounter, {
                one: "лайк",
                two: "лайка",
                many: "лайков"
            }))) : Et.html(e + "Чтобы отобрать это звание, нужно получить <b>{0}</b> {1}<br>Всего <b>{2}</b>".format(v.remindDJ, util.pluralize(v.remindDJ, {
                one: "лайк",
                two: "лайка",
                many: "лайков"
            }), v.djCounter))
        }
        function De() {
            a.toggleCompliant(v.uid !== je && (!app.info.complaintsBadNameHash[v.uid] && util.isOKAppUid(v.uid) || 18 <= v.age && !app.info.complaintAgeUids[v.uid]))
        }
        function Te() {
            clearTimeout(A),
            Qe.addClass("no-transition"),
            Ue.el.removeClass("u1 u2 u3 u4 u5 u6 even odd"),
            Ue.el.addClass((v.orderIndex % 2 == 0 ? "even" : "odd") + " u" + (v.orderIndex + 1)),
            A = setTimeout(function() {
                Qe.removeClass("no-transition")
            }, 200)
        }
        function Se() {
            Ue.el[v.isAway ? "addClass" : "removeClass"]("is-away"),
            m()
        }
        function Ae(e) {
            var t, i, n, o, a, s = v.betNumbersString;
            s ? (rt.css("display", "none"),
            0 === s.indexOf("winValue_") ? (i = s.substr(9).split("_"),
            t = parseInt(i[0], 10),
            o = parseInt(i[1], 10),
            0 === t ? Je.empty() : (i = Ue.el.offset()) && (n = $(document.createElement("span")).text(t).addClass("win-value-element").addClass(1 === o ? "coins-win" : "rubies-win").append(document.createElement("i")),
            o = (a = isMobi ? {
                left: 200,
                top: 400
            } : {
                left: 325,
                top: 225
            }).left - i.left,
            a = a.top - i.top,
            n.css({
                left: o + "px",
                top: a + "px"
            }),
            Je.empty().append(n).show(),
            setTimeout(function() {
                n.css({
                    left: "0px",
                    top: "0px"
                })
            }, 100))) : 0 === s.indexOf("total_bet_value") && (a = parseInt(s.substr(15), 10),
            (s = document.createElement("div")).className = "users-bet-value",
            s.innerHTML = "<span class='smart-coin'></span>x" + a,
            Je.empty().append(s).show())) : (rt.css("display", ""),
            Je.hide()),
            Se()
        }
        function Ie() {
            yt.css("display", v.hasFadeArrows ? "inline-block" : "none")
        }
        function Me() {
            return v.uid !== je && 0 < v.countryId && v.countryId === app.info.countryId && (4 < v.countryId || v.regionId === app.info.regionId && 0 < app.info.regionId)
        }
        function Oe() {
            Tt.css("display", Me() ? "" : "none"),
            Ne()
        }
        function xe() {
            At.css("display", v.hasBDate ? "inline-block" : "none"),
            ke(),
            b(),
            C(),
            Re(),
            Ne()
        }
        function Re() {
            Ot = v.isVerified,
            It.css("display", Ot && !v.hasBDate ? "inline-block" : "none"),
            Ne()
        }
        function ke() {
            St.css("display", v.isMobiUser ? "inline-block" : "none"),
            Ne()
        }
        function Pe() {
            ze.text(v.votesForCouple)
        }
        function Ne() {
            var e = isMobi ? 80 : 100;
            v.hasBDate ? e -= 15 : (Ot && (e -= 16),
            h.isFav && h.isFavVisible && (e -= 10),
            h.isBlockVisible && (e -= 12)),
            v.state !== jt && !v.isAway || (e -= 14),
            Me() && (e -= 12),
            Xe.css("max-width", e + "px")
        }
        return Pe(),
        g(),
        S(),
        te(),
        ie(),
        ne(),
        oe(),
        ae(),
        se(),
        re(),
        le(),
        de(),
        ce(),
        ue(),
        pe(),
        De(),
        Te(),
        Ae(),
        Ie(),
        Oe(),
        xe(),
        ke(),
        Re(),
        be(),
        app.eventBus.on(app.EVENTS.VIEWER_LEVEL_CHANGED, function(e) {
            l(),
            a.toggleKick(e)
        }),
        app.eventBus.on(app.EVENTS.ROOM_GIFTS_LIST_UPDATED, function() {
            l()
        }),
        v.onChange("luckyExpModifier", function() {
            var e = v.luckyExpModifier;
            e && v.uid === je && Ue.animateLuckyBonus(e.uid, e.exp)
        }),
        v.onChange("counterMapOfGiftsForBeginners", function() {
            l()
        }),
        v.onChange("exp", function() {
            l()
        }),
        v.onChange("isMobiUser", ke),
        v.onChange("isVerified", Re),
        v.onChange("betNumbersString", Ae),
        v.onChange("hasFadeArrows", Ie),
        v.onChange("uid", S),
        v.onChange("clientType", function() {
            T()
        }),
        v.onChange("state", g),
        v.onChange("isEmpty", te),
        v.onChange("vkDataIsLoading", ie),
        v.onChange("isSelectedByViewer", ne),
        v.onChange("isSelectableByFirstPos", oe),
        v.onChange("isSelectableBySecondPos", ae),
        v.onChange("isLocking", se),
        v.onChange("isWinner", re),
        v.onChange("incomingMessagesCount", function() {
            var e;
            0 < v.incomingMessagesCount && (e = util.currentMillis(),
            Nt < e - Ut && (Ut = e,
            Rt = setTimeout(function() {
                Be.hide().removeClass(Pt)
            }, Nt),
            Be.show().addClass(Pt)))
        }),
        v.onChange("outgoingMessage", le),
        v.onChange("isCoupleMale", de),
        v.onChange("isCoupleFemale", ce),
        v.onChange("wins", function() {
            o = v.wins || 0,
            t()
        }),
        v.onChange("giftsCount", function() {
            e(Ue.els.giftsCounter, v.giftsCount)
        }),
        v.onChange("gameCounter1", function() {
            e(Ue.els.counter1, v.gameCounter1)
        }),
        v.onChange("gameCounter2", function() {
            e(Ue.els.counter2, v.gameCounter2)
        }),
        v.onChange("gameCounter3", function() {
            e(Ue.els.counter3, v.gameCounter3)
        }),
        v.onChange("male", pe),
        v.onChange("isAway", ue),
        v.onChange("isPopular", function() {
            Ue.el[v.isPopular ? "addClass" : "removeClass"]("is-popular"),
            he(),
            a.toggleKick()
        }),
        v.onChange("isWasteful", function() {
            Ue.el[v.isWasteful ? "addClass" : "removeClass"]("is-wasteful"),
            he(),
            a.toggleKick()
        }),
        v.onChange("isFortunate", function() {
            Ue.el[v.isFortunate ? "addClass" : "removeClass"]("is-fortunate"),
            he()
        }),
        v.onChange("isDJ", function() {
            Ue.el[v.isDJ ? "addClass" : "removeClass"]("is-dj"),
            he()
        }),
        v.onChange("coolLikes", function() {
            Ue.el[0 < v.coolLikes ? "addClass" : "removeClass"]("has-cool-likes"),
            he()
        }),
        v.onChange("isRoomOwner", function() {
            Ue.el[v.isRoomOwner ? "addClass" : "removeClass"]("is-room-owner"),
            he(),
            a.toggleKick()
        }),
        v.onChange("remindSentGifts", _e),
        v.onChange("remindReceivedGifts", we),
        v.onChange("remindDJ", ye),
        v.onChange("sentGiftsPerRoom", _e),
        v.onChange("receivedGiftsPerRoom", we),
        v.onChange("djCounter", ye),
        v.onChange("age", De),
        v.onChange("orderIndex", Te),
        v.onChange("regionId", Oe),
        v.onChange("hasBDate", xe),
        v.onChange("isCenter", function() {
            Ue.el[v.isCenter ? "addClass" : "removeClass"]("is-center")
        }),
        v.onChange("votesForCouple", Pe),
        v.onChange("remainingFortunateCounter", Ee),
        v.onChange("lotteryWinsPerRoom", Ee),
        v.onChange("canShowSelectBtn", ge),
        v.onChange("voteCounter", ge),
        v.onChange("canShowVoteInfo", be),
        v.onChange("voteCounter", be),
        app.eventBus.on(app.EVENTS.REGION_CHANGED, Oe),
        app.eventBus.on(app.EVENTS.LOTTERY_NUMBER_WIN_IS_SELECTED, function(e) {
            Ae(e.winCombinationHash)
        }),
        app.eventBus.on(app.EVENTS.USER_ADDED_TO_FAV, function(e) {
            e.uid === v.uid && b()
        }),
        app.eventBus.on(app.EVENTS.USER_COMPLAIN_TO_AGE, function(e) {
            e.uid === v.uid && De()
        }),
        app.eventBus.on(app.EVENTS.USER_COMPLAIN_TO_ABUSE, function(e) {
            e.uid === v.uid && De()
        }),
        app.eventBus.on(app.EVENTS.USER_REMOVED_FROM_FAV, function(e) {
            e.uid === v.uid && b()
        }),
        app.eventBus.on(app.EVENTS.USER_BLOCKED, function(e) {
            e.uid === v.uid && C()
        }),
        app.eventBus.on(app.EVENTS.USER_UNBLOCKED, function(e) {
            e.uid === v.uid && C()
        }),
        v.uid === je && (I = $(document.createElement("div")).addClass("private-messages"),
        M = $(document.createElement("i")),
        Ue.$(".user-area").append(I),
        I.append(M),
        O = "has-private-messages",
        x = v.privateMessages,
        R = "is-gold-message",
        k = "is-p2p-message",
        (F = function() {
            x.length ? (I.show(),
            M.text(x.length),
            Ue.el.addClass(O),
            function() {
                var e = roomModel.getViewer().privateMessages
                  , e = e.length ? e[0] : app.recentPrivateMessagesController.getLastMessage();
                if (I.removeClass(k),
                I.removeClass(R),
                e)
                    switch (e.type) {
                    case app.PrivateMessageType.TYPE_GOLD:
                    case app.PrivateMessageType.TYPE_GOLD_RECEIVED:
                        I.addClass(R);
                        break;
                    case app.PrivateMessageType.P2P_INVITE:
                        I.addClass(k)
                    }
            }()) : (I.hide(),
            Ue.el.removeClass(O))
        }
        )(),
        x.on("add", "self", F),
        x.on("remove", "self", F),
        x.on("removeAll", "self", F),
        I.on("click", function(e) {
            return e.stopPropagation(),
            e.preventDefault(),
            Ue.trigger("open-private-message"),
            !1
        }),
        bt.empty().html("<span class='clear-avatar popup-menu-item' >Очистить аватарку <b>3</b></span><div class='arrow'></div><div class='close-area'></div>"),
        bt.on("click", ".clear-avatar", function(e) {
            Ue.trigger("clear-avatar")
        }),
        P = document.createElement("div"),
        N = document.createElement("div"),
        U = document.createElement("div"),
        L = document.createElement("div"),
        F = document.createElement("div"),
        V = document.createElement("div"),
        L.className = "warns-popup",
        F.className = "warns-popup-arrow",
        V.className = "warns-popup-text",
        L.appendChild(F),
        L.appendChild(V),
        N.className = "warns-bg",
        P.className = "warns",
        U.className = "warns-progress",
        P.appendChild(N),
        P.appendChild(U),
        P.appendChild(L),
        Qe.append(P),
        B = function(e) {
            var t = e;
            50 <= (e = 100 < e ? 100 : e) ? (U.style.width = e + "%",
            P.style.display = "block",
            V.innerHTML = "Это ваш уровень предупреждений. Когда эта шкала заполнится, вы не сможете писать в чат и оставлять комментарии".format(t)) : P.style.display = "none"
        }
        ,
        app.eventBus.on("viewer_warns_changed", function(e) {
            e = e.warns;
            B(e)
        }),
        B(app.info.warns)),
        app.controllers.ExpBoosterFlameController && (new app.controllers.ExpBoosterFlameController).init(Ue.$(".exp-booster-flame"), {
            isVisible: function() {
                return v.uid === app.info.viewer_id && app.isBoosterEnabled ? app.isBoosterEnabled() : v.uid && v.hasExpBooster
            },
            model: v
        }),
        J = Ue.model,
        (Z = J.deportationModel) && (G = Ue.$(".resque-btn"),
        H = Ue.$(".deportation-text"),
        W = function(e, t, i) {
            return t + ":" + i
        }
        ,
        j = Math.max,
        K = !1,
        q = !(Y = function() {
            K && (K = !1,
            G.hide())
        }
        ),
        z = function() {
            q && (q = !1,
            H.hide())
        }
        ,
        X = function() {
            Z.initiatorId ? 0 < Z.leftTime - Q ? (K || (K = !0,
            G.show()),
            z()) : (Y(),
            q || (q = !0,
            H.show())) : (Y(),
            z())
        }
        ,
        Q = 1e4,
        Z.onChange("updateCounter", function() {
            X(),
            a.toggleKick()
        }),
        Z.onChange("leftTime", function() {
            var e;
            Z.initiatorId && (e = j(Z.leftTime - Q, 0),
            G.html("{0} {1}".format(J.uid === je ? "Спастись" : "Спасти", (e = e,
            util.formatMillisToTime(e, W)))),
            X())
        })),
        v.view = Ue,
        h
    }
    ,
    Ue
}
,
lilo.viewFactories["item-round-badge"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["item-sub-comment"] = function(e, t) {
    var o = lilo.baseViewFactory(e, t);
    return o.createViewModel = function(e) {
        !function(e) {
            o.el.off();
            var t = -1 === e.uid
              , i = -1 !== e.uid
              , n = e.canDelete;
            t && o.el.addClass("is-anon"),
            n && (o.el.on("click", ".delete-comment", function() {
                o.trigger("delete-sub-comment", {
                    model: e
                })
            }),
            o.el.addClass("can-delete-comment")),
            i ? o.el.on("click", ".avatar,.comment-name", function() {
                o.trigger("show-profile", {
                    uid: e.uid
                })
            }) : o.el.addClass("locked")
        }(e)
    }
    ,
    o
}
,
lilo.viewFactories["item-top-user-by-harem"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".item-user", function() {
        i.trigger("show-profile", {
            uid: i.model._id
        })
    }),
    i.createViewModel = function(e) {
        e._id === app.info.viewer_id && i.el.addClass("is-viewer"),
        e._id < 0 ? i.$(".item-user").addClass("anonymous-user") : i.$(".item-user").addClass("can-hover")
    }
    ,
    i
}
,
lilo.viewFactories["item-top-user-v2"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".item-user", function() {
        i.trigger("show-profile", {
            uid: i.model._id
        })
    }),
    i.createViewModel = function(e) {
        e._id === app.info.viewer_id && i.el.addClass("is-viewer"),
        e._id < 0 ? i.$(".item-user").addClass("anonymous-user") : i.$(".item-user").addClass("can-hover")
    }
    ,
    i
}
,
lilo.viewFactories["item-track"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.raise": function() {
            this.trigger("raise", {
                model: this.model
            })
        },
        "click@$.change": function() {
            this.trigger("change", {
                model: this.model
            })
        },
        "click@$.delete": function() {
            this.trigger("delete", {
                model: this.model
            })
        }
    },
    i.createViewModel = function(e) {
        var t;
        i.$(".viewer-panel")[e.uid === app.info.viewer_id ? "show" : "remove"](),
        1 === e.place && i.$(".raise").remove(),
        e.type === RadioPlayerType.YOUTUBE && ((t = lilo.createView("item-yt-track-in-playlist")).setModel(e),
        i.$(".info").empty().append(t.el).css("max-height", "initial"))
    }
    ,
    i
}
,
lilo.viewFactories["item-user"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.createViewModel = function(e) {
        app.info.favUsersUids[e.uid] && i.el.addClass("fav")
    }
    ,
    i.el.on("click", function() {
        i.trigger("show-user-profile", {
            uid: i.model.uid
        })
    }),
    i
}
,
lilo.viewFactories["item-user-in-chat-popup"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("mouseover", function(e) {
        i.trigger("select", {
            model: i.model
        })
    }),
    i.el.on("click", function(e) {
        i.trigger("click", {
            model: i.model
        })
    }),
    i
}
,
lilo.viewFactories["item-user-in-deposits-top-list"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".common-user", function() {
        i.trigger("open-profile", {
            model: i.model
        })
    }),
    i.el.on("click", ".subscribe-btn", function() {
        i.trigger("subscribe", {
            view: i,
            model: i.model
        })
    }),
    i.el.on("click", ".buy", function() {
        i.trigger("buy", {
            view: i,
            model: i.model
        })
    }),
    i.createViewModel = function(e) {
        e.depositsDisabled && i.el.css("opacity", "0.3")
    }
    ,
    i
}
,
lilo.viewFactories["item-user-in-search-list"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", function() {
        i.trigger("show-user-profile", {
            uid: i.model.uid
        })
    }),
    i.createViewModel = function(e) {
        e.dummy ? i.el.empty().addClass("dummy") : e.vf && i.el.addClass("is-verified")
    }
    ,
    i
}
,
lilo.viewFactories["item-user-v2"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.createViewModel = function(e) {
        -1 === e.uid ? (i.$(".click-area").css("cursor", "default"),
        i.el.addClass("anonymous-user"),
        e.setAttr({
            photoUrl: app.ANONYMOUS_IMG,
            firstName: "Невидимка"
        })) : (app.info.favUsersUids[e.uid] && i.el.addClass("fav"),
        e.vf && i.el.addClass("verified"),
        i.el.on("click", ".kick", function(e) {
            return i.trigger("kick", {
                model: i.model
            }),
            e.stopPropagation(),
            e.preventDefault(),
            !1
        }),
        i.el.on("click", ".click-area", function(e) {
            return i.trigger("click", {
                model: i.model
            }),
            e.stopPropagation(),
            e.preventDefault(),
            !1
        }))
    }
    ,
    i
}
,
lilo.viewFactories["item-users-room-question"] = function(e, t) {
    var r = lilo.baseViewFactory(e, t)
      , l = app.UsersRoundQuestionStatus;
    r.handlers = {
        "click@el": function() {
            this.trigger("click", {
                model: this.model
            })
        },
        "click@$.denied-btn": function(e) {
            return e.stopPropagation(),
            e.preventDefault(),
            this.trigger("show-denied-reason", {
                model: this.model
            }),
            !1
        }
    };
    function d(e) {
        return util.formatDate(app.info.timeDiff + e, function(e, t, i, n, o) {
            return "{0}/{1}/{2} {3}:{4}".format(e, t, i, n, o)
        })
    }
    return r.createViewModel = function(i) {
        var e = {
            status: t(),
            answersCount: n(),
            showDeniedReason: o()
        };
        function t() {
            var e, t;
            switch (i.status) {
            case l.PRIVATE:
                t = "#a5a5a5",
                e = "[скрыт]";
                break;
            case l.PUBLIC:
                t = "#00CC44",
                e = "[Опубликован " + d(i.reviewDate) + "]";
                break;
            case l.ON_MODERATION:
                t = "#55AAFF",
                e = "[На модерации c " + d(i.sendToReviewTs) + "]";
                break;
            case l.REJECTED:
                t = "#FF2A2A",
                e = "[Отклонен " + d(i.reviewDate) + "]"
            }
            return "<span style='color:{0}'>{1}</span>".format(t, e)
        }
        function n() {
            return i.answers.length
        }
        function o() {
            return i.status === l.REJECTED && i.deniedReason
        }
        function a() {
            e.setAttr({
                answersCount: n()
            })
        }
        function s() {
            e.setAttr({
                status: t(),
                showDeniedReason: o()
            })
        }
        return i.answers.on("add", "self", a),
        i.answers.on("remove", "self", a),
        i.onChange("status", s),
        r.onRemove(function() {
            i.answers.off("add", "self", a),
            i.answers.off("remove", "self", a),
            i.offChange("status", s)
        }),
        e
    }
    ,
    r
}
,
lilo.viewFactories["item-viral-users-answer-v2"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = "loading";
    return i.handlers = {
        "click@$.btn-open-answer": function(e) {
            e = $(e.currentTarget);
            e.hasClass(n) || this.trigger("open", {
                model: this.model,
                $el: e,
                view: this
            })
        },
        "click@$.btn-forward-answer": function(e) {
            e = $(e.currentTarget);
            e.hasClass(n) || this.trigger("forward-answer", {
                model: this.model,
                $el: e,
                view: this
            })
        }
    },
    i.animateUnlock = function(e) {
        e = e || $.noop;
        var t = i.$(".lock");
        t.addClass("move-top"),
        setTimeout(function() {
            t.addClass("fade"),
            setTimeout(function() {
                t.remove(),
                e()
            }, 1e3)
        }, 1500)
    }
    ,
    window.animateLock = i.animateUnlock,
    i.createViewModel = function(e) {
        function t() {
            i.els["answer-img"][e.isLocked ? "addClass" : "removeClass"]("with-blur"),
            i.el[e.isLocked ? "addClass" : "removeClass"]("is-locked-answer")
        }
        e.onChange("isLocked", t),
        t(),
        e.isLocked || i.$(".lock").remove()
    }
    ,
    i
}
,
lilo.viewFactories["item-yt-track"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@el": function() {
            this.trigger("click", {
                model: this.model,
                el: this.el
            })
        },
        "click@$.add": function(e) {
            this.trigger("add", {
                model: this.model,
                el: this.el
            }),
            e.stopPropagation()
        },
        "click@$.delete": function(e) {
            this.trigger("delete", {
                model: this.model,
                el: this.el
            }),
            e.stopPropagation()
        }
    },
    i.createViewModel = function(e) {
        e.youtube && i.el.addClass("youtube")
    }
    ,
    i
}
,
lilo.viewFactories["item-yt-track-in-playlist"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@el": function() {
            this.trigger("click", {
                model: this.model,
                el: this.el
            })
        }
    },
    i.createViewModel = function(e) {
        e.youtube && i.el.addClass("youtube")
    }
    ,
    i
}
,
lilo.viewFactories["list-yt-tracks"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["lottery-view"] = function(e, o) {
    var n, a, r = lilo.baseViewFactory(e, o), s = [], l = {}, d = "selected", c = "win-number", u = [];
    function p() {
        var e = parseInt($(this).attr("number"), 10);
        r.trigger("click-number", {
            number: e
        })
    }
    function f() {
        roomView && roomView.mouseIsDown && this.onmousedown()
    }
    return r.handlers = {
        "click@$.bet-multipliers>span": function(e) {
            e = $(e.currentTarget),
            e = parseInt(e.attr("multiplier"), 10);
            r.trigger("select-multiplier", {
                multiplier: e
            })
        },
        "click@$.reset": function(e) {
            r.trigger("reset")
        }
    },
    r.el.on("click", ".how-play", function() {
        dialogController.showMessageDialog({
            message: "Вы выбираете от <b>1</b> до <b>" + r.model.__maxNumbers + "</b> чисел на поле до окончания раунда. После чего <b>ГСЧ</b> (генератор случайных чисел) определят выигрышные числа.Чем больше цифр вы угадали - тем больше ваш выигрыш.<br>Вы получаете <b>+" + r.model.__expBonusPerNumber + "</b> очков к рейтингу за каждую поставленную монету"
        })
    }),
    r.el.on("click", ".do-max-bet", function() {
        var t = [];
        util.repeat(36, function(e) {
            t.push(e + 1)
        }),
        util.shuffleArray(t);
        for (var e = app.balanceModel.balance, i = r.model.multiplier, n = []; o.controller.calcTotalPrice(n.length + 1, i) <= e && n.length < r.model.__maxNumbers; )
            n.push(t.splice(t.length - 1));
        r.trigger("reset"),
        n.each(function(e, t) {
            r.trigger("click-number", {
                number: t
            })
        }),
        r.trigger("select-multiplier", {
            multiplier: i
        })
    }),
    r.updateNumbers = function(e) {}
    ,
    r.resetNumbers = function() {
        util.each(l, function(e, t) {
            t.removeClass(d),
            t.removeClass(c)
        })
    }
    ,
    n = r.$(".numbers"),
    a = [],
    util.repeat(36, function(e) {
        var t = $(document.createElement("span")).addClass("number white-btn").text(e + 1).attr("number", e + 1)
          , i = $(document.createElement("span")).addClass("counter");
        t.userElsToHover = a,
        t[0].onmousedown = p,
        t[0].onmouseover = f,
        t.$counter = i,
        n.append(t),
        s.push(t),
        l[e + 1] = t
    }),
    r.createViewModel = function(a) {
        function i() {
            var e = a.viewerNumbers.length;
            return e = e < 2 ? 0 : e * a.multiplier * a.__price - a.__price
        }
        function n() {
            return "Приз за ставку +" + i() * a.__expBonusPerNumber + " рейтинга"
        }
        function e() {
            o.__isObservable ? o.setAttr({
                hasManyBets: 1 < a.viewerNumbers.length
            }) : o.hasManyBets = 1 < a.viewerNumbers.length,
            $.each(u, function(e, t) {
                e >= a.viewerNumbers.length ? t.removeClass("active") : t.addClass("active")
            })
        }
        var s, o = {
            selectedNumbersCount: 0,
            hasManyBets: !1,
            total: i(),
            expBonusHtml: n()
        };
        function t() {
            var e = i()
              , t = n();
            o.__isObservable ? o.setAttr({
                total: e,
                expBonusHtml: t
            }) : (o.total = e,
            o.expBonusHtml = t)
        }
        return a.viewerNumbers.on("add", "self", e),
        (r.onViewerNumbersChanges = e)(),
        r.animateWinCombination = function(i) {
            util.each(l, function(e, t) {
                t.removeClass(c)
            });
            var n = r.model.__stateId
              , o = r.model.winCombination.split(",")
              , a = {}
              , s = function() {
                var e, t;
                r.model.__stateId === n && (e = o.splice(o.length - 1),
                a[e] = !0,
                (t = l[e]).addClass(c),
                t.hasClass(d) ? (t.addClass("blink"),
                setTimeout(function() {
                    t.removeClass("blink")
                }, 1200),
                app.soundManager.play(app.soundManager.SOUND_IDS.WIN_NUMBER)) : app.soundManager.play(app.soundManager.SOUND_IDS.RESULT_NUMBER_CELL),
                o.length ? setTimeout(s, 700) : i(),
                app.eventBus.trigger(app.EVENTS.LOTTERY_NUMBER_WIN_IS_SELECTED, {
                    winCombinationHash: a
                }))
            };
            setTimeout(s, 700)
        }
        ,
        s = document.createDocumentFragment(),
        $.each([[6, 175], [5, 75], [4, 35], [3, 10], [2, 5], [1, 1]], function(e, t) {
            var i = document.createElement("div");
            i.className = "row",
            s.appendChild(i);
            var n = document.createElement("span");
            n.innerHTML = t[0],
            n.className = "numbers-count",
            i.appendChild(n),
            (n = document.createElement("span")).innerHTML = t[1] * a.multiplier,
            n.className = "win-value",
            i.appendChild(n);
            var o = document.createElement("span");
            o.className = 6 === t[0] ? "smart-ruby" : "coin",
            n.appendChild(o),
            a.onChange("multiplier", function() {
                n.innerHTML = t[1] * a.multiplier,
                n.appendChild(o)
            }),
            u.push($(i))
        }),
        u = u.reverse(),
        r.$(".win-table").append(s),
        a.onChange("multiplier", t),
        r.updateViewOfViewerBets = function() {
            var i = {};
            $.each(r.model.viewerNumbers, function(e, t) {
                i[t] = !0
            }),
            util.each(l, function(e, t) {
                i[e] ? t.addClass(d) : t.removeClass(d)
            }),
            t()
        }
        ,
        r.resetSelection = function() {
            util.each(l, function(e, t) {
                t.removeClass(d)
            })
        }
        ,
        setTimeout(function() {
            function e() {
                o.hasManyBets ? r.els.controls.removeClass("hide").css("visibility", "") : (r.els.controls.addClass("hide"),
                setTimeout(function() {
                    o.hasManyBets ? r.els.controls.removeClass("hide").css("visibility", "") : r.els.controls.css("visibility", "hidden")
                }, 1e3))
            }
            o.onChange("hasManyBets", e),
            e()
        }, 0),
        o
    }
    ,
    r
}
,
lilo.viewFactories["mobi-login"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["moneybox-counter"] = function(e, t) {
    var r = lilo.baseViewFactory(e, t);
    return r.createViewModel = function(e) {
        function t() {
            r.el.css("display", app.commonState.isMoneyBoxDisabled ? "none" : "")
        }
        function i() {
            return Math.min(55 + Math.floor(e.value), 1e3)
        }
        function n() {
            return 1e3 === i()
        }
        var o = i()
          , a = {
            isLimitExceeded: n(),
            value: o
        }
          , s = r.$(".value");
        return t(),
        app.commonState.onChange("isMoneyBoxDisabled", t),
        e.onChange("value", function() {
            var e = i();
            a.setAttr({
                value: e,
                isLimitExceeded: n()
            }),
            e !== o && (s.addClass("animate"),
            setTimeout(function() {
                s.removeClass("animate")
            }, 600))
        }),
        a
    }
    ,
    r
}
,
lilo.viewFactories.p2p = function(e, t) {
    function i(e) {
        var t = +new Date;
        1e3 < t - (g[e] || 0) && (h.trigger(e),
        g[e] = t)
    }
    var h = lilo.baseViewFactory(e, t)
      , n = h.$(".likes-container")
      , o = h.els["add-gold-like"]
      , a = h.els["add-like"]
      , s = h.els["received-gold-likes"]
      , r = h.els["received-likes"]
      , g = {};
    h.handlers = {
        "click@$.hang-up": function() {
            i("hang-up")
        },
        "click@$.make-call": function() {
            var e = h.model;
            if (e.selfCameraIsOn) {
                if (e.otherUserCameraIsOn || !e.selfCameraIsOn || !e.videoMuted)
                    throw new Error("Cannot trigger 'make call' event");
                i("toggle-video-on")
            } else
                i("make-call")
        },
        "click@$.toggle-mic-off": function() {
            i("toggle-audio-off")
        },
        "click@$.toggle-mic-on": function() {
            i("toggle-audio-on")
        },
        "click@$.toggle-video-off": function() {
            i("toggle-video-off")
        },
        "click@$.toggle-video-on": function() {
            i("toggle-video-on")
        },
        "click@$.leave": function() {
            roomView.trigger("switch-room")
        }
    };
    var l;
    function d() {
        clearTimeout(l),
        n.addClass("visible"),
        l = setTimeout(function() {
            n.removeClass("visible")
        }, 2e3)
    }
    function c(e, t) {
        return {
            left: (e = e[0].getBoundingClientRect()).x,
            top: e.y - e.height + t
        }
    }
    h.getPositionOfLikeButton = function() {
        return c(a, 0)
    }
    ,
    h.getPositionOfGoldLikeButton = function() {
        return c(o, 0)
    }
    ,
    h.getPositionOfLikeCounter = function() {
        return c(r, -30)
    }
    ,
    h.getPositionOfGoldLikeCounter = function() {
        return c(s, -30)
    }
    ;
    function u() {
        d(),
        h.model.setAttr({
            selfUsualLikes: h.model.selfUsualLikes + 1
        });
        var e = r[0].getBoundingClientRect();
        app.p2LikeAnimation(e.x + _ / 2 - 2, e.y - E, .8 * _, .8 * w, !1)
    }
    function p() {
        d(),
        h.model.setAttr({
            selfGoldLikes: h.model.selfGoldLikes + 1
        });
        var e = s[0].getBoundingClientRect();
        app.p2LikeAnimation(e.x + _ / 2 - 2, e.y - E, .8 * _, .8 * w, !0)
    }
    var f, m = {
        gold: 0,
        usual: 0
    }, v = util.random, b = function() {
        var e;
        clearTimeout(f),
        m.gold && m.usual ? 1 === v(1, 2) ? (m.gold--,
        p()) : (m.usual--,
        u()) : m.gold ? (m.gold--,
        p()) : m.usual && (m.usual--,
        u()),
        (m.gold || m.usual) && (e = v(50, 100) * v(1, 3),
        f = setTimeout(b, e))
    };
    function C(e, t) {
        var i, n = !1, o = function(e) {
            clearTimeout(i),
            n && (h.trigger(t),
            i = setTimeout(o, e ? 500 : 100))
        };
        e.on("mousedown", function() {
            o(n = !0)
        }).on("mouseup", function() {
            n = !1
        }).on("mouseout", function() {
            n = !1
        })
    }
    C(a, "add-like"),
    C(o, "add-gold-like");
    var _ = Math.floor(61 * .7)
      , w = Math.floor(36.4)
      , E = 63;
    return h.animateSentLike = function() {
        var e = a[0].getBoundingClientRect();
        console.info("rect", e),
        app.p2LikeAnimation(4 + e.x + _ / 2, 4 + e.y - E, _, w, !1)
    }
    ,
    h.animateSentGoldLike = function() {
        var e = o[0].getBoundingClientRect();
        console.info("rect", e),
        app.p2LikeAnimation(4 + e.x + _ / 2, 4 + e.y - E, _, w, !0)
    }
    ,
    h.animateReceivedLikes = function(e) {
        m.usual += e,
        b(),
        console.info("animateReceivedLikes", e)
    }
    ,
    h.animateReceivedGoldLikes = function(e) {
        m.gold += e,
        b()
    }
    ,
    h.createViewModel = function(e) {
        var t = "state-waiting"
          , i = "state-call"
          , n = !0
          , o = h.els["other-camera"]
          , a = h.els["self-camera"];
        function s() {
            e.selfCameraIsOn && e.otherUserCameraIsOn ? h.el.addClass(i).removeClass(t) : (h.el.addClass(t).removeClass(i),
            n = !0)
        }
        function r() {
            return e.otherUserFirstName ? util.escapeHtml(e.otherUserFirstName) + " " + e.otherUserAge : ""
        }
        var l = "<div><span class='waiting-icon'></span></div>";
        function d() {
            return e.otherUserFirstName ? e.otherUserCameraIsOn ? "Игрок готов и ждёт вас...<div><span class='green-check-icon'></span></div>" : "Ожидаем, когда игрок включит камеру" + l : "Ожидаем другого игрока..." + l
        }
        function c() {
            return !e.selfCameraIsOn
        }
        function u() {
            return e.selfCameraIsOn
        }
        function p() {
            n ? o.addClass("top-video").removeClass("bottom-video") : o.addClass("bottom-video").removeClass("top-video")
        }
        function f() {
            e.selfCameraIsOn && e.otherUserCameraIsOn ? (a.removeClass("bottom-center-video"),
            n ? a.addClass("bottom-video").removeClass("top-video") : a.addClass("top-video").removeClass("bottom-video")) : (a.removeClass("bottom-video"),
            a.removeClass("top-video"),
            a.addClass("bottom-center-video"))
        }
        function m() {
            return !e.selfCameraIsOn || !(e.otherUserCameraIsOn || !e.selfCameraIsOn || !e.videoMuted)
        }
        var v = {
            otherUserStateHtml: d(),
            otherUserFulName: r(),
            canCall: c(),
            canHangUp: u(),
            viewerAvatar: app.info.photo_100,
            viewerExp: expController.getCurrentExp(),
            viewerFullName: app.info.first_name + " " + app.info.age,
            showBottomPendingContainer: m()
        };
        return app.eventBus.on(app.EVENTS.VIEWER_LEVEL_CHANGED, function() {
            v.setAttr({
                viewerExp: expController.getCurrentExp()
            })
        }),
        e.onChange("otherUserFirstName", function() {
            v.setAttr({
                otherUserStateHtml: d(),
                otherUserFulName: r()
            })
        }),
        e.onChange("otherUserAge", function() {
            v.setAttr({
                otherUserFulName: r()
            })
        }),
        e.onChange("otherUserCameraIsOn", function() {
            v.setAttr({
                otherUserStateHtml: d(),
                showBottomPendingContainer: m()
            }),
            s(),
            p(),
            f()
        }),
        e.onChange("selfCameraIsOn", function() {
            v.setAttr({
                canCall: c(),
                canHangUp: u(),
                showBottomPendingContainer: m()
            }),
            s(),
            f(),
            p()
        }),
        e.onChange("videoMuted", function() {
            v.setAttr({
                showBottomPendingContainer: m()
            })
        }),
        p(),
        f(),
        s(),
        h.el.on("click", ".toggle-positions", function() {
            500 < +new Date - (g["toggle-positions"] || 0) && (n = !n,
            p(),
            f())
        }),
        v
    }
    ,
    h
}
,
lilo.viewFactories["photo-likes"] = function(e, t) {
    var s = lilo.baseViewFactory(e, t);
    s.setWrapWidth = function(e) {
        e < 420 ? s.els.table.css("min-width", Math.max(e, 300)) : (e = Math.max(420, e),
        s.els.table.css("min-width", e)),
        s.els.wrap.css({
            width: 580,
            left: -(580 - e) / 2
        })
    }
    ;
    function r(e) {
        var t = document.createElement("div");
        return t.className = e ? s.id + e : "",
        t
    }
    var l = ["Класс", "Супер", "Влюбляет", "Сексуально", "Круто", "Удивительно"];
    return s.createViewModel = function(e) {
        util.repeat(5, function(e) {
            var t = 1 < ++e ? 1 : 0
              , i = l[e - 1]
              , n = CDN_PREFIX + "/likes/" + e + ".png?v=1"
              , o = r("like")
              , a = r("like-title");
            o.style.backgroundImage = "url(" + n + ")",
            a.innerHTML = "<div>" + i + "</div>",
            o.appendChild(a),
            0 < t && ((a = r("like-price")).innerHTML = t + "<div class='smart-coin'><div>",
            o.appendChild(a)),
            s.els.balloon.append(o),
            o.onclick = function() {
                s.trigger("like", {
                    type: e
                })
            }
        }),
        s.$("." + s.id + "likes>div").each(function(e, t) {
            var i = r("like-title");
            i.innerHTML = "<div>" + l[e] + "</div>",
            t.appendChild(i)
        }),
        app.info.bootData.invis && s.els["invis-state-text"].show()
    }
    ,
    s.els.balloon.click(util.cancelEvent),
    s
}
,
lilo.viewFactories["photos-view"] = function(e, t) {
    var t = lilo.baseViewFactory(e, t)
      , i = "loading"
      , n = t.$(".load-photos");
    return t.showPhotosLoader = function() {
        n.addClass(i)
    }
    ,
    t.hidePhotosLoader = function() {
        n.removeClass(i)
    }
    ,
    t.handlers = {
        "click@$.add-photo": function() {
            this.trigger("add-photo")
        },
        "click@$.load-photos": function(e) {
            n.hasClass(i) || this.trigger("load-photos")
        }
    },
    t.createViewModel = function(e) {
        var t = {
            hasPhotos: 0 < e.photos.length,
            canShowBlock: 0 < e.photos.length || e.uid === app.info.viewer_id
        };
        function i() {
            t.setAttr({
                hasPhotos: 0 < e.photos.length,
                canShowBlock: 0 < e.photos.length || e.uid === app.info.viewer_id
            })
        }
        return e.photos.on("add", "self", i),
        e.photos.on("remove", "self", i),
        e.photos.on("removeAll", "self", i),
        t
    }
    ,
    t
}
,
lilo.viewFactories["popular-widget"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , d = i.$(".progress")
      , c = i.$(".round.left")
      , u = i.$(".round.center")
      , p = i.$(".round.right")
      , f = 800;
    return i.createViewModel = function(l) {
        function e() {
            app.GLOBAL_COLORS_HASH[l.ratingColor],
            l.rating;
            var e = expController.calcMinLevelAndProgress(l.exp)
              , t = app.getTextAndBorderColorAndByLevel(e.level)
              , i = e.level
              , n = e.progress
              , o = i
              , a = o - 1
              , s = o + 1;
            a < 0 && (a = 0,
            o = 1,
            s = 2);
            var r = t.border
              , e = t.text;
            d.css({
                width: n / 100 * (f / 2 - 50) + f / 2 + "px",
                background: r
            });
            t = "purple-level-bg";
            c.css({
                background: "",
                border: "",
                padding: "",
                "box-sizing": ""
            }).removeClass(t),
            u.css({
                background: "",
                border: "",
                padding: "",
                "box-sizing": ""
            }).removeClass(t).removeClass("gold-level-gradient"),
            c.text(a).addClass("complete").css({
                border: "2px solid " + r,
                color: e,
                background: ""
            }),
            i >= LEVEL_PURPLE ? (d.css({
                background: colorPurple
            }),
            c.css({
                color: "#fff",
                background: "",
                border: "none",
                padding: "7px"
            }).addClass(t),
            u.attr("level", o).css({
                color: "#fff",
                background: "",
                border: "none",
                padding: "7px"
            }).addClass(t).html(o)) : 240 <= i ? (d.css({
                background: "#000"
            }),
            c.css({
                border: "2px solid #000",
                color: "#fff",
                background: "#000"
            }),
            u.addClass("gold-level-gradient").css({
                "background-color": "",
                color: "#fff"
            }).html("<div class='gold-level-gradient'><div class='gold-level-inner'>" + o + "</div></div>")) : u.removeClass("gold-level-gradient").html(o).addClass("complete").css({
                border: "5px solid " + r,
                color: e
            }),
            c.attr("level", a),
            u.attr("level", o),
            p.text(s)[100 <= n ? "addClass" : "removeClass"]("complete").css({
                border: 100 <= n ? "2px solid " + r : ""
            }),
            function() {
                $.each([c, u, p], function(e, t) {
                    t.css({
                        height: "",
                        width: "",
                        lineHeight: ""
                    });
                    var i = Math.max(t.width(), t.height());
                    t.css({
                        height: i + "px",
                        width: i + "px",
                        lineHeight: i + "px"
                    });
                    i = t.outerHeight();
                    t.css({
                        top: (60 - i) / 2 + "px"
                    })
                });
                var e = u.outerWidth();
                u.css({
                    left: (f - e) / 2 + "px"
                })
            }()
        }
        i.render = e,
        l.onChange("exp", e),
        l.onChange("ratingColor", e)
    }
    ,
    i
}
,
lilo.viewFactories["popup-of-game-gift"] = function(e, t) {
    function s(e, t, i) {
        i = i || {
            sortIndex: 1,
            group: 0
        };
        var n = {
            title: e,
            mobiHandler: $.noop,
            opts: i,
            handler: function() {
                return n.mobiHandler(t),
                !1
            }
        };
        o.push(n)
    }
    function r(e) {
        return e.replace(/<br>/g, " ")
    }
    var l = lilo.baseViewFactory(e, t)
      , o = [];
    return l.getModelsForMobi = function() {
        return o
    }
    ,
    l.renderPopup = function(e) {
        function n(e) {
            var t = document.createElement("div");
            return t.className = e || "",
            t
        }
        var o = document.createDocumentFragment()
          , a = 4 < e.__items.length;
        e.__items.each(function(e, t) {
            var i = n("item");
            t.sex ? 50 === t.count ? (i.innerHTML = "Задарить <br>{0} {1}".format(2 === t.sex ? "парней" : "девушек", t.count),
            s(r(i.innerHTML), t, {
                sortIndex: 100,
                group: a ? 10 : 5
            })) : 1 === t.count ? (i.innerHTML = "Всем {0}".format(2 === t.sex ? "парням" : "девушкам"),
            s(i.innerHTML, t, {
                sortIndex: 50,
                group: a ? 10 : 5
            })) : (i.innerHTML = "Подарить <br> {0} {1}".format(2 === t.sex ? "парням" : "девушкам", t.count),
            s(r(i.innerHTML), t, {
                sortIndex: t.count,
                group: a ? 10 : 5
            })) : 50 === t.count ? (i.innerHTML = "Покрыть весь<br>аватар {0}".format(t.count),
            s(r(i.innerHTML), t, {
                sortIndex: 1e3,
                group: 5
            })) : 1 === t.count ? (i.innerHTML = "<span class='red'>Подарить</span>",
            s("Подарить", t, {
                sortIndex: -1,
                group: 1,
                className: "green-btn"
            })) : (i.innerHTML = "Отправить {0} {1}".format(t.count, util.pluralize(t.count, {
                one: "раз",
                two: "раза",
                many: "раз"
            })),
            s(i.innerHTML, t, {
                sortIndex: t.count,
                group: 5
            })),
            o.appendChild(i),
            i.onclick = function(e) {
                l.trigger("click-item", {
                    model: t,
                    event: e
                })
            }
        });
        var t = n("items-wrap");
        t.appendChild(o);
        e = l.arrowEl = n("arrow");
        l.el.empty().append(t).append(e)
    }
    ,
    l.createViewModel = function(e) {
        l.renderPopup(e)
    }
    ,
    l.arrowToCenter = function(e) {
        l.arrowEl && (l.arrowEl.style.top = (e - 18) / 2 + "px")
    }
    ,
    l.el.on("mouseover", function(e) {
        l.trigger("blur", {
            toElement: e.toElement
        })
    }),
    l.el.bind("mousewheel", function(e) {
        e.preventDefault()
    }),
    l
}
,
lilo.viewFactories["popup-with-exclude-user-text"] = function(e, t) {
    e = lilo.baseViewFactory(e, t);
    e.handlers = {
        "click@$.close": function() {
            this.trigger("close")
        }
    };
    t = roomModel.getViewer();
    return t.isWasteful ? (e.$(".hint").remove(),
    e.$(".exclude-title").html("Благодаря вашей Щедрости, для вас<br>активна функция <b>&ldquo;Исключить из комнаты&rdquo;</b>")) : t.isPopular && e.$(".exclude-title").html("Благодаря вашей Популярности, для вас<br>активна функция <b>&ldquo;Исключить из комнаты*&rdquo;</b>"),
    e
}
,
lilo.viewFactories.profile = function(e, t) {
    var y, D = lilo.baseViewFactory(e, t), T = D.$(".popular-widget-area .wrap"), S = (D.$(".subscribe"),
    D.$(".buy-deposit"));
    return D.showBack = function() {
        D.$(".sub-menu").show()
    }
    ,
    D.swapInputImage = function() {
        util.swapInputImage(D.$("#input-file"), "input-file")
    }
    ,
    D.showBannedText = function() {
        var e = document.createElement("div");
        e.innerHTML = "<div>Пользователь заблокирован.</div>",
        e.className = "profile-is-blocked",
        D.el.append(e)
    }
    ,
    D.handleShow = function() {
        D.model.isClosedProfile && D.$("[public-data]").remove(),
        y && y.render()
    }
    ,
    D.handlers = {
        "click@$.open-closed-profile": function(e) {
            this.trigger("open-closed-profile")
        },
        "click@$.color-picker": function(e) {
            this.trigger("show-color-picker", {
                updateRating: !!$(e.target).attr("rating")
            })
        },
        "click@$.rating-explain": function(e) {
            this.trigger("rating-explain")
        },
        "click@$.summary-info .update-age": function(e) {
            this.trigger("change-age")
        },
        "click@$.summary-info .update-region": function(e) {
            this.trigger("change-region")
        },
        "click@$.join": function(e) {
            this.trigger("join")
        },
        "click@$.back": function() {
            this.trigger("back")
        },
        "click@$.toggle-profile-access": function() {
            this.trigger("toggle-profile-access")
        },
        "click@$.toggle-vk-levels": function() {
            this.trigger("toggle-vk-levels")
        },
        "click@$.send-private-message": function(e) {
            this.trigger("send-private-message", {
                type: parseInt(e.currentTarget.getAttribute("type"), 10)
            })
        },
        "click@$.buy-deposit": function(e) {
            this.trigger("buy-deposit", {
                el: $(e.currentTarget)
            })
        },
        "change@$#input-file": function(e) {
            this.trigger("select-img", {
                fileList: e.target.files
            })
        },
        "click@$.open-avatar-dialog": function(e) {
            this.trigger("open-avatar-dialog")
        },
        "click@$.open-special-users-dialog": function(e) {
            this.trigger("open-special-users-dialog")
        },
        "click@$.text-status-bubble": function(e) {
            this.trigger("change-text-status")
        },
        "click@$.update-name": function(e) {
            this.trigger("update-name")
        },
        "click@$.remove-self-from-guests": function(e) {
            e = $(e.target);
            e.hasClass("loading") || this.trigger("remove-self-from-guests", {
                $targetEl: e
            })
        }
    },
    D.createViewModel = function(p) {
        (socialApi.isUsersMemberOfDevClubs() || app.viewerIsBeginner()) && D.$(".buy-deposit").remove();
        var f = {
            closedProfileText: e(),
            statusIsVisible: _(),
            changeStatusIsVisible: w(),
            summary: "",
            lastSignIn: "",
            joinText: "",
            has10Level: window.expController && 10 <= expController.getCurrentLevel(),
            profileLink: util.createAppLink({
                hash: util.encodeUid(p.uid),
                protocol: "https"
            }),
            profileLinkShort: util.createAppLink({
                hash: util.encodeUid(p.uid)
            }),
            inPublicRoom: t()
        };
        function e() {
            return p.closedOnlyForInvisible ? "Профиль закрыт от невидимок" : "Закрытый профиль"
        }
        function t() {
            return p.roomId && !p.roomId.startWith("10_")
        }
        util.isOKPlatform() && (f.profileLink = f.profileLinkShort = util.createAppLink({
            queryParams: {
                custom_args: "profile_" + util.encodeUid(p.uid)
            }
        })),
        p.onChange("closedOnlyForInvisible", function() {
            f.setAttr({
                closedProfileText: e()
            })
        }),
        p.onChange("roomId", function() {
            f.setAttr({
                inPublicRoom: t()
            })
        }),
        y = lilo.createView("popular-widget"),
        T.empty().append(y.el),
        y.setModel(this.model),
        y.render(),
        D.els.avatar.click(function(e) {
            var t;
            return p.isSelfProfile ? (t = app.commonState.pid,
            selfProfileController.photosController.findPhoto(t) && D.trigger("open-photos-with-avatar", {
                pid: t
            })) : (t = p.pid,
            D.model.isClosedProfile || D.trigger("open-photos-with-avatar", {
                pid: t
            })),
            util.cancelEvent(e)
        });
        function i() {
            g[0].select(),
            document.execCommand("copy") && dialogController.fadePopup("Ссылка скопирована в буфер"),
            g.blur()
        }
        var n, o, a, s, r, l, d, c, u, m, v, h, g = D.$(".profile-link-input");
        g.click(function() {
            i()
        }),
        D.$(".copy-profile-link").click(function(e) {
            i()
        }),
        p.isSelfProfile ? (D.$("[only-other-profile]").remove(),
        D.$(".visit-info").remove(),
        (n = D.els.verificationBtn).parentNode = n.parent(),
        n.on("click", function() {
            new (app.commonState.verificationPhoto ? app.controllers.dialog.VerificationStatus : app.controllers.dialog.VerificationPhoto)
        }),
        o = D.$(".change-avatar"),
        a = D.$(".change-avatar-area"),
        s = D.$(".reset-avatar"),
        r = D.$(".actions"),
        l = function() {
            var e = "block"
              , t = "none"
              , i = "none"
              , n = 1;
            app.commonState.verified && (p.vf ? (i = "block",
            n++,
            D.els.avatar.css("cursor", "pointer"),
            app.canVerifyPhotos(app.info.age) && app.commonState.pid && selfProfileController.photosController.findPhoto(app.commonState.pid) && (t = "block",
            n++)) : D.els.avatar.css("cursor", "")),
            app.canVerifyPhotos(app.info.age) || (e = "none",
            n--),
            o.css("display", e),
            a.css("display", t),
            s.css("display", i),
            r.css("top", 150 - 20 * n + "px")
        }
        ,
        o.click(function(e) {
            return app.canVerifyPhotos(app.info.age) && D.trigger("change-avatar"),
            util.cancelEvent(e)
        }),
        a.click(function(e) {
            return app.canVerifyPhotos(app.info.age) && D.trigger("change-avatar-area"),
            util.cancelEvent(e)
        }),
        s.click(function(e) {
            return D.trigger("reset-avatar"),
            util.cancelEvent(e)
        }),
        l(),
        (v = function() {
            D.els.avatar[p.p200 ? "removeClass" : "addClass"]("avatar-size-100")
        }
        )(),
        p.onChange("avatar", l),
        p.onChange("p200", v),
        p.onChange("vf", l),
        app.commonState.onChange("verified", l),
        app.commonState.onChange("pid", l),
        app.eventBus.on(app.EVENTS.AGE_CHANGED, function(e) {
            c(e),
            d(e.age),
            setTimeout(l, 100)
        }),
        d = function(e) {
            app.canVerifyPhotos(e) ? D.els.avatar.parent().css("cursor", "") : D.els.avatar.parent().css("cursor", "default")
        }
        ,
        (c = function(e) {
            e = e || {},
            app.commonState.verified || e.age && !app.canVerifyPhotos(e.age) ? n.detach() : app.commonState.verificationPhoto ? (n.parentNode.append(n),
            n.removeClass("blue").addClass("white").html("Проверить статус верификации")) : (n.parentNode.append(n),
            n.removeClass("white").addClass("blue").html("Верификация фото"))
        }
        )(),
        app.commonState.onChange("verificationPhoto", c),
        app.commonState.onChange("verified", c)) : (u = app.sdk.viewComponents.togglePopupBtn(D.$(".send-private-message-btn"), D.$(".private-message-select-popup")),
        D.onRemove(function() {
            u.dispose()
        }),
        (m = lilo.createView("profile-avatar-popup")).setModel({
            pending: !1,
            isFav: !!app.info.favUsersUids[p.uid],
            isBlocked: p.isBlocked,
            canOpenAvatar: !1
        }),
        p.onChange("isBlocked", function() {
            m.model.setAttr({
                isBlocked: p.isBlocked
            })
        }),
        m.bind("toggle-block", function() {
            D.trigger("toggle-block", {
                model: m.model
            })
        }),
        m.bind("toggle-fav", function() {
            D.trigger("toggle-fav", {
                model: m.model
            })
        }),
        m.bind("open-avatar", function() {
            var e = p.pid;
            D.trigger("open-photos-with-avatar", {
                pid: e
            })
        }),
        D.els.bg.append(m.el),
        p.onChange("pid", v = function() {
            p.vf && p.pid && currentProfileController.photosController.findPhoto(p.pid) ? (D.els.avatar.css("cursor", "pointer"),
            m.model.setAttr({
                canOpenAvatar: !0
            })) : (D.els.avatar.css("cursor", ""),
            m.model.setAttr({
                canOpenAvatar: !1
            }))
        }
        ),
        p.onChange("vf", v),
        D.$("[only-viewer]").remove(),
        (v = function() {
            var e = util.currentMillis()
              , t = p.signIn + app.info.timeDiff;
            e < t && (t = e - 6e4);
            var i = moment(t)
              , e = (2 === p.sex ? "Заходил " : "Заходила ") + (t <= e - 864e5 ? i.format("DD.MM.YYYY [в] HH:mm") : i.calendar())
              , i = "Играть с " + (2 === p.sex ? "ним" : "ней");
            p.signIn <= 0 && (e = "Офлайн"),
            f.__isObservable ? f.setAttr({
                lastSignIn: e,
                joinText: i
            }) : (f.lastSignIn = e,
            f.joinText = i)
        }
        )(),
        p.onChange("sex", v),
        p.onChange("signIn", v),
        (h = function() {
            app.commonState.isDepositsDisabled || p.isDepositsDisabled ? S.hide() : S.css("display", "")
        }
        )(),
        p.onChange("isDepositsDisabled", h),
        app.commonState.onChange("isDepositsDisabled", h),
        D.onRemove(function() {
            app.commonState.offChange("isDepositsDisabled", h)
        }));
        var b = !1
          , C = !1;
        function _() {
            return !!p.isSelfProfile || !!p.textStatus
        }
        function w() {
            return p.isSelfProfile && !p.textStatus
        }
        function E() {
            !function c() {
                var u;
                p.isSelfProfile,
                b ? C = !0 : (b = !0,
                u = p.firstName,
                socialApi.getRegionName(p.countryId, p.regionId, function(e, t) {
                    var i = util.createSocialProfileLink({
                        uid: p.uid
                    })
                      , n = p.age ? ",<span class='r-wrap'> " + util.pluralizeAge(p.age) + (p.isSelfProfile ? "<i class='update-age'>изменить</i>" : "") + "</span>" : ""
                      , o = p.isClosedProfile ? "" : t ? ", " + t : ", Регион не указан"
                      , a = p.isSelfProfile ? " <i class='update-region'>изменить</i>" : ""
                      , s = p.vf
                      , r = []
                      , l = p.isSelfProfile && util.isOKPlatform() ? "<i class='update-name'>Изменить</i>" : ""
                      , d = p.isSelfProfile ? "<span class='toggle-profile-access'></span>" : ""
                      , t = util.canShowSocialLink(p.uid)
                      , i = "<span class='r-wrap'><a target='_blank' href='" + i + "'>" + util.escapeHtml(u, 0, 1) + "</a>" + d + l + "</span>"
                      , l = "<span class='r-wrap'><span>{0}</span>{1}</span>".format(util.escapeHtml(u, 0, 1), d + l);
                    s ? (r.push("<div class='verification-icon' style='display: inline-block;' ><div class='v-popup'><div class='v-arrow'></div><div class='v-text'>Пользователь с верифицированными фотографиями</div></div></div>"),
                    t ? r.push(p.isVKLinkHidden ? l : i) : r.push(l)) : p.isClosedProfile ? r.push("<span>{0}</span>".format(util.escapeHtml(u, 0, 1))) : (util.isOKAppUid(p.uid) ? r.push("<span class='ok-icon' style='display: inline-block'></span>") : r.push("<span class='vk-icon' style='display: inline-block'></span>"),
                    t ? r.push(i) : r.push(l)),
                    r.push("<span>{0}<span class='r-wrap'><span class='region'>{1}</span>{2}</span></span>".format(n, o, a)),
                    r = r.join(""),
                    f.__isObservable ? f.setAttr({
                        summary: r
                    }) : f.summary = r,
                    b = !1,
                    C && (C = !1,
                    c())
                }))
            }()
        }
        return p.onChange("textStatus", function() {
            f.setAttr({
                statusIsVisible: _(),
                changeStatusIsVisible: w()
            })
        }),
        p.onChange("age", E),
        p.onChange("regionId", E),
        p.onChange("countryId", E),
        p.onChange("fullName", E),
        p.onChange("firstName", E),
        p.onChange("isVKLinkHidden", E),
        p.onChange("avatar", E),
        p.onChange("vf", E),
        p.isSelfProfile && (D.$(".text-status-bubble").attr("title", "Изменить"),
        util.isOKPlatform() && (D.$(".reset-avatar").html("Вернуть аву ОК"),
        D.$(".toggle-vk-levels").remove())),
        window.__currentProfile = p,
        f
    }
    ,
    D.showSubscribe = function() {}
    ,
    D
}
,
lilo.viewFactories["profile-avatar-popup"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.toggle-fav": function() {
            i.trigger("toggle-fav")
        },
        "click@$.toggle-block": function() {
            i.trigger("toggle-block")
        },
        "click@$.open-avatar": function() {
            i.trigger("open-avatar")
        }
    },
    i.createViewModel = function(e) {}
    ,
    i
}
,
lilo.viewFactories["profile-menu"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", "[action]", function(e) {
        e = $(e.target);
        i.trigger(e.attr("action"), {
            $el: e
        })
    }),
    i
}
,
lilo.viewFactories["radio-view"] = function(e, t) {
    var i, n, h = lilo.baseViewFactory(e, t), g = app.info.viewer_id, o = (h.$(".positive-votes-line"),
    h.$(".negative-votes-line"),
    h.$(".list")), b = h.$(".audio-title"), C = h.$(".toggle-sound"), _ = h.$(".progress"), a = "full-mode", s = !1;
    function r() {
        var e;
        s && D && ((e = b.find(".m-wrapper")) && e[0] && !e[0].hasAttribute("marquee") && (e[0].setAttribute("marquee", "1"),
        e.marquee({
            duration: 5e3,
            gap: 100,
            delayBeforeStart: 0,
            direction: "left",
            duplicated: !0
        })))
    }
    function w() {
        util.isOKPlatform() ? setTimeout(r, 150) : r()
    }
    function E(e) {
        s = !1,
        util.isDef(e) ? (h.el[e ? "addClass" : "removeClass"](a),
        s = !!e) : (s = !0,
        h.el.toggleClass(a)),
        w(),
        app.youtubePlayer.updatePosition()
    }
    app.radioView = h,
    util.isOKPlatform() ? (E(!0),
    E = $.noop,
    (i = function() {
        app.youtubePlayer.updatePosition()
    }
    )(),
    $(window).on("resize", function() {
        clearTimeout(n),
        n = setTimeout(i, 100)
    })) : ($body.click(function() {
        E(!1)
    }),
    h.el.click(function(e) {
        h.model.type === RadioPlayerType.YOUTUBE && e.stopPropagation()
    })),
    h.handlers = {
        "click@$.add-track": function(e) {
            this.trigger("add-track", {
                withPayment: $(e.currentTarget).hasClass("with-payment")
            })
        },
        "click@$.add": function(e) {
            this.trigger("add", {
                $target: $(e.target)
            })
        },
        "click@$[toggle-usual-view]": function(e) {
            E()
        },
        "click@$.do-positive-vote": function() {
            this.trigger("vote", {
                value: !0
            })
        },
        "click@$.do-negative-vote": function() {
            this.trigger("vote", {
                value: !1
            })
        },
        "click@$.do-cool-vote": function() {
            this.trigger("cool")
        },
        "click@$.close-radio": function() {
            this.trigger("disable-radio")
        },
        "click@$.enable-radio": function() {
            this.trigger("enable-radio")
        },
        "click@$.not-enabled-btn": function() {
            var e = radioModel.type === RadioPlayerType.YOUTUBE ? "Не удалось загрузить видео плеер" : "Не удалось загрузить аудио плеер";
            dialogController.fadePopup({
                message: e,
                duration: 6e3
            })
        }
    };
    function l() {
        var e, t, i, n;
        return n && 0 !== n.height || (e = p.offset(),
        t = p.width(),
        i = p.height(),
        n = {
            left: e.left,
            top: e.top,
            width: t,
            height: i,
            right: e.left + t,
            bottom: e.top + i
        }),
        n
    }
    function d(e) {
        var t, i, n = (t = l(),
        i = t.top,
        n = o.height() + 40 + i,
        {
            left: t.left,
            top: i,
            width: t.width,
            height: n,
            right: t.right,
            bottom: i + n
        });
        return e.pageX >= n.left && e.pageX <= n.right && e.pageY >= n.top && e.pageY <= n.bottom
    }
    function c(e) {
        var t, i;
        t = e,
        i = l(),
        t.pageX >= i.left && t.pageX <= i.right ? f ? (d(e) ? m : v)() : (i = e,
        e = l(),
        i.pageX >= e.left && i.pageX <= e.right && i.pageY >= e.top && i.pageY <= e.bottom && m()) : v()
    }
    var u, p = h.$(".list-hint-area"), o = h.$(".list"), f = !1, m = function() {
        f || (f = !0,
        p.addClass("hovered"))
    }, v = function() {
        f && (f = !1,
        p.removeClass("hovered"))
    };
    setTimeout(function() {
        roomView.el.mousemove(function(e) {
            clearTimeout(u),
            u = setTimeout(c, 50, e)
        })
    }, 2e3);
    var y = $("<div></div>").css({
        position: "absolute",
        "font-size": "11px",
        "font-weight": "600",
        left: 0,
        top: 0,
        "pointer-events": "none",
        visibility: "hidden"
    }).appendTo($body)
      , D = !1;
    return h.createViewModel = function(i) {
        $("#yt-wrapper").click(function(e) {
            return e.preventDefault(),
            e.stopPropagation(),
            E(),
            !1
        });
        function e() {
            h.el.removeClass("type-1 type-2").addClass("type-" + i.type),
            E(!1)
        }
        e(),
        i.onChange("type", e);
        var n, t = {
            audioTitle: m(),
            leftMillis: d(),
            indexOfSelfTrackText: "",
            queueIsEmpty: r(),
            hasSelfTrack: a(),
            addTextCaption: o()
        };
        function o() {
            return i.type === RadioPlayerType.YOUTUBE ? "Добавить видеоклип" : "Добавить песню"
        }
        function a() {
            return -1 !== i.indexOfSelfTrack || i.__currentTrack && i.__currentTrack.uid === g
        }
        function s() {
            t.setAttr({
                hasSelfTrack: a()
            })
        }
        function r() {
            return 0 === i.items.length
        }
        function l() {
            s(),
            t.setAttr({
                queueIsEmpty: r()
            })
        }
        function d() {
            var e = 0;
            return e = (e = i.__currentTrack ? i.__currentTrack.durationAsMillis - i.currentProgressAdMillis : e) < 0 ? 0 : e
        }
        i.items.on("add", "self", l),
        i.items.on("removeAll", "self", l),
        i.onChange("type", function() {
            t.setAttr({
                addTextCaption: o()
            })
        }),
        i.onChange("indexOfSelfTrack", function() {
            s(),
            t.setAttr({
                indexOfSelfTrackText: ""
            })
        }),
        i.onChange("hasCurrentTrack", function() {
            s(),
            i.hasCurrentTrack || E(!1)
        }),
        h.onTrackChange = function() {
            s()
        }
        ,
        i.onChange("currentProgressAdMillis", p);
        var c = h.$(".volume-control").empty().slider({
            step: 1,
            min: 0,
            max: 100,
            range: "min",
            value: i.volume,
            slide: function(e, t) {
                clearTimeout(n),
                n = setTimeout(function() {
                    h.trigger("change-volume", {
                        volume: t.value
                    })
                }, 50)
            }
        });
        function u() {
            c.slider("option", "value");
            c.slider("value", i.volume),
            C[i.volume ? "addClass" : "removeClass"]("mute")
        }
        function p() {
            var e = 0;
            i.durationAsMillis && (e = i.currentProgressAdMillis / i.durationAsMillis * 100),
            _.css("width", (e = 100 < e ? 100 : e) + "%"),
            t.__isObservable && t.setAttr({
                leftMillis: d()
            })
        }
        function f() {
            t.setAttr({
                audioTitle: m()
            })
        }
        C.click(function(e) {
            return e.stopPropagation(),
            h.trigger("toggle-volume"),
            !1
        }),
        i.onChange("volume", u),
        u(),
        i.onChange("currentProgressAdMillis", p),
        p(),
        i.onChange("artist", f),
        i.onChange("title", f);
        function m() {
            0;
            var e = (i.artist ? i.artist + " - " : "") + i.title
              , t = util.escapeHtml(e);
            return y.html(t),
            b.html("<div class='m-wrapper'>" + t + "</div>").attr("title", t),
            D = !1,
            162 < y.width() && (D = !0,
            w()),
            e
        }
        function v() {}
        return i.onChange("positiveVotes", v),
        i.onChange("negativeVotes", v),
        t
    }
    ,
    h
}
,
lilo.viewFactories["recent-liked-photos"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.createViewModel = function(e) {}
    ,
    t
}
,
lilo.viewFactories["recent-likes-view"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    i.createViewModel = function(e) {}
    ,
    i.$(".clear-history").click(function(e) {
        i.trigger("clear-history")
    });
    function n() {
        a = !1,
        o.css("display", "none")
    }
    var o = i.$(".recent-likes-view-popup").click(function(e) {
        return util.cancelEvent(e)
    })
      , a = !1;
    return i.$(".subscribe-btn").click(function(e) {
        return (a = !a) ? (a = !1,
        o.css("display", "block")) : n(),
        util.cancelEvent(e)
    }),
    i.closePopup = n,
    $body.click(n),
    n(),
    i
}
,
lilo.viewFactories["recent-private-messages"] = function(e, t) {
    var i, n = lilo.baseViewFactory(e, t), o = {
        mouseWheelSpeed: util.jsScrollPaneSpeed(50),
        trackClickSpeed: util.jsScrollPaneSpeed(50)
    }, a = !1;
    function s() {
        var e = n.model.visibleItems.length;
        n.els.scroll.height(5 < e ? 405 : 81 * e),
        i ? i.reinitialise(o) : (n.els.scroll.jScrollPane(o),
        i = n.els.scroll.data("jsp"))
    }
    return n.createViewModel = function(e) {
        function t() {
            a && s()
        }
        function i() {
            clearTimeout(n),
            n = setTimeout(t, 200)
        }
        var n;
        e.visibleItems.on("add", "self", i),
        e.visibleItems.on("remove", "self", i),
        e.visibleItems.on("removeAll", "self", i)
    }
    ,
    n.onOpen = function() {
        a = !0,
        s()
    }
    ,
    n.onClose = function() {
        a = !1
    }
    ,
    app.recentPrivateMessagesView = n
}
,
lilo.viewFactories["reply-message-view"] = function(e, t) {
    var c = lilo.baseViewFactory(e, t);
    return c.createViewModel = function(l) {
        function e() {
            var e, t, i, n, o, a, s, r = l.message;
            d && (d.remove(),
            d = null,
            c.el.innerHTML = ""),
            r ? (i = lilo.createView("item-chat-message-v2"),
            e = r.reply,
            t = r.message,
            r.reply = null,
            r.message = r.type === app.ChatMessageType.STICKER ? r.message : (n = r.message,
            o = 60,
            a = n || "",
            s = app.controllers.Emoji.getCountOfEmojiMasks(a),
            a.length > (o += 10 * s) ? (n = a.substr(0, o),
            o = (s = a.substr(o)).indexOf(" "),
            n + (s = 0 <= (o = Math.min(o, 5)) ? s.substr(0, o) : "") + "...") : a),
            i.setModel(r),
            r.reply = e,
            r.message = t,
            d = i,
            c.el.append(i.el).show(),
            (i = document.createElement("div")).classList.add("close"),
            i.onclick = function(e) {
                c.trigger("close")
            }
            ,
            lilo.getSimpleBindHandler("border-by-level-v2")(c.el, r.fromExp),
            c.el.append(i)) : c.el.hide()
        }
        var d;
        l.onChange("message", e),
        e()
    }
    ,
    c
}
,
lilo.viewFactories["room-gift-bonus-popup"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.handlers = {
        "click@$.close": function() {
            i.remove()
        },
        "click@$.message": function() {
            i.trigger("send-message", {
                model: this.model
            }),
            i.remove()
        }
    },
    i
}
,
lilo.viewFactories["room-location-info"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = !1
      , o = !1;
    function a() {
        n || o ? (i.el.show(),
        n && o ? (i.els["left-block"].css("border-radius", "5px 0 0 0"),
        i.els["right-block"].css("border-radius", "0 5px 0 0 ")) : n ? i.els["left-block"].css("border-radius", "5px 5px 0 0") : o && i.els["right-block"].css("border-radius", "5px 5px 0 0")) : i.el.hide()
    }
    return i.setLeftBlockIsVisible = function(e) {
        n = !!e,
        i.els["left-block"].css("display", n ? "inline-block" : "none"),
        a()
    }
    ,
    i.setRightBlockIsVisible = function(e) {
        o = !!e,
        i.els["right-block"].css("display", o ? "inline-block" : "none"),
        a()
    }
    ,
    i
}
,
lilo.viewFactories["room-questions-editor"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.add-question": function() {
            this.trigger("add")
        }
    },
    t
}
,
lilo.viewFactories["room-queue-shop"] = function(e, t) {
    function r(e, t) {
        return e = document.createElement(e),
        t && (e.className = t),
        e
    }
    var l = lilo.baseViewFactory(e, t)
      , d = l.$(".list")
      , c = l.$(".counter");
    function u(e) {
        var t = parseInt(this.getAttribute("uid"), 10)
          , i = parseInt(this.getAttribute("price"), 10);
        l.trigger("select", {
            uid: t,
            price: i,
            btn: this
        })
    }
    function p() {
        var e = parseInt(this.getAttribute("uid"), 10);
        l.trigger("show-profile", {
            uid: e
        })
    }
    var f = {};
    return l.removeItem = function(e) {
        var t = f[e];
        t && (delete f[e],
        t && t.parentNode && t.parentNode.removeChild && t.parentNode.removeChild(t),
        t = util.getKeys(f).length,
        c.text(t),
        l.viewModel.setAttr({
            hasUsers: 0 < t
        }))
    }
    ,
    l.addItem = function(e, t) {
        var i, n, o, a, s;
        f[e.uid] || (i = r("div", "item"),
        n = r("div", "avatar"),
        o = r("div", "name"),
        a = r("div", "btn"),
        n.style.backgroundImage = "url(" + e.avatar + ")",
        o.innerHTML = util.escapeHtml(e.firstName + " " + e.age, 0, 1),
        s = 2 * e.price,
        a.innerHTML = "Уступить место&nbsp;&nbsp;+{0}<i class='coin'></i>".format(s),
        a.setAttribute("uid", e.uid),
        a.setAttribute("price", e.price),
        a.onclick = u,
        n.setAttribute("uid", e.uid),
        n.onclick = p,
        i.appendChild(n),
        i.appendChild(o),
        i.appendChild(a),
        d.append(i),
        f[e.uid] = i,
        t || (c.text(util.getKeys(f).length),
        l.viewModel.setAttr({
            hasUsers: !0
        })))
    }
    ,
    l.setUsers = function(e) {
        f = {},
        d.empty(),
        e.each(function(e, t) {
            l.addItem(t, !0)
        }),
        c.text(e.length),
        l.viewModel.setAttr({
            hasUsers: 0 < e.length
        })
    }
    ,
    l.showExtraTitle = function(e) {
        l.viewModel.setAttr({
            extraTitle: e
        })
    }
    ,
    l.createViewModel = function(e) {
        var i = {
            extraTitle: !1,
            hasUsers: !1
        };
        function t() {
            var e = i.extraTitle || i.hasUsers;
            l.el.css("display", e ? "block" : "none");
            var t = i.extraTitle && !i.hasUsers;
            l.el[t ? "addClass" : "removeClass"]("show-extra"),
            roomView.locationView.els["right-block"][t ? "removeClass" : "addClass"]("dark-on-hover"),
            roomView.locationView.setRightBlockIsVisible(e)
        }
        return lilo.makeObservable(i),
        t(),
        i.onChange("extraTitle", t),
        i.onChange("hasUsers", t),
        i
    }
    ,
    l
}
,
lilo.viewFactories["room-top-list"] = function(e, t) {
    var l = lilo.baseViewFactory(e, t)
      , d = l.$(".by-lottery-wins-list .my-place")
      , c = l.$(".by-sent-gifts .my-place")
      , u = l.$(".by-received-gifts  .my-place");
    return l.createViewModel = function(t) {
        var e = {
            myPlaceTextBySentGifts: i(),
            myPlaceTextByReceivedGifts: n(),
            myPlaceTextLotteryWins: o(),
            viewerAvatar: app.info.photo_100
        };
        function i() {
            return -1 < t.positionBySentGifts && t.positionBySentGifts > t.bySentGifts.length - 1 ? (c.show(),
            "Ваше место - " + (t.positionBySentGifts + 1)) : (c.hide(),
            "")
        }
        function n() {
            return -1 < t.positionByReceivedGifts && t.positionByReceivedGifts > t.byReceivedGifts.length - 1 ? (u.show(),
            "Ваше место - " + (t.positionByReceivedGifts + 1)) : (u.hide(),
            "")
        }
        function o() {
            return -1 < t.positionByLotteryWins && t.positionByLotteryWins > t.byLotteryWins.length - 1 ? (d.show(),
            "Ваше место - " + (t.positionByLotteryWins + 1)) : (d.hide(),
            "")
        }
        function a() {
            e.setAttr({
                myPlaceTextBySentGifts: i()
            })
        }
        function s() {
            e.setAttr({
                myPlaceTextByReceivedGifts: n()
            })
        }
        function r() {
            e.setAttr({
                myPlaceTextLotteryWins: o()
            })
        }
        return t.onChange("positionBySentGifts", a),
        t.bySentGifts.on("add", "self", a),
        t.onChange("positionByReceivedGifts", s),
        t.byReceivedGifts.on("add", "self", s),
        t.onChange("positionByLotteryWins", r),
        t.byLotteryWins.on("add", "self", r),
        t.onChange("pending", function(e) {
            t.pending && 0 === t.byReceivedGifts.length && 0 === t.bySentGifts.length ? l.el.addClass("pending") : l.el.removeClass("pending")
        }),
        e
    }
    ,
    l
}
,
lilo.viewFactories["room-top-list-of-teems"] = function(e, t) {
    function v(e, t) {
        return t = document.createElement(t || o),
        e && (t.className = e),
        t
    }
    var n = lilo.baseViewFactory(e, t)
      , i = n.$(".list")
      , o = "div";
    function a() {
        var e = parseInt(this.getAttribute("uid"), 10);
        0 <= e && n.trigger("show-profile", {
            uid: e
        })
    }
    function h() {
        var e = this.getAttribute("roomId")
          , i = [];
        this.getAttribute("uids").split(",").each(function(e, t) {
            i.push(parseInt(t, 10))
        }),
        n.trigger("join-to-room", {
            roomId: e,
            uids: i
        })
    }
    function g(o, e) {
        e.each(function(e, t) {
            var i = v("item-room-top-list item-room-user-v3")
              , n = v("avatar");
            n.style.backgroundImage = "url(" + (-1 === t.uid ? app.ANONYMOUS_IMG : t.avatar) + ")",
            t.vf && (n.className += " verified-photo"),
            -1 === t.uid && (i.className += " anonymous-user"),
            i.appendChild(n),
            o.appendChild(i),
            i.setAttribute("uid", t.uid),
            i.onclick = a
        });
        for (var t = e.length; t < 6; t += 1) {
            var i = v("item-room-top-list item-room-user-v3 empty-block");
            o.appendChild(i)
        }
    }
    function b(e, t) {
        var i = v("popup")
          , n = v("popup-content")
          , o = v("popup-triangle");
        n.innerHTML = e,
        i.appendChild(o),
        i.appendChild(n),
        t.appendChild(i)
    }
    return n.showRooms = function(e, p, f) {
        var m = document.createDocumentFragment();
        $.each(e, function(e, t) {
            var i, n, o, a = v("item-room cf"), s = v("left-block"), r = v("place"), l = v("room-users-block cf"), d = v("room-users-block cf"), c = v("btn btn-join");
            r.innerHTML = "#" + (e + 1),
            c.innerHTML = "Войти",
            c.setAttribute("roomId", t.roomId),
            c.onclick = h,
            s.appendChild(r),
            e < 5 && (i = v("reward"),
            n = v("", "span"),
            o = v("", "b"),
            r = v("coin-icon-el", "i"),
            n.innerHTML = "Приз каждому",
            o.innerHTML = "+" + app.RoomTopListRewards.roomTeems[e],
            i.appendChild(n),
            i.appendChild(o),
            i.appendChild(r),
            s.appendChild(i)),
            a.appendChild(s),
            a.appendChild(l),
            a.appendChild(d),
            d.className += " last";
            s = window.roomModel && t.roomId === roomModel.roomId;
            s || a.appendChild(c),
            g(l, t.males),
            g(d, t.females);
            var u = [];
            t.males.each(function(e, t) {
                u.push(t.uid)
            }),
            t.females.each(function(e, t) {
                u.push(t.uid)
            }),
            c.setAttribute("uids", u.join(",")),
            0 <= p && 0 <= f && e < p && !s ? (s = Math.abs(t.spent - f),
            b("Чтобы попасть сюда, в вашей комнате нужно отправить <b>{0}</b> {1}.<br> Всего <b>{2}</b>".format(s, util.pluralize(s, {
                one: "подарок",
                two: "подарка",
                many: "подарков"
            }), t.spent), a)) : b("Всего <b>{0}</b>".format(t.spent), a),
            m.appendChild(a)
        }),
        i.empty().append(m)
    }
    ,
    n
}
,
lilo.viewFactories["room-top-list-wrap"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    i.handlers = {
        "click@$.item-tab": function(e) {
            e = $(e.currentTarget);
            this.trigger("show-tab", {
                index: e.attr("index")
            })
        }
    };
    function n(e) {
        i.el[18 <= e ? "addClass" : "removeClass"]("is-adult-top"),
        i.el[e < 18 ? "addClass" : "removeClass"]("is-teen-top")
    }
    return n(app.info.age),
    app.eventBus.on(app.EVENTS.AGE_CHANGED, function(e) {
        n(e.age)
    }),
    i
}
,
lilo.viewFactories["room-view-v3"] = function(e, t) {
    app.ROUND_TYPE;
    var u, p = lilo.baseViewFactory(e, t), r = app.info.viewer_id, l = 2 === app.info.sex, i = p.$(".white-zone"), n = p.$(".top-users"), o = p.$(".wait-next-round-loader"), a = p.$(".progress"), s = p.$(".wait-users-loader"), d = p.$(".answer-saved"), c = p.$(".question-text"), f = p.$(".question-creator"), m = p.$(".answers"), v = p.$(".bottom-users"), h = p.$(".timer"), e = p.$(".canvas-area"), g = p.$(".answer-saving-overlay"), b = p.$(".first-user-votes,.second-user-votes,.votes-or"), t = p.$(".chat-area input"), C = p.$(".add-message-overlay"), _ = p.$(".left-coins-info"), w = (p.$(".main"),
    p.$(".switch-room,.rooms-list"),
    p.$(".invite-friend-into-self-room")), E = p.$(".self-room-control"), y = p.$(".room-owner-info");
    function D() {
        p.els.toggleSound.text(app.soundManager.isEnabled() ? "Отк. звуки" : "Вкл. звуки"),
        p.els.toggleSound[app.soundManager.isEnabled() ? "addClass" : "removeClass"]("is-enabled")
    }
    p.canvaslayer = e,
    p.forceRedraw = function(e) {}
    ,
    p.elsMap = {
        $canvasLayer: e,
        $whiteZoneEl: i,
        $topUsers: n,
        $waitNextRoundLoader: o,
        $waitUsersLoader: s,
        $answersSavedCaption: d,
        $questionText: c,
        $questionCreatorEl: f,
        $answersList: m,
        $bottomUsers: v,
        $timer: h,
        $votes: b,
        $answerSavingOverlay: g,
        $chatInput: t,
        $chatOverlay: C
    },
    p.el.addClass("chat-enable"),
    D(),
    app.eventBus.on(app.EVENTS.TOGGLE_SOUND, D);
    var T, S, A = !1;
    p.hideWaitNextRoundLoader = function() {
        A = !1,
        clearTimeout(T),
        o.hide()
    }
    ,
    p.showWaitNextRoundLoader = function() {
        var e;
        A || (A = !0,
        clearTimeout(T),
        e = 1e3 * p.model.getStartStateLeftSeconds(),
        isNaN(e) && (e = 1e4),
        a.css({
            width: "0%",
            "webkit-transition-duration": (e = e < 0 ? 500 : e) + "ms",
            "transition-duration": e + "ms"
        }),
        o.show(),
        s.hide(),
        d.hide(),
        c.hide(),
        f.hide(),
        m.hide(),
        h.hide(),
        b.hide(),
        g.hide(),
        T = setTimeout(function() {
            a.css("width", "100%")
        }, 50))
    }
    ,
    p.showWaitUsers = function() {
        s.show(),
        o.hide(),
        d.hide(),
        c.hide(),
        f.hide(),
        m.hide(),
        h.hide(),
        b.hide(),
        g.hide(),
        clearTimeout(T)
    }
    ,
    p.startTimer = function(i) {
        i = i || {};
        var e = p.model
          , e = util.isDef(i.leftSeconds) ? i.leftSeconds : e.getStartStateLeftSeconds();
        e < 0 && (e = 1),
        clearTimeout(S),
        p.viewModel.setAttr({
            roundLeftTime: e
        });
        var t = i.updateHandler || function() {
            var e, t = p.viewModel.roundLeftTime - 1;
            9 != t || roomView.model.roundType === app.ROUND_TYPE.RAFFLE || roomView.model.viewerAnswer || i.withoutSound || app.soundManager.play(app.soundManager.SOUND_IDS.VIEWER_IS_SELECTED),
            t < 0 || (p.viewModel.setAttr({
                roundLeftTime: t
            }),
            e = t,
            (t = i).onTimerUpdate ? t.onTimerUpdate(e) : p.viewModel.setAttr({
                roundLeftTime: e
            }))
        }
          , n = function() {
            t(),
            clearTimeout(S),
            S = setTimeout(n, 1e3)
        };
        S = setTimeout(n, 1e3)
    }
    ,
    p.stopTimer = function() {
        clearTimeout(S),
        1 === p.viewModel.roundLeftTime && p.viewModel.setAttr({
            roundLeftTime: 0
        })
    }
    ,
    p.animateInCounter = function(e, t, i) {}
    ,
    p.animateBalanceBonus = function(e, t) {
        var i, e = B(e);
        e && (t = t || 1,
        i = $(document.createElement("div")).addClass("balance-bonus pe-none").text("+" + t),
        e.children().append(i),
        setTimeout(function() {
            i.css({
                opacity: 1,
                top: "-33px"
            }),
            setTimeout(function() {
                i.css({
                    opacity: 0
                }),
                setTimeout(function() {
                    i.remove()
                }, 500)
            }, 1200)
        }, 50))
    }
    ;
    function I() {
        p.trigger("has-activity")
    }
    var M, O, x, R, k, P, N, U;
    function L(e) {
        var t = CDN_PREFIX + "bg/_bg{0}.jpg?v=1".format(e)
          , e = new Image;
        O = t,
        x.addClass(P),
        e.onload = function() {
            x.removeClass(P),
            R.css({
                "background-image": "url(" + t + ")"
            })
        }
        ,
        e.onerror = function() {
            x.removeClass(P)
        }
        ,
        O = t,
        e.src = t
    }
    function F() {}
    p.handlers = {
        "keypress@$input": function() {
            clearTimeout(M),
            M = setTimeout(I, 500)
        },
        "click@$.add-bot": function(e) {
            e = $(e.target);
            this.trigger("add-bot", {
                male: e.hasClass("add-bot-male"),
                female: e.hasClass("add-bot-female"),
                fill: e.hasClass("add-bot-fill")
            })
        },
        "click@$.toggle-sound": function(e) {
            app.soundManager.toggle(),
            D()
        },
        "click@$.couple-area .btns span": function(e) {
            var t = $(e.target)
              , e = t.attr("action-id");
            this.trigger("couple-choice", {
                answerId: e,
                $el: t
            })
        },
        "click@$.rooms-list": function(e) {
            e = $(e.currentTarget);
            e.hasClass("loading") || this.trigger("show-room-list", {
                $targetEl: e
            })
        },
        "click@$.online-friends": function(e) {
            e = $(e.currentTarget);
            e.hasClass("loading") || this.trigger("show-online-friends", {
                $targetEl: e
            })
        },
        "click@$.question-creator span": function(e) {
            this.trigger("show-question-owner")
        },
        "click@$.question-creator i": function(e) {
            this.trigger("open-editor")
        },
        "click@$.track-list": function(e) {
            this.trigger("open-track-list")
        },
        "click@$.switch-room": function(e) {
            this.trigger("switch-room")
        },
        "click@$.switch-room1": function(e) {
            this.trigger("switch-room")
        },
        "click@$.self-room-control": function(e) {
            this.trigger("open-self-room-control")
        },
        "click@$.invite-friend-into-self-room": function(e) {
            this.trigger("invite-friend-into-self-room")
        },
        "click@$.btn-invite-users": function(e) {
            this.trigger("invite-users")
        }
    },
    O = null,
    x = p.$(".toggle-bg"),
    R = p.$(".room-bg"),
    k = "roomBgType1",
    P = "loading",
    N = util.lStorage.find(k),
    U = function(e) {
        var t = e + 1;
        return 6 <= (e = t = 13 < t ? 1 : t) && e <= 7 ? U(t) : t
    }
    ,
    N = N ? parseInt(N, 10) : 1,
    expController.getCurrentLevel() < 15 && (N = 1),
    L(N),
    x.click(function() {
        var e;
        expController.getCurrentLevel() < 15 ? dialogController.fadePopup("Изменение заднего фона доступно с {0} уровня".format(15)) : (e = U(N),
        L(e),
        N = e,
        util.lStorage.save(k, e))
    }),
    p.getCurrentBGUrl = function() {
        return O
    }
    ,
    setTimeout(F, 400),
    p.lockSwitchRoomBtns = F;
    var V = [];
    function B(e) {
        for (var t = e + "", i = 0; i < V.length; i += 1)
            if (V[i].attr("uid") === t)
                return V[i]
    }
    p.forEachUsersEls = function(e) {
        $.each(V, e)
    }
    ,
    p.getViewerEl = function() {
        return B(app.info.viewer_id)
    }
    ,
    p.findElByUid = B;
    function G(e) {
        var t = {};
        e.data = function() {
            if (2 === arguments.length)
                t[arguments[0]] = arguments[1];
            else if (1 === arguments.length)
                return t[arguments[0]];
            return null
        }
        ,
        e.removeData = function() {
            return t = {},
            e
        }
    }
    var H = []
      , W = [];
    function j(o, a, s) {
        function l(e, t) {
            e = e || 451,
            (p.isVisible || t) && (e -= 14,
            i ? (p.els["chat-messages-scroll-wrap"].height(e),
            i.reinitialise(n)) : (p.els["chat-messages-scroll-wrap"].height(e).jScrollPane(n),
            i = p.els["chat-messages-scroll-wrap"].data("jsp")))
        }
        var i, d = [], c = !1, r = null, n = {
            mouseWheelSpeed: util.jsScrollPaneSpeed(50),
            trackClickSpeed: util.jsScrollPaneSpeed(50)
        };
        l(0, !0);
        var t = o.parent();
        o.detach(),
        this.prepend = function(e, t) {
            d.unshift(t),
            o.prepend(e.el)
        }
        ,
        this.getModels = function() {
            return d
        }
        ,
        this.show = function() {
            var e;
            c || (c = !0,
            t.append(o),
            l(),
            r && i && (e = i.getContentHeight(),
            r.height === e ? i.scrollToY(r.scroll) : e < r.height ? i.scrollToY(0) : i.scrollToY(r.scroll + e - r.height)))
        }
        ,
        this.hide = function() {
            c && (c = !1,
            i && (r = {
                scroll: i.getContentPositionY(),
                height: i.getContentHeight()
            }),
            o.detach())
        }
        ,
        this.removeMessage = function(e) {
            var t = e.model
              , t = d.indexOf(t);
            -1 !== t && d.splice(t, 1),
            e.remove(),
            c && l()
        }
        ;
        function u(i) {
            var n = {
                index: -1,
                model: null
            };
            return d.each(function(e, t) {
                if (t.uniqId === i)
                    return !(n = {
                        index: e,
                        model: t
                    })
            }),
            n
        }
        this.removeChatMessageWithAnimation = function(e) {
            var t, e = u(e);
            e.model && ((t = e.model.__chatMessageView).el.addClass("blink"),
            setTimeout(function() {
                t.remove(),
                c && l()
            }, 1200))
        }
        ,
        this.replaceChatMessage = function(e, t, i) {
            var n, o, a, s = u(e), r = u(t);
            s.model && r.model && (e = s.model,
            t = r.model,
            n = e.__chatMessageView,
            o = t.__chatMessageView,
            (a = lilo.createView("item-chat-message")).setModel(i),
            (i.__chatMessageView = a).el.css("opacity", "0").addClass("fade-out-transition"),
            n.el.addClass("blink"),
            o.el.addClass("blink"),
            setTimeout(function() {
                n.el[0].parentNode.replaceChild(a.el[0], n.el[0]),
                setTimeout(function() {
                    a.el.css("opacity", "1")
                }, 10),
                n.remove(),
                o.remove(),
                c && l()
            }, 1200),
            d[s.index] = i,
            d.splice(r.index, 1))
        }
        ,
        this.checkSize = function() {
            var e = o.children()
              , t = e.length;
            if (s < t) {
                for (var i, n = d.length = a; n < e.length; n += 1)
                    (i = e[n]) && i.parentNode && i.parentNode.removeChild(i);
                r = null
            }
        }
        ,
        this.initJScrollPane = l,
        this.clear = function() {
            r = null,
            d.length = 0,
            o.empty()
        }
    }
    p.removeUsersGiftsDataByElementId = function(i) {
        V.each(function(e, t) {
            if (t.$giftsCanvas.attr("canvas-id") === i)
                return t.$giftsCanvas.removeData(),
                !1
        })
    }
    ,
    p.initViewEls = function() {
        n.children().each(function() {
            var e = $(this);
            e.$giftsArea = e.find(".gifts-area"),
            e.$giftsCanvas = e.find(".gifts-canvas"),
            e.$giftsExtraArea = e.find(".gifts-extra-area"),
            G(e.$giftsCanvas),
            H.push(e),
            V.push(e)
        }),
        v.children().each(function() {
            var e = $(this);
            e.$giftsArea = e.find(".gifts-area"),
            e.$giftsCanvas = e.find(".gifts-canvas"),
            e.$giftsExtraArea = e.find(".gifts-extra-area"),
            G(e.$giftsCanvas),
            W.push(e),
            V.push(e)
        })
    }
    ,
    p.$topUsersEls = H,
    p.$bottomUsersEls = W,
    p.update = function() {}
    ,
    p.checkBots = function() {}
    ,
    p.els["chat-messages-scroll-wrap"].on("mousewheel", function(e) {
        e.preventDefault()
    });
    var K = new j(p.$(".chat-messages-1"),70,90)
      , Y = new j(p.$(".chat-messages-2"),70,90)
      , q = Y;
    p.getChatMessages = function() {
        var i = [];
        return K.getModels().each(function(e, t) {
            i.push(t)
        }),
        Y.getModels().each(function(e, t) {
            i.push(t)
        }),
        i
    }
    ,
    p.replaceChatMessage = function(e, t, i) {
        K.replaceChatMessage(e, t, i),
        Y.replaceChatMessage(e, t, i)
    }
    ,
    p.removeChatMessage = function(e) {
        K.removeChatMessageWithAnimation(e),
        Y.removeChatMessageWithAnimation(e)
    }
    ;
    p.initJScrollPane = function(e) {
        q.initJScrollPane(e)
    }
    ;
    function z() {
        q = q === K ? (K.hide(),
        Y.show(),
        Y) : (Y.hide(),
        K.show(),
        K)
    }
    var X, Q = app.ChatMessageType;
    z(),
    window.toggleMessagesContainer = z,
    p.setChatMode = function(e) {
        1 === e ? (q = K,
        Y.hide(),
        K.show()) : (q = Y,
        K.hide(),
        Y.show())
    }
    ,
    X = 0,
    $document.on("keyup", function(e) {
        if (17 === e.which && p.isVisible) {
            var t = util.currentMillis();
            if (X && t - X < 1e3)
                return X = 0,
                z(),
                util.cancelEvent(e);
            X = t
        }
    }),
    p.el.on("click", ".toggle-chat-mode-info", z),
    p.addChatMessages = function(e, i) {
        $.each(e, function(e, t) {
            !function(e, t, i) {
                var n, o, a = !1, s = !1;
                switch (e) {
                case Q.GIFT:
                    i.to !== r || t || (a = s = !0);
                    break;
                case Q.BATCH_GIFT:
                    i.toMale !== l || i.from === r || t || (a = s = !0);
                    break;
                case Q.SYSTEM_REWARD_IN_LOCAL_ROOM_TOP:
                case Q.LOTTERY_COMMON_RESULT:
                    t || (a = s = !0);
                    break;
                case Q.SYSTEM_USER_REMOVE_BY_USER:
                case Q.SYSTEM_USER_SAVED_BY_USER:
                case Q.SYSTEM_USER_STATUS:
                    t || (a = s = !0);
                    break;
                default:
                    a = !0
                }
                a && ((n = lilo.createView("item-chat-message")).setModel(i),
                i.__chatMessageView = n,
                (o = K).prepend(n, i),
                s && setTimeout(function() {
                    n.el.addClass("blink"),
                    setTimeout(function() {
                        o.removeMessage(n)
                    }, 1200)
                }, 2e4))
            }(t.type, i, t),
            function(e, t) {
                if (!(e === Q.NORMAL || e === Q.TALK || e === Q.STICKER)) {
                    e = lilo.createView("item-chat-message");
                    e.setModel(t),
                    Y.prepend(e, t)
                }
            }(t.type, t)
        }),
        K.checkSize(),
        Y.checkSize(),
        q.initJScrollPane()
    }
    ,
    p.clearChat = function() {
        K.clear(),
        Y.clear(),
        C.hide(),
        u.reset()
    }
    ,
    p.lockChat = function(e) {
        u.reset(),
        u.clearInput(),
        u.closeEmojiForm(),
        e += util.currentMillis();
        e = util.formatDate(e, function(e, t, i, n, o) {
            return e + "." + t + "." + i + " " + n + ":" + o
        });
        p.els["chat-lock"].show().html("<span>Вы заблокированы в чате<br/> до " + e + "</span>")
    }
    ,
    p.unlockChat = function() {
        p.els["chat-lock"].hide()
    }
    ,
    p.updateChatHeight = function(e) {
        e = 451 - (e.textAreaHeight - 34);
        p.initJScrollPane(e)
    }
    ,
    p.startChatTimer = function() {
        u.startTimerLock()
    }
    ,
    p.getViewerOffset = function() {
        var e, t = roomView.findElByUid(app.info.viewer_id);
        return t && (e = t.children().offset(),
        isMobi && (t = $appArea.offset(),
        e.left -= t.left)),
        e = e || {
            left: 0,
            top: 0
        }
    }
    ;
    p.resortTopUsers = function(e, t) {}
    ,
    p.on("select-first-name:item-room-user-v3", function(e) {
        e = e.extraData.model;
        e.uid !== app.info.viewer_id && u && u.addUserIntoInput(e)
    }),
    p.el.on("click", ".player-not-enabled", function() {
        var e = (e = window.ytLastError || "") && "<div>" + e + "</div>"
          , e = "Проблема с загрузкой проигрывателя.<br>Flag:(" + window.YouTubeIframeAPIReady + ")<br>" + e + " Попробуйте зайти с другого браузера";
        dialogController.showMessageDialog({
            message: e
        })
    }),
    p.createViewModel = function(i) {
        function e() {
            _.html("Вы можете выиграть в качестве приза за титул в данной комнате еще {0} {1}".format(i.leftCoinsInLocalRoomTop, util.pluralize(i.leftCoinsInLocalRoomTop, "монету", "монеты", "монет"))).css("display", i.leftCoinsInLocalRoomTop === Constants.MAX_COINS_IN_LOCAL_ROOM_TOP_PER_PERIOD ? "none" : "block")
        }
        function n() {
            var e = roomModel.isConference() || roomModel.pending || roomModel.getMalesCount() < 3 || roomModel.getFemalesCount() < 3;
            p.el[e ? "addClass" : "removeClass"]("hide-local-top-timer")
        }
        [197333171, 147863751].indexOf(app.info.viewer_id) || app.info.selfRoomId || E.detach(),
        p.el.addClass(2 === app.info.sex ? "viewer-is-male" : "viewer-is-female"),
        IS_DESKTOP && app.mp3playerIsInit && (p.el.addClass("is-desktop"),
        p.el.addClass("radio-is-enabled")),
        u = new app.controllers.ChatFormController({
            roomModel: i,
            roomView: p,
            $form: p.$("form"),
            omSoundIconClick: function() {
                p.trigger("show-audio-dialog")
            },
            onSubmit: function(e, t, i) {
                p.trigger("add-chat-message", {
                    text: e,
                    to: t,
                    reply: i
                }),
                p.setChatMode(1)
            }
        }),
        p.chatFromController = u,
        i.onChange("leftCoinsInLocalRoomTop", e),
        e();
        var t = {
            roundLeftTime: 0,
            hasUidAndFirstName: s(),
            showSelfRoomPreloader: a(),
            inviteRoomLink: o()
        };
        function o() {
            return util.createAppLink({
                hash: "r" + app.info.selfRoomId
            })
        }
        function a() {
            return i.ownerId === app.info.viewer_id && !roomModel.isConference()
        }
        function s() {
            return i.roundQuestion.uid && i.roundQuestion.fullName && !i.pending
        }
        function r() {
            t.setAttr({
                hasUidAndFirstName: s()
            })
        }
        function l() {
            app.info.selfRoomId && i.ownerId === app.info.viewer_id ? (E.hide(),
            w.css("display", "inline-block")) : (w.hide(),
            E.css("display", "inline-block")),
            t.__isObservable && t.setAttr({
                showSelfRoomPreloader: a(),
                inviteRoomLink: o()
            })
        }
        function d() {
            i.ownerId && i.roomOwnerFirstName && i.roomOwnerLastName ? y.html("Хозяин этой комнаты " + util.escapeHtml(i.roomOwnerFirstName + " " + i.roomOwnerLastName, 0, 1)).show() : y.hide()
        }
        function c() {
            var e = ""
              , t = i.accessDescr || {};
            2 === t.type ? e = "Песочница" : 1 === t.type ? e = "" : 3 === t.type ? e = "{0}+".format(i.accessDescr.level) : 4 === t.type ? e = "" + util.fixRegionName(i.accessDescr.regionId, i.accessDescr.regionName) : 5 === t.type ? e = "" + i.accessDescr.countryName : 6 === t.type && (e = "lottery round"),
            e ? (p.locationView.els["left-block"].html("<div>" + e + ".</div>"),
            p.locationView.setLeftBlockIsVisible(!0)) : (p.locationView.els["left-block"].html(""),
            p.locationView.setLeftBlockIsVisible(!1))
        }
        return l(),
        d(),
        c(),
        roomModel.onChange("accessDescr", c),
        roomModel.onChange("ownerId", l),
        roomModel.onChange("ownerId", d),
        roomModel.onChange("roomOwnerFirstName", d),
        roomModel.onChange("roomOwnerLastName", d),
        roomModel.onChange("modCounter", function() {
            p.el[roomModel.isConference() ? "addClass" : "removeClass"]("is-conference"),
            roomModel.isConference() && q !== K && z(),
            n()
        }),
        roomModel.onChange("roomOwnerLastName", d),
        i.roundQuestion.onChange("uid", r),
        i.roundQuestion.onChange("fullName", r),
        i.onChange("pending", r),
        i.onChange("pending", n),
        i.processUsers(function(e, t) {
            t.onChange("uid", n)
        }),
        y.click(function() {
            i.ownerId && app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: i.ownerId
            })
        }),
        (app.viewerIsBeginner() || isMobi) && f.detach(),
        t
    }
    ,
    p.el.on("mousedown", function() {
        p.mouseIsDown = !0
    }),
    p.el.on("mouseup", function() {
        p.mouseIsDown = !1
    });
    var J = "beginners-hint-clicks";
    p.getCountOfClicksOnBeginnerHint = function() {
        var e = util.lStorage.find(J)
          , e = parseInt(e, 10);
        return e = isNaN(e) ? 0 : e
    }
    ,
    p.incCountOfClicksOnBeginnerHint = function() {
        var e = p.getCountOfClicksOnBeginnerHint();
        return e++,
        util.lStorage.save(J, e),
        e
    }
    ;
    function Z(e) {
        var i, n = !1;
        V.each(function(e, t) {
            if (t && t.hasClass("has-beginner-btn") && t.hasClass("show-beginner-hint") && !t.hasClass("is-empty"))
                return !(n = !0)
        }),
        2 <= p.getCountOfClicksOnBeginnerHint() ? V.each(function(e, t) {
            t.removeClass("show-beginner-hint")
        }) : n || (i = [],
        roomModel.topUsers.each(function(e, t) {
            t.uid && i.push({
                i: t.orderIndex,
                uid: t.uid
            })
        }),
        roomModel.bottomUsers.each(function(e, t) {
            t.uid && i.push({
                i: t.orderIndex + 100,
                uid: t.uid
            })
        }),
        i.sort(function(e, t) {
            return e.i === t.i ? 0 : e.i < t.i ? -1 : 1
        }),
        i.each(function(e, t) {
            t = B(t.uid);
            if (t && t.hasClass("has-beginner-btn"))
                return t.addClass("show-beginner-hint"),
                !1
        }))
    }
    var ee;
    return p.toggleBeginnersHint = function() {
        clearTimeout(ee),
        ee = setTimeout(Z, 1e3)
    }
    ,
    setInterval(function() {
        roomView.toggleBeginnersHint()
    }, 1e4),
    window.roomView = p
}
,
lilo.viewFactories["round-result-area2"] = function(e, t) {
    var r = lilo.baseViewFactory(e, t)
      , l = app.info.viewer_id
      , d = Constants.BONUS_PER_GAME_WIN;
    function c(e, t) {
        var n;
        t && t.length && (n = $(document.createElement("div")).addClass("badges"),
        $.each(t, function(e, t) {
            var i = lilo.createView("item-round-badge");
            i.setModel(t),
            n.append(i.el)
        }),
        e.append(n))
    }
    return r.handlers = {
        "click@$.close": function() {
            this.trigger("close")
        }
    },
    r.createViewModel = function(e) {
        var t, i, n, o, a, s = e.winPair;
        s ? ((t = lilo.createView("item-user")).setModel(e.winPair.male),
        t.el.click(function() {
            t.trigger("show-profile", {
                uid: e.winPair.male.uid
            })
        }),
        c(t.el, e.winPair.male.badges),
        (i = lilo.createView("item-user")).setModel(e.winPair.female),
        i.el.click(function() {
            t.trigger("show-profile", {
                uid: e.winPair.female.uid
            })
        }),
        c(i.el, e.winPair.female.badges),
        n = $("<div/>", {
            class: "matches",
            text: e.winPair.matches
        }).append($("<div/>", {
            text: util.pluralize(e.winPair.matches, {
                one: "Cовпадение",
                two: "Cовпадения",
                many: "Cовпадений"
            })
        })),
        s.female.uid !== l && s.male.uid !== l || (o = !1,
        a = $("<span/>").text("Забрать приз").addClass("btn yellow").click(function(e) {
            var t, i, n;
            o || (o = !0,
            t = {
                x: e.pageX - 10,
                y: e.pageY - 10
            },
            i = $("#balance-icon-el").offset(),
            n = Math.min(10, d),
            util.repeat(n, function(e) {
                setTimeout(function() {
                    app.controllers.fx.emitCoin({
                        x: t.x,
                        y: t.y
                    }, !0, {
                        onCollectComplete: function() {
                            e === n - 1 && (app.balanceModel.setAttr({
                                balance: app.balanceModel.balance + d
                            }),
                            a.remove())
                        },
                        endPoint: {
                            x: i.left,
                            y: i.top
                        },
                        $coinEl: $("<span/>").css({
                            width: "20px",
                            height: "20px",
                            backgroundImage: "url(" + CDN_PREFIX + "coin-icon-128.png)",
                            backgroundPosition: "center",
                            backgroundRepeat: "no-repeat",
                            backgroundSize: "100% 100%",
                            left: t.x + "px",
                            top: t.y + "px",
                            position: "absolute"
                        })
                    })
                }, 150 * e)
            }))
        }),
        n.append(a)),
        s = $("<div/>", {
            class: "h-separator"
        }),
        r.$("#win-pair").append(t.el.addClass("left")).append(n).append(i.el).append(s),
        r.onRemove(function() {
            t.remove(),
            i.remove()
        })) : r.$("#win-pair").remove()
    }
    ,
    r
}
,
lilo.viewFactories["test-yt-player"] = function(e, t) {
    var n, t = lilo.baseViewFactory(e, t), o = "test-yt-player";
    $('head script[src="https://www.youtube.com/iframe_api"]').remove(),
    $('head script[src="https://www.youtube.com/player_api"]').remove();
    var i = "0CFuCYNx-1g";
    function a() {
        n = new YT.Player(o + "player",{
            height: "150",
            width: "300",
            playerVars: {
                fs: 0,
                autoplay: 0,
                rel: 0,
                version: 3,
                origin: "*",
                enablejsapi: 1,
                allowfullscreen: !1,
                wmode: "transparent",
                cc_load_policy: 0,
                iv_load_policy: 3,
                modestbranding: 1,
                disablekb: 1,
                playsinline: 0,
                showinfo: 0,
                controls: 0
            },
            events: {
                onReady: s,
                onStateChange: l
            }
        })
    }
    function s(e) {
        console.log("onPlayerReady"),
        document.getElementById(o + "play").onclick = function() {
            n.setVolume(0),
            n.mute(),
            n.loadVideoById({
                videoId: i,
                startSeconds: 0,
                suggestedQuality: "small"
            })
        }
        ,
        document.getElementById(o + "pause").onclick = function() {
            n.pauseVideo()
        }
        ,
        document.getElementById(o + "mute").onclick = function() {
            n.mute()
        }
        ,
        document.getElementById(o + "unMute").onclick = function() {
            n.unMute()
        }
    }
    var r = 0;
    function l(e) {
        var t, i = {
            "-1": "(unstarted)",
            0: "(ended)",
            1: "(playing)",
            2: "(paused)",
            3: "(buffering)",
            5: "(video cued)"
        };
        console.log("onPlayerStateChange", i[e.data]),
        i = i[e.data],
        (t = document.createElement("div")).style.backgroundColor = "#ffffff",
        t.style.padding = "2px",
        t.style.color = "#000",
        t.style.marginBottom = "1px",
        t.style.pointerEvents = "none",
        t.style.zIndex = "500",
        t.style.fontSize = "2em",
        t.innerHTML = (r += 1) + ". " + i,
        document.getElementById(o + "log").appendChild(t),
        setTimeout(function() {
            document.getElementById(o + "log").removeChild(t)
        }, 5e3),
        1 === e.data && (n.setVolume(60),
        n.unMute())
    }
    return $body.empty().append(t.el),
    setTimeout(function() {
        var e, t;
        window.YouTubeIframeAPIReady ? (app.youtubePlayer.ytPlayer.destroy(),
        a()) : (window.onYouTubeIframeAPIReady = a,
        (e = document.createElement("script")).src = "https://www.youtube.com/player_api",
        (t = document.getElementsByTagName("script")[0]).parentNode.insertBefore(e, t))
    }, 1e3),
    t
}
,
lilo.viewFactories["top-list"] = function(e, t) {
    var n = lilo.baseViewFactory(e, t);
    n.handlers = {
        "click@$.item-tab": function(e) {
            this.trigger("change-tab", {
                index: parseInt($(e.target).attr("index"), 10)
            })
        },
        "click@$.reload": function() {
            this.trigger("reload")
        },
        "click@$.show-males": function() {
            this.trigger("show-males")
        },
        "click@$.show-females": function() {
            this.trigger("show-females")
        }
    };
    var o = n.$(".item-tab").map(function() {
        return $(this)
    })
      , a = n.$(".by-exp-list .numeration")
      , s = n.$(".harem-list .numeration")
      , r = n.$(".by-exp-list")
      , l = n.$(".harem-list");
    return n.createViewModel = function(t) {
        var e = {
            viewerAvatar: app.info.photo_100
        };
        function i() {
            o[0][t.currentTabIsAll ? "addClass" : "removeClass"]("selected"),
            o[1][t.currentTabIsAll ? "removeClass" : "addClass"]("selected"),
            r[t.currentTabIsAll ? "show" : "hide"](),
            l[t.currentTabIsAll ? "hide" : "show"]()
        }
        return 2 !== app.info.sex ? n.el.addClass("viewer-is-female") : n.el.addClass("viewer-is-male"),
        t.onChange("currentTabIsAll", i),
        i(),
        t.byRegion.females.on("add", "self", function() {
            var e = Math.max(t.byCountry.males.length, t.byCountry.females.length, t.all.males.length, t.all.females.length, t.byRegion.males.length, t.byRegion.females.length)
              , i = document.createDocumentFragment();
            util.repeat(e, function(e) {
                var t = document.createElement("span");
                t.innerHTML = e + 1 + "",
                i.appendChild(t)
            }),
            a.empty().append(i)
        }),
        t.byHaremTotalPrice.users.on("add", "self", function() {
            var i = document.createDocumentFragment();
            util.repeat(t.byHaremTotalPrice.users.length, function(e) {
                var t = document.createElement("span");
                t.innerHTML = e + 1 + "",
                i.appendChild(t)
            }),
            s.empty().append(i)
        }),
        e
    }
    ,
    n
}
,
lilo.viewFactories["users-search-form"] = function(e, t) {
    var l, d, c = lilo.baseViewFactory(e, t), i = c.$(".btn.search"), n = c.$(".btn.reset-search");
    function o() {
        var e = 18 <= app.info.age
          , t = e ? 18 : c.model.MINIMUM_AGE
          , i = e ? c.model.MAXIMUM_AGE : 17;
        l = t,
        d = i;
        for (var n = document.createDocumentFragment(), o = document.createDocumentFragment(), a = t; a <= i; a += 1) {
            var s = document.createElement("option")
              , r = document.createElement("option");
            s.innerHTML = a + "",
            r.innerHTML = a + "",
            s.value = a + "",
            r.value = a + "",
            n.appendChild(s),
            o.appendChild(r)
        }
        c.els["age-min"].empty().append(n),
        c.els["age-max"].empty().append(o),
        c.els["age-min"].val(c.model.ageMin + ""),
        c.els["age-max"].val(c.model.ageMax + ""),
        u(),
        p()
    }
    function u() {
        c.trigger("change-age-min", {
            ageMin: parseInt(c.els["age-min"].val(), 10)
        })
    }
    function p() {
        c.trigger("change-age-max", {
            ageMax: parseInt(c.els["age-max"].val(), 10)
        })
    }
    function a() {
        c.trigger("change-min-level", {
            level: parseInt(c.els["level-select"].val(), 10)
        })
    }
    return c.handlers = {
        "change@$input[name='target-sex']": function(e) {
            e = parseInt(e.currentTarget.value, 10);
            c.trigger("change-sex", {
                sex: e
            })
        },
        "change@$select[el='level-select']": function() {
            a()
        },
        "change@$select[el='age-min']": function() {
            u()
        },
        "change@$select[el='age-max']": function() {
            p()
        },
        "click@$.change-location": function() {
            this.trigger("change-location")
        },
        "click@$.search": function(e) {
            this.trigger("search", {
                $btn: i
            })
        },
        "click@$.reset-search": function(e) {
            this.trigger("reset-search", {
                $btn: n
            })
        }
    },
    c.createViewModel = function(e) {
        o(),
        function() {
            for (var e = document.createDocumentFragment(), t = 1; t < 30; t += 1) {
                var i = document.createElement("option");
                i.innerHTML = t + "",
                i.value = t + "",
                e.appendChild(i)
            }
            c.els["level-select"].empty().append(e),
            c.els["level-select"].val(c.model.minLevel + ""),
            a(),
            c.model.onChange("minLevel", function() {
                c.els["level-select"].val(c.model.minLevel + "")
            })
        }(),
        c.els["vf-checkbox"][0].checked = e.vfChecked,
        c.els["vf-checkbox"].on("change", function() {
            c.trigger("change-vf", {
                value: c.els["vf-checkbox"][0].checked
            })
        }),
        e.onChange("ageMin", function() {
            var e = c.model.ageMin;
            l <= e && e <= d ? c.els["age-min"].val(e + "") : o()
        }),
        e.onChange("ageMax", function() {
            var e = c.model.ageMax;
            l <= e && e <= d ? c.els["age-max"].val(e + "") : o()
        }),
        e.onChange("sex", function() {
            c.$('input[name="target-sex"]').filter('[value="' + e.sex + '"]').prop("checked", !0)
        }),
        c.$('input[name="target-sex"]').filter('[value="' + e.sex + '"]').prop("checked", !0)
    }
    ,
    c
}
,
lilo.viewFactories["users-search-result-list"] = function(e, t) {
    t = lilo.baseViewFactory(e, t);
    return t.handlers = {
        "click@$.show-more-online-items": function() {
            this.trigger("show-more-online-items")
        },
        "click@$.show-more-items": function() {
            this.trigger("show-more-items")
        }
    },
    t
}
,
lilo.viewFactories["users-search-view"] = function(e, t) {
    return lilo.baseViewFactory(e, t)
}
,
lilo.viewFactories["viral-answers-v2"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t)
      , n = i.$(".list")
      , o = i.$(".load-more")
      , a = i.$(".no-items");
    return i.el.on("click", ".load-more", function() {
        i.trigger("load-more")
    }),
    i.createViewModel = function(e) {
        function t() {
            n.css("display", e.items.length ? "block" : "none"),
            a.css("display", e.items.length ? "none" : "block")
        }
        e.viewItems.on("add", "self", function() {
            o.css("display", e.viewItems.length === e.items.length ? "none" : "inline-block")
        }),
        t(),
        e.items.on("add", "self", t)
    }
    ,
    i
}
,
lilo.viewFactories["viral-questions-v2"] = function(e, t) {
    var d = lilo.baseViewFactory(e, t)
      , o = d.$(".left-answers-hint")
      , r = "with-transition"
      , s = "slide-down"
      , l = lilo.getSimpleBindHandler("bg-with-loading");
    d.el.on("click", ".answer", function(e) {
        var t = $(e.currentTarget).attr("index");
        d.trigger("answer", {
            index: t,
            pageX: e.pageX,
            pageY: e.pageY
        })
    }),
    d.el.on("click", ".extend-period", function(e) {
        d.trigger("extend-period", {
            $btn: $(e.target)
        })
    }),
    d.el.on("click", ".skip-friend", function() {
        d.trigger("skip")
    }),
    d.el.on("click", ".continue-play", function() {
        app.eventBus.trigger(app.EVENTS.JOIN_TO_ROOM)
    });
    function i() {
        var n;
        a && 0 === d.el.offset().top || 0 !== (n = d.el.offset()).top && (a = {},
        $.each(d.els["stars-line"].children(), function(e, t) {
            var i = $(t).offset()
              , t = i.left - n.left
              , i = i.top - n.top;
            a[e] = {
                x: t,
                y: i
            }
        }))
    }
    function n() {
        return i(),
        a[10 === d.model.progress ? 0 : d.model.progress]
    }
    var a, c = [];
    util.repeat(10, function(e) {
        var t = $(document.createElement("div"));
        t.addClass("item-star"),
        c.push(t),
        d.els["stars-line"].append(t)
    }),
    d.throwCoin = function(e, t, i) {
        e -= 10,
        t -= 100;
        var n, o, a, s, r, l = $("<span/>").css({
            width: "30px",
            height: "29px",
            backgroundImage: "url(" + CDN_PREFIX + "coin-icon-30.png)",
            backgroundPosition: "0 0",
            backgroundRepeat: "no-repeat",
            left: e + "px",
            top: t + "px",
            position: "absolute"
        }), o = (o = t,
        r = 0,
        250 < (r = (s = 800 - (n = e) - 30) < (a = n - 30) ? a : s) && (r = 250),
        {
            x: ((250 < a && 250 < s ? 1 === util.random(1, 2) : s < a) ? -1 : 1) * util.random(.3 * r, r) + n,
            y: util.random(100, 150) + o
        });
        app.controllers.fx.emitCoin({
            x: e,
            y: t
        }, 0, {
            $container: d.el,
            $coinEl: l,
            endPoint: o,
            dropStateEndPoint: o,
            onDropComplete: function() {
                l.off().one("mouseover", function() {
                    l.addClass("animated-bonus-el"),
                    setTimeout(function() {
                        l.css({
                            left: "695px",
                            top: "-109px"
                        }),
                        setTimeout(function() {
                            l.remove(),
                            i()
                        }, 1e3)
                    }, 100)
                }),
                setTimeout(function() {
                    l.trigger("mouseover")
                }, 1e4)
            },
            onCollectComplete: function() {}
        })
    }
    ,
    d.throwStar = function(e, t) {
        e -= 10,
        t -= 100,
        10 === d.model.progress && d.model.setAttr({
            progress: 0
        });
        var i = $("<span/>").css({
            width: "25px",
            height: "28px",
            backgroundImage: "url(" + CDN_PREFIX + "progress-star.png)",
            backgroundPosition: "0 -28px",
            backgroundRepeat: "no-repeat",
            left: e + "px",
            top: t + "px",
            position: "absolute"
        });
        app.controllers.fx.emitCoin({
            x: e,
            y: t
        }, 1, {
            $container: d.el,
            $coinEl: i,
            endPointProvider: n,
            onDropComplete: function() {},
            onCollectComplete: function() {
                d.trigger("star-collect")
            }
        })
    }
    ;
    var u = 1;
    return d.forceRestore = function() {
        u++,
        this.els["overflow-area"].css("overflow", ""),
        this.els["question-text"].removeClass(r).removeClass(s).css({
            top: "0"
        }),
        this.els["question-content"].html(this.model.questionText),
        this.els["question-overlay"].hide(),
        this.els["answer-1"].removeClass(r).removeClass(s).css({
            top: "0"
        }),
        this.els["answer-2"].removeClass(r).removeClass(s).css({
            top: "0"
        }),
        this.els["answer-3"].removeClass(r).removeClass(s).css({
            top: "0"
        }),
        this.showNexFriendAvatar($.noop, {
            force: !0
        }),
        clearInterval(void 0)
    }
    ,
    d.slideQuestionAndAnswersDown = function(e) {
        e = e || $.noop,
        this.els["overflow-area"].css("overflow", "hidden"),
        this.els["question-text"].addClass(r).addClass(s),
        this.els["answer-1"].addClass(r).addClass(s),
        this.els["answer-2"].addClass(r).addClass(s),
        this.els["answer-3"].addClass(r).addClass(s);
        var t = this
          , i = u;
        setTimeout(function() {
            i === u && (t.els["question-text"].css("top", "230px"),
            t.els["answer-1"].css("top", "210px"),
            t.els["answer-2"].css("top", "210px"),
            t.els["answer-3"].css("top", "210px"),
            setTimeout(function() {
                i === u && e()
            }, 300))
        }, 50)
    }
    ,
    d.showNexFriendAvatar = function(e, t) {
        e = e || $.noop;
        var i, n, o = this.model.friendAvatar, a = $(document.createElement("div")), s = this.els["friend-avatar-wrapper"];
        l(a, o),
        t && t.force ? s.empty().append(a) : (i = s.children(),
        a.css({
            left: "120px",
            opacity: 0
        }).addClass(r).appendTo(s),
        i.addClass(r),
        n = u,
        setTimeout(function() {
            n === u && (a.css({
                left: "0",
                opacity: 1
            }),
            i.css({
                left: "-120px",
                opacity: 0
            }),
            setTimeout(function() {
                n === u && (i.remove(),
                e())
            }, 600))
        }, 100))
    }
    ,
    d.animateQuestionText = function(e) {
        e = e || $.noop,
        this.els["question-text"].removeClass(r).css({
            top: ""
        });
        var t = this.model.questionText
          , i = u
          , n = this.els["question-overlay"]
          , o = this.els["question-content"][0];
        o.innerHTML = "",
        n.removeClass(r).removeClass(s).css("width", "100%").show(),
        setTimeout(function() {
            i === u && (o.innerHTML = t,
            n.addClass(r),
            setTimeout(function() {
                i === u && (n.css("width", "0%"),
                setTimeout(function() {
                    i === u && e()
                }, 600))
            }, 100))
        }, 100)
    }
    ,
    d.slideUpAnswers = function(e) {
        e = e || $.noop;
        var t = this.els["answer-1"]
          , i = this.els["answer-2"]
          , n = this.els["answer-3"];
        t.addClass(r).removeClass(s),
        i.addClass(r).removeClass(s),
        n.addClass(r).removeClass(s);
        var o = this
          , a = u;
        setTimeout(function() {
            (u = a) && t.css("top", 0),
            setTimeout(function() {
                (u = a) && i.css("top", 0)
            }, 250),
            setTimeout(function() {
                (u = a) && (n.css("top", 0),
                setTimeout(function() {
                    (u = a) && (o.els["overflow-area"].css("overflow", ""),
                    e())
                }, 250))
            }, 500)
        }, 100)
    }
    ,
    d.animateBonus = function(e) {
        e = e || $.noop;
        var t = $(document.createElement("span")).addClass("bonus-star").css({
            left: "608px",
            top: "398px"
        }).appendTo(d.el);
        setTimeout(function() {
            t.css({
                left: "765px",
                top: "-29px"
            }),
            setTimeout(function() {
                t.remove(),
                e()
            }, 1100)
        }, 100)
    }
    ,
    window.animateBonus = function() {
        d.animateBonus()
    }
    ,
    (window.viralView = d).createViewModel = function(t) {
        function e() {
            $.each(c, function(e, t) {
                t[e < d.model.progress ? "addClass" : "removeClass"]("filled")
            })
        }
        function i() {
            var e = t.leftAnswers;
            o.html("Вы ответили на <b>{0}</b> из <b>{1}</b> вопросов".format(20 - e, 20))
        }
        e(),
        t.onChange("progress", e),
        i(),
        t.onChange("leftAnswers", i);
        var n = {
            soundEnabled: app.soundManager.isEnabled()
        };
        return d.el.on("click", ".toggle-sound", function() {
            app.soundManager.toggle()
        }),
        app.eventBus.on(app.EVENTS.TOGGLE_SOUND, function() {
            n.setAttr({
                soundEnabled: app.soundManager.isEnabled()
            })
        }),
        n
    }
    ,
    d
}
,
lilo.viewFactories["viral-view-v2"] = function(e, t) {
    var i = lilo.baseViewFactory(e, t);
    return i.el.on("click", ".item-tab", function(e) {
        e = $(e.currentTarget);
        i.trigger("show-tab", {
            tabName: e.attr("tab-name")
        })
    }),
    i.createViewModel = function() {
        var e = {
            rest: app.balanceModel.bonusCoins
        };
        return app.balanceModel.onChange("bonusCoins", function() {
            e.setAttr({
                rest: app.balanceModel.bonusCoins
            })
        }),
        e
    }
    ,
    i
}
,
window.isExternal = !!window.isExternal,
window.ODR = !!window.ODR,
window.app = {
    sdk: {},
    models: {},
    controllers: {
        dialog: {}
    },
    __serverV: null,
    onGetServerVersion: function(e) {
        e && (null === this.__serverV ? this.__serverV = e : this.__serverV !== e && dialogController.showAppRebootDialog())
    },
    viewerIsBeginner: function() {
        return !!window.expController && expController.getCurrentExp() < 15850
    },
    services: {},
    util: {},
    info: {
        siteAppId: parseInt(BOOT_DATA.openApiId, 10),
        appSid: +new Date + "",
        timeDiff: 0,
        favUsersUids: {},
        blockedUids: {},
        complaintAgeUids: {},
        complaintsBadNameHash: {},
        complaintAbuseUids: {},
        tabId: null
    },
    missLovesUids: {},
    accessLevels: {
        superLike: 8,
        privacy: 25
    }
},
window.hashOfInvalidSapsImages = {},
window.isOkDirect = !1,
window.isTester = function() {}
,
window.isGamePreviewVisible = function() {
    return !1
}
,
window.closeMobiChat = function() {
    return !1
}
,
window.testError = function() {
    throw new Error("test")
}
,
function(e) {
    var t, i, n, o, a, s = e.body, r = e.createElement("div");
    r.innerHTML = '<span style="' + ["position:absolute", "width:auto", "font-size:128px", "left:-99999px"].join(" !important;") + '">' + Array(100).join("wi") + "</span>",
    r = r.firstChild,
    i = (t = function(e) {
        return r.style.fontFamily = e,
        s.appendChild(r),
        a = r.clientWidth,
        s.removeChild(r),
        a
    }
    )("monospace"),
    n = t("serif"),
    o = t("sans-serif"),
    window.isFontAvailable = function(e) {
        return i !== t(e + ",monospace") || o !== t(e + ",sans-serif") || n !== t(e + ",serif")
    }
}(document),
window.onMP3PlayerErrorListener = null,
window.onMP3PlayerCompleteListener = null,
window.onMP3PlayerInitListener = null,
window.onMP3PlayerInit = function() {
    app.mp3playerIsInit = !0,
    console.log("mp3 player is init"),
    onMP3PlayerInitListener && onMP3PlayerInitListener()
}
,
window.onMP3PlayerError = function(e) {
    try {
        e = e || {},
        GA("Radio", "SWFError", JSON.stringify(e)),
        console.error(e)
    } catch (e) {}
    onMP3PlayerErrorListener && onMP3PlayerErrorListener()
}
,
window.onMP3PlayerComplete = function(e) {
    onMP3PlayerCompleteListener && onMP3PlayerCompleteListener()
}
,
$(function() {
    isDirect || setTimeout(function() {
        var e, t;
        app.mp3playerIsInit || ($("#swf-wrap").remove(),
        e = CDN + "build/out/mp3-player.js",
        (t = document.createElement("script")).async = !0,
        t.type = "text/javascript",
        t.charset = "utf-8",
        t.src = e,
        $body.append(t))
    }, 6e3)
}),
window.apiBridge = {},
window.RadioPlayerType = {
    VK_AUDIO: 1,
    YOUTUBE: 2
},
window.GuestReferrer = {
    TOP: 1,
    ROOM_TOP: 2,
    QUESTION_AUTHOR: 3,
    GUESTS_LIST: 4,
    AD: 5,
    FAV_USERS_LIST: 6,
    GAME: 7,
    HAREM: 8,
    NOTIFICATIONS: 9
},
window.NotificationType = {
    BOUGHT_UP_GIRL: 1,
    GIRL_IS_GONE: 2,
    FOR_GIRL: 3,
    GIFT_FOR_GIRL: 4,
    INVISIBILITY_EXPIRED: 5,
    ROOM_INVITE: 6,
    BOUGHT_UP_DEPOSIT: 7,
    BOUGHT_DEPOSIT: 8,
    BOUGHT_DEPOSIT_WITH_BONUS: 9,
    ADMIN_CHANGE_STATUS_OF_QUESTION: 10,
    RESERVE_DEPOSIT: 11,
    PROFILE_PRIVACY_SUBSCRIPTION_IS_EXPIRED: 12,
    VERIFICATION_PHOTO_ALLOW: 13,
    VERIFICATION_PHOTO_DENY: 14,
    PHOTO_ALLOW: 15,
    PHOTO_DENY: 16,
    VERIFICATION_PHOTO_BLOCKED: 17,
    PHOTO_LIKE: 18,
    DEPOSIT_V2_PROFIT: 19,
    VK_OFFER_IS_COMPLETE: 21,
    BONUS_NEW_LEVEL: 22,
    BONUS_ROOM_TOP_LIST: 23,
    BONUS_ROOM_TOP_LIST_MULTI: 24
},
window.ExitReason = {
    COMPLAINTS_OF_AGE: 1,
    TIMEOUT: 2,
    BAN: 3,
    JUST_EXIT: 4,
    COMPLAINTS_OF_ABUSE: 5,
    COMPLAINTS_OF_BAD_NAME: 55,
    BY_ROOM_OWNER: 6,
    BY_USER: 7,
    GAVE_PLACE_TO_QUEUE: 8,
    EXIT_AFTER_ROUND_COMPLETE: 9,
    P2P_OTHER_USER_EXIT: 10
},
window.StockType = {
    FIRST_PAYMENT: 1,
    EXTRA_LIMITED_COINS: 2,
    EXTRA_COINS_WITH_TIMER: 3
},
window.StockCurrency = {
    COINS: 1,
    RUBIES: 2
},
window.StockTheme = {
    1: {
        className: "sale-day",
        label: "Sale-Day"
    },
    2: {
        className: "theme-black-friday-2018",
        label: "Black-Friday"
    },
    3: {
        className: "sale-day sale-day-v2",
        label: "Sale-Day-V2 (PlayHome)"
    }
},
window.KickReasonId = ["Без указания причины", "За использование нецензурных выражений", "За некорректное поведение в отношении других игроков", "За оскорбление других игроков", "За нецензурный/оскорбительный аватар", "За пассивную игру", "Чтобы освободить место другим игрокам"],
app.ROOM_STATE = {
    WAITING_USERS: 1,
    STARTED: 2,
    PAUSED: 3
},
app.ROOM_USER_STATE = {
    IDLE: 1,
    ANSWERED: 2
},
app.PrivateMessageType = {
    TYPE_GOLD: 100,
    TYPE_GOLD_RECEIVED: 4,
    TYPE_USUAL: 50,
    P2P_INVITE: 200
},
app.PrivateMessageState = {
    STATE_REQUEST: 1,
    STATE_RESPONSE: 3,
    STATE_COMPLETE: 4,
    STATE_RESPONSE_REMOVE: 5
},
app.ANONYMOUS_IMG = CDN_PREFIX + "spy_icon_100.png",
window.GIFT_IMGS_SERVER = "https://sapps-static.ru/gifts/",
window.GIFT_SOUNDS_SERVER = "https://sapps-static.ru/sounds/",
app.ROUND_TYPE = {
    NORMAL: 1,
    WHO_LIKES_ON_MALES: 2,
    WHO_LIKES_ON_FEMALES: 3,
    RAFFLE: 4,
    CHOICE_EACH_OTHER: 6,
    LOTTERY: 7,
    CHOOSE_COUPLE_FOR_MALE: 8,
    CHOOSE_COUPLE_FOR_FEMALE: 9,
    LOADING_ROUND: 10
},
app.RoundSubState = {
    CHOOSING_PARTNER_FOR_KISS: 1,
    SHOW_ARROWS: 2,
    SHOW_SELF_ARROWS: 3,
    VOTING: 4,
    SHOW_RESULT: 5
},
app.SUBSCRIBE_TYPES = {
    TEXT_COLOR: 1,
    RATING_COLOR: 2,
    AVATAR_BG: 3
},
app.ChatMessageType = {
    NORMAL: 1,
    GIFT: 2,
    TALK: 3,
    SYSTEM_BAN_USER: 5,
    SYSTEM_USER_CAME: 6,
    SYSTEM_USER_OUT: 7,
    LIKE_SOUND: 8,
    SYSTEM_NEW_LEVEL: 9,
    LOTTERY_WIN: 10,
    PROMOTION_TRACK: 11,
    SYSTEM_REPLACE_CURRENT_TRACK: 13,
    SYSTEM_USER_REMOVE_BY_USER: 14,
    SYSTEM_USER_STATUS: 15,
    SYSTEM_REWARD_IN_TOP_LIST: 16,
    STICKER: 17,
    BATCH_GIFT: 18,
    COOL_TRACK: 19,
    LOTTERY_COMMON_RESULT: 20,
    PHOTO_LIKE: 21,
    UNITED_STICKER: 22,
    SYSTEM_USER_SAVED_BY_USER: 23,
    SYSTEM_REWARD_IN_LOCAL_ROOM_TOP: 25
},
app.UsersRoundQuestionStatus = {
    ON_MODERATION: 1,
    PUBLIC: 2,
    PRIVATE: 3,
    REJECTED: 4
},
app.GLOBAL_COLORS = ["#f26d00", "#61D8CA", "#6245D6", "#000", "#636363", "#9b3bc4", "#CF40E2", "#C0A410", "#d30a0a", "#08a234", "#270cc9", "#7665de", "#ea1f9b", "#318874"],
app.EXP_BONUS = {
    CROWN: 100,
    KISS: 60,
    EMBRACE: 30,
    SMILE: 30,
    GUEST: 10
},
app.RoomTopListRewards = {
    roomTeems: {
        0: 10,
        1: 5,
        2: 3,
        3: 2,
        4: 1
    },
    adult: {
        lottery: {
            daily: [3e3, 2e3, 1e3, 700, 600, 500, 400, 300, 200, 100],
            hourly: [300, 200, 100, 70, 60, 50, 40, 30, 20, 10]
        },
        wastefull: {
            daily: [3e3, 2e3, 1e3, 700, 600, 500, 400, 300, 200, 100],
            hourly: [300, 200, 100, 70, 60, 50, 40, 30, 20, 10]
        },
        popular: {
            daily: [1500, 1e3, 500, 350, 300, 250, 200, 150, 100, 50],
            hourly: [150, 100, 50, 35, 30, 25, 20, 15, 10, 5]
        }
    },
    teen: {
        lottery: {
            daily: [1e3, 700, 300, 250, 200, 150, 100, 50, 40, 30],
            hourly: [100, 70, 30, 25, 20, 15, 10, 5, 4, 3]
        },
        wastefull: {
            daily: [1e3, 700, 300, 250, 200, 150, 100, 50, 40, 30],
            hourly: [100, 70, 30, 25, 20, 15, 10, 5, 4, 3]
        },
        popular: {
            daily: [500, 350, 150, 125, 100, 75, 50, 25, 20, 15],
            hourly: [50, 35, 15, 12, 10, 7, 5, 3, 2, 1]
        }
    }
},
app.getTopListTitle = function() {
    var o = ["wpg1h", "wpg2h", "wpg4h", "wpg1d", "wpg2d", "wpg4d"];
    return function(e, t) {
        var i = 2 === t
          , n = "undefined";
        return "wpt1" === e ? n = "{0} за день".format(i ? "Самый Щедрый" : "Самая Щедрая") : "wpt2" === e ? n = "{0} за день".format(i ? "Самый Популярный" : "Самая Популярная") : "wpt3" === e ? n = "{0} за день".format(i ? "Самый Успешный" : "Самая Успешная") : "wpt4" === e ? n = "{0} за день".format(i ? "Самый Удачливый" : "Самая Удачливая") : "wpt1h" === e ? n = "{0} за час".format(i ? "Самый щедрый" : "Самая щедрая") : "wpt2h" === e ? n = "{0} за час".format(i ? "Самый популярный" : "Самая популярная") : "wpt3h" === e ? n = "{0} за час".format(i ? "Самый успешный" : "Самая успешная") : "wpt4h" === e ? n = "{0} за час".format(i ? "Самый удачливый" : "Самая удачливая") : "wpthh" === e ? n = "Комнаты-Лидеры" : -1 !== o.indexOf(e) && (t = parseInt(e[3], 10),
        e = "d" === e[4],
        1 === t ? n = "{0} за {1}".format(i ? "Самый щедрый" : "Самая щедрая", e ? "день" : "час") : 2 === t ? n = "{0} за {1}".format(i ? "Самый Популярный" : "Самая Популярная", e ? "день" : "час") : 4 === t && (n = "{0} за {1}".format(i ? "Самый Удачливый" : "Самая Удачливая", e ? "день" : "час"))),
        n
    }
}(),
app.getComplaintReasons = function(e, t) {
    var i = [];
    return 18 <= e && !app.info.complaintAgeUids[t] && i.push({
        selected: !1,
        text: "Пользователь моложе 18 лет",
        value: ExitReason.COMPLAINTS_OF_AGE
    }),
    util.isOKAppUid(t) && !app.info.complaintsBadNameHash[t] && i.push({
        selected: !1,
        text: "Некорректное имя",
        value: ExitReason.COMPLAINTS_OF_BAD_NAME
    }),
    i
}
,
app.canShowViralTab = function(e) {
    return app.info.viewer_id === parseInt("2233282", 10) + 75 || app.info.viewer_id === parseInt("31144420", 10) + 75 || app.info.viewer_id === parseInt("209139263", 10) + 75 || !!util.isVKPlatform() && !app.services.vk.isUsersMemberOfDevClubs()
}
,
app.canVerifyPhotos = function(e) {
    return !0
}
,
app.hasAccessToCamera = function() {
    return !!window.isExternal || (!isMobi || !util.isOKPlatform())
}
,
app.canVerify = function() {
    return !isDirect || (isMvk || window.isExternal || window.ODR)
}
,
function() {
    function e() {
        return "global_event" + t++
    }
    var t = +new Date;
    app.EVENTS = {
        GET_BONUS_FOR_NEW_LEVEL: e(),
        APP_INIT: e(),
        SHOW_OK_VIRAL_TAB: e(),
        OK_INVITATION: e(),
        P2P_DATA: e(),
        P2P_LIKE: e(),
        REMOVE_PRIVATE_MESSAGE: e(),
        MOVE_TO_CONFERENCE: e(),
        UPDATE_GAME_PREVIEW: e(),
        UPDATE_FREQ_GIFTS: e(),
        UPDATE_RECENT_GIFTS: e(),
        SEND_ROOM_GIFT: e(),
        LIKE_PHOTO: e(),
        PHOTOS_CHANGED: e(),
        INC_PHOTO_LIKE_COUNTER: e(),
        VIEWER_VERIFICATION_STATUS_CHANGE: e(),
        VIEWER_EXP_CHANGED: e(),
        VIEWER_LEVEL_CHANGED: e(),
        AGE_CHANGED: e(),
        IS_NEW_USER_CHANGED: e(),
        ROOM_STAY_ACTIVE: e(),
        ROOM_IS_DEACTIVATED: e(),
        WANT_TO_AD_LIST: e(),
        USER_EXIT_FROM_ROOM: e(),
        SHOW_PROFILE: e(),
        OPEN_ADD_PHOTOS: e(),
        GO_TO_PHOTOS: e(),
        ADD_SUB_COMMENT: e(),
        VIEWER_TEXT_COLOR_CHANGED: e(),
        DELETE_COMMENT: e(),
        DELETE_SUB_COMMENT: e(),
        ACTIVE_COMMENTS_COUNT_CHANGED: e(),
        ADD_COMMENT: e(),
        GET_BOOT_DATA: e(),
        SHOW_VIRAL_QUESTIONS: e(),
        INVISIBILITY_STATE_CHANGED: e(),
        INVISIBILITY_EXPIRED: e(),
        TARGET_COMMENT_NOT_FOUND: e(),
        GAME_COMPLETE: e(),
        OPEN_INVIS_PURCHASE_DIALOG: e(),
        USER_ADDED_TO_FAV: e(),
        USER_COMPLAIN_TO_AGE: e(),
        USER_COMPLAIN_TO_ABUSE: e(),
        USER_REMOVED_FROM_FAV: e(),
        USER_BLOCKED: e(),
        USER_UNBLOCKED: e(),
        JOIN_TO_ROOM: e(),
        GO_TO_PRIVATE_ROOM: e(),
        OPEN_EDITOR: e(),
        VIEWER_ROOM_GIFTS_CHANGES: e(),
        VIEWER_ROOM_WINS_CHANGES: e(),
        VIEWER_GAME_COUNTER_CHANGES: e(),
        ON_ROOM_TOP_LIST_WIN: e(),
        ON_ROOM_TOP_LIST_WIN_BY_SENT_GIFTS: e(),
        ON_ROOM_TOP_LIST_WIN_BY_RECEIVED_GIFTS: e(),
        ON_ROOM_TOP_LIST_WIN_BY_EXP: e(),
        ON_ROOM_TOP_LIST_WIN_BY_LOTTERY_WINS: e(),
        ON_GET_ROOM_TOP_LIST: e(),
        ADD_TO_HAREM: e(),
        ON_GET_NEW_NOTIFICATIONS: e(),
        REQUEST_UPDATE_HAREM: e(),
        LOTTERY_NUMBER_WIN_IS_SELECTED: e(),
        AUDIO_PREVIEW_START: e(),
        AUDIO_PREVIEW_STOP: e(),
        CAN_GET_BALANCE_BONUS_IN_VIRAL_GAME: e(),
        CAN_GET_BALANCE_BONUS_IN_VIRAL_GAME_FOR_OPEN_VIRAL_ANSWER: e(),
        NUMBER_OF_CLOSED_VIRAL_ANSWERS_CHANGED: e(),
        NO_EMOJI_SUBSCRIBE: e(),
        ADD_CHAT_MESSAGE_SUCCESS: e(),
        UPDATE_RECENT_EMOJI: e(),
        REGION_CHANGED: e(),
        STICKER_CONFIG_CHANGED: e(),
        ON_GET_DEPOSITS: e(),
        PURCHASE: e(),
        CHANGE_STOCK_LIST: e(),
        TOGGLE_SOUND: e(),
        BONUS_COINS_UPDATED: e(),
        ROOM_GIFTS_LIST_UPDATED: e(),
        OPEN_EXCHANGE_FRIENDS: e(),
        NO_ACCESS_TO_AUDIO: e(),
        ON_UI_ACTIVITY: e(),
        LOAD_SELF_YT_TRACKS: e(),
        DELETE_SELF_YT_TRACK: e(),
        SOUND_MANAGER_CREATED: e()
    }
}(),
app.GLOBAL_COLORS_HASH = function() {
    var i = {};
    return $.each(app.GLOBAL_COLORS, function(e, t) {
        i[e] = t
    }),
    i
}(),
app.makeEventDispatcher = function(e) {
    var n = {};
    return $.extend(e, {
        clearAndBind: function(e, t) {
            this.off(e),
            this.on(e, t)
        },
        on: function(e, t) {
            (n[e] || (n[e] = $.Callbacks())).add(t)
        },
        once: function(e, t) {
            var i = this
              , n = function() {
                t.apply(this, arguments),
                i.off(e, n)
            };
            i.on(e, n)
        },
        off: function(e, t) {
            var i = n[e];
            i && (t ? i.remove(t) : delete n[e])
        },
        trigger: function(e, t) {
            t = t || {};
            e = n[e];
            e && e.fire(t)
        },
        has: function(e, t) {
            e = n[e];
            return !!e && e.has(t)
        }
    }),
    e
}
,
app.eventBus = app.makeEventDispatcher({}),
app.hasAccessToAudio = !0,
app.eventBus.on(app.EVENTS.NO_ACCESS_TO_AUDIO, function() {
    app.hasAccessToAudio = !1
}),
"/" !== BOOT_DATA.appContext[BOOT_DATA.appContext.length - 1] && (BOOT_DATA.appContext += "/"),
BOOT_DATA.testServer = "true" === BOOT_DATA.testServer;
var Constants = {
    SEX: {
        UNKNOWN: 0,
        FEMALE: 1,
        MALE: 2
    },
    MAX_COINS_IN_LOCAL_ROOM_TOP_PER_PERIOD: 20,
    BONUS_PER_REFERRAL: 5,
    BONUS_PER_ADD_TO_FAV: 20,
    FRIENDS_EXCHANGE_EXP_RATE: 300,
    PHOTO_VERIFICATION_BLOCK_TEXT: "В связи с частой отправкой некорректных фотографий на проверку возможность добавлять новые фото заблокирована до "
}
  , ROOM_GIFT_TYPE = {
    HAT: 1,
    GLASSES: 2,
    HORNS: 3,
    WITH_TARGET: 4,
    BOTTOM_RIGHT_SIDE: 5,
    MUSTACHE: 6,
    MELODY: -666
}
  , VerificationRejectReasons = ["Не видно лица", "Нечеткое фото", "Неверный жест", "На фото должны быть вы", "На фотографии много разных людей", "Лицо плохо видно", "Нет жеста", "Лицо плохо видно из-за плохого освещения в комнате", "Чрезмерное искажение лица в фоторедакторе", "Алкоголь/сигареты", "Дополнительные элементы на фото", "Много фотофильтров", "Нет жеста / неверный жест", "Нечеткое фото", "Лицо плохо видно", "Черно-белое фото", "На фото много людей", "Дополнительные элементы на фото", "Искажение глаз / лица", "Чрезмерное использование фотофильтров", "Алкоголь / сигареты", "На фото должны быть вы", "У вас уже есть похожее фото", "Кровь, ссадины, увечья"];
VerificationRejectReasons.get = function(e) {
    return e < 0 ? -1 === e ? "Нарушение правил" : "" : this[e - 1] || ""
}
,
function() {
    var e = 1;
    window.ROOM_GIFT_ACTION = {
        ONE_USER_X1: e++,
        ONE_USER_X3: e++,
        ONE_USER_X10: e++,
        ONE_USER_X30: e++,
        ONE_USER_X50: e++,
        MANY_USERS_X1: e++,
        MANY_USERS_X10: e++,
        MANY_USERS_X30: +e,
        MANY_USERS_X50: 9
    }
}(),
function() {
    var e = navigator.userAgent
      , t = e.toLowerCase();
    window.IS_IOS = !!e.match(/(iPad|iPhone|iPod)/i),
    window.IS_WINDOW_PHONE = -1 !== t.indexOf("windows phone"),
    window.IS_ANDROID = !!(e.match(/Android/) || t.match(/Dalvik/) || t.match(/GINGERBREAD/) || t.match(/Linux;.*Mobile Safari/) || t.match(/Linux 1\..*AppleWebKit/)),
    window.IS_DESKTOP = !e.match(/(iPhone|iPod|iPad|Android|BlackBerry)/) && !IS_ANDROID && !IS_WINDOW_PHONE,
    window.IS_FIREFOX = -1 < navigator.userAgent.toLowerCase().indexOf("firefox");
    var i = !!navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)
      , e = !!navigator.platform.match(/(iPhone|iPod|iPad)/i);
    window.IS_MSIE = /msie/i.test(t) && !/opera/i.test(t) || /trident\//i.test(t);
    t = !!window.opera || 0 <= navigator.userAgent.indexOf(" OPR/");
    window.browserInfo = {
        isOpera: t,
        isFirefox: "undefined" != typeof InstallTrigger && -1 < navigator.userAgent.toLowerCase().indexOf("firefox"),
        isSafari: 0 < Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor"),
        isChrome: !!window.chrome && !t,
        isIE: IS_MSIE,
        isDesktopMac: i && !e
    }
}(),
window.ajaxLoader = app.ajaxLoader = function() {
    var n = $("#ajax-loader")
      , o = n.children()
      , a = !1
      , s = isMobi ? 0 : 70;
    return {
        show: function(e) {
            var t, i;
            a || (t = 0,
            i = socialApi.getWindowHeight(),
            t = t = i ? Math.min(i, socialApi.getFrameHeight()) / 2 - s + socialApi.getScroll() : t,
            o.css("top", t ? t + "px" : ""),
            n.show(),
            a = !0)
        },
        hide: function(e, t) {
            a && (n.hide(),
            a = !1)
        }
    }
}();
var windowVisibilityState = function() {
    var t, i, e = {
        hidden: "visibilitychange",
        webkitHidden: "webkitvisibilitychange",
        mozHidden: "mozvisibilitychange",
        msHidden: "msvisibilitychange"
    };
    for (t in e)
        if (t in document) {
            i = e[t];
            break
        }
    return i ? function(e) {
        return e && document.addEventListener(i, e),
        !document[t]
    }
    : function() {
        return !0
    }
}();
!function() {
    for (var a = 0, e = ["ms", "moz", "webkit", "o"], t = 0; t < e.length && !window.requestAnimationFrame; ++t)
        window.requestAnimationFrame = window[e[t] + "RequestAnimationFrame"],
        window.cancelAnimationFrame = window[e[t] + "CancelAnimationFrame"] || window[e[t] + "CancelRequestAnimationFrame"];
    window.requestAnimationFrame || (window.requestAnimationFrame = function(e, t) {
        var i = (new Date).getTime()
          , n = Math.max(0, 16 - (i - a))
          , o = window.setTimeout(function() {
            e(i + n)
        }, n);
        return a = i + n,
        o
    }
    ),
    window.cancelAnimationFrame || (window.cancelAnimationFrame = function(e) {
        clearTimeout(e)
    }
    ),
    window.requestAnimFrame = window.requestAnimationFrame
}(),
Array.prototype.lastEl || (Array.prototype.lastEl = function() {
    return this[this.length - 1]
}
),
Array.prototype.isEmpty || (Array.prototype.isEmpty = function() {
    return 0 === this.length
}
),
Array.prototype.firstEl || (Array.prototype.firstEl = function() {
    return this[0]
}
),
String.prototype.format || (String.prototype.format = function() {
    for (var e = this, t = 0; t < arguments.length; t++)
        var i = new RegExp("\\{" + t + "\\}","gi")
          , e = e.replace(i, arguments[t]);
    return e
}
),
String.prototype.replaceAt || (String.prototype.replaceAt = function(e, t) {
    return this.substr(0, e) + t + this.substr(e + t.length)
}
),
String.prototype.startWith || (String.prototype.startWith = function(e) {
    return this.substr(0, e.length) === e
}
),
String.prototype.contains || (String.prototype.contains = function(e) {
    return -1 !== this.indexOf(e)
}
),
Array.prototype.contains || (Array.prototype.contains = function(e) {
    return -1 !== this.indexOf(e)
}
),
Array.prototype.equals || (Array.prototype.equals = function(i) {
    return this.length == i.length && this.every(function(e, t) {
        return e == i[t]
    })
}
),
Array.prototype.chunks || (Array.prototype.chunks = function(e) {
    for (var t = [], i = 0; i < this.length; i += e)
        t.push(this.slice(i, i + e));
    return t
}
),
Date.prototype.isValid || (Date.prototype.isValid = function() {
    return !isNaN(this.getTime())
}
),
Array.prototype.each || (Array.prototype.each = function(e) {
    for (var t = 0; t < this.length && !1 !== e(t, this[t]); t += 1)
        ;
}
),
Array.prototype.pushArray || (Array.prototype.pushArray = function(e) {
    this.push.apply(this, e)
}
),
navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia,
window.RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection,
window.RTCSessionDescription = window.RTCSessionDescription || window.webkitRTCSessionDescription || window.mozRTCSessionDescription,
function(e) {
    e.ui.slider && (e.extend(e.ui.slider.prototype.options, {
        minRangeSize: 0,
        maxRangeSize: 100,
        autoShift: !1,
        lowMax: 100,
        topMin: 0
    }),
    e.extend(e.ui.slider.prototype, {
        _slide: function(e, t, i) {
            var n, o;
            this.options.values && this.options.values.length ? (n = this.values(t ? 0 : 1),
            o = 0 === t ? 1 : -1,
            2 === this.options.values.length && !0 === this.options.range && (0 === t && i > this.options.lowMax && (i = this.options.lowMax),
            (n - (i = (n - (i = 1 === t && i < this.options.topMin ? this.options.topMin : i)) * o < this.options.minRangeSize ? n - this.options.minRangeSize * o : i)) * o > this.options.maxRangeSize && (!0 === this.options.autoShift ? n = i + this.options.maxRangeSize * o : i = n - this.options.maxRangeSize * o)),
            i !== this.values(t) && ((o = this.values())[t] = i,
            o[t ? 0 : 1] = n,
            !1 !== this._trigger("slide", e, {
                handle: this.handles[t],
                value: i,
                values: o
            }) && (this.values(t, i, !0),
            this.values((t + 1) % 2, n, !0)))) : i !== this.value() && !1 !== this._trigger("slide", e, {
                handle: this.handles[t],
                value: i
            }) && this.value(i)
        }
    })),
    e(function() {
        try {
            !isMobi && IS_IOS && window.FastClick && FastClick.attach(document.body)
        } catch (e) {}
    })
}(jQuery),
app.levelsData = [[0, 0, 0], [1, 0, 49], [2, 50, 149], [3, 150, 349], [4, 350, 849], [5, 850, 1849], [6, 1850, 3849], [7, 3850, 5849], [8, 5850, 9849], [9, 9850, 15849], [10, 15850, 23849], [11, 23850, 33849], [12, 33850, 45849], [13, 45850, 59849], [14, 59850, 75849], [15, 75850, 93849], [16, 93850, 113849], [17, 113850, 135849], [18, 135850, 159849], [19, 159850, 185849], [20, 185850, 213849], [21, 213850, 243849], [22, 243850, 275849], [23, 275850, 309849], [24, 309850, 345849], [25, 345850, 383849], [26, 383850, 423849], [27, 423850, 465849], [28, 465850, 509849], [29, 509850, 555849], [30, 555850, 603849], [31, 603850, 653849], [32, 653850, 705849], [33, 705850, 759849], [34, 759850, 815849], [35, 815850, 873849], [36, 873850, 933849], [37, 933850, 995849], [38, 995850, 1059849], [39, 1059850, 1125849], [40, 1125850, 1193849], [41, 1193850, 1263849], [42, 1263850, 1335849], [43, 1335850, 1409849], [44, 1409850, 1485849], [45, 1485850, 1563849], [46, 1563850, 1643849], [47, 1643850, 1725849], [48, 1725850, 1809849], [49, 1809850, 1895849], [50, 1895850, 1983849], [51, 1983850, 2073849], [52, 2073850, 2165849], [53, 2165850, 2259849], [54, 2259850, 2355849], [55, 2355850, 2453849], [56, 2453850, 2553849], [57, 2553850, 2655849], [58, 2655850, 2759849], [59, 2759850, 2865849], [60, 2865850, 2973849], [61, 2973850, 3083849], [62, 3083850, 3195849], [63, 3195850, 3309849], [64, 3309850, 3425849], [65, 3425850, 3543849], [66, 3543850, 3663849], [67, 3663850, 3785849], [68, 3785850, 3909849], [69, 3909850, 4035849], [70, 4035850, 4163849], [71, 4163850, 4293849], [72, 4293850, 4425849], [73, 4425850, 4559849], [74, 4559850, 4695849], [75, 4695850, 4833849], [76, 4833850, 4973849], [77, 4973850, 5115849], [78, 5115850, 5259849], [79, 5259850, 5405849], [80, 5405850, 5553849], [81, 5553850, 5703849], [82, 5703850, 5855849], [83, 5855850, 6009849], [84, 6009850, 6165849], [85, 6165850, 6323849], [86, 6323850, 6483849], [87, 6483850, 6645849], [88, 6645850, 6809849], [89, 6809850, 6975849], [90, 6975850, 7143849], [91, 7143850, 7313849], [92, 7313850, 7485849], [93, 7485850, 7659849], [94, 7659850, 7835849], [95, 7835850, 8013849], [96, 8013850, 8193849], [97, 8193850, 8375849], [98, 8375850, 8559849], [99, 8559850, 8745849], [100, 8745850, 8933849], [101, 8933850, 9123849], [102, 9123850, 9315849], [103, 9315850, 9509849], [104, 9509850, 9705849], [105, 9705850, 9903849], [106, 9903850, 10103849], [107, 10103850, 10305849], [108, 10305850, 10509849], [109, 10509850, 10715849], [110, 10715850, 10923849], [111, 10923850, 11133849], [112, 11133850, 11345849], [113, 11345850, 11559849], [114, 11559850, 11775849], [115, 11775850, 11993849], [116, 11993850, 12213849], [117, 12213850, 12435849], [118, 12435850, 12659849], [119, 12659850, 12885849], [120, 12885850, 13113849], [121, 13113850, 13343849], [122, 13343850, 13575849], [123, 13575850, 13809849], [124, 13809850, 14045849], [125, 14045850, 14283849], [126, 14283850, 14523849], [127, 14523850, 14765849], [128, 14765850, 15009849], [129, 15009850, 15255849], [130, 15255850, 15503849], [131, 15503850, 15753849], [132, 15753850, 16005849], [133, 16005850, 16259849], [134, 16259850, 16515849], [135, 16515850, 16773849], [136, 16773850, 17033849], [137, 17033850, 17295849], [138, 17295850, 17559849], [139, 17559850, 17825849], [140, 17825850, 18093849], [141, 18093850, 18363849], [142, 18363850, 18635849], [143, 18635850, 18909849], [144, 18909850, 19185849], [145, 19185850, 19463849], [146, 19463850, 19743849], [147, 19743850, 20025849], [148, 20025850, 20309849], [149, 20309850, 20595849], [150, 20595850, 20883849], [151, 20883850, 21173849], [152, 21173850, 21465849], [153, 21465850, 21759849], [154, 21759850, 22055849], [155, 22055850, 22353849], [156, 22353850, 22653849], [157, 22653850, 22955849], [158, 22955850, 23259849], [159, 23259850, 23565849], [160, 23565850, 23873849], [161, 23873850, 24183849], [162, 24183850, 24495849], [163, 24495850, 24809849], [164, 24809850, 25125849], [165, 25125850, 25443849], [166, 25443850, 25763849], [167, 25763850, 26085849], [168, 26085850, 26409849], [169, 26409850, 26735849], [170, 26735850, 27063849], [171, 27063850, 27393849], [172, 27393850, 27725849], [173, 27725850, 28059849], [174, 28059850, 28395849], [175, 28395850, 28733849], [176, 28733850, 29073849], [177, 29073850, 29415849], [178, 29415850, 29759849], [179, 29759850, 30105849], [180, 30105850, 30453849], [181, 30453850, 30803849], [182, 30803850, 31155849], [183, 31155850, 31509849], [184, 31509850, 31865849], [185, 31865850, 32223849], [186, 32223850, 32583849], [187, 32583850, 32945849], [188, 32945850, 33309849], [189, 33309850, 33675849], [190, 33675850, 34043849], [191, 34043850, 34413849], [192, 34413850, 34785849], [193, 34785850, 35159849], [194, 35159850, 35535849], [195, 35535850, 35913849], [196, 35913850, 36293849], [197, 36293850, 36675849], [198, 36675850, 37059849], [199, 37059850, 37445849], [200, 37445850, 37833849], [201, 37833850, 38223849], [202, 38223850, 38615849], [203, 38615850, 39009849], [204, 39009850, 39405849], [205, 39405850, 39803849], [206, 39803850, 40203849], [207, 40203850, 40605849], [208, 40605850, 41009849], [209, 41009850, 41415849], [210, 41415850, 41823849], [211, 41823850, 42233849], [212, 42233850, 42645849], [213, 42645850, 43059849], [214, 43059850, 43475849], [215, 43475850, 43893849], [216, 43893850, 44313849], [217, 44313850, 44735849], [218, 44735850, 45159849], [219, 45159850, 45585849], [220, 45585850, 46013849], [221, 46013850, 46443849], [222, 46443850, 46875849], [223, 46875850, 47309849], [224, 47309850, 47745849], [225, 47745850, 48183849], [226, 48183850, 48623849], [227, 48623850, 49065849], [228, 49065850, 49509849], [229, 49509850, 49955849], [230, 49955850, 50403849], [231, 50403850, 50853849], [232, 50853850, 51305849], [233, 51305850, 51759849], [234, 51759850, 52215849], [235, 52215850, 52673849], [236, 52673850, 53133849], [237, 53133850, 53595849], [238, 53595850, 54059849], [239, 54059850, 54525849], [240, 54525850, 55461849], [241, 55461850, 56401849], [242, 56401850, 57345849], [243, 57345850, 58293849], [244, 58293850, 59245849], [245, 59245850, 60201849], [246, 60201850, 61161849], [247, 61161850, 62125849], [248, 62125850, 63093849], [249, 63093850, 64065849], [250, 64065850, 65041849], [251, 65041850, 66021849], [252, 66021850, 67005849], [253, 67005850, 67993849], [254, 67993850, 68985849], [255, 68985850, 69981849], [256, 69981850, 70981849], [257, 70981850, 71985849], [258, 71985850, 72993849], [259, 72993850, 74005849], [260, 74005850, 75021849], [261, 75021850, 76041849], [262, 76041850, 77065849], [263, 77065850, 78093849], [264, 78093850, 79125849], [265, 79125850, 80161849], [266, 80161850, 81201849], [267, 81201850, 82245849], [268, 82245850, 83293849], [269, 83293850, 84345849], [270, 84345850, 85401849], [271, 85401850, 86461849], [272, 86461850, 87525849], [273, 87525850, 88593849], [274, 88593850, 89665849], [275, 89665850, 90741849], [276, 90741850, 91821849], [277, 91821850, 92905849], [278, 92905850, 93993849], [279, 93993850, 95085849], [280, 95085850, 96181849], [281, 96181850, 97281849], [282, 97281850, 98385849], [283, 98385850, 99493849], [284, 99493850, 100605849], [285, 100605850, 101721849], [286, 101721850, 102841849], [287, 102841850, 103965849], [288, 103965850, 105093849], [289, 105093850, 106225849], [290, 106225850, 107361849], [291, 107361850, 108501849], [292, 108501850, 109645849], [293, 109645850, 110793849], [294, 110793850, 111945849], [295, 111945850, 113101849], [296, 113101850, 114261849], [297, 114261850, 115425849], [298, 115425850, 116593849], [299, 116593850, 117765849], [300, 117765850, 118941849], [301, 118941850, 120121849], [302, 120121850, 121305849], [303, 121305850, 122493849], [304, 122493850, 123685849], [305, 123685850, 124881849], [306, 124881850, 126081849], [307, 126081850, 127285849], [308, 127285850, 128493849], [309, 128493850, 129705849], [310, 129705850, 130921849], [311, 130921850, 132141849], [312, 132141850, 133365849], [313, 133365850, 134593849], [314, 134593850, 135825849], [315, 135825850, 137061849], [316, 137061850, 138301849], [317, 138301850, 139545849], [318, 139545850, 140793849], [319, 140793850, 142045849], [320, 142045850, 143301849], [321, 143301850, 144561849], [322, 144561850, 145825849], [323, 145825850, 147093849], [324, 147093850, 148365849], [325, 148365850, 149641849], [326, 149641850, 150921849], [327, 150921850, 152205849], [328, 152205850, 153493849], [329, 153493850, 154785849], [330, 154785850, 157377849], [331, 157377850, 159977849], [332, 159977850, 162585849], [333, 162585850, 165201849], [334, 165201850, 167825849], [335, 167825850, 170457849], [336, 170457850, 173097849], [337, 173097850, 175745849], [338, 175745850, 178401849], [339, 178401850, 181065849], [340, 181065850, 183737849], [341, 183737850, 186417849], [342, 186417850, 189105849], [343, 189105850, 191801849], [344, 191801850, 194505849], [345, 194505850, 197217849], [346, 197217850, 199937849], [347, 199937850, 202665849], [348, 202665850, 205401849], [349, 205401850, 208145849], [350, 208145850, 211585849], [351, 211585850, 215035849], [352, 215035850, 218495849], [353, 218495850, 221965849], [354, 221965850, 225445849], [355, 225445850, 228935849], [356, 228935850, 232435849], [357, 232435850, 235945849], [358, 235945850, 239465849], [359, 239465850, 242995849], [360, 242995850, 246535849], [361, 246535850, 250085849], [362, 250085850, 253645849], [363, 253645850, 257215849], [364, 257215850, 260795849], [365, 260795850, 264385849], [366, 264385850, 267985849], [367, 267985850, 271595849], [368, 271595850, 275215849], [369, 275215850, 278845849], [370, 278845850, 283213849], [371, 283213850, 287593849], [372, 287593850, 291985849], [373, 291985850, 296389849], [374, 296389850, 300805849], [375, 300805850, 305233849], [376, 305233850, 309673849], [377, 309673850, 314125849], [378, 314125850, 318589849], [379, 318589850, 323065849], [380, 323065850, 327553849], [381, 327553850, 332053849], [382, 332053850, 336565849], [383, 336565850, 341089849], [384, 341089850, 345625849], [385, 345625850, 350173849], [386, 350173850, 354733849], [387, 354733850, 359305849], [388, 359305850, 363889849], [389, 363889850, 368485849], [390, 368485850, 373861849], [391, 373861850, 379251849], [392, 379251850, 384655849], [393, 384655850, 390073849], [394, 390073850, 395505849], [395, 395505850, 400951849], [396, 400951850, 406411849], [397, 406411850, 411885849], [398, 411885850, 417373849], [399, 417373850, 422875849], [400, 422875850, 428391849], [401, 428391850, 433921849], [402, 433921850, 439465849], [403, 439465850, 445023849], [404, 445023850, 450595849], [405, 450595850, 456181849], [406, 456181850, 461781849], [407, 461781850, 467395849], [408, 467395850, 473023849], [409, 473023850, 478665849], [410, 478665850, 485129849], [411, 485129850, 491609849], [412, 491609850, 498105849], [413, 498105850, 504617849], [414, 504617850, 511145849], [415, 511145850, 517689849], [416, 517689850, 524249849], [417, 524249850, 530825849], [418, 530825850, 537417849], [419, 537417850, 544025849], [420, 544025850, 550649849], [421, 550649850, 557289849], [422, 557289850, 563945849], [423, 563945850, 570617849], [424, 570617850, 577305849], [425, 577305850, 584009849], [426, 584009850, 590729849], [427, 590729850, 597465849], [428, 597465850, 604217849], [429, 604217850, 610985849], [430, 610985850, 618617849], [431, 618617850, 626267849], [432, 626267850, 633935849], [433, 633935850, 641621849], [434, 641621850, 649325849], [435, 649325850, 657047849], [436, 657047850, 664787849], [437, 664787850, 672545849], [438, 672545850, 680321849], [439, 680321850, 688115849], [440, 688115850, 695927849], [441, 695927850, 703757849], [442, 703757850, 711605849], [443, 711605850, 719471849], [444, 719471850, 727355849], [445, 727355850, 735257849], [446, 735257850, 743177849], [447, 743177850, 751115849], [448, 751115850, 759071849], [449, 759071850, 767045849], [450, 767045850, 775925849], [451, 775925850, 784825849], [452, 784825850, 793745849], [453, 793745850, 802685849], [454, 802685850, 811645849], [455, 811645850, 820625849], [456, 820625850, 829625849], [457, 829625850, 838645849], [458, 838645850, 847685849], [459, 847685850, 856745849], [460, 856745850, 865825849], [461, 865825850, 874925849], [462, 874925850, 884045849], [463, 884045850, 893185849], [464, 893185850, 902345849], [465, 902345850, 911525849], [466, 911525850, 920725849], [467, 920725850, 929945849], [468, 929945850, 939185849], [469, 939185850, 948445849], [470, 948445850, 958653849], [471, 958653850, 968883849], [472, 968883850, 979135849], [473, 979135850, 989409849], [474, 989409850, 999705849], [475, 999705850, 1010023849], [476, 1010023850, 1020363849], [477, 1020363850, 1030725849], [478, 1030725850, 1041109849], [479, 1041109850, 1051515849], [480, 1051515850, 1061943849], [481, 1061943850, 1072393849], [482, 1072393850, 1082865849], [483, 1082865850, 1093359849], [484, 1093359850, 1103875849], [485, 1103875850, 1114413849], [486, 1114413850, 1124973849], [487, 1124973850, 1135555849], [488, 1135555850, 1146159849], [489, 1146159850, 1156785849], [490, 1156785850, 1168401849], [491, 1168401850, 1180041849], [492, 1180041850, 1191705849], [493, 1191705850, 1203393849], [494, 1203393850, 1215105849], [495, 1215105850, 1226841849], [496, 1226841850, 1238601849], [497, 1238601850, 1250385849], [498, 1250385850, 1262193849], [499, 1262193850, 1274025849], [500, 1274025850, 1285881849], [501, 1285881850, 1297761849], [502, 1297761850, 1309665849], [503, 1309665850, 1321593849], [504, 1321593850, 1333545849], [505, 1333545850, 1345521849], [506, 1345521850, 1357521849], [507, 1357521850, 1369545849], [508, 1369545850, 1381593849], [509, 1381593850, 1393665849], [510, 1393665850, 1406769849], [511, 1406769850, 1419899849], [512, 1419899850, 1433055849], [513, 1433055850, 1446237849], [514, 1446237850, 1459445849], [515, 1459445850, 1472679849], [516, 1472679850, 1485939849], [517, 1485939850, 1499225849], [518, 1499225850, 1512537849], [519, 1512537850, 1525875849], [520, 1525875850, 1539239849], [521, 1539239850, 1552629849], [522, 1552629850, 1566045849], [523, 1566045850, 1579487849], [524, 1579487850, 1592955849], [525, 1592955850, 1606449849], [526, 1606449850, 1619969849], [527, 1619969850, 1633515849], [528, 1633515850, 1647087849], [529, 1647087850, 1660685849], [530, 1660685850, 1675357849], [531, 1675357850, 1690057849], [532, 1690057850, 1704785849], [533, 1704785850, 1719541849], [534, 1719541850, 1734325849], [535, 1734325850, 1749137849], [536, 1749137850, 1763977849], [537, 1763977850, 1778845849], [538, 1778845850, 1793741849], [539, 1793741850, 1808665849], [540, 1808665850, 1823617849], [541, 1823617850, 1838597849], [542, 1838597850, 1853605849], [543, 1853605850, 1868641849], [544, 1868641850, 1883705849], [545, 1883705850, 1898797849], [546, 1898797850, 1913917849], [547, 1913917850, 1929065849], [548, 1929065850, 1944241849], [549, 1944241850, 1959445849], [550, 1959445850, 1975765849], [551, 1975765850, 1992115849], [552, 1992115850, 2008495849], [553, 2008495850, 2024905849], [554, 2024905850, 2041345849], [555, 2041345850, 2057815849], [556, 2057815850, 2074315849], [557, 2074315850, 2090845849], [558, 2090845850, 2107405849]],
window.COUNTRIES_ARRAY = [{
    id: 19,
    title: "Австралия"
}, {
    id: 20,
    title: "Австрия"
}, {
    id: 5,
    title: "Азербайджан"
}, {
    id: 21,
    title: "Албания"
}, {
    id: 22,
    title: "Алжир"
}, {
    id: 23,
    title: "Американское Самоа"
}, {
    id: 24,
    title: "Ангилья"
}, {
    id: 25,
    title: "Ангола"
}, {
    id: 26,
    title: "Андорра"
}, {
    id: 27,
    title: "Антигуа и Барбуда"
}, {
    id: 28,
    title: "Аргентина"
}, {
    id: 6,
    title: "Армения"
}, {
    id: 29,
    title: "Аруба"
}, {
    id: 30,
    title: "Афганистан"
}, {
    id: 31,
    title: "Багамы"
}, {
    id: 32,
    title: "Бангладеш"
}, {
    id: 33,
    title: "Барбадос"
}, {
    id: 34,
    title: "Бахрейн"
}, {
    id: 3,
    title: "Беларусь"
}, {
    id: 35,
    title: "Белиз"
}, {
    id: 36,
    title: "Бельгия"
}, {
    id: 37,
    title: "Бенин"
}, {
    id: 38,
    title: "Бермуды"
}, {
    id: 39,
    title: "Болгария"
}, {
    id: 40,
    title: "Боливия"
}, {
    id: 235,
    title: "Бонайре, Синт-Эстатиус и Саба"
}, {
    id: 41,
    title: "Босния и Герцеговина"
}, {
    id: 42,
    title: "Ботсвана"
}, {
    id: 43,
    title: "Бразилия"
}, {
    id: 44,
    title: "Бруней-Даруссалам"
}, {
    id: 45,
    title: "Буркина-Фасо"
}, {
    id: 46,
    title: "Бурунди"
}, {
    id: 47,
    title: "Бутан"
}, {
    id: 48,
    title: "Вануату"
}, {
    id: 233,
    title: "Ватикан"
}, {
    id: 49,
    title: "Великобритания"
}, {
    id: 50,
    title: "Венгрия"
}, {
    id: 51,
    title: "Венесуэла"
}, {
    id: 52,
    title: "Виргинские острова, Британские"
}, {
    id: 53,
    title: "Виргинские острова, США"
}, {
    id: 54,
    title: "Восточный Тимор"
}, {
    id: 55,
    title: "Вьетнам"
}, {
    id: 56,
    title: "Габон"
}, {
    id: 57,
    title: "Гаити"
}, {
    id: 58,
    title: "Гайана"
}, {
    id: 59,
    title: "Гамбия"
}, {
    id: 60,
    title: "Гана"
}, {
    id: 61,
    title: "Гваделупа"
}, {
    id: 62,
    title: "Гватемала"
}, {
    id: 63,
    title: "Гвинея"
}, {
    id: 64,
    title: "Гвинея-Бисау"
}, {
    id: 65,
    title: "Германия"
}, {
    id: 236,
    title: "Гернси"
}, {
    id: 66,
    title: "Гибралтар"
}, {
    id: 67,
    title: "Гондурас"
}, {
    id: 68,
    title: "Гонконг"
}, {
    id: 69,
    title: "Гренада"
}, {
    id: 70,
    title: "Гренландия"
}, {
    id: 71,
    title: "Греция"
}, {
    id: 7,
    title: "Грузия"
}, {
    id: 72,
    title: "Гуам"
}, {
    id: 73,
    title: "Дания"
}, {
    id: 237,
    title: "Джерси"
}, {
    id: 231,
    title: "Джибути"
}, {
    id: 74,
    title: "Доминика"
}, {
    id: 75,
    title: "Доминиканская Республика"
}, {
    id: 76,
    title: "Египет"
}, {
    id: 77,
    title: "Замбия"
}, {
    id: 78,
    title: "Западная Сахара"
}, {
    id: 79,
    title: "Зимбабве"
}, {
    id: 8,
    title: "Израиль"
}, {
    id: 80,
    title: "Индия"
}, {
    id: 81,
    title: "Индонезия"
}, {
    id: 82,
    title: "Иордания"
}, {
    id: 83,
    title: "Ирак"
}, {
    id: 84,
    title: "Иран"
}, {
    id: 85,
    title: "Ирландия"
}, {
    id: 86,
    title: "Исландия"
}, {
    id: 87,
    title: "Испания"
}, {
    id: 88,
    title: "Италия"
}, {
    id: 89,
    title: "Йемен"
}, {
    id: 90,
    title: "Кабо-Верде"
}, {
    id: 4,
    title: "Казахстан"
}, {
    id: 91,
    title: "Камбоджа"
}, {
    id: 92,
    title: "Камерун"
}, {
    id: 10,
    title: "Канада"
}, {
    id: 93,
    title: "Катар"
}, {
    id: 94,
    title: "Кения"
}, {
    id: 95,
    title: "Кипр"
}, {
    id: 96,
    title: "Кирибати"
}, {
    id: 97,
    title: "Китай"
}, {
    id: 98,
    title: "Колумбия"
}, {
    id: 99,
    title: "Коморы"
}, {
    id: 100,
    title: "Конго"
}, {
    id: 101,
    title: "Конго, демократическая республика"
}, {
    id: 102,
    title: "Коста-Рика"
}, {
    id: 103,
    title: "Кот д`Ивуар"
}, {
    id: 104,
    title: "Куба"
}, {
    id: 105,
    title: "Кувейт"
}, {
    id: 11,
    title: "Кыргызстан"
}, {
    id: 138,
    title: "Кюрасао"
}, {
    id: 106,
    title: "Лаос"
}, {
    id: 12,
    title: "Латвия"
}, {
    id: 107,
    title: "Лесото"
}, {
    id: 108,
    title: "Либерия"
}, {
    id: 109,
    title: "Ливан"
}, {
    id: 110,
    title: "Ливия"
}, {
    id: 13,
    title: "Литва"
}, {
    id: 111,
    title: "Лихтенштейн"
}, {
    id: 112,
    title: "Люксембург"
}, {
    id: 113,
    title: "Маврикий"
}, {
    id: 114,
    title: "Мавритания"
}, {
    id: 115,
    title: "Мадагаскар"
}, {
    id: 116,
    title: "Макао"
}, {
    id: 117,
    title: "Македония"
}, {
    id: 118,
    title: "Малави"
}, {
    id: 119,
    title: "Малайзия"
}, {
    id: 120,
    title: "Мали"
}, {
    id: 121,
    title: "Мальдивы"
}, {
    id: 122,
    title: "Мальта"
}, {
    id: 123,
    title: "Марокко"
}, {
    id: 124,
    title: "Мартиника"
}, {
    id: 125,
    title: "Маршалловы Острова"
}, {
    id: 126,
    title: "Мексика"
}, {
    id: 127,
    title: "Микронезия, федеративные штаты"
}, {
    id: 128,
    title: "Мозамбик"
}, {
    id: 15,
    title: "Молдова"
}, {
    id: 129,
    title: "Монако"
}, {
    id: 130,
    title: "Монголия"
}, {
    id: 131,
    title: "Монтсеррат"
}, {
    id: 132,
    title: "Мьянма"
}, {
    id: 133,
    title: "Намибия"
}, {
    id: 134,
    title: "Науру"
}, {
    id: 135,
    title: "Непал"
}, {
    id: 136,
    title: "Нигер"
}, {
    id: 137,
    title: "Нигерия"
}, {
    id: 139,
    title: "Нидерланды"
}, {
    id: 140,
    title: "Никарагуа"
}, {
    id: 141,
    title: "Ниуэ"
}, {
    id: 142,
    title: "Новая Зеландия"
}, {
    id: 143,
    title: "Новая Каледония"
}, {
    id: 144,
    title: "Норвегия"
}, {
    id: 145,
    title: "Объединенные Арабские Эмираты"
}, {
    id: 146,
    title: "Оман"
}, {
    id: 147,
    title: "Остров Мэн"
}, {
    id: 148,
    title: "Остров Норфолк"
}, {
    id: 149,
    title: "Острова Кайман"
}, {
    id: 150,
    title: "Острова Кука"
}, {
    id: 151,
    title: "Острова Теркс и Кайкос"
}, {
    id: 152,
    title: "Пакистан"
}, {
    id: 153,
    title: "Палау"
}, {
    id: 154,
    title: "Палестинская автономия"
}, {
    id: 155,
    title: "Панама"
}, {
    id: 156,
    title: "Папуа - Новая Гвинея"
}, {
    id: 157,
    title: "Парагвай"
}, {
    id: 158,
    title: "Перу"
}, {
    id: 159,
    title: "Питкерн"
}, {
    id: 160,
    title: "Польша"
}, {
    id: 161,
    title: "Португалия"
}, {
    id: 162,
    title: "Пуэрто-Рико"
}, {
    id: 163,
    title: "Реюньон"
}, {
    id: 1,
    title: "Россия"
}, {
    id: 164,
    title: "Руанда"
}, {
    id: 165,
    title: "Румыния"
}, {
    id: 9,
    title: "США"
}, {
    id: 166,
    title: "Сальвадор"
}, {
    id: 167,
    title: "Самоа"
}, {
    id: 168,
    title: "Сан-Марино"
}, {
    id: 169,
    title: "Сан-Томе и Принсипи"
}, {
    id: 170,
    title: "Саудовская Аравия"
}, {
    id: 171,
    title: "Свазиленд"
}, {
    id: 172,
    title: "Святая Елена"
}, {
    id: 173,
    title: "Северная Корея"
}, {
    id: 174,
    title: "Северные Марианские острова"
}, {
    id: 175,
    title: "Сейшелы"
}, {
    id: 176,
    title: "Сенегал"
}, {
    id: 177,
    title: "Сент-Винсент"
}, {
    id: 178,
    title: "Сент-Китс и Невис"
}, {
    id: 179,
    title: "Сент-Люсия"
}, {
    id: 180,
    title: "Сент-Пьер и Микелон"
}, {
    id: 181,
    title: "Сербия"
}, {
    id: 182,
    title: "Сингапур"
}, {
    id: 234,
    title: "Синт-Мартен"
}, {
    id: 183,
    title: "Сирийская Арабская Республика"
}, {
    id: 184,
    title: "Словакия"
}, {
    id: 185,
    title: "Словения"
}, {
    id: 186,
    title: "Соломоновы Острова"
}, {
    id: 187,
    title: "Сомали"
}, {
    id: 188,
    title: "Судан"
}, {
    id: 189,
    title: "Суринам"
}, {
    id: 190,
    title: "Сьерра-Леоне"
}, {
    id: 16,
    title: "Таджикистан"
}, {
    id: 191,
    title: "Таиланд"
}, {
    id: 192,
    title: "Тайвань"
}, {
    id: 193,
    title: "Танзания"
}, {
    id: 194,
    title: "Того"
}, {
    id: 195,
    title: "Токелау"
}, {
    id: 196,
    title: "Тонга"
}, {
    id: 197,
    title: "Тринидад и Тобаго"
}, {
    id: 198,
    title: "Тувалу"
}, {
    id: 199,
    title: "Тунис"
}, {
    id: 17,
    title: "Туркменистан"
}, {
    id: 200,
    title: "Турция"
}, {
    id: 201,
    title: "Уганда"
}, {
    id: 18,
    title: "Узбекистан"
}, {
    id: 2,
    title: "Украина"
}, {
    id: 202,
    title: "Уоллис и Футуна"
}, {
    id: 203,
    title: "Уругвай"
}, {
    id: 204,
    title: "Фарерские острова"
}, {
    id: 205,
    title: "Фиджи"
}, {
    id: 206,
    title: "Филиппины"
}, {
    id: 207,
    title: "Финляндия"
}, {
    id: 208,
    title: "Фолклендские острова"
}, {
    id: 209,
    title: "Франция"
}, {
    id: 210,
    title: "Французская Гвиана"
}, {
    id: 211,
    title: "Французская Полинезия"
}, {
    id: 212,
    title: "Хорватия"
}, {
    id: 213,
    title: "Центрально-Африканская Республика"
}, {
    id: 214,
    title: "Чад"
}, {
    id: 230,
    title: "Черногория"
}, {
    id: 215,
    title: "Чехия"
}, {
    id: 216,
    title: "Чили"
}, {
    id: 217,
    title: "Швейцария"
}, {
    id: 218,
    title: "Швеция"
}, {
    id: 219,
    title: "Шпицберген и Ян Майен"
}, {
    id: 220,
    title: "Шри-Ланка"
}, {
    id: 221,
    title: "Эквадор"
}, {
    id: 222,
    title: "Экваториальная Гвинея"
}, {
    id: 223,
    title: "Эритрея"
}, {
    id: 14,
    title: "Эстония"
}, {
    id: 224,
    title: "Эфиопия"
}, {
    id: 226,
    title: "Южная Корея"
}, {
    id: 227,
    title: "Южно-Африканская Республика"
}, {
    id: 232,
    title: "Южный Судан"
}, {
    id: 228,
    title: "Ямайка"
}, {
    id: 229,
    title: "Япония"
}],
window.REGIONS = {},
window.REGIONS[1] = [{
    id: 1000001,
    title: "Адыгея"
}, {
    id: 1121540,
    title: "Алтай"
}, {
    id: 1121829,
    title: "Алтайский край"
}, {
    id: 1123488,
    title: "Амурская область"
}, {
    id: 1000236,
    title: "Архангельская область"
}, {
    id: 1004118,
    title: "Астраханская область"
}, {
    id: 1004565,
    title: "Башкортостан"
}, {
    id: 1009404,
    title: "Белгородская область"
}, {
    id: 1011109,
    title: "Брянская область"
}, {
    id: 1124157,
    title: "Бурятия"
}, {
    id: 1124833,
    title: "Владимирская область"
}, {
    id: 1014032,
    title: "Волгоградская область"
}, {
    id: 1015702,
    title: "Вологодская область"
}, {
    id: 1023816,
    title: "Воронежская область"
}, {
    id: 1025654,
    title: "Дагестан"
}, {
    id: 1127400,
    title: "Еврейская АОбл"
}, {
    id: 1159987,
    title: "Забайкальский край"
}, {
    id: 1027297,
    title: "Ивановская область"
}, {
    id: 1030371,
    title: "Ингушетия"
}, {
    id: 1127513,
    title: "Иркутская область"
}, {
    id: 1030428,
    title: "Кабардино-Балкарская"
}, {
    id: 1030632,
    title: "Калининградская область"
}, {
    id: 1031793,
    title: "Калмыкия"
}, {
    id: 1032084,
    title: "Калужская область"
}, {
    id: 1128991,
    title: "Камчатский край"
}, {
    id: 1035359,
    title: "Карачаево-Черкесская"
}, {
    id: 1035522,
    title: "Карелия"
}, {
    id: 1129059,
    title: "Кемеровская область"
}, {
    id: 1130218,
    title: "Кировская область"
}, {
    id: 1036606,
    title: "Коми"
}, {
    id: 1134737,
    title: "Корякский АО"
}, {
    id: 1037344,
    title: "Костромская область"
}, {
    id: 1040652,
    title: "Краснодарский край"
}, {
    id: 1134771,
    title: "Красноярский край"
}, {
    id: 1137144,
    title: "Курганская область"
}, {
    id: 1042388,
    title: "Курская область"
}, {
    id: 1045244,
    title: "Ленинградская область"
}, {
    id: 1048584,
    title: "Липецкая область"
}, {
    id: 1138434,
    title: "Магаданская область"
}, {
    id: 1050307,
    title: "Марий Эл"
}, {
    id: 1052052,
    title: "Мордовия"
}, {
    id: 1053480,
    title: "Московская область"
}, {
    id: 1060316,
    title: "Мурманская область"
}, {
    id: 5331184,
    title: "Ненецкий АО"
}, {
    id: 1138534,
    title: "Нижегородская область"
}, {
    id: 1060458,
    title: "Новгородская область"
}, {
    id: 1143518,
    title: "Новосибирская область"
}, {
    id: 1145150,
    title: "Омская область"
}, {
    id: 1146712,
    title: "Оренбургская область"
}, {
    id: 1064424,
    title: "Орловская область"
}, {
    id: 1067455,
    title: "Пензенская область"
}, {
    id: 1148549,
    title: "Пермский край"
}, {
    id: 1152714,
    title: "Приморский край"
}, {
    id: 1069004,
    title: "Псковская область"
}, {
    id: 1077676,
    title: "Ростовская область"
}, {
    id: 1080077,
    title: "Рязанская область"
}, {
    id: 1500001,
    title: "Республика Крым"
}, {
    id: 1082931,
    title: "Самарская область"
}, {
    id: 1084332,
    title: "Саратовская область"
}, {
    id: 1153366,
    title: "Саха /Якутия/"
}, {
    id: 1153840,
    title: "Сахалинская область"
}, {
    id: 1154131,
    title: "Свердловская область"
}, {
    id: 1086244,
    title: "Северная Осетия - Алания"
}, {
    id: 1086468,
    title: "Смоленская область"
}, {
    id: 1091406,
    title: "Ставропольский край"
}, {
    id: 1156333,
    title: "Таймырский (Долгано-Ненецкий) АО"
}, {
    id: 1092174,
    title: "Тамбовская область"
}, {
    id: 1094197,
    title: "Татарстан"
}, {
    id: 1097508,
    title: "Тверская область"
}, {
    id: 1156388,
    title: "Томская область"
}, {
    id: 1105465,
    title: "Тульская область"
}, {
    id: 1157049,
    title: "Тыва"
}, {
    id: 1157218,
    title: "Тюменская область"
}, {
    id: 1109098,
    title: "Удмуртская"
}, {
    id: 1111137,
    title: "Ульяновская область"
}, {
    id: 1158917,
    title: "Хабаровский край"
}, {
    id: 1159424,
    title: "Хакасия"
}, {
    id: 1159710,
    title: "Ханты-Мансийский Автономный округ - Югра АО"
}, {
    id: 1112201,
    title: "Челябинская область"
}, {
    id: 1113642,
    title: "Чеченская"
}, {
    id: 1113937,
    title: "Чувашская"
}, {
    id: 1160844,
    title: "Чукотский АО"
}, {
    id: 1160930,
    title: "Ямало-Ненецкий  АО"
}, {
    id: 1115658,
    title: "Ярославская область"
}],
REGIONS[2] = [{
    id: 1500595,
    title: "Винницкая область"
}, {
    id: 1501549,
    title: "Волынская область"
}, {
    id: 1502117,
    title: "Днепропетровская область"
}, {
    id: 1502709,
    title: "Донецкая область"
}, {
    id: 1503296,
    title: "Житомирская область"
}, {
    id: 1504102,
    title: "Закарпатская область"
}, {
    id: 1504503,
    title: "Запорожская область"
}, {
    id: 1504975,
    title: "Ивано-Франковская область"
}, {
    id: 1505578,
    title: "Киевская область"
}, {
    id: 1506310,
    title: "Кировоградская область"
}, {
    id: 1506831,
    title: "Луганская область"
}, {
    id: 1507378,
    title: "Львовская область"
}, {
    id: 1508347,
    title: "Николаевская область"
}, {
    id: 1508808,
    title: "Одесская область"
}, {
    id: 1509477,
    title: "Полтавская область"
}, {
    id: 1510213,
    title: "Ровненская область"
}, {
    id: 1510799,
    title: "Сумская область"
}, {
    id: 1511345,
    title: "Тернопольская область"
}, {
    id: 1512004,
    title: "Харьковская область"
}, {
    id: 1512710,
    title: "Херсонская область"
}, {
    id: 1513133,
    title: "Хмельницкая область"
}, {
    id: 1513930,
    title: "Черкасская область"
}, {
    id: 1514896,
    title: "Черниговская область"
}, {
    id: 1514541,
    title: "Черновицкая область"
}],
REGIONS[3] = [{
    id: 1600001,
    title: "Брестская область"
}, {
    id: 1600563,
    title: "Витебская область"
}, {
    id: 1601201,
    title: "Гомельская область"
}, {
    id: 1601806,
    title: "Гродненская область"
}, {
    id: 1602269,
    title: "Минская область"
}, {
    id: 1602923,
    title: "Могилевская область"
}],
REGIONS[4] = [{
    id: 1700002,
    title: "Акмолинская область"
}, {
    id: 1700309,
    title: "Актюбинская область"
}, {
    id: 1700503,
    title: "Алма-Атинская область"
}, {
    id: 1700945,
    title: "Атырауская область"
}, {
    id: 1701029,
    title: "Восточно-Казахстанская область"
}, {
    id: 1701315,
    title: "Жамбылская  область"
}, {
    id: 1701514,
    title: "Западно-Казахстанская область"
}, {
    id: 1701716,
    title: "Карагандинская область"
}, {
    id: 1701955,
    title: "Кустанайская область"
}, {
    id: 1702235,
    title: "Кызылординская область"
}, {
    id: 1702346,
    title: "Мангистауская область"
}, {
    id: 1702392,
    title: "Павлодарская область"
}, {
    id: 1702577,
    title: "Северо-Казахстанская область"
}, {
    id: 1702873,
    title: "Южно-Казахстанская область"
}],
function() {
    var NOW = moment(new Date)
      , _cache = {}
      , counter = +NOW;
    function getLocalStorageNameSpace() {
        return app.info.viewer_id + "."
    }
    var __fingerprint = null, _serverUtc = NOW, _millisOfSetupServerUtc, DELIMITER_ID_OF_ODNOKLASSNIKI_UID = 1e12, yqa, Aqa, Rla, Sla, Jla, Kla, Kia, Lia, Hga, Bga, mga, nga, oga;
    function zqa(e) {
        return "<b>" + e + "</b>"
    }
    function hqa(e) {
        return util.adjustNumberToTwoDigitsStr(e)
    }
    function Tla(e) {
        return String(e).replace(/[&<>"'\/]/g, function(e) {
            return Rla[e]
        })
    }
    function bja(e, t) {
        var i = (65535 & e) + (65535 & t);
        return (e >> 16) + (t >> 16) + (i >> 16) << 16 | 65535 & i
    }
    function dja(e, t, i, n, o, a) {
        return bja((a = bja(bja(t, e), bja(n, a))) << (o = o) | a >>> 32 - o, i)
    }
    function eja(e, t, i, n, o, a, s) {
        return dja(t & i | ~t & n, e, t, o, a, s)
    }
    function fja(e, t, i, n, o, a, s) {
        return dja(t & n | i & ~n, e, t, o, a, s)
    }
    function gja(e, t, i, n, o, a, s) {
        return dja(t ^ i ^ n, e, t, o, a, s)
    }
    function hja(e, t, i, n, o, a, s) {
        return dja(i ^ (t | ~n), e, t, o, a, s)
    }
    function ija(e, t) {
        var i, n, o, a;
        e[t >> 5] |= 128 << t % 32,
        e[14 + (t + 64 >>> 9 << 4)] = t;
        for (var s = 1732584193, r = -271733879, l = -1732584194, d = 271733878, c = 0; c < e.length; c += 16)
            s = eja(i = s, n = r, o = l, a = d, e[c], 7, -680876936),
            d = eja(d, s, r, l, e[c + 1], 12, -389564586),
            l = eja(l, d, s, r, e[c + 2], 17, 606105819),
            r = eja(r, l, d, s, e[c + 3], 22, -1044525330),
            s = eja(s, r, l, d, e[c + 4], 7, -176418897),
            d = eja(d, s, r, l, e[c + 5], 12, 1200080426),
            l = eja(l, d, s, r, e[c + 6], 17, -1473231341),
            r = eja(r, l, d, s, e[c + 7], 22, -45705983),
            s = eja(s, r, l, d, e[c + 8], 7, 1770035416),
            d = eja(d, s, r, l, e[c + 9], 12, -1958414417),
            l = eja(l, d, s, r, e[c + 10], 17, -42063),
            r = eja(r, l, d, s, e[c + 11], 22, -1990404162),
            s = eja(s, r, l, d, e[c + 12], 7, 1804603682),
            d = eja(d, s, r, l, e[c + 13], 12, -40341101),
            l = eja(l, d, s, r, e[c + 14], 17, -1502002290),
            s = fja(s, r = eja(r, l, d, s, e[c + 15], 22, 1236535329), l, d, e[c + 1], 5, -165796510),
            d = fja(d, s, r, l, e[c + 6], 9, -1069501632),
            l = fja(l, d, s, r, e[c + 11], 14, 643717713),
            r = fja(r, l, d, s, e[c], 20, -373897302),
            s = fja(s, r, l, d, e[c + 5], 5, -701558691),
            d = fja(d, s, r, l, e[c + 10], 9, 38016083),
            l = fja(l, d, s, r, e[c + 15], 14, -660478335),
            r = fja(r, l, d, s, e[c + 4], 20, -405537848),
            s = fja(s, r, l, d, e[c + 9], 5, 568446438),
            d = fja(d, s, r, l, e[c + 14], 9, -1019803690),
            l = fja(l, d, s, r, e[c + 3], 14, -187363961),
            r = fja(r, l, d, s, e[c + 8], 20, 1163531501),
            s = fja(s, r, l, d, e[c + 13], 5, -1444681467),
            d = fja(d, s, r, l, e[c + 2], 9, -51403784),
            l = fja(l, d, s, r, e[c + 7], 14, 1735328473),
            s = gja(s, r = fja(r, l, d, s, e[c + 12], 20, -1926607734), l, d, e[c + 5], 4, -378558),
            d = gja(d, s, r, l, e[c + 8], 11, -2022574463),
            l = gja(l, d, s, r, e[c + 11], 16, 1839030562),
            r = gja(r, l, d, s, e[c + 14], 23, -35309556),
            s = gja(s, r, l, d, e[c + 1], 4, -1530992060),
            d = gja(d, s, r, l, e[c + 4], 11, 1272893353),
            l = gja(l, d, s, r, e[c + 7], 16, -155497632),
            r = gja(r, l, d, s, e[c + 10], 23, -1094730640),
            s = gja(s, r, l, d, e[c + 13], 4, 681279174),
            d = gja(d, s, r, l, e[c], 11, -358537222),
            l = gja(l, d, s, r, e[c + 3], 16, -722521979),
            r = gja(r, l, d, s, e[c + 6], 23, 76029189),
            s = gja(s, r, l, d, e[c + 9], 4, -640364487),
            d = gja(d, s, r, l, e[c + 12], 11, -421815835),
            l = gja(l, d, s, r, e[c + 15], 16, 530742520),
            s = hja(s, r = gja(r, l, d, s, e[c + 2], 23, -995338651), l, d, e[c], 6, -198630844),
            d = hja(d, s, r, l, e[c + 7], 10, 1126891415),
            l = hja(l, d, s, r, e[c + 14], 15, -1416354905),
            r = hja(r, l, d, s, e[c + 5], 21, -57434055),
            s = hja(s, r, l, d, e[c + 12], 6, 1700485571),
            d = hja(d, s, r, l, e[c + 3], 10, -1894986606),
            l = hja(l, d, s, r, e[c + 10], 15, -1051523),
            r = hja(r, l, d, s, e[c + 1], 21, -2054922799),
            s = hja(s, r, l, d, e[c + 8], 6, 1873313359),
            d = hja(d, s, r, l, e[c + 15], 10, -30611744),
            l = hja(l, d, s, r, e[c + 6], 15, -1560198380),
            r = hja(r, l, d, s, e[c + 13], 21, 1309151649),
            s = hja(s, r, l, d, e[c + 4], 6, -145523070),
            d = hja(d, s, r, l, e[c + 11], 10, -1120210379),
            l = hja(l, d, s, r, e[c + 2], 15, 718787259),
            r = hja(r, l, d, s, e[c + 9], 21, -343485551),
            s = bja(s, i),
            r = bja(r, n),
            l = bja(l, o),
            d = bja(d, a);
        return [s, r, l, d]
    }
    function jja(e) {
        for (var t = "", i = 32 * e.length, n = 0; n < i; n += 8)
            t += String.fromCharCode(e[n >> 5] >>> n % 32 & 255);
        return t
    }
    function kja(e) {
        var t = [];
        for (t[(e.length >> 2) - 1] = void 0,
        n = 0; n < t.length; n += 1)
            t[n] = 0;
        for (var i = 8 * e.length, n = 0; n < i; n += 8)
            t[n >> 5] |= (255 & e.charCodeAt(n / 8)) << n % 32;
        return t
    }
    function nja(e) {
        for (var t, i = "0123456789abcdef", n = "", o = 0; o < e.length; o += 1)
            t = e.charCodeAt(o),
            n += i.charAt(t >>> 4 & 15) + i.charAt(15 & t);
        return n
    }
    function oja(e) {
        return unescape(encodeURIComponent(e))
    }
    function pja(e) {
        return jja(ija(kja(e = oja(e)), 8 * e.length))
    }
    function rja(e, t) {
        return function(e, t) {
            var i, n = kja(e), o = [], a = [];
            for (o[15] = a[15] = void 0,
            16 < n.length && (n = ija(n, 8 * e.length)),
            i = 0; i < 16; i += 1)
                o[i] = 909522486 ^ n[i],
                a[i] = 1549556828 ^ n[i];
            return t = ija(o.concat(kja(t)), 512 + 8 * t.length),
            jja(ija(a.concat(t), 640))
        }(oja(e), oja(t))
    }
    function Mia(e, t, i, n) {
        this.key = e,
        this.created = (new Date).getTime(),
        this.ttl = i,
        n.serializeObject && ($.isArray(t) || $.isPlainObject(t)) ? (this.value = JSON.stringify(t),
        this.isSerialized = !0) : (this.value = t,
        this.isSerialized = !1)
    }
    function nha(e) {
        var t, i;
        IS_IOS ? ((t = document.createRange()).selectNodeContents(e),
        (i = window.getSelection()).removeAllRanges(),
        i.addRange(t),
        e.setSelectionRange(0, 999999)) : e.select()
    }
    function Kga(e, t, i, n, o, a) {
        var s, r, l, d = $.trim(e);
        return d.startWith("http://") || (d = "http://" + d),
        "vk.com" === (d = new URI(d)).host() ? " " + (r = e,
        l = ((s = d).hash() || "").substr(1),
        (s = parseInt(l, 10)) + "" === l ? "#" + s : r) + " " : "ok.ru" === d.host() || "www.ok.ru" === d.host() ? " " + (s = e,
        d = (r = d).query() || "",
        (r = parseInt(d, 10)) + "" === d ? "#" + r : s) + " " : e
    }
    function Cga(e) {
        var t = e.substr(1)
          , i = parseInt(t, 10);
        return i + "" === t ? "<span class='open-app-profile' app-profile-id='" + i + "'>" + e + "</span>" : e
    }
    window.util = app.services.util = {
        isAllowableCharForName: (mga = /^[a-zA-Z]*$/,
        nga = /^[а-яА-Я]*$/,
        oga = ["I", "Є", "i", "є"],
        function(e) {
            return mga.test(e) || nga.test(e) || -1 !== oga.indexOf(e)
        }
        ),
        formatNumber: function(e) {
            var i = (e + "").split("").reverse().chunks(3)
              , n = "";
            return i.each(function(e, t) {
                n = (e < i.length - 1 ? "." : "") + t.reverse().join("") + n
            }),
            n
        },
        throttle: function(t, i) {
            var n;
            return function(e) {
                clearTimeout(n),
                e ? t() : n = setTimeout(t, i)
            }
        },
        findAndCreateAppLinksInText: (Bga = /#[0-9]+/g,
        function(e) {
            return e ? e.replace(Bga, Cga) : ""
        }
        ),
        replaceAppProfileLinks: (Hga = new RegExp(["(", '\\s|[^a-zA-Z0-9.\\+_\\/"\\>\\-]|^', ")(?:", "(", "[a-zA-Z0-9\\+_\\-]+", "(?:", "\\.[a-zA-Z0-9\\+_\\-]+", ")*@", ")?(", "http:\\/\\/|https:\\/\\/|ftp:\\/\\/", ")?(", "(?:(?:[a-z0-9][a-z0-9_%\\-_+]*\\.)+)", ")(", "(?:com|ca|co|edu|gov|net|org|dev|biz|cat|int|pro|tel|mil|aero|asia|coop|info|jobs|mobi|museum|name|post|travel|local|[a-z]{2})", ")(", "(?::\\d{1,5})", ")?(", "(?:", "[\\/|\\?]", "(?:", "[\\-a-zA-Z0-9_%#*&+=~!?,;:.\\/]*", ")*", ")", "[\\-\\/a-zA-Z0-9_%#*&+=~]", "|", "\\/?", ")?", ")(", '[^a-zA-Z0-9\\+_\\/"\\<\\-]|$', ")"].join(""),"g"),
        function(e) {
            return e ? e.replace(Hga, Kga) : ""
        }
        ),
        radioText: function(e, t) {
            return window.radioModel && radioModel.type === RadioPlayerType.YOUTUBE ? t : e
        },
        getYTIdFromLink: function(e) {
            var t, e = $.trim(e), i = new URI(e);
            switch (i.domain()) {
            case "youtu.be":
                var n = i.segment(0);
                n && n.length && (t = n);
                break;
            case "youtube.com":
                n = i.search().substr(1),
                n = util.queryParamsToObject(n).v;
                n && n.length && (t = n)
            }
            return t
        },
        serializeAudioTrack: function(e) {
            e = e.youtube ? {
                type: RadioPlayerType.YOUTUBE,
                ytId: e.ytId || e.id
            } : {
                type: RadioPlayerType.VK_AUDIO,
                artist: e.artist,
                title: e.title,
                audioId: e.id,
                audioOwnerId: e.owner_id,
                duration: e.duration
            };
            return JSON.stringify(e)
        },
        copyToClipboard: function(e, t, i) {
            t = t || $.noop,
            i = i || $.noop;
            var n = document.createElement("textarea")
              , o = n.style;
            o.position = "absolute",
            o.opacity = "0",
            o.pointerEvents = "none",
            n.value = e || "",
            document.body.appendChild(n);
            try {
                nha(n),
                document.execCommand("copy"),
                t()
            } catch (e) {
                i()
            } finally {
                n.parentNode && n.parentNode.removeChild(n)
            }
        },
        buildAuthParams: function() {
            return util.isOKPlatform() ? isMobi ? {
                client_type: 6,
                session_secret_key: app.info.session_secret_key,
                access_token: app.info.access_token,
                logged_user_id: app.info.logged_user_id,
                viewer_id: app.info.viewer_id
            } : {
                client_type: 2,
                session_key: app.info.ok_session_key,
                auth_sig: app.info.ok_auth_sig,
                logged_user_id: app.info.logged_user_id,
                viewer_id: app.info.viewer_id
            } : isMobi && !isDirect ? $.extend({
                viewer_id: app.info.viewer_id,
                client_type: 3
            }, app.info.session) : {
                viewer_id: app.info.viewer_id,
                client_type: isDirect ? 5 : 1,
                auth_key: app.info.auth_key,
                api_id: app.info.api_id
            }
        },
        isGiftAllowed: function(e, t, i) {
            var n;
            return 2 === e && 2 === t ? n = 1 : 2 === e && 1 === t ? n = 2 : 1 === e && 2 === t ? n = 3 : 1 === e && 1 === t && (n = 4),
            -1 !== i.indexOf(n)
        },
        removeFromArray: function(e, t) {
            t = e.indexOf(t);
            0 <= t && e.splice(t, 1)
        },
        convertNativeOkUIdToAppOkUid: function(e) {
            return DELIMITER_ID_OF_ODNOKLASSNIKI_UID + e
        },
        convertAppOkUIdToNativeOkUid: function(e) {
            return e - DELIMITER_ID_OF_ODNOKLASSNIKI_UID
        },
        isOKAppUid: function(e) {
            return DELIMITER_ID_OF_ODNOKLASSNIKI_UID < e
        },
        fixVkUrl: function(e) {
            return e && e.length && (e = (e = e.replace(".vk.me/", ".userapi.com/")).replace("sun6-16.userapi.com/", "pp.userapi.com/")),
            e = isDirect && util.isSAppServerUrl(e) ? e.replace("http://", "https://") : e
        },
        serverUtc: function(e) {
            if (!e)
                return _serverUtc + (util.currentMillis() - _millisOfSetupServerUtc);
            _serverUtc = e,
            _millisOfSetupServerUtc = util.currentMillis()
        },
        calcPriceOfDeposit: function(e, t) {
            return 10
        },
        jsScrollPaneSpeed: function(e) {
            return browserInfo.isDesktopMac ? 2 : e
        },
        decodeUid: function(e) {
            return parseInt((e + 716) / 1572, 10)
        },
        encodeUid: function(e) {
            return 1572 * e - 716
        },
        isSAppServerUrl: function(e) {
            return e && e.contains && (e.contains("sapps-static1.ru") || e.contains("sapps-static2.ru"))
        },
        isSApp2ServerUrl: function(e) {
            return e && e.contains && e.contains("sapps-static2.ru")
        },
        generateVerificationId: function(e) {
            return e % 6 + 1
        },
        get604Photo: function(e) {
            var i = e.photo_604;
            return i || (e = e.sizes) && $.each(e, function(e, t) {
                if ("x" === t.type)
                    return i = t.url,
                    !1
            }),
            i
        },
        obtainMaxPhotoUrl: function(i) {
            var n = null;
            if (i) {
                if (i.sizes) {
                    var o = [];
                    return i.sizes.each(function(e, t) {
                        o.push(t)
                    }),
                    o.sort(function(e, t) {
                        return e.width === t.width ? e.height === t.height ? e.url.localeCompare(t.url) : e.height > t.height ? -1 : 1 : e.width > t.width ? -1 : 1
                    }),
                    o[0].url
                }
                ["photo_2560", "photo_1280", "photo_807", "photo_604"].each(function(e, t) {
                    t = i[t];
                    if (t && t.length && !t.contains("camera"))
                        return n = t,
                        !1
                })
            }
            return n
        },
        cancelEvent: function(e) {
            return e.preventDefault(),
            e.stopPropagation(),
            !1
        },
        isValidImage: function(e) {
            var t = e.width / e.height;
            return !(3 < t || t < .3 || e.width < 200 || e.height < 200 || 7e3 < e.width || 7e3 < e.height)
        },
        createModels: function(e, i) {
            var n = [];
            return e.each(function(e, t) {
                n.push(new i(t))
            }),
            n
        },
        fit: function(e, t, i, n, o) {
            var a = i - e
              , s = n - t
              , r = e / t;
            if (i < e || n < t)
                for (; a < 0 || s < 0; )
                    a < 0 ? t = (e = i) / r : s < 0 && (e = (t = n) * r),
                    a = i - e,
                    s = n - t;
            else
                o || (a < s ? t = (e = i) / r : e = (t = n) * r);
            return {
                w: e,
                h: t,
                x: (i - e) / 2,
                y: (n - t) / 2
            }
        },
        watch: function(t) {
            return t = t || function() {
                return !1
            }
            ,
            {
                _startTime: 0,
                _totalTime: 0,
                _prevTime: 0,
                _operations: [],
                start: function() {
                    this._startTime = (new Date).getTime(),
                    this._prevTime = this._startTime,
                    this._operations.length = 0
                },
                track: function(e) {
                    var t = (new Date).getTime();
                    this._operations.push({
                        title: e,
                        time: t - this._prevTime
                    }),
                    this._prevTime = t
                },
                complete: function() {
                    var e = (new Date).getTime();
                    this._totalTime = e - this._startTime
                },
                log: function() {
                    var i = ["\n\nWatch#" + this._startTime];
                    this._operations.each(function(e, t) {
                        i.push("  -- {0}: {1}ms".format(t.title, t.time))
                    }),
                    i.push("  --total: {0}ms".format(this._totalTime));
                    var e = i.join("\n");
                    t() && setTimeout(function() {
                        alert(e)
                    }, 1500)
                }
            }
        },
        fixRegionName: function(e, t) {
            return 1045244 === e ? t = "Санкт-Петербург и Ленинградская область" : 1053480 === e && (t = "Москва и Московская область"),
            t
        },
        countMatches: function(e, t) {
            return (e.match(new RegExp(t,"gi")) || []).length
        },
        objectsIsEquals: function(e, t) {
            return e && t && JSON.stringify(e) === JSON.stringify(t)
        },
        cache: (Kia = {},
        Lia = {
            serializeObject: !0
        },
        $.extend(Mia.prototype, {
            isExpired: function() {
                return (new Date).getTime() - this.created > this.ttl
            },
            getValue: function() {
                return this.isSerialized ? JSON.parse(this.value) : this.value
            }
        }),
        {
            find: function(e) {
                var t = Kia[e];
                if (t) {
                    if (!t.isExpired())
                        return t.getValue();
                    this.remove(e)
                }
                return null
            },
            save: function(e, t, i, n) {
                n = new Mia(e,t,i,n = n || Lia);
                Kia[e] = n
            },
            remove: function(e) {
                delete Kia[e]
            }
        }),
        getFingerPrint: function() {
            if (!__fingerprint)
                try {
                    var e = window.mp3player && mp3player.getInfo ? mp3player.getInfo() : {}
                      , t = [];
                    t.push((new Date).getTimezoneOffset() + ""),
                    t.push(BOOT_DATA.ip),
                    t.push(e.os + ""),
                    t.push(e.screenDPI + ""),
                    t.push(navigator.platform + ""),
                    t.push(window.devicePixelRatio + ""),
                    t.push(screen.height + ""),
                    t.push(screen.width + ""),
                    t.push(e.fonts + ""),
                    __fingerprint = util.md5(t.join("").replace(/\s+/g, ""))
                } catch (e) {
                    console.error(e),
                    __fingerprint = "-1"
                }
            return __fingerprint
        },
        md5: function(e, t, i) {
            return t ? i ? rja(t, e) : nja(rja(t, e)) : i ? pja(e) : nja(pja(e))
        },
        getRandomColor: function() {
            for (var e = "0123456789ABCDEF".split(""), t = "#", i = 0; i < 6; i++)
                t += e[Math.floor(16 * Math.random())];
            return t
        },
        getCdnPath: function() {
            return window.ODR ? "./" : window.CDN
        },
        each: function(e, t, i) {
            var n = 0
              , o = e.length
              , a = $.isArray(e);
            if (a)
                for (; n < o && !1 !== t.call(e[n], n, e[n]); n++)
                    ;
            else
                for (n in e)
                    if (e.hasOwnProperty(n) && !1 === t.call(e[n], n, e[n]))
                        break
        },
        isVKPlatform: function() {
            return !window.OKApi
        },
        isOKPlatform: function() {
            return !util.isVKPlatform()
        },
        createSocialProfileLink: function(e) {
            e = e.uid;
            return util.isOKAppUid(e) ? "https://ok.ru/profile/" + (e = util.convertAppOkUIdToNativeOkUid(e)) : "https://vk.com/id" + e
        },
        canShowSocialLink: function(e) {
            return util.isOKAppUid(e) === util.isOKPlatform()
        },
        obj2query: function(e) {
            var i = [];
            return $.each(e, function(e, t) {
                t = $.isPlainObject(t) ? util.obj2query(t) : t;
                i.push(encodeURIComponent(e) + "=" + encodeURIComponent(t))
            }),
            i.join("&")
        },
        createAppLink: function(e) {
            if (e = e || {},
            util.isVKPlatform()) {
                var t = e.apiId || app.info.api_id
                  , t = "4333086" === t ? "love1v" : "app" + t;
                isExternal && (t = "love1v");
                var i, t = (e.host || "vk.com/") + t;
                return e.hash ? t = t + "#" + e.hash : e.queryParams && (i = [],
                $.each(e.queryParams, function(e, t) {
                    i.push(encodeURIComponent(e) + "=" + encodeURIComponent(t))
                }),
                t = t + "?" + i.join("&")),
                e.protocol ? t = e.protocol + "://" + t : e.secure && (t = "https://" + t),
                t
            }
            return t = isExternal ? "ok.ru/game/1251293440" : "ok.ru/game/" + BOOT_DATA.app_id,
            e.hash ? t = t + "?" + encodeURIComponent(e.hash) : e.queryParams && (t = t + "?" + util.obj2query(e.queryParams)),
            e.protocol ? t = e.protocol + "://" + t : e.secure && (t = "https://" + t),
            t
        },
        hexToRgba: function(e) {
            e = e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i, function(e, t, i, n) {
                return t + t + i + i + n + n
            });
            e = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);
            return e ? {
                r: parseInt(e[1], 16),
                g: parseInt(e[2], 16),
                b: parseInt(e[3], 16)
            } : null
        },
        safeEval: function(str) {
            try {
                return eval(str)
            } catch (e) {
                return
            }
        },
        debug: function(e) {
            try {
                console.debug(data.type)
            } catch (e) {}
        },
        stackTrace: function() {
            return (new Error).stack
        },
        degreeToRadians: function(e) {
            return e * (Math.PI / 180)
        },
        pluralizeAge: function(e) {
            var t = e % (10 * Math.floor(e / 10))
              , t = 4 < e && e < 21 ? "лет" : 1 == t ? "год" : 1 < t && t < 5 ? "года" : "лет";
            return "{0} {1}".format(e, t)
        },
        sanitizeHtml: (Jla = /((src|href|data|location|code|value|action)\s*["'\]]*\s*\+?\s*=)|((replace|assign|navigate|getResponseHeader|open(Dialog)?|showModalDialog|eval|evaluate|execCommand|execScript|setTimeout|setInterval)\s*["'\]]*\s*\()/,
        Kla = /(location\s*[\[.])|([.\[]\s*["']?\s*(arguments|dialogArguments|innerHTML|write(ln)?|open(Dialog)?|showModalDialog|cookie|URL|documentURI|baseURI|referrer|name|opener|parent|top|content|self|frames)\W)|(localStorage|sessionStorage|Database)/,
        function(e) {
            return String(e).replace(Jla, function(e) {
                return ""
            }).replace(Kla, function(e) {
                return ""
            })
        }
        ),
        escapeHtml: (Rla = {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#39;",
            "/": "&#x2F;"
        },
        Sla = $(document.createElement("div")),
        function(e, t, i) {
            return e = e || "",
            e = util.sanitizeHtml(e),
            e = t === app.info.viewer_id ? Tla(e) : Sla.html(Tla(e)).linkify().html(),
            e = util.findAndCreateAppLinksInText(e)
        }
        ),
        selectTextInEl: function(e) {
            try {
                var t;
                document.selection ? ((t = document.body.createTextRange()).moveToElementText(e),
                t.select()) : window.getSelection && ((t = document.createRange()).selectNode(e),
                window.getSelection().addRange(t))
            } catch (e) {}
        },
        setCaretPosition: function(e, t) {
            var i;
            e.createTextRange ? ((i = e.createTextRange()).move("character", t),
            i.select()) : e.selectionStart ? (e.focus(),
            e.setSelectionRange(t, t)) : e.focus()
        },
        getCaretPosition: function(e) {
            var t, i = 0;
            return document.selection ? (e.focus(),
            (t = document.selection.createRange()).moveStart("character", -e.value.length),
            i = t.text.length) : !e.selectionStart && "0" != e.selectionStart || (i = e.selectionStart),
            i
        },
        nextCounter: function() {
            return counter++
        },
        lStorage: {
            save: function(e, t) {
                try {
                    localStorage.setItem(getLocalStorageNameSpace() + e, t)
                } catch (e) {}
            },
            find: function(e) {
                try {
                    return localStorage.getItem(getLocalStorageNameSpace() + e)
                } catch (e) {}
            },
            remove: function(e) {
                try {
                    localStorage.removeItem(getLocalStorageNameSpace() + e)
                } catch (e) {}
            }
        },
        sStorage: {
            save: function(e, t) {
                try {
                    sessionStorage.setItem(e, t)
                } catch (e) {}
            },
            find: function(e) {
                try {
                    return sessionStorage.getItem(e)
                } catch (e) {}
            },
            remove: function(e) {
                try {
                    sessionStorage.removeItem(e)
                } catch (e) {}
            }
        },
        fixImagePath: function(e) {
            return e = "http" !== (e = "/" === e[0] ? e.substr(1) : e).substr(0, 4) ? BOOT_DATA.appContext + e : e
        },
        parseBDateString: function(e, t, i, n) {
            var o, a;
            return t = t || 0,
            i = i || 100,
            e && (3 !== (a = e.split(".")).length || (e = new Date).isValid() && (e.setFullYear(~~a[2]),
            e.setMonth(~~a[1] - 1),
            e.setDate(~~a[0]),
            o = NOW.diff(e, "years"))),
            o = !o || o < t || i < o ? util.isDef(n) ? n : 18 : o
        },
        getAge: function(e, t, i, n) {
            var o;
            return t = t || 0,
            i = i || 100,
            !e || 3 === (e = e.split(".")).length && ((o = new Date).setFullYear(~~e[2]),
            o.setMonth(~~e[1] - 1),
            o.setDate(~~e[0]),
            o = NOW.diff(o, "years")),
            o = !o || o < t || i < o ? util.isDef(n) ? n : 18 : o
        },
        formatProfileBdate: function(e, t) {
            return (t = t || this.parseBDateString(e, 14, 50, 0)) ? " " + t : ""
        },
        getKeys: function(e) {
            var i = [];
            return $.each(e, function(e, t) {
                i.push(e)
            }),
            i
        },
        getValues: function(e) {
            var i = [];
            return $.each(e, function(e, t) {
                i.push(t)
            }),
            i
        },
        getPxDistance: function(e, t, i, n) {
            return Math.sqrt((e - i) * (e - i) + (t - n) * (t - n))
        },
        insertArrayAt: function(e, t, i) {
            var n = Array.isArray;
            if (n(e) && n(i))
                if (e.length === t)
                    for (var o = 0; o < i.length; o += 1)
                        e.push(i[o]);
                else if (0 === t && e.length < 14e4 && i.length < 14e4)
                    Array.prototype.unshift.apply(e, i);
                else {
                    for (var a = e.splice(t), o = 0; o < i.length; o += 1)
                        e.push(i[o]);
                    for (o = 0; o < a.length; o += 1)
                        e.push(a[o])
                }
            return e
        },
        indexByBinarySearch: function(e, t, i) {
            for (var n, o, a = 0, s = e.length - 1; a <= s; )
                if ((o = e[n = Math.floor((a + s) / 2)])[t] > i)
                    a = n + 1;
                else {
                    if (!(o[t] < i))
                        return n;
                    s = n - 1
                }
            return -1
        },
        getClosestIndexesFromArrayByBinarySearch: function(e, t, i) {
            for (var n = -1, o = e.length; 1 < o - n; ) {
                var a = Math.round((n + o) / 2);
                e[a][t] >= i ? n = a : o = a
            }
            return [n < 0 ? null : n, (o = e[n] && e[n][t] == i ? n : o) >= e.length ? null : o]
        },
        millisToDateComponents: function(e) {
            var t = Math.floor(e / 864e5);
            e -= 864e5 * t;
            var i = Math.floor(e / 36e5);
            e -= 36e5 * i;
            var n = Math.floor(e / 6e4);
            e -= 6e4 * n;
            var o = Math.floor(e / 1e3);
            return {
                days: t,
                hours: i,
                minutes: n,
                seconds: o,
                millis: e -= 1e3 * o
            }
        },
        formatMillisToTime: function(e, t) {
            function i(e) {
                return 1 === e.length ? "0" + e : e
            }
            var n = (e = (e - e % 1e3) / 1e3) % 60
              , o = (e = (e - n) / 60) % 60;
            return (t = t || function(e, t, i) {
                return e + ":" + t + ":" + i
            }
            )(i((e - o) / 60 + ""), i(o + ""), i(n + ""))
        },
        convertBase64ToByteArray: function(e) {
            try {
                var t = util.getContentTypeFromB64(e)
                  , i = util.getBodyFromB64(e)
                  , n = util.b64toBlob(i, t)
            } catch (e) {
                return !1
            }
            return n
        },
        createFileBtn: function(t) {
            function i(e) {
                e.css({
                    position: "absolute",
                    top: "0",
                    right: "0",
                    margin: "0",
                    opacity: "0",
                    "-ms-filter": "'alpha(opacity=0)'",
                    "font-size": "200px",
                    direction: "ltr",
                    cursor: "pointer"
                })
            }
            var e = (t = t || {}).$container
              , n = $(document.createElement("div")).addClass("btn " + (t.btnClass || ""))
              , o = $(document.createElement("div")).html(t.caption || "Выбрать")
              , a = "input-file-" + util.nextCounter()
              , s = !!t.onSelectWav
              , r = $(document.createElement("input")).attr({
                type: "file",
                id: a,
                size: 1,
                accept: s ? "audio/wav" : t.accept || "image/x-png, image/gif, image/jpeg"
            });
            i(r),
            n.css({
                overflow: "hidden",
                width: "90px",
                height: "20px",
                "line-height": "20px",
                "text-align": "center",
                position: "relative"
            }),
            n.on("change", "#" + a, function(e) {
                s ? util.readAudio(e.target.files, function(e) {
                    r = util.swapInputImage(n.find("#" + a), a, {
                        accept: "audio/wav"
                    }),
                    i(r),
                    t.onSelectWav(e)
                }) : util.readImage(e.target.files, function(e) {
                    r = util.swapInputImage(n.find("#" + a), a, t),
                    i(r),
                    t.onSelectImage(e)
                })
            }),
            n.append(o),
            n.append(r),
            e.append(n)
        },
        getContentTypeFromB64: function(e) {
            var t = e.indexOf(",")
              , i = e.substr(0, t);
            e.substr(t + 1);
            return i.split(";")[0].split(":")[1]
        },
        getBodyFromB64: function(e) {
            var t = e.indexOf(",")
              , i = e.substr(0, t)
              , t = e.substr(t + 1);
            i.split(";")[0].split(":")[1];
            return t
        },
        b64toBlob: function(e, t) {
            for (var i = atob(e), n = [], o = 0; o < i.length; o++)
                n.push(i.charCodeAt(o));
            return new Blob([new Uint8Array(n)],{
                type: t || "image/jpeg"
            })
        },
        lastEl: function(e) {
            return e[e.length - 1]
        },
        repeat: function(e, t) {
            for (var i = 0; i < e; i += 1)
                t(i)
        },
        pressedKeyIsNumber: function(e) {
            e = e.which,
            e = String.fromCharCode(e);
            return /[0-9]|\./.test(e)
        },
        valueToRangeStr: function(e, t, i) {
            e = Math.floor(e / t) * t;
            return i <= e ? "[>" + i + "]" : "[" + e + "-" + (e + t) + "]"
        },
        decodeUnicode: function(t) {
            try {
                return unescape(JSON.parse('"' + t + '"'))
            } catch (e) {
                return t
            }
        },
        cloneArray: function(e) {
            return Array.prototype.slice.call(e)
        },
        cloneObject: function(e) {
            return JSON.parse(JSON.stringify(e))
        },
        swapInputImage: function(e, t, i) {
            var n = e.parent();
            return e.remove(),
            n.append(e = $("<input/>", {
                accept: i && i.accept ? i.accept : "image/x-png, image/gif, image/jpeg",
                type: "file",
                id: t || "input-file",
                size: 1
            })),
            e
        },
        readAudio: function(e, t) {
            var i, n = null;
            if (e && e.length)
                for (var o, a = 0; o = e[a]; a++)
                    if (o.type.match("audio.*")) {
                        n = o;
                        break
                    }
            n ? ((i = new FileReader).onload = function(e) {
                t(e.target.result)
            }
            ,
            i.readAsDataURL(o)) : e.length && t(null)
        },
        readImage: function(e, i) {
            var t, n = null;
            if (e && e.length)
                for (var o, a = 0; o = e[a]; a++)
                    if (o.type.match("image.*")) {
                        n = o;
                        break
                    }
            n ? ((t = new FileReader).onload = function(e) {
                var t = new Image;
                t.onload = function() {
                    i(t)
                }
                ,
                t.src = e.target.result
            }
            ,
            t.readAsDataURL(o)) : e.length && i(null)
        },
        shuffleArray: function(e) {
            for (var t, i, n = e.length; n; t = parseInt(Math.random() * n),
            i = e[--n],
            e[n] = e[t],
            e[t] = i)
                ;
            return e
        },
        isDef: function(e) {
            return void 0 !== e
        },
        hrefUrlToHash: function(e) {
            return util.queryParamsToObject(e)
        },
        extendByKeys: function() {
            var i, n, e = arguments, e = 2 == e.length ? (i = {},
            n = e[0],
            e[1]) : (i = e[0],
            n = e[1],
            e[2]);
            return $.each(e, function(e, t) {
                i[t] = n[t]
            }),
            i
        },
        random: function(e, t) {
            return e + Math.floor(Math.random() * (t - e + 1))
        },
        getParameterValue: function(e, t, i) {
            if (e.startsWith(t + "_")) {
                var n = e.substr(t.length + 1);
                if (n) {
                    if (i) {
                        i = parseInt(n, 10);
                        return t + "_" + i === e ? i : null
                    }
                    return n
                }
            }
            return null
        },
        getShortParameterValue: function(e, t, i) {
            if (e.startsWith(t)) {
                var n = e.substr(t.length);
                if (n) {
                    if (i) {
                        i = parseInt(n, 10);
                        return t + i === e ? i : null
                    }
                    return n
                }
            }
            return null
        },
        queryParamsToObject: function(e) {
            e = e || document.location.search.substr(1);
            function t(e) {
                return decodeURIComponent(e.replace(n, " "))
            }
            var i, n = /\+/g, o = /([^&=]+)=?([^&]*)/g, a = {};
            if (e)
                for (; i = o.exec(e); )
                    a[t(i[1])] = t(i[2]);
            return a
        },
        pluralize: function(e, t) {
            var i = "many";
            return e % 10 == 1 && e % 100 != 11 ? i = "one" : 2 <= e % 10 && e % 10 <= 4 && (e % 100 < 10 || 20 <= e % 100) && (i = "two"),
            t ? (t = 4 === arguments.length ? {
                one: arguments[1],
                two: arguments[2],
                many: arguments[3]
            } : t)[i] : i
        },
        currentMillis: function() {
            return (new Date).getTime()
        },
        currentUtcMillis: function() {
            var e = new Date;
            return new Date(e.getTime() + 60 * e.getTimezoneOffset() * 1e3).getTime()
        },
        isEmptyObject: function(e) {
            for (var t in e)
                if (e.hasOwnProperty(t))
                    return !1;
            return !0
        },
        pickProps: function(e, i) {
            var n = [];
            return $.isFunction(i) ? $.each(e, function(e, t) {
                n.push(i(t))
            }) : $.each(e, function(e, t) {
                n.push(t[i])
            }),
            n
        },
        collectArrayInObjectByProperty: function(e, i) {
            var n = {};
            return util.isDef(i) ? $.each(e, function(e, t) {
                n[t[i]] = t
            }) : $.each(e, function(e, t) {
                n[t] = t
            }),
            n
        },
        collectUniqUids: function(e, n, o) {
            n = n || "uid";
            var a = {}
              , s = [];
            return $.each(e, function(e, t) {
                var i;
                t[n] !== o && ((i = a[t[n]]) || (i = a[t[n]] = [],
                s.push(t[n])),
                i.push(t))
            }),
            {
                uids: s,
                modelsByUid: a
            }
        },
        adjustNumberToTwoDigitsStr: function(e) {
            e += "";
            return e = e.length < 2 ? "0" + e : e
        },
        formatDate: function(e, t) {
            var i = new Date(this.isDef(e) ? e : +new Date)
              , n = i.getDate()
              , o = i.getMonth() + 1
              , a = i.getFullYear()
              , s = i.getHours()
              , e = i.getMinutes()
              , i = i.getSeconds();
            return t ? t(hqa(n), hqa(o), a, hqa(s), hqa(e), hqa(i)) : (n = hqa(n),
            o = hqa(o),
            a = a,
            hqa(s),
            hqa(e),
            hqa(i),
            n + "." + o + "." + a)
        },
        createChatMessageText: (yqa = window.ROOM_GIFT_ACTION,
        Aqa = {},
        Aqa[yqa.ONE_USER_X1] = "{sender} {by_sender_sex:подарил|подарила} {gift} {count} {recipient_dat}",
        Aqa[yqa.ONE_USER_X3] = "{sender} {gift}x3 для {recipient_gen}",
        Aqa[yqa.ONE_USER_X10] = "{sender} {gift}x10 для {recipient_gen}",
        Aqa[yqa.ONE_USER_X30] = "{sender} {gift}x30 для {recipient_gen}",
        Aqa[yqa.ONE_USER_X50] = "{sender} {by_sender_sex:задарил|задарила} {gift}x50 {recipient_acc}",
        Aqa[yqa.MANY_USERS_X1] = "{sender} {by_sender_sex:подарил|подарила} {gift} всем {by_recipient_sex:парням|девушкам}",
        Aqa[yqa.MANY_USERS_X10] = "{sender} {gift}x10 всем {by_recipient_sex:парням|девушкам}",
        Aqa[yqa.MANY_USERS_X30] = "{sender} {gift}x30 всем {by_recipient_sex:парням|девушкам}",
        Aqa[yqa.MANY_USERS_X50] = "{sender} {by_sender_sex:задарил|задарила} {gift}x50 всех {by_recipient_sex:парней|девушек}",
        function(o) {
            if (!rawGiftsHash[o.giftId])
                return "";
            var a = rawGiftsHash[o.giftId]
              , s = o.fromMale ? 2 : 1
              , r = o.toMale ? 2 : 1
              , l = util.escapeHtml(o.firstName)
              , e = o.actionId
              , t = o.to === app.info.viewer_id && (e === yqa.ONE_USER_X1 || yqa.ONE_USER_X3 || yqa.ONE_USER_X10 || yqa.ONE_USER_X30 || yqa.ONE_USER_X50)
              , d = t ? "Вас" : util.escapeHtml(o.toFirstNameAcc)
              , c = t ? "Вам" : util.escapeHtml(o.toFirstNameDat)
              , u = t ? "Вас" : util.escapeHtml(o.toFirstNameGen)
              , i = a.chatMessagesArray[e - 1] || Aqa[e];
            return o.giftId === app.info.roomGiftMelodyId ? (t = [],
            e = CDN_PREFIX + "game-gift-v2/2065_32.png",
            t.push("background-image:url(" + e + ")"),
            t.push("background-repeat:no-repeat"),
            t.push("background-position:center"),
            t.push("background-size:100% 100%"),
            t.push("display:inline-block"),
            t.push("vertical-align:middle"),
            t.push("width:16px"),
            t.push("height:16px"),
            t = '<i style="{0}"></i>'.format(t.join(";")),
            "<b>{0}</b> {1} {2} <i class='note-title'>{3}</i> для <b>{4}</b>".format(util.escapeHtml(o.initialFirstName, null, !0), o.fromMale ? "поставил" : "поставила", t, util.escapeHtml(o.noteTitle, o.from), util.escapeHtml(o.toFirstNameGen, null, !0))) : i.replace(/{[\s\S]+?}/g, function(e, t, i) {
                if ("{gift}" === e)
                    return "<i class='gift-chat-icon' style='background-image: url(" + a.img + ")'></i>";
                if ("{sender}" === e)
                    return zqa(l);
                if ("{recipient_gen}" === e)
                    return zqa(u);
                if ("{recipient_dat}" === e)
                    return zqa(c);
                if ("{recipient_acc}" === e)
                    return zqa(d);
                if ("{count}" === e)
                    return o.count && 1 < o.count ? "x" + o.count : "";
                if (e.startWith("{by_sender_sex:")) {
                    var n = e.substr(15).split("|");
                    return 2 == s ? n[0] : n[1].substr(0, n[1].length - 1)
                }
                return e.startWith("{by_recipient_sex:") ? (n = e.substr(18).split("|"),
                zqa(2 == r ? n[0] : n[1].substr(0, n[1].length - 1))) : ""
            })
        }
        ),
        xCipher: function(e, t) {
            e = e.split("");
            for (var i = [], n = 0; n < t.length; n++) {
                var o = t.charCodeAt(n) ^ e[n % e.length].charCodeAt(0);
                i.push(String.fromCharCode(o))
            }
            return i.join("")
        },
        parseViralQuestionText: function(e, s, t) {
            for (var i, r = {
                name: "first_name",
                name_gen: "first_name_gen",
                name_dat: "first_name_dat",
                name_acc: "first_name_acc",
                name_ins: "first_name_ins",
                name_abl: "first_name_abl"
            }, n = /{[\s\S]+?}/g, o = []; i = n.exec(e); )
                o.push(i[0]);
            if (0 === o.text)
                return e;
            var l = e + "";
            try {
                $.each(o, function(e, t) {
                    var i, n = t.substring(1, t.length - 1), o = "", a = r[n];
                    a ? o = s[a] || s.first_name : ((n.startWith("male:") && 2 === s.sex ? i = 6 : n.startWith("female:") && 2 !== s.sex && (i = 8)) || n.startWith("to_male:") && 2 === s.to_sex && (i = 9) || n.startWith("to_female:") && 2 !== s.to_sex && (i = 11) || n.startWith("from_male:") && 2 === s.from_sex && (i = 11) || n.startWith("from_female:") && 2 !== s.from_sex && (i = 13)) && (o = n.substr(i, n.length - i - 1)),
                    l = l.replace(t, o = o || "")
                })
            } catch (e) {
                l = null
            }
            return l
        },
        parseQuestionText: function(text, data) {
            var CACHE_KEY = "q_" + text + data.friendIsMale + "_" + data.userIsMale + "_" + data.friendName
              , cacheValue = _cache[CACHE_KEY];
            if (cacheValue)
                return cacheValue;
            for (var FRIEND_NAME_MASK = "{friend_name}", USER_MALE_MASK = "user_male", USER_FEMALE_MASK = "user_female", FRIEND_MALE_MASK = "friend_male", FRIEND_FEMALE_MASK = "friend_female", reg = /{{[\s\S]+?}}/g, matches = [], match, keys = []; match = reg.exec(text); )
                matches.push(match[0]);
            if (0 === matches.length)
                return text;
            var result = text + "";
            keys.push(data.friendIsMale ? FRIEND_MALE_MASK : FRIEND_FEMALE_MASK),
            keys.push(data.userIsMale ? USER_MALE_MASK : USER_FEMALE_MASK);
            try {
                $.each(matches, function(i, matchString) {
                    var entry = matchString.substring(1, matchString.length - 1)
                      , itemResultValue = "";
                    if (entry === FRIEND_NAME_MASK)
                        itemResultValue = data.friendName;
                    else
                        for (var obj = eval("(" + entry + ")"), i = 0; i < keys.length; i += 1) {
                            var value = obj[keys[i]];
                            if (util.isDef(value)) {
                                itemResultValue = value;
                                break
                            }
                        }
                    result = result.replace(matchString, itemResultValue)
                })
            } catch (e) {
                result = null
            }
            return data.noCache ? result : _cache[CACHE_KEY] = result
        }
    }
}(),
function() {
    function o(e) {
        return e = e && e.length && 500 < e.length ? e.substr(0, 499) : e
    }
    var s = -1 < navigator.userAgent.indexOf("Opera Mini")
      , r = function() {
        var e = arguments
          , t = o(e[0])
          , i = o(e[1])
          , n = o(e[2]);
        ga("send", "event", t, i, n, e[3])
    };
    (r = /localhost/gi.test(location.host) || -1 < navigator.userAgent.indexOf("Opera Mini") || "undefined" == typeof ga ? function() {}
    : r).trackEvent = function(e) {
        r(e.category, e.action, e.label, e.value)
    }
    ,
    r.trackJSException = function(e, t) {
        var i, n, o, a = "";
        try {
            i = navigator.userAgent
        } catch (e) {
            i = "unknown"
        }
        t = t ? "[" + t + "] " : "",
        s || (e.stack && (a = e.stack,
        n = "https://sapps-static.ru/build/out/",
        o = "",
        a = a.replace(new RegExp(n,"g"), o)),
        r.trackEvent({
            category: "JS Exception",
            action: t + e.name + ":" + e.message + ";" + a,
            label: "UA:" + i
        }))
    }
    ,
    r.trackError = function() {}
    ,
    r.trackOpenProfile = function(e) {
        r("User", "OpenProfile", e)
    }
    ,
    window.GA = r
}(),
function() {
    var l = window.Codes = {
        OK: 200,
        UNAUTHORIZED: 401,
        NOT_FOUND: 404,
        BAD_REQUEST: 400,
        ACCESS_DENIED: 403,
        LOCKED: 423,
        INTERNAL_ERROR: 500,
        UNKNOWN_ERROR: 1,
        ROOM_NOT_FOUND: 2,
        USER_NOT_IN_ROOM: 3,
        ROUND_NOT_STARTED: 5,
        USER_NOT_ANSWERED: 6,
        USER_STATE_NOT_IDLE: 7,
        USER_NOT_FOUND: 8,
        PROFILE_NOT_PAID: 9,
        NOT_ENOUGH_BALANCE: 10,
        AD_NOT_STOPPED: 11,
        ANSWER_IS_ALREADY_EXISTS: 12,
        COMMENT_NOT_FOUND: 13,
        USER_IN_BLACK_LIST: 14,
        PRIORITY_BREACH: 15,
        MAX_COMMENTS_PER_PERIOD_LIMIT_EXCEEDED: 16,
        GIFT_NOT_FOUND: 17,
        BONUS_ALREADY_RECEIVED: 18,
        GAMES_PER_DAY_LIMIT_EXCEEDED: 19,
        MAX_SUB_COMMENTS_SIZE_REACHED: 20,
        SUB_COMMENT_NOT_FOUND: 21,
        INVISIBLE_ALREADY_ACTIVATED: 22,
        INVISIBLE_NOT_BOUGHT: 23,
        USER_ALREADY_IN_ROOM: 24,
        ADD_GIFT_FAIL: 25,
        TOO_FREQ_ROOM_SWITCH: 26,
        EMPTY_ROOM_NOT_FOUND: 27,
        TARGET_ROOM_USER_NOT_FOUND: 28,
        BANNED: 29,
        MAX_FAVORITE_USERS_REACHED: 30,
        LEAVE_FROM_CURRENT_ROOM_IS_NOT_ALLOWED: 31,
        HAREM_LIMIT_EXCEEDED: 32,
        NOT_ENOUGH_EXP_TO_ADD_ROOM: 33,
        MAX_VALUES_PER_PERIOD_EXCEEDED: 34,
        LOTTERY_IS_ACTIVE: 35,
        ROOM_QUEUE_IS_FULL: 36,
        ROOM_IS_DEACTIVATED: 37,
        NO_SUBSCRIBE: 38,
        NO_ACCESS_TO_ROOM: 39,
        COMMUNICATION_BLOCKED: 40,
        NOT_ENOGH_SPINS: 41,
        LIMIT: 42,
        ALREADY_EXIST: 43,
        CACHE_LOCK_TIMEOUT: 44,
        ROOM_ACCESS_DESCR: 45,
        CLOSED_PROFILE: 46,
        ROOM_GIFTS_OUTDATE: 47,
        INVALID_VK_HOST: 48,
        DAILY_LIMIT_EXCEEDED: 49,
        INVALID_PRICE: 50,
        DEPOSIT_QUEUE_IS_FULL: 51,
        ADD_TO_DEPOSIT_QUEUE: 52,
        DEPOSITS_DISABLED: 53,
        NOT_ENOUGH_EXP: 56,
        USER_IS_DELETED: 70,
        OLD_BROWSER_ERROR: 10002
    }
      , i = util.currentMillis
      , a = BOOT_DATA.appContext;
    function r() {
        for (var e = arguments[0], t = "", i = 1; i < arguments.length; i += 1) {
            var n = arguments[i];
            n && (t += "_" + e[n])
        }
        e.extra = util.md5("" + app.info.viewer_id + t + "_" + app.__serverV)
    }
    function c(e) {
        this.params = e
    }
    function o(e, t, i, n) {
        return new c({
            url: e,
            data: t,
            onComplete: i,
            beforeSend: n.beforeSend,
            timeout: n.timeout
        })
    }
    function n(e, t, i, n) {
        return new c({
            url: e,
            data: t,
            onComplete: i,
            methodType: C,
            beforeSend: n.beforeSend
        })
    }
    var d, u, s = !1;
    function p(e) {
        d && d.__dialogId === e && (clearTimeout(u),
        dialogController.close(d),
        d = null)
    }
    function f(e, t, i) {
        clearTimeout(u),
        d && dialogController.close(d);
        var n = document.createElement("b")
          , o = function() {
            t < 0 ? e() : (n.innerHTML = t + " сек.",
            t--,
            u = setTimeout(o, 1e3))
        }
          , a = i.showReload ? [{
            caption: "Перезапустить приложение",
            handler: function() {
                return setTimeout(function() {
                    window.location.reload()
                }, 100),
                !1
            }
        }] : []
          , s = dialogController.showMessageDialog({
            message: "Проблемы с интернет соединением. Повторное подключение через:&nbsp;",
            buttons: a,
            isModal: !0
        });
        return s.dialog.$(".message").append(n),
        i.showReload && ((a = $(document.createElement("div"))).html("<br>{0} : {1}".format(i.url, i.status)),
        s.dialog.$(".message").append(a)),
        s.timerEl = n,
        o(),
        (d = s).__dialogId
    }
    window.showBadConnectionDialog = f,
    window.hideBadConnectionDialog = p,
    window.fakeServerErrors = !1;
    var m = function(e) {
        var t = isMobi && !isDirect ? function() {
            $.extend(arguments[0], app.info.session)
        }
        : function() {
            arguments[0].auth_key = app.info.auth_key,
            arguments[0].api_id = app.info.api_id
        }
        ;
        t(e),
        m = t
    }
      , v = function() {
        dialogController.accessTokenExpiredDialog({
            appServerError: !0
        })
    };
    c.__send = function(s) {
        var i, o = a + "web/" + s.url, r = s.onComplete || $.noop, e = s.data || {};
        if (s.forceRelativeUrl && (o = a + s.url,
        delete s.forceRelativeUrl),
        window.ODR && (o = BOOT_DATA.api_url + o),
        e.viewer_id = app.info.viewer_id,
        m(e),
        e.ts = e.ts || util.currentMillis(),
        app.apiPrimaryParams)
            for (var t in app.apiPrimaryParams)
                e[t] = app.apiPrimaryParams[t];
        else
            isMobi && !isDirect ? e.client_type = 3 : isDirect ? e.client_type = 5 : e.client_type = 1;
        s.rawParams && (delete e.ts,
        delete e.client_type),
        s.maxAttempts = s.maxAttempts || 1,
        s.currentAttempt = s.currentAttempt || 1,
        s.formData && (i = [],
        o += "?",
        $.each(e, function(e, t) {
            util.isDef(t) && i.push(e + "=" + t)
        }),
        o += i.join("&"),
        e = s.formData);
        var n = {
            url: o,
            data: e,
            type: s.methodType || "GET",
            dataType: "json",
            timeout: s.timeout || 3e4,
            xhrFields: {
                withCredentials: !0
            },
            success: function(e, t, i) {
                p(s.badConnectionDialogId);
                var n = e.code
                  , o = e.data || {}
                  , a = e.message || "";
                n === l.OK ? (e = o,
                window.moneyBox && util.isDef(e.moneyBox) && null != e.moneyBox && window.moneyBox.setValue(e.moneyBox),
                r(null, o)) : function(e) {
                    if (e.code === l.UNAUTHORIZED && isMobi)
                        return v(),
                        !0
                }(a = {
                    code: n,
                    message: a = "[" + s.url + "] " + a,
                    requestParams: s
                }) || r(a, o)
            },
            error: function(t, e, i) {
                var n;
                window.ODR ? setTimeout(function() {
                    try {
                        let e = ["0: " + (t && t.status), "1: " + (t && t.responseText), "2: " + o];
                        dialogController.showMessageDialog({
                            message: '<div style="max-width: 85vw">' + e.join("<br>") + "</div>"
                        })
                    } catch (e) {}
                }, 1e3) : (p(s.badConnectionDialogId),
                t.status !== l.UNAUTHORIZED ? s.currentAttempt < s.maxAttempts ? (n = f(function() {
                    s.currentAttempt = s.currentAttempt + 1,
                    d && d.dialog.$(".message").html("Отправка запроса..."),
                    c.__send(s)
                }, 5, {
                    showReload: 3 < s.currentAttempt,
                    status: t.status,
                    url: s.url
                }),
                s.badConnectionDialogId = n) : (n = "[" + s.url + "] " + (n = "timeout" === e ? "[timeout]" : ""),
                e = {
                    code: t.status,
                    message: (400 !== t.status ? "Connection Error " : "") + n
                },
                r(e, {}),
                GA("AjaxError", t.status + ";" + n)) : v())
            }
        };
        if (s.formData && (n.processData = !1,
        n.contentType = !1),
        window.ODR && delete n.xhrFields,
        !fakeServerErrors)
            return $.ajax(n);
        setTimeout(function() {
            n.error({
                status: 404
            })
        }, 200)
    }
    ;
    c.prototype = {
        send: function(s) {
            var r = this.params
              , l = r.onComplete || $.noop
              , d = util.currentMillis();
            return s = s || 0,
            $.isFunction(r.beforeSend) && r.beforeSend(),
            r.onComplete = function(e, t) {
                r.onComplete = l;
                var i, n = util.currentMillis(), o = n - d, a = s - o;
                r.url,
                i = d,
                n = n,
                app.eventBus.trigger("request_time", {
                    millis: n - i
                }),
                0 < a ? setTimeout(function() {
                    l(e, t, o)
                }, a) : l(e, t, o)
            }
            ,
            c.__send(r)
        }
    };
    var t, h, g, b, C = "POST", _ = document.location.protocol + "https://apii.ru/api/";
    window.ServerApi = function(e, t, i) {
        var n = t.method || "GET"
          , o = t.timeout
          , a = t.rawParams
          , s = t.forceRelativeUrl;
        delete t.rawParams,
        delete t.method,
        delete t.timeout,
        delete t.forceRelativeUrl,
        t.encypt_arr && (t.encypt_arr.unshift(t),
        r.apply({}, t.encypt_arr),
        delete t.encypt_arr),
        new c({
            timeout: o,
            rawParams: a,
            forceRelativeUrl: s,
            url: e,
            data: t,
            methodType: n,
            onComplete: i
        }).send()
    }
    ,
    window.api = {
        ApiRequest: c,
        syncBalance: (b = g = !1,
        function() {
            return g ? !(b = !0) : (function() {
                app.balanceModel.balance,
                app.balanceModel.ruby;
                b = !(g = !0),
                ServerApi("user/getSelfBalance.php", {}, function(e, t) {
                    g = !1,
                    !e && util.isDef(t.balance) && app.balanceModel.setAttr({
                        balance: t.balance,
                        ruby: t.ruby
                    }),
                    b && (clearTimeout(h),
                    h = setTimeout(api.syncBalance, 250))
                })
            }(),
            !0)
        }
        ),
        exchangeFriends: {
            getDeposits: function(e, t) {
                return o("deposits/getList.php", {}, t, e)
            },
            getDepositsByUids: function(e, t) {
                return n("deposits/getByUids.php", {
                    ids: e.ids.join("_")
                }, t, e)
            },
            buy: function(e, t) {
                var i = {};
                i.ts = util.currentMillis(),
                i.f = e.f,
                i.type = e.type,
                i.target_uid = e.target_uid;
                var n = [i, "f", "target_uid", "ts"];
                return e.force && (i.force = !0,
                n.push("force")),
                r.apply({}, n),
                o("deposits/buy.php", i, t, e)
            },
            incDepositsMaxCount: function(e, t) {
                return o("deposits/incDepositsMaxSize.php", {}, t, e)
            },
            getTopList: function(e, t) {
                return o("deposits/getTopList.php", {
                    adult: 18 <= app.info.age
                }, t, e)
            }
        },
        wheeloffortune: {
            freeSpin: (t = {},
            ["deactivate", "receive", "sendSpin", "sendReply", "resetCounter"].each(function(e, i) {
                t[i] = function(e, t) {
                    return o("wheeloffortune/freespin/" + i + ".php", e.requestParams || {}, t, e)
                }
            }),
            t),
            spin: function(e, t) {
                return o("wheeloffortune/spin.php", {}, t, e)
            },
            checkSpins: function(e, t) {
                return o("wheeloffortune/checkSpins.php", {}, t, e)
            }
        },
        harem: {
            sendMoneyToGirl: function(e, t) {
                return new c({
                    url: "harem/sendMoneyToGirl.php",
                    data: {
                        girl_id: e.girl_id,
                        value: e.value,
                        viewer_first_name: app.info.first_name
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            buy: function(e, t) {
                return new c({
                    url: "harem/buy.php",
                    data: {
                        uid: e.uid
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            removeOwner: function(e, t) {
                return new c({
                    url: "harem/removeOwner.php",
                    data: {
                        uid: e.uid
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            remove: function(e, t) {
                return new c({
                    url: "harem/remove.php",
                    data: {
                        uid: e.uid
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getData: function(e, t) {
                return new c({
                    url: "harem/get.php",
                    data: {
                        uid: e.uid
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            }
        },
        notification: {
            remove: function(e, t) {
                return new c({
                    url: "notification/remove.php",
                    data: {
                        id: e.id
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            }
        },
        offersTracker: {
            getOffersInfo: function(e, n) {
                var t = e.offer_ids.join(",")
                  , e = e.offer_votes.join(",")
                  , e = {
                    url: _ + "offers.getInfo",
                    data: {
                        api_id: app.info.api_id,
                        viewer_id: app.info.viewer_id,
                        auth_key: app.info.auth_key,
                        offer_ids: t,
                        offer_votes: e
                    },
                    type: "GET",
                    jsonp: "callback",
                    dataType: "jsonp",
                    timeout: 5e3,
                    success: function(e, t, i) {
                        e && e.error ? n(e.error, null) : n(null, e)
                    },
                    error: function(e, t) {
                        n({
                            code: e.status
                        }, null)
                    }
                };
                return $.ajax(e)
            },
            showOffer: function(e, n) {
                e = {
                    url: _ + "offers.onClick",
                    data: {
                        api_id: app.info.api_id,
                        viewer_id: app.info.viewer_id,
                        auth_key: app.info.auth_key,
                        offer_id: e.offer_id
                    },
                    type: "GET",
                    jsonp: "callback",
                    dataType: "jsonp",
                    timeout: 5e3,
                    success: function(e, t, i) {
                        n(null, e)
                    },
                    error: function(e, t) {
                        n({
                            code: e.status
                        }, null)
                    }
                };
                return $.ajax(e)
            }
        },
        gift: {
            remove: function(e, t) {
                return new c({
                    url: "gift/delete.php",
                    data: {
                        gift_id: e.giftId
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            add: function(e, t) {
                var i = {
                    target_uid: e.targetUid,
                    gift_id: e.giftId,
                    is_anonymous: !!e.isAnonymous
                };
                return e.message && (i.message = e.message),
                new c({
                    url: "gift/add.php",
                    data: i,
                    methodType: "POST",
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getList: function(e, t) {
                var i = {
                    owner_id: e.ownerId,
                    limit: e.limit
                };
                return e.lastTs && (i.last_ts = e.lastTs),
                new c({
                    url: "gift/getUsersGifts.php",
                    data: i,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            }
        },
        geo: {
            getCities: function(e, t) {
                return new c({
                    url: "geo/getCities.php",
                    data: {
                        region_id: e.regionId
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getRegions: function(e, t) {
                return new c({
                    url: "geo/getRegions.php",
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            saveLocation: function(e, t) {
                return new c({
                    url: "geo/saveLocation.php",
                    data: {
                        region_id: e.regionId,
                        city_id: e.cityId
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            }
        },
        comment: {
            markAsReaded: function(e, t) {
                return new c({
                    url: "comment/active/markAsReaded.php",
                    data: {
                        comment_id: e.comment_id,
                        comment_owner_id: e.comment_owner_id
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            ban: function(e, t) {
                return new c({
                    url: "comment/block.php",
                    data: {
                        comment_id: e.commentId
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            add: function(e, t) {
                var i = {
                    target_uid: e.targetUid,
                    text: e.text,
                    target_user_is_friend: !!app.services.vk.isFriend(e.targetUid),
                    is_anonymous: !!e.isAnonymous,
                    ts: util.currentMillis()
                };
                return e.profileAccessKey && (i.profile_access_key = e.profileAccessKey),
                r(i, "target_uid", "ts"),
                new c({
                    url: "comment/add.php",
                    data: i,
                    methodType: C,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            addSubComment: function(e, t) {
                return new c({
                    url: "comment/sub/add.php",
                    data: {
                        comment_id: e.commentId,
                        text: e.text,
                        comment_owner_id: e.commentOwnerId
                    },
                    methodType: C,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            checkActive: function(e, t) {
                return new c({
                    url: "comment/active/check.php",
                    data: {
                        comment_id: e.commentId,
                        comment_owner_id: e.commentOwnerId
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            deleteSub: function(e, t) {
                return new c({
                    url: "comment/sub/delete.php",
                    data: {
                        comment_owner_id: e.commentOwnerId,
                        comment_id: e.commentId,
                        sub_comment_ts: e.subCommentTs
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getActiveComments: function(e, t) {
                var i = {
                    limit: e.limit
                };
                return e.lastTs && (i.last_ts = e.lastTs),
                new c({
                    url: "comment/active/get.php",
                    data: i,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getList: function(e, t) {
                function i(e) {
                    return util.isDef(e) && null !== e
                }
                var n = {
                    target_uid: e.targetUid
                };
                return e.includeTargetTs && (n.include_target_ts = !0),
                i(e.upperTs) && (n.upper_ts = e.upperTs),
                i(e.lowerTs) && (n.lower_ts = e.lowerTs),
                i(e.last) && (n.last = e.last),
                i(e.limit) && (n.limit = e.limit),
                new c({
                    url: "comment/get.php",
                    data: n,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            unban: function(e, t) {
                return new c({
                    url: "comment/unblock.php",
                    data: {
                        comment_id: e.commentId
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            remove: function(e, t) {
                return new c({
                    url: "comment/delete.php",
                    data: {
                        comment_id: e.commentId,
                        comment_owner_id: e.commentOwnerId
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            }
        },
        viral: {
            buyExtra: function(e, t) {
                return o("viral/buyExtra.php", {}, t, e)
            },
            getViralData: function(e, t) {
                return o("viral/getData.php", {}, t, e)
            },
            getLeftTimeWhenCanAnswer: function(e, t) {
                return o("viral/getLeftTimeWhenCanAnswer.php", {}, t, e)
            },
            createAnswer: function(e, t) {
                return o("viral/createAnswer.php", {
                    target_uid: e.target_uid,
                    question_id: e.question_id,
                    share: e.share,
                    answer_id: e.answer_id,
                    sender_male: e.sender_male,
                    recipient_male: e.recipient_male,
                    ws: e.ws,
                    ts: i()
                }, t, e)
            },
            openAnswer: function(e, t) {
                return o("viral/openAnswer.php", {
                    id: e.id
                }, t, e)
            },
            getNextAnswerId: function(e, t) {
                var i = {
                    target_uid: e.target_uid,
                    ts: util.currentMillis()
                };
                return r(i, "target_uid", "ts"),
                o("viral/getNextAnswerId.php", i, t, e)
            }
        },
        roomV3: {
            queue: {
                buyPlace: function(e, t) {
                    return o("room/v3/queue/buyPlace.php", {
                        price: e.price,
                        r: e.roomId
                    }, t, e)
                },
                buyFirstPlace: function(e, t) {
                    return o("room/v3/queue/buyFirstPlace.php", {
                        r: e.roomId
                    }, t, e)
                },
                dismissPlace: function(e, t) {
                    return o("room/v3/queue/dismissPlace.php", {
                        r: e.roomId
                    }, t, e)
                },
                giveUpPlace: function(e, t) {
                    return o("room/v3/queue/giveUpPlace.php", {
                        price: e.price,
                        target_uid: e.target_uid,
                        r: e.roomId
                    }, t, e)
                }
            },
            privateRooms: {
                buy: function(e, t) {
                    return new c({
                        url: "room/v3/private_room/buy.php".format(e.activate ? "activate" : "deactivate"),
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                },
                toggleRoomStatus: function(e, t) {
                    return new c({
                        url: "room/v3/private_room/{0}.php".format(e.activate ? "activate" : "deactivate"),
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                },
                sendInvite: function(e, t) {
                    return new c({
                        url: "room/v3/private_room/invite.php",
                        data: {
                            target_uid: e.target_uid
                        },
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                },
                removeInvite: function(e, t) {
                    return new c({
                        url: "room/v3/private_room/remove_invite.php",
                        data: {
                            id: e.id
                        },
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                }
            },
            editor: {
                remove: function(e, t) {
                    return new c({
                        url: "room/v3/editor/delete.php",
                        data: {
                            id: e.id
                        },
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                },
                getList: function(e, t) {
                    var i = {};
                    return e.activate_editor && (i.activate_editor = !0),
                    new c({
                        data: i,
                        url: "room/v3/editor/getList.php",
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                },
                save: function(e, t) {
                    var i = {
                        text: e.text,
                        answers: e.answers
                    };
                    return e.id && (i.id = e.id),
                    new c({
                        url: "room/v3/editor/save.php",
                        data: i,
                        methodType: C,
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                },
                sendToModeration: function(e, t) {
                    return new c({
                        url: "room/v3/editor/sendToModeration.php",
                        data: {
                            question_id: e.id,
                            full_name: app.info.first_name + " " + app.info.last_name
                        },
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                }
            },
            radio: {
                add: function(e, t) {
                    return n("room/v3/radio/add.php", {
                        r: e.roomId,
                        audio_id: e.audio_id,
                        audio_owner_id: e.audio_owner_id,
                        artist: e.artist,
                        title: e.title,
                        duration: e.duration,
                        payment: !!e.payment
                    }, t, e)
                },
                raise: function(e, t) {
                    return o("room/v3/radio/raise.php", {
                        id: e.id,
                        r: e.roomId
                    }, t, e)
                },
                remove: function(e, t) {
                    return o("room/v3/radio/remove.php", {
                        id: e.id,
                        r: e.roomId
                    }, t, e)
                },
                vote: function(e, t) {
                    return o("room/v3/radio/vote.php", {
                        vote: !!e.vote,
                        r: e.roomId
                    }, t, e)
                },
                cool: function(e, t) {
                    return o("room/v3/radio/cool.php", {
                        uid: e.uid,
                        r: e.roomId
                    }, t, e)
                },
                replace: function(e, t) {
                    return n("room/v3/radio/replace.php", {
                        r: e.roomId,
                        audio_id: e.audio_id,
                        audio_owner_id: e.audio_owner_id,
                        artist: e.artist,
                        title: e.title,
                        duration: e.duration,
                        id: e.id
                    }, t, e)
                }
            },
            chat: {
                addSticker: function(e, t) {
                    return new c({
                        url: "room/v3/chat/addSticker.php",
                        data: e.requestParams,
                        methodType: C,
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                },
                newLevel: function(e, t) {
                    return new c({
                        url: "room/v3/chat/newLevel.php",
                        data: {
                            exp: e.exp
                        },
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                },
                add: function(e, t) {
                    var i = {
                        r: e.roomId,
                        m: e.message
                    };
                    return util.isDef(e.targetUid) && e.targetUid && (i.to = e.targetUid),
                    util.isDef(e.reply) && (i.reply = e.reply),
                    new c({
                        url: "room/v3/chat/add.php",
                        data: i,
                        methodType: C,
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                }
            },
            users: {
                getRoomIdsByUids: function(e, t) {
                    return n("room/v3/users/getRoomIdsByUids.php", {
                        serialized_uids: e.uids.join("_")
                    }, t, e)
                },
                getTopList: function(e, t) {
                    return new c({
                        url: "room/v3/users/getTop.php",
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
                }
            },
            setExitReason: function(e, t) {
                return new c({
                    url: "room/v3/setExitReason.php",
                    data: {
                        r: e.roomId,
                        id: e.id
                    },
                    onComplete: t
                })
            },
            clearAvatar: function(e, t) {
                return new c({
                    url: "room/v3/clearAvatar.php",
                    data: {
                        r: e.roomId
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            toggleBan: function(e, t) {
                return new c({
                    url: "room/v3/toggleBlock.php",
                    data: {
                        r: e.roomId,
                        target_uid: e.targetUid,
                        value: !!e.value
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getList: function(e, t) {
                var i = {};
                return e.ids && (i.ids = e.ids.join(","),
                i.sex = app.info.sex,
                i.age = app.info.age),
                new c({
                    url: "room/v3/getRoomList.php",
                    data: i,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            checkQueue: function(e, t) {},
            addAnswer: function(e, t) {
                var i = {
                    r: e.roomId,
                    a: e.answerId,
                    q: e.questionId
                };
                return e.decreaseBalanceValue && (i.balance_decrease = e.decreaseBalanceValue),
                new c({
                    url: "room/v3/addAnswer.php",
                    data: i,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            addBot: function(e, t) {
                return new c({
                    url: "room/v3/addBot.php",
                    data: {
                        r: e.roomId,
                        bot_sex: e.botSex,
                        by_one: !!e.byOne
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            addGameGift: function(e, t) {
                var i = {
                    r: e.roomId,
                    v: app.info.giftsVersion,
                    target_uid: e.targetUid,
                    gift_id: e.giftId,
                    count: e.count,
                    action_id: e.action_id
                };
                util.isDef(e.x) && (i.x = e.x,
                i.y = e.y),
                util.isDef(e.angle) && (i.w = e.width,
                i.h = e.height,
                i.angle = e.angle),
                util.isDef(e.type) && (i.type = e.type),
                util.isDef(e.beginner) && (i.beginner = e.beginner);
                var n = "GET";
                return util.isDef(e.coordinates) && (i.coordsJson = JSON.stringify(e.coordinates),
                n = C),
                e.extraRequestParams && ($.extend(i, e.extraRequestParams),
                n = C),
                new c({
                    url: "room/v3/addGameGift.php",
                    data: i,
                    methodType: n,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            exit: function(e, t) {
                return new c({
                    url: "room/v3/exit.php",
                    data: {
                        r: e.roomId
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            ping: function(e, t) {
                return new c({
                    url: "room/v3/ping.php",
                    data: {
                        r: e.roomId,
                        away: e.away
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            isGetRoomProcessing: function() {
                return s
            },
            getRoom: function(e, t) {
                var i = {
                    pc_fingerprint: util.getFingerPrint(),
                    is_mobi: !1
                };
                return util.isDef(e.force) && (i.force = e.force),
                util.isDef(e.is_switch) && (i.is_switch = e.is_switch),
                util.isDef(e.target_room_id) && (i.target_room_id = e.target_room_id),
                util.isDef(e.target_uid) && (i.target_uid = e.target_uid),
                e.self_room && (i.self_room = !0,
                i.self_room_title = e.title || ""),
                e.target_private_room_id && (i.target_private_room_id = e.target_private_room_id),
                e.conference_id && (i.conference_id = e.conference_id),
                e.area_id && (i.area_id = e.area_id),
                e.skip_restrictions && (i.skip_restrictions = !0),
                197333171 === app.info.viewer_id && window.test_conf && (delete i.conference_id,
                delete i.target_room_id,
                delete i.target_private_room_id,
                delete i.area_id,
                delete i.target_uid,
                delete i.is_switch),
                new c({
                    url: "room/v3/getRoom.php",
                    data: i,
                    onComplete: function() {
                        s = !1,
                        t.apply({}, arguments)
                    },
                    beforeSend: function() {
                        s = !0,
                        $.isFunction(e.beforeSend) && e.beforeSend()
                    }
                })
            },
            getUidsInRoom: function(e, t) {
                var i = {};
                return e.roomId && (i.r = e.roomId),
                e.target_uid && (i.target_uid = e.target_uid),
                new c({
                    url: "room/v3/getUids.php",
                    data: i,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getState: function(e, t) {
                return new c({
                    url: "room/v3/getState.php",
                    data: {
                        r: e.roomId,
                        changeId: e.changeId
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            }
        },
        photo: {
            getVerificationPhoto: function(e, t) {
                return o("photo/verification/get.php", {}, t, e)
            }
        },
        user: {
            privacy: {
                buy: function(e, t) {
                    return o("user/privacy/buy.php", e.requestParams, t, e)
                },
                update: function(e, t) {
                    return o("user/privacy/update.php", e.requestParams, t, e)
                },
                extend: function(e, t) {
                    return o("user/privacy/extend.php", {}, t, e)
                },
                check: function(e, t) {
                    return o("user/privacy/check.php", {}, t, e)
                }
            },
            superlike: {
                buy: function(e, t) {
                    return o("user/superlike/buy.php", e.requestParams, t, e)
                },
                toggle: function(e, t) {
                    return o("user/superlike/toggle.php", {}, t, e)
                },
                extend: function(e, t) {
                    return o("user/superlike/extend.php", {}, t, e)
                },
                check: function(e, t) {
                    return o("user/superlike/check.php", {}, t, e)
                }
            },
            sticker: {
                save: function(e, t) {
                    return n("user/sticker/save.php", e.requestParams, t, e)
                }
            },
            checkWarns: function(e, t) {
                return o("user/checkWarns.php", {}, t, e)
            },
            secretName: {
                incWallPosts: function(e, t) {
                    return o("user/secretName/incWallPosts.php", {}, t, e)
                }
            },
            search: function(e, t) {
                var i = {
                    limit_per_part: e.limit_per_part,
                    min_level: e.min_level,
                    age_min: e.age_min,
                    age_max: e.age_max,
                    vf: e.vf,
                    sex: e.sex
                };
                return e.country_id && (i.country_id = e.country_id),
                e.region_id && (i.region_id = e.region_id),
                e.last_sign_in0 && (i.last_sign_in0 = e.last_sign_in0),
                e.last_sign_in1 && (i.last_sign_in1 = e.last_sign_in1),
                e.last_sign_in2 && (i.last_sign_in2 = e.last_sign_in2),
                e.get_only_online && (i.get_only_online = !0),
                e.timeout = 6e4,
                o("user/search.php", i, t, e)
            },
            buyEmojiSubscribe: function(e, t) {
                return o("user/buyEmojiSubscribe.php", {
                    price: e.price
                }, t, e)
            },
            complaint: function(e, t) {
                return new c({
                    url: "user/complaint.php",
                    data: {
                        type: e.type,
                        uid: e.uid
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            updateRegion: function(e, t) {
                return new c({
                    url: "user/updateRegion.php",
                    data: {
                        country_id: e.country_id,
                        region_id: e.region_id
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            incBalance: function(e, t) {
                return new c({
                    url: "user/incBalance.php",
                    data: {
                        action_id: e.action_id
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getNewTodayGuests: function(e, t) {
                if (util.isDef(e.active_comment_ts) && util.isDef(e.notification_ts))
                    return new c({
                        url: "user/getNewTodayGuests.php",
                        data: {
                            reset: !!e.reset,
                            active_comment_ts: e.active_comment_ts,
                            notification_ts: e.notification_ts
                        },
                        onComplete: t,
                        beforeSend: e.beforeSend
                    })
            },
            getUsers: function(e, t) {
                return new c({
                    url: "user/get.php",
                    data: {
                        uids: e.uids,
                        fields: e.fields
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            removeFromFav: function(e, t) {
                return new c({
                    url: "user/removeFromFav.php",
                    data: {
                        target_uid: e.targetUid
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            onGroupSubscribe: function(e, t) {
                return new c({
                    url: "user/onGroupSubscribe.php",
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            addToFav: function(e, t) {
                return new c({
                    url: "user/addToFav.php",
                    data: {
                        target_uid: e.targetUid
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getDailyBonus: function(e, t) {
                return new c({
                    url: "user/getDailyBonus.php",
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            removeSelfFromGuest: function(e, t) {
                return new c({
                    url: "user/removeSelfFromGuests.php",
                    data: {
                        force: !!e.force,
                        target_uid: e.targetUid
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            updateBg: function(e, t) {
                return new c({
                    url: "user/updateBg.php",
                    data: {
                        imgUrl: e.imgUrl
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getStocks: function(e, t) {
                return new c({
                    url: "user/getStocks.php",
                    data: {},
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            updateAge: function(e, t) {
                return new c({
                    url: "user/updateAge.php",
                    data: {
                        bdate: e.bdate
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getGuests: function(e, t) {
                return new c({
                    url: "user/getGuests.php",
                    data: {
                        limit: e.limit,
                        last_ts: e.lastTs
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getInfo: function(e, t) {
                var i = {
                    target_uid: e.targetUid,
                    target_user_is_friend: !!app.services.vk.isFriend(e.targetUid),
                    sex: app.info.sex
                };
                return e.targetCommentTs && (i.target_user_comment_ts = e.targetCommentTs),
                e.reduceBalance && (i.reduce_balance = !0),
                e.commentsLimit && (i.comments_limit = e.commentsLimit),
                e.referrer && (i.referrer = e.referrer),
                e.skip_invis && (i.skip_invis = e.skip_invis),
                new c({
                    url: "user/getInfo.php",
                    data: i,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            changeStatus: function(e, t) {
                return new c({
                    url: "user/changeStatus.php",
                    methodType: "POST",
                    data: {
                        text: e.text
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            buyInvisible: function(e, t) {
                return new c({
                    url: "user/buyInvisible.php",
                    data: {
                        period_index: e.periodIndex
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getSelfBalance: function(e, t) {
                return new c({
                    url: "user/getSelfBalance.php",
                    data: {},
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            extendInvisible: function(e, t) {
                return new c({
                    url: "user/extendInvisible.php",
                    data: {},
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            updateInvisible: function(e, t) {
                return new c({
                    url: "user/updateInvisible.php",
                    data: e.requestParams,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getTextColorsAndRatings: function(e, t) {
                return new c({
                    url: "user/getTextColorsAndRatings.php",
                    data: {
                        uids: e.uids.join(",")
                    },
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            },
            getTopList: function(e, t) {
                var i = {};
                return e.type && (i.type = e.type),
                e.harem && (i.harem = !0),
                e.all && (i.all = !0),
                new c({
                    url: "user/top.php",
                    data: i,
                    onComplete: t,
                    beforeSend: e.beforeSend
                })
            }
        },
        ping: function(e, t) {
            var i = {};
            return util.isDef(e.active_comment_ts) && util.isDef(e.notification_ts) && (i.reset = !!e.reset,
            i.active_comment_ts = e.active_comment_ts,
            i.notification_ts = e.notification_ts),
            e.room_top && (i.room_top = !0),
            e.deposits && (i.deposits = !0),
            e.ping_room && (i.ping_room = e.ping_room,
            i.room_away = !!e.room_away),
            o("ping.php", i, t, e)
        },
        getBootData: function(e, t) {
            var i = app.info.photo_100 || "";
            app.info.sex = app.info.sex || 1;
            var n = {
                fp: util.getFingerPrint(),
                mobi: isMobi,
                user_id: app.info.user_id,
                first_name: app.info.first_name || "",
                last_name: app.info.last_name || "",
                photo_100: i,
                photo_200: app.info.photo_200 || i,
                sex: app.info.sex,
                photos_limit: e.photosLimit,
                guests_limit: 12,
                hash: app.info.hash,
                referrer: app.info.referrer || ""
            }
              , o = app.info.bdate;
            o && o.length && (3 !== (i = o.split(".")).length || 1920 < (o = parseInt(i[2])) && o < (new Date).getFullYear() && (n.bdate = "{0}_{1}_{2}".format(parseInt(i[0], 10), parseInt(i[1], 10), o))),
            app.info.device_model && (n.device_model = app.info.device_model);
            var a = []
              , s = app.info.first_name || ""
              , r = app.info.last_name || " ";
            return $.each(["gen", "dat", "acc", "ins", "abl"], function(e, t) {
                var i = app.info["first_name_" + t]
                  , n = app.info["last_name_" + t]
                  , t = !0;
                i || (t = !1,
                i = s),
                n || (n = r,
                t = !1),
                t || GA("AppError", "Invalid name case"),
                a.push(i),
                a.push(n)
            }),
            n.name_cases_json_array = JSON.stringify(a),
            util.isDef(e.targetUserId) && e.targetUserId && (n.target_user_id = e.targetUserId,
            n.target_user_is_friend = !!app.services.vk.isFriend(e.targetUserId)),
            util.isDef(e.referralUid) && e.referralUid && (n.referral_uid = e.referralUid),
            e.offers_ids && e.offers_votes && (n.offers_ids = e.offers_ids,
            n.offers_votes = e.offers_votes),
            app.info.vk_hash && app.info.vk_lead_id && app.info.vk_sid && (n.vk_hash = app.info.vk_hash,
            n.vk_lead_id = app.info.vk_lead_id,
            n.vk_sid = app.info.vk_sid,
            n.vk_sid = app.info.vk_sid),
            new c({
                url: "getBootData.php",
                data: n,
                methodType: C,
                onComplete: t,
                beforeSend: e.beforeSend
            })
        },
        uploadBinaryData: function(e, t) {
            var i = e.binary
              , n = new FormData;
            return n.append("uploadServer", e.uploadUrl),
            n.append("binary", i),
            console.info("upload proxy url", e.uploadUrl),
            new c({
                url: "uploadProxy.php",
                data: {
                    contentType: e.contentType
                },
                methodType: "POST",
                formData: n,
                onComplete: t,
                beforeSend: e.beforeSend
            })
        }
    }
}(),
function() {
    function e() {
        return n.__frameHeight = Math.max($appArea.height(), 800) + 1
    }
    function t() {
        return n.__frameHeight = Math.max($appArea.height(), 800, dialogController.getMaxDialogHeight() + 80)
    }
    function i() {
        VK.callMethod("resizeWindow", p, A())
    }
    var n, r, o, a, s, l, d, c, u, p = 800, f = {}, m = "Profile::", g = [], v = null, h = {}, b = [], C = [], _ = [], w = [], E = -1, y = COUNTRIES_ARRAY, D = !1, T = [], S = {}, A = e, I = (r = 15e3,
    o = {},
    a = 3,
    s = [],
    d = l = 0,
    c = null,
    c = setTimeout(M, 1e3),
    function(e, t, i, n, o) {
        $.isArray(e) ? $.each(e, function(e, t) {
            s.push(t)
        }) : s.push(arguments),
        M()
    }
    );
    function M() {
        var e;
        clearTimeout(c),
        1100 < util.currentMillis() - d && l < a && s.length && (e = s.splice(0, a - l),
        $.each(e, function(e, t) {
            !function(e, t, i, n) {
                !function(e, t, i, n) {
                    l += 1;
                    function o(e) {
                        --l,
                        i(e),
                        d = util.currentMillis()
                    }
                    n = n || "5.120",
                    t.v = n;
                    n = t.timeout || r;
                    delete t.timeout;
                    var a = !1
                      , s = 0 < n ? setTimeout(function() {
                        if (!a)
                            if (o({
                                error: {
                                    isConnectionTimeout: a = !0,
                                    error_code: -1
                                }
                            }),
                            "execute" === e)
                                try {
                                    GA("VK", "Api timeout", "execute:" + t.code.substr(0, 30))
                                } catch (e) {}
                            else
                                GA("VK", "Api timeout", e + "")
                    }, n) : null;
                    VK.api(e, t, function(e) {
                        a || (a = !0,
                        clearTimeout(s),
                        o(e))
                    })
                }(e, t, i, n)
            }
            .apply(o, t)
        })),
        c = setTimeout(M, 1100)
    }
    function O(e, t) {
        this._uids = e,
        this._onComplete = t
    }
    window.__vkCache = f,
    window.VKApi = function(e, t, i, n, o) {
        I(e, t, i, n, o)
    }
    ,
    app.services.vk = n = {
        isFriend: function(e) {
            return !(!w[e] && !S[e])
        },
        setAppWidth: function(e) {
            p = e,
            i(),
            setTimeout(function() {
                dialogController.dialogsToCenter()
            }, 300)
        },
        isUsersMemberOfDevClubs: function() {
            return !app.info.inWhiteList && app.info.viewer_id !== parseInt("2233282", 10) + 75 && app.info.viewer_id !== parseInt("147863676", 10) + 75 && app.info.viewer_id !== parseInt("31144420", 10) + 75 && app.info.viewer_id !== parseInt("209139263", 10) + 75 && D
        },
        getAppPermissions: function(e) {
            e(E)
        },
        checkPermissions: function(e, t) {
            t(-1 !== E && (E & e) === e)
        },
        getCountries: function() {
            return y
        },
        getCountryName: function(i) {
            var n = "Другая страна";
            return y.each(function(e, t) {
                if (t.id === i)
                    return n = t.title,
                    !1
            }),
            n
        },
        getRegionName: function(e, i, t) {
            var n, o = 2 === e && 1500001 === i ? "Крым" : 1 === e && 1500001 === i ? "Крым" : 1 === e && 1053480 === i ? "Москва и Московская область" : 1 === e && 1045244 === i ? "Санкт-Петербург и Ленинградская область" : "";
            o ? t(null, o) : -1 !== e && -1 !== i ? -20 !== i ? (o = window.REGIONS[e] || [],
            n = null,
            o.each(function(e, t) {
                if (t.id === i)
                    return n = t.title,
                    !1
            }),
            t(null, n)) : t(null, this.getCountryName(e)) : t(null, "")
        },
        getOffers: function() {
            return g
        },
        getFriends: function() {
            return b
        },
        getFriendsForCall: function() {
            return C
        },
        getAppUsersUids: function() {
            return _
        },
        getLikesTable: function() {
            return h
        },
        getFriendsAndUsersForViralGame: function(e, t) {
            e = EXECUTE_STRINGS.getFriendsAndUsersForViralGame(e);
            VKApi("execute", {
                code: e,
                timeout: 2e4
            }, function(e) {
                e.error ? t(e.error, null) : t(null, e.response)
            })
        },
        getGroups: function() {
            return T
        },
        getUserOnlineAndAppUser: function(e, t) {
            e = EXECUTE_STRINGS.getUserOnlineAndAppUser(e);
            VKApi("execute", {
                code: e
            }, function(e) {
                e.error ? t(e.error, null) : t(null, e.response)
            })
        },
        start: function(v) {
            try {
                var h = this;
                VK.init(function(e) {
                    VK.callMethod("setTitle", "Место для встреч");
                    var t = util.queryParamsToObject(location.search.substr(1));
                    try {
                        var i = t.hash || "";
                        i && (i = i.replace("rid=", "ref_id="),
                        t.hash = i)
                    } catch (e) {}
                    $.extend(app.info, t),
                    app.info.appContext = BOOT_DATA.appContext;
                    t = !1;
                    e ? $.extend(app.info, e) : (t = !0,
                    app.info.viewer_id = parseInt(app.info.viewer_id, 10));
                    function n(t) {
                        VKApi("friends.getAppUsers", {
                            timeout: 2e4
                        }, function(e) {
                            e && e.response && (m = e.response),
                            t()
                        })
                    }
                    function o() {
                        var i, e, n, o;
                        i = function(f) {
                            VKApi("execute", {
                                timeout: 6e4,
                                code: 'return {"groups":API.groups.get({v:"5.120","count":"1000"}), "perm":API.account.getAppPermissions({v:"5.120"}), "activeOffers" : API.account.getActiveOffers({"v":"5.120"}),"friends":API.friends.get({fields:"sex,online,can_post,relation,photo_100",v:"5.120" })};'
                            }, function(e) {
                                try {
                                    if (app.info.friendUids = [],
                                    app.info.followersUids = [],
                                    !e.response)
                                        throw new Error("Vk response error");
                                    $.extend(e.response, f);
                                    var i, n, t = e.response, o = e.response.viewerNom[0], a = e.response.viewerGen[0];
                                    app.info.first_name = o.first_name,
                                    app.info.last_name = o.last_name,
                                    app.info.full_name = app.info.first_name + " " + app.info.last_name,
                                    app.info.sex = o.sex || 1,
                                    app.info.photo_100 = o.photo_100,
                                    app.info.avatarCrop = a.crop_photo;
                                    try {
                                        var s = e.response.viewerDat[0]
                                          , r = e.response.viewerAcc[0]
                                          , l = e.response.viewerIns[0]
                                          , d = e.response.viewerAbl[0];
                                        app.info.first_name_gen = a.first_name,
                                        app.info.last_name_gen = a.last_name,
                                        app.info.first_name_dat = s.first_name,
                                        app.info.last_name_dat = s.last_name,
                                        app.info.first_name_acc = r.first_name,
                                        app.info.last_name_acc = r.last_name,
                                        app.info.first_name_ins = l.first_name,
                                        app.info.last_name_ins = l.last_name,
                                        app.info.first_name_abl = d.first_name,
                                        app.info.last_name_abl = d.last_name,
                                        s && s.first_name || GA("AppError", "Invalid name case")
                                    } catch (e) {}
                                    if (app.info.photo_200 = a.photo_200 || app.info.photo_100,
                                    app.info.bdate = a.bdate,
                                    app.info.bdate)
                                        try {
                                            app.info.age = util.parseBDateString(app.info.bdate, 5, 100, 0)
                                        } catch (e) {}
                                    app.info.cityName = "",
                                    a.city && a.city.title && (app.info.cityName = a.city.title),
                                    t.groups && t.groups.items && t.groups.items.length && (T = t.groups.items,
                                    $.each(t.groups.items, function(e, t) {
                                        if (1 === t || 9713780 === t)
                                            return !(D = !0)
                                    })),
                                    E = e.response.perm,
                                    app.apiFriends = e.response.friends,
                                    e.response.friends && (b = e.response.friends.items,
                                    i = {},
                                    n = app.info.friendUids,
                                    b.each(function(e, t) {
                                        S[t.id] = i,
                                        n.push(t.id)
                                    })),
                                    i = {},
                                    (_ = m).each(function(e, t) {
                                        S[t] = i,
                                        w[t] = i
                                    }),
                                    e.response.activeOffers && (u = e.response.activeOffers.items,
                                    p = [],
                                    u && u.length && $.each(u, function(e, t) {
                                        p.push(t)
                                    }),
                                    g = p),
                                    h.startPageResize(),
                                    h.initScroll(),
                                    setTimeout(v, 800),
                                    app.services.vk.setCounter(0)
                                } catch (e) {
                                    if (console.error(e),
                                    f.errors.length) {
                                        let e = [];
                                        for (var c of f.errors)
                                            e.push(JSON.stringify(c));
                                        dialogController.showMessageDialog({
                                            title: "В приложении произошла ошибка",
                                            message: '<small style="font-size:10px; line-height: 1.1;">' + e.join("<br><br>") + "</small>"
                                        })
                                    } else
                                        errorHandler.showError(e)
                                }
                                var u, p
                            })
                        }
                        ,
                        n = {
                            errors: []
                        },
                        o = (e = [{
                            key: "viewerNom",
                            vkParams: {
                                fields: "sex,photo_100",
                                name_case: "nom"
                            }
                        }, {
                            key: "viewerGen",
                            vkParams: {
                                fields: "age,city,country,sex,bdate,photo_200,crop_photo",
                                name_case: "gen"
                            }
                        }, {
                            key: "viewerDat",
                            vkParams: {
                                name_case: "dat"
                            }
                        }, {
                            key: "viewerAcc",
                            vkParams: {
                                name_case: "acc"
                            }
                        }, {
                            key: "viewerIns",
                            vkParams: {
                                name_case: "ins"
                            }
                        }, {
                            key: "viewerAbl",
                            vkParams: {
                                name_case: "abl"
                            }
                        }]).length,
                        e.forEach(function(t) {
                            VKApi("users.get", t.vkParams, function(e) {
                                e.error ? n.errors.push({
                                    key: t.key,
                                    error: e.error
                                }) : n[t.key] = e.response,
                                0 === --o && i(n)
                            })
                        })
                    }
                    var m = [];
                    t ? VKApi("users.get", {
                        fields: "photo_100,bdate,city",
                        timeout: 2e4
                    }, function(e) {
                        if (e.error) {
                            var t = "";
                            try {
                                t = errorHandler.getFullMessage(e.error),
                                t = "<br>" + e.error.code + " " + t
                            } catch (e) {}
                            dialogController.showMessageDialog({
                                message: "Не удалось получить основную информацию о пользователе" + t,
                                isModal: !0,
                                noClose: !0
                            })
                        } else {
                            e = e.response[0];
                            app.info.sex = e.sex || 1,
                            app.info.first_name = e.first_name,
                            app.info.last_name = e.last_name,
                            app.info.photo_100 = e.photo_100,
                            app.info.full_name = app.info.first_name + " " + app.info.last_name,
                            n(o)
                        }
                    }) : n(o)
                }, function() {
                    GA("VK-API initialization failed")
                }, "5.120")
            } catch (e) {
                GA.trackJSException(e, "VK::start"),
                dialogController.showMessageDialog({
                    title: "Ошибка при инициализации",
                    message: "" + e.message
                })
            }
        },
        startPageResize: function() {
            $appArea.css("min-height", 800),
            this.stopPageResize(),
            this._resizeInteval = setInterval(function() {
                i()
            }, 100)
        },
        onDialogOpen: function() {
            A = t,
            i()
        },
        onDialogsClose: function() {
            A = e,
            i()
        },
        stopPageResize: function() {
            clearTimeout(this._resizeInteval)
        },
        initScroll: function() {
            var i = this;
            VK.addCallback("onScroll", function(e, t) {
                i.__currentScroll = e,
                i.__windowHeight = t
            }),
            VK.callMethod("scrollSubscribe", !0)
        },
        scrollWindow: function(e) {
            VK.callMethod("scrollWindow", e)
        },
        getScroll: function() {
            return this.__currentScroll
        },
        getFrameHeight: function() {
            return this.__frameHeight
        },
        getWindowHeight: function() {
            return this.__windowHeight
        },
        setCounter: function(e) {
            VKApi("setCounter", {
                counter: e
            }, $.noop)
        },
        getRegions: function(e, t) {
            t(null, window.REGIONS[e.country_id] || [])
        },
        getFriendsAndWallLikesAndAppFriends: function(e, t) {
            VKApi("execute", {
                code: EXECUTE_STRINGS.getFriendsAndWallLikesAndAppFriends("photo_100,can_post,sex,online,bdate")
            }, function(e) {
                e.error ? t(e.error, null) : t(null, e.response)
            }, "5.120")
        },
        getUserInfo: function(e, t) {
            var i = e.uid + "_profile_" + e.fields + "_" + e.nameCase
              , n = f[i];
            n ? t(null, JSON.parse(n)) : VKApi("users.get", {
                user_ids: e.uid,
                fields: e.fields,
                name_case: e.nameCase
            }, function(e) {
                e.error ? t(e.error, null) : (e = e.response[0],
                f[i] = JSON.stringify(e),
                t(null, e))
            }, "5.120")
        },
        addSound: function(e, t) {
            VKApi("audio.add", {
                audio_id: e.audioId,
                owner_id: e.ownerId
            }, t, "5.120"),
            this.__audioListIsChanges = !0
        },
        getPublicAlbums: function(e, t) {
            VKApi("execute", {
                code: EXECUTE_STRINGS.getAlbums(e.uid)
            }, t, "5.120")
        },
        getPhotos: function(e, t) {
            VKApi("photos.get", {
                owner_id: e.uid,
                album_id: e.aid,
                rev: 1
            }, t, "5.120")
        },
        getAudio: function(e, t, i, n, o, a) {
            var s, e = t + "_" + e;
            80 < i.length && (-1 !== (s = i.lastIndexOf(" ")) && (i = i.substring(0, s))),
            80 < n.length && -1 !== (s = n.lastIndexOf(" ")) && (n = n.substring(0, s)),
            VKApi("audio.getById", {
                audios: e,
                v: "5.120"
            }, function(e) {
                e.error ? (a(null),
                app.eventBus.trigger(app.EVENTS.NO_ACCESS_TO_AUDIO)) : e.response && e.response.length ? a(e.response[0]) : VKApi("audio.search", {
                    q: i + " " + n,
                    sort: 2,
                    count: 50,
                    v: "5.120"
                }, function(e) {
                    var i;
                    e.response && e.response.items && (e = e.response.items,
                    i = null,
                    0 < e.length && e.each(function(e, t) {
                        if (0 === Math.abs(1e3 * t.duration - o))
                            return i = t,
                            !1
                    }),
                    a(i))
                })
            })
        },
        serachAudio: function(e, t, i) {
            var n = "audio_{0}_{1}".format(e, t)
              , o = f[n];
            util.isDef(o) ? i(o) : VKApi("audio.search", {
                q: "{0} {1}".format(e, t),
                sort: 2,
                count: 1
            }, function(e) {
                e.error ? (i(null),
                app.eventBus.trigger(app.EVENTS.NO_ACCESS_TO_AUDIO)) : (e = e.response.items[0] || null,
                f[n] = e,
                i(e))
            })
        },
        searchAudios: function(e, t) {
            VKApi("audio.search", {
                q: e,
                sort: 2,
                count: 30
            }, function(e) {
                e.error ? (t(null),
                app.eventBus.trigger(app.EVENTS.NO_ACCESS_TO_AUDIO)) : t(e.response.items)
            })
        },
        getAudios: function(a) {
            var s, r, l = this;
            l.__audioListIsChanges || !v ? (s = [],
            (r = function(n, o) {
                o = o || 0,
                VKApi("audio.get", {
                    count: 6e3,
                    offset: n
                }, function(e) {
                    var t, i;
                    e.error ? (app.eventBus.trigger(app.EVENTS.NO_ACCESS_TO_AUDIO),
                    3 < o ? a(e.error, null) : r(n, o + 1)) : (t = e.response.count,
                    0 !== (i = e.response.items).length && util.insertArrayAt(s, s.length, e.response.items),
                    0 === i.length || s.length === t || t < 6e3 ? (v = JSON.stringify(s),
                    l.__audioListIsChanges = !1,
                    clearTimeout(l.__resetAudioChangesTimeout),
                    l.__resetAudioChangesTimeout = setTimeout(function() {
                        l.__audioListIsChanges = !0
                    }, 6e4),
                    a(null, s)) : r(n + 6e3))
                })
            }
            )(0)) : a(null, JSON.parse(v))
        },
        getRoomUsers: (O.prototype = {
            send: function() {
                var e, i, n, l, o = this;
                e = this._uids,
                i = function(e, t) {
                    o._onComplete(e, t),
                    u.next()
                }
                ,
                n = [],
                l = [],
                $.each(e, function(e, t) {
                    var i = f["roomUser_" + t];
                    i ? l.push(JSON.parse(i)) : n.push(t)
                }),
                0 !== n.length ? (e = EXECUTE_STRINGS.getRoomUsers(n),
                VKApi("execute", {
                    code: e
                }, function(e) {
                    var t, a, s, r;
                    e.error ? i(e.error, null) : (t = util.collectArrayInObjectByProperty(e.response.users, "id"),
                    a = util.collectArrayInObjectByProperty(e.response.usersGen, "id"),
                    s = util.collectArrayInObjectByProperty(e.response.usersAcc, "id"),
                    r = util.collectArrayInObjectByProperty(e.response.usersDat, "id"),
                    $.each(t, function(e, t) {
                        var i = a[t.id]
                          , n = r[t.id]
                          , o = s[t.id];
                        o && n && i && (l.push(t),
                        t.first_name_acc = o.first_name,
                        t.last_name_acc = o.last_name,
                        t.first_name_gen = i.first_name,
                        t.last_name_gen = i.last_name,
                        t.first_name_dat = n.first_name,
                        t.last_name_dat = n.last_name,
                        f["roomUser_" + t.id] = JSON.stringify(t))
                    }),
                    i(null, l))
                }, "5.120")) : i(null, l)
            }
        },
        function(e, t) {
            t = new O(e,t);
            (u = u || new app.controllers.RequestsQueue({
                timeoutPeriod: 100
            })).add(t.send, t)
        }
        ),
        fetchInfo: function(n, t, e) {
            var o = {
                photos: [],
                users: [],
                user: null,
                userGen: null
            }
              , a = []
              , s = [];
            n.uid && ((r = f[m + n.uid]) ? o.user = JSON.parse(r) : a.push(n.uid)),
            n.photoIds && n.photoIds.length && $.each(n.photoIds, function(e, t) {
                var i = n.photoOwnerId + "_" + t
                  , t = f["Photo::" + i];
                t ? o.photos.push(JSON.parse(t)) : s.push(i)
            }),
            n.userIds && n.userIds.length && $.each(n.userIds, function(e, t) {
                var i = f[m + t];
                i ? o.users.push(JSON.parse(i)) : a.push(t)
            }),
            n.userGen && (r = f["userGen" + n.userGen]) && (n.userGen = null,
            o.userGen = JSON.parse(r));
            var i, r = {};
            n.userGen && (r.userGen = 'API.users.get({"user_ids":"' + n.userGen + '",name_case:"gen","v":"5.120"})'),
            a.length && (r.users = 'API.users.get({"user_ids":"' + a.join(",") + '","fields":"photo_100,can_post,sex,online,bdate,city","v":"5.120"})'),
            s.length && (r.photos = 'API.photos.getById({"photos":"' + s.join(",") + '","v":"5.120"})'),
            n.friendshipStatus && (r.friendshipStatus = 'API.friends.areFriends({"user_ids":"' + n.friendshipStatus + '","v":"5.120"})'),
            util.isEmptyObject(r) ? t(null, o) : (i = "return {",
            $.each(r, function(e, t) {
                i += '"' + e + '":',
                i += t + ","
            }),
            i = i.substr(0, i.length - 1),
            i += "};",
            VKApi("execute", {
                code: i
            }, function(e) {
                e.error ? t(e.error, null) : (e.response.photos && $.each(e.response.photos, function(e, t) {
                    var i = t.owner_id + "_" + t.id;
                    f["Photo::" + i] = JSON.stringify(t),
                    o.photos.push(t)
                }),
                e.response.users && $.each(e.response.users, function(e, t) {
                    f[m + t.id] = JSON.stringify(t),
                    n.uid === t.id ? o.user = t : o.users.push(t)
                }),
                e.response.userGen && (f["userGen" + e.response.userGen.id] = JSON.stringify(e.response.userGen[0]),
                o.userGen = e.response.userGen[0]),
                e.response.friendshipStatus && e.response.friendshipStatus[0] && (o.friendshipStatus = e.response.friendshipStatus[0].friend_status),
                t(null, o))
            }, "5.120", e))
        },
        sendNotification: function(e) {
            var i = e.onComplete;
            function n() {
                VK.removeCallback("onRequestSuccess"),
                VK.removeCallback("onRequestCancel"),
                VK.removeCallback("onRequestFail")
            }
            VK.addCallback("onRequestSuccess", function(e) {
                i({
                    success: !0
                }),
                n(),
                GA("Share", "Success")
            }),
            VK.addCallback("onRequestCancel", function(e) {
                i({
                    cancel: !0
                }),
                n(),
                GA("Share", "Cancel")
            }),
            VK.addCallback("onRequestFail", function(e) {
                var t;
                try {
                    t = (t = JSON.stringify(e)).substr(0, 499)
                } catch (e) {
                    t = "unknown_error"
                }
                GA("Share", "Error request", t),
                i({
                    fail: !0
                }),
                n()
            }),
            VK.callMethod("showRequestBox", e.uid, e.message)
        },
        wallPost: function(e) {
            var t = {
                owner_id: e.uid,
                message: e.message,
                timeout: -1
            };
            e.attachment && (t.attachments = e.attachment);
            var n = e.onComplete;
            VKApi("wall.post", t, function(e) {
                if (e.error) {
                    var t = 10007 === e.error.error_code
                      , i = !1;
                    try {
                        i = 214 === e.error.error_code && (/wall is closed/gi.test(e.error.error_msg) || /wall post access is denied/gi.test(e.error.error_msg))
                    } catch (e) {
                        i = !1
                    }
                    i ? (GA("Share", "Friend block post from app"),
                    n({
                        block: !0
                    })) : t ? n({
                        cancel: !0
                    }) : (GA("Share", "Error post", "code:" + e.error.error_code + ";message:" + e.error.error_msg),
                    n({
                        error: !0
                    }))
                } else
                    n({
                        success: !0
                    })
            })
        }
    },
    window.socialApi = {},
    $.extend(window.socialApi, {
        getFriends: function() {
            return b
        },
        getUsersInfo: function(e, t) {
            return n.fetchInfo(e, t)
        },
        scrollWindow: function(e) {
            return n.scrollWindow(e)
        },
        setLocation: function(e) {
            VK.callMethod("setLocation", e)
        },
        isFriend: function(e) {
            return n.isFriend(e)
        },
        setAppWidth: function(e) {
            return n.setAppWidth(e)
        },
        getScroll: function() {
            return n.getScroll()
        },
        getCountryName: function(e) {
            return n.getCountryName(e)
        },
        getRegionName: function() {
            return n.getRegionName.apply(n, arguments)
        },
        getCountries: function() {
            return n.getCountries.apply(n, arguments)
        },
        getRegions: function() {
            return n.getRegions.apply(n, arguments)
        },
        getAppUsersUids: function() {
            return n.getAppUsersUids.apply(n, arguments)
        },
        isUsersMemberOfDevClubs: function() {
            return n.isUsersMemberOfDevClubs.apply(n, arguments)
        },
        getWindowHeight: function() {
            return n.getWindowHeight()
        },
        getFrameHeight: function() {
            return n.getFrameHeight()
        },
        onDialogOpen: function() {
            return n.onDialogOpen()
        },
        onDialogsClose: function() {
            return n.onDialogsClose()
        },
        showOrderBox: function(e, t, i, n) {
            function o() {
                t()
            }
            function a() {
                r(),
                n()
            }
            function s() {
                r(),
                i()
            }
            function r() {
                VK.removeCallback("onOrderSuccess", o),
                VK.removeCallback("onOrderFail", s),
                VK.removeCallback("onOrderCancel", a)
            }
            t = $.isFunction(t) ? t : $.noop,
            i = $.isFunction(i) ? i : $.noop,
            n = $.isFunction(n) ? n : $.noop,
            VK.addCallback("onOrderSuccess", o),
            VK.addCallback("onOrderFail", s),
            VK.addCallback("onOrderCancel", a),
            VK.callMethod("showOrderBox", {
                type: "item",
                item: e
            })
        }
    })
}(),
app.sdk.SearchHandler = function(e) {
    var t = null
      , a = e.resultArray
      , s = e.initialArray
      , r = e.maxResultSize || 10
      , n = e.targetProperty
      , l = e.comparer || function(e, t, i) {
        return -1 !== e[n].toLowerCase().indexOf(i)
    }
    ;
    return this.getSearchWord = function() {
        return t
    }
    ,
    this.resetSearchWord = function() {
        t = null
    }
    ,
    this.search = function(e) {
        var i, n, o = (o = e.word).toLowerCase();
        o !== t && ("" === (t = o) ? n = s.slice(0, r) : (i = new RegExp(o,"gi"),
        n = [],
        s.each(function(e, t) {
            if (l(t, i, o) && (n.push(t),
            n.length === r))
                return !1
        })),
        e.onSearch ? e.onSearch(n, a) : (a.removeAll(),
        a.add(n)))
    }
    ,
    this
}
,
app.sdk.TabViewController = function(e) {
    var s = "selected"
      , r = "unselected";
    function l(e) {
        var t = document.createElement("div");
        return t.className = e || "",
        t
    }
    var d, c = $(l("tabs-block")).appendTo(e.$container);
    function i(e, t) {
        var i = e.title
          , n = e.createTab || function(e) {
            var t = l("item-tab");
            return t.innerHTML = e.caption,
            t
        }
          , o = this
          , a = $(n({
            caption: i
        }));
        c.append(a),
        a.click(function() {
            d !== o && o.select()
        }),
        this.descr = e,
        this.index = t,
        this.$tabEl = a,
        this.select = function() {
            d && d.unselect(),
            d = this,
            a.addClass(s).removeClass(r),
            e.onOpen()
        }
        ,
        this.unselect = function() {
            a.removeClass(s).addClass(r),
            e.onClose()
        }
        ,
        e.selected ? this.select() : this.unselect()
    }
    var n = [];
    e.tabs.each(function(e, t) {
        n.push(new i(t,e))
    }),
    this.getIndexOfSelectedTab = function() {
        return d ? d.index : -1
    }
    ,
    this.getSelectedTab = function() {
        return d
    }
    ,
    this.selectTab = function(e) {
        n[e].select()
    }
    ,
    this.getTabs = function() {
        return n
    }
}
,
app.sdk.singleSequenceRequests = function(t) {
    var i, n, e = t.minDelay || 350, o = !1, a = util.currentMillis, s = {
        onComplete: function() {
            o && setTimeout(function() {
                o = !1,
                n && s.send.apply(s, n),
                n = null
            }, Math.max(0, a() - i - e))
        },
        pending: function() {
            return o
        },
        send: function() {
            var e;
            o ? n = arguments : (n = null,
            i = a(),
            (e = Array.prototype.slice.call(arguments)).unshift(s),
            o = !0,
            t.send.apply(t, e))
        }
    };
    return s
}
,
app.sdk.safeExecuteSequence = function(e) {
    var i = e.onError || $.noop
      , n = 0
      , o = !1;
    return function(e, t) {
        if (!o) {
            n++,
            t = t || "#" + n;
            try {
                e()
            } catch (e) {
                !1 === i(t, e) && (o = !0)
            }
        }
    }
}
,
function() {
    function v(e) {
        var t = document.createElement("div");
        return t.className = e || "",
        t
    }
    var e = app.sdk.viewComponents = {}
      , h = isMobi ? "f-click" : "click";
    e.profileMenu = function(e, s, t) {
        var i = {
            uid: s,
            isFav: !!app.info.favUsersUids[s],
            isBlocked: !!app.info.blockedUids[s]
        }
          , n = lilo.createView("profile-menu");
        t && t.className && n.el.addClass(t.className),
        n.setModel(i),
        e.off("click").append(n.el),
        n.bind("open-profile", function(e) {
            app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: s
            })
        }),
        n.bind("toggle-block", function(e) {
            var i, n = e.extraData.$el, o = app.__toggleBanMap || (app.__toggleBanMap = {}), a = util.currentMillis(), e = o[s] || 0;
            a - e < 6e4 ? dialogController.fadePopup({
                message: "Вы можете пользоваться этой функцией не чаще 1 раза в минуту",
                duration: 2e3
            }) : (n.addClass("pending"),
            i = !app.info.blockedUids[s],
            e = {
                target_uid: s,
                value: i
            },
            window.roomModel && window.roomModel.findUser(s) && (e.r = roomModel.roomId),
            ServerApi("room/v3/toggleBlock.php", e, function(e, t) {
                n.removeClass("pending"),
                e ? e.code === Codes.ACCESS_DENIED ? app.eventBus.trigger(i ? app.EVENTS.USER_UNBLOCKED : app.EVENTS.USER_BLOCKED, {
                    uid: s
                }) : (e.code,
                Codes.TARGET_ROOM_USER_NOT_FOUND) : (app.eventBus.trigger(i ? app.EVENTS.USER_BLOCKED : app.EVENTS.USER_UNBLOCKED, {
                    uid: s
                }),
                dialogController.fadePopup({
                    message: "Пользователь {0}".format(i ? "заблокирован" : "разблокирован")
                }),
                o[s] = a)
            }))
        }),
        n.bind("toggle-fav", function(e) {
            var i = e.extraData.$el;
            i.addClass("pending"),
            (app.info.favUsersUids[s] ? api.user.removeFromFav({
                targetUid: s
            }, function(e, t) {
                i.removeClass("pending"),
                e ? dialogController.fadePopup({
                    message: "Не удалось удалить пользователя из избранного"
                }) : (app.eventBus.trigger(app.EVENTS.USER_REMOVED_FROM_FAV, {
                    uid: s
                }),
                dialogController.fadePopup({
                    message: "Пользователь удален из избранного"
                }))
            }) : api.user.addToFav({
                targetUid: s
            }, function(e, t) {
                i.removeClass("pending"),
                e ? e.code === Codes.MAX_FAVORITE_USERS_REACHED ? dialogController.showMessageDialog({
                    message: "Достигнут лимит избранных пользователей"
                }) : dialogController.fadePopup({
                    message: "Не удалось добавить пользователя в избранное"
                }) : (app.eventBus.trigger(app.EVENTS.USER_ADDED_TO_FAV, {
                    uid: s
                }),
                dialogController.fadePopup({
                    message: "Пользователь добавлен в избранное"
                }))
            })).send()
        });
        function o(e) {
            e.uid === s && i.setAttr({
                isFav: !0
            })
        }
        function a(e) {
            s === e.uid && i.setAttr({
                isFav: !1
            })
        }
        function r(e) {
            e.uid === s && i.setAttr({
                isBlocked: !0
            })
        }
        function l(e) {
            e.uid === s && i.setAttr({
                isBlocked: !1
            })
        }
        return app.eventBus.on(app.EVENTS.USER_ADDED_TO_FAV, o),
        app.eventBus.on(app.EVENTS.USER_REMOVED_FROM_FAV, a),
        app.eventBus.on(app.EVENTS.USER_BLOCKED, r),
        app.eventBus.on(app.EVENTS.USER_UNBLOCKED, l),
        {
            destroy: function() {
                app.eventBus.off(app.EVENTS.USER_ADDED_TO_FAV, o),
                app.eventBus.off(app.EVENTS.USER_REMOVED_FROM_FAV, a),
                app.eventBus.off(app.EVENTS.USER_BLOCKED, r),
                app.eventBus.off(app.EVENTS.USER_UNBLOCKED, l)
            }
        }
    }
    ,
    e.depositsPurchase = function(e) {
        function a() {
            u(!0),
            dialogController.subscribe({
                model: {
                    title: "Бронирование заранее<br><div class='small'>Так как это особенный для вас игрок, вы можете забронировать заранее, чтобы никто не смог опередить вас.  Эта бронь станет активной как только закончится текущая.</div>",
                    descriptions: i
                },
                onOk: function(e) {
                    return o({
                        force: !0,
                        type: e.type,
                        price: e.price
                    }),
                    !1
                }
            }).onRemove(function() {
                u(!1)
            })
        }
        var s = e.onChangePendingState || $.noop
          , r = e.isFriend
          , n = e.targetUid
          , l = e.onSuccess || $.noop
          , d = e.onError || $.noop
          , t = e.hasOwner
          , c = e.errorHandlers || {}
          , u = e.lock || $.noop
          , i = [{
            title: "15 минут",
            price: 5,
            type: 3
        }, {
            title: "1 час",
            price: 20,
            type: 4
        }, {
            title: "3 часа",
            price: 60,
            type: 5
        }]
          , o = function(e) {
            setTimeout(function() {
                u(!0)
            }, 0);
            var o = (e = e || {}).price || 10
              , t = e.type
              , i = e.force
              , e = app.balanceModel.balance - o;
            e < 0 ? dialogController.showInsufficientlyBalanceDialog(e) : (s(!0),
            api.exchangeFriends.buy({
                target_uid: n,
                type: t,
                f: r ? 1 : 0,
                force: i
            }, function(e, t) {
                var i, n;
                u(!1),
                setTimeout(function() {
                    s(!1)
                }, 100),
                util.isDef(t.balance) && app.balanceModel.setAttr({
                    balance: t.balance
                }),
                e ? (d(e, t),
                (i = c[e.code]) ? i(e, t) : e.code === Codes.LIMIT ? dialogController.fadePopup({
                    message: "Вы купили максимальное количество игроков",
                    duration: 4e3
                }) : e.code === Codes.NOT_ENOUGH_EXP ? (n = expController.getCurrentLevel(),
                dialogController.showMessageDialog({
                    message: "Вы можете бронировать игроков, чей уровень не выше " + 2 * n
                })) : e.code === Codes.NO_SUBSCRIBE ? dialogController.fadePopup("Невозможно забронировать, так как пользователь отключил у себя Биржу") : e.code === Codes.ALREADY_EXIST ? (n = t.deposit) && n.nextOwnerId === app.info.viewer_id ? dialogController.fadePopup("Вы уже бронировали этого игрока, через {0} она станет активной".format(util.formatMillisToTime(t.leftMillis))) : dialogController.fadePopup("Вы уже бронировали этого игрока") : e.code === Codes.DEPOSIT_QUEUE_IS_FULL ? dialogController.fadePopup("Произошла ошибка при попытке бронирования заранее") : e.code === Codes.ADD_TO_DEPOSIT_QUEUE ? dialogController.fadePopup("Вы успешно забронировали заранее!") : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : e.code === Codes.ACCESS_DENIED ? r ? (dialogController.fadePopup("Игрок уже забронирован"),
                a()) : dialogController.fadePopup("Покупка станет доступна " + (t.leftMillis ? "через " + util.formatMillisToTime(t.leftMillis) : "примерно через минуту")) : e.code === Codes.NOT_ENOUGH_BALANCE ? (app.balanceModel.setAttr({
                    balance: t.balance
                }),
                dialogController.showInsufficientlyBalanceDialog(t.deficit)) : dialogController.showError(e)) : (l(t),
                r ? cAnal.trackEvent({
                    d_s_1: o
                }) : cAnal.trackEvent({
                    d_s_2: o
                }))
            }).send(util.random(100, 300)))
        };
        if (r) {
            if (t)
                return void a();
            var p = "Бронирование на бирже<div class='small'>Так как это особенный для вас игрок, вам доступны расширенные варианты бронирования</div>"
        } else
            i = [{
                title: "10 минут",
                price: 3,
                type: 1
            }, {
                title: "15 минут",
                price: 5,
                type: 2
            }],
            p = "Бронирование на бирже<div class='small'>Ваша бронь будет активна в течение выбранного времени</div>";
        u(!0),
        dialogController.subscribe({
            model: {
                title: p,
                descriptions: i
            },
            onOk: function(e) {
                return o({
                    type: e.type,
                    price: e.price
                }),
                !1
            }
        }).onRemove(function() {
            u(!1)
        })
    }
    ,
    e.togglePopupBtn = function(e, t, i) {
        i = i || {};
        function n() {
            o = !1,
            t.hide()
        }
        var o = !1;
        return e.click(function(e) {
            return (o = !o) ? (o = !0,
            t.show(),
            i.onOpen && i.onOpen()) : n(),
            e.stopPropagation(),
            !1
        }),
        $body.on("click", n),
        {
            close: n,
            dispose: function() {
                $body.off("click", n)
            }
        }
    }
    ,
    e.searchInput = function(t, e, i, n) {
        n = n || {};
        function o(e) {
            c.search({
                word: e
            })
        }
        function a() {
            o(t.val())
        }
        function s() {
            clearTimeout(d),
            d = setTimeout(a, 500)
        }
        function r() {
            t.val() ? (clearTimeout(d),
            d = setTimeout(a, 500)) : o("")
        }
        function l() {
            t.val() || o("")
        }
        var d, c = new app.sdk.SearchHandler({
            resultArray: i,
            initialArray: e,
            maxResultSize: n.maxSize || 10,
            comparer: function(e, t, i) {
                return -1 !== e.__searchWord.indexOf(i)
            }
        });
        return t.on("keypress", s),
        t.on("keydown", r),
        t.on("keyup", l),
        {
            searchHandler: c,
            $input: t,
            focus: function() {
                t.focus()
            },
            dispose: function() {
                clearTimeout(d),
                t.off("keypress", s),
                t.off("keydown", r),
                t.off("keyup", l)
            },
            search: function(e) {
                c.search({
                    word: e
                }),
                t.val(e)
            },
            getCurrentSearchWord: function() {
                return t.val()
            },
            reset: function(e) {
                e = (e = e || {}).silence;
                c.resetSearchWord(),
                e || (c.search({
                    word: ""
                }),
                t.val(""))
            }
        }
    }
    ,
    e.stickersSlider = function(e) {
        var t, i, n, o, a, s, r, l, d, c = e.$container, u = e.itemWidth, p = e.maxItems, f = c.children().map(function(e, t) {
            return $(t)
        }), m = f.length;
        m <= p || (t = (m - p - 1) * u * -1,
        i = (p - 1) * u,
        n = 0,
        o = "fade",
        u = $(v("o-wrap")),
        a = $(v("o-container")),
        s = $(v("o-nav-arrow o-nav-arrow-left")),
        r = $(v("o-nav-arrow o-nav-arrow-right")),
        l = function() {
            0 === n ? (s.addClass(o),
            r.removeClass(o)) : (n === t ? r.addClass(o) : r.removeClass(o),
            s.removeClass(o))
        }
        ,
        d = function() {
            n = Math.min(0, n + i),
            l(),
            a.css("transform", "translate({0}px,0px)".format(n))
        }
        ,
        f.each(function(e, t) {
            a.append(t)
        }),
        s.on(h, function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            d()
        }),
        r.on(h, function(e) {
            e.preventDefault(),
            e.stopPropagation(),
            n = Math.max(t, n - i),
            l(),
            a.css("transform", "translate({0}px,0px)".format(n))
        }),
        u.append(a),
        c.append(u),
        c.append(s),
        c.append(r),
        c.addClass("c-stickers-slider"),
        s.css({
            width: e.btnWidth
        }),
        r.css({
            width: e.btnWidth
        }),
        d())
    }
}(),
app.sdk.WebCamController = function(i) {
    var t = i.onError || $.noop
      , n = i.onComplete || $.noop
      , o = i.video
      , a = i.width || 0
      , s = 0
      , r = i.mimeType || "image/png"
      , l = []
      , d = !1;
    IS_IOS && $(o).attr({
        "webkit-playsinline": "",
        playsinline: ""
    }),
    this.finalize = function() {
        l.each(function(e, t) {
            try {
                t()
            } catch (e) {}
        })
    }
    ;
    try {
        var c = window.navigator;
        c.getMedia = c.getUserMedia || c.webkitGetUserMedia || c.mozGetUserMedia || c.msGetUserMedia;
        !function() {
            try {
                c.mediaDevices.getUserMedia({
                    facingMode: {
                        exact: "user"
                    },
                    video: !0,
                    audio: !1
                }).then(function(e) {
                    o.srcObject = e,
                    i.onStartPlay(),
                    o.autoplay = !0,
                    o.play(),
                    l.push(function() {
                        e.stop()
                    }),
                    l.push(function() {
                        e.getAudioTracks()[0].stop()
                    }),
                    l.push(function() {
                        e.getVideoTracks()[0].stop()
                    }),
                    l.push(function() {
                        o.pause(),
                        o.src = null
                    }),
                    l.push(function() {
                        o.pause(),
                        o.mozSrcObject = null
                    })
                }).catch(function(t) {
                    console.info("CAMERA_ACCESS_DENIED"),
                    1574275553424 === app.info.viewer_id && alert(t.name + "\n" + e.message),
                    console.info("camera access", JSON.stringify(t)),
                    i.onCameraAccessDenied ? i.onCameraAccessDenied() : browserInfo.isOpera || (util.isOKPlatform() ? dialogController.fadePopup({
                        message: "Не удалось получить доступ к камере!",
                        duration: 5e3
                    }) : dialogController.showMessageDialog({
                        message: "Вы заблокировали доступ к камере",
                        buttons: [{
                            caption: "Как разблокировать?",
                            handler: function() {
                                try {
                                    window.open("https://vk.com/page-75820678_50104561", "_blank").focus()
                                } catch (e) {}
                                return !1
                            }
                        }]
                    }))
                })
            } catch (e) {
                t(e)
            }
        }(),
        o.addEventListener("canplay", function(e) {
            d || (s = o.videoHeight / (o.videoWidth / a),
            isNaN(s) && (s = a / (4 / 3)),
            o.setAttribute("width", a + ""),
            o.setAttribute("height", s + ""),
            i.onCanPlay(a, s),
            d = !0)
        }, !1)
    } catch (e) {
        t(e)
    }
    this.takePhoto = function(e) {
        var t;
        e = e || $.noop,
        a && s && ((t = document.createElement("canvas")).width = a,
        t.height = s,
        t.getContext("2d").drawImage(o, 0, 0, a, s),
        t = t.toDataURL(r),
        e(),
        n(t))
    }
}
,
function() {
    var t = $.noop
      , i = 1;
    app.sdk.ResourceProvider = function(e) {
        var a = "resource-" + i++
          , s = $.extend({
            cacheTtl: 6e4,
            serializeToJson: !0,
            provideResource: t,
            onError: t,
            onSuccess: t
        }, e);
        this.get = function() {
            var e = function(e) {
                for (var t = {}, i = 0, n = 0; n < e.length; n += 1) {
                    var o = e[n];
                    $.isPlainObject(o) ? t.opts = o : $.isFunction(o) && (0 == i++ ? t.onReceive = o : t.onError = o)
                }
                return t
            }(arguments)
              , t = e.opts
              , i = e.onReceive || s.onSuccess
              , n = e.onError || s.onError
              , o = a + ((t = t || {}).cacheKey || "")
              , t = util.cache.find(o);
            t ? i(t) : s.provideResource(function(e) {
                util.cache.save(o, e, s.cacheTtl, {
                    serializeObject: s.serializeToJson
                }),
                i(e)
            }, function(e) {
                n(e)
            }, e.opts)
        }
    }
}(),
function() {
    app.controllers.ErrorHandler = function() {
        function s(i) {
            var n = "";
            return (n = i.err ? i.label ? i.label + " " + i.err.message : i.err.message : n) || $.each(e, function(e, t) {
                t = i[t];
                if (t && "string" == typeof t)
                    return n = t,
                    !1
            }),
            n || -1 === i.error_code && (n = "Timeout"),
            n
        }
        var r = ["error_code", "code"]
          , e = ["error_msg", "message", "error_description"];
        this.getFullMessage = s,
        this.isServerUnavailableError = function(e) {
            return 200 === e.code ? !!e.message.contains("getBootData.php") : e.message && e.message.indexOf && (0 === e.message.indexOf("Connection Error") || 0 < e.message.indexOf("[timeout]"))
        }
        ,
        this.handleCommonError = function(e, t) {
            return e.code === Codes.NOT_ENOUGH_BALANCE || e.code === Codes.LOTTERY_IS_ACTIVE
        }
        ,
        this.showServerUnavailable = function(e) {
            dialogController.close();
            e = s(e);
            dialogController.showMessageDialog({
                title: "Проблемы с соединением с сервером",
                message: "<small>{0}</small>".format(e),
                isModal: !0,
                buttons: [{
                    caption: "Перезапустить приложение",
                    handler: function() {
                        return setTimeout(function() {
                            window.location.reload()
                        }, 100),
                        !1
                    }
                }]
            })
        }
        ,
        this.showError = function(e, t, i) {
            if (423 === e.code && GA("AppError", "Flood", s(e)),
            this.isServerUnavailableError(e))
                this.showServerUnavailable(e);
            else {
                if (e.code === Codes.LOTTERY_IS_ACTIVE)
                    return void dialogController.lotteryIsActiveDialog();
                var n;
                t ? dialogController.showMessageDialog({
                    title: "Ошибка",
                    message: "Что-то пошло не так при отправке запроса",
                    buttons: [{
                        caption: "Попробовать еще раз",
                        handler: function() {
                            return t.send(util.random(300, 600)),
                            !1
                        }
                    }, {
                        mobiClose: 1,
                        caption: "Закрыть",
                        handler: function() {
                            return !1
                        }
                    }]
                }) : !function(e) {
                    e = (e + "").toLowerCase();
                    return /session can be expired/gi.test(e)
                }(n = s(e)) ? dialogController.showMessageDialog({
                    title: "В приложении произошла ошибка.",
                    message: n
                }) : dialogController.showMessageDialog({
                    title: "Ошибка.",
                    message: "Пожалуйста, очистите кэш браузера и перезагрузите страницу.",
                    noClose: !0
                })
            }
            var o, a;
            "-1::" == (e = (o = e,
            a = -1,
            $.each(r, function(e, t) {
                t = o[t];
                if (t && util.isDef(t))
                    return a = t,
                    !1
            }),
            a + "::" + (e.loc ? e.loc + " " : "") + s(e))) && (e += util.stackTrace())
        }
        ,
        this.show = this.showError
    }
}(),
function() {
    var C, _, w, E = {}, y = 1, D = "dialog-mode", T = "dialog-mode-mobile";
    app.controllers.DialogController = function() {
        var s = this;
        app.makeEventDispatcher(s),
        C = $("#dialog-area").addClass("hidden"),
        _ = $("body"),
        $(window),
        w = $(document.documentElement);
        function r() {
            return isMobi
        }
        function h(e, t) {
            var i = {};
            (t = t || {}).staticTop && (i.staticTop = t.staticTop),
            t.minTopOffset && (i.minTopOffset = t.minTopOffset);
            var n = r(e.id);
            n && l();
            var o = n ? "dialog-window-mobi" : "dialog-window"
              , a = lilo.createView(o, i);
            e.isVisible = !0,
            a.onRemove(function() {
                e.isVisible = !1
            });
            i = y += 1;
            return a.__dialogId = e.__dialogId = i,
            ((E[i] = a).dialog = e).dialogWindow = a,
            t.dialogClass && a.el.addClass(t.dialogClass),
            a.els.dialogWrap.append(e.el),
            t.dialogBG && a.els.dialogWrap.css("background", t.dialogBG),
            t.dialogCss && a.els.dialogWrap.css(t.dialogCss),
            C.append(a.el),
            C.removeClass("hidden"),
            _.addClass(D),
            n && w.addClass(T),
            g(e),
            a.el.css("opacity", 1),
            a.one("close:" + o, function() {
                d(a)
            }),
            a.one("close:" + e.id, function() {
                d(a)
            }),
            t.noClose || t.isModal ? (a.els.close.hide(),
            a.el.addClass("hide-close-btn")) : n || a.els.bg.one("click", function(e) {
                e.currentTarget === e.target && e.target === a.els.bg[0] && d(a)
            }),
            t.mobiCloseCaption && a.els.close.html(t.mobiCloseCaption),
            t.mobiFullHeight && isMobi && a.el.addClass("mobi-full-height"),
            t.mobiCloseHandler && (a.el.off("f-click", "[el='close']"),
            a.el.on("f-click", "[el='close']", t.mobiCloseHandler)),
            s.trigger("open-dialog"),
            setTimeout(function() {
                a.el.addClass("show")
            }, 50),
            a
        }
        function l() {
            for (var e in E)
                if (E.hasOwnProperty(e))
                    return !0;
            return !1
        }
        function d(e) {
            var t;
            e ? (t = "object" == typeof e ? e.__dialogId : e,
            (e = E[t]) ? (e.close(),
            delete E[t],
            l() || (C.addClass("hidden"),
            _.removeClass(D),
            w.removeClass(T),
            socialApi.onDialogsClose())) : console.warn("dialog to close not found")) : ($.each(E, function(e, t) {
                t.close(),
                delete E[e]
            }),
            isMobi && app.controllers.MobilePopup.close()),
            l() || (C.addClass("hidden"),
            _.removeClass(D),
            w.removeClass(T),
            $contextArea.css("margin-top", ""),
            socialApi.onDialogsClose()),
            s.trigger("close-dialog")
        }
        function g(e) {
            var t, i, n;
            r(e.id) || (t = socialApi.getScroll(),
            i = socialApi.getWindowHeight(),
            n = socialApi.getFrameHeight(),
            socialApi.onDialogOpen(),
            (e.dialogWindow || e).toCenter(t, i, n))
        }
        function c(e) {
            var t = {
                message: e.message,
                title: e.title,
                buttons: e.buttons,
                hasCloseBtn: !(e.noClose || e.isModal)
            };
            t.buttons || (t.buttons = []);
            var i = e.view || lilo.createView("dialog-simple");
            return i.setModel(t),
            e.justifyMessage && i.el.addClass("text-justify"),
            e.dialogClass && i.el.addClass(e.dialogClass),
            e.noClose && i.$(".buttons-line").hide(),
            h(i, e)
        }
        s.isDialogOpenByName = function(e) {
            for (var t in E)
                if (E.hasOwnProperty(t))
                    if (E[t].dialog.id === e)
                        return !0;
            return !1
        }
        ,
        s.countOfOpenedDialogs = function() {
            var e, t = 0;
            for (e in E)
                E.hasOwnProperty(e) && t++;
            return t
        }
        ,
        this.open = h,
        this.dialogToCenter = g,
        this.close = d,
        this.dialogIsOpen = function(e) {
            return !(!e || !e.__dialogId) && !!E[e.__dialogId]
        }
        ,
        this.dialogsToCenter = function() {
            for (var e in E)
                E.hasOwnProperty(e) && g(E[e])
        }
        ,
        this.rotate = function(e, t) {
            var i = e.el.parent();
            e.el.detach(),
            t.onRemove(function() {
                i.append(e.el)
            })
        }
        ,
        isMobi && setInterval(function() {
            var e, t, i = util.mobiHeight();
            for (e in E)
                !E.hasOwnProperty(e) || (t = E[e].dialog).isVisible && t.updateContentHeight && t.updateContentHeight(i)
        }, 100),
        this.getMaxDialogHeight = function() {
            var e, t, i = 0;
            for (e in E)
                E.hasOwnProperty(e) && (t = E[e].getTotalHeight(),
                i = Math.max(i, t));
            return i
        }
        ,
        s.showMessageDialog = c,
        s.warn = function(e) {
            return e.title = "Предупреждение",
            c(e)
        }
        ,
        s.showInsufficientlyBalanceDialog = function(e, t) {
            t = t || {},
            e = Math.abs(e);
            var i, n = "dialog-insufficiently-balance", o = t.currency || 1, a = lilo.createView(n);
            a.setModel({
                deficit: e,
                currency: o
            }),
            t.isSilver && a.el.addClass("is-silver"),
            util.isOKPlatform() ? (i = app.controllers.OKInvitationsController && "inline-block" === headerView.els["ok-invitations"].css("display") && headerView.els["ok-invitations"].parent().length,
            (headerView.els["ok-invitations"] && headerView.els["ok-invitations"].hasClass("selected") || !i) && a.$(".free").remove()) : (i = "inline-block" === headerView.els.viral.css("display") && headerView.els.viral.parent().length,
            app.balanceModel.bonusCoins && !headerView.els.viral.hasClass("selected") && i && 2 !== o || a.$(".free").remove()),
            h(a, {
                dialogClass: "small-close no-padding"
            }),
            a.on("buy:" + n, function() {
                s.purchase({
                    isSilver: t.isSilver,
                    isGold: !t.isSilver || t.isGold,
                    currency: o
                }),
                d(a)
            }),
            a.on("free:" + n, function() {
                util.isOKPlatform() ? app.eventBus.trigger(app.EVENTS.SHOW_OK_VIRAL_TAB) : app.eventBus.trigger(app.EVENTS.SHOW_VIRAL_QUESTIONS),
                d(a),
                t.onChangeWindow && t.onChangeWindow()
            })
        }
        ,
        s.confirm = function(e) {
            return c({
                title: e.title || "Подтверждение",
                message: e.message,
                buttons: [{
                    caption: "OK",
                    handler: e.onOk
                }, {
                    mobiClose: 1,
                    caption: "Отмена",
                    handler: function() {
                        return !1
                    }
                }]
            })
        }
        ;
        function i() {
            clearInterval(o),
            window.removeEventListener("storage", u)
        }
        var n, o, a = !1, u = function(e) {
            e.key === n && (util.lStorage.remove("bcm"),
            a || (a = !0,
            api.user.getSelfBalance({}, function(e, t) {
                a = !1,
                e || app.balanceModel.setAttr({
                    balance: t.balance
                })
            }).send(1e3)))
        };
        s.purchase = function(e) {
            var t;
            util.isOKPlatform() ? new app.controllers.dialog.Purchase(e) : (t = !1,
            window.isExternal || (t = isMobi && IS_IOS && !isMvk),
            window.ODR || (t ? (i(),
            (t = document.createElement("a")).target = "_blank",
            t.href = "https://igra.love/vkApp",
            s.showMessageDialog({
                message: "<span class='font-x1_5'>Покупка недоступна</span>",
                buttons: [{
                    mobiClose: 1,
                    caption: "Закрыть",
                    handler: function() {
                        return !1
                    }
                }]
            })) : isMobi && !isDirect ? (i(),
            s.showMessageDialog({
                message: "Мобильная версия находится в тестовом режиме, поэтому пополнить баланс можно только в основной версии игры",
                buttons: [{
                    caption: "Перейти к основной версии",
                    handler: function() {
                        return function() {
                            var e = util.createAppLink({
                                apiId: app.info.mainAppId,
                                hash: "pay",
                                protocol: "https"
                            });
                            try {
                                var t = window.open(e, "_blank");
                                t.focus(),
                                n = app.info.viewer_id + ".bcm",
                                window.addEventListener("storage", u),
                                o = setInterval(function() {
                                    t.top !== t && i()
                                }, 2e3)
                            } catch (e) {}
                        }(),
                        !1
                    }
                }, {
                    mobiClose: 1,
                    caption: "Закрыть",
                    handler: function() {
                        return !1
                    }
                }]
            })) : new app.controllers.dialog.Purchase(e)))
        }
        ,
        s.newsDialog = function(e) {
            var t = e.width || 440
              , i = {
                message: e.content,
                title: "",
                buttons: e.buttons
            };
            i.buttons || (i.buttons = [{
                caption: "Закрыть",
                handler: function() {
                    return !1
                }
            }]);
            var n = lilo.createView("dialog-news");
            return n.setModel(i),
            n.el.width(t),
            e.noClose && n.$(".buttons-line").hide(),
            e.dialogCss = {
                padding: "0"
            },
            window.roomView && window.roomView.isVisible && (e.staticTop = 160),
            h(n, e)
        }
        ;
        var p = {};
        s.fadePopup = function(e) {
            if (!p[(e = "string" == typeof e ? {
                message: e
            } : e).message]) {
                p[e.message] = !0;
                var t = lilo.createView("fade-popup");
                t.setModel({
                    message: e.message
                });
                var i = util.isDef(e.top) ? e.top : socialApi.getScroll() + 20;
                return t.el.css({
                    top: i + "px",
                    opacity: "0",
                    zIndex: 501
                }),
                $appArea.append(t.el),
                t.el.fadeTo(300, 1, function() {
                    setTimeout(function() {
                        t.el.animate({
                            opacity: "0.1"
                        }, 100, function() {
                            t.el.remove(),
                            delete p[e.message]
                        })
                    }, e.duration || 1500)
                }),
                {
                    view: t
                }
            }
        }
        ,
        s.showDialogSwitchRoomIsNotAllowed = function() {
            c({
                message: "Вы не можете покинуть свою комнату в данный момент. Дождитесь окончания раунда"
            })
        }
        ;
        var f = !(s.showNoAccessToRoom = function(e) {
            var t = e.leftMillis
              , i = e.returnToGameHandler;
            t < 6e4 && (t = 6e4),
            isNaN(t) && (t = 1e4);
            var n = util.formatMillisToTime(t, function(e, t, i) {
                return t + " мин."
            })
              , e = "Вас исключили из этой комнаты.<br/>Доступ будет открыт через {0}".format(n)
              , t = null
              , n = !1;
            i && (n = !0,
            t = [{
                caption: "Вернуться в игру",
                handler: function() {
                    return i(),
                    !1
                }
            }]),
            c({
                message: e,
                isModal: n,
                buttons: t
            })
        }
        );
        function m() {
            $contextArea.empty().css("height", "600px"),
            $("#app").css("background", "none"),
            $appLoader.hide()
        }
        s.showDialogRoomSwitchTooFreq = function(e, t) {
            if (t = t || {},
            !f) {
                var i, n;
                if (f = !0,
                setTimeout(function() {
                    f = !1
                }, 3e3),
                n = e ? (n = (i = util.millisToDateComponents(e)).seconds,
                "Вы сможете поменять комнату через " + ((1 === (i = i.minutes + "").length ? "0" + i : i) + ":" + (1 === (n = n + "").length ? "0" + n : n))) : "Вы меняете комнаты слишком часто",
                t.returnOnlyMessage)
                    return console.info("returnOnlyMessage"),
                    n;
                t.paymentJoin ? new app.controllers.dialog.SwitchRoomLimit({
                    leftMillis: e,
                    price: t.price,
                    paymentJoin: t.paymentJoin
                }) : dialogController.fadePopup({
                    message: n,
                    duration: 3e3
                })
            }
        }
        ,
        s.showInitAppError = function(e) {
            var t = "";
            (e = e || {}).jsException ? t = e.jsException.message : e.extraMessage && (t = e.extraMessage),
            t = e.message || "При загрузке приложения произошла ошибка<br>{0}<br>".format(t ? "[" + t + "]" : "") + "Воспользуйтесь последней версией браузера<br><a class='link' target='_blank' href='https://www.google.ru/intl/ru/chrome/browser/'>Google Chrome</a> или <a class='link' target='_blank' href='https://www.mozilla.org/ru/firefox/new/'>Mozilla Firefox</a>",
            dialogController.showMessageDialog({
                noClose: !0,
                message: t,
                dialogClass: "app-reboot"
            }),
            h = $.noop,
            dialogController.fadePopup = dialogController.open = $.noop,
            m(),
            window.criticalError = !0
        }
        ,
        s.browserNotSupportDialog = function() {
            dialogController.showMessageDialog({
                noClose: !0,
                isModal: !0,
                message: "Ваш браузер не поддерживается<br><br> <small style='display: inline-block;line-height: 1.1'>UA:&nbsp;" + navigator.userAgent + "<br>WS:" + window.WebSocket + "</small>"
            }),
            m()
        }
        ,
        s.showAccessDeniedDialog = function(e) {
            e = e || {},
            m();
            var t, i = [], n = "Вы забанены в игре";
            1 === e.banReason ? n = "Вы забанены по жалобам пользователей за мат и оскорбления." : -21 === e.banReason ? n = "Ваш профиль удален в игре." : 2 === e.banReason ? n = "Вы забанены модератором" : e.reasonText && ("fraud" === e.reasonText && (t = "Махинации"),
            "_REFUND_" === e.reasonText ? (n = ["Вы запросили возврат потраченных в игре средств. Возврат будет осуществляет в ближайшее время", "Ваш аккаунт заблокирован.", "В случае возникновения дополнительных вопросов, напишите нам в поддержку."].join("<br>"),
            i.push({
                anchor: !(t = ""),
                href: "https://vk.com/im?sel=-75820678",
                caption: "Обратиться в поддержку"
            })) : t = e.reasonText);
            var o = "";
            e.leftTime && (e = util.currentMillis() + e.leftTime,
            o = util.formatDate(e, function(e, t, i, n, o) {
                return e + "." + t + "." + i + " " + n + ":" + o
            })),
            t && (n = 'Вы забанены. Причина:<br>"' + t + '"'),
            dialogController.showMessageDialog({
                message: n + (o ? "<br/>Бан истекает: " + o : ""),
                isModal: !0,
                buttons: i
            }),
            webSocketController.stop(),
            window.roomController && roomController.resetRoom()
        }
        ,
        s.accessTokenExpiredDialog = function(e) {
            e = e || {},
            window.isExternal ? s.showAppRebootDialog({
                message: "Срок действия вашей сессии истек. Необходимо заново пройти авторизацию",
                btnCaption: "Пройти авторизацию",
                handler: function() {
                    window.externalLoveBridge.refreshToken()
                }
            }) : e.appServerError ? s.showAppRebootDialog({
                message: "Ошибка. Необходимо заново пройти авторизацию",
                btnCaption: "Пройти авторизацию",
                handler: function() {
                    app.services.vk.doOauth()
                }
            }) : s.showAppRebootDialog({
                message: "Срок действия вашей сессии истек. Необходимо заново пройти авторизацию",
                btnCaption: "Пройти авторизацию",
                handler: function() {
                    app.services.vk.doOauth()
                }
            })
        }
        ,
        s.showAppRebootDialog = function(e) {
            dialogController.close(),
            e = e || {},
            dialogController.showMessageDialog({
                dialogClass: "app-reboot",
                message: e.message || "Перезапустите приложение",
                isModal: !0,
                buttons: [{
                    caption: e.btnCaption || "Перезапустить",
                    handler: function() {
                        return e.handler ? e.handler() : setTimeout(function() {
                            window.location.reload()
                        }, 100),
                        !1
                    }
                }]
            }),
            m(),
            webSocketController.stop(),
            window.roomController && roomController.resetRoom(),
            api.ping = $.noop,
            util.isVKPlatform() && socialApi.setLocation(""),
            h = $.noop,
            dialogController.fadePopup = dialogController.open = $.noop,
            $("#footer").css("visibility", "hidden"),
            window.roomModel && roomModel.setAttr({
                modCounter: roomModel.modCounter + 1
            }),
            _.addClass("need-reboot")
        }
        ,
        s.ageDialog = function(e) {
            var o = (e = e || {}).onComplete || $.noop
              , a = lilo.createView("dialog-enter-age", {
                age: app.info.age
            });
            dialogController.open(a, e),
            a.bind("submit", function(e) {
                var e = e.extraData.date
                  , t = e.getDate() + "_" + (e.getMonth() + 1) + "_" + e.getFullYear();
                t !== app.info.selfBdate && (e = "Вы выбрали <b>{0}</b> как свой день рождения. После сохранения эту дату нельзя будет поменять.".format(moment(e).format("DD MMMM, YYYY")),
                dialogController.showMessageDialog({
                    message: e,
                    buttons: [{
                        caption: "Сохранить",
                        handler: function() {
                            var n = api.user.updateAge({
                                beforeSend: ajaxLoader.show,
                                bdate: t
                            }, function(e, t) {
                                var i;
                                ajaxLoader.hide(),
                                e ? e.code === Codes.LOCKED && t.age ? (i = t.age,
                                app.info.age = i,
                                app.eventBus.trigger(app.EVENTS.AGE_CHANGED, {
                                    age: i,
                                    roomTypeChanges: !!t.roomTypeChanges
                                }),
                                util.lStorage.save("age", i),
                                c({
                                    message: "Вам запрещено ставить возраст 18+"
                                })) : e.code === Codes.ACCESS_DENIED ? c({
                                    message: "Вам запрещено изменять возраст"
                                }) : (errorHandler.showError(e, n),
                                dialogController.close(a)) : (i = t.age,
                                app.info.age = i,
                                app.info.selfBdate = t.selfBdate,
                                app.eventBus.trigger(app.EVENTS.AGE_CHANGED, {
                                    age: i,
                                    roomTypeChanges: !!t.roomTypeChanges
                                }),
                                util.lStorage.save("age", i),
                                o(i),
                                dialogController.close(a))
                            });
                            return n.send(),
                            !1
                        }
                    }, {
                        mobiClose: 1,
                        caption: "Отмена",
                        handler: function() {
                            return !1
                        }
                    }]
                }))
            })
        }
        ,
        s.showError = function(e) {
            var t = errorHandler.getFullMessage(e);
            c({
                message: "Произошла ошибка:<br>" + e.code + " " + t
            })
        }
        ,
        s.levelCompleteDialog = function(e, t) {
            t = t || {};
            var i = lilo.createView("dialog-level-complete")
              , e = {
                prevLevel: e - 1,
                nextLevel: e,
                balanceBonus: t.balanceBonus || 0,
                rubyBonus: t.rubyBonus || 0
            };
            i.setModel(e),
            app.soundManager.play(app.soundManager.SOUND_IDS.MISSION_COMPLETE),
            $(document.createElement("div")).addClass("btn green").html("Спасибо").click(function() {
                dialogController.close(i)
            }).appendTo(i.el),
            h(i, {
                dialogClass: "no-padding hide-close",
                staticTop: !isMobi && t.roomView && t.roomView.isVisible ? 210 : 0
            }),
            i.onRemove(function() {
                if (isDirect)
                    try {
                        VK.callMethod("showShareBox", "Новый уровень!", "photo-75820678_456254340,https://vk.com/love1v", "wall")
                    } catch (e) {}
            }),
            setTimeout(function() {
                i.startAnimation()
            }, 100)
        }
        ,
        s.openSubscribeDialog = function(e) {}
        ;
        var v = !(s.showInsufficientlyLevelDialog = function(e) {
            var t = lilo.createView("dialog-insufficiently-level");
            t.setModel({
                currentLevel: e.currentLevel,
                needLevel: e.needLevel
            }),
            h(t)
        }
        )
          , b = {};
        s.kickUser = function(a, e) {
            var s, t, n, i, r, l, d, o;
            v || (s = roomModel.roomId,
            t = a.uid,
            n = null,
            i = b[t] || 0,
            0 < (i = 3e4 - (+new Date - i)) ? dialogController.fadePopup("Вы сможете исключить этого игрока через " + util.formatMillisToTime(i, function(e, t, i) {
                return t + ":" + i
            })) : (r = function() {
                n && (dialogController.close(n),
                n = null)
            }
            ,
            l = function(e) {
                var i;
                r(),
                (roomModel.pending || roomModel.hasUser(a.uid)) && roomModel.roomId === s && (i = {
                    uid: a.uid,
                    age: a.age,
                    avatar: a.photo || a.photoUrl,
                    firstName: a.firstName,
                    reasons: []
                },
                KickReasonId.each(function(e, t) {
                    i.reasons.push({
                        selected: !1,
                        text: t,
                        value: e
                    })
                }),
                i.reasons[0].selected = !0,
                (n = lilo.createView("dialog-kick-user")).setModel(i),
                dialogController.open(n),
                n.bind("ok", function(e) {
                    r(),
                    o(e.extraData.price, e.extraData.id, e.extraData.anon)
                }))
            }
            ,
            d = function() {
                b[t] = +new Date,
                e && e.popupModel && roomModel.hasUser(t) && a.uid === t && e.popupModel.hideKick()
            }
            ,
            o = function(i, e, t, n) {
                var o;
                roomModel.roomId === s && (n = n || {},
                o = {
                    target_uid: a.uid,
                    reasonId: e,
                    anon: t,
                    price: i
                },
                roomModel.viewerIsOwnerOfRoom || (o.r = s),
                v = !0,
                ServerApi("room/v3/kick.php", o, function(e, t) {
                    if (v = !1,
                    e)
                        switch (e.code) {
                        case Codes.NOT_ENOUGH_BALANCE:
                            r(),
                            dialogController.showInsufficientlyBalanceDialog(t.deficit);
                            break;
                        case Codes.ACCESS_DENIED:
                        case Codes.UNKNOWN_ERROR:
                        case Codes.USER_NOT_FOUND:
                            r(),
                            dialogController.fadePopup("Произошла ошибка");
                            break;
                        case Codes.INVALID_PRICE:
                            l(t.price),
                            n.initial || dialogController.fadePopup("Неверные параметры запроса")
                        }
                    else {
                        e = t.result;
                        1 === e ? dialogController.fadePopup("Не удалось выполнить запрос") : 2 === e ? (!o.r ? dialogController.fadePopup("Пользователь исключен") : (dialogController.fadePopup("Пользователь будет исключен"),
                        cAnal.trackEvent({
                            spent_for_kick: i
                        })),
                        d()) : 3 === e && (e = roomModel.roundType === app.ROUND_TYPE.LOADING_ROUND ? "Ваша заявка принята. Пользователь будет исключен из комнаты в начале следующего раунда" : "Ваша заявка принята. Пользователь будет исключен из комнаты после этого раунда",
                        dialogController.fadePopup({
                            duration: 3500,
                            message: e
                        }),
                        d())
                    }
                    util.isDef(t.balance) && app.balanceModel.setAttr({
                        balance: t.balance
                    })
                }))
            }
            ,
            l()))
        }
        ,
        s.complaint = function(t) {
            var e = "dialog-complaint"
              , i = {
                uid: t.uid,
                age: t.age,
                avatar: t.avatar,
                firstName: t.firstName,
                reasons: app.getComplaintReasons(t.age, t.uid)
            }
              , n = lilo.createView(e);
            0 !== i.reasons.length && (i.reasons[0].selected = !0,
            n.setModel(i),
            n.on("ok:" + e, function(e) {
                dialogController.close(n),
                t.onSubmit(e.extraData.value)
            }),
            h(n))
        }
        ,
        s.connectionLostDialog = function(e) {
            var t, i = document.createElement("b"), n = 0, o = function() {
                clearTimeout(t),
                n < 0 ? e.onTimerComplete() : (i.innerHTML = n + " сек.",
                n--,
                t = setTimeout(o, 1e3))
            };
            e.start = function() {
                a.dialog.$(".message").html("Проблемы с интернет соединением. Повторное подключение через:&nbsp;").append(i),
                n = 5,
                o()
            }
            ;
            var a = dialogController.showMessageDialog({
                message: "&nbsp;",
                buttons: [],
                isModal: !0
            });
            return a.dialog.$(".message").append(i),
            a.timerEl = i,
            a
        }
        ,
        s.lotteryIsActiveDialog = function() {
            c({
                message: "В данный момент Вы не можете трaтить монетки. Дождитесь окончания раунда"
            })
        }
        ,
        s.roomExpLimitDialog = function(e, t) {
            t = t || {};
            var i = e.accessType;
            if (i) {
                var n = e.accessDescr;
                switch (i) {
                case 1:
                    o = "Чтобы попасть в эту комнату, ваш уровень должен быть больше 9";
                    break;
                case 2:
                    o = "Эта кмоната для новичков. Доступ к ней для вас ограничен";
                    break;
                case 3:
                    var o = "Чтобы попасть в эту комнату, ваш уровень должен быть больше " + ((a = n[1]) - 1);
                    break;
                case 4:
                    n[1],
                    n[2],
                    n[3],
                    n[4];
                    var a = n[5];
                    o = expController.getCurrentLevel() < a ? "Чтобы попасть в эту комнату, ваш уровень должен быть больше " + (a - 1) : "Эта комната не для вашего региона";
                    break;
                case 5:
                    n[1],
                    n[2];
                    a = n[3];
                    o = expController.getCurrentLevel() < a ? "Чтобы попасть в эту комнату, ваш уровень должен быть больше " + (a - 1) : "Эта комната не для вашей страны"
                }
            } else
                o = "Вы не можете попасть в эту комнату";
            if (t.returnOnlyMessage)
                return o;
            c({
                message: o
            })
        }
        ,
        s.subscriptionSettings = function(t) {
            var e = "dialog-subscription-settings"
              , i = lilo.createView(e);
            return i.setModel(t.model),
            i.applyDescr(t.descr),
            h(i, {
                dialogClass: "small-close no-padding"
            }),
            i.on("ok:" + e, function(e) {
                !1 === t.onOk(e.extraData.description) && d(i)
            }),
            i.on("cancel:" + e, function(e) {
                d(i)
            }),
            t.onRemove && i.onRemove(t.onRemove),
            i
        }
        ,
        s.subscribe = function(t) {
            var e = "dialog-subscribe"
              , i = lilo.createView(e);
            return i.setModel(t.model),
            h(i, t.dialogOpts),
            i.on("ok:" + e, function(e) {
                !1 === t.onOk(e.extraData.description) && d(i)
            }),
            i.on("cancel:" + e, function(e) {
                d(i)
            }),
            t.onRemove && i.onRemove(t.onRemove),
            t.dialogClass && i.el.addClass(t.dialogClass),
            i
        }
        ,
        app.eventBus.on(app.EVENTS.ON_ROOM_TOP_LIST_WIN, function(e) {
            var t, i, n, o = 17 < app.info.age ? "adult" : "teen", a = "hourly", s = 2 === app.info.sex, r = function(e, t, i) {
                return app.RoomTopListRewards[o][t][e][i - 1]
            }, l = 1, d = (u = 18 <= app.info.age,
            p = 0,
            e.wpt1 || e.wpt1h ? p = u ? 1e3 : 300 : e.wpt2 || e.wpt2h ? p = u ? 500 : 150 : (e.wpt4 || e.wpt4h) && (p = u ? 1e3 : 300),
            p);
            if (e.wpt1)
                i = e.wpt1,
                t = "wpt1",
                n = "{0} за день".format(s ? "Самый Щедрый" : "Самая Щедрая"),
                v = r("daily", "wastefull", i),
                l = 2;
            else if (e.wpt2)
                i = e.wpt2,
                t = "wpt2",
                n = "{0} за день".format(s ? "Самый Популярный" : "Самая Популярная"),
                v = r("daily", "popular", i),
                l = 2;
            else {
                if (e.wpt3)
                    return;
                if (e.wpt4)
                    i = e.wpt4,
                    t = "wpt4",
                    n = "{0} за день".format(s ? "Самый Удачливый" : "Самая Удачливая"),
                    v = r("daily", "lottery", i);
                else if (e.wpt1h)
                    i = e.wpt1h,
                    t = "wpt1h",
                    n = "{0} за час".format(s ? "Самый щедрый" : "Самая щедрая"),
                    v = r(a, "wastefull", i),
                    l = 2;
                else if (e.wpt2h)
                    i = e.wpt2h,
                    t = "wpt2h",
                    n = "{0} за час".format(s ? "Самый популярный" : "Самая популярная"),
                    v = r(a, "popular", i),
                    l = 2;
                else {
                    if (e.wpt3h)
                        return;
                    e.wpt4h ? (i = e.wpt4h,
                    t = "wpt4h",
                    n = "{0} за час".format(s ? "Самый удачливый" : "Самая удачливая"),
                    v = r(a, "lottery", i)) : e.wpthh && (i = e.wpthh,
                    t = "wpthh",
                    n = "Ваша комната заняла #{0} место!".format(i),
                    v = app.RoomTopListRewards.roomTeems[i - 1] || 0)
                }
            }
            var c = CDN_PREFIX + "top-list/bg_{0}.png".format(3 < i ? "x" : i)
              , u = CDN_PREFIX + "top-list/top{0}.png".format(3 < i ? "X" : i)
              , p = 1
              , s = CDN_PREFIX + "top-list/{0}_64.png".format(3 < i ? "x" : i);
            if (i) {
                r = "wpthh" === t;
                "wpthh" === t ? (u = CDN_PREFIX + "top-list/wings_icon.png",
                c = CDN_PREFIX + "top-list/bg_gold.png") : n = "&laquo;{0}&raquo;".format(n);
                a = e.rtp;
                try {
                    p = a[t][i],
                    !isNaN(p) && 0 !== p || (p = 1,
                    r = !0)
                } catch (e) {}
                var a = "dialog-win-in-room-top-list"
                  , f = lilo.createView(a);
                f.setModel({
                    currency: l,
                    topId: t,
                    bgImg: c,
                    placeImg: u,
                    placeProgress: p,
                    smallPlaceImg: s,
                    place: i,
                    title: n,
                    prize: v,
                    bonusPerProgress: d,
                    isTopWithoutProgress: r
                }),
                h(f, {
                    dialogClass: "small-close hide-close",
                    dialogCss: {
                        padding: "0px"
                    }
                });
                var m, v = $(document.createElement("div")).addClass("btn green").html("Спасибо").css("margin-top", r ? "0px" : "9px").click(function() {
                    dialogController.close(f)
                });
                f.el.append(v),
                isMobi && (setTimeout(function() {
                    g(f)
                }, 100),
                setTimeout(function() {
                    f.animateBonus(),
                    setTimeout(function() {
                        api.syncBalance(),
                        app.soundManager.play(app.soundManager.SOUND_IDS.COINS_DROP)
                    }, 1e3)
                }, 500)),
                !r && 5 === p && i <= 5 && ((m = lilo.createView(a)).setModel({
                    isExtraBonus: r = !0,
                    topId: t,
                    bgImg: CDN_PREFIX + "top-list/bg_gold.png",
                    placeImg: CDN_PREFIX + "top-list/gold_medal.png",
                    placeProgress: p,
                    smallPlaceImg: s,
                    place: i,
                    title: "Супер-Приз",
                    prize: d,
                    bonusPerProgress: d,
                    isTopWithoutProgress: r
                }),
                2 === l && m.$(".coin-icon-el").removeClass("coin-icon-el").addClass("smart-ruby").css("margin-top", "6px"),
                h(m, {
                    dialogClass: "small-close hide-close",
                    dialogCss: {
                        padding: "0px"
                    }
                }),
                v = $(document.createElement("div")).addClass("btn green").html("Спасибо").css("margin-top", r ? "0px" : "9px").click(function() {
                    dialogController.close(m)
                }),
                m.el.append(v),
                isMobi && (setTimeout(function() {
                    g(m)
                }, 60),
                setTimeout(function() {
                    f.animateBonus(),
                    setTimeout(function() {
                        api.syncBalance(),
                        app.soundManager.play(app.soundManager.SOUND_IDS.COINS_DROP)
                    }, 1e3)
                }, 500)))
            }
        }),
        s.showNameSecretDialog = function(t) {
            if (!util.isVKPlatform()) {
                if (isMobi)
                    return !0;
                t = t || app.info.first_name;
                var i = app.controllers.nameImageGenerator.generateImage(t);
                if (i) {
                    var s, r, n = function() {
                        return app.info.bbsn < 2
                    }, o = function(e) {
                        n() && api.user.incBalance({
                            action_id: 3
                        }, function(e, t) {
                            t && util.isDef(t.balance) && (app.balanceModel.setAttr({
                                balance: t.balance
                            }),
                            t.isUpdated && app.info.bbsn++)
                        }).send(e && e.delay ? e.delay : 0)
                    }, e = "decryptPressed", l = lilo.createView("dialog-name-secret"), a = i.width, d = i.height, c = a / d;
                    775 < i.width && (d = (a = 775) / c),
                    i.style.width = a + "px",
                    i.style.height = d + "px",
                    l.el.width(800),
                    l.els["canvas-wrap"].append(i).width(a),
                    l.els.preview.show(),
                    l.els.result.hide(),
                    l.els["wall-post"].hide();
                    var a = function() {
                        p && OKApi.UI("postMediatopic", {
                            media: [{
                                type: "text",
                                text: "Веселый Дешифратор Имени от игры «Любовь» " + util.createAppLink({
                                    hash: "funnyname"
                                })
                            }, {
                                type: "app",
                                images: [{
                                    url: s,
                                    title: 'Играть в "Любовь"',
                                    mark: "funnyname"
                                }],
                                actions: [{
                                    text: "Веселый Дешифратор Имени от игры «Любовь»",
                                    mark: "funnyname"
                                }]
                            }]
                        }, !1, function(e) {
                            "ok" === e && (f = !0,
                            api.user.secretName.incWallPosts({}, $.noop).send(),
                            o({
                                delay: 2e3
                            }),
                            cAnal.trackEvent({
                                fn_post: 1
                            }),
                            dialogController.close(l)),
                            console.info("wall post", arguments)
                        })
                    }
                      , u = function() {
                        var o = "image/jpeg"
                          , e = i.toDataURL(o, 1)
                          , e = util.getBodyFromB64(e)
                          , a = util.b64toBlob(e, o);
                        !function() {
                            var e = new FormData;
                            e.append("binary", a);
                            var t = {
                                uid: app.info.viewer_id,
                                auth_sig: app.info.auth_sig,
                                session_key: app.info.session_key,
                                app_id: BOOT_DATA.app_id,
                                content_type: o
                            }
                              , i = []
                              , n = "https://sapps-static2.ru/static/secure/cors/saveFNImage?";
                            $.each(t, function(e, t) {
                                util.isDef(t) && i.push(e + "=" + t)
                            }),
                            n += i.join("&"),
                            t = e,
                            $.ajax({
                                url: n,
                                type: "POST",
                                data: t,
                                dataType: "json",
                                processData: !1,
                                contentType: !1,
                                success: function(e) {
                                    200 === e.code ? (e = e.data.url,
                                    s = e,
                                    p && r && l.els["wall-post"].show()) : console.info("error", "api error uploadimage", arguments)
                                },
                                error: function(e, t) {
                                    console.info("error", "xhr error uploadimage", arguments)
                                }
                            })
                        }()
                    }
                      , p = !0
                      , f = !1;
                    l.onRemove(function() {
                        p = !1,
                        f || cAnal.trackEvent({
                            ok_fn_close: 1
                        })
                    }),
                    l.bind("wall-post", a);
                    l.bind("show", function() {
                        util.lStorage.save(e, 1),
                        setTimeout(u, 0),
                        m && (o(),
                        l.animateCoin()),
                        l.showPending(function() {
                            var e;
                            p && (e = t.split("").length,
                            l.startAnimation(e, d / e, function() {
                                p && (r = !0,
                                s && l.els["wall-post"].show())
                            }))
                        })
                    }),
                    dialogController.open(l, {
                        dialogClass: "small-close",
                        dialogCss: {
                            padding: "0px"
                        }
                    });
                    var m = !util.lStorage.find(e) && n();
                    return m && l.el.addClass("can-get-bonus"),
                    !0
                }
                return !1
            }
        }
        ,
        s.communicationBlockedDialog = function() {
            c({
                message: "Вам запрещено писать в чат и оставлять комментарии"
            })
        }
        ,
        window.showNameSecretDialog = function(e) {
            s.showNameSecretDialog(e)
        }
    }
}(),
app.controllers.MainController = function() {
    function t(e) {
        h.handleSelected(e.title),
        i.push(e)
    }
    function f() {
        s(function() {
            (O = D).start(),
            t({
                title: "top"
            })
        })
    }
    function m(e) {
        M.canStart() && s(function() {
            (O = M).start(e),
            t({
                title: "exchange_friends"
            })
        })
    }
    var v, e = "header", h = lilo.createView(e), i = [], n = "other_profile_", g = function(e) {
        s(function() {
            (O = y).start(e),
            t({
                title: "game"
            })
        })
    }, b = function(e) {
        O !== E ? s(function() {
            (O = E).start(e),
            t({
                title: "self_profile"
            })
        }) : e && "go-to-photos" === e.startAction && e.targetPid && O && O.photosController && O.photosController.openPhotos(e.targetPid)
    }, C = function() {
        s(function() {
            (O = A).start({
                onBackPress: function() {
                    o()
                }
            }),
            t({
                title: "room_questions_editor"
            })
        })
    }, _ = function(e) {
        s(function() {
            (O = T).start(e),
            h.hideViralTabHint(),
            t({
                title: "viral"
            })
        })
    }, w = function(e) {
        if (i.length) {
            var t = i[i.length - 1];
            if (t.title === n && t.params.uid === e.uid && !e.skip_invis)
                return void (e && "go-to-photos" === e.startAction && e.targetPid && O && O.photosController && O.photosController.openPhotos(e.targetPid))
        }
        s(function() {
            (O = new app.controllers.ProfileController({
                referrer: e.referrer,
                bootData: v,
                uid: e.uid,
                targetUserData: e.targetUserData,
                ad: e.ad,
                reduceBalance: e.reduceBalance,
                onGetProfileSuccess: e.onGetProfileSuccess,
                targetComment: e.targetComment,
                onBackPress: function() {
                    o()
                },
                onProfileClose: function() {
                    b()
                }
            })).start(e),
            h.handleSelected("nothing"),
            e.skip_invis || i.push({
                title: n,
                params: e
            })
        })
    }, o = function() {
        var e;
        1 < i.length ? (i.pop(),
        (e = i.pop()).title === n ? w(e.params) : l(e.title)) : b()
    }, E = null, y = null, a = null, D = null, T = null, S = null, A = null, I = null, M = null, O = null, s = function(e) {
        O ? O.confirmStop ? O.confirmStop(function() {
            O.stop(),
            e()
        }) : (O.stop(),
        e()) : e()
    };
    window.showOtherProfile = w;
    var r = {
        self_profile: function() {
            O !== E && b()
        },
        room_questions_editor: function() {
            O !== A && C()
        },
        game: function() {
            O !== y && g()
        },
        gameV2: function() {
            O !== a && s(function() {
                (O = a).start(),
                t({
                    title: "gameV2"
                })
            })
        },
        top: function() {
            O !== D && f()
        },
        viral: function() {
            O !== T && _()
        },
        exchange_friends: function() {
            O !== M && m()
        },
        search_users: function() {
            O !== I && s(function() {
                (O = I).start(),
                t({
                    title: "search_users"
                })
            })
        },
        active_comments: function() {
            O !== S && s(function() {
                (O = S).start(),
                t({
                    title: "active_comments"
                })
            })
        }
    };
    function l(e) {
        e = r[e];
        e && e()
    }
    function x() {
        var e = $.Deferred();
        app.info.bootData.playHomeStatus;
        return h.els.tickets.detach(),
        e.resolve(),
        e
    }
    r.notifications = r.active_comments,
    r.exchange = r.exchange_friends,
    h.on("menu-click:" + e, function(e) {
        l(e.extraData.action)
    }),
    h.on("purchase:" + e, function(e) {
        dialogController.purchase({
            currency: e.extraData.currency
        })
    }),
    h.bind("exchange-friends-settings", function() {
        var t = app.commonState.isDepositsDisabled
          , n = lilo.createView("dialog-toggle-deposits");
        n.setModel({
            isChecked: t
        }),
        dialogController.open(n, {
            dialogClass: "no-padding"
        }),
        n.bind("save", function(e) {
            dialogController.close(n);
            var i = e.extraData.checked;
            !i === t && ServerApi("user/deposits/toggle.php", {
                is_disabled: i
            }, function(e, t) {
                util.isDef(t.isMoneyBoxDisabled) && app.commonState.setAttr({
                    isMoneyBoxDisabled: t.isMoneyBoxDisabled,
                    isDepositsDisabled: t.isDepositsDisabled
                }),
                e ? e.code === Codes.ACCESS_DENIED ? t.leftMillis ? dialogController.fadePopup("Вы сможете изменить настройки через " + util.formatMillisToTime(t.leftMillis)) : (dialogController.fadePopup("Доступ запрещен"),
                app.commonState.setAttr({
                    isDepositsDisabledByAdmin: !0,
                    isMoneyBoxDisabled: !0,
                    isDepositsDisabled: !0
                })) : dialogController.showError(e) : (dialogController.fadePopup("Настройка Биржи и Копилки изменена!"),
                e = {},
                i ? e.d2 = 1 : e.d1 = 1,
                cAnal.trackEvent(e))
            })
        })
    }),
    app.eventBus.on(app.EVENTS.INVISIBILITY_EXPIRED, function() {
        v.invisTs = null,
        v.invis = !1,
        v.hp = !1,
        app.eventBus.trigger(app.EVENTS.INVISIBILITY_STATE_CHANGED, {
            invis: !1,
            hp: !1,
            invisTs: 0
        }),
        dialogController.fadePopup({
            message: window.ODR ? "Услуга 'Невидимость' недействительна " : "Подписка на невидимость недействительна"
        })
    });
    var d, c, u, p, R, k, P, N, U, L = function() {
        function e() {
            api.user.incBalance({
                action_id: 6
            }, function(e, t) {
                e || t.balance && app.balanceModel.setAttr({
                    balance: t.balance
                })
            }).send()
        }
        var t, i;
        isMobi ? dialogController.showMessageDialog({
            title: "<div class='gift-icon blue-box'></div><div>Ураа! Ты {0}! За это мы дарим тебе 15 монеток!</div>".format(1 === app.info.sex ? "вернулась" : "вернулся"),
            buttons: [{
                caption: "Получить",
                className: "green-btn",
                handler: function() {
                    return e(),
                    !1
                }
            }],
            isModal: !0
        }) : (t = "dialog-primary-offer",
        (i = lilo.createView(t)).el.find(".dialog-header").html("Ураа! Ты {0}! За это мы дарим тебе 15 монеток!".format(1 === app.info.sex ? "вернулась" : "вернулся")),
        dialogController.open(i, {
            isModal: !0
        }),
        i.$(".btn").html("Получить"),
        i.on("submit:" + t, function() {
            dialogController.close(i),
            e()
        }))
    }, F = function() {
        let i = [15]
          , o = e=>15 === e ? 'У нас для вас подарок за участие в акции "Календарь наград"' : 12 === e ? 'У нас для вас подарок за участие в акции "Новогодняя суета"' : 13 === e ? 'У нас для вас подарок за участие в акции "Снегопад"' : "У нас для вас подарок!"
          , n = async e=>new Promise(t=>{
            VKApi("apps.promoHasActiveGift", {
                promo_id: e
            }, function(e) {
                console.info("apps.promoHasActiveGift", e),
                e && e.response ? t(!0) : t(!1)
            })
        }
        );
        function a() {
            !async function(e) {
                for (var t of i)
                    if (await n(t)) {
                        e(t);
                        break
                    }
            }(e=>{
                !function(e) {
                    function t() {
                        ServerApi("vk/promo/useGift.php", {
                            promo_id: e,
                            method: "POST"
                        }, function(e, t) {
                            e ? dialogController.showError(e) : (dialogController.fadePopup("Вам зачислен бонус +{0} монет!".format(t.bonus)),
                            a())
                        })
                    }
                    {
                        var i, n;
                        isMobi ? dialogController.showMessageDialog({
                            title: o(e),
                            buttons: [{
                                caption: "Получить бонус",
                                className: "green-btn",
                                handler: function() {
                                    return t(),
                                    !1
                                }
                            }]
                        }) : (i = "dialog-primary-offer",
                        (n = lilo.createView(i)).el.find(".ruby").remove(),
                        n.el.find(".dialog-header").html(o(e)),
                        dialogController.open(n),
                        n.on("submit:" + i, function() {
                            dialogController.close(n),
                            t()
                        }))
                    }
                }(e)
            }
            )
        }
        return function() {
            +new Date < +new Date(2022,5,16) && setTimeout(a, 100)
        }
    }(), V = (d = 0,
    c = {},
    u = null,
    p = function(e) {
        var i, t, n = [];
        $.each(e, function(e, t) {
            c[e] || (t.offerId = e,
            n.push(t))
        }),
        n.length && (n.sort(function(e, t) {
            return e.score > t.score ? -1 : 1
        }),
        i = parseInt(n[0].offerId, 10),
        n[0].score < 0 || ((e = app.services.vk.getOffers()).length && $.each(e, function(e, t) {
            if (parseInt(t.id, 10) === i)
                return u = t,
                !1
        }),
        u && (t = h.els.offers.find("i").text("1").css("display", "inline-block").addClass("animated"),
        h.els.offers.css("display", "inline-block"),
        setTimeout(function() {
            t.removeClass("animated")
        }, 600),
        1 === d && R(u.id))))
    }
    ,
    R = function() {
        var e, t, i;
        u && (e = u,
        t = "dialog-primary-offer",
        i = lilo.createView(t),
        c[u.id] = !0,
        i.setModel({
            bonus: e.currency_amount
        }),
        dialogController.open(i),
        i.on("submit:" + t, function() {
            dialogController.close(i),
            k(e.id)
        }),
        h.els.offers.find("i").text("").css("display", "none"))
    }
    ,
    k = function(e) {
        VK.callMethod("showOrderBox", {
            type: "offers",
            currency: 1,
            offer_id: e
        }),
        c[e] = !0,
        api.offersTracker.showOffer({
            offer_id: e
        }, $.noop)
    }
    ,
    isMobi || h.els.offers.click(function() {
        u && (k(u.id),
        h.els.offers.find("i").text("").css("display", "none"))
    }),
    function() {
        isMobi || B()
    }
    );
    function B() {
        var e, t, i, n;
        app.services.vk.isUsersMemberOfDevClubs() || ((e = app.services.vk.getOffers()) && e.length && (i = [],
        n = [],
        $.each(e, function(e, t) {
            t.price < 10 && !c[t.id] && (i.push(t.id),
            n.push(t.price))
        }),
        i.length && (t = {
            offer_ids: i,
            offer_votes: n
        })),
        t && api.offersTracker.getOffersInfo(t, function(e, t) {
            clearTimeout(void 0),
            e || (t = t.response) && (d++,
            p(t))
        }))
    }
    function G() {
        isMobi || P || (P = !0,
        U || $contextArea.prepend(N.show()))
    }
    function H() {
        P && (P = U = !1,
        N.detach().css("visibility", "").hide())
    }
    P = !1,
    N = $(document.createElement("div")).addClass("server-will-reboot").appendTo($body),
    U = !1,
    $(document.createElement("div")).html("Внимание! Идут технические работы. В течение 5 минут сервер будет перезапущен").appendTo(N),
    webSocketController.on(webSocketController.EVENTS.CONNECTION_RESTORE, H),
    webSocketController.on(webSocketController.EVENTS.SERVER_WILL_REBOOT, function(e) {
        (e.willReboot ? G : H)()
    }),
    app.serverRebootPopup = {
        isOpen: function() {
            return P
        },
        close: H,
        open: G
    };
    var W, j = function(e) {
        clearTimeout(W),
        0 < (e = e || -1) && (W = setTimeout(Y, e + 3e4)),
        K(e)
    };
    function K(e) {
        h.onChangeSuperLikeSubscription(0 < e),
        app.info.superLikeTs = util.currentMillis() + e
    }
    function Y() {
        api.user.superlike.check({}, function(e, t) {
            e || K(t.leftMillis)
        }).send()
    }
    var q, z = function(e, t) {
        clearTimeout(q),
        0 < (t = t || -1) && (q = setTimeout(Q, t + 3e4)),
        X(e, t)
    };
    function X(e, t) {
        h.onChangePrivacySubscription(0 < t),
        app.info.profilePrivacySettings = e,
        app.info.profilePrivacySettings.expirationTs = util.currentMillis() + t
    }
    function Q() {
        api.user.privacy.check({}, function(e, t) {
            e || X(t.subscription, t.leftMillis)
        }).send()
    }
    function J() {
        var n;
        if (util.currentMillis() < app.info.superLikeTs) {
            var e = new app.controllers.dialog.InvisSettings({
                bootData: {
                    invisTs: app.info.superLikeTs
                }
            })
              , i = e.dialogView;
            i.$(".options").empty(),
            i.$(".extend-period").remove(),
            i.$(".gray-header, .title.flex-item").html('Настройка режима "СуперЛайк"'),
            i.el.off("extend-period:" + i.id),
            i.el.off("save:" + i.id);
            var t = !!app.info.slE
              , o = t;
            return i.addOption("Включить опцию Тройной голос", o, ['Тройной голос в раунде "Кто больше нравится" (с короной)', 'Тройной голос в раунде "Выбери пару" (для поцелуев)'], function(e) {
                o = e
            }),
            i.bind("save", function() {
                i.model.pending || (o !== t ? api.user.superlike.toggle({
                    beforeSend: function() {
                        i.model.setAttr({
                            pending: !0
                        })
                    }
                }, function(e, t) {
                    i.model.setAttr({
                        pending: !1
                    }),
                    e ? i.isVisible && dialogController.fadePopup("Произошла ошибка. Code:" + e.code) : (app.info.slE = t.slE,
                    i.isVisible && dialogController.fadePopup("Настройки обновлены"),
                    dialogController.close(i),
                    j(t.leftMillis))
                }).send(util.random(100, 300)) : dialogController.close(i))
            }),
            i.createExpirationText = function(e) {
                return "Опция доступна до " + e
            }
            ,
            i.bind("extend-period", function() {
                var e;
                i.model.pending || app.balanceModel.canChange() && ((e = app.balanceModel.balance - 30) < 0 ? dialogController.showInsufficientlyBalanceDialog(e) : api.user.superlike.extend({
                    beforeSend: function() {
                        i.model.setAttr({
                            pending: !0
                        })
                    }
                }, function(e, t) {
                    i.model.setAttr({
                        pending: !1
                    }),
                    util.isDef(t.balance) && app.balanceModel.setAttr({
                        balance: t.balance
                    }),
                    e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : e.code === Codes.LOTTERY_IS_ACTIVE ? (app.eventBus.trigger(app.EVENTS.INVISIBILITY_EXPIRED),
                    dialogController.close(i)) : dialogController.fadePopup("Произошла ошибка. Code:" + e.code) : (i.model.setAttr({
                        expired: t.leftMillis + util.currentMillis()
                    }),
                    j(t.leftMillis))
                }).send(util.random(100, 300)))
            }),
            void e.open()
        }
        window.expController && window.expController.getCurrentLevel() < app.accessLevels.superLike ? dialogController.fadePopup('Подписку на "СуперЛайк" можно купить только с ' + app.accessLevels.superLike + " уровня") : n = dialogController.subscribe({
            model: {
                title: 'Услуга "СуперЛайк"',
                descriptions: [{
                    title: "<b>1 день</b>",
                    price: v.prices.superLike[0],
                    period: 1,
                    subTitles: [{
                        text: "Подключив дaнную услугу, вы получаете уникальные возможности:"
                    }, {
                        text: '1. <b>Бесплатно</b> оценивать музыку в плеере с помощью знака "<i class="cool-hand"></i>&nbsp;Отличный&nbsp;трек" *'
                    }, {
                        text: '2. <b>Тройной</b> голос в раунде "Кто больше нравится" (с короной)'
                    }, {
                        text: '3. <b>Тройной</b> голос в раунде "Выбери пару" (для поцелуев)',
                        __css: {
                            "margin-bottom": "20px"
                        }
                    }, {
                        text: "* Опыт дается только за первые 30 оцененных треков в сутки, остальные оценки нe дают опыт. Себе можно ставить не более 10 раз в сутки",
                        __css: {
                            color: isMobi ? "#444" : "#565656",
                            "line-height": "1",
                            margin: "-10px auto 21px auto"
                        },
                        className: "f_s_11"
                    }]
                }, {
                    title: "<b>Неделя</b> (скидка 30%)",
                    price: v.prices.superLike[1],
                    period: 2
                }, {
                    title: "<b>Месяц</b> (скидка 50%)",
                    price: v.prices.superLike[2],
                    period: 3
                }]
            },
            onOk: function(i) {
                var e = app.balanceModel.balance - i.price;
                if (!(e < 0))
                    return api.user.superlike.buy({
                        requestParams: {
                            period: i.period
                        }
                    }, function(e, t) {
                        n.els.loader.hide(),
                        util.isDef(t.balance) && app.balanceModel.setAttr({
                            balance: t.balance
                        }),
                        e ? e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : e.code === Codes.ALREADY_EXIST ? (dialogController.fadePopup(window.ODR ? "Услугу уже активирована" : "Подписка уже активирована"),
                        j(t.leftMillis)) : dialogController.fadePopup("Произошла ошибка") : (dialogController.fadePopup(window.ODR ? "Услугу активирована" : "Подписка активирована"),
                        app.info.slE = !0,
                        j(t.leftMillis),
                        e = "sl",
                        1 < i.period && (e += "_" + i.period),
                        (t = {})[e] = 1,
                        cAnal.trackEvent(t))
                    }).send(),
                    !1;
                dialogController.showInsufficientlyBalanceDialog(e)
            }
        })
    }
    var Z = function() {
        var e, n, t, o, a, i, s, r, l;
        util.currentMillis() < app.info.profilePrivacySettings.expirationTs ? (e = app.info.profilePrivacySettings,
        n = {
            closedToAll: e.closedToAll,
            closedToInvisible: e.closedToInvisible,
            vkMalesHasAccess: e.vkMalesHasAccess,
            vkFemalesHasAccess: e.vkFemalesHasAccess,
            favMalesHasAccess: e.favMalesHasAccess,
            favFemalesHasAccess: e.favFemalesHasAccess,
            malesHasAccess: e.malesHasAccess,
            femalesHasAccess: e.femalesHasAccess
        },
        t = util.getKeys(n),
        lilo.makeObservable(n),
        o = ["vkMalesHasAccess", "vkFemalesHasAccess", "favMalesHasAccess", "favFemalesHasAccess", "malesHasAccess", "femalesHasAccess"],
        a = function() {
            n.closedToAll && n.setAttr({
                closedToInvisible: !0
            }),
            o.each(function(e, t) {
                var i = {};
                i[t] = !n.closedToAll,
                n.setAttr(i)
            })
        }
        ,
        n.onChange("closedToAll", a),
        n.onChange("closedToInvisible", function() {
            n.closedToInvisible || (n.offChange("closedToAll", a),
            n.setAttr({
                closedToAll: !1
            }),
            n.onChange("closedToAll", a))
        }),
        o.each(function(e, t) {
            n.onChange(t, function() {
                var i;
                n[t] ? (n.offChange("closedToAll", a),
                n.setAttr({
                    closedToAll: !1
                }),
                n.onChange("closedToAll", a)) : (i = !0,
                o.each(function(e, t) {
                    if (n[t])
                        return i = !1
                }),
                i && n.setAttr({
                    closedToAll: !0
                }))
            })
        }),
        i = function(i, e) {
            var t = {
                className: "pl0",
                checkBoxClassName: "float-left",
                checked: n[i],
                title: e,
                onchange: function(e) {
                    var t = {};
                    t[i] = e,
                    n.setAttr(t)
                }
            };
            return n.onChange(i, function(e) {
                t.checkBoxEl.checked = n[i]
            }),
            t
        }
        ,
        s = $(document.createElement("div")).html("Кому <b style='color:#C61717'>закрыт</b> доступ к моему профилю:"),
        r = $(document.createElement("div")).html("Кому <b style='color:#3C913C'>открыт</b> доступ к моему профилю:").css("margin-top", "30px"),
        (l = dialogController.subscriptionSettings({
            model: {
                pending: !1,
                expirationTs: app.info.profilePrivacySettings.expirationTs
            },
            descr: [{
                header: "Настройка доступа к профилю"
            }, {
                expirationText: 'Услуга "Закрытый профиль" доступна до {0}'
            }, {
                expirationTextUpdater: function(e, t) {
                    var i, n = e - util.currentMillis();
                    i = n < 864e5 ? 'До истечения услуги "Закрытый профиль" осталось ' + (i = 0 === (i = Math.floor(n / 36e5)) ? "менее часа" : i + " " + util.pluralize(i, {
                        one: "час",
                        two: "часа",
                        many: "часов"
                    })) : 'Услуга "Закрытый профиль" доступна до {0}'.format(moment(e).format("Do MMMM YYYY")),
                    t.html(i)
                }
            }, {
                extendPrice: 150
            }, {
                subTitle: {
                    $el: s
                }
            }, {
                option: i("closedToAll", "Всем")
            }, {
                option: i("closedToInvisible", "Невидимкам")
            }, {
                subTitle: {
                    $el: r
                }
            }, {
                option: i("malesHasAccess", "Парням, кроме друзей ВК")
            }, {
                option: i("femalesHasAccess", "Девушкам, кроме друзей ВК")
            }, {
                option: i("vkMalesHasAccess", "Друзьям ВК (Парням)")
            }, {
                option: i("vkFemalesHasAccess", "Друзьям ВК (Девушкам)")
            }, {
                option: i("favMalesHasAccess", '"Избранные пользователи" (Парням)')
            }, {
                option: i("favFemalesHasAccess", '"Избранные пользователи" (Девушкам)')
            }]
        })).bind("save", function() {
            var i;
            l.model.pending || (i = !1,
            t.each(function(e, t) {
                if (n[t])
                    return !(i = !0)
            }),
            i ? n.closedToAll !== e.closedToAll || n.closedToInvisible !== e.closedToInvisible || n.vkMalesHasAccess !== e.vkMalesHasAccess || n.vkFemalesHasAccess !== e.vkFemalesHasAccess || n.favMalesHasAccess !== e.favMalesHasAccess || n.favFemalesHasAccess !== e.favFemalesHasAccess || n.malesHasAccess !== e.malesHasAccess || n.femalesHasAccess !== e.femalesHasAccess ? api.user.privacy.update({
                requestParams: {
                    ca: n.closedToAll,
                    ci: n.closedToInvisible,
                    vm: n.vkMalesHasAccess,
                    vf: n.vkFemalesHasAccess,
                    fm: n.favMalesHasAccess,
                    ff: n.favFemalesHasAccess,
                    f: n.femalesHasAccess,
                    m: n.malesHasAccess
                },
                beforeSend: function() {
                    l.model.setAttr({
                        pending: !0
                    })
                }
            }, function(e, t) {
                l.model.setAttr({
                    pending: !1
                }),
                e ? l.isVisible && dialogController.fadePopup("Произошла ошибка. Code:" + e.code) : (l.isVisible && dialogController.fadePopup("Настройки обновлены"),
                dialogController.close(l),
                z(t.subscription, t.leftMillis))
            }).send(util.random(100, 300)) : dialogController.close(l) : dialogController.fadePopup("Выберите хотя бы один вариант!"))
        }),
        l.bind("extend-period", function() {
            var e;
            l.model.pending || app.balanceModel.canChange() && ((e = app.balanceModel.balance - 150) < 0 ? dialogController.showInsufficientlyBalanceDialog(e) : api.user.privacy.extend({
                beforeSend: function() {
                    l.model.setAttr({
                        pending: !0
                    })
                }
            }, function(e, t) {
                l.model.setAttr({
                    pending: !1
                }),
                util.isDef(t.balance) && app.balanceModel.setAttr({
                    balance: t.balance
                }),
                e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : e.code === Codes.LOTTERY_IS_ACTIVE ? (app.eventBus.trigger(app.EVENTS.INVISIBILITY_EXPIRED),
                dialogController.close(l)) : dialogController.fadePopup("Произошла ошибка. Code:" + e.code) : (l.model.setAttr({
                    expirationTs: t.leftMillis + util.currentMillis()
                }),
                z(t.subscription, t.leftMillis),
                cAnal.trackEvent({
                    ps_4: 1
                }))
            }).send(util.random(100, 300)))
        })) : window.expController && window.expController.getCurrentLevel() < app.accessLevels.privacy ? dialogController.fadePopup("Услуга доступна с " + app.accessLevels.privacy + "го уровня") : l = dialogController.subscribe({
            model: {
                title: 'Услуга "Закрытый профиль"',
                descriptions: [{
                    checkBoxes: {
                        title: "Услуга позволяет определить пользователей, которые могут заходить к вам в профиль.",
                        list: []
                    }
                }, {
                    title: "<b>1 день</b>",
                    price: v.prices.privacy[0],
                    period: 1
                }, {
                    title: "<b>Неделя</b> (скидка 30%)",
                    price: v.prices.privacy[1],
                    period: 2
                }, {
                    title: "<b>Месяц</b> (скидка 50%)",
                    price: v.prices.privacy[2],
                    period: 3
                }]
            },
            onOk: function(i) {
                var e = app.balanceModel.balance - i.price;
                if (!(e < 0))
                    return l.els.loader.show(),
                    api.user.privacy.buy({
                        requestParams: {
                            period: i.period
                        }
                    }, function(e, t) {
                        l.els.loader.hide(),
                        util.isDef(t.balance) && app.balanceModel.setAttr({
                            balance: t.balance
                        }),
                        e ? e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : e.code === Codes.ALREADY_EXIST ? (dialogController.fadePopup(window.ODR ? "Услугу уже активирована" : "Подписка уже активирована"),
                        z(t.subscription, t.leftMillis)) : dialogController.fadePopup("Произошла ошибка") : (dialogController.fadePopup(window.ODR ? "Услугу активирована" : "Подписка активирована"),
                        z(t.subscription, t.leftMillis),
                        (t = {})["ps_{0}".format(i.period)] = 1,
                        cAnal.trackEvent(t),
                        Z())
                    }).send(),
                    !1;
                dialogController.showInsufficientlyBalanceDialog(e)
            }
        })
    };
    app.openSuperLikeDialog = J;
    function ee() {
        var n;
        v.invisTs ? new app.controllers.dialog.InvisSettings({
            bootData: v
        }).open() : n = dialogController.subscribe({
            model: {
                title: 'Услуга "Невидимка"<div class="descr-sub-title">Подключив данную услугу вы сможете:<ol class="large"> <li class="item-descr">Отображаться как "Невидимка" в списках гостей</li> <li class="item-descr">Писать анонимные комментарии на страницах</li> <li class="item-descr">Включать опцию "Скрытая игра" (статус офлайн в игре, невидимка в топе и прочих разделах)</li></ol></div>',
                descriptions: [{
                    title: "<b>1 неделя</b>",
                    price: v.prices.invis[0],
                    period: 0
                }, {
                    title: "<b>1 месяц&nbsp;<span class='discount'>(скидка 30%)</span></b>",
                    price: v.prices.invis[1],
                    period: 1
                }]
            },
            onOk: function(e) {
                var t = app.balanceModel.balance - e.price;
                if (!(t < 0)) {
                    var i = api.user.buyInvisible({
                        periodIndex: e.period
                    }, function(e, t) {
                        n.els.loader.hide(),
                        e ? e.code === Codes.INVISIBLE_ALREADY_ACTIVATED ? (app.balanceModel.setAttr({
                            balance: t.balance
                        }),
                        v.invis = t.invis,
                        v.invisTs = t.invisTs,
                        app.eventBus.trigger(app.EVENTS.INVISIBILITY_STATE_CHANGED, {
                            invis: t.invis,
                            invisTs: t.invisTs
                        })) : e.code === Codes.NOT_ENOUGH_BALANCE ? (app.balanceModel.setAttr({
                            balance: t.balance
                        }),
                        dialogController.showInsufficientlyBalanceDialog(t.deficit)) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : errorHandler.show(e, i) : (dialogController.fadePopup(window.ODR ? "Услугу активирована" : "Подписка активирована"),
                        app.balanceModel.setAttr({
                            balance: t.balance
                        }),
                        v.invis = !0,
                        v.invisTs = t.invisTs,
                        app.eventBus.trigger(app.EVENTS.INVISIBILITY_STATE_CHANGED, {
                            invis: !0,
                            invisTs: t.invisTs
                        }))
                    });
                    return i.send(),
                    !1
                }
                dialogController.showInsufficientlyBalanceDialog(t)
            }
        })
    }
    h.on("invise-click:" + e, ee),
    h.on("super-like-click:" + e, J),
    h.on("photos-availability-settings:" + e, function() {
        var n = {
            pending: !1,
            photosIsNotAvailableForRoom: !app.commonState.photosIsAvailableForRoom
        }
          , o = lilo.createView("dialog-photos-availability-settings");
        o.bind("save", function(e) {
            var i = e.extraData.checked;
            i !== !app.commonState.photosIsAvailableForRoom ? (n.setAttr({
                pending: !0
            }),
            ServerApi("photo/updateAvailableForRoomStatus.php", {
                flag: !i
            }, function(e, t) {
                n.setAttr({
                    pending: !1
                }),
                e ? dialogController.showError(e) : (dialogController.fadePopup("Настройки обновлены"),
                app.commonState.setAttr({
                    photosIsAvailableForRoom: !i
                }),
                dialogController.close(o))
            })) : dialogController.close(o)
        }),
        o.setModel(n),
        dialogController.open(o, {
            dialogClass: "no-padding"
        })
    }),
    h.on("privacy-settings-click:" + e, Z);
    var te = function() {
        var e = parseInt(app.info.hash, 10);
        if (!isNaN(e) && e + "" === app.info.hash && (e = util.decodeUid(e)) !== app.info.viewer_id)
            return e
    }();
    function ie() {
        api.user.onGroupSubscribe({}, function(e, t) {
            e ? e.code === Codes.ALREADY_EXIST ? dialogController.fadePopup("Вы уже получали монетки за вступление в группу") : dialogController.fadePopup({
                duration: 6e3,
                message: "Произошла ошибка при получении монеток. Code:" + e.code
            }) : (dialogController.fadePopup("Вам зачислено 5 монет"),
            app.balanceModel.setAttr({
                balance: t.balance
            }))
        }).send()
    }
    function ne(e) {
        if (!(e.sg || e.utc - e.created < 36e5)) {
            var t, i, n = !1, o = 75820678;
            if (app.services.vk.getGroups().each(function(e, t) {
                if (o === t)
                    return !(n = !0)
            }),
            !n) {
                if (isDirect)
                    return t = o,
                    (i = lilo.createView("dialog-group-subscribe")).bind("submit", function() {
                        VK.callMethod("VKWebAppJoinGroup", {
                            group_id: t
                        }, function(e) {
                            e && e.result && ie()
                        }),
                        dialogController.close(i)
                    }),
                    dialogController.open(i),
                    0;
                var a = lilo.createView("dialog-group-subscribe");
                try {
                    dialogController.open(a, {
                        dialogClass: "small-close no-padding"
                    }),
                    setTimeout(function() {
                        VK.Widgets.Subscribe("vk_subscribe_group", {
                            soft: 1
                        }, -o)
                    }, 100)
                } catch (e) {}
                var s = !1;
                a.bind("get-bonus", function() {
                    s || (s = !0,
                    VKApi("groups.isMember", {
                        group_id: o,
                        user_id: app.info.viewer_id
                    }, function(e) {
                        s = !1,
                        e && e.response ? (dialogController.close(a),
                        ie()) : dialogController.fadePopup({
                            message: 'Для получения бонуса необходимо сначала подписаться на группу игры "Любовь".'
                        })
                    }, "5.120"))
                })
            }
        }
    }
    function oe(e) {
        var i, n, t = (e = "string" == typeof e ? JSON.parse(e) : e)[0], o = e[1], a = e[2], s = e[3], r = e[4], e = e[5];
        t !== app.info.giftsVersion && (window.rawGifts = app.models.RawGift.fromArray(JSON.parse(o)),
        window.rawGiftsHash = util.collectArrayInObjectByProperty(rawGifts, "id"),
        a = JSON.parse(a),
        s = JSON.parse(s),
        r = JSON.parse(r),
        e = JSON.parse(e),
        n = i = !1,
        rawGifts.each(function(e, t) {
            t.isForBeginner && (util.isGiftAllowed(app.info.sex, 1, t.sexCombo) && (n = !0),
            util.isGiftAllowed(app.info.sex, 2, t.sexCombo) && (i = !0))
        }),
        app.info.giftsOrder = {
            1: a,
            2: s,
            3: r,
            4: e
        },
        app.info.giftsVersion = t,
        app.info.giftsMeta = {
            hasGiftsForMalesBeginners: i,
            hasGiftsForFemalesBeginners: n
        },
        app.eventBus.trigger(app.EVENTS.ROOM_GIFTS_LIST_UPDATED))
    }
    function ae(t) {
        var e, i, n, o;
        isMobi || (e = $("#footer"),
        app.services.vk.isUsersMemberOfDevClubs() ? app.services.vk.checkPermissions(256, function(e) {
            e && !t.appIsFav && api.user.incBalance({
                action_id: 1
            }, function(e, t) {
                e || t.balance && app.balanceModel.setAttr({
                    balance: t.balance
                })
            }).send()
        }) : (i = "footer-view",
        (n = lilo.createView(i)).setModel({}),
        e.empty().append(n.el).show(),
        n.on("invite-friends:" + i, function(e) {
            VK.callMethod("showInviteBox")
        }),
        n.on("add-to-fav:" + i, function(e) {
            VK.callMethod("showSettingsBox", 256)
        }),
        o = function(e) {
            var t = 1;
            e ? n.els["add-to-fav-area"].show() : (n.els["add-to-fav-area"].hide(),
            --t),
            $contextArea.css("margin-bottom", 40 * t + "px")
        }
        ,
        VK.addCallback("onSettingsChanged", function(e) {
            256 == (256 & e) ? (o(!1),
            t.appIsFav || (t.appIsFav = !0,
            api.user.incBalance({
                action_id: 1,
                beforeSend: ajaxLoader.show
            }, function(e, t) {
                ajaxLoader.hide(),
                e || t.balance && app.balanceModel.setAttr({
                    balance: t.balance
                })
            }).send())) : o(!t.appIsFav)
        }),
        t.appIsFav ? o(!1) : app.services.vk.checkPermissions(256, function(e) {
            e ? (t.appIsFav = !0,
            o(!1)) : o(!0)
        })))
    }
    function se() {
        var t = $.Deferred()
          , e = app.info.bootData;
        if (isMobi)
            return t.resolve(),
            t;
        var i, n, o, a = expController.getCurrentLevel(), s = [], r = function() {
            var e = s.shift();
            e ? (dialogController.open(e, {
                dialogClass: "small-close no-padding"
            }),
            e.onRemove(r)) : t.resolve()
        };
        return !app.info.flags[26] && 10 <= a && (new Date).getTime() < 1546320434841 && (i = {
            title: 'Набор стиков "Хрю"',
            path: "hru",
            items: [2, 3, 5, 7, 9, 11, 12, 13, 15]
        },
        (n = lilo.createView("dialog-stickers-super-victor-preview")).setModel(i),
        s.push(n)),
        e.recentGiftsDialogModel && (a = lilo.createView("dialog-recent-gifts"),
        o = {
            title: e.recentGiftsDialogModel.title,
            gifts: []
        },
        e.recentGiftsDialogModel.gifts.each(function(e, t) {
            t = rawGiftsHash[t];
            t && o.gifts.push({
                price: t.price,
                img: t.img,
                title: t.title
            })
        }),
        o.gifts.length && (a.setModel(o),
        s.push(a))),
        r(),
        t
    }
    function re() {
        var e, t, i, n, o, a;
        e = [],
        t = app.controllers.dialog.Purchase.getStock({
            currency: 1
        }),
        i = app.controllers.dialog.Purchase.getStock({
            currency: 2
        }),
        t && e.push(t),
        i && e.push(i),
        e.sort(function(e, t) {
            return e.isPromo === t.isPromo ? e.currency < t.currency ? -1 : 1 : e.isPromo ? -1 : 1
        }),
        (a = e[0]) && (a.isPromo || 4 < expController.getCurrentLevel()) && (a.type,
        StockType.FIRST_PAYMENT,
        3 !== a.type && o && util.lStorage.save(n, o),
        setTimeout(function() {
            app.controllers.dialog.Purchase.stockPreview(a, {
                className: ""
            })
        }, 100))
    }
    function le() {
        var e = (e = parseInt(app.info.user_id, 10),
        !isNaN(e) && 0 < e && e !== app.info.viewer_id ? e : null)
          , e = {
            targetUserId: te,
            photosLimit: app.controllers.ProfileController.PHOTOS_REQUEST_LIMIT,
            referralUid: e
        };
        api.getBootData(e, function(e, t) {
            if (e)
                e.code === Codes.BANNED ? dialogController.showAccessDeniedDialog(t) : e.code === Codes.USER_IS_DELETED ? dialogController.showAccessDeniedDialog({
                    banReason: -21
                }) : (e.loc = "get boot data",
                dialogController.showError(e));
            else
                try {
                    util.serverUtc(t.utc),
                    app.onGetServerVersion(t.v),
                    app.info.startTime = util.currentMillis(),
                    app.info.mainAppId = t.mainAppId;
                    var i = app.sdk.safeExecuteSequence({
                        onError: function(e, t) {
                            return dialogController.showInitAppError({
                                message: "При загрузке приложения произошла ошибка.<br>error occurred on: {0}<br>{1}<br>{2}".format(e, t.name + " " + t.message, window.ODR ? t.stack : "")
                            }),
                            window.criticalError = !0,
                            console.error(t),
                            window.currentError = t,
                            !1
                        }
                    });
                    i(function() {
                        var i = !1;
                        t.stocks.each(function(e, t) {
                            if (3 === t.type)
                                return !(i = !0)
                        }),
                        util.cache.save("stock-list", t.stocks, i ? 3e4 : 31536e6),
                        app.info.stocks = t.stocks,
                        app.info.roomGiftMelodyId = t.roomGiftMelodyId,
                        app.info.roomGiftKissId = t.roomGiftKissId,
                        app.info.sex = t.sex,
                        app.info.flags = t.flags,
                        app.info.vkPhoto100 = app.info.photo_100,
                        app.info.vkPhoto200 = app.info.photo_200,
                        app.info.photo_100 = t.p100,
                        app.info.photo_200 = t.p200;
                        var e = app.commonState = {
                            pid: t.pid,
                            verified: t.verified,
                            verificationPhoto: t.verificationPhoto,
                            photo100: t.p100,
                            photo200: t.p200,
                            photosIsAvailableForRoom: t.photosIsAvailableForRoom,
                            isMoneyBoxDisabled: t.isMoneyBoxDisabled,
                            isDepositsDisabled: t.isDepositsDisabled,
                            isDepositsDisabledByAdmin: t.isDepositsDisabledByAdmin,
                            lvd: !!t.lvd,
                            gg: 1
                        };
                        lilo.makeObservable(e),
                        e.onChange("photo100", function() {
                            app.info.photo_100 = e.photo100
                        }),
                        e.onChange("photo200", function() {
                            app.info.photo_200 = e.photo200
                        })
                    }),
                    i(function() {
                        z(t.profilePrivacySettings, t.profilePrivacySubscriptionLeftMillis)
                    }),
                    i(function() {
                        var e, i;
                        e = t.favUsers,
                        i = app.info.favUsersUids,
                        $.each(e, function(e, t) {
                            i[t.f] = !0
                        }),
                        app.eventBus.on(app.EVENTS.USER_ADDED_TO_FAV, function(e) {
                            i[e.uid] = !0
                        }),
                        app.eventBus.on(app.EVENTS.USER_REMOVED_FROM_FAV, function(e) {
                            delete i[e.uid]
                        })
                    }),
                    i(function() {
                        var e, i;
                        e = t.blockedUids,
                        i = app.info.blockedUids,
                        $.each(e, function(e, t) {
                            i[t] = !0
                        }),
                        app.eventBus.on(app.EVENTS.USER_BLOCKED, function(e) {
                            i[e.uid] = !0
                        }),
                        app.eventBus.on(app.EVENTS.USER_UNBLOCKED, function(e) {
                            delete i[e.uid]
                        })
                    }),
                    i(function() {
                        oe(t.roomGifts)
                    }),
                    i(function() {
                        window.expController = new app.controllers.ExpController({
                            exp: t.exp,
                            expBoosterLeftTime: t.expBoosterLeftTime || 0
                        })
                    }),
                    i(function() {
                        window.moneyBox = new app.controllers.MoneyBoxController({
                            value: t.moneyBox || 0,
                            headerView: h
                        })
                    }),
                    i(function() {
                        app.soundManager = new app.controllers.AppSoundManager,
                        app.eventBus.trigger(app.EVENTS.SOUND_MANAGER_CREATED)
                    });
                    var n = "viral_tab.already_show";
                    t.canShowViralAnswersTab ? (app.info.canShowBonus = !0,
                    app.info.needShowViralTab = !0,
                    util.lStorage.save(n, "1")) : (util.lStorage.find(n) || 5 <= expController.getCurrentLevel()) && (app.info.canShowBonus = !0),
                    app.info.getLeftTimeOfBanCommunication = function() {
                        return 0 < this.__leftTimeOfBanCommunication ? this.__leftTimeOfBanCommunication - (util.currentMillis() - this.__tsMarker) : -1
                    }
                    ,
                    app.info.setLeftTimeOfBanCommunication = function(e) {
                        this.__tsMarker = util.currentMillis(),
                        this.__leftTimeOfBanCommunication = e
                    }
                    ,
                    app.info.setLeftTimeOfBanCommunication(t.leftTimeOfBanCommunication),
                    v = t,
                    app.info.bootData = t,
                    $body.addClass("app-load"),
                    ae(t),
                    Constants.BONUS_PER_GAME_WIN = t.bonusPerGameWin,
                    app.info.appRefString = v.appRefString || "",
                    app.info.canFN = v.canFN,
                    app.info.canWF = v.canWF,
                    app.info.inWhiteList = v.inWhiteList,
                    app.info.spins = v.spins,
                    app.info.spinsMeta = v.spinsMeta,
                    app.info.spinsGifts = v.spinsGifts,
                    app.info.stickerConfig = v.stickerConfig,
                    app.info.selfBdate = v.bdate,
                    app.info.wpsn = v.wpsn,
                    app.info.bbsn = v.bbsn,
                    app.info.selfRoomId = v.selfRoomId,
                    app.info.hasEmojiSubscribe = v.hasEmojiSubscribe,
                    app.info.isSelfRoomActivated = v.isSelfRoomActivated,
                    app.info.isNewUser = !1,
                    app.info.hasOrders = v.hasOrders,
                    app.info.isAdmin = t.isAdmin,
                    app.info.age = t.age,
                    app.info.countryId = t.countryId,
                    app.info.regionId = t.regionId,
                    app.info.abg = t.abg,
                    app.info.textColor = t.textColor,
                    app.info.rating = t.rating,
                    app.info.timeDiff = (u = t.time,
                    p = new Date,
                    p = new Date(p.getUTCFullYear(),p.getUTCMonth(),p.getUTCDate(),p.getUTCHours(),p.getUTCMinutes(),p.getUTCSeconds()).getTime() - u + -1 * p.getTimezoneOffset() * 60 * 1e3,
                    $.isNumeric(p) ? p : 0),
                    app.info.colorPricePerWeek = t.colorPricePerWeek,
                    app.info.colorPricePerMonth = t.colorPricePerMonth,
                    app.info.colorPricePerYear = t.colorPricePerYear,
                    app.info.warns = t.warns,
                    app.info.freqGiftsData = function() {
                        var i = {};
                        try {
                            JSON.parse(v.roomFreqGifts).each(function(e, t) {
                                i[t._id] = t.v
                            })
                        } catch (e) {}
                        return util.repeat(4, function(e) {
                            i[e += 1] = i[e] || []
                        }),
                        i
                    }(),
                    t.isAdmin && $("body").addClass("is-admin"),
                    app.eventBus.on(app.EVENTS.VIEWER_TEXT_COLOR_CHANGED, function(e) {
                        app.info.textColor = e.textColor
                    }),
                    app.eventBus.trigger(app.EVENTS.GET_BOOT_DATA, {
                        bootData: t
                    }),
                    i(function() {
                        E = new app.controllers.ProfileController({
                            uid: app.info.viewer_id,
                            rating: t.rating,
                            background: t.background,
                            guests: t.guests,
                            photos: t.photos,
                            favUsers: t.favUsers,
                            onSelectProfile: function(e) {
                                w({
                                    uid: e.uid,
                                    onBackPress: function() {
                                        b()
                                    }
                                })
                            },
                            bootData: t
                        })
                    }),
                    i(function() {
                        A = isMobi ? {} : new app.controllers.RoomQuestionsEditor
                    }),
                    i(function() {
                        y = new app.controllers.RoomControllerV3({})
                    }),
                    i(function() {
                        D = new app.controllers.TopListController({
                            onSelectProfile: function(e) {
                                w({
                                    uid: e.uid,
                                    fromTop: !0,
                                    onBackPress: function() {
                                        f()
                                    }
                                })
                            }
                        })
                    }),
                    isMobi ? T = {} : (T = new app.controllers.ViralQuestionsTabController({
                        initialData: v.viralData
                    }),
                    v.isViralTabDisabled || T.fetchData()),
                    app.viralTabController = T,
                    i(function() {
                        S = new app.controllers.ActiveCommentsController({
                            activeComments: t.activeComments,
                            activeCommentsCount: t.activeCommentsCount,
                            notifications: t.notifications,
                            timeOfLastResetNotificationsCounter: t.timeOfLastResetNotificationsCounter
                        })
                    }),
                    i(function() {
                        I = isMobi ? {} : new app.controllers.UsersSearchController({})
                    }),
                    i(function() {
                        M = new app.controllers.ExchangeFriendsController({
                            headerView: h
                        })
                    }),
                    i(function() {
                        app.controllers.RecentLikesController && new app.controllers.RecentLikesController({
                            items: v.recentLikedPhotos
                        })
                    }),
                    window.activeCommentsController = S,
                    window.viralTabController = T,
                    i(function() {
                        0 === S.getUnAnsweredCount().total && h.$(".active-comments").hide()
                    }),
                    i(function() {
                        app.controllers.RecentPrivateMessagesController && (app.recentPrivateMessagesController = new app.controllers.RecentPrivateMessagesController({
                            bootData: v,
                            headerView: h
                        }))
                    });
                    var o = {
                        __locked: !1,
                        lock: function() {
                            this.__locked = !0
                        },
                        unlock: function() {
                            this.__locked = !1
                        },
                        canChange: function(e) {
                            return this.__locked && (e = e && e.message ? e.message : "В данный момент вы не можете тратить монетки",
                            dialogController.fadePopup({
                                message: e,
                                duration: 4e3
                            })),
                            !this.__locked
                        },
                        balance: t.balance,
                        balance2: t.balance2,
                        ruby: t.ruby,
                        bonusCoins: 0,
                        bonusCoins1: 0,
                        bonusCoins2: 0
                    };
                    app.balanceModel = o,
                    i(function() {
                        h.setModel(o)
                    });
                    var a, s = function() {
                        o.setAttr({
                            bonusCoins: T.questionsController.getMaxBonusCoins() + T.answersController.getMaxBonusCoins()
                        })
                    }, r = function() {
                        app.info.viralDataHandled && (clearTimeout(a),
                        a = setTimeout(s, 200))
                    };
                    o.onChange("bonusCoins1", r),
                    o.onChange("bonusCoins2", r),
                    app.eventBus.on(app.EVENTS.BONUS_COINS_UPDATED, r),
                    $contextArea.append(h.el),
                    app.eventBus.on(app.EVENTS.OPEN_ADD_PHOTOS, function() {
                        O === E ? O.photosController && (O.scrollToPhotos(),
                        setTimeout(function() {
                            O.photosController.openAddPhotos()
                        }, 200)) : b({
                            startAction: "add-photos-dialog"
                        })
                    }),
                    app.eventBus.on(app.EVENTS.GO_TO_PHOTOS, function(e) {
                        O === E ? O.scrollToPhotos() : b({
                            startAction: "go-to-photos",
                            targetPid: e && e.pid ? e.pid : null
                        })
                    });
                    var l = !1;
                    app.eventBus.on(app.EVENTS.SHOW_PROFILE, function(i) {
                        i.uid ? 0 < i.uid && (i.uid === app.info.viewer_id ? b(i) : l || (l = !0,
                        ServerApi("user/checkAccess.php", {
                            uid: i.uid
                        }, function(e, t) {
                            l = !1,
                            e ? (e.code === Codes.USER_IN_BLACK_LIST && dialogController.fadePopup("Пользователь ограничил доступ к своему профилю"),
                            e.code === Codes.USER_IS_DELETED && dialogController.fadePopup("Пользователь удален")) : w(i)
                        }))) : util.stackTrace()
                    }),
                    app.eventBus.on(app.EVENTS.SHOW_VIRAL_QUESTIONS, function(e) {
                        O !== T && _(e)
                    }),
                    app.eventBus.on(app.EVENTS.OPEN_EXCHANGE_FRIENDS, function(e) {
                        O !== M && m(e)
                    }),
                    app.eventBus.on(app.EVENTS.JOIN_TO_ROOM, function(e) {
                        e && e.data ? g({
                            onGetRoomData: e.data
                        }) : g()
                    }),
                    app.eventBus.on(app.EVENTS.GO_TO_PRIVATE_ROOM, function(e) {
                        g({
                            private_room_id: e.private_room_id
                        })
                    }),
                    webSocketController.on(webSocketController.EVENTS.WARNS_CHANGE, function(e) {
                        e.uid === app.info.viewer_id && (app.info.warns = e.warns,
                        app.eventBus.trigger("viewer_warns_changed", {
                            warns: e.warns
                        }))
                    }),
                    webSocketController.on(webSocketController.EVENTS.UPDATE_ROOM_GIFTS, function(e) {
                        oe(e.roomGifts)
                    }),
                    app.eventBus.on(app.EVENTS.OPEN_INVIS_PURCHASE_DIALOG, ee),
                    app.eventBus.trigger(app.EVENTS.NUMBER_OF_CLOSED_VIRAL_ANSWERS_CHANGED, {
                        count: t.numberOfClosedAnswers
                    }),
                    app.commonState.onChange("isDepositsDisabled", function() {
                        !isMobi && app.commonState.isDepositsDisabled && O === M && app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                            uid: app.info.viewer_id
                        })
                    }),
                    v.serverWillReboot && app.serverRebootPopup.open();
                    var d = t.refString;
                    i(function() {
                        var e;
                        "guests2" === (e = util.queryParamsToObject(app.info.hash)).ref_id && (e = e.act,
                        util.isDef(e) && (e = "https://apii.ru/api/stat.loveInstall?user_id={0}&act={1}".format(app.info.viewer_id, e),
                        (new Image).src = e))
                    }),
                    i(function() {
                        var o, n, a;
                        o = t,
                        n = function() {
                            if (!webSocketController.isAppOpenInAnotherTab) {
                                if (window.dialogRoomGifts = new app.controllers.dialog.RoomGifts(rawGifts),
                                webSocketController.syncUtc && webSocketController.syncUtc(),
                                util.isDef(o.targetUserData) && !app.info.isNewUser)
                                    app.services.vk.setAppWidth(800),
                                    w({
                                        targetUserData: o.targetUserData,
                                        uid: te,
                                        fromTop: !1,
                                        onBackPress: function() {
                                            b()
                                        }
                                    });
                                else if (app.eventBus.trigger(app.EVENTS.AGE_CHANGED, {
                                    age: app.info.age
                                }),
                                app.canShowViralTab(app.info.age) && o.canShowViralAnswersTab && !isMobi)
                                    app.services.vk.setAppWidth(800),
                                    _({
                                        showAnswers: !0
                                    });
                                else {
                                    var e = !1;
                                    if (!app.commonState.verified)
                                        if (isMobi) {
                                            if ("/verify" === document.location.pathname && app.canVerifyPhotos(app.info.age) && !IS_IOS) {
                                                b({
                                                    startAction: "verify"
                                                }),
                                                e = !0;
                                                try {
                                                    history.replaceState({}, document.title, "/")
                                                } catch (e) {}
                                            }
                                        } else
                                            "verify" === app.info.hash && (app.info.hash = "",
                                            VK.callMethod("setLocation", ""),
                                            b({
                                                startAction: "verify"
                                            }),
                                            e = !0);
                                    e || (g(),
                                    function(t) {
                                        try {
                                            let e = !0;
                                            isMobi && t.hasBonusForAbsence && (e = !1),
                                            e && function() {
                                                var e = $.Deferred();
                                                return e.resolve(),
                                                e
                                            }().then(x).then(se).then(de).then(re)
                                        } catch (e) {
                                            GA.trackJSException(e, "initApp")
                                        }
                                    }(o)),
                                    isMobi && mobiUiHelper.toggleWhiteBG(!0)
                                }
                                var t, i, n;
                                v.bonusForNewLevel && setTimeout(function() {
                                    var e = expController.getCurrentLevel();
                                    dialogController.levelCompleteDialog(e, {
                                        roomView: roomView,
                                        balanceBonus: e,
                                        rubyBonus: v.rubyBonusForNewLevel
                                    })
                                }, 200),
                                app.eventBus.on(app.EVENTS.USER_EXIT_FROM_ROOM, function() {
                                    $contextArea.empty();
                                    dialogController.showMessageDialog({
                                        message: "Приложение закрыто. <br> Возможно, вы открыли приложение в другой вкладке или окне браузера",
                                        noClose: !0
                                    });
                                    $("#app").css("background", "none")
                                }),
                                app.eventBus.on(app.EVENTS.WANT_TO_AD_LIST, function() {
                                    b({
                                        openAdDialog: !0
                                    })
                                }),
                                app.eventBus.on(app.EVENTS.OPEN_EDITOR, function() {
                                    C()
                                }),
                                ne(o),
                                isMobi || v.isViralTabDisabled || (t = 0,
                                n = function() {
                                    clearTimeout(i),
                                    T.dataIsFetched() ? T.canAnswer() && app.balanceModel.bonusCoins && (t++,
                                    h.showViralTabHint(),
                                    setTimeout(function() {
                                        h.hideViralTabHint()
                                    }, 1e4),
                                    t < 3 && (i = setTimeout(n, 3e5))) : (T.fetchData(),
                                    i = setTimeout(n, 3e5))
                                }
                                ,
                                setTimeout(function() {
                                    T.dataIsFetched() || T.fetchData()
                                }, 2e4),
                                i = setTimeout(n, 12e4)),
                                appCommunicator.start(),
                                V(),
                                F(),
                                o.hasBonusForAbsence && L(),
                                $body.on(IS_DESKTOP ? "click" : "touchstart", ".open-app-profile", function(e) {
                                    e = e.target,
                                    e = parseInt(e.getAttribute("app-profile-id"), 10);
                                    e && !isNaN(e) && (e = util.decodeUid(e),
                                    app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                                        uid: e
                                    }))
                                }),
                                new app.controllers.UIActivityHandler,
                                setTimeout(function() {}, 100),
                                app.eventBus.trigger(app.EVENTS.APP_INIT)
                            }
                        }
                        ,
                        (a = function() {
                            if (!(app.viewerIsBeginner() || app.info.countryId && app.info.regionId))
                                return new app.controllers.dialog.Regions({
                                    onComplete: a
                                }),
                                !1;
                            if (!app.info.age || 100 < app.info.age || app.info.age < 1)
                                return dialogController.ageDialog({
                                    onComplete: a,
                                    isModal: !0
                                }),
                                !1;
                            app.controllers.webSocketController.start();
                            var e, t = !0;
                            function i() {
                                webSocketController.isAppOpenInAnotherTab || (app.info.spins || 5 === v.freeSpinGifts ? e.openWheelDialog({
                                    freeSpinGifts: v.freeSpinGifts,
                                    onClose: n
                                }) : n())
                            }
                            (t = window.isExternal || window.ODR || isMobi && !isDirect ? !1 : t) ? (e = new app.controllers.dialog.WheelOfFortune,
                            v.canWF ? v.spinGiftsArray.length && !isMobi ? e.openReceivedGiftsDialog(v.spinGiftsArray, {
                                onClose: i
                            }) : i() : n()) : n()
                        }
                        )()
                    }),
                    app.info.slE = t.slE,
                    i(function() {
                        j(t.slTs)
                    });
                    var c = isMobi && !isDirect ? {
                        pageViewMobi: 1,
                        uniqPageViewMobi: 1
                    } : {
                        pageView: 1,
                        uniqPageView: 1
                    };
                    "viral_post" === d ? c.viralPostComing = 1 : "user_referral_link" === d && (c.fe_app_coming = 1),
                    d && (t.isNewUser ? c[d + "_new_users"] = 1 : c[d + "_app_coming"] = 1),
                    cAnal.trackEvent(c)
                } catch (e) {
                    dialogController.showInitAppError({
                        jsException: e
                    }),
                    GA.trackJSException(e, "onGetBootData"),
                    console.error(e),
                    window.currentError = e
                }
            var u, p
        }).send()
    }
    function de() {
        var e = app.info.bootData
          , t = $.Deferred();
        if (isMobi)
            return t.resolve(),
            t;
        var i, n, o, d, c, u, p, f = e.magicLink;
        return f ? (i = function() {
            dialogController.showMessageDialog({
                message: "Волшебная ссылка, по которой вы прошли, неактивна"
            }).onRemove(function() {
                t.resolve()
            })
        }
        ,
        n = function() {
            dialogController.showMessageDialog({
                message: "Упс! Монетки по этой бонусной ссылке уже закончились."
            }).onRemove(function() {
                t.resolve()
            })
        }
        ,
        o = function() {
            dialogController.showMessageDialog({
                message: "Упс! Вы уже получали монетки по этой бонусной ссылке"
            }).onRemove(function() {
                t.resolve()
            })
        }
        ,
        f.active ? f.isBonusReceived ? o() : f.hasBonus ? (d = function(t, i, n) {
            n = n || 0,
            n += 1,
            VKApi("wall.get", {
                offset: i,
                count: 100,
                filter: "owner"
            }, function(e) {
                e.response && e.response.items ? t(e.response.items, e.response.count) : 4 < n ? t(null) : setTimeout(function() {
                    d(t, i, n)
                }, 100)
            }, "5.120")
        }
        ,
        c = function() {
            ServerApi("magiclink/bonus.php", {
                hash: f.hash
            }, function(e, t) {
                e ? e.code === Codes.NOT_FOUND ? i() : e.code === Codes.LIMIT ? n() : e.code === Codes.ALREADY_EXIST ? o() : dialogController.showError(e) : (api.syncBalance(),
                dialogController.fadePopup("Вам начислено {0} {1}".format(f.bonus, util.pluralize(f.bonus, "монета", "монеты", "монет"))))
            })
        }
        ,
        u = function(t, i) {
            i = i || 0;
            var e = f.wallLink.substr(4).split("_");
            i += 1,
            VKApi("likes.isLiked", {
                type: "post",
                owner_id: e[0],
                item_id: e[1]
            }, function(e) {
                e.response ? t(e.response.liked) : 4 < i ? t(!1) : setTimeout(function() {
                    u(t, i)
                }, 100)
            }, "5.120")
        }
        ,
        (p = function() {
            var e = lilo.createView("dialog-primary-offer");
            e.$(".dialog-header").html(f.text),
            e.bind("submit", function() {
                f.wallLink ? (dialogController.fadePopup("Проверяем стену..."),
                setTimeout(function() {
                    var i, n, o, e, a, s, r, l;
                    i = function(e) {
                        e.error ? dialogController.fadePopup("Не удалось получить данные о репосте") : e.success ? c() : dialogController.showMessageDialog({
                            message: "Для  получения подарка необходимо поставить <b>лайк</b> и сделать <b>репост</b> записи из группы",
                            buttons: [{
                                caption: "Перейти к записи",
                                handler: function() {
                                    try {
                                        window.open("https://vk.com/" + f.wallLink, "_blank").focus()
                                    } catch (e) {}
                                    return p(),
                                    !1
                                }
                            }]
                        })
                    }
                    ,
                    o = n = 0,
                    e = f.wallLink.substr(4).split("_"),
                    a = parseInt(e[0], 10),
                    s = parseInt(e[1], 10),
                    r = !1,
                    (l = function() {
                        o += 1,
                        d(function(e, t) {
                            e ? (e.each(function(e, t) {
                                t = t.copy_history;
                                if (t && t.length && t.each(function(e, t) {
                                    if (t.from_id === a && t.id === s)
                                        return !(r = !0)
                                }),
                                r)
                                    return !1
                            }),
                            n += e.length,
                            r ? u(function(e) {
                                i({
                                    success: e
                                })
                            }) : o < 10 && n < t ? l() : i({
                                success: !1
                            })) : i({
                                error: !0
                            })
                        }, n)
                    }
                    )()
                }, 600)) : c(),
                dialogController.close(e)
            }),
            dialogController.open(e),
            e.onRemove(function() {
                t.resolve()
            })
        }
        )()) : n() : i()) : t.resolve(),
        t
    }
    !function() {
        try {
            var e = {
                viewerId: app.info.viewer_id,
                date: util.formatDate(),
                followers: app.info.followersUids,
                coming: 0,
                leave: 0,
                total: app.info.followersUids.length
            };
            app.info.followersStat = e
        } catch (e) {}
    }();
    function ce() {
        "pay" !== app.info.hash || isMobi ? le() : (app.info.startTime = +new Date,
        ServerApi("user/get.php", {
            uids: app.info.viewer_id,
            fields: "exp"
        }, function(e, t) {
            !e && t && t.list && t.list.length && (window.expController || (window.expController = {
                getCurrentExp: function() {
                    return t.list[0].exp
                }
            })),
            dialogController.purchase({
                fromMobi: !0,
                onDialogRemove: function() {
                    var e = $(document.createElement("div")).addClass("btn red2 start-app-btn").html("Начать игру")
                      , t = $appLoader.find("span");
                    t.hide(),
                    $appLoader.append(e),
                    e.click(function() {
                        t.css("display", "block"),
                        le(),
                        e.remove()
                    })
                }
            })
        }))
    }
    var ue, pe;
    "testserv1.ru" === document.location.host ? (ue = "testserv-pass",
    "852" === util.lStorage.find(ue) ? ce() : ((pe = lilo.createView("dialog-enter-keyword")).$(".dialog-header").html("Введите кодовое слово"),
    dialogController.open(pe, {
        isModal: !0
    }),
    pe.bind("submit", function(e) {
        "852" === e.extraData.value ? (util.lStorage.save(ue, "852"),
        dialogController.close(pe),
        ce()) : pe.showErrorHint()
    }))) : ce()
}
,
function() {
    app.controllers.ProfileBGUploader = function(o) {
        (new app.controllers.ImageUploader).saveImage({
            base64: o.base64
        }, function(e, t) {
            var i, n;
            e ? (e.loc = "profile. onSelectImage",
            errorHandler.showError(e)) : (t = t[0]) && (i = util.get604Photo(t),
            (n = api.user.updateBg({
                imgUrl: i
            }, function(e, t) {
                e ? (e.loc = "profile. update bg",
                errorHandler.showError(e, n)) : o.onSuccess(i)
            })).send())
        })
    }
}(),
app.controllers.PhotosControllers = function(i) {
    var e = "photos-view"
      , t = "item-photo"
      , r = 2
      , n = lilo.createView(e)
      , o = []
      , a = {
        photos: [],
        hasMorePhotos: !1,
        uid: i.profileModel.uid
    }
      , s = function(i) {
        var n = !1;
        a.photos.each(function(e, t) {
            if (!1 === i(e, t))
                return !(n = !0)
        }),
        n || o.each(function(e, t) {
            if (!1 === i(e, t))
                return !(n = !0)
        })
    }
      , l = i.isSelfProfile
      , d = i.profileModel.uid
      , c = function(e) {
        for (var t = (e = e || {}).limit || 12, i = []; i.length !== t; ) {
            var n = o.shift();
            if (!n)
                break;
            i.push(n)
        }
        a.photos.add(i),
        a.setAttr({
            hasMorePhotos: !!o.length
        })
    };
    function u(e) {
        this.id = e._id || e.id,
        this.status = e.s,
        this.ownerId = d,
        this.rejectReasonId = e.r,
        this.url = util.fixVkUrl(e.u),
        this.crop = e.c,
        this.pending = !1,
        this.isAvatar = !1,
        this.c1 = e.c1 || 0,
        this.c2 = e.c2 || 0,
        this.c3 = e.c3 || 0,
        this.c4 = e.c4 || 0,
        this.c5 = e.c5 || 0,
        this.c6 = e.c6 || 0,
        this.likeType = e.likeType || 0,
        this.liked = 0 < this.likeType
    }
    function p(e) {
        c(e)
    }
    function f(e) {
        var t = e.extraData.model
          , e = a.photos.indexOf(t);
        e < 0 && -1 !== (e = o.indexOf(t)) && (e += a.photos.length),
        e < 0 && (e = 0);
        var i = []
          , t = function(e, t) {
            i.push(t)
        };
        a.photos.each(t),
        o.each(t);
        var n = {
            index: e,
            photos: i
        }
          , l = lilo.createView("dialog-photos-gallery");
        l.setModel(n),
        dialogController.open(l, {
            dialogClass: "small-close no-padding",
            mobiFullHeight: 1
        }),
        l.onRemove(function() {
            n.photos.removeAll()
        }),
        l.bind("like", function(e) {
            if (!_) {
                var n = e.extraData.type
                  , o = e.extraData.photo
                  , a = o.id
                  , s = d
                  , r = 1 !== n;
                if (r) {
                    e = app.balanceModel.balance - 1;
                    if (e < 0)
                        return void dialogController.showInsufficientlyBalanceDialog(e, {
                            onChangeWindow: function() {
                                dialogController.close(l)
                            }
                        })
                }
                l.el.addClass("like-pending"),
                _ = !0,
                ServerApi("photo/like.php", {
                    ts: util.currentMillis(),
                    pid: a,
                    owner_id: s,
                    type: n,
                    encypt_arr: ["pid", "owner_id", "ts"]
                }, function(e, t) {
                    var i;
                    l.el.removeClass("like-pending"),
                    _ = !1,
                    r && t && util.isDef(t.balance) && app.balanceModel.setAttr({
                        balance: t.balance
                    }),
                    e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit, {
                        onChangeWindow: function() {
                            dialogController.close(l)
                        }
                    }) : e.code === Codes.ALREADY_EXIST ? (dialogController.fadePopup("Вы уже ставили лайк"),
                    o.setAttr({
                        liked: !0,
                        likeType: n
                    })) : dialogController.showError(e) : (o.setAttr({
                        liked: !0,
                        likeType: n
                    }),
                    (e = {})["c" + n] = o["c" + n] + 1,
                    o.setAttr(e),
                    r && t.exp && (i = d === app.info.viewer_id ? 30 : 20,
                    i = expController.applyBooster(i),
                    expController.setRealExp(t.exp),
                    expController.animateBonus({
                        disableAnimation: !0,
                        incValue: i
                    }),
                    dialogController.fadePopup("Вам зачислено +{0} очков рейтинга".format(i))),
                    app.eventBus.trigger(app.EVENTS.LIKE_PHOTO, {
                        url: o.url,
                        likeType: n,
                        pid: a,
                        ownerId: s
                    }),
                    (i = {})[r ? "pl2" : "pl1"] = 1,
                    cAnal.trackEvent(i))
                })
            }
        })
    }
    n.setModel(a);
    var m = !1;
    function v(e) {
        var s;
        m || (s = e.extraData.model,
        (e = new Image).onload = function() {
            s.setAttr({
                pending: !1
            }),
            app.controllers.dialog.ImageCropper({
                url: s.url,
                onCrop: function(n, o) {
                    var a;
                    m || (console.info(arguments),
                    s.setAttr({
                        pending: !0
                    }),
                    a = function(e) {
                        return parseInt(e, 10)
                    }
                    ,
                    function() {
                        var e = {
                            app_id: app.info.api_id,
                            auth_key: app.info.auth_key,
                            uid: app.info.viewer_id,
                            verification: !1,
                            id: s.id,
                            fx: a(n.x),
                            fy: a(n.y),
                            fw: a(n.width),
                            fh: a(n.height),
                            dx: a(o.x),
                            dy: a(o.y),
                            dw: a(o.width),
                            dh: a(o.height)
                        };
                        app.info.session && (e.expire = app.info.session.expire,
                        e.mid = app.info.session.mid,
                        e.secret = app.info.session.secret,
                        e.sid = app.info.session.sid,
                        e.sig = app.info.session.sig),
                        window.isExternal && (e.external_access_key = app.apiPrimaryParams.access_token,
                        e.app_id = BOOT_DATA.app_id);
                        let t = document.location.protocol;
                        window.ODR && (t = "https:");
                        var i = t + "//sapps-static1.ru/static/secure/cors/upload";
                        m = !0,
                        $.ajax({
                            url: i,
                            type: "POST",
                            data: e,
                            dataType: "json",
                            timeout: 2e4,
                            success: function(e) {
                                s.setAttr({
                                    pending: !1
                                }),
                                m = !1,
                                200 === e.code ? (dialogController.fadePopup("Аватар обновлен!"),
                                app.commonState.setAttr({
                                    pid: s.id,
                                    verified: !0,
                                    photo100: e.data.url,
                                    photo200: e.data.url
                                })) : dialogController.showMessageDialog({
                                    message: "Произошла ошибка:<br>Code:{0}{1}".format(e.code, e.data ? "<br>" + JSON.stringify(e.data) : e.message ? "<br>" + e.message : "")
                                })
                            },
                            error: function(e) {
                                s.setAttr({
                                    pending: !1
                                }),
                                m = !1,
                                dialogController.showMessageDialog({
                                    message: "Произошла ошибка.  Status:" + e.status
                                })
                            }
                        })
                    }())
                }
            })
        }
        ,
        e.onerror = function() {
            s.setAttr({
                pending: !1
            })
        }
        ,
        s.setAttr({
            pending: !0
        }),
        e.src = s.url)
    }
    var h = !1
      , g = 3
      , b = function() {
        dialogController.showMessageDialog({
            message: "На проверку вы можете отправить максимум {0} фото".format(g)
        })
    }
      , C = function(i) {
        function e(e, t) {
            t.status === i && n++
        }
        var n = 0;
        return a.photos.each(e),
        o.each(e),
        n
    };
    n.on("load-photos:" + e, p),
    n.on("open-photo:" + t, f),
    n.on("delete-photo:" + t, function(e) {
        var i = e.extraData.model;
        l && (i.setAttr({
            pending: !0
        }),
        ServerApi("photo/remove.php", {
            id: i.id
        }, function(e, t) {
            i.setAttr({
                pending: !1
            }),
            e ? dialogController.showError(e) : (a.photos.remove(i),
            p({
                limit: 1
            }),
            app.eventBus.trigger(app.EVENTS.PHOTOS_CHANGED))
        }))
    }),
    n.on("send-to-moderation:" + t, function(e) {
        if (!h) {
            if (C(r) >= g)
                return b();
            var s = e.extraData.model;
            s.setAttr({
                pending: !0
            }),
            h = !0,
            ServerApi("photo/verify.php", {
                id: s.id
            }, function(e, t) {
                if (h = !1,
                s.setAttr({
                    pending: !1
                }),
                e)
                    switch (e.code) {
                    case Codes.ACCESS_DENIED:
                        var i = !1;
                        try {
                            var n, o, a = t.leftMillis;
                            0 < a && (n = new Date(+new Date + a),
                            o = Constants.PHOTO_VERIFICATION_BLOCK_TEXT + util.formatDate(+n, function(e, t, i, n, o) {
                                return e + "." + t + "." + i + " " + n + ":" + o
                            }),
                            dialogController.showMessageDialog({
                                message: o
                            }),
                            i = !0)
                        } catch (e) {}
                        i || (isDirect && !isMvk ? dialogController.showMessageDialog({
                            message: "Для отправки фотографии на проверку необходимо пройти первый шаг вeрификации",
                            buttons: [{
                                caption: "Закрыть",
                                handler: function(e) {
                                    return dialogController.showMessageDialog({
                                        message: "Верификация доступна только в десктоп версии игры",
                                        buttons: [{
                                            caption: "Закрыть",
                                            handler: function(e) {
                                                return !1
                                            }
                                        }]
                                    }),
                                    !1
                                }
                            }]
                        }) : dialogController.showMessageDialog({
                            message: "Для отправки фотографии на проверку необходимо пройти первый шаг вeрификации",
                            buttons: [{
                                caption: "Пройти вeрификацию",
                                handler: function(e) {
                                    return new app.controllers.dialog.VerificationStatus,
                                    !1
                                }
                            }]
                        }));
                        break;
                    case Codes.DAILY_LIMIT_EXCEEDED:
                        dialogController.fadePopup("Вы сможете отправить фото на проверку через " + util.formatMillisToTime(t.leftMillis));
                        break;
                    case Codes.LIMIT:
                        b();
                        break;
                    default:
                        dialogController.showError(e)
                    }
                else
                    s.setAttr({
                        pending: !1
                    }),
                    s.setAttr({
                        status: r
                    }),
                    cAnal.trackEvent({
                        p_4: 1
                    })
            })
        }
    }),
    n.on("set-as-avatar:" + t, v),
    n.on("add-photo:" + e, function() {
        var i = 0
          , n = {};
        s(function(e, t) {
            i++,
            n[t.url] = !0
        });
        30 <= i ? dialogController.fadePopup("Вы добавили максимальное количество фото") : new app.controllers.SelectPhotosController({
            maxSelectedPhotosSize: Math.min(10, 30 - i),
            urlHash: n,
            onAddPhotos: function(e) {
                e = util.createModels(e, u);
                e.sort(function(e, t) {
                    return e.id > t.id ? -1 : 1
                }),
                a.photos.add(e, 0)
            }
        }).start()
    });
    var _ = !1;
    this.openAddPhotos = function() {
        n.trigger("add-photo")
    }
    ,
    this.setPhotoAsAvatar = v,
    this.findPhoto = function(i) {
        E();
        var n = null;
        return s(function(e, t) {
            if (t.id === i)
                return n = t,
                !1
        }),
        n
    }
    ;
    var w = !(this.openPhotos = function(e) {
        e = this.findPhoto(e);
        (e = e || a.photos[0]) && f({
            extraData: {
                model: e
            }
        })
    }
    );
    function E() {
        var t, e;
        w || (w = !0,
        i.photos && i.photos.length && (o = util.createModels(i.photos, u)).sort(function(e, t) {
            return e.id > t.id ? -1 : 1
        }),
        p(),
        i.$container.append(n.el),
        l && (t = function(e) {
            app.canVerifyPhotos(e) ? i.$container.append(n.el) : n.el.detach()
        }
        ,
        app.eventBus.on(app.EVENTS.AGE_CHANGED, function(e) {
            t(e.age)
        }),
        t(app.info.age),
        (e = function() {
            var n = app.commonState.pid;
            s(function(e, t) {
                var i = t.id === n;
                t.__isObservable ? t.setAttr({
                    isAvatar: i
                }) : t.isAvatar = i
            })
        }
        )(app.commonState.pid),
        app.commonState.onChange("pid", e),
        app.eventBus.trigger(app.EVENTS.PHOTOS_CHANGED)))
    }
    this.init = E,
    this.canAddFirstPhoto = function() {
        E();
        var i = !0;
        return s(function(e, t) {
            if (3 === t.status || t.status === r)
                return i = !1
        }),
        i
    }
    ,
    this.hasPublicPhotos = function() {
        E();
        var i = !1;
        return s(function(e, t) {
            if (3 === t.status)
                return !(i = !0)
        }),
        i
    }
    ,
    l && (app.eventBus.on(app.EVENTS.INC_PHOTO_LIKE_COUNTER, function(e) {
        var n = e.pid
          , o = "c" + e.type;
        E(),
        s(function(e, t) {
            if (t.id === n) {
                var i = {};
                return i[o] = (t[o] || 0) + 1,
                t.__isObservable ? t.setAttr(i) : $.extend(t, i),
                !1
            }
        })
    }),
    webSocketController.on(webSocketController.EVENTS.ADMIN_REVIEW_PHOTO, function(e) {
        var i = new u(e.photo);
        s(function(e, t) {
            if (t.id === i.id)
                return t.__isObservable ? t.setAttr(i) : $.extend(t, i),
                !1
        }),
        app.eventBus.trigger(app.EVENTS.PHOTOS_CHANGED)
    }),
    webSocketController.on(webSocketController.EVENTS.ADD_PHOTOS, function(e) {
        e.photos.each(function(e, t) {
            t = new u(t);
            a.photos.add(t, 0)
        }),
        app.eventBus.trigger(app.EVENTS.PHOTOS_CHANGED)
    }),
    webSocketController.on(webSocketController.EVENTS.ADMIN_REJECT_PHOTOS, function(e) {
        var i = util.collectArrayInObjectByProperty(e.ids);
        s(function(e, t) {
            i[t.id] && (t.__isObservable ? t.setAttr({
                rejectReasonId: -1,
                status: 4
            }) : (t.rejectReasonId = -1,
            t.status = 4))
        })
    }))
}
,
function() {
    function n(e) {
        var t = e.uid
          , i = e.canPost
          , n = e.onComplete
          , o = e.message
          , a = e.notificationMessage
          , e = e.attachment;
        i ? app.services.vk.wallPost({
            onComplete: function(e) {
                var t, i = !1;
                e.success ? i = !0 : e.block ? t = "Не удалось разместить запись на стене" : e.cancel || e.error && (t = "Произошла ошибка, при размещении записи на стене"),
                n({
                    isSuccess: i
                }),
                t && dialogController.fadePopup({
                    message: t,
                    duration: 4e3
                })
            },
            uid: t,
            attachment: e,
            message: o
        }) : app.services.vk.sendNotification({
            onComplete: function(e) {
                var t, i = !1;
                e.success ? i = !0 : e.block ? t = "Не удалось отправить уведомление" : e.cancel || e.fail && (t = "Произошла ошибка, при отправке уведомления"),
                n({
                    isSuccess: i
                }),
                t && dialogController.fadePopup({
                    message: t,
                    duration: 4e3
                })
            },
            uid: t,
            message: a
        })
    }
    app.socialSpecificMethods = {
        exchangeFriends: {
            getFriends: function(t) {
                t = t || $.noop;
                var i = "exchange_friends_searchFriends"
                  , n = util.cache.find(i);
                if (n)
                    return t(n),
                    n;
                var e = 0
                  , o = function() {
                    3 <= ++e ? t(null) : VKApi("friends.search", {
                        count: 1e3,
                        fields: "photo_100,can_post,bdate"
                    }, function(e) {
                        e && e.response && 0 !== (n = e.response.items).length ? (n.each(function(e, t) {
                            t.fullName = t.first_name + " " + t.last_name
                        }),
                        util.cache.save(i, n, 864e5, {
                            serializeObject: !1
                        }),
                        t(n)) : o()
                    }, "5.120")
                };
                o()
            }
        },
        wheelOfFortune: {
            sendSpinsToFriend: function(e, t) {
                n({
                    uid: e.id,
                    canPost: e.can_post,
                    attachment: "photo-75820678_374753657",
                    message: "Лови в подарок бесплатные вращения в Колесе Фортуны! Желаю удачи и Жду в ответ :) " + util.createAppLink(),
                    notificationMessage: "Лови в подарок бесплатные вращения в Колесе Фортуны! Желаю удачи и Жду в ответ :) ",
                    onComplete: t
                })
            },
            reply: function(e, t, i) {
                n({
                    uid: e,
                    canPost: t,
                    attachment: "photo-75820678_374753659",
                    message: "Спасибо за вращения! Лови в ответ " + util.createAppLink(),
                    notificationMessage: "Спасибо за вращения! Лови в ответ ",
                    onComplete: i
                })
            }
        }
    }
}(),
app.controllers.dialog.VerificationPhoto = function(e) {
    e = e || {};
    var s, r = lilo.createView("dialog-verification-photo"), c = {
        title: "",
        viewerAvatar: app.info.photo_200 || app.info.photo_100,
        viewerName: app.info.first_name + " " + app.info.age,
        pending: !1,
        resultImg: null,
        viewerAvatarWithRect: null,
        isWebCamPlay: !1,
        denyReasonText: "",
        verificationId: null
    }, u = 2;
    function l() {
        c.setAttr({
            viewerAvatar: app.info.photo_200 || app.info.photo_100,
            title: "Верификация вашего профиля"
        }),
        r.showSlide(4)
    }
    function d(e) {
        c.setAttr({
            title: "Верификация вашего профиля",
            viewerAvatarWithRect: e,
            resultImg: app.commonState.verificationPhoto.u
        }),
        r.showSlide(5)
    }
    function t(e) {
        var l;
        c.setAttr({
            title: "Сделать фото с жестом",
            resultImg: null,
            isWebCamPlay: !1,
            verificationId: (e = e || {}).verificationId || util.random(1, 4)
        }),
        r.showSlide(3);
        var d = n();
        r.els["video-wrap"].empty().append(d);
        (i = new app.sdk.WebCamController({
            width: 600,
            video: d,
            onError: o,
            onCameraAccessDenied: o,
            onStartPlay: function() {},
            onCanPlay: function() {
                var e, t, i = d.videoWidth, n = d.videoHeight, o = 180, a = 180;
                isMobi && ((e = appWidth) < (t = .3 * appWidth) ? t = e : e = t,
                r.els["video-wrap"].css({
                    width: o = e,
                    height: a = t
                })),
                i < 200 || n < 200 ? function() {
                    var e = dialogController.showMessageDialog({
                        message: "Полученное изображение с камеры слишком маленькое"
                    });
                    isMobi && dialogController.rotate(s, e);
                    r.showSlide(u)
                }() : (l = {
                    rect: t = 1 == (t = i / n) ? {
                        x: 0,
                        y: 0,
                        w: o,
                        h: a
                    } : 1 < t ? {
                        x: -1 * (a * t - a) / 2,
                        y: 0,
                        w: a * t,
                        h: a
                    } : {
                        x: 0,
                        y: -1 * (o / t - o) / 4,
                        w: o,
                        h: o / t
                    },
                    videoWidth: i,
                    videoHeight: n,
                    targetWidth: o,
                    targetHeight: a
                },
                (a = d.style).width = t.w + "px",
                a.height = t.h + "px",
                a.marginTop = t.y + "px",
                a.marginLeft = t.x + "px",
                c.setAttr({
                    isWebCamPlay: !0
                }))
            }
        })).takePhoto = function() {
            var e, t, i, n, o, a, s, r;
            l && (a = l.rect,
            s = l.videoWidth / a.w,
            e = l.targetWidth * s,
            t = l.targetHeight * s,
            i = function(e) {
                return Math.abs(Math.floor(e))
            }
            ,
            n = (r = document.createElement("canvas")).getContext("2d"),
            d.width = l.videoWidth,
            d.height = l.videoHeight,
            r.width = e,
            r.height = t,
            o = i(a.x * s),
            a = i(a.y * s),
            n.drawImage(d, o, a, e, t, 0, 0, r.width, r.height),
            600 < e && (a = (o = document.createElement("canvas")).getContext("2d"),
            s = e / t,
            o.width = 600,
            o.height = parseInt(600 / s, 10),
            a.drawImage(r, 0, 0, o.width, o.height),
            r = o,
            n = a),
            r = r.toDataURL("image/jpeg"),
            c.setAttr({
                resultImg: r
            }),
            p())
        }
    }
    r.bind("pick-avatar", function() {
        var e = new app.controllers.SelectPhotosController({
            onSelectPhoto: function(o) {
                e.stop();
                var a = util.obtainMaxPhotoUrl(o);
                a && (e = new app.controllers.dialog.ImageCropper({
                    url: a,
                    onCrop: function(t, i) {
                        var n = new Image;
                        n.onload = function() {
                            var e = n.width / t.width;
                            i.x = Math.floor(i.x * e),
                            i.y = Math.floor(i.y * e),
                            i.width = Math.floor(i.width * e),
                            i.height = Math.floor(i.height * e),
                            d({
                                url: a,
                                pid: o.id,
                                rect: i,
                                __image: n
                            })
                        }
                        ,
                        n.src = a
                    }
                }),
                dialogController.rotate(s, e.dialogWindow))
            }
        });
        e.dialogView.$(".head").html("Выберите фото"),
        e.dialogView.$(".submit.btn").remove(),
        e.start(),
        dialogController.rotate(s, dialogSelectPhotosWindow)
    }),
    r.bind("confirm-avatar", l),
    r.bind("do-verification", function() {
        c.setAttr({
            title: "Сделать фото с жестом",
            verificationId: util.generateVerificationId(app.info.viewer_id)
        }),
        r.showSlide(u),
        cAnal.trackEvent({
            p_1: 1
        })
    }),
    r.bind("start-webcam", function() {
        t({
            verificationId: c.verificationId
        })
    }),
    r.bind("remake", function() {
        t({
            verificationId: c.verificationId
        })
    }),
    r.bind("send-avatar", function() {
        var e = c.viewerAvatarWithRect;
        !function(e, t, i) {
            i = {
                img: e,
                pid: t,
                r1x: i.x,
                r1y: i.y,
                r1w: i.width,
                r1h: i.height,
                method: "POST"
            };
            c.setAttr({
                pending: !0
            }),
            ServerApi("photo/addFirst.php", i, function(e, t) {
                if (c.setAttr({
                    pending: !1
                }),
                e)
                    if (e.code === Codes.DAILY_LIMIT_EXCEEDED)
                        dialogController.fadePopup("Вы сможете отправить фото на проверку через " + util.formatMillisToTime(t.leftMillis));
                    else if (e.code === Codes.ACCESS_DENIED) {
                        var i = !1;
                        try {
                            var n, o, a = t.leftMillis;
                            0 < a && (n = new Date(+new Date + a),
                            o = Constants.PHOTO_VERIFICATION_BLOCK_TEXT + util.formatDate(+n, function(e, t, i, n, o) {
                                return e + "." + t + "." + i + " " + n + ":" + o
                            }),
                            dialogController.showMessageDialog({
                                message: o
                            }),
                            i = !0)
                        } catch (e) {}
                        i || dialogController.showMessageDialog({
                            message: "Доступ запрещен. Code: 403"
                        })
                    } else
                        dialogController.showError(e);
                else
                    dialogController.fadePopup("Фото отправлено на проверку"),
                    dialogController.close(r),
                    cAnal.trackEvent({
                        p_4: 1
                    })
            })
        }(e.url, e.pid, e.rect)
    }),
    r.bind("send-current-avatar", function() {
        var t, i, n = app.info.avatarCrop;
        n ? (t = util.obtainMaxPhotoUrl(n.photo),
        (i = new Image).onload = function() {
            function s(e, t, i) {
                return {
                    x: Math.floor(i.x / 100 * e),
                    x2: Math.floor(i.x2 / 100 * e),
                    y: Math.floor(i.y / 100 * t),
                    y2: Math.floor(i.y2 / 100 * t)
                }
            }
            i.width,
            i.height;
            var e = function(e, t, i, n) {
                var o = s(e, t, i)
                  , a = o.x
                  , i = o.y;
                e = o.x2 - o.x,
                t = o.y2 - o.y;
                n = s(e, t, n);
                return {
                    x: a += n.x,
                    y: i += n.y,
                    width: e = n.x2 - n.x,
                    height: t = n.y2 - n.y
                }
            }(i.width, i.height, n.crop, n.rect);
            d({
                url: t,
                pid: n.photo.id,
                rect: e,
                __image: i
            })
        }
        ,
        i.src = t) : dialogController.showMessageDialog({
            message: "Похоже, что у вас очень старая фотография на аватаре ВК. Мы не можем использовать ее, так как она слишком маленькая. Выберете другую фотографию."
        })
    }),
    r.setModel(c);
    var i = null
      , p = function() {
        i && (i.finalize(),
        i = null)
    }
      , n = function() {
        var e = document.createElement("video");
        return e.setAttribute("width", "200"),
        e.setAttribute("height", "200"),
        e.setAttribute("autoplay", "true"),
        e
    };
    function o() {
        setTimeout(function() {
            r.showSlide(u);
            var e = dialogController.showMessageDialog({
                message: "Не удалось получить доступ к камере",
                buttons: [{
                    caption: "Как разблокировать?",
                    handler: function() {
                        try {
                            window.open("https://vk.com/page-75820678_50104561", "_blank").focus()
                        } catch (e) {}
                    }
                }]
            });
            isMobi && dialogController.rotate(s, e)
        }, isMobi ? 500 : 0)
    }
    r.bind("take-photo", function() {
        i && (i.takePhoto(),
        cAnal.trackEvent({
            p_2: 1
        }))
    }),
    r.bind("send-photo", function() {
        var e = util.convertBase64ToByteArray(c.resultImg);
        e ? e && function(e, t) {
            let i = new FormData;
            i.append("binary", e);
            let n = {
                app_id: app.info.api_id,
                auth_key: app.info.auth_key,
                uid: app.info.viewer_id,
                verification: !0,
                verification_id: c.verificationId,
                mimeType: t
            };
            app.info.session && (n.expire = app.info.session.expire,
            n.mid = app.info.session.mid,
            n.secret = app.info.session.secret,
            n.sid = app.info.session.sid,
            n.sig = app.info.session.sig),
            window.isExternal && (n.external_access_key = app.apiPrimaryParams.access_token,
            n.app_id = BOOT_DATA.app_id);
            let o = document.location.protocol;
            window.ODR && (o = "https:");
            t = o + "//sapps-static1.ru/static/secure/cors/upload";
            let a = [];
            t += "?",
            $.each(n, function(e, t) {
                util.isDef(t) && a.push(e + "=" + t)
            }),
            t += a.join("&"),
            n = i,
            c.setAttr({
                pending: !0
            }),
            $.ajax({
                url: t,
                type: "POST",
                data: n,
                dataType: "json",
                processData: !1,
                contentType: !1,
                success: function(e) {
                    if (c.setAttr({
                        pending: !1
                    }),
                    200 === e.code) {
                        dialogController.fadePopup("Фото отправлено на проверку");
                        var t = app.commonState.verificationPhoto || {};
                        t.u = e.data.url,
                        app.commonState.setAttr({
                            verificationPhoto: t
                        }),
                        selfProfileController.photosController.canAddFirstPhoto() ? l() : dialogController.close(r),
                        cAnal.trackEvent({
                            p_3: 1
                        })
                    } else if (403 === e.code && e.data && e.data.response && 403 === e.data.response.code) {
                        t = !1;
                        try {
                            var i, n, o = e.data.response.data.leftMillis;
                            0 < o && (i = new Date(+new Date + o),
                            n = Constants.PHOTO_VERIFICATION_BLOCK_TEXT + util.formatDate(+i, function(e, t, i, n, o) {
                                return e + "." + t + "." + i + " " + n + ":" + o
                            }),
                            dialogController.showMessageDialog({
                                message: n
                            }),
                            t = !0)
                        } catch (e) {}
                        t || dialogController.showMessageDialog({
                            message: "Вы уже загружали проверочное фото!"
                        })
                    } else
                        dialogController.showMessageDialog({
                            message: "Произошла ошибка:<br>Code:{0}{1}".format(e.code, e.data ? "<br>" + JSON.stringify(e.data) : e.message ? "<br>" + e.message : "")
                        })
                },
                error: function(e, t) {
                    c.setAttr({
                        pending: !1
                    }),
                    ajaxLoader.hide(),
                    dialogController.showError("Произошлa ошибка.<br>Status: " + e.status + (t ? "<br>" + t : "")),
                    console.info(arguments)
                }
            })
        }(e, util.getContentTypeFromB64(c.resultImg)) : dialogController.fadePopup("Произошла ошибка при конвертации изображения")
    }),
    r.onRemove(function() {
        p()
    }),
    e.selectAvatar ? l() : (c.setAttr({
        title: "Верификация вашего профиля"
    }),
    r.showSlide(1)),
    app.canVerifyPhotos(app.info.age) && (s = dialogController.open(r, {
        dialogClass: "small-close no-padding"
    }))
}
,
app.controllers.ChatFormController = function(i) {
    var s, t = "c-kb-event", n = isMobi, o = $.noop, a = isMobi ? "f-click" : "click", r = this, l = isMobi ? function(e) {
        return e
    }
    : function(e) {
        return e
    }
    , d = "item-user-in-chat-popup", c = app.info.viewer_id, u = !1, p = i.$form, e = p.find(".chat-timer"), f = i.$form.find(".popup"), m = i.$form.find(".textarea"), v = new app.controllers.ContentEditableController({
        uniqId: "chat-content-editable",
        $input: m,
        maxLength: 200,
        canShowPlaceHolder: function() {
            return !g
        },
        isIgnoredNodeOnParseText: function(e) {
            return e.className === d
        },
        needAddNBSPBeforeEmoji: function(e) {
            return !!g
        },
        $placeHolderEl: $("<div/>").text(isMobi ? "Тут писать в чат" : "Введите сюда сообщение и нажмите Enter").addClass("Medium-placeholder").insertBefore(m).show()
    }), h = null, g = null, b = (app.controllers.Emoji.getAllHexCodes().hash,
    {
        __recentItems: [],
        __recentStickers: [],
        hasSubscribe: app.info.hasEmojiSubscribe
    }), C = "recentEmoji-v3", _ = "recentStickers-v4", w = p.find(".selected-user");
    function E() {
        dialogController.subscribe({
            model: {
                title: "Стоимость подписки на смайлы",
                descriptions: [{
                    title: "5 дней",
                    price: 10,
                    periodIndex: "1"
                }, {
                    title: "30 дней",
                    price: 50,
                    periodIndex: "2"
                }, {
                    title: "90 дней",
                    price: 100,
                    periodIndex: "3"
                }]
            },
            onOk: function(i) {
                var e = app.balanceModel.balance - i.price;
                if (e < 0)
                    dialogController.showInsufficientlyBalanceDialog(e);
                else if (app.balanceModel.canChange())
                    return api.user.buyEmojiSubscribe({
                        price: i.price,
                        beforeSend: ajaxLoader.show
                    }, function(e, t) {
                        ajaxLoader.hide(),
                        e ? e.code === Codes.NOT_ENOUGH_BALANCE ? (dialogController.showInsufficientlyBalanceDialog(t.deficit),
                        app.balanceModel.setAttr({
                            balance: t.balance
                        })) : e.code === Codes.ACCESS_DENIED ? b.setAttr({
                            hasSubscribe: !0
                        }) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : dialogController.fadePopup("Произошла ошибка") : (app.balanceModel.setAttr({
                            balance: t.balance
                        }),
                        b.setAttr({
                            hasSubscribe: !0
                        }),
                        (t = {
                            emojiPurchase: 1
                        })["emojiPeriod" + i.periodIndex] = 1,
                        cAnal.trackEvent(t))
                    }).send(util.random(100, 300)),
                    !1
            }
        })
    }
    var y = {};
    function D(i, e) {
        y = i = i || y;
        var n = [];
        (e = e || []).each(function(e, t) {
            i[t] = (i[t] || 0) + 1
        }),
        $.each(i, function(e, t) {
            n.push({
                emojiCode: e,
                counter: t
            })
        }),
        n = n.sort(function(e, t) {
            return e.counter === t.counter ? 0 : e.counter > t.counter ? -1 : 1
        }),
        util.lStorage.save(C, JSON.stringify(i));
        var o = [];
        return n.each(function(e, t) {
            o.push(t.emojiCode)
        }),
        o
    }
    var T, S, A, I = {};
    function M(i, e) {
        I = i = i || I;
        var n = [];
        (e = e || []).each(function(e, t) {
            i[t] = (i[t] || 0) + 1
        }),
        $.each(i, function(e, t) {
            n.push({
                v: e,
                counter: t
            })
        }),
        n = n.sort(function(e, t) {
            return e.counter === t.counter ? 0 : e.counter > t.counter ? -1 : 1
        }),
        util.lStorage.save(_, JSON.stringify(i));
        var o = [];
        return n.each(function(e, t) {
            o.push(t)
        }),
        o
    }
    function O(e) {
        b.__recentItems = D(y, e = e || []),
        s.renderRecentEmoji()
    }
    function x(e) {
        b.__recentStickers = M(I, e ? [e] : []),
        s.renderRecentStickersIfNeed && s.renderRecentStickersIfNeed()
    }
    !function() {
        var e = "emoji-form";
        (s = lilo.createView(e)).setModel(b),
        p.append(s.el),
        r.closeEmojiForm = function() {
            s.closePopup()
        }
        ,
        app.eventBus.on("open-emoji-popup", function(e) {
            s.isOpen() ? s.closePopup() : s.openPopup()
        }),
        s.on("add-emoji:" + e, function(e) {
            b.hasSubscribe && !j() && function() {
                v.insertEmoji.apply(v, arguments)
            }(e.extraData.code)
        }),
        s.on("add-sticker:" + e, function(e) {
            var i, n, t = e.extraData.id, o = (app.controllers.dialog.Stickers.SET_TYPE,
            app.controllers.dialog.Stickers.Configuration), a = o.getPrice(t);
            app.balanceModel.canChange() && ((a = app.balanceModel.balance - a) < 0 ? dialogController.showInsufficientlyBalanceDialog(a) : X() || (roomModel.roundType !== app.ROUND_TYPE.LOTTERY || roomModel.canSpendMoney ? (i = o.getViewerConfig(t, e.extraData.tabId),
            n = JSON.stringify(i),
            e = {
                m: K(),
                r: roomModel.roomId,
                serialized_config: n
            },
            h && (e.to = h.uid),
            r.reset(),
            r.clearInput(),
            s.closePopup(),
            isMobi || roomView.setChatMode(1),
            api.roomV3.chat.addSticker({
                requestParams: e,
                beforeSend: function() {
                    roomView.elsMap.$chatOverlay.show()
                }
            }, function(e, t) {
                t && util.isDef(t.balance) && app.balanceModel.setAttr({
                    balance: t.balance
                }),
                e ? e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : roomController.communicator.config.onAddMessageFail(e, t) : (roomController.communicator.config.onAddMessageSuccess(),
                cAnal.trackEvent({
                    stcr: 1
                }),
                t = [i.v, i.id, app.info.sex, 18 <= app.info.age ? 1 : 0, isMobi || !IS_DESKTOP ? 2 : 1],
                cAnal.trackCommonEvent("Love1vCommon", "stickers", t.join("_")),
                x(n))
            }).send(),
            isMobi && T && m[0].focus()) : dialogController.lotteryIsActiveDialog()))
        }),
        s.on("buy:" + e, function(e) {
            E()
        }),
        s.bind("clear-recent-emoji", function(e) {
            y = {},
            O([])
        }),
        s.bind("clear-recent-stickers", function(e) {
            I = {},
            x(null)
        });
        e = util.lStorage.find(C);
        e && (b.__recentItems = D(JSON.parse(e)));
        e = util.lStorage.find(_);
        e && (b.__recentStickers = M(JSON.parse(e))),
        s.renderRecentEmoji(),
        app.eventBus.on(app.EVENTS.NO_EMOJI_SUBSCRIBE, function() {
            b.setAttr({
                hasSubscribe: !1
            }),
            dialogController.showMessageDialog({
                message: "Истекло время подписки на смайлы",
                buttons: [{
                    caption: "Купить",
                    className: "btn green",
                    handler: function() {
                        return E(),
                        !1
                    }
                }, {
                    caption: "Отмена",
                    handler: function() {
                        return !1
                    }
                }]
            })
        });
        function t(e) {
            30 <= e && b.setAttr({
                hasSubscribe: !0
            })
        }
        t(expController.getCurrentLevel()),
        app.eventBus.on(app.EVENTS.VIEWER_LEVEL_CHANGED, function(e) {
            t(e.level)
        })
    }(),
    app.eventBus.on(app.EVENTS.ADD_CHAT_MESSAGE_SUCCESS, function() {
        var e = v.getLastEnteredEmoji();
        e && e.length && O(e)
    }),
    app.eventBus.on(app.EVENTS.UPDATE_RECENT_EMOJI, function(e) {
        b.__recentItems = D(e.emojiHash),
        s.renderRecentEmoji()
    }),
    (isMobi ? roomView.mobiChatView : roomView).on("click-first-name:item-chat-message", function(e) {
        e.extraData && e.extraData.model && e.extraData.model.from !== c && ((e = roomModel.findUser(e.extraData.model.from)) ? r.addUserIntoInput(e, !0) : dialogController.fadePopup({
            message: "Пользователь покинул комнату"
        }))
    }),
    (isMobi ? roomView.mobiChatView : roomView).on("open-profile:item-chat-message", function(e) {
        app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: e.extraData.uid
        })
    }),
    m.addClass("Medium"),
    isMobi && (T = !1,
    m.on("keydown", function(e) {
        clearTimeout(A),
        A = setTimeout(v.handlePlaceholder, 100)
    }),
    m.on("focus", function() {
        app.scrollToChatInput(),
        T = !0,
        clearTimeout(S)
    }),
    m.on("blur", function() {
        clearTimeout(S),
        S = setTimeout(function() {
            T = !1
        }, 200)
    })),
    m.on("change", function(e) {
        roomView.updateChatHeight({
            textAreaHeight: m.height()
        })
    }),
    setTimeout(function() {
        roomView.updateChatHeight({
            textAreaHeight: m.height()
        }),
        s.renderRecentStickersIfNeed && s.renderRecentStickersIfNeed()
    }, 100),
    isMobi && ($("<input/>", {
        type: "text",
        css: {
            position: "absolute",
            left: "0",
            bottom: "0"
        }
    }),
    app.eventBus.on("submit-mobi-chat", function(e) {
        e.customEvent.preventDefault(),
        e.customEvent.stopPropagation(),
        R[13](e.customEvent)
    }));
    var R = {
        8: function(e) {
            var t = W();
            o("{0}, carret:{1}", 8, t),
            0 === t && V.isOpen() && V.close(),
            0 === t && H()
        },
        13: function(e) {
            if (e.preventDefault(),
            V.isOpen())
                G(h = V.submit());
            else if (!X()) {
                var t = K();
                if (m.empty(),
                isMobi ? r.closeEmojiForm() : s.hideEmojiPopup && s.hideEmojiPopup(),
                i.onSubmit(t, h ? h.uid : null),
                H(),
                isMobi)
                    return e.stopPropagation(),
                    !0
            }
            return !1
        },
        37: function(e) {},
        40: function(e) {
            if (V.isOpen())
                return V.selectNextUser(),
                e.preventDefault(),
                !1
        },
        38: function(e) {
            var t;
            return V.isOpen() ? (V.selectPrevUser(),
            e.preventDefault(),
            !1) : g && 1 === (t = W()) || 0 === t ? (e.preventDefault(),
            !1) : void 0
        }
    };
    m.on("keydown", function(e) {
        isMobi && s.closePopup();
        var t = R[e.which];
        return t ? t(e) : (n || Y(e.which)) && j() ? (e.preventDefault(),
        !1) : void 0
    });
    function k(e) {
        229 !== e && (0 < (e = W()) ? (e = m.text().substr(0, e),
        V.search(e)) : V.close())
    }
    m.on(n ? t : "keyup", function(e) {
        e = e.which,
        V.isOpen() && (Y(e) ? k(e) : 8 === e && (0 === W() ? (V.close(),
        H()) : k(e)))
    }),
    m.on(isMobi ? n ? t : "keydown" : "keypress", function(e) {
        229 !== e.which && (W() !== (e.type === t ? 1 : 0) || V.isOpen() || h || (e = String.fromCharCode(e.which),
        V.search(e),
        v.handlePlaceholder({
            hide: !0
        })))
    });
    var P, N, U, L, F, V = (P = !1,
    U = N = null,
    {
        selectNextUser: function() {
            var e;
            U && N && (-1 < (e = U.indexOf(N)) && e < U.length - 1 && (N.setAttr({
                selected: !1
            }),
            (N = U[e + 1]).setAttr({
                selected: !0
            })))
        },
        selectPrevUser: function() {
            var e;
            U && N && (0 < (e = U.indexOf(N)) && (N.setAttr({
                selected: !1
            }),
            (N = U[e - 1]).setAttr({
                selected: !0
            })))
        },
        setSelectedUser: function(e) {
            P = !0,
            N = e
        },
        close: L = function(e) {
            P = !1,
            U = N = null,
            f.empty().hide(),
            $appArea.off(a, L),
            isMobi && e && (e.preventDefault(),
            e.stopPropagation())
        }
        ,
        isOpen: function() {
            return P
        },
        search: function(e) {
            var t, n, i;
            L(),
            i = [],
            t = ((t = e) || "").toLowerCase(),
            roomModel.processActualUsers(function(e) {
                e.uid !== c && (!t || e.firstName && e.firstName.toLowerCase().startWith(t)) && i.push({
                    uid: e.uid,
                    firstName: e.firstName,
                    photo: e.photo,
                    selected: !1
                })
            }),
            i.length ? (P = !0,
            $appArea.off(a, L).on(a, L),
            (N = i[0]).selected = !0,
            n = function(e) {
                e = e.extraData.model;
                e !== N && (N && N.setAttr({
                    selected: !1
                }),
                (N = e).setAttr({
                    selected: !0
                }))
            }
            ,
            $.each(i, function(e, t) {
                var i = lilo.createView(d);
                i.setModel(t),
                f.append(i.el),
                i.on("select:" + d, n),
                i.on(a + ":" + d, function(e) {
                    B();
                    G(e.extraData.model)
                })
            }),
            f.show(),
            U = i,
            P = !0) : (U = N = null,
            P = !1,
            f.hide())
        },
        submit: B
    });
    function B() {
        var e = null;
        return N && ((e = N).selected = !1),
        L(),
        e
    }
    function G(e, t) {
        var i;
        (h = e) && (g && g.remove(),
        (i = lilo.createView(d)).setModel(h),
        w.empty().append(i.el),
        e = w.width(),
        m.css("text-indent", l(e - 2) + "px"),
        g = i.el[0],
        t && t.withoutCutText ? m.html("&nbsp;" + m.html()) : (t = W(),
        t = m.html().substr(t),
        m.html(t)),
        isMobi ? i.bind("f-click", H) : i.bind("click", function() {
            H(),
            m.focus()
        }),
        isMobi && IS_IOS || q(!1, !0))
    }
    function H() {
        g && (g.parentNode && g.parentNode.removeChild(g),
        h = g = null,
        m.css("text-indent", l(0) + "px"),
        v.handlePlaceholder())
    }
    function W() {
        return v.getCaretPosition()
    }
    function j() {
        return v.maxLengthIsReached()
    }
    function K() {
        return v.createAndParseResultText()
    }
    function Y(e) {
        return v.isPrintableKeyCode(e)
    }
    function q() {
        v.editableFocus.apply(v, arguments)
    }
    function z() {
        u = !1,
        p.removeClass("disabled")
    }
    function X() {
        return u && dialogController.fadePopup({
            message: "Отправлять сообщения можно не чаще одного раза в 3 сек",
            duration: 2500
        }),
        u
    }
    this.addUserIntoInput = function(e, t) {
        isMobi && !t || (V.setSelectedUser({
            uid: e.uid,
            firstName: e.firstName,
            photo: e.photo,
            selected: !1
        }),
        G(h = V.submit(), {
            withoutCutText: !0
        }),
        v.handlePlaceholder({
            hide: !0
        }))
    }
    ,
    this.startTimerLock = function() {
        u = !0,
        p.addClass("disabled");
        var e = 3
          , t = function() {
            clearTimeout(F),
            e ? (e--,
            F = setTimeout(t, 1e3)) : z()
        };
        t()
    }
    ,
    this.reset = function() {
        clearTimeout(F),
        z(),
        e.text(""),
        H(),
        h = null
    }
    ,
    this.clearInput = function() {
        m.empty().blur()
    }
    ,
    this.focusOnInput = function() {
        q(!1, !0)
    }
    ,
    this.blurFromInput = function() {
        m.blur()
    }
    ,
    window.$textBlock = m
}
,
function() {
    function e(e) {
        e = e || {},
        this._config = $.extend({
            timeoutPeriod: 70,
            autoRelease: !1,
            delayBetweenRequests: 0
        }, e),
        this._queue = [],
        this._lock = !1,
        this._lastRunTime = 0;
        var t = this;
        this._interval = setInterval(function() {
            t.run()
        }, this._config.timeoutPeriod)
    }
    $.extend(e.prototype, {
        clear: function() {
            this._queue.length = 0
        },
        isEmpty: function() {
            return 0 === this._queue.length
        },
        isLock: function() {
            return this._lock
        },
        stop: function() {
            clearInterval(this._interval)
        },
        next: function() {
            this._lock = !1
        },
        add: function(e, t) {
            for (var i = [], n = 2; n < arguments.length; n++)
                i[n - 2] = arguments[n];
            this._queue.push({
                ctx: t,
                callback: e,
                params: i
            }),
            this.run()
        },
        run: function() {
            var e;
            !this._lock && this._queue.length && (e = util.currentMillis()) - this._lastRunTime > this._config.delayBetweenRequests && (this._lock = !0,
            this._lastRunTime = e,
            (e = this._queue.shift()).callback.apply(e.ctx, e.params),
            this._config.autoRelease && this.next())
        }
    }),
    app.controllers.RequestsQueue = e
}(),
function() {
    app.controllers.RoomCommunicator = function(e) {
        var s = this
          , r = !0
          , l = !1
          , d = e.roomModel;
        e.roomView,
        this.stop = function() {
            r = !1
        }
        ;
        var t = $.noop;
        function o(e, t, i) {
            r && !l && (e ? s.config.onError(e, t, i) : function(e) {
                if (e.ctm) {
                    if (e.ctm < n)
                        return;
                    n = e.ctm,
                    d.setCtm(e.ctm)
                }
                e.roomData ? s.config.onGetState(e.roomData, e.roomId) : e.roomId && s.config.onGetChanges(e.changes, e.changeId, e.roomId, e.sid, e.exitReason)
            }(t))
        }
        this.config = {
            onGetState: t,
            onGetChanges: t,
            onError: t,
            onGetRoom: t,
            onSwitchRoom: t,
            onSwitchRoomFail: t,
            onAddGiftFail: t,
            onBalanceUpdate: t,
            onAddAnswer: t,
            onAddBot: t,
            onAddMessageSuccess: t,
            onAddMessageFail: t,
            onAddSoundSuccess: t,
            onAddSoundFailed: t,
            onCheckQueue: t,
            onToggleBanSuccess: t,
            onToggleBanFailed: t
        },
        $.extend(this.config, e);
        var n = 0;
        this.pause = function() {
            r = !1
        }
        ,
        this.resume = function() {
            r = !0
        }
        ,
        this.getRoom = function(n) {
            var o, a;
            n = n || {},
            r && (l = !0,
            o = n.onComplete,
            (a = api.roomV3.getRoom(n, function(e, t, i) {
                $appLoader.remove(),
                l = !1;
                try {
                    if (!r)
                        return;
                    if (o)
                        return void o(e, t, i, a);
                    e ? (n.__exitReason && (a.params.__exitReason = n.__exitReason),
                    s.config.onError(e, t, a)) : (d.setCtm(t.ctm),
                    s.config.onGetRoom(t.roomData, t.gifts, t.changeId, !!t.canSendFreeNote),
                    app.onGetServerVersion(t.v))
                } catch (e) {
                    dialogController.showMessageDialog({
                        noClose: !0,
                        message: "Произошла ошибка при обработке запроса<br>{0}<br><div style='font-size: 0.5em'>{1}</div>".format(e.message, e.stack),
                        dialogClass: "app-reboot"
                    })
                }
            })).send())
        }
        ,
        this.switchRoom = function(e) {
            var i, n;
            r && (l = !0,
            i = d.roomId,
            (n = api.roomV3.getRoom({
                is_switch: !0,
                beforeSend: ajaxLoader.show,
                force: !0
            }, function(e, t) {
                ajaxLoader.hide(),
                l = !1,
                r && (e ? (d.roomId = i,
                s.config.onSwitchRoomFail(e, t, n)) : s.config.onSwitchRoom(t.roomData, t.gifts, t.changeId))
            })).send())
        }
        ,
        this.addMessageToChat = function(e) {
            var i;
            r && (i = api.roomV3.chat.add(e, function(e, t) {
                r && !l && (e ? s.config.onAddMessageFail(e, t, i) : (s.config.onAddMessageSuccess(),
                t.balance && app.balanceModel.setAttr({
                    balance: t.balance
                })))
            })).send()
        }
        ,
        this.addGameGift = function(i, n, o) {
            var a;
            r && (a = d.roomId,
            api.roomV3.addGameGift(i, function(e, t) {
                e && e.code === Codes.ROOM_GIFTS_OUTDATE ? dialogController.showAppRebootDialog({
                    message: "Приложение обновилось. Необходим перезапуск"
                }) : (e || i.giftId && i.count && app.eventBus.trigger(app.EVENTS.SEND_ROOM_GIFT, {
                    id: i.giftId,
                    count: i.count,
                    beginner: i.beginner,
                    requestParams: i,
                    responseData: t
                }),
                (t = t || {}).__roomId = a,
                n ? n(e, t) : r && !l && (util.isDef(t.ruby) && app.balanceModel.setAttr({
                    ruby: t.ruby
                }),
                util.isDef(t.balance) && app.balanceModel.setAttr({
                    balance: t.balance
                }),
                e ? s.config.onAddGiftFail(e, t) : o && o()))
            }).send())
        }
        ,
        this.addAnswer = function(e, i) {
            var n;
            r && (n = d.roomId,
            api.roomV3.addAnswer(e, function(e, t) {
                (t = t || {}).__roomId = n,
                i ? i(e, t) : r && !l && s.config.onAddAnswer()
            }).send())
        }
        ,
        this.getState = function(e) {
            var i, n;
            r && (i = d.roomId,
            (n = api.roomV3.getState(e, function(e, t) {
                (t = t || {}).__roomId = i,
                d.roomId === i && o(e, t, n)
            })).send())
        }
        ,
        this.addRadioTrack = function(e, i) {
            var n, t;
            r && (n = d.roomId,
            t = e.audio,
            t = util.serializeAudioTrack(t),
            ServerApi("room/v3/radio/add.php", {
                r: n,
                track: t,
                price: e.price || 0
            }, function(e, t) {
                (t = t || {}).__roomId = n,
                r && !l && i(e, t)
            }))
        }
        ,
        this.raiseRadioTrack = function(e, i) {
            var n;
            r && (n = d.roomId,
            api.roomV3.radio.raise(e, function(e, t) {
                (t = t || {}).__roomId = n,
                r && !l && i(e, t)
            }).send())
        }
        ,
        this.removeRadioTrack = function(e, i) {
            var n;
            r && (n = d.roomId,
            api.roomV3.radio.remove(e, function(e, t) {
                (t = t || {}).__roomId = n,
                r && !l && i(e, t)
            }).send())
        }
        ,
        this.voteRadioTrack = function(e, i) {
            var n;
            r && (n = d.roomId,
            api.roomV3.radio.vote(e, function(e, t) {
                (t = t || {}).__roomId = n,
                r && !l && i(e, t)
            }).send())
        }
        ,
        this.replaceRadioTrack = function(e, i) {
            var n;
            r && (n = d.roomId,
            ServerApi("room/v3/radio/replace.php", {
                method: "POST",
                track: util.serializeAudioTrack(e.audio),
                r: n,
                id: e.id
            }, function(e, t) {
                (t = t || {}).__roomId = n,
                r && !l && i(e, t)
            }))
        }
        ,
        this.checkQueue = function(e) {
            var i, n;
            r && (i = d.roomId,
            (n = api.roomV3.checkQueue({
                roomId: i
            }, function(e, t) {
                (t = t || {}).__roomId = i,
                r && !l && d.roomId === i && (e ? s.config.onError(e, t, n) : s.config.onCheckQueue(t.room))
            })).send())
        }
        ,
        this.isGetRoomInProcess = function() {
            return l || api.roomV3.isGetRoomProcessing()
        }
    }
}(),
app.controllers.RoomControllerV3 = function(e) {
    function i(i) {
        if (i = i || {},
        F(),
        !i.isDJ) {
            if (util.lStorage.find("alreadyKickUsers"))
                return;
            var e = "[exclude-user-text]views"
              , t = parseInt(util.lStorage.find(e), 10);
            if (3 <= (t = isNaN(t) ? 0 : t))
                return;
            util.lStorage.save(e, t + 1)
        }
        N = setTimeout(function() {
            var e = "popup-with-exclude-user-text"
              , t = lilo.createView(e);
            i.isDJ ? (t.el.addClass("is-dj"),
            t.isDJDialog = !0) : t.isExludeDailog = !0,
            t.on("close:" + e, F),
            P = t,
            isMobi || X.els["main-area"].append(t.el),
            U = setTimeout(F, 7e3)
        }, 0)
    }
    function n() {
        o && o.close(),
        o = null
    }
    var o, a, s = util.isDef, r = this, v = new app.controllers.SoundController, t = ($(document.createElement("div")),
    util.collectArrayInObjectByProperty), c = "__localCounterOfSelectionOfUsers", l = "params_of_last_room_request", h = util.getCdnPath() + "res/sounds/0024_progress_made_10.mp3", d = "selected-by-user", u = "hovered", p = "user-add-answer", f = "cant-select-user", m = "state-pause", g = "show-only-kiss-btn", b = "is-couple-round", C = "is-choice-each-other-round", _ = "is-choice-couple-round", w = "is-choice-couple-round-for-males", E = "is-choice-couple-round-for-females", y = "is-lottery-round", D = "hide-users-status", T = app.info.viewer_id, S = 2 === app.info.sex, A = app.ROOM_STATE, I = app.ROOM_USER_STATE, M = app.ROUND_TYPE, O = app.ChatMessageType, x = !1, R = null, k = function() {
        null != R && (dialogController.close(R),
        R = null)
    }, P = null, N = null, U = null, L = function() {
        var e = K.roomId
          , t = "";
        e && (K.isConference() || e.startWith("10_") || (t = "room_id=" + e.substr(e.indexOf("_") + 1))),
        socialApi.setLocation(t)
    }, F = function(e) {
        clearTimeout(N),
        clearTimeout(U),
        P && (P.el.detach(),
        P = null)
    }, V = function() {
        a && a.el && (a.el.remove(),
        a = null)
    };
    function B(e) {
        this.__counter = util.nextCounter(),
        this._clientCreated = +new Date,
        this.type = e[0],
        this.uniqId = e[1],
        this.from = e[2],
        this.fromExp = e[3],
        this.firstName = e[4],
        this.initialFirstName = this.firstName,
        this.fromMale = e[5],
        this.fromAge = e[6],
        this.fromAvatar = e[7];
        var t = 7;
        switch (this.type) {
        case O.PHOTO_LIKE:
            this.likeType = e[t + 1],
            this.recipientUid = e[t + 2],
            this.concatFirstNameAndAge();
            break;
        case O.NORMAL:
            this.reply = B.createReply(e[t + 1]),
            this.message = e[t + 2],
            this.__likedUids = e[t + 3],
            this.isSenderVerified = e[t + 4],
            this.updateLikesData(),
            this.concatFirstNameAndAge();
            break;
        case O.STICKER:
            this.reply = B.createReply(e[t + 1]),
            this.message = e[t + 2],
            this.recipientFirstName = e[t + 3],
            this.recipientAge = e[t + 4],
            this.recipientFirstName && (this.recipientFirstName += " " + this.recipientAge + ","),
            this.__likedUids = e[t + 5],
            this.isSenderVerified = e[t + 6],
            this.to = e[t + 7],
            this.updateLikesData(),
            this.concatFirstNameAndAge();
            break;
        case O.UNITED_STICKER:
            this.maleUid = e[(t = 1) + 1],
            this.maleName = e[t + 2],
            this.maleAge = e[t + 3],
            this.maleAvatar = e[t + 4],
            this.maleExp = e[t + 5],
            this.maleFullName = this.maleName + " " + this.maleAge,
            this.femaleUid = e[t + 6],
            this.femaleName = e[t + 7],
            this.femaleAge = e[t + 8],
            this.femaleAvatar = e[t + 9],
            this.femaleExp = e[t + 10],
            this.femaleFullName = this.femaleName + " " + this.femaleAge,
            this.__likedUids = e[t + 11],
            this.message = e[t + 12],
            this.updateLikesData();
            break;
        case O.LOTTERY_WIN:
            this.winValue = e[t + 1],
            this.currentBalance = e[t + 2],
            this.matches = e[t + 3],
            this.matchNumbers = e[t + 4],
            this.winCurrency = e[t + 5],
            this.matchNumbers.sort(function(e, t) {
                return t < e ? 1 : -1
            });
            break;
        case O.LOTTERY_COMMON_RESULT:
            var i = [];
            e[t + 1].each(function(e, t) {
                i.push(new B(t))
            }),
            (this.items = i).sort(function(e, t) {
                return e.matches === t.matches ? e.winValue === t.winValue ? 0 : e.winValue > t.winValue ? -1 : 1 : e.matches > t.matches ? -1 : 1
            });
            break;
        case O.GIFT:
            var n = e[t + 1]
              , o = rawGiftsHash[n];
            o && (this.giftImg = o.img),
            this.giftId = n,
            this.to = e[t + 2],
            this.toExp = e[t + 3],
            this.toFirstName = e[t + 4],
            this.count = e[t + 5],
            this.noteTitle = e[t + 6],
            this.actionId = e[t + 7],
            this.toFirstNameGen = e[t + 8],
            this.toFirstNameDat = e[t + 9],
            this.toFirstNameAcc = e[t + 10],
            this.toMale = e[t + 11],
            this.toAge = e[t + 12],
            this.toAvatar = e[t + 13],
            this.recipientExpBonus = e[t + 14],
            this.senderExpBonus = e[t + 15],
            this.isSenderVerified = e[t + 16],
            this.isRecipientVerified = e[t + 17],
            util.isOKAppUid(this.to) && (this.toFirstNameAcc = this.toFirstNameDat = this.toFirstNameGen = this.toFirstName),
            this.concatFirstNameAndAge(),
            this.recipientNameAndAge = this.toFirstName + " " + this.toAge;
            break;
        case O.TALK:
            this.reply = B.createReply(e[t + 1]),
            this.message = e[t + 2],
            this.to = e[t + 3],
            this.toExp = e[t + 4],
            this.toFirstName = e[t + 5] + " " + e[t + 6],
            this.__likedUids = e[t + 7],
            this.isSenderVerified = e[t + 8],
            this.concatFirstNameAndAge(),
            this.updateLikesData();
            break;
        case O.SYSTEM_BAN_USER:
            this.to = e[t + 1],
            this.toFirstNameAcc = e[t + 2],
            this.isBanned = e[t + 3],
            this.ts = e[t + 4],
            this.isSystem = !0;
            break;
        case O.SYSTEM_USER_REMOVE_BY_USER:
            this.targetUserFirstName = e[t + 1],
            this.targetUserFirstNameAcc = e[t + 2],
            this.targetUserIsMale = e[t + 3],
            this.recipientAge = e[t + 4],
            this.isAnon = e[t + 5],
            this.reasonId = e[t + 6],
            this.isKickAsRoomOwner = e[t + 7];
            break;
        case O.SYSTEM_USER_SAVED_BY_USER:
            this.targetUserId = e[t + 1],
            this.targetUserFirstName = e[t + 2],
            this.targetUserAge = e[t + 3],
            this.targetUserFullName = this.targetUserFirstName + " " + this.targetUserAge;
            break;
        case O.LIKE_SOUND:
            this.ts = e[t + 1],
            this.likeValue = e[t + 2];
            break;
        case O.COOL_TRACK:
            this.ts = e[t + 1],
            this.to = e[t + 2],
            this.expBonus = e[t + 3];
            break;
        case O.SYSTEM_NEW_LEVEL:
            this.male = e[t + 1];
            break;
        case O.SYSTEM_USER_STATUS:
            this.statusId = e[t + 1],
            this.concatFirstNameAndAge();
            break;
        case O.SYSTEM_REWARD_IN_LOCAL_ROOM_TOP:
            this._popular = B.parseRewardMeta(e[t + 1]),
            this._wasteful = B.parseRewardMeta(e[t + 2]),
            this._dj = B.parseRewardMeta(e[t + 3]),
            this._fortunate = B.parseRewardMeta(e[t + 4]),
            this._leftTimeForNextReward = e[t + 5],
            this.processSystemRewardMessage();
            break;
        case O.SYSTEM_REWARD_IN_TOP_LIST:
            this.place = e[t + 1];
            break;
        case O.BATCH_GIFT:
            n = e[t + 1],
            (o = rawGiftsHash[n]) && (this.giftImg = o.img),
            this.giftId = n,
            this.concatFirstNameAndAge(),
            this.giftId = n,
            this.count = e[t + 2],
            this.actionId = e[t + 3],
            this.toMale = e[t + 4]
        }
        this.isLoading = !1,
        lilo.makeObservable(this)
    }
    window.h4334 = i,
    this.canAnimateKissAnswer = function(e, t) {
        if ("5" === t || "-2" === t || !t)
            return !0;
        t = K.couple;
        if (t && K.state === A.STARTED) {
            if (e === T)
                return !0;
            if (t.maleUid === T && (!t.maleAnswer || "-2" === t.maleAnswer || R) || t.femaleUid === T && (!t.femaleAnswer || "-2" === t.femaleAnswer || R))
                return !1
        }
        return !0
    }
    ,
    this.isRoundWithoutAnswersState = function() {
        var e = K.roundType;
        return e === M.WHO_LIKES_ON_FEMALES || e === M.WHO_LIKES_ON_MALES || !isMobi && (e === M.CHOOSE_COUPLE_FOR_FEMALE || e === M.CHOOSE_COUPLE_FOR_MALE)
    }
    ,
    B.createReply = function(e) {
        if (e) {
            e = new B(e);
            return e.isReply = !0,
            e
        }
        return null
    }
    ,
    B.parseRewardMeta = function(e) {
        if (e)
            return {
                type: e[0],
                rewardValue: e[1],
                leftCoins: e[2],
                uid: e[3],
                firstName: e[4],
                age: e[5],
                avatar: e[6],
                exp: e[7],
                male: e[8]
            }
    }
    ,
    B.PhotoLike = function(e, t) {
        return new B([O.PHOTO_LIKE, util.currentUtcMillis(), T, expController.getCurrentExp(), app.info.first_name, S, app.info.age, app.commonState.photo100, e, t])
    }
    ,
    B.fromArray = function(e) {
        var i = [];
        return $.each(e, function(e, t) {
            i.push(new B(t))
        }),
        i
    }
    ,
    $.extend(B.prototype, {
        _systemRewardMessageProps: ["_wasteful", "_popular", "_dj", "_fortunate"],
        processSystemRewardMessage: function() {
            var l = []
              , d = this
              , c = this._systemRewardMessageProps;
            c.each(function(e, t) {
                var i = d[t];
                if (i) {
                    for (var n = i.uid, o = {
                        uid: n,
                        firstName: i.firstName,
                        age: i.age,
                        avatar: i.avatar,
                        exp: i.exp,
                        male: i.male,
                        rewards: [{
                            type: i.type,
                            value: i.rewardValue
                        }],
                        leftCoins: i.leftCoins
                    }, a = e + 1; a < c.length; a += 1) {
                        var s = c[a]
                          , r = d[c[a]];
                        r && r.uid === n && (delete d[s],
                        o.leftCoins = Math.min(i.leftCoins, r.leftCoins),
                        o.rewards.push({
                            type: r.type,
                            value: r.rewardValue
                        }))
                    }
                    l.push(o)
                }
            }),
            d._isVisible = !1,
            l.each(function(e, t) {
                t.uid === app.info.viewer_id && (d.leftCoinsInLocalRoomTop = t.leftCoins,
                d.hasViewerResult = !0);
                var i = !1;
                t.rewards.each(function(e, t) {
                    if (t.value)
                        return i = !0,
                        !(d._isVisible = !0)
                }),
                t._isVisible = i
            }),
            d._users = l
        },
        hasChatAnimation: function() {
            return !(this.from !== app.info.viewer_id && this.to !== app.info.viewer_id || this.actionId !== ROOM_GIFT_ACTION.ONE_USER_X1 && this.actionId !== ROOM_GIFT_ACTION.ONE_USER_X3 && this.actionId !== ROOM_GIFT_ACTION.ONE_USER_X10 && this.actionId !== ROOM_GIFT_ACTION.ONE_USER_X30 && this.actionId !== ROOM_GIFT_ACTION.ONE_USER_X50)
        },
        concatFirstNameAndAge: function() {
            this.fromAge && (this.firstName = this.firstName + " " + this.fromAge)
        },
        updateLikesData: function() {
            var e = this.__likedUids;
            e && (e = {
                likesCount: e.length,
                hasLike: e.contains(T)
            },
            this.__isObservable ? this.setAttr(e) : $.extend(this, e))
        }
    }),
    app.models.ChatMessage = B;
    var G, H = new app.controllers.RoomResponseParser, W = function() {
        var t = [];
        setInterval(function() {
            t.each(function(e, t) {
                t.tick()
            }),
            K.setAttr({
                leftTimeForNextRewardOfLocalTop: Math.max(0, K.leftTimeForNextRewardOfLocalTop - 1e3)
            })
        }, 1e3);
        return {
            add: function(e) {
                t.push(e)
            }
        }
    }();
    function j() {
        var e = this;
        $.extend(e, e.__defaultProps),
        e.__giftsHash = {},
        e.orderIndex = 0,
        e.deportationModel = app.models.UsersDeportation.createDefault(),
        lilo.makeObservable(e),
        e.deportationModel.userModel = e,
        W.add(e.deportationModel),
        e.onChange("uid", function() {
            e.uid ? e.setAttr({
                isEmpty: !1,
                firstName: e.realFirstName + util.formatProfileBdate(null, e.age)
            }) : (e.resetProps(),
            resultController.onUserUidChange()),
            e.uid && e.uid === K.ownerId ? e.setAttr({
                isRoomOwner: !0
            }) : e.setAttr({
                isRoomOwner: !1
            }),
            e.uid,
            app.info.viewerId
        }),
        e.onChange("votesForCouple", function() {
            app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW, {
                votesForCouple: !0
            })
        }),
        e.onChange("exp", function() {
            e.setAttr({
                level: expController.expToLevel(e.exp)
            })
        })
    }
    $.extend(j.prototype, {
        __defaultProps: {
            uid: null,
            photo: null,
            photo200: null,
            realFirstName: null,
            firstName: null,
            firstNameAcc: null,
            firstNameDat: null,
            firstNameGen: null,
            state: null,
            vkDataIsLoading: !1,
            isEmpty: !0,
            isSelectedByViewer: !1,
            voteCounter: 0,
            canShowSelectBtn: 0,
            canShowVoteInfo: !1,
            pairsRoundModCounter: 0,
            isSelectableByFirstPos: !1,
            isSelectableBySecondPos: !1,
            isCoupleMale: !1,
            isCoupleFemale: !1,
            isWinner: !1,
            isCenter: !1,
            isLocking: !1,
            matches: 0,
            age: 0,
            male: !1,
            hasFadeArrows: !1,
            wins: 0,
            giftsCount: 0,
            gameCounter1: 0,
            gameCounter2: 0,
            gameCounter3: 0,
            betNumbersString: "",
            accessIsBought: !1,
            isAway: !1,
            incomingMessagesCount: 0,
            outgoingMessagesCount: 0,
            outgoingMessage: {},
            freeMessageCountersMap: {},
            exp: 0,
            level: 0,
            remindSentGifts: 0,
            remindReceivedGifts: 0,
            isPopular: !1,
            isWasteful: !1,
            isFortunate: !1,
            isDJ: !1,
            isRoomOwner: !1,
            djCounter: 0,
            remindDJ: 0,
            remainingFortunateCounter: 0,
            coolLikes: 0,
            hasExpBooster: !1,
            sentGiftsPerDay: 0,
            receivedGiftsPerDay: 0,
            expPerDay: 0,
            lotteryWinsPerDay: 0,
            votesForCouple: 0,
            sentGiftsPerHour: 0,
            receivedGiftsPerHour: 0,
            expPerHour: 0,
            lotteryWinsPerHour: 0,
            lotteryWinsPerRoom: 0,
            regionId: null,
            countryId: null,
            sentGiftsPerRoom: 0,
            receivedGiftsPerRoom: 0,
            hasBDate: !1,
            luckyExpModifier: null,
            isMobiUser: !1,
            counterMapOfGiftsForBeginners: {},
            isVerified: !1,
            clientType: 0
        },
        resetProps: function() {
            this.__giftsHash = {},
            this.setAttr(this.__defaultProps)
        },
        updateDeporationModelByExitReason: function(e) {
            e && e.deportationModel ? this.deportationModel.update(e.deportationModel) : this.deportationModel.reset()
        }
    });
    var K = function() {
        var i = {
            modCounter: 1,
            newMessagesCounter: 0,
            radioTitle: "",
            versionOfLastChange: 0,
            accessDescr: {},
            __nextRoomId: "",
            __viewerOpenFadeArrow: !1,
            __changeId: null,
            canSpendMoney: !0,
            __isAway: !1,
            __countOfViewerAnswersInRound: 0,
            __batchGiftsIsProcessing: !1,
            __ctm: 0,
            __timeOfCtmUpdate: 0,
            canSendFreeNote: !1,
            ownerId: null,
            title: "",
            roomOwnerFirstName: "",
            roomOwnerLastName: "",
            conferenceData: null,
            leftCoinsInLocalRoomTop: 0,
            leftTimeForNextRewardOfLocalTop: 0,
            viewerIsOwnerOfRoom: !1,
            isConference: function() {
                return !!this.conferenceData
            },
            getPauseStateLeftSeconds: function() {
                var e = this.getCtm()
                  , e = this.pauseStateCtm + this.pauseStateDuration - e;
                return e < 0 ? 0 : Math.round(e / 1e3)
            },
            getStartStateLeftSeconds: function() {
                var e = this.getCtm()
                  , e = this.startStateCtm + this.startStateDuration - e - 1500;
                return K.roundType === M.LOTTERY && K.state === A.STARTED && (e -= 1700),
                e < 0 ? 0 : Math.round(e / 1e3)
            },
            getRealCtm: function() {
                return this.__ctm
            },
            getCtmDiff: function() {
                return util.currentMillis() - this.__timeOfCtmUpdate
            },
            getCtm: function() {
                return this.__ctm + this.getCtmDiff()
            },
            setCtm: function(e) {
                this.__timeOfCtmUpdate = util.currentMillis(),
                this.__ctm = e
            },
            getLeftTimeOfSubState: function() {
                return Math.max(0, K.subStateEstimatedTime - K.getCtm())
            },
            roomId: null,
            pending: !1,
            state: null,
            topUsers: [],
            bottomUsers: [],
            queueTopUsers: [],
            queueBottomUsers: [],
            couple: {},
            roundQuestion: {
                id: null,
                text: "",
                answers: [],
                uid: null,
                fullName: null
            },
            roundType: null,
            answersPerRound: [],
            usersSnapshot: [],
            firstUidForSelect: null,
            secondUidForSelect: null,
            firstUidVotes: 0,
            secondUidVotes: 0,
            viewerAnswer: null,
            processUsers: function(e) {
                $.each(this.topUsers, e),
                $.each(this.bottomUsers, e)
            },
            concatAllUid: function() {
                var i = [];
                return this.processUsers(function(e, t) {
                    i.push(t.uid + "")
                }),
                "[" + i.join(",") + "]"
            },
            getMalesCount: function() {
                var t = 0;
                return this.processActualUsers(function(e) {
                    e.male && t++
                }),
                t
            },
            getFemalesCount: function() {
                var t = 0;
                return this.processActualUsers(function(e) {
                    e.male || t++
                }),
                t
            },
            processActualUsers: function(i) {
                $.each(this.topUsers, function(e, t) {
                    t.uid && i(t)
                }),
                $.each(this.bottomUsers, function(e, t) {
                    t.uid && i(t)
                })
            },
            usersToHash: function() {
                var t = {};
                return this.processActualUsers(function(e) {
                    t[e.uid] = e
                }),
                t
            },
            getIndexOfAnswer: function(e) {
                for (var t = 0; t < this.roundQuestion.answers.length; t++)
                    if (this.roundQuestion.answers[t].id === e)
                        return t;
                return -1
            },
            getIndexOfUserInRow: function(e) {
                if (e = parseInt(e, 10),
                !isNaN(e)) {
                    for (var t = 0; t < this.topUsers.length; t += 1)
                        if (this.topUsers[t].uid === e)
                            return t;
                    for (t = 0; t < this.bottomUsers.length; t += 1)
                        if (this.bottomUsers[t].uid === e)
                            return t
                }
                return -1
            },
            findUser: function(e) {
                for (var t = 0; t < this.topUsers.length; t += 1)
                    if (this.topUsers[t].uid === e)
                        return this.topUsers[t];
                for (t = 0; t < this.bottomUsers.length; t += 1)
                    if (this.bottomUsers[t].uid === e)
                        return this.bottomUsers[t];
                return null
            },
            getViewer: function() {
                for (var e = 0; e < this.bottomUsers.length; e += 1)
                    if (this.bottomUsers[e].uid === T)
                        return this.bottomUsers[e];
                for (e = 0; e < this.topUsers.length; e += 1)
                    if (this.topUsers[e].uid === T)
                        return this.topUsers[e]
            },
            hasUser: function(e) {
                return !!this.findUser(e)
            }
        };
        util.repeat(12, function(e) {
            var t = new j;
            e % 2 == 0 ? (i.topUsers.push(t),
            t.orderIndex = i.topUsers.length - 1) : (i.bottomUsers.push(t),
            t.orderIndex = i.bottomUsers.length - 1)
        });
        var e = i.bottomUsers[0];
        e.uid = T,
        e.photo = app.info.photo_100,
        e.realFirstName = app.info.first_name,
        e.firstName = app.info.first_name + util.formatProfileBdate(app.info.bdate, app.info.age),
        e.vkDataIsLoading = !1,
        e.isEmpty = !0,
        e.male = S,
        e.addProperty("privateMessages", []),
        G = function() {
            function t() {
                var t = {
                    name: o.anon ? "Аноним" : util.escapeHtml(o.initiatorName) + " " + o.initiatorAge,
                    price: o.price,
                    reasonId: 0 < o.reasonId ? o.reasonId : 0,
                    reasonText: KickReasonId[o.reasonId],
                    leftMillis: o.leftTime - 1e4
                }
                  , i = lilo.createView("dialog-resque-self")
                  , n = K.roomId;
                function e() {
                    var e = Math.max(0, o.leftTime - 1e4);
                    0 === e || n !== K.roomId ? dialogController.close(i) : t.setAttr({
                        leftMillis: e
                    })
                }
                i.setModel(t),
                i.onRemove(function() {
                    o.offChange("leftTime", e)
                }),
                o.onChange("leftTime", e),
                dialogController.open(i, {
                    dialogClass: "over-all",
                    noClose: isMobi
                }),
                i.bind("submit", function() {
                    ae(app.info.viewer_id, o.price, function(e) {
                        2 === e ? dialogController.fadePopup("Вы спасли себя!") : dialogController.fadePopup("Не удалось спасти себя...")
                    }),
                    dialogController.close(i)
                })
            }
            var o = e.deportationModel
              , i = null;
            X.on("resque:" + z, function(e) {
                oe || e.extraData.model.uid === T && t()
            }),
            o.onChange("updateCounter", function() {
                var e = o.initiatorId;
                i && (dialogController.close(i),
                i = null),
                e && 12e3 < o.leftTime && t(),
                console.info(" hange deportationModel", o)
            })
        }
        ,
        lilo.makeObservable(i);
        function t() {
            K.processUsers(function(e, t) {
                t.view.popupModel.toggleKick()
            }),
            e.isPopular || e.isWasteful ? isMobi : F()
        }
        return e.onChange("isPopular", t),
        e.onChange("isWasteful", t),
        e.onChange("isRoomOwner", t),
        e.onChange("isDJ", function() {
            K.setAttr({
                canSendFreeNote: e.isDJ
            })
        }),
        i.onChange("ownerId", function() {
            i.setAttr({
                viewerIsOwnerOfRoom: i.ownerId === T
            }),
            i.ownerId ? K.processUsers(function(e, t) {
                t.setAttr({
                    isRoomOwner: t.uid === K.ownerId
                })
            }) : K.processUsers(function(e, t) {
                t.setAttr({
                    isRoomOwner: !1
                })
            })
        }),
        i.onChange("viewerIsOwnerOfRoom", function() {
            X.el[i.viewerIsOwnerOfRoom ? "addClass" : "removeClass"]("viewer-is-owner-of-room")
        }),
        window.roomModel = i
    }();
    function Y() {
        gt = null,
        Ct(),
        de(),
        Xe.abortCustomGiftsAnimation(),
        ct(),
        K.versionOfLastChange = 0,
        K.restartRaffle = !1,
        K.__isAway = !1,
        K.__changeId = null,
        K.__batchGiftsIsProcessing = !1,
        K.setAttr({
            roomId: null,
            state: null,
            roundType: null,
            ownerId: null,
            title: null
        }),
        K.roundQuestion.id = null,
        K.processUsers(function(e, t) {
            t.uid !== T && t.setAttr({
                uid: null
            }),
            t.deportationModel.reset()
        }),
        K.roundQuestion.answers.removeAll(),
        Fe(),
        X.clearChat(),
        ze.stop(),
        ot.stop(),
        nt.abort(),
        st.clear(),
        Qe.resetQueue();
        var e = X.findElByUid(T);
        e && e.$giftsArea && (e.$giftsArea.empty().removeData(),
        e.find(".icon-cool-animated").remove()),
        Xe.clearViewerGifts();
        e = K.getViewer();
        e.privateMessages.length && e.privateMessages.removeAll(),
        e.setAttr({
            isPopular: !1,
            isFortunate: !1,
            isWasteful: !1,
            isDJ: !1
        }),
        X.elsMap.$waitUsersLoader.hide(),
        V(),
        F(),
        X.chatFromController.clearInput(),
        X.chatFromController.reset(),
        X.elsMap.$votes.hide(),
        X.els["couple-results"].hide(),
        X.els["couple-results"].children().empty(),
        app.eventBus.trigger("hasNewMessages", {
            count: 0,
            maxSize: 0,
            reset: !0
        })
    }
    var q = "room-view-v3"
      , z = "item-room-user-v3"
      , X = lilo.createView(q);
    isMobi || X.el.addClass("white-theme"),
    J = lilo.createView("room-location-info"),
    X.els["main-area"].append(J.el),
    X.locationView = J,
    X.scale = 1,
    G(),
    app.eventBus.trigger("room_view_created");
    var Q, J = new app.controllers.FX2({
        $container: X.els["fx-wrap"],
        width: isMobi ? 500 : 740,
        height: isMobi ? 840 : 600
    });
    r.fxController = J,
    expController.setRoomView(X),
    this.showCursorLoader = function() {
        X.el.css("cursor", "progress")
    }
    ,
    X.setModel(K),
    app.eventBus.trigger("room_view_initialized"),
    X.initViewEls(),
    app.controllers.P2PController && (Q = new app.controllers.P2PController({
        roomModel: K,
        roomView: X
    }));
    function Z(e) {
        var t, i = e.extraData.model;
        i.__pending || (t = i.__likedUids) && (-1 !== (e = t.indexOf(T)) ? t.splice(e, 1) : t.push(T),
        i.updateLikesData(),
        i.__pending = !0,
        t = {
            message_id: i.from + "_" + i.uniqId,
            room_id: K.roomId
        },
        ServerApi("room/v3/chat/toggleLike.php", t, function(e, t) {
            e && dialogController.fadePopup("Ошибка при добавлении лайка. Code:" + e.code),
            setTimeout(function() {
                i.__pending = !1
            }, 300)
        }))
    }
    function ee(e, i) {
        ee.pending || (ee.pending = !0,
        ServerApi("privatemessage/get.php", {
            message_id: e
        }, function(e, t) {
            ee.pending = !1,
            e ? e.code === Codes.NOT_FOUND ? i(null, null) : i(e, null) : i(null, t.message)
        }))
    }
    X.on("click-on-message:item-chat-message-v2", function(e) {
        var t = e.extraData.model;
        t.from === app.info.viewer_id ? (e = t,
        X.chatFromController.removeSelfMessage(e)) : (t = t,
        X.chatFromController.addReplyMessage(t))
    }),
    X.on("toggle-like:item-chat-message-v2", Z),
    X.on("toggle-like:item-chat-message-sticker-merge", Z),
    app.eventBus.on("toggle-like-of-chat-message", function(e) {
        Z(e.liloEvent)
    }),
    X.on("has-activity:" + q, Je),
    X.on("invite-friend-into-self-room:" + q, function() {
        new app.controllers.dialog.InviteUsersIntoRoom({
            roomModel: K,
            roomView: X,
            needUpdateFavUsersFromServer: !0
        }).open()
    }),
    X.on("open-self-room-control:" + q, function() {
        var e, i;
        Je(),
        expController.getCurrentLevel() < 10 ? dialogController.fadePopup("Недоступно до 10 уровня") : app.info.selfRoomId ? app.eventBus.trigger(app.EVENTS.GO_TO_PRIVATE_ROOM, {
            private_room_id: "10_" + app.info.selfRoomId
        }) : (e = "dialog-create-self-room",
        i = lilo.createView(e, {
            price: 30
        }),
        dialogController.open(i),
        i.on("submit:" + e, function(e) {
            var t = app.balanceModel.balance - 30;
            t < 0 ? dialogController.showInsufficientlyBalanceDialog(-1 * t) : api.roomV3.privateRooms.buy({
                beforeSend: ajaxLoader.show
            }, function(e, t) {
                ajaxLoader.hide(),
                t && util.isDef(t.balance) && app.balanceModel.setAttr({
                    balance: t.balance
                }),
                e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : dialogController.showError(e) : (app.info.selfRoomId = t.id,
                app.info.isSelfRoomActivated = !0,
                dialogController.close(i),
                app.eventBus.trigger(app.EVENTS.GO_TO_PRIVATE_ROOM, {
                    private_room_id: "10_" + app.info.selfRoomId
                }))
            }).send()
        }))
    }),
    X.on("show-question-owner:" + q, function() {
        var e = K.roundQuestion.uid;
        e && app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: e,
            referrer: GuestReferrer.QUESTION_AUTHOR
        })
    }),
    X.on("open-editor:" + q, function() {
        app.eventBus.trigger(app.EVENTS.OPEN_EDITOR)
    }),
    X.on("show-online-friends:" + q, function(e) {
        e.extraData.$targetEl.addClass("loading"),
        new app.controllers.dialog.OnlineFriends({
            roomModel: K,
            roomController: r,
            onFriendListLoad: function() {
                e.extraData.$targetEl.removeClass("loading")
            }
        })
    }),
    X.on("show-room-list:" + q, function(e) {
        var t = e.extraData.$targetEl;
        t.addClass("loading"),
        o = new app.controllers.dialog.RoomsList({
            roomModel: K,
            roomView: X,
            onSubmit: function(e, t) {
                var i;
                e ? (n(),
                Y(),
                i = H.parse(e.roomData),
                X.lockSwitchRoomBtns(),
                at.stop(),
                i.isSummary ? Ge(i) : Te.config.onGetRoom(e.roomData, e.gifts, e.changeId, !!e.canSendFreeNote)) : (K.roomId = t,
                t = Et.getLastChanges(t),
                rt.handleChanges(t))
            }
        }).open(function() {
            t.removeClass("loading")
        })
    }),
    X.on("open-private-message:" + z, function() {
        var i, n = K.getViewer().privateMessages;
        n.length && ee((i = n[0]).commonId, function(e, t) {
            e ? dialogController.fadePopup("Не удалось получить данные сообщения") : t ? new app.controllers.dialog.RoomPrivateMessage({
                roomModel: K,
                roomView: X,
                roomId: K.roomId,
                privateMessage: t
            }) : (n.remove(i),
            dialogController.fadePopup("Не удалось получить данные сообщения."))
        })
    });
    var te = $.noop;
    r.onClickShowFadeArrows = function(e) {
        return te(e)
    }
    ,
    X.on("show-fade-arrows:" + z, function(e) {
        r.onClickShowFadeArrows(e.extraData.model)
    }),
    X.on("clear-avatar:" + z, function() {
        api.roomV3.clearAvatar({
            roomId: K.roomId,
            beforeSend: ajaxLoader.show
        }, function(e, t) {
            ajaxLoader.hide(),
            e && (e.code === Codes.NOT_ENOUGH_BALANCE ? (app.balanceModel.setAttr({
                balance: t.balance
            }),
            dialogController.showInsufficientlyBalanceDialog(t.deficit)) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : dialogController.fadePopup({
                message: "Не удалось выполнить запрос"
            })),
            s(t.balance) && app.balanceModel.setAttr({
                balance: t.balance
            })
        }).send(util.random(100, 300))
    }),
    X.on("complain-age:" + z, function(n) {
        var o = n.extraData.model
          , a = o.uid
          , s = "__complaint";
        dialogController.complaint({
            uid: a,
            age: o.age,
            avatar: o.photo,
            firstName: o.firstName,
            onSubmit: function(i) {
                o[s] || (o[s] = !0,
                n.extraData.$targetEl.addClass("pending"),
                api.user.complaint({
                    uid: a,
                    type: i
                }, function(e, t) {
                    o[s] = !1,
                    n.extraData.$targetEl.removeClass("pending"),
                    e || (i === ExitReason.COMPLAINTS_OF_AGE ? (app.info.complaintAgeUids[a] = !0,
                    app.eventBus.trigger(app.EVENTS.USER_COMPLAIN_TO_AGE, {
                        uid: a
                    })) : (i === ExitReason.COMPLAINTS_OF_BAD_NAME ? app.info.complaintsBadNameHash[a] = !0 : app.info.complaintAbuseUids[a] = !0,
                    app.eventBus.trigger(app.EVENTS.USER_COMPLAIN_TO_ABUSE, {
                        uid: a
                    })),
                    dialogController.fadePopup({
                        message: "Спасибо, ваш голос учтен. Как только наберется достаточно жалоб, пользователь будет наказан",
                        duration: 3e3
                    }))
                }).send())
            }
        })
    });
    var ie = app.__toggleBanMap || (app.__toggleBanMap = {});
    function ne(e, t) {
        dialogController.kickUser(e, t)
    }
    X.on("toggle-ban:" + z, function(i) {
        var n, o, e, a, s = i.extraData.model, r = "__toggleBanIsPending";
        s[r] || (n = util.currentMillis(),
        e = ie[s.uid] || 0,
        n - e < 6e4 ? dialogController.fadePopup({
            message: "Вы можете пользоваться этой функцией не чаще 1 раза в минуту",
            duration: 2e3
        }) : (s[r] = !0,
        o = s.uid,
        e = K.roomId,
        a = !app.info.blockedUids[o],
        i.extraData.$targetEl.addClass("pending"),
        api.roomV3.toggleBan({
            roomId: e,
            targetUid: o,
            value: a
        }, function(e, t) {
            s[r] = !1,
            i.extraData.$targetEl.removeClass("pending"),
            e ? e.code === Codes.ACCESS_DENIED ? app.eventBus.trigger(a ? app.EVENTS.USER_UNBLOCKED : app.EVENTS.USER_BLOCKED, {
                uid: o
            }) : (e.code,
            Codes.TARGET_ROOM_USER_NOT_FOUND) : (app.eventBus.trigger(a ? app.EVENTS.USER_BLOCKED : app.EVENTS.USER_UNBLOCKED, {
                uid: o
            }),
            dialogController.fadePopup({
                message: "Пользователь {0}".format(a ? "заблокирован" : "разблокирован")
            }),
            ie[s.uid] = n)
        }).send(util.random(200, 300))))
    }),
    this.doKick = ne,
    X.on("kick:" + z, function(e) {
        var t, i, n;
        K.pending ? ne(e.extraData.model, e.extraData.view) : (t = e.extraData.model,
        (i = K.findUser(app.info.viewer_id)) && (n = null,
        t.isWasteful ? n = "Щедрого игрока нельзя исключить из комнаты" : t.isPopular && (i.isWasteful || (n = "Популярного игрока исключить из комнаты может только самый Щедрый игрок")),
        n ? dialogController.fadePopup(n) : ne(e.extraData.model, e.extraData.view)))
    }),
    X.on("resque:" + z, function(e) {
        var t, i, n, o;
        oe || (t = e.extraData.model).uid !== T && (i = lilo.createView("dialog-resque-user"),
        e = {
            name: util.escapeHtml(t.firstName),
            price: t.deportationModel.price
        },
        n = t.uid,
        o = t.deportationModel.updateCounter,
        i.setModel(e),
        dialogController.open(i),
        i.bind("submit", function() {
            n === t.uid && t.deportationModel.updateCounter === o && 1e4 < t.deportationModel.leftTime ? ae(n, t.deportationModel.price, function(e) {
                2 === e && dialogController.fadePopup("Пользователь спасен!")
            }) : dialogController.fadePopup("Вы не успели спасти игрока"),
            dialogController.close(i)
        }))
    });
    var oe = !1;
    function ae(e, i, n) {
        var t = app.balanceModel.balance - i;
        t < 0 ? dialogController.showInsufficientlyBalanceDialog(t) : (oe = !0,
        ServerApi("room/v3/resque.php", {
            price: i,
            r: K.roomId,
            uid: e
        }, function(e, t) {
            oe = !1,
            util.isDef(t.balance) && app.balanceModel.setAttr({
                balance: t.balance
            }),
            e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : dialogController.fadePopup("Не удалось выполнить запрос") : (n(t.result),
            2 === t.result && cAnal.trackEvent({
                spent_for_resque: i
            }))
        }))
    }
    function se(e, t) {
        K.roomId && (K.roundType !== M.LOTTERY || K.canSpendMoney || isMobi ? (Je(),
        dialogRoomGifts.open(e, t)) : dialogController.lotteryIsActiveDialog())
    }
    function re() {
        return 2 <= K.__countOfViewerAnswersInRound && (dialogController.fadePopup({
            message: "Нельзя менять свой выбор больше 2 раз",
            duration: 1500
        }),
        1)
    }
    X.on("toggle-fav:" + z, function(e) {
        var i, t = e.extraData.model, n = e.extraData.$targetEl, o = "pending";
        n.attr(o) || (n.attr(o, "1"),
        n.addClass("pending"),
        i = t.uid,
        (app.info.favUsersUids[i] ? api.user.removeFromFav({
            targetUid: i
        }, function(e, t) {
            n.removeAttr(o),
            n.removeClass("pending"),
            e ? dialogController.fadePopup({
                message: "Не удалось удалить пользователя из избранного"
            }) : (app.eventBus.trigger(app.EVENTS.USER_REMOVED_FROM_FAV, {
                uid: i
            }),
            dialogController.fadePopup({
                message: "Пользователь удален из избранного"
            }))
        }) : api.user.addToFav({
            targetUid: i
        }, function(e, t) {
            n.removeAttr(o),
            n.removeClass("pending"),
            e ? e.code === Codes.MAX_FAVORITE_USERS_REACHED ? dialogController.showMessageDialog({
                message: "Достигнут лимит избранных пользователей"
            }) : dialogController.fadePopup({
                message: "Не удалось добавить пользователя в избранное"
            }) : (app.eventBus.trigger(app.EVENTS.USER_ADDED_TO_FAV, {
                uid: i
            }),
            dialogController.fadePopup({
                message: "Пользователь добавлен в избранное"
            }))
        })).send(util.random(200, 300)))
    }),
    X.on("add-bot:" + q, function(e) {
        var t = e.extraData.male
          , e = e.extraData.fill;
        Te.addBot({
            roomId: K.roomId,
            byOne: !e,
            botSex: t ? 2 : 1
        })
    }),
    X.on("add-chat-message:" + q, function(e) {
        var t;
        K.roomId && (Je(),
        t = e.extraData.text,
        (t = $.trim(t)).length && (X.elsMap.$chatOverlay.show(),
        Te.addMessageToChat({
            roomId: K.roomId,
            message: t,
            targetUid: e.extraData.to,
            reply: e.extraData.reply
        })))
    }),
    X.on("send-private-message:" + z, function(e) {
        var t = K.findUser(e.extraData.model.uid);
        t && (t = !!t.freeMessageCountersMap[T],
        new app.controllers.dialog.RoomPrivateMessage({
            targetUid: e.extraData.model.uid,
            roomId: K.roomId,
            isFreePrivateMessage: t
        }))
    }),
    X.on("p2p-invite:" + z, function(e) {
        K.findUser(e.extraData.model.uid) && new app.controllers.dialog.RoomPrivateMessage({
            targetUid: e.extraData.model.uid,
            roomId: K.roomId,
            p2pInvite: !0
        })
    }),
    X.on("add-gift:" + z, function(e) {
        isMobi ? se(e.extraData.model.uid, {
            view: e.extraData.resultView
        }) : se(e.extraData.model.uid)
    }),
    X.on("add-gift-beginner:" + z, function(e) {
        se(e.extraData.model.uid, {
            forBeginner: !0
        })
    }),
    X.on("send-recent-gift:" + z, function(e) {
        se(e.extraData.model.uid, {
            recentGiftId: e.extraData.giftId
        })
    }),
    X.on("send-gift-from-popup:" + z, function(e) {
        se(e.extraData.model.uid, {
            popupItemModel: e.extraData.popupItemModel,
            gift: e.extraData.gift
        })
    }),
    X.bind("send-gift-back", function(e) {
        e = e.extraData.targetUid;
        K.findUser(e) ? se(e) : dialogController.fadePopup("Игрок вышел")
    }),
    X.on("open-profile:" + z, function(e) {
        var t = e.extraData.model
          , e = t.uid;
        Je(),
        t.isWinner || t.isSelectableByFirstPos || t.isSelectableBySecondPos || e && app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: e,
            referrer: GuestReferrer.GAME
        })
    }),
    r.onSelectBtnClick = function(e, t) {
        if (K.roomId) {
            Je();
            var i = e.uid;
            if (K.state !== A.STARTED || K.roundType !== M.CHOOSE_COUPLE_FOR_FEMALE && K.roundType !== M.CHOOSE_COUPLE_FOR_MALE || K.viewerAnswer === i + "")
                return K.state === A.STARTED && K.roundType === M.CHOICE_EACH_OTHER && e.male !== S && K.viewerAnswer !== i + "" && nt.onSelectBtnClick(e, t);
            if (!K.viewerAnswer) {
                var n = "__chooseCoupleIsSend";
                return K[n] ? void 0 : (K[n] = !0,
                t.addClass("loading"),
                setTimeout(function() {
                    t.removeClass("loading"),
                    K[n] = !1
                }, 2e3),
                Te.addAnswer({
                    questionId: K.roundQuestion.id,
                    answerId: i + "",
                    roomId: K.roomId
                }),
                !0)
            }
        }
    }
    ,
    X.on("select:" + z, function(e) {
        r.onSelectBtnClick(e.extraData.model, e.extraData.$btn)
    }),
    X.on("choice:" + z, function(e) {
        if (K.roomId) {
            Je();
            var t = e.extraData.model.uid
              , i = !(K.state !== A.STARTED || K.roundType !== M.WHO_LIKES_ON_FEMALES && K.roundType !== M.WHO_LIKES_ON_MALES || t !== K.firstUidForSelect && t !== K.secondUidForSelect || K.viewerAnswer === t + "");
            if (i && -1 === K.usersSnapshot.indexOf(T))
                return dialogController.fadePopup({
                    message: "Голосовать нельзя. Ожидаем конца раунда",
                    duration: 3e3
                }),
                void (e.extraData.isHandled = !0);
            i ? re() || e.extraData.$el.hasClass("loading") || (e.extraData.$el.addClass("loading"),
            Te.addAnswer({
                questionId: K.roundQuestion.id,
                answerId: t + "",
                roomId: K.roomId
            }),
            e.extraData.isHandled = !0) : isMobi || (t !== T ? (K.roundType !== M.WHO_LIKES_ON_FEMALES && K.roundType !== M.WHO_LIKES_ON_MALES || t !== K.firstUidForSelect && t !== K.secondUidForSelect) && (IS_DESKTOP ? se(t) : (e.extraData.$el.addClass("open-popup"),
            app.eventBus.trigger("open-room-user-popup", {
                uid: t
            }))) : IS_DESKTOP || e.extraData.$el.hasClass("can-clear-gifts") && (e.extraData.$el.addClass("open-popup"),
            app.eventBus.trigger("open-room-user-popup", {
                uid: t
            })))
        }
    }),
    X.on("couple-choice:" + q, function(e) {
        var t, i, n;
        K.roomId && (re() || K.getViewer().state !== I.ANSWERED && ("1" == e.extraData.answerId + "" ? (n = K.findUser(S ? K.couple.femaleUid : K.couple.maleUid)) && ((t = K.getStartStateLeftSeconds() - 2) < 0 ? t = 0 : 10 < t && (t = 10),
        X.els["couple-actions"].hide(),
        X.elsMap.$timer.show(),
        i = rawGiftsHash[app.info.roomGiftKissId],
        n = new app.controllers.dialog.GiftShootingRange({
            leftSeconds: t,
            giftDescription: i,
            headerText: "Куда хотите поцеловать?",
            onComplete: function(e, t, i) {
                k();
                var n = [];
                e.each(function(e, t) {
                    n.push(t.x + "_" + t.y)
                });
                e = "1_{0}_{1}".format(expController.getCurrentLevel(), n.join("_"));
                X.els["couple-actions"].hide(),
                Te.addAnswer({
                    questionId: K.roundQuestion.id,
                    answerId: e,
                    roomId: K.roomId
                }, function(e, t) {
                    util.isDef(t.balance) && app.balanceModel.setAttr({
                        balance: t.balance
                    })
                })
            },
            photo200: n.photo200
        }),
        Te.addAnswer({
            questionId: K.roundQuestion.id,
            answerId: "-2",
            roomId: K.roomId
        }, $.noop),
        R = n.dialogView,
        app.balanceModel.lock(),
        R.onRemove(function() {
            app.balanceModel.unlock()
        })) : (X.els["couple-actions"].hide(),
        Te.addAnswer({
            questionId: K.roundQuestion.id,
            answerId: e.extraData.answerId + "",
            roomId: K.roomId
        })),
        e.extraData.$el.addClass("loading")))
    }),
    this.addAnswerWhenNormalRound = function(e) {
        var t = e.extraData.model;
        K.state === A.STARTED && K.roundType === M.NORMAL && t.id !== K.viewerAnswer && (re() || (e.extraData.$el.addClass("loading"),
        Te.addAnswer({
            questionId: K.roundQuestion.id,
            answerId: t.id,
            roomId: K.roomId
        })))
    }
    ,
    X.on("answer:item-answer", function(e) {
        K.roomId && (Je(),
        r.addAnswerWhenNormalRound(e))
    }),
    X.on("switch-room:" + q, function() {
        var e = K.isConference() ? "Вы уверены, что хотите выйти из видео чата?" : "Вы уверены, что хотите покинуть данную комнату?";
        dialogController.confirm({
            message: e,
            onOk: function() {
                return Te.switchRoom(),
                !1
            }
        })
    });
    var le = {};
    function de() {
        $.each(le, function(e, t) {
            t.abort()
        }),
        le = {}
    }
    function ce(e, t, i, n, o, a) {
        this.id = e,
        this.r = t,
        this.t = i,
        this.started = !1,
        this.setter = a;
        var s = n < o ? 1 : -1
          , r = [];
        if (n !== o)
            for (; r.push(n += s),
            n !== o; )
                ;
        else
            this.setter(o);
        this.data = r
    }
    function ue(e, t) {
        t = (t = t || {}).id;
        return t === ExitReason.COMPLAINTS_OF_AGE ? (tt(),
        dialogController.showMessageDialog({
            message: "Вы были исключены из комнаты из-за большого количества жалоб"
        }),
        setTimeout(function() {
            K.getViewer().setAttr({
                isEmpty: !0
            }),
            Te.getRoom()
        }, 500),
        api.user.getUsers({
            uids: [T].join(","),
            fields: "age"
        }, function(e, t) {
            e || (t = t.list[0]) && t.age && (app.info.age = t.age,
            app.eventBus.trigger(app.EVENTS.AGE_CHANGED, {
                age: t.age
            }),
            util.lStorage.save("age", t.age))
        }).send(),
        1) : t === ExitReason.BAN || t === ExitReason.COMPLAINTS_OF_ABUSE ? (document.write(""),
        1) : t === ExitReason.JUST_EXIT || t === ExitReason.TIMEOUT ? (We(),
        1) : t === ExitReason.BY_ROOM_OWNER && (api.roomV3.exit({
            roomId: K.roomId
        }, $.noop).send(),
        Y(),
        x && dialogController.showMessageDialog({
            message: "Вы были исключены из комнаты ее владельцем",
            isModal: !0,
            buttons: [{
                caption: "Вернуться в игру",
                handler: function() {
                    return mt(),
                    !1
                }
            }]
        }),
        1)
    }
    function pe(e, t) {
        K.setAttr({
            firstUidVotes: e.firstUidVotes,
            secondUidVotes: e.secondUidVotes
        }),
        K.usersSnapshot = e.usersSnapshot || [],
        K.roundType = e.type,
        s(e.roundQuestion) && ve(e.roundQuestion),
        s(e.answersPerRound) && (K.answersPerRound = e.answersPerRound),
        s(e.firstUidForSelect) && (K.firstUidForSelect = e.firstUidForSelect),
        s(e.secondUidForSelect) && (K.secondUidForSelect = e.secondUidForSelect),
        s(e.firstUidVotes) && (K.firstUidVotes = e.firstUidVotes),
        s(e.secondUidVotes) && (K.secondUidVotes = e.secondUidVotes),
        s(e.winCombination) && (K.winCombination = e.winCombination),
        s(e.usersBets) && (K.usersBets = e.usersBets),
        s(e.lotteryResults) && (K.lotteryResults = e.lotteryResults),
        t === A.STARTED ? (K.startStateCtm = e.startStateCtm,
        K.startStateDuration = e.startStateDuration) : t === A.PAUSED && (K.pauseStateCtm = e.pauseStateCtm,
        K.pauseStateDuration = e.pauseStateDuration),
        e.type === M.RAFFLE ? (K.prevRoundAnswers = e.prevRoundAnswers,
        K.prevAnswersPerRound = e.prevAnswersPerRound,
        K.couple = e.couple,
        K.answersPerRound = e.answersPerRound,
        K.featureType = e.featureType,
        K.uidsWithSameScore = e.uidsWithSameScore) : e.type === M.CHOICE_EACH_OTHER ? (K.subStateId = e.subStateId,
        K.subStateEstimatedTime = e.subStateEstimatedTime,
        K.answersPerRound = e.answersPerRound,
        K.coupleList = e.coupleList,
        K.coupleIds = e.coupleIds,
        K.winnerCoupleId = e.winnerCoupleId) : e.type === M.CHOOSE_COUPLE_FOR_MALE || e.type === M.CHOOSE_COUPLE_FOR_FEMALE ? (K.mapOfUidsforSelect = e.mapOfUidsforSelect,
        K.targetUid = e.targetUid,
        K.answersPerRound = e.answersPerRound) : e.type === M.LOADING_ROUND && (K.maleUserWithPhoto = e.maleUserWithPhoto || null,
        K.femaleUserWithPhoto = e.femaleUserWithPhoto || null,
        K.canShowPhotos = e.canShowPhotos)
    }
    function fe(e) {
        try {
            var t, i = (a = e,
            H.parse(a)), n = util.isDef, o = !K.roomId;
            if (K.__nextRoomId = i.roomId,
            K.conferenceData = i.conferenceData,
            o)
                K.setAttr({
                    leftTimeForNextRewardOfLocalTop: i.leftTimeForNextRewardOfLocalTop,
                    leftCoinsInLocalRoomTop: i.leftCoinsInLocalRoomTop,
                    accessDescr: i.accessDescr,
                    ownerId: i.roomOwner,
                    title: i.title,
                    roomOwnerFirstName: i.roomOwnerFirstName,
                    roomOwnerLastName: i.roomOwnerLastName
                });
            else if (i.roomId !== K.roomId)
                return;
            if (ue(i.sid, i.exitReason))
                return;
            K.popularUid = i.popularUid,
            K.wastefulUid = i.wastefulUid,
            K.djUid = i.djUid,
            K.fortunateUid = i.fortunateUid,
            i.exp && (o ? expController.setExp(i.exp) : expController.setRealExp(i.exp)),
            Ie(i.users),
            K.roomId = i.roomId,
            L(),
            i.round && (i.roomState === A.STARTED && K.state === A.STARTED && i.round.roundQuestion.id !== K.roundQuestion.id && (K.state = null),
            pe(i.round, i.roomState)),
            n(i.viewerAnswer) && (K.viewerAnswer = i.viewerAnswer,
            setTimeout(function() {
                $e(i.viewerAnswer)
            }, 50)),
            function(e, t) {
                if (K.state !== e)
                    switch (e) {
                    case A.WAITING_USERS:
                        Ne();
                        break;
                    case A.PAUSED:
                        Le(t);
                        break;
                    case A.STARTED:
                        Ue(t)
                    }
                else
                    switch (e) {
                    case A.WAITING_USERS:
                        A.STARTED;
                        break;
                    case A.PAUSED:
                        !function(e) {
                            {
                                var t;
                                e === A.WAITING_USERS || e === A.STARTED || (K.roundType === M.RAFFLE ? (t = K.findUser(K.couple.maleUid),
                                e = K.findUser(K.couple.femaleUid),
                                t && e || (ze.abort(),
                                Ve(),
                                X.els["couple-results"].hide(),
                                X.els["couple-results"].children().empty())) : K.roundType === M.LOTTERY ? ot.updatePausedState() : ze.onRoomUpdate())
                            }
                        }(e);
                        break;
                    case A.STARTED:
                        K.roundType === M.LOTTERY && ot.updateStartedState()
                    }
                X.update()
            }(i.roomState, o),
            i.chatMessages && Pe(i.chatMessages, o),
            i.privateMessages && Re(i.privateMessages, o),
            i.radioJson && st.update(i.radioJson),
            K.versionOfLastChange = i.versionOfLastChange,
            o && (t = Et.getLastChanges(i.roomId),
            rt.handleChanges(t),
            wt && wt !== K.roomId && (wt = null,
            dialogController.fadePopup({
                message: "Вы были перемещены в другую комнату",
                duration: 3500
            }))),
            Qe.onQueueChange(i.roomQueue),
            bt && (gt = bt,
            bt = null),
            K.setAttr({
                modCounter: K.modCounter + 1
            })
        } catch (e) {
            console.error(e.stack)
        }
        var a
    }
    function me(e, t, i, n, o) {
        if (i === K.roomId && !ue(0, o) && e && e.length)
            try {
                K.__changeId = t,
                rt.handleChanges(e)
            } catch (e) {
                console.error(e.stack)
            }
    }
    function ve(e) {
        K.roundQuestion.id !== e.id ? (K.roundQuestion.id = e.id,
        K.roundQuestion.setAttr({
            text: e.text,
            uid: e.uid,
            fullName: e.fullName
        }),
        K.roundQuestion.answers.removeAll(),
        e.answers.length && K.roundQuestion.answers.add(e.answers)) : 0 === K.roundQuestion.answers.length && 3 === e.answers.length && K.roundQuestion.answers.add(e.answers)
    }
    $.extend(ce.prototype, {
        canContinue: function() {
            return this.r === K.roomId && this.t === K.roundType
        },
        addLastValue: function(e) {
            var t = this.data
              , i = t[t.length - 1]
              , n = i < e ? 1 : -1;
            if (console.debug("AddLastValue", this.id, i, e),
            !util.isDef(i) && 0 === t.length)
                return console.debug("ahting!", t),
                !1;
            if (util.isDef(i) && i !== e)
                for (; t.push(i += n),
                i !== e; )
                    ;
            return !0
        },
        start: function() {
            var e = this
              , t = e.data
              , i = 0
              , n = function() {
                e.started && i < t.length && e.canContinue() && (e.setter(t[i++]),
                t.length === i ? delete le[e.id] : setTimeout(n, util.random(200, 500)))
            };
            e.started = !0,
            n()
        },
        abort: function() {
            this.started = !1
        }
    }),
    r.animateCounter = function(e, t, i, n) {
        var o = le[e];
        o && o.addLastValue(i) || (o = new ce(e,K.roomId,K.roundType,t,i,n)).data.length && (le[e] = o).start()
    }
    ,
    r.handleExitReason = function(e) {
        var t, i = (e = e || {}).id, n = !1;
        i === ExitReason.COMPLAINTS_OF_AGE ? (tt(),
        dialogController.showMessageDialog({
            isModal: !0,
            buttons: [{
                caption: "Вернуться в игру",
                handler: function() {
                    return mt(),
                    !1
                }
            }],
            message: "Вы были исключены из комнаты из-за большого количества жалоб"
        }),
        api.user.getUsers({
            uids: [T].join(","),
            fields: "age"
        }, function(e, t) {
            e || (t = t.list[0]) && t.age && (app.info.age = t.age,
            app.eventBus.trigger(app.EVENTS.AGE_CHANGED, {
                age: t.age
            }),
            util.lStorage.save("age", t.age))
        }).send(),
        n = !0) : i === ExitReason.BAN || i === ExitReason.COMPLAINTS_OF_ABUSE ? (dialogController.showAccessDeniedDialog(),
        n = !0) : i === ExitReason.JUST_EXIT || i === ExitReason.TIMEOUT ? (We(),
        n = !0) : i === ExitReason.BY_USER ? e.data && e.data.userRemoved && (n = function(e) {
            {
                var t, i;
                api.roomV3.exit({
                    roomId: K.roomId
                }, $.noop).send(),
                Y(),
                x && (t = e.deportationModel,
                i = t.anon || t.initiatorIsMale,
                e = t.anon ? "Аноним" : t.initiatorName + " " + t.initiatorAge,
                i = "<b>{0}</b> исключил{1} вас из комнаты".format(util.escapeHtml(e), i ? "" : "a"),
                t.reasonId && KickReasonId[t.reasonId] && (i += "<div>Причина: <b>{0}</b></div>".format(KickReasonId[t.reasonId])),
                dialogController.showMessageDialog({
                    message: i,
                    isModal: !0,
                    buttons: [{
                        caption: "Вернуться в игру",
                        handler: function() {
                            return mt(),
                            !1
                        }
                    }]
                }))
            }
        }(e)) : i === ExitReason.P2P_OTHER_USER_EXIT ? (n = !0,
        Y(),
        dialogController.showMessageDialog({
            message: "Ваш собеседник покинул комнату",
            isModal: !0,
            buttons: [{
                caption: "Вернуться в игру",
                handler: function() {
                    return mt(),
                    !1
                }
            }]
        })) : i === ExitReason.EXIT_AFTER_ROUND_COMPLETE && e.data && e.data.userRemoved && (gt ? (t = gt,
        setTimeout(function() {
            t.__exitReason = i,
            Te.getRoom(t),
            console.info("get room...")
        }, 200)) : We(),
        n = !0),
        n && Y()
    }
    ,
    this.updateRoundData = pe,
    this.updateRoundQuestion = ve;
    var he, ge, be, Ce, _e, we, Ee, ye, De, Te, Se = function() {
        De = _e = Ce = ge = be = we = Ee = ye = null,
        K.processActualUsers(function(e) {
            e.isPopular && (be = e),
            e.isDJ && (Ce = e),
            e.isWasteful && (ge = e),
            e.isFortunate && (_e = e)
        }),
        K.processActualUsers(function(e) {
            var t = K.getViewer();
            e.uid === K.djUid ? (e.setAttr({
                isDJ: !0,
                remindDJ: e.djCounter - t.djCounter + 3
            }),
            ye = e) : e.setAttr({
                isDJ: !1
            }),
            e.uid === K.popularUid ? (e.setAttr({
                isPopular: !0,
                remindReceivedGifts: e.receivedGiftsPerRoom - t.receivedGiftsPerRoom + 3
            }),
            Ee = e) : e.setAttr({
                isPopular: !1
            }),
            e.uid === K.wastefulUid ? (e.setAttr({
                isWasteful: !0,
                remindSentGifts: e.sentGiftsPerRoom - t.sentGiftsPerRoom + 3
            }),
            we = e) : e.setAttr({
                isWasteful: !1
            }),
            e.uid === K.fortunateUid ? (e.setAttr({
                isFortunate: !0,
                remainingFortunateCounter: e.lotteryWinsPerRoom - t.lotteryWinsPerRoom + 3
            }),
            De = e) : e.setAttr({
                isFortunate: !1
            })
        }),
        ye && Ce && Ce !== ye ? ye.uid === T ? Ae({
            isDJ: !0,
            isWin: !0,
            users: [{
                photo: ye.photo,
                firstName: ye.firstName,
                exp: ye.exp,
                male: ye.male
            }, {
                photo: Ce.photo,
                firstName: Ce.firstName,
                exp: Ce.exp,
                male: Ce.male
            }]
        }) : Ce.uid === T && Ae({
            isDJ: !0,
            users: [{
                photo: Ce.photo,
                firstName: Ce.firstName,
                exp: Ce.exp,
                male: Ce.male
            }, {
                photo: ye.photo,
                firstName: ye.firstName,
                exp: ye.exp,
                male: ye.male
            }]
        }) : ye && ye.uid === T && ye !== Ce && Ae({
            isDJ: !0,
            users: [{
                photo: ye.photo,
                firstName: ye.firstName,
                exp: ye.exp,
                male: ye.male
            }]
        }),
        we && ge && we !== ge ? we.uid === T ? Ae({
            isWin: !0,
            isWasteful: !0,
            users: [{
                photo: we.photo,
                firstName: we.firstName,
                exp: we.exp,
                male: we.male
            }, {
                photo: ge.photo,
                firstName: ge.firstName,
                exp: ge.exp,
                male: ge.male
            }]
        }) : ge.uid === T && Ae({
            isWasteful: !0,
            users: [{
                photo: ge.photo,
                firstName: ge.firstName,
                exp: ge.exp,
                male: ge.male
            }, {
                photo: we.photo,
                firstName: we.firstName,
                exp: we.exp,
                male: we.male
            }]
        }) : we && we.uid === T && we !== ge && Ae({
            isWasteful: !0,
            users: [{
                photo: we.photo,
                firstName: we.firstName,
                exp: we.exp,
                male: we.male
            }]
        }),
        Ee && be && Ee !== be ? Ee.uid === T ? Ae({
            isWin: !0,
            isPopular: !0,
            users: [{
                photo: Ee.photo,
                firstName: Ee.firstName,
                exp: Ee.exp,
                male: Ee.male
            }, {
                photo: be.photo,
                firstName: be.firstName,
                exp: be.exp,
                male: be.male
            }]
        }) : be.uid === T && Ae({
            isPopular: !0,
            users: [{
                photo: be.photo,
                firstName: be.firstName,
                exp: be.exp,
                male: be.male
            }, {
                photo: Ee.photo,
                firstName: Ee.firstName,
                exp: Ee.exp,
                male: Ee.male
            }]
        }) : Ee && Ee.uid === T && Ee !== be && Ae({
            isPopular: !0,
            users: [{
                photo: Ee.photo,
                firstName: Ee.firstName,
                exp: Ee.exp,
                male: Ee.male
            }]
        }),
        De && _e && De !== _e ? De.uid === T ? Ae({
            isFortunate: !0,
            isWin: !0,
            users: [{
                photo: De.photo,
                firstName: De.firstName,
                exp: De.exp,
                male: De.male
            }, {
                photo: _e.photo,
                firstName: _e.firstName,
                exp: _e.exp,
                male: _e.male
            }]
        }) : _e.uid === T && Ae({
            isFortunate: !0,
            users: [{
                photo: _e.photo,
                firstName: _e.firstName,
                exp: _e.exp,
                male: _e.male
            }, {
                photo: De.photo,
                firstName: De.firstName,
                exp: De.exp,
                male: De.male
            }]
        }) : De && De.uid === T && De !== _e && Ae({
            isFortunate: !0,
            users: [{
                photo: De.photo,
                firstName: De.firstName,
                exp: De.exp,
                male: De.male
            }]
        })
    };
    function Ae(t) {
        var e;
        isMobi || K.roomId && (he && dialogController.close(he),
        X.isVisible && (e = lilo.createView("dialog-room-popularity"),
        (he = e).setModel(t),
        dialogController.open(e, {
            staticTop: 150
        }).$(".dialog-wrap").css("background-color", "#eee"),
        e.onRemove(function() {
            var e;
            t.isFortunate || (e = K.getViewer(),
            (t.isWin || 1 === t.users.length) && e.isDJ && i({
                isDJ: t.isDJ
            }))
        })))
    }
    function Ie(e) {
        var i = t(e, "uid");
        K.processUsers(function(e, t) {
            t.uid && !i[t.uid] && t.setAttr({
                uid: null
            })
        });
        var n = t(K.topUsers, "uid");
        $.extend(n, t(K.bottomUsers, "uid")),
        $.each(i, function(e, t) {
            e = n[e];
            e ? (e.setAttr({
                exp: e.uid === T ? expController.getCurrentExp() : t.exp,
                isAway: t.isAway,
                freeMessageCountersMap: t.freeMessageCountersMap,
                djCounter: t.djCounter,
                sentGiftsPerDay: t.sentGiftsPerDay,
                receivedGiftsPerDay: t.receivedGiftsPerDay,
                expPerDay: t.expPerDay,
                lotteryWinsPerDay: t.lotteryWinsPerDay,
                sentGiftsPerHour: t.sentGiftsPerHour,
                receivedGiftsPerHour: t.receivedGiftsPerHour,
                expPerHour: t.expPerHour,
                hasExpBooster: t.hasExpBooster,
                lotteryWinsPerHour: t.lotteryWinsPerHour,
                sentGiftsPerRoom: t.sentGiftsPerRoom,
                lotteryWinsPerRoom: t.lotteryWinsPerRoom,
                receivedGiftsPerRoom: t.receivedGiftsPerRoom,
                hasBDate: t.hasBDate,
                counterMapOfGiftsForBeginners: t.counterMapOfGiftsForBeginners,
                isMobiUser: t.isMobiUser,
                isVerified: t.isVerified,
                clientType: t.clientType
            }),
            e.updateDeporationModelByExitReason(t.exitReason),
            K.roomId || e.uid !== T || (e.setAttr({
                wins: t.wins,
                giftsCount: t.giftsCount,
                gameCounter1: t.gameCounter1,
                gameCounter2: t.gameCounter2,
                gameCounter3: t.gameCounter3
            }),
            e.setAttr({
                isEmpty: !1
            })),
            K.roundType === M.NORMAL || K.roundType === M.CHOICE_EACH_OTHER ? e.setAttr({
                state: t.state,
                age: t.age
            }) : (r.isRoundWithoutAnswersState() && t.state === I.ANSWERED || e.setAttr({
                state: t.state
            }),
            e.setAttr({
                age: t.age
            })),
            K.roomId || e.uid !== T || e.setAttr({
                isEmpty: !1
            }),
            Me(e, t.gifts)) : (e = xe(t.male)) && (e.setAttr({
                exp: t.exp,
                isEmpty: !1,
                age: t.age,
                male: t.male,
                isAway: t.isAway,
                freeMessageCountersMap: t.freeMessageCountersMap,
                djCounter: t.djCounter,
                coolLikes: t.coolLikes,
                hasExpBooster: t.hasExpBooster,
                sentGiftsPerDay: t.sentGiftsPerDay,
                receivedGiftsPerDay: t.receivedGiftsPerDay,
                expPerDay: t.expPerDay,
                lotteryWinsPerDay: t.lotteryWinsPerDay,
                sentGiftsPerHour: t.sentGiftsPerHour,
                receivedGiftsPerHour: t.receivedGiftsPerHour,
                expPerHour: t.expPerHour,
                lotteryWinsPerHour: t.lotteryWinsPerHour,
                realFirstName: t.firstName,
                firstName: t.firstName + util.formatProfileBdate(null, t.age),
                firstNameAcc: t.firstNameAcc,
                firstNameGen: t.firstNameGen,
                firstNameDat: t.firstNameDat,
                photo: t.photo_100,
                photo200: t.photo_200,
                isMobiUser: t.isMobiUser,
                counterMapOfGiftsForBeginners: t.counterMapOfGiftsForBeginners,
                hasBDate: t.hasBDate,
                isVerified: t.isVerified,
                clientType: t.clientType
            }),
            e.setAttr({
                countryId: t.countryId
            }),
            e.setAttr({
                wins: t.wins,
                giftsCount: t.giftsCount,
                gameCounter1: t.gameCounter1,
                gameCounter2: t.gameCounter2,
                gameCounter3: t.gameCounter3,
                regionId: t.regionId,
                sentGiftsPerRoom: t.sentGiftsPerRoom,
                lotteryWinsPerRoom: t.lotteryWinsPerRoom,
                receivedGiftsPerRoom: t.receivedGiftsPerRoom
            }),
            e.updateDeporationModelByExitReason(t.exitReason),
            r.isRoundWithoutAnswersState() && t.state === I.ANSWERED ? e.setAttr({
                state: I.IDLE
            }) : e.setAttr({
                state: t.state
            }),
            e.setAttr({
                uid: t.uid
            }),
            Me(e, t.gifts))
        }),
        Se()
    }
    function Me(s, e) {
        var n, r = !K.roomId, o = {};
        $.each(e, function(e, t) {
            if (!s.__giftsHash[t.ts]) {
                s.__giftsHash[t.ts] = t;
                var i = (i = o[t.from]) || (o[t.from] = []);
                for (e = 0,
                n = t.count; e < n; e += 1)
                    i.push(t)
            }
        }),
        $.each(o, function(e, i) {
            var n = K.roomId
              , o = 0
              , a = function() {
                var e, t;
                K.roomId === n && (e = i[o++],
                t = {
                    isLastGift: o === i.length
                },
                Oe(e.id, e.from, s.uid, e, r, t),
                o < i.length && (r ? a() : setTimeout(a, 500)))
            };
            a()
        });
        var i;
        util.collectArrayInObjectByProperty(e, "ts");
        s.uid === T && (i = !1,
        $.each(s.__giftsHash, function(e, t) {
            if (rawGiftsHash[t.id].isViewerCanClean)
                return !(i = !0)
        }),
        e = X.getViewerEl(),
        i ? e.addClass("can-clear-gifts") : e.removeClass("can-clear-gifts"))
    }
    function Oe(e, t, i, n, o, a) {
        e = rawGiftsHash[e];
        e && ((a = a || {}).gift = n,
        Xe.animateGift(e, n, t, i, o, a))
    }
    function xe(e) {
        var e = e ? S ? K.bottomUsers : K.topUsers : S ? K.topUsers : K.bottomUsers
          , i = [];
        return $.each(e, function(e, t) {
            t.uid || i.push(t)
        }),
        i.sort(function(e, t) {
            return e.orderIndex > t.orderIndex ? 1 : -1
        }),
        i[0]
    }
    function Re(e, t) {
        t ? K.getViewer().privateMessages.add(e) : $.each(e, function(e, t) {
            Xe.animatePrivateMessage(t.from === T ? t.to : t.from, T, {
                message: t,
                onComplete: function() {
                    K.getViewer().privateMessages.add(t)
                }
            })
        })
    }
    function ke() {
        var e = !0;
        return e = K.roundType === M.CHOICE_EACH_OTHER || K.roundType === M.CHOOSE_COUPLE_FOR_FEMALE || K.roundType === M.CHOOSE_COUPLE_FOR_MALE ? !1 : e
    }
    function Pe(e, n) {
        var i, o = [], a = !1, t = [], s = [];
        n && 100 < e.length && (e = e.slice(e.length - 90)),
        n || (i = []);
        var r = !1;
        $.each(e, function(e, t) {
            if (t.type !== O.LOTTERY_WIN) {
                if (t.type !== O.SYSTEM_USER_STATUS || 4 !== t.statusId || n)
                    return t.type === O.LOTTERY_COMMON_RESULT ? (s.push(t),
                    void (n && o.push(t))) : void (t.type !== O.SYSTEM_USER_CAME && t.type !== O.SYSTEM_USER_OUT && (t.type !== O.SYSTEM_REWARD_IN_LOCAL_ROOM_TOP || n || (t.hasViewerResult && (a = !0,
                    K.setAttr({
                        leftCoinsInLocalRoomTop: t.leftCoinsInLocalRoomTop
                    }),
                    function(e) {
                        try {
                            var n = {}
                              , o = "lrt{0}{1}_".format(2 === app.info.sex ? "M" : "F", app.info.age < 18 ? "T" : "A");
                            e._users.each(function(e, t) {
                                if (t.uid === app.info.viewer_id)
                                    return t.rewards.each(function(e, t) {
                                        var i = o + t.type;
                                        n[i] = t.value
                                    }),
                                    !1
                            }),
                            cAnal.trackEvent(n)
                        } catch (e) {
                            console.error(e)
                        }
                    }(t)),
                    K.setAttr({
                        leftTimeForNextRewardOfLocalTop: t._leftTimeForNextReward
                    })),
                    app.info.blockedUids[t.from] && !t.giftImg || o.push(t)));
                K.__messageOfNewFortunateUser = t
            } else
                n || i.push(t)
        }),
        e = o;
        var l, d, c, u, p, f, m = K.roomId;
        s.length && (n || setTimeout(function() {
            K.roomId === m && (s[0].items.each(function(e, t) {
                n || t.from
            }),
            api.syncBalance(),
            X.addChatMessages(s),
            t.length && X.addChatMessages(t))
        }, 5950)),
        0 !== e.length && (l = K.usersToHash(),
        c = e,
        u = {
            modelsByUid: {},
            uids: []
        },
        $.each(c, function(e, t) {
            var i = t.from
              , n = u.modelsByUid[i];
            n || (n = u.modelsByUid[i] = [],
            u.uids.push(i)),
            n.push(t),
            t.type !== O.TALK && t.type !== O.GIFT && t.type !== O.SYSTEM_BAN_USER || (i = t.to,
            (n = u.modelsByUid[i]) || (n = u.modelsByUid[i] = [],
            u.uids.push(i)),
            n.push(t))
        }),
        (c = u).uids,
        c.modelsByUid,
        d = [],
        p = ke(),
        f = K.isConference(),
        $.each(e, function(e, t) {
            var i;
            d.push(t),
            n || t.giftImg || t.isSystem ? t.type !== O.LIKE_SOUND && t.type !== O.COOL_TRACK || d.splice(d.length - 1) : f || (t.type === O.LIKE_SOUND || t.type === O.COOL_TRACK ? ((i = l[t.from]) && i.setAttr({
                outgoingMessage: t
            }),
            d.splice(d.length - 1)) : ((i = l[t.from]) && i.setAttr({
                outgoingMessage: t
            }),
            (i = l[t.to]) && p && i.setAttr({
                incomingMessagesCount: i.incomingMessagesCount + 1
            }),
            t.to === T && (r = !0)))
        }),
        X.addChatMessages(d, n && !0),
        !n && r && app.soundManager.isEnabled() && v.playSoundEffect(h, 100),
        a && api.syncBalance())
    }
    function Ne() {
        Xe.abortCustomGiftsAnimation(),
        Xe.clearCacheOfCustomGiftsAnimations(),
        de(),
        ct(),
        k(),
        K.__viewerOpenFadeArrow = !1,
        K.setAttr({
            canSpendMoney: !0
        }),
        ze.abort(),
        X.elsMap.$answerSavingOverlay.hide(),
        X.els["couple-results"].hide(),
        X.els["couple-results"].children().empty(),
        X.els["couple-actions"].hide(),
        X.elsMap.$votes.hide(),
        ot.stop(),
        nt.abort(),
        K.state = A.WAITING_USERS,
        X.checkBots(),
        X.showWaitUsers(),
        X.elsMap.$canvasLayer.empty(),
        Fe(),
        at.stop(),
        X.stopTimer(),
        lt(),
        app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW)
    }
    function Ue(e) {
        var t, i, n, o, a, s, r, l, d;
        ct(),
        X.elsMap.$answersList.css("opacity", "0"),
        X.elsMap.$questionText.css("opacity", "0"),
        de(),
        Xe.abortCustomGiftsAnimation(),
        Xe.clearCacheOfCustomGiftsAnimations(),
        k(),
        K.setAttr({
            canSpendMoney: !0
        }),
        K.__viewerOpenFadeArrow = !1,
        K.state = A.STARTED,
        K.__countOfViewerAnswersInRound = 0,
        K[c] = 0,
        X.checkBots(),
        X.elsMap.$votes.hide(),
        X.el.removeClass(D),
        Fe(),
        X.el.removeClass(g),
        X.els["couple-results"].hide(),
        X.els["couple-results"].children().empty(),
        X.els["couple-actions"].hide(),
        K.viewerAnswer = null,
        K.roundType !== M.LOTTERY && ot.stop(),
        nt.abort(),
        K.roundType === M.RAFFLE ? (K.roundQuestion.answers.removeAll(),
        K.restartRaffle || 0 === K.prevRoundAnswers.length || 2 === K.featureType || 3 === K.featureType ? (ze.abort(),
        X.stopTimer(),
        lt()) : (ze.abort({
            saveArrows: !0
        }),
        K.roundQuestion.answers.add(K.prevRoundAnswers)),
        X.el.addClass(f),
        a = K.roundQuestion.id,
        l = function() {
            var t, i, n, e, o;
            a === K.roundQuestion.id && K.state !== A.WAITING_USERS && K.state !== A.PAUSED && (ze.abort({
                saveCoupleResults: !0
            }),
            K.roundQuestion.answers.removeAll(),
            t = K.findUser(K.couple.maleUid),
            i = K.findUser(K.couple.femaleUid),
            t && i && (3 === K.featureType && (X.elsMap.$questionText.css("opacity", "1"),
            X.elsMap.$questionText.text("Ожидаем поцелуи от выигравшей пары...").show()),
            t.setAttr({
                isCoupleMale: !0,
                isCenter: !1
            }),
            i.setAttr({
                isCoupleFemale: !0,
                isCenter: !1
            }),
            t.uid === T || i.uid === T ? (X.els["couple-actions"].show().find("span").removeClass("pressed loading"),
            app.soundManager.play(app.soundManager.SOUND_IDS.VIEWER_IS_SELECTED),
            app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW, {
                forceOpen: !0
            }),
            3 === K.featureType && X.el.addClass(g)) : (X.el.addClass(b),
            X.startTimer()),
            X.forceRedraw(200),
            n = K.roomId,
            e = t.uid === T || i.uid === T ? -10 : 0,
            (o = K.getStartStateLeftSeconds() + e) < 0 && (o = 0),
            X.elsMap.$timer.show(),
            X.startTimer({
                leftSeconds: o,
                withoutSound: !0,
                updateHandler: function() {
                    var e;
                    n === K.roomId && (--o < 0 && (o = 0),
                    X.viewModel.setAttr({
                        roundLeftTime: o
                    }),
                    0 === o && (X.stopTimer(),
                    X.els["couple-actions"].hide(),
                    R || K.getViewer().state === I.ANSWERED || !t.isCoupleMale && !i.isCoupleFemale || t.uid !== T && i.uid !== T || (Te.addAnswer({
                        questionId: K.roundQuestion.id,
                        answerId: "5",
                        roomId: K.roomId
                    }, $.noop),
                    (e = K.couple) && (t.uid !== T || e.femaleAnswer || resultController.showCoupleResults(!1, e.femaleUid, "-2"),
                    i.uid !== T || e.maleAnswer || resultController.showCoupleResults(!0, e.maleUid, "-2")))))
                }
            }),
            X.viewModel.setAttr({
                roundLeftTime: o
            })))
        }
        ,
        e ? setTimeout(l, 100) : 2 === K.featureType ? (t = K.couple,
        K.processUsers(function(e) {
            if (e.isCenter)
                return n = e,
                !1
        }),
        e = -1 !== (i = K.uidsWithSameScore).indexOf(t.maleUid),
        1 < i.length ? ((n = K.findUser(e ? t.femaleUid : t.maleUid)) && n.setAttr({
            isCenter: !0
        }),
        ze.animateUsers(e ? t.maleUid : t.femaleUid, l, {
            hashOfUidsForAnimation: util.collectArrayInObjectByProperty(i)
        })) : setTimeout(l, 0)) : 3 === K.featureType ? setTimeout(l, 0) : ze.animateCouple(K.couple, K.prevAnswersPerRound, l, {
            restartRaffle: K.restartRaffle
        }),
        at.stop(),
        X.elsMap.$waitUsersLoader.hide(),
        X.elsMap.$answersSavedCaption.hide(),
        K.prevRoundAnswers.length || 1 !== K.featureType ? X.elsMap.$questionText.hide() : X.elsMap.$questionText.text("Случайная пара").show(),
        X.elsMap.$answerSavingOverlay.hide(),
        X.elsMap.$answersList.show(),
        X.elsMap.$timer.hide()) : K.roundType === M.CHOICE_EACH_OTHER ? (lt(),
        X.el.addClass(C),
        X.elsMap.$timer.hide(),
        ze.abort(),
        at.stop(),
        X.elsMap.$canvasLayer.empty(),
        X.elsMap.$waitUsersLoader.hide(),
        X.elsMap.$answersSavedCaption.hide(),
        X.elsMap.$questionText.show(),
        X.elsMap.$questionCreatorEl.show(),
        X.elsMap.$timer.show(),
        X.elsMap.$answerSavingOverlay.hide(),
        X.elsMap.$answersList.show(),
        nt.start(),
        nt.showNewSubState(),
        app.soundManager.play(app.soundManager.SOUND_IDS.ROUND_START)) : K.roundType === M.CHOOSE_COUPLE_FOR_FEMALE || K.roundType === M.CHOOSE_COUPLE_FOR_MALE ? (o = K.roundType,
        a = K.roundQuestion.id,
        s = K.roundQuestion.text,
        r = function() {
            return K.roundType !== o || a !== K.roundQuestion.id || K.state === A.WAITING_USERS || K.state === A.PAUSED
        }
        ,
        ze.abort(),
        ze.animateUsers(K.targetUid, function() {
            var e;
            r() || (ze.abort(),
            X.elsMap.$questionText.text(s).show(),
            X.elsMap.$timer.show(),
            (e = K.findUser(K.targetUid)) && e.setAttr({
                isCenter: !0
            }),
            setTimeout(function() {
                r() || (X.el.addClass(_),
                X.el.addClass(K.roundType === M.CHOOSE_COUPLE_FOR_FEMALE ? E : w))
            }, 500),
            app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW, {
                centerUser: e,
                forceOpen: !0
            }))
        }),
        at.stop(),
        X.elsMap.$canvasLayer.empty(),
        X.elsMap.$waitUsersLoader.hide(),
        X.elsMap.$answersSavedCaption.hide(),
        X.elsMap.$questionText.text("Выбор пары").show(),
        X.elsMap.$questionCreatorEl.show(),
        X.elsMap.$answerSavingOverlay.hide(),
        X.elsMap.$answersList.hide(),
        X.elsMap.$timer.hide(),
        X.startTimer(),
        app.soundManager.play(app.soundManager.SOUND_IDS.ROUND_START),
        Be(K.mapOfUidsforSelect)) : K.roundType === M.LOTTERY ? (lt(),
        X.el.addClass(y),
        ze.abort(),
        at.stop(),
        X.elsMap.$canvasLayer.empty(),
        isMobi ? X.elsMap.$questionText.hide() : X.elsMap.$questionText.text("Бонусный раунд").show(),
        X.elsMap.$waitUsersLoader.hide(),
        X.elsMap.$answersSavedCaption.hide(),
        X.elsMap.$questionCreatorEl.show(),
        X.elsMap.$timer.hide(),
        X.elsMap.$answerSavingOverlay.hide(),
        X.elsMap.$answersList.show(),
        ot.view.els.timer.html(""),
        X.startTimer({
            onTimerUpdate: isMobi ? function(e) {
                ot.setCanBet(0 < e),
                ot.view.els.timer.html("<b style='color:" + (e < 10 ? "#ff0000" : "#000") + "'>" + e + "</b> сек.")
            }
            : function(e) {
                ot.setCanBet(0 < e),
                ot.view.els.timer.html("Ставки можно делать еще <b style='color:" + (e < 10 ? "#ff0000" : "#000") + "'>" + e + "</b> сек.")
            }
        }),
        x && app.soundManager.play(app.soundManager.SOUND_IDS.ROUND_START),
        ot.onRoundStart()) : K.roundType === M.LOADING_ROUND ? (ze.abort(),
        at.stop(),
        X.elsMap.$canvasLayer.empty(),
        at.start(),
        at.showEvaluationPhotos()) : (lt(),
        ze.abort(),
        at.stop(),
        X.elsMap.$canvasLayer.empty(),
        X.elsMap.$waitUsersLoader.hide(),
        X.elsMap.$answersSavedCaption.hide(),
        X.elsMap.$questionText.show(),
        X.elsMap.$questionCreatorEl.show(),
        X.elsMap.$timer.show(),
        X.elsMap.$answerSavingOverlay.hide(),
        X.elsMap.$answersList.show(),
        X.startTimer(),
        app.soundManager.play(app.soundManager.SOUND_IDS.ROUND_START),
        K.roundType !== M.NORMAL ? (K.roundQuestion.setAttr({
            text: "Кто больше нравится?"
        }),
        X.elsMap.$votes.show(),
        l = K.findUser(K.firstUidForSelect),
        d = K.findUser(K.secondUidForSelect),
        l && l.setAttr({
            isSelectableByFirstPos: !0,
            isSelectableBySecondPos: !1
        }),
        d && d.setAttr({
            isSelectableByFirstPos: !1,
            isSelectableBySecondPos: !0
        }),
        X.forceRedraw(200),
        K.firstUidForSelect !== T && K.secondUidForSelect !== T || app.soundManager.play(app.soundManager.SOUND_IDS.VIEWER_IS_SELECTED)) : (d = util.cloneArray(K.roundQuestion.answers),
        K.roundQuestion.answers.removeAll(),
        K.roundQuestion.answers.add(d),
        X.elsMap.$votes.hide())),
        ft(),
        app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW, {
            forceOpen: !0
        })
    }
    function Le(e) {
        var t, i, n;
        ct(),
        K.__viewerOpenFadeArrow = !1,
        de(),
        k(),
        e ? ze.abort() : ze.abort({
            saveCoupleResults: K.roundType === M.RAFFLE
        }),
        K.state = A.PAUSED,
        X.el.removeClass(D),
        X.el.addClass(f),
        X.el.addClass(m),
        K[c] = 0,
        X.el.removeClass(g),
        X.els["couple-actions"].hide(),
        X.elsMap.$votes.hide(),
        X.stopTimer(),
        at.stop(),
        X.elsMap.$waitUsersLoader.hide(),
        X.elsMap.$answersSavedCaption.hide(),
        X.elsMap.$questionText.hide(),
        X.elsMap.$timer.hide(),
        X.elsMap.$questionCreatorEl.hide(),
        X.elsMap.$answerSavingOverlay.hide(),
        X.elsMap.$answersList.show(),
        K.setAttr({
            canSpendMoney: !0
        }),
        K.roundType !== M.LOTTERY && ot.stop(),
        nt.abort(),
        K.roundType === M.NORMAL ? ze.start(function() {}) : K.roundType === M.LOADING_ROUND || (K.roundType === M.LOTTERY ? (X.el.addClass(y),
        ot.onRoundPause(function() {})) : K.roundType === M.CHOICE_EACH_OTHER ? nt.start() : K.roundType === M.CHOOSE_COUPLE_FOR_FEMALE || K.roundType === M.CHOOSE_COUPLE_FOR_MALE ? (lt(),
        X.el.addClass(_),
        X.el.addClass(K.roundType === M.CHOOSE_COUPLE_FOR_FEMALE ? E : w),
        ze.abort(),
        at.stop(),
        X.elsMap.$canvasLayer.empty(),
        X.elsMap.$waitUsersLoader.hide(),
        X.elsMap.$answersSavedCaption.hide(),
        X.elsMap.$questionText.show(),
        X.elsMap.$answerSavingOverlay.hide(),
        X.elsMap.$answersList.hide(),
        (e = K.findUser(K.targetUid)) && e.setAttr({
            isCenter: !0
        }),
        Be(K.mapOfUidsforSelect),
        ze.hideCoupleVotes($.noop)) : K.roundType === M.WHO_LIKES_ON_FEMALES || K.roundType === M.WHO_LIKES_ON_MALES ? (X.el.addClass(D),
        X.elsMap.$votes.hide(),
        Fe(),
        K.firstUidVotes !== K.secondUidVotes && (t = K.firstUidVotes > K.secondUidVotes ? K.firstUidForSelect : K.secondUidForSelect,
        (n = K.findUser(t)) && (n.setAttr({
            isWinner: !0
        }),
        X.forceRedraw(200)),
        i = !1,
        K.roundType === M.WHO_LIKES_ON_MALES && (i = !0),
        n && n.realFirstName && (K.roundQuestion.setAttr({
            text: "Выиграл" + (i ? " " : "a ") + n.realFirstName
        }),
        X.elsMap.$questionText.show(),
        X.elsMap.$questionCreatorEl.show(),
        app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW, {
            crownWinner: n,
            text: K.roundQuestion.text
        }))),
        setTimeout(function() {
            var e;
            K.state !== A.PAUSED || K.pending || Te.isTutorial && Te.gameIsComplete || (Fe(),
            X.elsMap.$questionText.hide(),
            X.elsMap.$questionCreatorEl.hide(),
            t === T && (e = X.getViewerOffset(),
            expController.animateBonus({
                incValue: expController.applyBooster(app.EXP_BONUS.CROWN),
                sourceOffset: {
                    left: e.left + 35,
                    top: e.top - 20
                }
            })))
        }, 3e3)) : (X.el.removeClass(b),
        Ve(),
        K.roundQuestion.answers.removeAll(),
        i = K.findUser(K.couple.maleUid, 2),
        n = K.findUser(K.couple.femaleUid, 1),
        i && n ? (i.setAttr({
            isCoupleMale: !0
        }),
        n.setAttr({
            isCoupleFemale: !0
        }),
        n = K.couple,
        Xe.animateKissFromCache(n.maleUid, n.femaleUid),
        Xe.animateKissFromCache(n.femaleUid, n.maleUid),
        resultController.showCoupleResults(!0, n.maleUid, n.maleAnswer),
        resultController.showCoupleResults(!1, n.femaleUid, n.femaleAnswer),
        K.getPauseStateLeftSeconds()) : Fe())),
        app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW)
    }
    function Fe() {
        X.forEachUsersEls(function(e, t) {
            t.removeClass(d),
            t.removeClass(u)
        }),
        Ve(),
        X.el.removeClass(p),
        X.el.removeClass(f),
        X.el.removeClass(b),
        X.el.removeClass(C),
        X.el.removeClass(_),
        X.el.removeClass(E),
        X.el.removeClass(w),
        X.el.removeClass(m),
        X.el.removeClass(y)
    }
    function Ve() {
        K.processUsers(function(e, t) {
            t.setAttr({
                isWinner: !1,
                isCenter: !1,
                isSelectableByFirstPos: !1,
                isSelectableBySecondPos: !1,
                isCoupleMale: !1,
                isCoupleFemale: !1,
                isSelectedByViewer: !1,
                voteCounter: 0,
                canShowVoteInfo: !1,
                pairsRoundModCounter: 0,
                canShowSelectBtn: !1,
                hasFadeArrows: !1,
                betNumbersString: "",
                votesForCouple: 0
            })
        }),
        X.forceRedraw(0)
    }
    function Be(e, n) {
        e && K.processActualUsers(function(t) {
            var i;
            n ? (i = t.uid,
            r.animateCounter("votesForCouple_" + i, t.votesForCouple || 0, e[t.uid] || 0, function(e) {
                t.uid === i && t.setAttr({
                    votesForCouple: e
                })
            })) : t.setAttr({
                votesForCouple: e[t.uid] || 0
            })
        })
    }
    function $e(e) {
        var i, t;
        switch (X.elsMap.$answerSavingOverlay.hide(),
        (K.viewerAnswer = e) && (K.roundType === M.NORMAL ? (0 <= (t = K.getIndexOfAnswer(K.viewerAnswer)) && ((e = X.elsMap.$answersList.children()).removeClass(d),
        e.removeClass("loading"),
        e.eq(t).addClass(d)),
        K.state === A.STARTED && X.elsMap.$answersSavedCaption.show(),
        X.el.addClass(p)) : K.roundType === M.CHOICE_EACH_OTHER ? nt.selectViewerAnswer() : K.roundType === M.CHOOSE_COUPLE_FOR_MALE || K.roundType === M.CHOOSE_COUPLE_FOR_FEMALE ? K.viewerAnswer && (i = parseInt(K.viewerAnswer, 10),
        K.processUsers(function(e, t) {
            t.setAttr({
                isSelectedByViewer: t.uid === i
            })
        }),
        X.el.addClass(p)) : (K.roundType !== M.RAFFLE ? (K.state === A.STARTED && ((t = X.findElByUid(K.firstUidForSelect)) && t.removeClass(d),
        (t = X.findElByUid(K.secondUidForSelect)) && t.removeClass(d),
        (t = X.findElByUid(K.viewerAnswer)) && t.addClass(d),
        X.elsMap.$answersSavedCaption.show()),
        X.forEachUsersEls(function(e, t) {
            t.removeClass("loading")
        })) : (X.els["couple-actions"].find("span").removeClass("pressed loading"),
        X.els["couple-actions"].find('span[action-id="{0}"]'.format(K.viewerAnswer)).addClass("pressed")),
        X.el.addClass(p))),
        K.roundType) {
        case M.NORMAL:
        case M.WHO_LIKES_ON_FEMALES:
        case M.WHO_LIKES_ON_MALES:
        case M.CHOICE_EACH_OTHER:
            app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW)
        }
    }
    function Ge(e) {
        Qe.onGetQueueData(e),
        L()
    }
    function He() {
        Te && Te.stop && Te.stop(),
        Te = K.__communicator = roomController.communicator = new app.controllers[app.info.isNewUser ? "TutorialCommunicator" : "RoomCommunicator"]({
            roomModel: K,
            roomView: X,
            onGetState: fe,
            onGetChanges: me,
            onGetRoom: function(e, t, i, n) {
                K.__changeId = i;
                i = H.parse(e);
                Y(),
                i.isSummary ? (i.viewerData && Ie([i.viewerData]),
                Ge(i),
                i.queueViewerData && (0 < i.queueViewerData.price && Qe.handleInitialStateWhenRequestSend(),
                i.queueViewerData.confirmedUid && Qe.handleInitialStateWhenRequestCondirmed())) : (K.setAttr({
                    pending: !1
                }),
                fe(e),
                K.setAttr({
                    canSendFreeNote: !!n
                })),
                it.start()
            },
            onCheckQueue: function(e) {
                var t = H.parse(e.roomData);
                e.ctm && K.setCtm(e.ctm),
                t.isSummary ? Ge(t) : (K.setAttr({
                    pending: !1
                }),
                Te.config.onGetRoom(e.roomData, e.gifts, e.changeId),
                X.lockSwitchRoomBtns())
            },
            onSwitchRoom: function(e, t, i) {
                Y(),
                K.setAttr({
                    pending: !1
                }),
                K.__changeId = i,
                fe(e),
                X.lockSwitchRoomBtns()
            },
            onSwitchRoomFail: function(e, t, i) {
                e.code === Codes.TOO_FREQ_ROOM_SWITCH ? dialogController.showDialogRoomSwitchTooFreq(t ? t.left : 0, {
                    price: (t || {}).price,
                    paymentJoin: function() {
                        Te.switchRoom()
                    }
                }) : e.code === Codes.NOT_ENOUGH_EXP_TO_ADD_ROOM ? dialogController.showMessageDialog({
                    message: "У Вас недостаточно рейтинга, чтобы попасть в эту комнату"
                }) : e.code === Codes.USER_IN_BLACK_LIST ? dialogController.showMessageDialog({
                    message: "Невозможно войти в комнату"
                }) : e.code === Codes.LEAVE_FROM_CURRENT_ROOM_IS_NOT_ALLOWED ? roomController.onLeaveRoomIsNotAllowed(i.params) : e.code === Codes.ROOM_ACCESS_DESCR ? dialogController.roomExpLimitDialog(t) : e.code === Codes.EMPTY_ROOM_NOT_FOUND && dialogController.showMessageDialog({
                    message: "Свободная комната не найдена"
                })
            },
            onError: function(e, t, i) {
                function n(e) {
                    x && dialogController.showMessageDialog({
                        message: e,
                        isModal: !0,
                        buttons: [{
                            caption: "Вернуться в игру",
                            handler: function() {
                                return mt(),
                                !1
                            }
                        }]
                    })
                }
                var o;
                i && i.params && i.params.__exitReason === ExitReason.EXIT_AFTER_ROUND_COMPLETE ? (e.code === Codes.NOT_ENOUGH_EXP_TO_ADD_ROOM ? o = "У Вас недостаточно рейтинга, чтобы попасть в эту комнату" : e.code === Codes.ROOM_ACCESS_DESCR ? o = dialogController.roomExpLimitDialog(t, {
                    returnOnlyMessage: !0
                }) : e.code === Codes.USER_IN_BLACK_LIST ? dialogController.showMessageDialog({
                    message: "Невозможно войти в комнату"
                }) : e.code === Codes.EMPTY_ROOM_NOT_FOUND ? o = "Свободная комната не найдена" : e.code === Codes.TOO_FREQ_ROOM_SWITCH && (o = dialogController.showDialogRoomSwitchTooFreq(t ? t.left : 0, {
                    returnOnlyMessage: !0
                })),
                n(o = o || "Не удалось подключиться к комнате. <br>(Code: " + e.code + ")")) : e.code === Codes.NOT_ENOUGH_BALANCE ? (dialogController.showInsufficientlyBalanceDialog(t.deficit),
                app.balanceModel.setAttr({
                    balance: t.balance
                })) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : e.code === Codes.NOT_ENOUGH_EXP_TO_ADD_ROOM ? (o = "У Вас недостаточно рейтинга, чтобы попасть в эту комнату",
                i.params.__exitReason === ExitReason.EXIT_AFTER_ROUND_COMPLETE ? n(o) : dialogController.showMessageDialog({
                    message: o
                })) : e.code === Codes.LEAVE_FROM_CURRENT_ROOM_IS_NOT_ALLOWED ? roomController.onLeaveRoomIsNotAllowed(i.params) : e.code === Codes.USER_IN_BLACK_LIST ? dialogController.showMessageDialog({
                    message: "Невозможно войти в комнату"
                }) : e.code === Codes.ROOM_ACCESS_DESCR ? dialogController.roomExpLimitDialog(t) : e.code === Codes.ADD_GIFT_FAIL ? x && dialogController.fadePopup({
                    message: "Не удалось сделать подарок"
                }) : e.code === Codes.TOO_FREQ_ROOM_SWITCH ? (console.info("common handler call"),
                dialogController.showDialogRoomSwitchTooFreq(t ? t.left : 0)) : e.code === Codes.NOT_ENOUGH_EXP_TO_ADD_ROOM ? dialogController.showMessageDialog({
                    message: "У Вас недостаточно рейтинга, чтобы попасть в эту комнату"
                }) : e.code === Codes.USER_IN_BLACK_LIST ? dialogController.showMessageDialog({
                    message: "Невозможно войти в комнату"
                }) : e.code === Codes.EMPTY_ROOM_NOT_FOUND ? dialogController.showMessageDialog({
                    message: "Свободная комната не найдена"
                }) : e.code === Codes.BANNED ? dialogController.showAccessDeniedDialog(t) : e.code === Codes.ROOM_QUEUE_IS_FULL ? dialogController.showMessageDialog({
                    message: "Не удалось подключиться к комнате. Очередь заполнена",
                    isModal: !0,
                    buttons: [{
                        caption: "Вернуться в игру",
                        handler: function() {
                            return mt(),
                            !1
                        }
                    }]
                }) : e.code === Codes.USER_ALREADY_IN_ROOM ? (Y(),
                dialogController.showMessageDialog({
                    message: "Игра запущена в другой вкладке",
                    noCLose: isMobi,
                    buttons: [{
                        caption: "Закончить игру в других вкладках",
                        lineBreakClass: isMobi ? "smart" : "",
                        handler: function() {
                            return K.getViewer().setAttr({
                                isEmpty: !0
                            }),
                            Te.getRoom({
                                force: !0
                            }),
                            !1
                        }
                    }]
                }).on("close:dialog-window", function() {
                    app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                        uid: T
                    })
                })) : e.code === Codes.USER_NOT_IN_ROOM || e.code === Codes.ROOM_NOT_FOUND ? (e.code,
                Codes.ROOM_NOT_FOUND,
                t.__roomId === K.roomId && We()) : e.code === Codes.NO_ACCESS_TO_ROOM ? dialogController.showNoAccessToRoom({
                    leftMillis: t.leftTime,
                    returnToGameHandler: mt
                }) : x ? je(e) : Y()
            },
            onAddGiftFail: function(e, t, i) {
                e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit, {
                    currency: t.currency
                }) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : e.code === Codes.ADD_GIFT_FAIL && x && dialogController.fadePopup({
                    message: "Не удалось сделать подарок"
                })
            },
            onBalanceUpdate: function(e) {
                app.balanceModel.setAttr({
                    balance: e
                })
            },
            onAddAnswer: function() {
                X.elsMap.$answerSavingOverlay.hide(),
                K.__countOfViewerAnswersInRound++
            },
            onAddBot: function() {
                X.checkBots()
            },
            onAddMessageSuccess: function() {
                X.elsMap.$chatOverlay.hide(),
                X.elsMap.$chatInput.focus(),
                X.startChatTimer(),
                app.eventBus.trigger(app.EVENTS.ADD_CHAT_MESSAGE_SUCCESS)
            },
            onAddSoundSuccess: function(e) {
                fe(e),
                X.elsMap.$chatOverlay.hide(),
                X.startChatTimer()
            },
            onAddSoundFailed: function() {
                X.elsMap.$chatOverlay.hide(),
                x && dialogController.fadePopup({
                    message: "Не удалось добавить аудиозапись"
                })
            },
            onAddMessageFail: function(e, t) {
                X.elsMap.$chatOverlay.hide(),
                e.code === Codes.NO_SUBSCRIBE ? app.eventBus.trigger(app.EVENTS.NO_EMOJI_SUBSCRIBE) : e.code === Codes.COMMUNICATION_BLOCKED ? (dialogController.communicationBlockedDialog(),
                vt(t.leftMillis)) : e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : x && dialogController.fadePopup({
                    message: "Не удалось добавить сообщение"
                })
            }
        })
    }
    function We() {
        var e;
        Y(),
        x ? e = dialogController.showMessageDialog({
            message: "Игра в режиме ожидания",
            isModal: !0,
            buttons: [{
                caption: "Вернуться в игру",
                handler: function() {
                    mt(function() {
                        dialogController.close(e)
                    })
                }
            }]
        }) : app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: T
        })
    }
    function je(e) {
        if (Y(),
        x)
            if (e && errorHandler.isServerUnavailableError(e))
                dialogController.showError(e);
            else {
                try {
                    JSON.stringify(e)
                } catch (e) {}
                dialogController.showMessageDialog({
                    message: "Произошла ошибка. Комната будет перезапущена.",
                    isModal: !0,
                    buttons: [{
                        caption: "OK",
                        handler: function() {
                            return K.getViewer().setAttr({
                                isEmpty: !1
                            }),
                            Te.getRoom({
                                force: !0
                            }),
                            !1
                        }
                    }]
                })
            }
    }
    this.handlePopularityOfUsers = Se,
    this.handleGifts = Me,
    this.animateGift = Oe,
    this.findEmptyUser = xe,
    this.handlePrivateMessages = Re,
    this.canShowMessagePopups = ke,
    K.__messageOfNewFortunateUser = null,
    this.handleChatMessages = Pe,
    this.selectViewerAnswer = $e,
    this.onRoundAnswer = function(e, t, i, n) {
        var o, a;
        K.roundType !== t || (o = K.findUser(e)) && (t !== M.RAFFLE || (t = K.couple) && (t.maleUid === e ? (a = !0,
        t.maleAnswer = i) : t.femaleUid === e && (a = !1,
        t.femaleAnswer = i),
        util.isDef(a) && "-2" !== i && ("5" === i && (o = K.findUser(e)) && o.setAttr({
            state: I.IDLE
        }),
        resultController.showCoupleResults(a, e, i, n))))
    }
    ,
    this.applyVotesMapOfSelectCoupleRound = Be,
    this.showQueue = Ge,
    window.restartRoom = je;
    var Ke, Ye, qe, ze = new app.controllers.RoomResultsController({
        roomModel: K,
        roomView: X
    }), Xe = new app.controllers.RoomGiftsController({
        roomModel: K,
        roomView: X
    }), Qe = new app.controllers.RoomQueueController({
        roomModel: K,
        roomView: X,
        controller: this
    });
    function Je() {
        app.info.isNewUser || (clearTimeout(Ke),
        clearTimeout(Ye),
        K.__isAway = !1,
        Ke = setTimeout(et, 3e5),
        Ye = setTimeout(Ze, 6e4),
        app.eventBus.trigger(app.EVENTS.ON_UI_ACTIVITY))
    }
    function Ze() {
        K.__isAway = !0
    }
    function et() {
        var e, t, i, n, o;
        K.roomId && (e = 60,
        t = dialogController.showMessageDialog({
            isModal: !0,
            message: e + "сек",
            title: "Вы еще здесь?",
            buttons: [{
                caption: "Вернуться в игру",
                handler: function(e) {
                    return clearTimeout(i),
                    !1
                }
            }]
        }),
        n = t.dialog.$(".message"),
        (o = function() {
            if (e < 0)
                return K.roomId && (api.roomV3.exit({
                    roomId: K.roomId
                }, $.noop).send(),
                Y()),
                app.eventBus.trigger(app.EVENTS.ROOM_IS_DEACTIVATED),
                app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                    uid: T
                }),
                void dialogController.close(t);
            n.text(e-- + " сек"),
            i = setTimeout(o, 1e3)
        }
        )())
    }
    function tt() {
        app.eventBus.trigger(app.EVENTS.ROOM_IS_DEACTIVATED),
        K.roomId && (api.roomV3.exit({
            roomId: K.roomId
        }, $.noop).send(),
        Y())
    }
    this.roomQueueController = Qe,
    this.roomResultsController = ze,
    this.roomGiftsController = Xe,
    app.eventBus.on(app.EVENTS.AGE_CHANGED, function(e) {
        e.roomTypeChanges && (K.roomId && K.roomId.startWith("10_") || tt())
    }),
    app.eventBus.on(app.EVENTS.MOVE_TO_CONFERENCE, function(e) {
        gt = null,
        dialogController.fadePopup({
            message: "Приглашение принято, скоро вы перейдете в Переговорную комнату",
            duration: 3e3
        }),
        setTimeout(function() {
            r.goToConference(e.conferenceId)
        }, 3e3)
    }),
    window.openCoupleMatchView = function(e, t) {
        var i, n;
        isMobi || (i = "couple-match-view",
        (n = lilo.createView(i)).setModel({
            firstNameDat: e,
            uid: t
        }),
        V(),
        a = n,
        X.els["couple-match-view"].empty().append(n.el),
        n.on("send-message:" + i, function() {
            new app.controllers.dialog.RoomPrivateMessage({
                isFreePrivateMessage: !0,
                roomModel: K,
                roomId: K.roomId,
                roomView: X,
                targetUid: t
            })
        }),
        setTimeout(V, 7e3))
    }
    ;
    var it = new app.controllers.RoomTopListController({
        roomModel: K,
        roomView: X,
        roomController: this
    })
      , nt = new app.controllers.RoundChoiceEachOther({
        roomModel: K,
        roomView: X,
        width: isMobi ? -1 : 740,
        height: isMobi ? -1 : 600
    })
      , ot = new app.controllers.LotteryController({
        roomModel: K,
        roomView: X
    })
      , at = new app.controllers.RoundLoading({
        roomModel: K,
        roomView: X,
        roomController: this
    })
      , st = new app.controllers.RadioController({
        roomModel: K,
        roomView: X
    })
      , rt = new app.controllers.RoomChangesController({
        roomController: this,
        roomModel: K,
        roomView: X
    });
    function lt() {
        function e(e) {
            var i = []
              , n = [];
            if ($.each(e, function(e, t) {
                t.uid && i.push(t),
                n.push(t)
            }),
            0 !== i.length) {
                n.sort(function(e, t) {
                    return e.orderIndex > t.orderIndex ? 1 : -1
                }),
                i.sort(function(e, t) {
                    return e.uid !== T && (t.uid === T || e.orderIndex > t.orderIndex) ? 1 : -1
                });
                for (var t, o, a, s, r = 0, l = e.length; r < l; r += 1)
                    0 <= r && ((t = i.shift()) && (a = t.orderIndex,
                    (s = n[o = r]) && (n[a] = s,
                    n[o] = t,
                    s.setAttr({
                        orderIndex: a
                    })),
                    t.setAttr({
                        orderIndex: o
                    })))
            }
        }
        e(K.topUsers),
        e(K.bottomUsers)
    }
    this.lotteryController = ot,
    this.radioController = st,
    this.roundLoadingController = at,
    this.roundChoiceEachOther = nt,
    this.roomChangesController = rt,
    this.roomTopListController = it,
    this.resetRoom = Y,
    this.doPause = Le,
    this.doStart = Ue,
    this.doWaiting = Ne;
    var dt = null;
    function ct() {
        X.elsMap.$answersList.css("opacity", "1"),
        X.elsMap.$questionText.css("opacity", "1"),
        X.elsMap.$answersList.css("overflow", ""),
        dt && (dt.abort(),
        dt = null)
    }
    var ut, pt = function(e) {
        var t = "";
        return 90 < e ? t = "0.55em" : 80 < e ? t = "0.61em" : 70 < e ? t = "0.66em" : 60 < e ? t = "0.72em" : 55 < e ? t = "0.77em" : 50 < e ? t = "0.83em" : 48 < e ? t = "0.88em" : 44 < e && (t = "0.93em"),
        t
    };
    function ft() {
        var e, t, i, n, o = !0, a = X.elsMap.$answersList.children().map(function() {
            return $(this)
        }), s = 0, r = X.elsMap.$questionText.text(), l = isMobi && K.roundType === M.NORMAL, d = function() {
            o && a[s] ? (isMobi ? a[s].addClass(l ? "animated" : "").css("opacity", 1) : a[s].addClass("animated").css("transform", "translateY(0px)"),
            setTimeout(d, 250),
            s++) : X.elsMap.$answersList.css("overflow", "")
        }, c = a.length ? 5 : 2;
        K.getStartStateLeftSeconds() >= c && (X.elsMap.$questionText.html(""),
        isMobi && K.roundType !== M.NORMAL || X.elsMap.$answersList.css("overflow", "hidden"),
        isMobi ? K.roundType === M.NORMAL ? a.each(function(e, t) {
            t.removeClass("animated").css("opacity", 0)
        }) : a.length = 0 : K.roundType === M.NORMAL ? a.each(function(e, t) {
            t.removeClass("animated").css("transform", "translateY(200px)")
        }) : a.length = 0,
        t = $(document.createElement("div")),
        e = $(document.createElement("span")).addClass("question-text-content"),
        isMobi && e.css("font-size", pt(r.length)),
        t.append(e),
        e.html(util.escapeHtml(r)),
        X.elsMap.$questionText.append(t),
        i = e[0].style,
        n = e.width(),
        c = t.width(),
        r = t.height(),
        (c = (c - n) / 2) < 0 && (c = 0),
        i.position = "absolute",
        i.left = c + "px",
        i.width = "0px",
        i.overflow = "hidden",
        i.display = "inline-block",
        i.top = "0",
        i.left = c + "px",
        (i = t[0].style).position = "relative",
        i.height = r + "px",
        e.addClass("animated"),
        setTimeout(function() {
            o && (e.width(n),
            setTimeout(function() {
                d(),
                e.css({
                    position: "",
                    width: ""
                })
            }, 500))
        }, 10)),
        X.elsMap.$answersList.css("opacity", "1"),
        X.elsMap.$questionText.css("opacity", "1"),
        dt = {
            abort: function() {
                o = !1,
                X.elsMap.$answersList.css("overflow", ""),
                t && t.width(n);
                for (var e = 0; a[e] && a[e].css; )
                    a[e].css("transform", "translateY(0px)"),
                    e++
            }
        }
    }
    function mt(i, e) {
        e = e || {};
        var n = api.roomV3.getRoom({
            beforeSend: e.noLoader ? $.noop : ajaxLoader.show,
            force: !0
        }, function(e, t) {
            ajaxLoader.hide(),
            $appLoader.remove(),
            e ? Te.config.onError(e, t, n) : (Te.config.onGetRoom(t.roomData, t.gifts, t.changeId, !!t.canSendFreeNote),
            app.onGetServerVersion(t.v)),
            i && i()
        });
        n.send(util.random(100, 200))
    }
    function vt(e) {
        clearTimeout(ut),
        ut = setTimeout(function() {
            api.user.checkWarns({}, function(e, t) {
                e || (0 < (t = t.leftTimeWhenCanCommunicate) ? vt(t) : ht())
            }).send()
        }, e),
        X.lockChat(e)
    }
    function ht() {
        clearTimeout(ut),
        X.unlockChat()
    }
    window.animateEmergingOfQuestion = ft,
    this.returnToGameHandler = mt,
    window.lockChat = vt,
    window.unlockChat = ht,
    this.fetchPrivateRoom = function(e) {
        Y(),
        K.getViewer().setAttr({
            isEmpty: !0
        }),
        Te.getRoom({
            beforeSend: ajaxLoader.show,
            force: !0,
            target_private_room_id: e,
            onComplete: function(e, t) {
                var i;
                ajaxLoader.hide(),
                e ? (i = [{
                    caption: "Вернуться в игру",
                    isModal: !0,
                    handler: function() {
                        return mt(),
                        !1
                    }
                }],
                e.code === Codes.ROOM_NOT_FOUND && dialogController.showMessageDialog({
                    isModal: !0,
                    message: "Комната не найдена. Возможно владелец еще не создал ее",
                    buttons: i
                }),
                e.code === Codes.ROOM_IS_DEACTIVATED ? dialogController.showMessageDialog({
                    isModal: !0,
                    message: "Комната не активна",
                    buttons: i
                }) : e.code === Codes.ROOM_QUEUE_IS_FULL ? dialogController.showMessageDialog({
                    isModal: !0,
                    message: "Комната и очередь в нее заполнены",
                    buttons: i
                }) : e.code === Codes.TOO_FREQ_ROOM_SWITCH ? dialogController.showMessageDialog({
                    isModal: !0,
                    message: dialogController.showDialogRoomSwitchTooFreq(t ? t.left : 0, {
                        returnOnlyMessage: !0
                    }) || "В данный момент вы не можете поменять комнату",
                    buttons: i
                }) : Te.config.onError(e, t)) : (t.ctm && K.setCtm(t.ctm),
                (e = H.parse(t.roomData)).isSummary ? Ge(e) : (K.setAttr({
                    pending: !1
                }),
                Te.config.onGetRoom(t.roomData, t.gifts, t.changeId, !!t.canSendFreeNote),
                app.onGetServerVersion(t.v)))
            }
        })
    }
    ,
    this.goToConference = function(e) {
        Te.getRoom({
            beforeSend: ajaxLoader.show,
            force: !0,
            conference_id: e,
            onComplete: function(e, t, i, n) {
                var o;
                ajaxLoader.hide(),
                e ? (o = [{
                    caption: "Вернуться в игру",
                    isModal: !0,
                    handler: function() {
                        return mt(),
                        !1
                    }
                }],
                e.code === Codes.ROOM_NOT_FOUND ? dialogController.showMessageDialog({
                    isModal: !0,
                    message: "Комната#{0} не найдена".format(),
                    buttons: o
                }) : Te.config.onError(e, t, n)) : (t.ctm && K.setCtm(t.ctm),
                n = H.parse(t.roomData),
                console.info("on get conference", n),
                K.setAttr({
                    pending: !1
                }),
                Te.config.onGetRoom(t.roomData, t.gifts, t.changeId, !!t.canSendFreeNote),
                app.onGetServerVersion(t.v))
            }
        })
    }
    ,
    this.getUidsInRoom = function(e, i, t) {
        api.roomV3.getUidsInRoom(e, function(e, t) {
            i(e ? [] : t.uids)
        }).send()
    }
    ,
    this.checkRoomForFriends = function(e, n, t) {
        r.getUidsInRoom(e, function(e) {
            for (var t = !1, i = 0; i < e.length; i += 1)
                if (socialApi.isFriend(e[i])) {
                    t = !0;
                    break
                }
            n(t)
        }, t)
    }
    ,
    this.updateWidth = function() {
        x ? socialApi.setAppWidth(1e3 + (st.canExtendWindowForOKPlatform() ? 262 : 0)) : socialApi.setAppWidth(800)
    }
    ,
    this.start = function(e) {
        var t, i, n, o, a;
        e = e || {},
        X.isVisible = !0,
        socialApi.setAppWidth(1e3),
        K.getViewer().setAttr({
            firstName: app.info.first_name + util.formatProfileBdate(app.info.bdate, app.info.age)
        }),
        Te || He(),
        clearTimeout(qe),
        x = !0,
        this.updateWidth(),
        app.soundManager.onRoomShow(),
        e.onGetRoomData ? (t = H.getRoomId(e.onGetRoomData.roomData),
        K.roomId !== t && (Y(),
        i = H.parse(e.onGetRoomData.roomData),
        X.lockSwitchRoomBtns(),
        at.stop(),
        i.isSummary ? Ge(i) : Te.config.onGetRoom(e.onGetRoomData.roomData, e.onGetRoomData.gifts, e.onGetRoomData.changeId))) : e.private_room_id ? this.fetchPrivateRoom(e.private_room_id) : K.roomId || (n = i = null,
        util.isOKPlatform() ? (o = util.queryParamsToObject().custom_args) && (n = util.getShortParameterValue(o, "room_id", !0) || 0,
        i = (i = util.getShortParameterValue(o, "r", !0) || 0) && "10_" + i,
        n = n && "" + n) : (o = util.queryParamsToObject(app.info.hash)).room_id ? (a = parseInt(o.room_id, 10),
        isNaN(a) || 0 < a && (n = "" + a),
        socialApi.setLocation(""),
        app.info.hash = "") : app.info.hash.startWith("r") && !app.info.hash.startWith("room_id") && (a = parseInt(app.info.hash.substr(1), 10),
        isNaN(a) || (i = "10_" + a),
        socialApi.setLocation(""),
        app.info.hash = ""),
        i ? this.fetchPrivateRoom(i) : n ? (K.roundQuestion.id = null,
        K.getViewer().setAttr({
            isEmpty: !0
        }),
        r.checkRoomForFriends({
            roomId: n
        }, function(e) {
            api.roomV3.getRoom({
                beforeSend: ajaxLoader.show,
                force: !0,
                area_id: n,
                skip_restrictions: e
            }, function(e, t) {
                ajaxLoader.hide(),
                $appLoader.remove(),
                e ? (dialogController.fadePopup({
                    message: "Невозможно войти в комнату по ссылке",
                    duration: 5e3
                }),
                setTimeout(function() {
                    mt(null, {
                        noLoader: !0
                    })
                }, 200)) : (Te.config.onGetRoom(t.roomData, t.gifts, t.changeId, !!t.canSendFreeNote),
                app.onGetServerVersion(t.v))
            }).send()
        })) : (K.roundQuestion.id = null,
        e.force = !0,
        K.getViewer().setAttr({
            isEmpty: !0
        }),
        Te.getRoom(e))),
        $contextArea.append(X.el),
        IS_DESKTOP ? $(document).off("mousemove", Je).on("mousemove", Je) : $(document).off("touchstart", Je).on("touchstart", Je),
        Je(),
        setTimeout(function() {
            x && (isMobi || socialApi.scrollWindow(70),
            X.initJScrollPane(),
            setTimeout(function() {
                var e, t, i;
                x && (e = "dialogSecretKey",
                t = "dialogSecretKeyCountOfShows" + (util.isOKPlatform() ? "_1" : ""),
                i = parseInt(util.lStorage.find(t), 10),
                3 <= (i = isNaN(i) ? 0 : i) && "secretName" !== app.info.hash ? (3 === i && api.user.secretName.incWallPosts({}, $.noop).send(),
                util.lStorage.save(t, i + 1)) : !app.info.canFN || util.cache.find(e) || !isFontAvailable("Boomboom") || !isFontAvailable("Open Sans") || 0 !== app.info.wpsn && "secretName" !== app.info.hash || "funnyname" !== app.info.hash && socialApi.isUsersMemberOfDevClubs() || (util.cache.save(e, 1, 31536e6),
                dialogController.showNameSecretDialog() && util.lStorage.save(t, i + 1)))
            }, 1e3))
        }, 50),
        util.sStorage.save("userInRoom", "1"),
        app.eventBus.trigger(app.EVENTS.ROOM_IS_DEACTIVATED);
        e = app.info.getLeftTimeOfBanCommunication();
        0 < e ? vt(e) : ht(),
        L(),
        app.youtubePlayer.model.setAttr({
            visible: !0
        }),
        setTimeout(function() {
            app.youtubePlayer.updatePosition()
        }, 200),
        Q && Q.onRoomStart(),
        isMobi && X.updateChatTopOffset({
            needScroll: 1
        })
    }
    ,
    this.onQueueComplete = function() {
        Te.getRoom({
            force: !0
        })
    }
    ,
    this.onRemoveUserInQueue = function(e) {}
    ;
    var gt = null;
    var bt = function() {
        try {
            var e, t = util.lStorage.find(l);
            t && (e = JSON.parse(t),
            0 < util.getKeys(e).length && (gt = e))
        } catch (e) {}
        return e
    }();
    function Ct() {
        if (gt)
            try {
                var e = JSON.stringify(gt);
                util.lStorage.save(l, e)
            } catch (e) {}
        else
            util.lStorage.remove(l)
    }
    this.onLeaveRoomIsNotAllowed = function(e) {
        var i = null;
        try {
            (e.data.viewer_id || e.data.logged_user_id) && (i = e.data,
            ["auth_key", "ts", "viewer_id", "logged_user_id", "beforeSend"].each(function(e, t) {
                delete i[t]
            }))
        } catch (e) {}
        gt = i,
        Ct(),
        dialogController.fadePopup({
            message: "Переход в другую комнату произойдет после окончания раунда",
            duration: 5e3
        })
    }
    ,
    this.checkLastChangesFromBuffer = function() {
        var e = Et.getLastChanges(K.roomId);
        rt.handleChanges(e)
    }
    ,
    this.stop = function() {
        socialApi.setAppWidth(800),
        x = !1,
        n(),
        V(),
        F(),
        app.soundManager.onRoomHide(),
        X.el.detach(),
        X.isVisible = !1,
        this.updateWidth(),
        clearTimeout(qe),
        qe = setTimeout(function() {
            K.roomId && tt()
        }, 18e4),
        K.roomId && app.eventBus.trigger(app.EVENTS.ROOM_STAY_ACTIVE),
        $(document).off("mousemove", Je),
        clearTimeout(Ke),
        dialogController.close(),
        it.stop(),
        socialApi.setLocation(""),
        app.youtubePlayer.model.setAttr({
            visible: !1
        }),
        Q && Q.onRoomStop()
    }
    ;
    var _t, wt, Et = (_t = [],
    {
        push: function(e) {
            e.__created = util.currentMillis(),
            e.__fromBuffer = !0,
            _t.push(e)
        },
        getLastChanges: function(i) {
            var n = []
              , o = util.currentMillis();
            return $.each(_t, function(e, t) {
                t.roomId === i && o - t.__created < 8e3 && n.push(t.change)
            }),
            _t.length = 0,
            n
        }
    });
    webSocketController.on(webSocketController.EVENTS.ROOM_CHANGE, function(e) {
        try {
            var t = e.roomId
              , i = e.ctm
              , n = e.change;
            K.setCtm(i),
            t === K.roomId ? rt.handleChanges([n]) : Et.push(e)
        } catch (e) {
            console.error(e)
        }
    }),
    webSocketController.on(webSocketController.EVENTS.APP_OPEN_IN_OTHER_TAB, function() {
        Y()
    }),
    webSocketController.on(webSocketController.EVENTS.NEW_GUEST, function(e) {
        e.hasExpBonus && (e = app.EXP_BONUS.GUEST,
        expController.animateBonus({
            incValue: e,
            sourceOffset: {
                left: 160,
                top: -40
            }
        }))
    }),
    webSocketController.on(webSocketController.EVENTS.CONNECTION_LOST, function() {
        K.roomId && (wt = K.roomId),
        Y()
    }),
    webSocketController.on(webSocketController.EVENTS.CONNECTION_RESTORE, function() {
        x && Te.getRoom({
            force: !0
        })
    }),
    window.roomController = this,
    window.getParamsOfDelayedRequest = function() {
        return gt
    }
}
,
app.controllers.RoundLoading = function(e) {
    function i() {
        n && (n.remove(),
        n = null)
    }
    var n, o = e.roomModel, a = e.roomView, s = (e.roomController,
    !1), r = app.info.viewer_id, l = 2 === app.info.sex, t = a.els["loading-text"].parent();
    this.start = function() {
        s || (s = !0,
        a.els["loading-text"].html("Загрузка раунда..."),
        t[o.canShowPhotos ? "removeClass" : "addClass"]("large"),
        a.showWaitNextRoundLoader())
    }
    ,
    this.stop = function() {
        s && (s = !1,
        a.hideWaitNextRoundLoader(),
        i())
    }
    ,
    this.showEvaluationPhotos = function() {
        var e, t, d, c;
        s && (i(),
        (e = o[l ? "femaleUserWithPhoto" : "maleUserWithPhoto"]) && (0 < (t = e.likesMap[r]) || e && (e = e.photo,
        t = {
            photoUrl: util.fixVkUrl(e.photoUrl),
            pid: e.pid,
            ownerId: e.ownerId,
            likeType: t
        },
        d = lilo.createView("evaluation-photo"),
        c = !1,
        d.bind("img-click", function() {
            var e = d.model;
            app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: e.ownerId,
                startAction: "go-to-photos",
                targetPid: e.pid
            })
        }),
        d.bind("like", function(i) {
            if (!c) {
                var n = i.extraData.type
                  , o = i.extraData.$loadingEl
                  , a = d.model
                  , s = a.pid
                  , r = a.ownerId
                  , l = 1 !== n;
                if (l) {
                    var e = app.balanceModel.balance - 1;
                    if (e < 0)
                        return void dialogController.showInsufficientlyBalanceDialog(e)
                }
                o.addClass("loading"),
                c = !0,
                ServerApi("photo/like.php", {
                    is_room: !0,
                    ts: util.currentMillis(),
                    pid: s,
                    owner_id: r,
                    type: n,
                    encypt_arr: ["pid", "owner_id", "ts"]
                }, function(e, t) {
                    o.removeClass("loading"),
                    c = !1,
                    t && util.isDef(t.balance) && app.balanceModel.setAttr({
                        balance: t.balance
                    }),
                    e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : e.code === Codes.ALREADY_EXIST ? (dialogController.fadePopup("Вы уже ставили лайк"),
                    a.setAttr({
                        likeType: n
                    })) : e.code === Codes.NOT_FOUND ? dialogController.fadePopup("Фото было удалено пользователем") : dialogController.fadePopup("Произошла ошибка. Code:" + e.code) : (a.setAttr({
                        likeType: n
                    }),
                    l && dialogController.fadePopup("Вам зачислено +{0} очков рейтинга".format(expController.applyBooster(20))),
                    app.eventBus.trigger(app.EVENTS.LIKE_PHOTO, {
                        url: a.photoUrl,
                        likeType: n,
                        pid: s,
                        ownerId: r,
                        browserEvent: i.extraData.browserEvent
                    }),
                    (e = {})[l ? "pl2" : "pl1"] = 1,
                    cAnal.trackEvent(e))
                })
            }
        }),
        (n = d).setModel(t),
        a.els["main-area"].append(n.el),
        a.els["loading-text"].html("Пока идет загрузка раунда, можно оценить случайное фото..."))))
    }
}
,
function() {
    app.controllers.AppSoundManager = function() {
        function e() {
            app.eventBus.trigger(app.EVENTS.TOGGLE_SOUND, {
                enabled: i.isEnabled()
            })
        }
        var t = "soundIsDisabled"
          , a = !!util.lStorage.find(t)
          , s = !1
          , r = {}
          , l = {}
          , i = this;
        function d(e) {
            var t = document.createElement("audio");
            return t.setAttribute("preload", "auto"),
            t.setAttribute("src", e.startWith("http") ? e : CDN_PREFIX + e),
            isMobi || document.body.appendChild(t),
            t
        }
        isMobi && (a = !0),
        $.extend(this, {
            play: function(e, t) {
                if ((t = t || l).force || !a && (e === app.soundManager.SOUND_IDS.WF_ARROW_HIT || !s)) {
                    var i = t.minDelay || 500
                      , n = r[e]
                      , t = (new Date).getTime();
                    if (!(n && t - n < i)) {
                        r[e] = t;
                        var o = d(e);
                        o.volume = .4;
                        t = app.soundManager.SOUND_IDS;
                        e === t.RESULT_NUMBER_CELL ? o.volume = .3 : e !== t.RATING_PROGRESS && e !== t.GIFT && e !== t.WF_ARROW_HIT || (o.volume = .2);
                        try {
                            o.load(),
                            o.play()
                        } catch (e) {
                            BOOT_DATA.testServer && isMobi && alert(e.message)
                        }
                        setTimeout(function() {
                            o.parentNode && o.parentNode.removeChild(o)
                        }, 6e3)
                    }
                }
            },
            disable: function() {
                isMobi || (a = !0,
                util.lStorage.save(t, "1"),
                e())
            },
            enable: function() {
                isMobi || (a = !1,
                util.lStorage.remove(t),
                e())
            },
            onRoomShow: function() {
                s = !1
            },
            onRoomHide: function() {
                s = !0
            },
            toggle: function() {
                a ? app.soundManager.enable() : app.soundManager.disable()
            },
            isEnabled: function() {
                return !a
            }
        }),
        this.SOUND_IDS = {
            WF_ARROW_HIT: "partnersinrhyme_CLICK21C.wav",
            WF_WIN: "sounds/gui_everyday_bonus.wav",
            BONUS_FOR_VIEW_AD: "0013_collectable_10.wav",
            LOTO_CLICK: "loto_click.wav",
            COINS_DROP: "coins_drop.wav",
            WIN_CROWN: "win_crown.wav",
            RESULT_NUMBER_CELL: "result_number_cell2.wav",
            WIN_NUMBER: "win_number.wav",
            ROUND_START: "beep-01a.wav",
            RATING_PROGRESS: "0024_progress_made_04.wav",
            MISSION_COMPLETE: "0013_mission_complete_06.wav",
            WHOOSH: "whoosh.wav",
            TOMATO_SQUISH: "tomato_squish.wav",
            GAME_START: "game_start.wav",
            USERS_READY: "beep-02.wav",
            VIEWER_IS_SELECTED: "select_user_in_game.wav",
            MATCH: "match.wav",
            KISS: "kiss.wav",
            GIFT: "gift.wav"
        },
        IS_DESKTOP && (i = this,
        setTimeout(function() {
            $.each(i.SOUND_IDS, function(e, t) {
                d(t)
            })
        }, 0))
    }
}(),
app.controllers.RoomResultsController = function(e) {
    var a = this
      , u = app.ROOM_STATE
      , p = app.ROUND_TYPE
      , s = "blink"
      , f = app.info.viewer_id
      , m = app.info.viewer_id + ""
      , V = e.roomModel
      , v = e.roomView
      , E = 2 === app.info.sex
      , r = function(e) {
        return ~~e
    };
    function B(e, t, i, n, o) {
        var a = Math.atan2(o - i, n - t);
        t = r(t),
        n = r(n),
        i = r(i),
        o = r(o),
        e.moveTo(t, i),
        e.lineTo(n, o),
        e.stroke(),
        e.moveTo(n - r(10 * Math.cos(a - Math.PI / 6)), o - r(10 * Math.sin(a - Math.PI / 6))),
        e.lineTo(n, o),
        e.lineTo(n - r(10 * Math.cos(a + Math.PI / 6)), o - r(10 * Math.sin(a + Math.PI / 6))),
        e.closePath(),
        e.fill()
    }
    function G(e, t, i, n, o) {
        t = r(t),
        n = r(n),
        i = r(i),
        o = r(o),
        e.moveTo(t, i),
        e.lineTo(n, o)
    }
    function H(e, t, i, n) {
        this._ctx = e,
        this._start = t,
        this._stop = i,
        this._total = this._stop - this._start,
        this._render = n
    }
    function h(e, t, i, n, o, a, s, r, l) {
        this.isChoiseEachOther = s,
        this.viewerAnswer = r,
        this.opts = l || this.__defaultOpts,
        this.setData(e.uid, t, i, n),
        this.user = e,
        this.delay = 0,
        this.force = !1,
        this.isRemoved = !1,
        this.isMatchWithViewer = a,
        this.isMale = o
    }
    function g(e, t, i) {
        this.color = t,
        this._$el = e,
        this.answerId = i,
        this.borderStyle = isMobi ? "3px solid #2aaaff" : "1px solid #2aaaff",
        this.boxShadowStyle = isMobi ? "" : "0 1px 10px #2aaaff"
    }
    function y(e, t) {
        var i = this;
        i.color = t,
        i.user = e,
        i.uid = e.uid,
        i.borderStyle = isMobi ? "3px solid #2aaaff" : "1px solid #2aaaff",
        i.boxShadowStyle = isMobi ? "" : "0 1px 10px #2aaaff",
        i.isValid = !0,
        i.$els = [];
        t = v.findElByUid(e.uid);
        function n() {
            i.isValid = !1,
            i.release(),
            e.offChange("uid", n)
        }
        t && (i.$els.push(t.children()),
        e.onChange("uid", n)),
        i.abort = n
    }
    function l(e, t, i, n) {
        this._opts = n || {},
        this._couple = e;
        n = 0,
        e = 0;
        8 < (this.roundLeftSeconds = i) ? e = n = 2e3 : n = e = 0,
        this._timeToAnswersAnimation = n,
        this._timeToCouplesAnimation = e,
        this.isStarted = !1,
        this._answersElsWraps = [],
        this._couplseElsWraps = [],
        this._prevAnswersPerRound = t
    }
    function b(e, t, i, n, o) {
        this._inverse = i,
        this._isStarted = !1,
        this._isAborted = !1,
        this._canvas = document.createElement("canvas"),
        this._ctx = this._canvas.getContext("2d"),
        this._$container = n,
        this._color = e,
        this._text = t,
        this._noResults = !!o,
        this.mobi = !1
    }
    function t() {
        this.$elsWithHidenButtons = [],
        this.$elsWithHidenVoteLabel = [],
        this.$elsWithransparentVoteLabel = [];
        var i, n = this;
        V.mapOfUidsforSelect && (i = 0,
        $.each(V.mapOfUidsforSelect, function(e, t) {
            i = Math.max(i, t)
        }),
        V.processActualUsers(function(e) {
            var t;
            (V.roundType === p.CHOOSE_COUPLE_FOR_FEMALE && e.male || V.roundType === p.CHOOSE_COUPLE_FOR_MALE && !e.male) && (t = V.mapOfUidsforSelect[e.uid] || 0,
            (e = v.findElByUid(e.uid)) && (n.$elsWithHidenButtons.push(e),
            (t < i ? n.$elsWithHidenVoteLabel : n.$elsWithransparentVoteLabel).push(e)))
        }))
    }
    H.prototype.render = function(e) {
        e > this._start && e <= this._stop && (e = (e - this._start) / this._total,
        this._ctx.clearRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height),
        this._ctx.beginPath(),
        this._render(this._ctx, e))
    }
    ,
    h.prototype = {
        __defaultOpts: {},
        MALE_COLOR: "#8484D0",
        FEMALE_COLOR: "#FF55D4",
        MALE_COLOR_RGBA: util.hexToRgba("#8484D0"),
        FEMALE_COLOR_RGBA: util.hexToRgba("#FF55D4"),
        CANVAS_PADDING: 10,
        DURATION: 1e3,
        stopAndRemove: function() {
            var e = this._canvas;
            e && e.parentNode && e.parentNode.removeChild(e),
            this.isRemoved = !0
        },
        animateMatch: function() {
            var e, t, i, n, o;
            this.isMatchWithViewer && ((e = v.findElByUid(this._uid)) && (e.addClass(s),
            v.getViewerEl().addClass(s),
            app.soundManager.play(app.soundManager.SOUND_IDS.MATCH),
            setTimeout(function() {
                e.removeClass(s),
                v.getViewerEl().removeClass(s)
            }, 1500)),
            (o = V.findUser(this._uid)) && o.setAttr({
                matches: o.matches + 1
            }),
            !this.isChoiseEachOther || (t = v.getViewerOffset()) && (i = -1 !== (this.viewerAnswer && this.viewerAnswer.split ? this.viewerAnswer.split(",") : []).indexOf(this._uid + ""),
            n = V.findUser(this._uid),
            o = 20,
            i && (o += 30),
            o = expController.applyBooster(o),
            expController.animateBonus({
                incValue: o,
                sourceOffset: {
                    left: t.left + 35,
                    top: t.top - 20
                }
            }),
            i && n && openCoupleMatchView(n.firstNameDat, n.uid)))
        },
        getTotalDuration: function() {
            return this.DURATION
        },
        setData: function(e, t, i, n) {
            this._uid = e,
            this._indexOfUser = t,
            this._indexOfAnswer = i,
            this._isTop = n,
            this.definePositions()
        },
        definePositions: isMobi ? function() {
            function e(e, t) {
                return t < 1 ? 0 : -(t - 1) / 2 * 4 + 4 * e
            }
            var t, i, n, o, a = mobiUiHelper.getRatioOfRoomHeight(), s = 20 * a, r = 446 * a, l = mobiUiHelper.calcWidthOfRoomUser(), d = l + mobiUiHelper.vw2px(4), c = 3 + mobiUiHelper.vw2px(3.6), u = mobiUiHelper.fixPx(150) + 6, p = appWidth / (3 * u) / 4, f = p, m = 214 * a + 3, v = p, p = 0;
            this.isChoiseEachOther ? (t = mobiUiHelper.getXPosOfRoomUser(this._indexOfUser) + l / 2,
            i = mobiUiHelper.getXPosOfRoomUser(this._indexOfAnswer) + l / 2 + mobiUiHelper._userBorderWidth,
            n = r - 6,
            o = s + l + c,
            p = mobiUiHelper._userBorderWidth,
            1 < this.opts.totalAnswers && (t += e(this.opts.answerIndex || 0, this.opts.totalAnswers)),
            1 < this.opts.totalLinesOfTargetUser && (i += e(this.opts.indexOfLineOfTargetUser || 0, this.opts.totalLinesOfTargetUser))) : (this._indexOfUser,
            t = mobiUiHelper.getXPosOfRoomUser(this._indexOfUser) + l / 2,
            i = f + this._indexOfAnswer * (v + u) + u / 2,
            o = this._isTop ? (n = d + s + 8 * a,
            m - 6 * a) : (n = r - 6 * a,
            m + u + 6 * a)),
            this._x1 = t + p,
            this._x2 = i + p,
            this._y1 = n,
            this._y2 = o
        }
        : function() {
            var e, t, i, n, o = 0;
            this.isChoiseEachOther ? (e = 10 + 122 * this._indexOfUser + 51,
            i = 10 + 122 * this._indexOfAnswer + 51,
            o = this._isTop ? (t = 154,
            n = 450,
            -6) : (t = 450,
            n = 154,
            6)) : (e = 10 + 122 * this._indexOfUser + 51,
            i = 87 + 194 * this._indexOfAnswer + 81,
            n = this._isTop ? (t = 154,
            244) : (t = 450,
            418)),
            this.opts.answerIndex && (o += 4 * this.opts.answerIndex),
            this._x1 = e + o,
            this._x2 = i + o,
            this._y1 = t,
            this._y2 = n
        }
        ,
        getColor: function() {
            return this.isMale ? this.MALE_COLOR : this.FEMALE_COLOR
        },
        defineCanvasAndGetCtx: function() {
            var e = document.createElement("canvas")
              , t = e.getContext("2d")
              , i = this.CANVAS_PADDING;
            e.width = Math.abs(this._x1 - this._x2) + 2 * i,
            e.height = Math.abs(this._y1 - this._y2) + 2 * i;
            var n = e.style;
            return n.position = "absolute",
            n.left = Math.min(this._x1, this._x2) - i + "px",
            n.top = Math.min(this._y1, this._y2) - i + "px",
            v.els.canvasLayer.append(e),
            this._canvas && this._canvas.parentNode && this._canvas.parentNode.removeChild(this._canvas),
            this._canvas = e,
            t
        },
        _getVerticalHeight: isMobi ? function() {
            var e = this._indexOfUser % 2 == 0;
            return this._isTop && e || !this._isTop && !e ? 140 * mobiUiHelper.getRatioOfRoomHeight() : 16 * mobiUiHelper.getRatioOfRoomHeight()
        }
        : function() {
            return 16
        }
        ,
        startAnimation: function(e) {
            function t() {
                app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW, {
                    arrowAnimationComplete: F
                }),
                e()
            }
            var r, i, n, o, a, s, l, d, c, u, p, f, m, v, h, g, b, C, _, w, E, y, D, T, S, A, I, M, O, x, R, k, P, N, U, L, F = this;
            this.isRemoved ? t() : (L = this.defineCanvasAndGetCtx(),
            r = this._canvas,
            i = this.getColor(),
            m = this.CANVAS_PADDING,
            n = this._x1,
            o = this._y1,
            a = this._x2,
            R = this._y2,
            s = this._getVerticalHeight(),
            N = this.hasFadeGradientArrow,
            l = Math.sqrt,
            d = n < a ? m : Math.abs(n - a) + m,
            c = o < R ? m : Math.abs(o - R) + m,
            u = N ? d : n < a ? Math.abs(n - a) + m : m,
            x = o < R ? Math.abs(o - R) + m : m,
            U = Math.abs(c - x),
            p = Math.abs(d - u),
            v = s / U,
            h = l((f = p) * f + (m = U - s) * m),
            g = m / h,
            b = f / h,
            l(U * U + p * p),
            C = n < a ? 1 : -1,
            w = c + s * (_ = o < R ? 1 : -1),
            R = function(e, t, i, n) {
                i = e - i,
                n = t - n;
                return l(i * i + n * n)
            }
            ,
            E = [],
            this._x3 && !N ? (D = c + this._y3,
            T = u,
            S = x + this._y4,
            A = R(y = d, c, y, D),
            I = R(T, S, u, x),
            M = Math.abs(S - D),
            O = Math.abs(T - y),
            R = l(M * M + O * O),
            R = R / (x = A + R + I),
            E.push(new H(L,0,x = A / x,function(e, t) {
                B(e, d, c, y, c + A * t * _)
            }
            )),
            E.push(new H(L,x,R,function(e, t) {
                G(e, d, c, y, D),
                B(e, y, D, y + O * t * C, D + M * t * _)
            }
            )),
            E.push(new H(L,x + R,1,function(e, t) {
                G(e, d, c, y, D),
                G(e, y, D, T, S),
                B(e, T, S, u, S + I * t * _)
            }
            ))) : (E.push(new H(L,0,v,function(e, t) {
                B(e, d, c, d, c + s * t * _)
            }
            )),
            E.push(new H(L,v,1,function(e, t) {
                G(e, d, c, d, w);
                t *= h;
                B(e, d, w, d + t * b * C, w + t * g * _)
            }
            ))),
            P = function(e) {
                for (k = 0; k < E.length; k += 1)
                    E[k].render(e)
            }
            ,
            N ? (N = i === this.MALE_COLOR ? this.MALE_COLOR_RGBA : this.FEMALE_COLOR_RGBA,
            (U = this._isTop ? L.createLinearGradient(0, 0, 0, U) : L.createLinearGradient(0, U, 0, 0)).addColorStop(0, "rgba(" + N.r + "," + N.g + "," + N.b + ",1)"),
            U.addColorStop(.1, "rgba(" + N.r + "," + N.g + "," + N.b + ",1)"),
            U.addColorStop(.2, "rgba(" + N.r + "," + N.g + "," + N.b + ",0)"),
            U.addColorStop(1, "rgba(" + N.r + "," + N.g + "," + N.b + ",0)"),
            L.strokeStyle = U,
            L.fillStyle = U) : (L.strokeStyle = i,
            L.fillStyle = i),
            L.lineWidth = 2,
            L.lineJoin = "round",
            L = function() {
                var i, n, o, a, s, e = V.getPauseStateLeftSeconds();
                F.force || 1e3 * e <= F.getTotalDuration() ? (P(1),
                t(),
                F.animateMatch()) : (i = {
                    canvas: r,
                    duration: F.getTotalDuration(),
                    delta: function(e) {
                        return 1 === (e = F.force || F.isRemoved ? 1 : e) && (t(),
                        F.animateMatch()),
                        e
                    },
                    step: P
                },
                n = (new Date).getTime(),
                e = app.info.animationFps,
                o = 0,
                a = Math.round(1e3 / e),
                s = function() {
                    var e = (new Date).getTime()
                      , t = (e - n) / i.duration;
                    (1 === (t = 1 < t ? 1 : t) || a < e - o) && (o = e,
                    e = i.delta(t),
                    i.step(e)),
                    t < 1 && requestAnimFrame(s, i.canvas)
                }
                ,
                requestAnimFrame(s, i.canvas))
            }
            ,
            (F = this).delay ? setTimeout(L, this.delay) : L())
        },
        abort: function() {
            self.force = !0
        },
        remove: function() {
            this.abort(),
            this._canvas && this._canvas.parentNode && this._canvas.parentNode.removeChild(this._canvas)
        },
        update: function() {}
    },
    g.prototype = {
        select: function() {
            this._$el.css({
                border: this.borderStyle,
                "box-shadow": this.boxShadowStyle
            })
        },
        release: function() {
            this._$el.css({
                border: "",
                "box-shadow": ""
            })
        }
    },
    y.prototype = {
        select: function() {
            for (var e = 0; e < this.$els.length; e += 1)
                this.$els[e].css({
                    border: this.borderStyle,
                    "box-shadow": this.boxShadowStyle
                })
        },
        release: function() {
            for (var e = 0; e < this.$els.length; e += 1)
                this.$els[e].css({
                    border: "",
                    "box-shadow": ""
                })
        }
    },
    l.prototype = {
        COLORS: {
            RED: "#2f43dc",
            BLUE: "#2f43dc",
            GREEN: "#2f43dc"
        },
        ANIMATION_DELAY: 300,
        ANIMATION_MIN_DELAY: 140,
        ANIMATION_DELAY_MULTIPLIER: .95,
        _animateAnswers: function(e) {
            var t = v.elsMap.$answersList.children()
              , i = this._couple.answerId
              , n = this._answersElsWraps
              , o = [this.COLORS.RED, this.COLORS.GREEN, this.COLORS.BLUE];
            n.length = 0,
            util.shuffleArray(o),
            $.each(t, function(e, t) {
                t = $(t);
                n.push(new g(t,o[e],t.attr("answerId")))
            });
            var a, s = 2, r = 0, l = util.currentMillis(), d = this.ANIMATION_DELAY, c = this.ANIMATION_MIN_DELAY, u = this.ANIMATION_DELAY_MULTIPLIER, p = this._timeToAnswersAnimation, f = this, m = function() {
                f.isStarted && (a = util.currentMillis() - l,
                n[s] && n[s].release(),
                n[r] && n[r].select(),
                p < a && n[r].answerId === i ? e(n[r].color) : (d <= c ? d = c : d *= u,
                s = r,
                3 === (r += 1) && (r = 0),
                setTimeout(m, d)))
            };
            m()
        },
        _animateCouples2: function(o, a, e, t) {
            var s, i, n, r, l, d, c, u;
            this.isStarted && (i = 200,
            n = (s = this)._timeToCouplesAnimation,
            r = [],
            e.each(function(e, t) {
                var i = V.findUser(t.maleUid)
                  , n = V.findUser(t.femaleUid);
                i && n && (t = {
                    male: new y(i,o),
                    female: new y(n,o),
                    isTarget: t.maleUid === a.maleUid && t.femaleUid === a.femaleUid
                },
                s._couplseElsWraps.push(t.male),
                s._couplseElsWraps.push(t.female),
                r.push(t))
            }),
            l = 0,
            d = util.currentUtcMillis(),
            c = null,
            (u = function() {
                var e;
                s.isStarted && (e = util.currentUtcMillis() - d,
                c && (c.male.release(),
                c.female.release()),
                (c = r[l % r.length]).male.select(),
                c.female.select(),
                l += 1,
                n < e && c.isTarget ? setTimeout(t, 1500) : (500 <= i ? i = 500 : i *= 1.05,
                setTimeout(u, i)))
            }
            )())
        },
        _animateCouples: function(n, e, t, i, o, a) {
            if (this.isStarted) {
                var s, d = this, r = V.usersToHash(), l = d._couple.answerId, c = function() {
                    e()
                }, u = [], p = [], f = this._couplseElsWraps;
                f.length = 0,
                (util.isDef(i) || util.isDef(o)) && (s = !0);
                var m, v = !1, h = !1;
                if (t ? s ? o ? $.each(r, function(e, t) {
                    o[t.uid] && (t = new y(t,n),
                    f.push(t))
                }) : $.each(r, function(e, t) {
                    (2 === i && t.male || 1 === i && !t.male) && (t = new y(t,n),
                    f.push(t))
                }) : $.each(r, function(e, t) {
                    var i = new y(t,n);
                    f.push(i),
                    t.male ? (u.push(i),
                    t.uid === V.couple.maleUid && (v = !0)) : (p.push(i),
                    t.uid === V.couple.femaleUid && (h = !0))
                }) : $.each(d._prevAnswersPerRound, function(e, t) {
                    t !== l || (t = r[e]) && (e = new y(t,n),
                    f.push(e),
                    t.male ? (u.push(e),
                    t.uid === V.couple.maleUid && (v = !0)) : (p.push(e),
                    t.uid === V.couple.femaleUid && (h = !0)))
                }),
                !(v && h || s))
                    if (v || (m = V.findUser(V.couple.maleUid)) && u.push(new y(m,n)),
                    h || (m = V.findUser(V.couple.femaleUid)) && p.push(new y(m,n)),
                    !v || !h)
                        return void console.error("Couple not found!!");
                var g, b, C, _, w = function(e, t, i) {
                    var n, o = 200, a = d._timeToCouplesAnimation, s = util.currentMillis(), r = -1, l = function() {
                        if (d.isStarted) {
                            for (n = util.currentMillis() - s,
                            e[r] && e[r].release(); ++r >= e.length && (r = 0),
                            !(e.length <= 1 || e[r].isValid); )
                                e.splice(r, 1);
                            e[r] && e[r].select(),
                            a < n && e[r].uid === t || e.length <= 1 ? i() : (500 <= o ? o = 500 : o *= 1.05,
                            setTimeout(l, o))
                        }
                    };
                    l()
                };
                s ? w(f, a || V.targetUid, function() {
                    setTimeout(c, 700)
                }) : (_ = E ? (g = u,
                b = p,
                C = V.couple.maleUid,
                V.couple.femaleUid) : (g = p,
                b = u,
                C = V.couple.femaleUid,
                V.couple.maleUid),
                w(g, C, function() {
                    setTimeout(function() {
                        w(b, _, function() {
                            c()
                        })
                    }, 1e3)
                }))
            }
        },
        start: function(t) {
            this.isStarted = !0;
            var o = this;
            this._opts.restartRaffle ? setTimeout(t, 0) : this._couple.answerId ? this._animateAnswers(function(e) {
                setTimeout(function() {
                    var i = -1
                      , n = o._couple.answerId;
                    $.each(V.roundQuestion.answers, function(e, t) {
                        if (t.id === n)
                            return i = e,
                            !1
                    }),
                    -1 < i && $.each(a._arrowAnimations, function(e, t) {
                        t._indexOfAnswer !== i && t.remove()
                    }),
                    o._animateCouples(e, function() {
                        setTimeout(t, 800)
                    })
                }, 800)
            }) : o._animateCouples(this.COLORS.BLUE, function() {
                setTimeout(t, 800)
            }, !0)
        },
        abort: function() {
            this.isStarted = !1;
            $.each(this._answersElsWraps, function(e, t) {
                t.release()
            }),
            $.each(this._couplseElsWraps, function(e, t) {
                t.abort()
            }),
            this._answersElsWraps.length = 0,
            this._couplseElsWraps.length = 0
        }
    },
    b.prototype = {
        _drawRoundRect: function(e, t, i, n, o) {
            n < 2 * (o = i < 2 * o ? i / 2 : o) && (o = n / 2),
            this._ctx.beginPath(),
            this._ctx.moveTo(e + o, t),
            this._ctx.arcTo(e + i, t, e + i, t + n, o),
            this._ctx.arcTo(e + i, t + n, e, t + n, o),
            this._ctx.arcTo(e, t + n, e, t, o),
            this._ctx.arcTo(e, t, e + i, t, o),
            this._ctx.fill()
        },
        _drawArrow: function(e, t, i, n) {
            var o = Math.atan2(n - t, i - e);
            this._ctx.beginPath(),
            this._ctx.moveTo(e, t),
            this._ctx.lineTo(i, n),
            this._ctx.stroke(),
            this._ctx.moveTo(i - 10 * Math.cos(o - Math.PI / 6), n - 10 * Math.sin(o - Math.PI / 6)),
            this._ctx.lineTo(i, n),
            this._ctx.lineTo(i - 10 * Math.cos(o + Math.PI / 6), n - 10 * Math.sin(o + Math.PI / 6)),
            this._ctx.fill()
        },
        _animate: function(i) {
            var n = (new Date).getTime()
              , o = this._canvas
              , a = function() {
                var e = ((new Date).getTime() - n) / i.duration
                  , t = i.delta(e = 1 < e ? 1 : e);
                i.step(t),
                e < 1 && requestAnimationFrame(a, o)
            };
            a()
        },
        _drawLine: function(e, t, i, n) {
            this._ctx.beginPath(),
            this._ctx.moveTo(e, t),
            this._ctx.lineTo(i, n),
            this._ctx.stroke()
        },
        _showText: function(e) {
            var t = $(document.createElement("div"));
            t.text(this._text),
            t.css("opacity", 0),
            this._$container.append(t),
            t.fadeTo(300, 1, e)
        },
        start: function(t) {
            var i, n, o, a, s, r, l, d, c, u;
            this._isAborted || (this._$container.empty().append(this._canvas),
            i = this.mobiMiniGame ? 210 : 240,
            n = this.mobiMiniGame ? 100 : 150,
            o = 30,
            isMobi && (i = mobiUiHelper.fixPx(i),
            n = mobiUiHelper.fixPx(n),
            o = mobiUiHelper.fixPx(o)),
            a = parseInt((o - 2) / 2, 10),
            s = parseInt((i - n) / 2, 10),
            r = s + n,
            l = this._ctx,
            c = 0,
            (d = this)._canvas.width = i,
            this._canvas.height = o,
            l.strokeStyle = this._color,
            l.fillStyle = this._color,
            l.lineWidth = 2,
            l.lineJoin = "round",
            this._isStarted = !0,
            u = this._inverse ? this._noResults ? function(e) {
                c = r - e * r + s,
                d._drawArrow(i, a, c, a),
                c < r && d._drawRoundRect(c, 0, r - c, o, 4)
            }
            : function(e) {
                c = i - e * i,
                d._drawArrow(i, a, c, a),
                c < r - 30 && (e = Math.max(c + 30, s),
                d._drawRoundRect(e, 0, r - e, o, 4))
            }
            : this._noResults ? function(e) {
                c = e * r,
                d._drawLine(0, a, c, a),
                s < c && d._drawRoundRect(s, 0, c - s, o, 4)
            }
            : function(e) {
                c = e * i,
                d._drawArrow(0, a, c, a),
                s + 30 < c && d._drawRoundRect(s, 0, Math.min(c - s - 30, n), o, 4)
            }
            ,
            this._animate({
                duration: 600,
                delta: function(e) {
                    return 1 === (e = !d._isStarted ? 1 : e) && d._showText(t),
                    e
                },
                step: function(e) {
                    d._isAborted || (l.clearRect(0, 0, l.canvas.width, l.canvas.height),
                    u(e))
                }
            }))
        },
        abort: function() {
            this._isAborted = !0,
            this._$container.empty()
        }
    },
    t.prototype = {
        CLASS_NAME_HIDE_BUTTON: "fade-select-btn",
        CLASS_NAME_HIDE_VOTE: "fade-vote-label",
        CLASS_NAME_TRANSPARENT_VOTE: "transparent-vote-label",
        start: function(e) {
            var i = this
              , t = 0
              , n = 0
              , o = (parseInt(2e3 / i.$elsWithHidenButtons.length, 10),
            function() {
                var e;
                i.started && ((e = i.$elsWithHidenButtons[t++]) ? (o(),
                e.addClass(i.CLASS_NAME_HIDE_BUTTON)) : a())
            }
            )
              , a = function() {
                setTimeout(s, 500)
            }
              , s = function() {
                var e;
                i.started && ((e = i.$elsWithHidenVoteLabel[n++]) ? (setTimeout(s, 500),
                e.addClass(i.CLASS_NAME_HIDE_VOTE)) : r())
            }
              , r = function() {
                setTimeout(function() {
                    i.started && (i.started = !1,
                    i.$elsWithransparentVoteLabel.each(function(e, t) {
                        t.addClass(i.CLASS_NAME_TRANSPARENT_VOTE)
                    }),
                    e())
                }, 500)
            };
            i.started = !0,
            o()
        },
        abort: function() {
            var i = this;
            i.started = !1,
            i.$elsWithHidenButtons.each(function(e, t) {
                t.removeClass(i.CLASS_NAME_HIDE_BUTTON)
            }),
            i.$elsWithHidenVoteLabel.each(function(e, t) {
                t.removeClass(i.CLASS_NAME_HIDE_VOTE)
            }),
            i.$elsWithransparentVoteLabel.each(function(e, t) {
                t.removeClass(i.CLASS_NAME_TRANSPARENT_VOTE)
            })
        }
    },
    this._arrowAnimations = [],
    this._coupleAnimation = null,
    this._coupleResultAnimations = [],
    this.abort = function(e) {
        (e = e || {}).saveArrows || ($.each(this._arrowAnimations, function(e, t) {
            t.stopAndRemove()
        }),
        this._arrowAnimations.length = 0,
        v.els.canvasLayer.empty()),
        e.saveCoupleResults || ($.each(this._coupleResultAnimations, function(e, t) {
            t.abort()
        }),
        this._coupleResultAnimations.length = 0),
        this._coupleAnimation && (this._coupleAnimation.abort(),
        this._coupleAnimation = null),
        this._coupleVotesAnimation && (this._coupleVotesAnimation.abort(),
        this._coupleVotesAnimation = null)
    }
    ,
    this.hideCoupleVotes = function(e) {
        this._coupleVotesAnimation = new t,
        this._coupleVotesAnimation.start(e)
    }
    ,
    this.start = function(t) {
        this.abort();
        function i(e, t) {
            return e.orderIndex < t.orderIndex ? -1 : 1
        }
        var s = V.answersPerRound
          , n = V.viewerAnswer
          , r = []
          , l = []
          , e = function(e, a) {
            (e = util.cloneArray(e)).sort(i),
            V.roundType === p.CHOICE_EACH_OTHER ? $.each(e, function(e, n) {
                var t, o;
                n.uid && s[n.uid] && (t = s[n.uid].split(","),
                o = [],
                t.each(function(e, t) {
                    t = parseInt(t, 10),
                    t = V.findUser(t);
                    n && o.push(t)
                }),
                o.each(function(e, t) {
                    var i = t.uid + "";
                    (n.male === E ? r : l).push(new h(n,n.orderIndex,t.orderIndex,a,n.male,i == m,!0,s[f],{
                        answerIndex: e,
                        totalAnswers: o.length
                    }))
                }))
            }) : $.each(e, function(e, t) {
                var i;
                t.uid && s[t.uid] && (-1 !== (i = V.getIndexOfAnswer(s[t.uid])) && (t.male === E ? r : l).push(new h(t,t.orderIndex,i,a,t.male,t.male !== E && s[t.uid] === n,!1)))
            })
        };
        e(V.topUsers, !0),
        e(V.bottomUsers, !1),
        r[0] && (r[0].delay = 2e3),
        l[0] && (l[0].delay = 900);
        var o = this._arrowAnimations;
        $.each(r, function(e, t) {
            o.push(t)
        }),
        $.each(l, function(e, t) {
            o.push(t)
        });
        var a = 0;
        $.each(o, function(e, t) {
            a += t.delay + t.getTotalDuration()
        });
        var d, e = 1e3 * V.getPauseStateLeftSeconds();
        e < a && (d = a - e,
        $.each(o, function(e, t) {
            if (d -= t.delay,
            (t.delay = 0) < d && (t.force = !0,
            d -= t.getTotalDuration()),
            d <= 0)
                return !1
        }));
        var c = 0;
        app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW, {
            startResultsAnimations: !0
        });
        var u = function() {
            var e = o[c++];
            e ? e.startAnimation(function() {
                u()
            }) : t()
        };
        u()
    }
    ,
    this.onRoomUpdate = function() {
        $.each(this._arrowAnimations, function(e, t) {
            t.isRemoved || V.hasUser(t._uid) || t.stopAndRemove()
        })
    }
    ,
    this.onUserUidChange = function() {
        $.each(this._arrowAnimations, function(e, t) {
            t.user.uid !== t._uid && t.stopAndRemove()
        })
    }
    ,
    this.getArrowAnimations = function() {
        return this._arrowAnimations
    }
    ,
    this.animateUsers = function(e, t, i) {
        this._coupleAnimation && this._coupleAnimation.abort();
        var n, o = V.findUser(e);
        10 < V.getStartStateLeftSeconds() && o ? (i = i || {},
        this._coupleAnimation = new l({},null,V.getStartStateLeftSeconds(),{}),
        n = 1,
        o && o.male && (n = 2),
        this._coupleAnimation.isStarted = !0,
        this._coupleAnimation._animateCouples(this._coupleAnimation.COLORS.BLUE, t, !0, n, i.hashOfUidsForAnimation, e)) : setTimeout(t, 1)
    }
    ,
    this.showLines = function() {}
    ,
    this.animateCouple = function(e, t, i, n) {
        n = n || {},
        this._coupleAnimation && this._coupleAnimation.abort(),
        this._coupleAnimation = new l(e,t,V.getStartStateLeftSeconds(),n),
        this._coupleAnimation.start(i)
    }
    ;
    var C = {
        1: "Поцеловать",
        2: "Обнять",
        3: "Подмигнуть"
    }
      , _ = {
        1: "#ff545a",
        2: "#39b54a",
        3: "#29abe2"
    };
    function w(e) {
        var t = document.createElement("div");
        return t.className = "nothing-answer",
        t.innerHTML = e || "Пользователь решил<br>не отвечать",
        t
    }
    function D(e) {
        app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW, {
            coupleResult: !0,
            data: e
        })
    }
    this.showCoupleResults = function(i, e, t, n) {
        if ("4" == t || "3" === t) {
            var o = roomController.canAnimateKissAnswer(e, t)
              , a = V.couple;
            if (!o)
                return (l = v.els["couple-results"].children(i ? ".left-result" : ".right-result")).empty().append(w("Пользователь ответил<br>ждем твой ход")).show(),
                D({
                    captionNode: w("Пользователь ответил<br>ждем твой ход"),
                    side: i ? "left" : "right"
                }),
                void v.els["couple-results"].show();
            var s = _[t] || "#bebebe"
              , r = C[t] || "Ничего"
              , l = v.els["couple-results"].children(i ? ".top-result" : ".bottom-result")
              , o = !("1" === (o = t) || "2" === o || "3" === o)
              , d = !1
              , c = new b(s,r,!i,l,o);
            this._coupleResultAnimations.each(function(e, t) {
                if (t._inverse === c._inverse && t._color === c._color)
                    return !(d = !0)
            }),
            d || (this._coupleResultAnimations.push(c),
            v.els["couple-results"].show(),
            c.start(function() {
                var e, t;
                a && i !== E && (a.maleUid === f ? e = a.femaleAnswer : a.femaleUid === f && (e = a.maleAnswer)),
                "3" === e && (n && n.isDailyExpLimitExceeded || (t = app.EXP_BONUS.SMILE)),
                t && (e = v.getViewerOffset(),
                t = expController.applyBooster(t),
                expController.animateBonus({
                    incValue: t,
                    sourceOffset: {
                        left: e.left + 35,
                        top: e.top - 20
                    }
                }))
            }),
            isMobi && window.mobiMiniGameView && V.couple && (V.couple.maleUid === f || V.couple.femaleUid === f) && ((o = new b(s,r,!i,mobiMiniGameView.els[i ? "top-couple-result" : "bottom-couple-result"],o)).mobiMiniGame = !0,
            this._coupleResultAnimations.push(c),
            o.start($.noop)),
            v.els["couple-results"].children(i ? ".left-result" : ".right-result").empty().hide(),
            D({
                captionNode: "",
                side: i ? "left" : "right"
            }))
        } else
            l = v.els["couple-results"].children(i ? ".left-result" : ".right-result"),
            !t || "5" === t || "-2" === t && V.state === u.PAUSED ? (l.empty().append(w("Пользователь<br>проспал ответ")).show(),
            D({
                captionNode: w("Пользователь<br>проспал ответ"),
                side: i ? "left" : "right"
            }),
            v.els["couple-results"].show()) : "-2" === t ? (l.empty().append(w("Ожидаем<br>ответ")).show(),
            D({
                captionNode: w("Ожидаем<br>ответ"),
                side: i ? "left" : "right"
            }),
            v.els["couple-results"].show()) : t.startWith("1_") && (roomController.canAnimateKissAnswer(e, t) ? (l.empty().hide(),
            D({
                captionNode: "",
                side: i ? "left" : "right"
            })) : (l.empty().append(w("Пользователь ответил<br>ждем твой ход")).show(),
            D({
                captionNode: w("Пользователь ответил<br>ждем твой ход"),
                side: i ? "left" : "right"
            }),
            v.els["couple-results"].show()))
    }
    ,
    this.stop = function() {
        this.abort()
    }
    ,
    this.ArrowAnimation = h,
    window.resultController = this
}
,
app.controllers.RoomGiftsController = function(e) {
    function t() {
        return app.serverRebootPopup.isOpen() ? 20 : 0
    }
    var i, h = {
        userSizeRatio: 1,
        userSize: 1
    }, n = isMobi ? 2 : 1, o = 0, g = function() {
        return o ? o + t() : ((o = $("#app_header").outerHeight() + (isMobi ? w.els["exp-line"].outerHeight() : 0)) || 0) + t()
    }, b = 130, C = 91;
    isMobi && ((i = function() {
        h.userSizeRatio = mobiUiHelper.getRatioOfRoomUserSize(),
        h.userSize = mobiUiHelper.calcWidthOfRoomUser(),
        b = mobiUiHelper.fixPx(130),
        C = mobiUiHelper.fixPx(91)
    }
    )(),
    mobiUiHelper.on("resize", function() {
        o = 0,
        i(),
        w.forEachUsersEls(function(e, t) {
            var i = t.$giftsCanvas
              , t = M(i);
            t && t.length && (t.each(function(e, t) {
                t.x = r(t.fx),
                t.y = r(t.fy),
                t.width = r(t.fw),
                t.height = r(t.fh)
            }),
            R(i))
        })
    }));
    var _ = window.isMobi
      , G = (util.random,
    e.roomModel || window.roomModel)
      , w = e.roomView || window.roomView
      , E = ROOM_GIFT_TYPE
      , r = isMobi ? function(e) {
        return e * mobiUiHelper.getRatioOfRoomUserSize()
    }
    : function(e) {
        return e
    }
      , H = app.info.viewer_id;
    function y(e) {
        return e === app.info.roomGiftMelodyId
    }
    function D(e) {
        return e === app.info.roomGiftKissId
    }
    function T(e, t, i, n, o, a, s) {
        this.initialWidth = r(e),
        this.initialHeight = r(t),
        this.finalWidth = r(i),
        this.finalHeight = r(n),
        this.finalX = r(o),
        this.finalY = r(a),
        this.angle = s || 0,
        this.fw = i,
        this.fh = n,
        this.fx = o,
        this.fy = a
    }
    var S = {};
    function d(e, n, o) {
        var a = e + ""
          , s = function() {
            var e, t, i = n.shift();
            i && o.attr("uid") === a && (e = o.children().offset(),
            util.isOKPlatform() ? (t = $frameWrapper.offset(),
            e.left -= t.left,
            --t.top) : t = {
                left: 0,
                top: 0
            },
            e.top += -g(),
            e.left += i.x,
            e.top += i.y,
            roomController.fxController.animateImage(i.url, util.random(900, 1200), {
                x: e.left / w.scale,
                y: e.top / w.scale,
                width: i.width,
                height: i.height,
                alpha: 1,
                rotation: i.angle
            }, {
                x: e.left / w.scale,
                y: (e.top - 70) / w.scale,
                width: i.width,
                height: i.height,
                alpha: 0,
                rotation: i.angle
            }, function() {
                console.info("hoho!")
            }, {
                isObsolete: function() {
                    return !1
                }
            }),
            function(e, t) {
                var i, n = M(e.$giftsCanvas), o = n.length;
                for (; o--; )
                    i = n[o],
                    t === i && (i.isRemoved = !0,
                    n.splice(o, 1));
                R(e.$giftsCanvas)
            }(o, i),
            setTimeout(s, util.random(600, 800)))
        };
        s()
    }
    function A(e, t) {
        return t + "_" + e.id + "_" + e.ts
    }
    function I(e, t) {
        var i;
        isMobi || (e = G.findUser(e)) && e.firstNameGen && t && ((i = lilo.createView("room-gift-bonus-popup")).setModel({
            firstNameGen: e.firstNameGen,
            bonus: t
        }),
        w.els["couple-match-view"].empty().append(i.el),
        setTimeout(function() {
            i.el.remove()
        }, 3e3))
    }
    function l(e) {
        var t = e.data("ctx");
        return t || (t = e[0].getContext("2d"),
        e.data("ctx", t),
        t.__state = 1),
        t
    }
    function M(e) {
        var t = e.data("imagesDataArray");
        return t || e.data("imagesDataArray", t = []),
        t
    }
    function O(e, t) {
        var i = e.data("hasNoteGift");
        i || e.data("hasNoteGift", i = {}),
        i.hasNoteGift = t
    }
    this.animatePrivateMessage = function(e, t, i) {
        console.info("animatePrivateMessage", arguments),
        (i = i || {}).privateMessage = !0,
        i.forViewer = t === app.info.viewer_id;
        var n = "msg-icons/norma/normal-msg-gift.png"
          , o = i.message;
        if (o && o.type)
            switch (o.type) {
            case app.PrivateMessageType.TYPE_USUAL:
                n = "msg-icons/norma/normal-msg-gift.png";
                break;
            case app.PrivateMessageType.TYPE_GOLD_RECEIVED:
            case app.PrivateMessageType.TYPE_GOLD:
                n = "msg-icons/gold/normal-msg-gift.png";
                break;
            case app.PrivateMessageType.P2P_INVITE:
                n = "msg-icons/video/normal-msg-gift.png"
            }
        this.animateGift({
            img: CDN_PREFIX + n
        }, null, e, t, !1, i)
    }
    ,
    this.removeGifts = function(e, i, t) {
        var n = {}
          , o = !1;
        if (e.each(function(e, t) {
            y(t.id) && (o = !0);
            t = A(t, i);
            n[t] = t
        }),
        !util.isEmptyObject(n)) {
            var a = []
              , e = w.findElByUid(i);
            if (e) {
                o && O(e.$giftsCanvas, !1);
                for (var s, r = M(e.$giftsCanvas), l = r.length; l--; )
                    s = r[l],
                    n[s.key] && (s.isRemoved = !0,
                    r.splice(l, 1));
                R(e.$giftsCanvas),
                d(i, a, e)
            }
        }
    }
    ,
    window.calcRemindTime = function(e) {
        var t = Math.floor(e / 36e5);
        return (e = Math.floor((e - 1e3 * t * 60 * 60) / 6e4)) < 1 && (e = 1),
        "Это ограничение будет снято через {0} {1} {2} {3}.".format(0 < t ? t : "", 0 < t ? util.pluralize(t, {
            one: "час",
            two: "часа",
            many: "часов"
        }) : "", e, util.pluralize(t, {
            one: "минуту",
            two: "минуты",
            many: "минут"
        }))
    }
    ;
    var c = 30
      , u = isMobi ? function(e) {
        return Math.floor(e * n)
    }
    : function(e) {
        return e
    }
    ;
    function a(e, t, i) {
        var n, o, a, s, r, l, d;
        i.angle ? (n = e,
        o = t,
        a = u(i.x + c),
        s = u(i.y + c),
        r = u(i.width),
        l = u(i.height),
        d = i.angle,
        n.save(),
        n.translate(a + r / 2, s + l / 2),
        n.rotate(d),
        n.drawImage(o, -r / 2, -l / 2, r, l),
        n.restore()) : e.drawImage(t, u(i.x + c), u(i.y + c), u(i.width), u(i.height))
    }
    var s = {};
    function x(e, t) {
        var i, n = l(e), o = s[t.url];
        o ? a(n, o, t) : (o = new Image,
        i = n.__state,
        o.onload = function() {
            s[t.url] = o,
            t.isRemoved || n.__state !== i || a(n, o, t)
        }
        ,
        o.src = t.url)
    }
    function R(i) {
        var e = l(i);
        e.clearRect(0, 0, i[0].width, i[0].height),
        e.__state++;
        var t, n, o, a = M(i), s = ((e = (t = i).data("hasNoteGift")) || t.data("hasNoteGift", e = {
            hasNoteGift: !1
        }),
        e.hasNoteGift), r = !1;
        s && (n = 0,
        o = 1,
        a.each(function(e, t) {
            y(t.id) ? o = t.ts : rawGiftsHash[t.id].type === E.BOTTOM_RIGHT_SIDE && (n = t.ts)
        })),
        a.each(function(e, t) {
            r = !1,
            s ? y(t.id) ? n < o && (r = !0) : (rawGiftsHash[t.id].type !== E.BOTTOM_RIGHT_SIDE || o < n) && (r = !0) : r = !0,
            r && x(i, t)
        })
    }
    function W(e, t, i) {
        var n = i && i.totalExpBonus ? i.totalExpBonus : (n = e.from === H ? rawGiftsHash[e.id].expBonusForSender : rawGiftsHash[e.id].expBonusForRecipient,
        n *= t,
        expController.applyBooster(n));
        0 < (n = e.noExp ? 0 : n) && (e = w.getViewerOffset(),
        expController.animateBonus({
            incValue: n,
            sourceOffset: {
                left: e.left + 35,
                top: e.top - 20
            }
        }))
    }
    window.loadedImagesHash = s;
    var k = [E.BOTTOM_RIGHT_SIDE, E.HAT];
    this.clearViewerGifts = function() {
        var e = w.findElByUid(H);
        e && (e.$giftsCanvas.removeData(),
        O(e.$giftsCanvas, !1),
        R(e.$giftsCanvas))
    }
    ;
    var P = Math.PI / 2
      , N = 2 * Math.PI;
    this.animateGift = function(a, e, i, s, r, l) {
        l = l || S,
        i !== s && s === H && D(a.id);
        var t = a.imgFly || a.imgLanding || a.img
          , d = a.imgLanding || a.img
          , c = w.findElByUid(s);
        a.isMulticolor && a.landingImages.length && (f = e.counter % a.landingImages.length,
        d = t = a.landingImages[f]);
        var u = G.findUser(s);
        if (c && u) {
            D(a.id) && (t = CDN_PREFIX + "game-gift-v2/1023_40_1.png",
            d = t);
            var n, p = function(e, t, i) {
                var n, o, a;
                if (i.privateMessage)
                    return i.forViewer ? (s = new T(75,60,50,50,56,59),
                    isMobi ? (n = 60 * h.userSizeRatio,
                    o = 40 * h.userSizeRatio,
                    a = .56 * h.userSize,
                    i = .63 * h.userSize,
                    s.finalWidth = n,
                    s.finalHeight = o,
                    s.finalX = a,
                    s.finalY = i) : (s.finalWidth = 48,
                    s.finalHeight = 34,
                    s.finalX = 57,
                    s.finalY = 68)) : s = new T(75,60,48,34,28,30),
                    s;
                var s = t.angle || 0;
                return e.type === ROOM_GIFT_TYPE.WITH_TARGET && (s = (1 === util.random(1, 2) ? -1 : 1) * util.random(0, e.randomAngle) * Math.PI / 180),
                D(e.id) ? new T(75,75,35,35,t.x - 17,t.y - 17,s) : new T(75,75,t.w,t.h,t.x,t.y,s)
            }(a, e, l), o = function() {
                var e, n, o, t;
                l.privateMessage ? l.onComplete && l.onComplete() : u.uid === s && (r || (e = u,
                0 < a.recipientBalanceBonus ? s === H ? l.noBonus || (api.syncBalance(),
                l.countOfGifts ? I(i, l.countOfGifts * a.recipientBalanceBonus) : I(i, a.recipientBalanceBonus)) : l.noBonus || (l.countOfGifts ? w.animateBalanceBonus(s, a.recipientBalanceBonus * l.countOfGifts) : w.animateBalanceBonus(s, a.recipientBalanceBonus)) : a.isIncGiftCounter && e.setAttr({
                    giftsCount: e.giftsCount + 1
                }),
                (e = l.gift) && e.to === H && !l.noExp && W(e, l.countOfGifts)),
                e = {
                    id: a.id,
                    key: A(l.gift, s),
                    x: p.finalX,
                    y: p.finalY,
                    width: p.finalWidth,
                    height: p.finalHeight,
                    url: d,
                    type: a.type,
                    angle: p.angle || 0,
                    ts: l.gift.ts,
                    fx: p.fx,
                    fy: p.fy,
                    fw: p.fw,
                    fh: p.fh
                },
                n = M(c.$giftsCanvas),
                o = !1,
                y(a.id) || k.each(function(e, t) {
                    if (a.type === t)
                        for (var i = n.length; i--; )
                            n[i].type !== t || y(n[i].id) || (n.splice(i, 1),
                            o = !0)
                }),
                a.type !== E.MELODY && !l.isLastGift || (o = !0),
                n.push(e),
                y(e.id) ? (O(c.$giftsCanvas, !0),
                R(c.$giftsCanvas)) : o ? R(c.$giftsCanvas) : x(c.$giftsCanvas, e),
                r || (145 !== a.id || r || (t = app.soundManager.SOUND_IDS.TOMATO_SQUISH),
                (t = a.soundLanding || t) && app.soundManager.play(t)))
            }, f = w.findElByUid(i);
            if (r)
                o();
            else {
                if (D(a.id)) {
                    var m, v = new U({
                        addToContainer: o,
                        from: i,
                        to: s,
                        giftEndPoint: {
                            x: p.finalX,
                            y: p.finalY
                        },
                        giftWidth: p.finalWidth,
                        giftHeight: p.finalHeight,
                        imgUrl: t,
                        angle: p.angle,
                        gift: e,
                        opts: l
                    });
                    return isMobi && window.mobiMiniGameView && G.couple && (G.couple.maleUid === H || G.couple.femaleUid === H) && (m = new U({
                        addToContainer: function() {
                            app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW, {
                                addKiss: !0,
                                data: {
                                    targetUid: u.uid,
                                    id: a.id,
                                    x: p.fx,
                                    y: p.fy,
                                    width: p.fw,
                                    height: p.fh,
                                    url: d,
                                    angle: p.angle || 0,
                                    ts: l.gift.ts
                                }
                            })
                        },
                        from: i,
                        to: s,
                        giftEndPoint: {
                            x: p.finalX,
                            y: p.finalY
                        },
                        giftWidth: p.finalWidth,
                        giftHeight: p.finalHeight,
                        imgUrl: t,
                        angle: p.angle,
                        gift: e,
                        opts: l,
                        miniMobi: !0
                    })),
                    void (roomController.canAnimateKissAnswer(i, "1") ? (v.start(),
                    m && m.start($.noop)) : (L(i, s, v),
                    m && L(i, s, m)))
                }
                f ? (v = c.children().offset(),
                m = f.children().offset(),
                console.info("source offset1", m),
                v && m ? (util.isOKPlatform() ? (n = $frameWrapper.offset(),
                console.info("frameOffset", n),
                v.left -= n.left,
                m.left -= n.left,
                --n.top) : n = {
                    left: 0,
                    top: 0
                },
                v.top -= g(),
                _ ? (m.top += -g() + h.userSize / 2 - p.initialHeight / 2,
                m.left += h.userSize / 2 - p.initialWidth / 2) : (m.top += -g() + C / 2 - p.initialHeight / 2,
                m.left += b / 2 - p.initialWidth / 2),
                console.info("source offset3", m),
                l.privateMessage || (f = app.soundManager.SOUND_IDS.GIFT,
                8 === a.id || 144 === a.id ? f = app.soundManager.SOUND_IDS.KISS : 145 === a.id ? f = app.soundManager.SOUND_IDS.WHOOSH : a.isIncGiftCounter || (f = null),
                (f = a.soundSending || f) && app.soundManager.play(f)),
                roomController.fxController.animateImage(t, 1500, {
                    x: m.left / w.scale,
                    y: m.top / w.scale,
                    width: p.initialWidth,
                    height: p.initialHeight,
                    rotation: 0
                }, {
                    x: v.left + p.finalX + (_ ? 2 : 1),
                    y: v.top + p.finalY + (_ ? 2 : 0),
                    width: p.finalWidth,
                    height: p.finalHeight,
                    rotation: (v = p.angle,
                    P < (v = v % N) ? -(N - v) : v)
                }, o, {
                    isObsolete: function() {
                        return u.uid !== s
                    },
                    updateFinalPosition: {
                        update: function() {
                            var e = c.children().offset();
                            return {
                                x: e.left + p.finalX + (_ ? 2 : 1) - n.left,
                                y: e.top + p.finalY + (_ ? 2 : 0) - g() - n.top
                            }
                        },
                        delay: 100
                    }
                }),
                e && e.from === H && !l.noExp && W(e, l.countOfGifts, l)) : o()) : o()
            }
        }
    }
    ;
    var j = []
      , p = {};
    function U(l) {
        function i(e, t) {
            return {
                x: e.x + t.x,
                y: e.y + t.y
            }
        }
        var n = l.opts
          , o = (l.gift,
        {
            x: 136,
            y: 178,
            width: 472,
            height: 230
        })
          , a = {
            x: 52,
            y: 95
        }
          , s = {
            x: 407,
            y: 95
        }
          , r = {
            x: 233,
            y: 0
        }
          , d = {
            x: 13,
            y: 61
        }
          , c = {
            x: 355,
            y: 61
        };
        l.miniMobi ? (o.x = 0,
        o.y = 0,
        o.width = 500,
        o.height = 190,
        a = {
            x: 81,
            y: 25
        },
        s = {
            x: 389,
            y: 25
        },
        r = {
            x: 250,
            y: 0
        },
        d = {
            x: 56,
            y: 20
        },
        c = {
            x: 364,
            y: 20
        }) : isMobi && (o.x = 10,
        o.y = 170,
        o.width = 480,
        o.height = 190,
        a = {
            x: 63,
            y: 99
        },
        s = {
            x: 385,
            y: 99
        },
        r = {
            x: 240,
            y: 0
        },
        d = {
            x: 52,
            y: 74
        },
        c = {
            x: 360,
            y: 74
        }),
        isMobi && ([a, s, r, d, c].each(function(e, t) {
            t.x = mobiUiHelper.fixPx(t.x),
            t.y = mobiUiHelper.fixPx(t.y)
        }),
        o.x = mobiUiHelper.fixPx(o.x),
        o.y = mobiUiHelper.fixPx(o.y),
        o.width = mobiUiHelper.fixPx(o.width),
        o.height = mobiUiHelper.fixPx(o.height)),
        [a, s, r, d, c].each(function(e, t) {
            t.x += o.x,
            t.y += o.y
        });
        var u, p, f, t, m, e = l.addToContainer, v = this, h = l.giftWidth, g = l.giftWidth / 2, b = l.giftHeight, C = G.findUser(l.to), _ = !1, w = !1, E = new Image, y = util.currentMillis, D = l.angle, T = 0, S = .05, A = 1, I = 1e3;
        function M(e, t, i, n) {
            return t * (1 - e) * (1 - e) + 2 * (1 - e) * e * i + e * e * n
        }
        function O(e, t, i) {
            return 3 * i * (1 - i) * (1 - i) * e + 3 * i * i * (1 - i) * t + i * i * i
        }
        function x(e) {
            if ((isMobi && l.miniMobi && isGamePreviewVisible() || !l.miniMobi && !isGamePreviewVisible()) && S <= e) {
                var t = Math.min(e, A)
                  , i = S
                  , n = new PIXI.Graphics;
                for (n.miniMobi = l.miniMobi; i <= t; )
                    o = n,
                    a = M(i, u.x + g, p.x + g, f.x + g),
                    s = M(i, u.y + g, p.y + g, f.y + g),
                    r = i,
                    o.beginFill(16777215, r * r),
                    o.drawCircle(a, s, 3),
                    o.endFill(),
                    i += .03;
                N.push(n),
                roomController.fxController.getStage().addChild(n)
            }
            var o, a, s, r
        }
        var R = -.03;
        function k(e) {
            var t = M(e = function(e, t, i, n, o) {
                for (var a = T; 0 < o - O(e, i, a) && a < 1; )
                    a += .001;
                return O(t, n, T = a)
            }(.46, .7, .62, .36, e), u.x, p.x, f.x)
              , i = M(e, u.y, p.y, f.y);
            U(),
            x(e + R),
            m.x = t + g,
            m.y = i + g,
            m.width = h,
            m.height = b,
            m.rotation = D
        }
        function P() {
            j.push(v),
            t = y();
            var e = PIXI.Texture.fromImage(E.src);
            (m = new PIXI.Sprite(e)).anchor.x = .5,
            m.anchor.y = .5,
            windowVisibilityState() ? (m.miniMobi = l.miniMobi,
            roomController.fxController.animateItem(m, {
                _pixiSprite: m,
                isObsolete: function() {
                    return !_ || w
                },
                update: F
            })) : B();
            e = n.gift;
            e && e.from === H && !n.noExp && W(e, n.countOfGifts),
            app.soundManager.play(app.soundManager.SOUND_IDS.KISS)
        }
        app.info.animationFps;
        var N = []
          , U = function() {
            var i = roomController.fxController.getStage();
            N.each(function(e, t) {
                i.removeChild(t)
            }),
            N.length = 0
        }
          , L = isMobi ? function() {
            var i = !!isGamePreviewVisible();
            N.each(function(e, t) {
                t.miniMobi ? t.visible = i : t.visible = !i
            })
        }
        : $.noop;
        function F(e) {
            _ && (e = Math.min((e - t) / I, 1),
            L(),
            k(e),
            1 === e && B())
        }
        function V() {
            _ = !1,
            U(),
            roomController.fxController.forceRender()
        }
        function B() {
            w || (w = !0,
            U(),
            x(.96),
            roomController.fxController.forceRender(),
            C && C.uid === l.to && e(),
            setTimeout(function() {
                _ = !1,
                V()
            }, 2500))
        }
        this.abort = function() {
            _ && (_ = !1,
            V(),
            B())
        }
        ,
        this.start = function() {
            _ = !0,
            E.onload = function() {
                var e, t;
                !_ || (e = G.findUser(l.from)) && (t = l.giftEndPoint,
                e.isCoupleMale ? (u = a,
                p = r,
                f = i(c, t),
                n.delay ? setTimeout(P, n.delay) : P()) : e.isCoupleFemale && (u = s,
                p = r,
                f = i(d, t),
                n.delay ? setTimeout(P, n.delay) : P()))
            }
            ,
            E.src = l.imgUrl
        }
    }
    function L(e, t, i) {
        t = e + "_" + t;
        (p[t] || (p[t] = [])).push(i)
    }
    this.abortCustomGiftsAnimation = function() {
        j.each(function(e, t) {
            t.abort()
        }),
        j.length = 0
    }
    ,
    this.clearCacheOfCustomGiftsAnimations = function() {
        p = {}
    }
    ,
    this.animateKissFromCache = function(e, t) {
        e = e + "_" + t,
        t = p[e];
        t && (delete p[e],
        t.each(function(e, t) {
            t.start()
        }))
    }
}
,
function() {
    var r, s, e, t, l = (e = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),
    t = 0,
    {
        ROOM_ID: i(),
        ROOM_STATE: i(),
        USERS: i(),
        VIEWER_ANSWER: i(),
        CHAT_MESSAGES: i(),
        SID: i(),
        INDEX_IN_QUEUE: i(),
        PRIVATE_MESSAGES: i(),
        CURRENT_ROUND: i(),
        EXP: i(),
        POPULAR_UID: i(),
        WASTEFUL_UID: i(),
        DJ: i(),
        FORTUNATE_UID: i(),
        EXIT_REASON: i(),
        SPENT: i(),
        MESSAGES_COUNT: i(),
        TRACK_COUNT: i(),
        ROOM_ACCESS_DESCR: i(),
        RADIO: i(),
        ROOM_OWNER: i(),
        ROOM_OWNER_AVATAR: i(),
        ROOM_OWNER_FIRST_NAME: i(),
        ROOM_OWNER_LAST_NAME: i(),
        VERSION_OF_LAST_CHANGE: i(),
        ROUND_DEFINITION: i(),
        ROOM_QUEUE: i(),
        VIEWER_DATA: i(),
        QUEUE_VIEWER_DATA: i(),
        RADIO_TYPE: i(),
        CONFERENCE_DATA: i(),
        LEFT_COINS_IN_LOCAL_ROOM_TOP: i(),
        LEFT_TIME_FOR_NAME_LOCAL_ROOM_TOP_REWARDS: i()
    });
    function i() {
        return e[t++]
    }
    function o(e, t) {
        this.to = t,
        this.id = e[0],
        this.from = e[1],
        this.to = e[2],
        this.ts = e[3],
        this.x = e[4],
        this.y = e[5],
        this.w = e[6],
        this.h = e[7],
        this.angle = e[8],
        this.count = e[9],
        this.noExp = e[10],
        this.version = this.id === app.info.roomGiftKissId ? app.info.giftsVersion : e[11],
        this.totalExpBonusForSender = e[12],
        this.totalExpBonusForRecipient = e[13],
        this.counter = e[14] || 0
    }
    function d(e) {
        this.innerId = e[0],
        this.id = e[1],
        this.from = e[2],
        this.to = e[3],
        this.commonId = this.from + "_" + this.id,
        this.type = e[4],
        this.state = e[5],
        this.p2pStatus = e[6]
    }
    function c(e) {
        return {
            uid: e[0],
            state: e[1],
            wins: e[2],
            male: !!e[3],
            gifts: o.fromArray(e[4], e[0]),
            age: e[5],
            giftsCount: e[6],
            gameCounter1: e[7],
            gameCounter2: e[8],
            gameCounter3: e[9],
            isAway: e[10],
            freeMessageCountersMap: e[11],
            exp: e[12],
            sentGiftsPerDay: e[13],
            receivedGiftsPerDay: e[14],
            expPerDay: e[15],
            firstName: e[16],
            firstNameAcc: e[17],
            firstNameGen: e[18],
            firstNameDat: e[19],
            photo_100: e[20],
            photo_200: e[21],
            lotteryWinsPerDay: e[22],
            djCounter: e[23],
            sentGiftsPerHour: e[24],
            receivedGiftsPerHour: e[25],
            expPerHour: e[26],
            lotteryWinsPerHour: e[27],
            regionId: e[28],
            sentGiftsPerRoom: e[29],
            receivedGiftsPerRoom: e[30],
            hasBDate: e[31],
            countryId: e[32],
            coolLikes: e[33],
            isMobiUser: e[34],
            counterMapOfGiftsForBeginners: e[35] || {},
            isVerified: e[36],
            clientType: e[37] || 0,
            exitReason: e[38] ? C(e[38]) : null,
            hasExpBooster: !!e[39],
            lotteryWinsPerRoom: e[40]
        }
    }
    o.fromArray = function(e, i) {
        var n = [];
        return $.each(e, function(e, t) {
            n.push(new o(t,i))
        }),
        n
    }
    ,
    d.fromArray = function(e) {
        return util.createModels(e, d)
    }
    ;
    var u = app.models.ChatMessage;
    function p(e) {
        var i = [];
        return e && e.length && $.each(e, function(e, t) {
            t = {
                id: t[0],
                imgUrl: t[2] || t[1],
                sapsUrl: t[2],
                vkUrl: t[1]
            };
            t.sapsUrl && hashOfInvalidSapsImages[t.sapsUrl] && (t.imgUrl = t.vkUrl),
            i.push(t)
        }),
        i
    }
    function f(e) {
        var t = {
            id: null,
            text: null,
            answers: null
        }
          , i = e[0]
          , n = e[1]
          , o = e[2]
          , a = e[3]
          , e = e[4];
        return t.id = i,
        t.text = n,
        t.fullName = a,
        t.uid = e,
        t.answers = p(o),
        t
    }
    function m(e) {
        return {
            answerId: e[0],
            maleUid: e[1],
            femaleUid: e[2],
            maleAnswer: e[3],
            femaleAnswer: e[4]
        }
    }
    function v(e) {
        var t = e[0]
          , i = e[1]
          , n = {
            type: t
        };
        i === r.STARTED ? (n.startStateCtm = e[2],
        n.startStateDuration = e[3]) : (n.pauseStateCtm = e[2],
        n.pauseStateDuration = e[3]);
        if (t === s.NORMAL)
            i === r.STARTED ? n.roundQuestion = f(e[4]) : n.answersPerRound = e[4];
        else if (t === s.WHO_LIKES_ON_MALES || t === s.WHO_LIKES_ON_FEMALES)
            i === r.STARTED ? (n.roundQuestion = f(e[4]),
            n.firstUidForSelect = e[5],
            n.secondUidForSelect = e[6],
            n.firstUidVotes = e[7],
            n.secondUidVotes = e[8],
            n.usersSnapshot = e[9]) : (n.firstUidForSelect = e[4],
            n.secondUidForSelect = e[5],
            n.firstUidVotes = e[6],
            n.secondUidVotes = e[7]);
        else if (t === s.CHOICE_EACH_OTHER) {
            if (i === r.STARTED) {
                n.roundQuestion = f(e[4]);
                var o = e[5]
                  , a = e[6];
                switch (n.subStateId = o,
                n.subStateEstimatedTime = a,
                o) {
                case app.RoundSubState.CHOOSING_PARTNER_FOR_KISS:
                    n.usersSnapshot = e[7],
                    n.answersPerRound = e[8];
                    break;
                case app.RoundSubState.SHOW_ARROWS:
                case app.RoundSubState.SHOW_SELF_ARROWS:
                case app.RoundSubState.VOTING:
                    n.coupleIds = e[7],
                    n.answersPerRound = e[8];
                    break;
                case app.RoundSubState.SHOW_RESULT:
                    n.coupleIds = e[7],
                    n.winnerCoupleId = e[8]
                }
            }
        } else
            t === s.CHOOSE_COUPLE_FOR_MALE || t === s.CHOOSE_COUPLE_FOR_FEMALE ? (n.roundQuestion = f(e[4]),
            n.mapOfUidsforSelect = e[5],
            n.targetUid = e[6],
            n.answersPerRound = e[7]) : t === s.LOTTERY ? i === r.STARTED ? (n.roundQuestion = f(e[4]),
            n.usersBets = e[5]) : (n.usersBets = e[4],
            n.winCombination = e[5],
            n.lotteryResults = function(e) {
                if (!e)
                    return null;
                var i = [];
                return $.each(e, function(e, t) {
                    i.push({
                        uid: t[0],
                        betValue: t[1],
                        winValue: t[2],
                        winCurrency: t[3],
                        expBonus: t[4]
                    })
                }),
                i
            }(e[6])) : t === s.LOADING_ROUND ? (n.roundQuestion = f(e[4]),
            3 === (t = e[5]) ? (n.innerState = t,
            n.usersSnapshot = e[6],
            n.maleUserWithPhoto = h(e[7]),
            n.femaleUserWithPhoto = h(e[8]),
            n.canShowPhotos = !0) : n.canShowPhotos = 2 === t || e[6]) : i === r.STARTED ? (n.roundQuestion = f(e[4]),
            n.prevRoundAnswers = p(e[5]),
            n.prevAnswersPerRound = e[6],
            n.couple = m(e[7]),
            n.featureType = e[8],
            n.uidsWithSameScore = e[9]) : n.couple = m(e[4]);
        return n
    }
    function h(e) {
        return e ? {
            uid: e[0],
            isMale: e[1],
            photo: {
                ownerId: (t = e[2])[0],
                photoUrl: t[1],
                pid: t[2]
            },
            likesMap: e[3]
        } : null;
        var t
    }
    function g(e) {
        var i = []
          , n = [];
        return $.each(e[0], function(e, t) {
            i.push(b(t))
        }),
        $.each(e[1], function(e, t) {
            n.push(b(t))
        }),
        {
            males: i,
            females: n
        }
    }
    function b(e) {
        return {
            uid: e[0],
            firstName: e[1],
            age: e[2],
            avatar: e[3],
            exp: e[4],
            price: e[5],
            confirmedUid: e[6],
            isMale: e[7]
        }
    }
    function C(e) {
        return {
            id: e[0],
            data: e[1],
            deportationModel: (e = e[2]) ? new app.models.UsersDeportation(e) : null
        }
    }
    function _(e) {
        var t = e[0]
          , i = {
            type: t
        };
        return 3 === t ? i.level = e[1] : 4 === t ? (i.countryId = e[1],
        i.regionId = e[2],
        i.countryName = e[3],
        i.regionName = e[4],
        i.level = e[5]) : 5 === t && (i.countryId = e[1],
        i.countryName = e[2],
        i.level = e[3]),
        i
    }
    app.controllers.RoomResponseParser = function() {
        r = app.ROOM_STATE,
        app.ROOM_USER_STATE,
        s = app.ROUND_TYPE,
        app.ChatMessageType,
        u = app.models.ChatMessage
    }
    ,
    $.extend(app.controllers.RoomResponseParser.prototype, {
        parseRoomQueuesUser: b,
        parseRoomQueue: g,
        parse: function(e) {
            var i = {};
            i.roomId = e[l.ROOM_ID];
            var t, n, o = e[l.ROOM_STATE];
            if (!o)
                return i.users = (t = e[l.USERS],
                n = [],
                $.each(t, function(e, t) {
                    n.push({
                        uid: t[0],
                        age: t[1],
                        exp: t[2],
                        male: 2 === t[3],
                        photo_100: t[4],
                        firstName: t[5],
                        vf: !!t[6]
                    })
                }),
                n),
                i.isSummary = !0,
                i.spent = e[l.SPENT] || 0,
                i.chatMessagesCount = e[l.MESSAGES_COUNT] || 0,
                i.tracksCount = e[l.TRACK_COUNT] || 0,
                i.accessDescr = e[l.ROOM_ACCESS_DESCR] ? _(e[l.ROOM_ACCESS_DESCR]) : {},
                i.radioType = e[l.RADIO_TYPE],
                i.roomOwner = e[l.ROOM_OWNER] || null,
                i.roomOwnerAvatar = e[l.ROOM_OWNER_AVATAR] || null,
                i.roomOwnerFirstName = e[l.ROOM_OWNER_FIRST_NAME] || null,
                i.roomOwnerLastName = e[l.ROOM_OWNER_LAST_NAME] || null,
                util.isDef(e[l.INDEX_IN_QUEUE]) && (i.indexInQueue = e[l.INDEX_IN_QUEUE]),
                util.isDef(e[l.VIEWER_DATA]) && (i.viewerData = c(JSON.parse(e[l.VIEWER_DATA]))),
                util.isDef(e[l.QUEUE_VIEWER_DATA]) && (i.queueViewerData = b(JSON.parse(e[l.QUEUE_VIEWER_DATA]))),
                i;
            i.roomState = o;
            var a = i.users = [];
            $.each(JSON.parse(e[l.USERS]), function(e, t) {
                a.push(c(t))
            }),
            o !== r.WAITING_USERS && (i.round = v(JSON.parse(e[l.CURRENT_ROUND])),
            i.viewerAnswer = e[l.VIEWER_ANSWER],
            e[l.ROUND_DEFINITION] && (s = {
                roundQuestion: f(e[l.ROUND_DEFINITION].roundQuestion)
            },
            $.extend(i.round, s))),
            e[l.CHAT_MESSAGES] && (i.chatMessages = [],
            $.each(e[l.CHAT_MESSAGES], function(e, t) {
                i.chatMessages.push(new u(t))
            })),
            e[l.PRIVATE_MESSAGES] && (i.privateMessages = d.fromArray(JSON.parse(e[l.PRIVATE_MESSAGES]))),
            e[l.EXP] && (i.exp = e[l.EXP]),
            e[l.EXIT_REASON] && (i.exitReason = C(e[l.EXIT_REASON])),
            i.leftCoinsInLocalRoomTop = e[l.LEFT_COINS_IN_LOCAL_ROOM_TOP] || 0,
            i.leftTimeForNextRewardOfLocalTop = e[l.LEFT_TIME_FOR_NAME_LOCAL_ROOM_TOP_REWARDS] || 0,
            i.roomOwner = e[l.ROOM_OWNER] || null,
            i.roomOwnerAvatar = e[l.ROOM_OWNER_AVATAR] || null,
            i.roomOwnerFirstName = e[l.ROOM_OWNER_FIRST_NAME] || null,
            i.roomOwnerLastName = e[l.ROOM_OWNER_LAST_NAME] || null;
            var s = e[l.CONFERENCE_DATA] || null;
            return s ? (s = JSON.parse(s),
            i.conferenceData = {
                ownerId: s[0],
                guestId: s[1],
                invitationTs: s[2]
            }) : i.conferenceData = null,
            i.radioJson = e[l.RADIO],
            i.sid = e[l.SID],
            i.popularUid = e[l.POPULAR_UID],
            i.wastefulUid = e[l.WASTEFUL_UID],
            i.djUid = e[l.DJ],
            i.fortunateUid = e[l.FORTUNATE_UID],
            i.versionOfLastChange = e[l.VERSION_OF_LAST_CHANGE],
            i.roomQueue = g(e[l.ROOM_QUEUE]),
            i.accessDescr = e[l.ROOM_ACCESS_DESCR] ? _(e[l.ROOM_ACCESS_DESCR]) : {},
            i
        },
        parseRound: v,
        parseUser: c,
        parseRoundAnswers: p,
        parseRoundQuestion: f,
        parseExitReason: C,
        parseUserWithPhoto: h,
        parseGifts: function(e) {
            return o.fromArray(e)
        },
        parsePrivateMessages: function(e) {
            return d.fromArray(e)
        },
        getRoomId: function(e) {
            return e[l.ROOM_ID]
        }
    })
}(),
function() {
    var y;
    app.controllers.ExpController = function(e) {
        if (y)
            return y;
        e = e || {};
        var n = y = this;
        window.expController = this;
        var a = lilo.createView("exp-line")
          , s = {
            min: 0,
            max: 0,
            progress: -1,
            remainder: 0,
            exp: e.exp || 0,
            realExp: e.exp || 0,
            boosterEnabled: !1,
            boosterEstimatedTs: 0,
            boosterLeftTime: 0,
            boosterMultiplierX10Enabled: !1
        };
        app.isBoosterEnabled = function() {
            return s.boosterEnabled
        }
        ,
        a.setModel(s),
        app.makeEventDispatcher(this),
        this.applyBooster = function(e) {
            return s.boosterEnabled ? e * (s.boosterMultiplierX10Enabled ? 10 : 2) : e
        }
        ,
        this.EVENTS = {
            EXP_CHANGED: 1
        },
        s.onChange("exp", function() {
            n.trigger(n.EVENTS.EXP_CHANGED, {
                exp: s.exp
            }),
            app.eventBus.trigger(app.EVENTS.VIEWER_EXP_CHANGED, {
                exp: s.exp
            })
        }),
        this.setRoomView = function(e) {
            var t;
            isMobi ? headerView.els["exp-container"].append(a.el) : ((t = e.els["exp-line"][0].childNodes[0]).parentNode.removeChild(t),
            e.els["exp-line"].append(a.el),
            a.el.append(t))
        }
        ;
        var i = "disable-progress-transition";
        this.setExp = function(e) {
            var t = this.calcMinLevelAndProgress(e);
            a.el.addClass(i),
            s.setAttr({
                remainder: t.remainder,
                exp: e
            }),
            s.setAttr({
                min: t.level,
                max: t.level + 1,
                progress: t.progress,
                realExp: e
            }),
            setTimeout(function() {
                a.el.removeClass(i)
            }, 0)
        }
        ;
        var o = null;
        var r = null;
        function l(e) {
            var t, i;
            s.exp + e > s.realExp ? console.info("exp error1") : (t = n.calcMinLevelAndProgress(s.exp + e),
            i = s.min,
            s.setAttr({
                remainder: t.remainder,
                exp: s.exp + e
            }),
            s.setAttr({
                min: t.level,
                max: t.level + 1,
                progress: t.progress
            }),
            t.level > i && (app.eventBus.trigger(app.EVENTS.VIEWER_LEVEL_CHANGED, {
                level: t.level
            }),
            d = t.level,
            clearTimeout(r),
            r = setTimeout(function() {
                api.roomV3.chat.newLevel({
                    exp: s.exp
                }, function(e, t) {}).send()
            }, 1e3)),
            o || roomModel && (o = roomModel.getViewer()),
            o && o.setAttr({
                exp: s.exp
            }))
        }
        this.setRealExp = function(e) {
            s.realExp < e && s.setAttr({
                realExp: e
            })
        }
        ,
        this.getCurrentExp = function() {
            return s.exp
        }
        ;
        var d = -1;
        this.getCurrentLevel = function() {
            return -1 !== d ? d : d = this.calcMinLevelAndProgress(s.exp).level
        }
        ;
        var c = function() {
            var a = [];
            app.levelsData.each(function(e, t) {
                a.push({
                    level: t[0],
                    min: t[1],
                    max: t[2]
                })
            });
            var t = (a = a.sort(function(e, t) {
                return e.level > t.level ? 1 : -1
            })).lastEl()
              , s = Math.floor
              , r = function(e, t, i) {
                var n = t + s((i - t) / 2)
                  , o = a[n];
                return o.min <= e && e <= o.max ? o : o.min > e ? r(e, t, n) : r(e, n, i)
            };
            return {
                findRangeByExp: function(e) {
                    return e > t.max ? a[0] : r(e, 0, a.length)
                },
                getExpOfLevel: function(e) {
                    return a[e].min
                }
            }
        }();
        this.calcMinLevelAndProgress = function(e) {
            isNaN(e) && (e = 0,
            GA("AppError", "Critical error", "Invalid exp"));
            var t = c.findRangeByExp(e)
              , i = t.max + 1
              , n = t.min;
            return {
                level: t.level,
                next: i,
                exp: e,
                remainder: i - e,
                progress: (e - n) / (i - n) * 100
            }
        }
        ;
        var t, u, p, f, m, v = (p = !(u = []),
        f = function() {
            p = !1,
            m()
        }
        ,
        m = function() {
            var e;
            u.length && (e = u.shift(),
            p = !0,
            roomView.animateExpBonus(app.info.viewer_id, e, 2e3, function() {
                l(e)
            }),
            clearTimeout(t),
            t = setTimeout(f, 500))
        }
        ,
        function(e) {
            u.push(e),
            p || m()
        }
        );
        this.animateBonusByType = function(e, t) {
            if (!(t <= 0 || s.exp + t > s.realExp))
                if (!isMobi && IS_DESKTOP)
                    switch (e) {
                    case 1:
                    case 2:
                        l(t)
                    }
                else
                    l(t)
        }
        ,
        this.animateBonus = function(e) {
            var t, i, n, o = e.incValue;
            o <= 0 || s.exp + o > s.realExp ? console.info("exp error") : ((t = {})[app.info.hasOrders ? "exp_per_user1" : "exp_per_user2"] = o,
            cAnal.trackEvent(t),
            roomView && roomView.isVisible && !e.disableAnimation ? isMobi ? v(o) : (i = $(document.createElement("div")).addClass("item-exp-bonus pe-none " + (s.boosterEnabled ? s.boosterMultiplierX10Enabled ? "x10" : "x2" : "")).text("+" + o),
            e = e.sourceOffset || {
                left: 0,
                top: 0
            },
            n = a.getProgressAbsoluteCoordinates(s.progress),
            console.info("offsets", e, n, e.left - n.leftOffset, e.top - n.topOffset),
            i.css({
                transform: "translate(" + (e.left - n.leftOffset) + "px," + (e.top - n.topOffset) + "px)"
            }).addClass("animated").appendTo(a.els.progressbar),
            setTimeout(function() {
                i.css({
                    transform: "translate(" + n.left + "px," + (n.top - 12) + "px)"
                }),
                setTimeout(function() {
                    i.remove(),
                    l(o),
                    app.soundManager.play(app.soundManager.SOUND_IDS.RATING_PROGRESS)
                }, 2e3)
            }, 80)) : l(o))
        }
        ,
        this.setExp(s.realExp),
        this.expToLevel = function(e) {
            return this.calcMinLevelAndProgress(e).level
        }
        ,
        this.levelToExp = function(e) {
            return c.getExpOfLevel(e)
        }
        ;
        function h(e) {
            clearInterval(b);
            var t = +new Date
              , t = (e = t + e) - t;
            s.setAttr({
                boosterEnabled: 6e4 < t,
                boosterEstimatedTs: e,
                boosterLeftTime: t
            }),
            s.boosterEnabled && (b = setInterval(C, 3e4),
            C())
        }
        var g = function(e) {
            e = e && e.level ? e.level : n.getCurrentLevel();
            s.setAttr({
                boosterMultiplierX10Enabled: 0 < e && e % 10 == 0
            })
        }
          , b = null
          , C = function() {
            var e = s.boosterEstimatedTs - +new Date;
            e < 0 && (e = 0,
            clearInterval(b),
            w()),
            s.setAttr({
                boosterLeftTime: e
            })
        }
          , _ = !1
          , w = function() {
            _ || (_ = !0,
            ServerApi("user/expbooster/status.php", {}, function(e, t) {
                _ = !1,
                e ? dialogController.fadePopup("Не удалось выполнить запрос") : h(t.leftMillis)
            }))
        };
        h(e.expBoosterLeftTime || 0),
        g(),
        app.eventBus.on(app.EVENTS.VIEWER_LEVEL_CHANGED, g);
        function E(e) {
            dialogController.subscribe({
                dialogClass: "v-2 exp-booster",
                dialogOpts: {
                    dialogClass: "small-close no-padding"
                },
                model: {
                    title: 'Ускоритель уровня<br><div class="sub-title">Получайте в x10 больше опыта, когда вы находитесь на уровне, заканчивающемся на 0 (например, 10, 20, 30 .. 150 и так далее) и х2 раза больше опыта, когда вы находитесь на любых других уровнях в течение срока действия бонуса</div>',
                    descriptions: [{
                        title: "<b>3 дня</b>",
                        price: 750,
                        rubies: !0,
                        anal_item_name: "eb3"
                    }, {
                        title: "<b>7 дней</b>",
                        price: 1500,
                        rubies: !0,
                        anal_item_name: "eb7"
                    }]
                },
                onOk: function(i) {
                    return ServerApi("user/expbooster/buy.php", {
                        price: i.price
                    }, function(e, t) {
                        w(),
                        util.isDef(t.ruby) && app.balanceModel.setAttr({
                            ruby: t.ruby
                        }),
                        e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit, {
                            currency: 2
                        }) : e.code === Codes.ALREADY_EXIST ? dialogController.fadePopup(window.ODR ? "Вы уже покупали услугу" : "Вы уже покупали подписку") : dialogController.showError(e) : (dialogController.open(lilo.createView("dialog-exp-booster-success-purchase"), {
                            dialogClass: "small-close no-padding"
                        }),
                        (e = {})[i.anal_item_name] = 1,
                        cAnal.trackEvent(e))
                    }),
                    !1
                }
            })
        }
        isMobi ? (headerView.bind("exp-booster", function() {
            s.boosterEnabled ? dialogController.fadePopup("Ускоритель уровня уже активирован") : E()
        }),
        s.onChange("boosterEnabled", g = function() {
            headerView.updateExpBooster(s.boosterEnabled)
        }
        ),
        g()) : a.bind("enable-exp-booster", E)
    }
}(),
app.controllers.RoomTopListController = function(e) {
    var c = e.roomController
      , u = e.roomView
      , p = e.roomModel
      , i = p.getViewer()
      , f = new app.controllers.RoomResponseParser
      , g = app.info.viewer_id
      , e = (app.info.sex,
    "room-top-list-wrap")
      , n = lilo.createView(e)
      , o = {
        tabId: 1
    };
    n.setModel(o),
    n.on("show-tab:" + e, function(e) {
        o.setAttr({
            tabId: parseInt(e.extraData.index, 10)
        })
    });
    function a(e, t, i, n) {
        return app.RoomTopListRewards[e][t][i][n]
    }
    var e = function(o) {
        var e = lilo.createView("room-top-list")
          , f = 10
          , m = {
            __isInit: !1,
            __viewer: i,
            pending: !1,
            bySentGifts: [],
            byReceivedGifts: [],
            byLotteryWins: [],
            positionByReceivedGifts: -1,
            positionBySentGifts: -1,
            positionByLotteryWins: -1,
            selfReceivedGifts: -1,
            selfSentGifts: -1,
            selfExp: -1,
            selfLotteryWins: -1,
            receivedGiftsPopupHtml: "",
            sentGiftsPopupHtml: "",
            expPopupHtml: "",
            lotteryWinsPopupHtml: ""
        };
        o.viewerSentGiftsPropertyName,
        o.viewerReceivedGiftsPropertyName,
        o.viewerExpPropertyName,
        o.viewerLotteryWinsPropertyName;
        e.setModel(m),
        e.el.appendTo(o.$container);
        var t, v = (t = o.timeFormatter,
        {
            start: function(e) {
                !function(e) {
                    clearTimeout(void 0),
                    e < 0 && (e = 0);
                    e = util.formatMillisToTime(e, t);
                    o.$leftTimeEl.html(e)
                }(e)
            }
        });
        function h(e) {
            this.uid = e[0],
            this.countOfSentGifts = e[1],
            this.countOfReceivedGifts = e[2],
            this.age = e[3],
            this.expPerPeriod = e[4],
            this.avatar = e[5],
            this.lotteryWinsPerPeriod = e[6],
            this.vf = e[7],
            this.firstName = "",
            this.popupHtmlText = ""
        }
        h.fromArray = function(e, i) {
            var n = [];
            return $.each(e, function(e, t) {
                t = new h(t);
                t.winValue = o.calcWinValue(e, i),
                n.push(t)
            }),
            n
        }
        ,
        e.on("show-profile:item-room-top-list", function(e) {
            e = e.extraData.model.uid;
            app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: e,
                referrer: GuestReferrer.ROOM_TOP
            })
        }),
        this.onGetResult = function(e) {
            m.setAttr({
                pending: !1
            });
            var n, o, a, s, r, l, t = h.fromArray(e.byReceivedGifts, "popular").slice(0, f), i = h.fromArray(e.bySentGifts, "wastefull").slice(0, f), d = h.fromArray(e.byLotteryWins, "lottery").slice(0, f), c = e.positionByReceivedGifts, u = e.positionBySentGifts, p = e.positionByLotteryWins;
            v.start(e.leftTime),
            m.byReceivedGifts.removeAll(),
            m.byReceivedGifts.add(t),
            m.bySentGifts.removeAll(),
            m.bySentGifts.add(i),
            m.byLotteryWins.removeAll(),
            m.byLotteryWins.add(d),
            m.setAttr({
                positionByReceivedGifts: c,
                positionBySentGifts: u,
                positionByLotteryWins: p,
                selfReceivedGifts: e.selfReceivedGifts,
                selfSentGifts: e.selfSentGifts,
                selfExp: e.selfExp,
                selfLotteryWins: e.selfLotteryWins
            }),
            -1 !== m.positionBySentGifts && (n = m.selfSentGifts,
            o = "Всего <b>{0}</b>".format(n, util.pluralize(n, {
                one: "подарок",
                two: "подарка",
                many: "подарков"
            })),
            m.setAttr({
                sentGiftsPopupHtml: o
            }),
            $.each(m.bySentGifts, function(e, t) {
                var i = t.countOfSentGifts - n;
                t.uid === g || e === m.positionBySentGifts ? t.setAttr({
                    popupHtmlText: o
                }) : m.positionBySentGifts > e ? t.setAttr({
                    popupHtmlText: "Чтобы попасть сюда, нужно сделать еще <b>{0}</b> {1}<div>Всего <b>{2}</b></div>".format(i = i < 0 ? 0 : i, util.pluralize(i, {
                        one: "подарок",
                        two: "подарка",
                        many: "подарков"
                    }), t.countOfSentGifts)
                }) : (i = Math.abs(i),
                t.setAttr({
                    popupHtmlText: "Разница между вами <b>{0}</b> {1}<div>Всего <b>{2}</b></div>".format(i, util.pluralize(i, {
                        one: "подарок",
                        two: "подарка",
                        many: "подарков"
                    }), t.countOfSentGifts)
                }))
            })),
            -1 !== m.positionByReceivedGifts && (a = m.selfReceivedGifts,
            s = "Всего <b>{0}</b>".format(a, util.pluralize(a, {
                one: "подарок",
                two: "подарка",
                many: "подарков"
            })),
            m.setAttr({
                receivedGiftsPopupHtml: s
            }),
            $.each(m.byReceivedGifts, function(e, t) {
                var i = t.countOfReceivedGifts - a;
                t.uid === g || e === m.positionByReceivedGifts ? t.setAttr({
                    popupHtmlText: s
                }) : m.positionByReceivedGifts > e ? t.setAttr({
                    popupHtmlText: "Чтобы попасть сюда, нужно получить еще <b>{0}</b> {1}<div>Всего <b>{2}</b></div>".format(i = i < 0 ? 0 : i, util.pluralize(i, {
                        one: "подарок",
                        two: "подарка",
                        many: "подарков"
                    }), t.countOfReceivedGifts)
                }) : (i = Math.abs(i),
                t.setAttr({
                    popupHtmlText: "Разница между вами <b>{0}</b> {1}<div>Всего <b>{2}</b></div>".format(i, util.pluralize(i, {
                        one: "подарок",
                        two: "подарка",
                        many: "подарков"
                    }), t.countOfReceivedGifts)
                }))
            })),
            -1 !== m.positionByLotteryWins && (r = m.selfLotteryWins,
            l = "Всего <b>{0}</b>".format(r, util.pluralize(r, {
                one: "монету",
                two: "монеты",
                many: "монет"
            })),
            m.setAttr({
                lotteryWinsPopupHtml: l
            }),
            $.each(m.byLotteryWins, function(e, t) {
                var i = t.lotteryWinsPerPeriod - r;
                t.uid === g || e === m.positionByLotteryWins ? t.setAttr({
                    popupHtmlText: l
                }) : m.positionByLotteryWins > e ? t.setAttr({
                    popupHtmlText: "Чтобы попасть сюда, нужно выиграть еще <b>{0}</b> {1}<div>Всего <b>{2}</b></div>".format(i = i < 0 ? 0 : i, util.pluralize(i, {
                        one: "монету",
                        two: "монеты",
                        many: "монет"
                    }), t.lotteryWinsPerPeriod)
                }) : (i = Math.abs(i),
                t.setAttr({
                    popupHtmlText: "Разница между вами <b>{0}</b> {1}<div>Всего <b>{2}</b></div>".format(i, util.pluralize(i, {
                        one: "монета",
                        two: "монеты",
                        many: "монет"
                    }), t.lotteryWinsPerPeriod)
                }))
            }))
        }
        ,
        this.model = m
    }
      , t = new e({
        $container: n.els["daily-wrap"],
        viewerSentGiftsPropertyName: "sentGiftsPerDay",
        viewerReceivedGiftsPropertyName: "receivedGiftsPerDay",
        viewerExpPropertyName: "expPerDay",
        viewerLotteryWinsPropertyName: "lotteryWinsPerDay",
        calcWinValue: function(e, t) {
            var i = 17 < app.info.age ? "adult" : "teen";
            return a(i, t, "daily", e)
        },
        timeFormatter: function(e, t, i) {
            return "00" === t && "00" === e ? "Осталось меньше минуты" : "Осталось {0} ч. {1} мин.".format(e, t)
        },
        $leftTimeEl: n.els["day-left-time"]
    })
      , s = new e({
        $container: n.els["hourly-wrap"],
        viewerSentGiftsPropertyName: "sentGiftsPerHour",
        viewerReceivedGiftsPropertyName: "receivedGiftsPerHour",
        viewerExpPropertyName: "expPerHour",
        viewerLotteryWinsPropertyName: "lotteryWinsPerHour",
        calcWinValue: function(e, t) {
            var i = 17 < app.info.age ? "adult" : "teen";
            return a(i, t, "hourly", e)
        },
        timeFormatter: function(e, t) {
            return "00" === t && "00" === e ? "Осталось меньше минуты" : "Осталось {1} мин.".format(e, t)
        },
        $leftTimeEl: n.els["hour-left-time"]
    })
      , r = new function(o) {
        var e = "room-top-list-of-teems"
          , a = {
            pending: !0
        }
          , s = lilo.createView(e);
        s.setModel(a),
        s.el.appendTo(o.$container),
        s.on("show-profile:" + e, function(e) {
            e = e.extraData.uid;
            app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: e,
                referrer: GuestReferrer.ROOM_TOP
            })
        });
        var r = !1;
        function l(e) {
            this.roomId = e[0],
            this.spent = e[1];
            var e = d.fromArray(e[2])
              , i = []
              , n = [];
            e.each(function(e, t) {
                (t.isMale ? i : n).push(t)
            }),
            this.users = e,
            this.males = i,
            this.females = n
        }
        function d(e) {
            this.uid = e[0],
            this.firstName = e[1],
            this.avatar = e[2],
            this.age = e[3],
            this.exp = e[4],
            this.isMale = e[5],
            this.vf = !!e[6]
        }
        s.on("join-to-room:" + e, function(t) {
            var o = function() {
                var i, n, e = t.extraData.roomId;
                r || e === p.roomId || (r = !0,
                setTimeout(function() {
                    r = !1
                }, 1e3),
                i = p.roomId,
                p.roomId = null,
                isMobi || ajaxLoader.show(),
                n = !1,
                t.extraData.uids.each(function(e, t) {
                    if (app.services.vk.isFriend(t))
                        return !(n = !0)
                }),
                api.roomV3.getRoom({
                    force: !0,
                    target_room_id: e,
                    skip_restrictions: n
                }, function(e, t) {
                    isMobi || ajaxLoader.hide(),
                    e ? (e.code === Codes.TOO_FREQ_ROOM_SWITCH ? dialogController.showDialogRoomSwitchTooFreq(t ? t.left : 0, {
                        price: (t || {}).price,
                        paymentJoin: o
                    }) : e.code === Codes.LEAVE_FROM_CURRENT_ROOM_IS_NOT_ALLOWED ? c.onLeaveRoomIsNotAllowed(e.requestParams) : e.code === Codes.ROOM_ACCESS_DESCR ? dialogController.roomExpLimitDialog(t) : e.code === Codes.NOT_ENOUGH_EXP_TO_ADD_ROOM ? dialogController.showMessageDialog({
                        message: "У Вас недостаточно рейтинга, чтобы попасть в эту комнату"
                    }) : e.code === Codes.USER_IN_BLACK_LIST ? dialogController.showMessageDialog({
                        message: "Невозможно войти в комнату"
                    }) : e.code === Codes.ROOM_NOT_FOUND ? dialogController.showMessageDialog({
                        message: "Комната не найдена"
                    }) : e.code === Codes.ROOM_QUEUE_IS_FULL ? dialogController.showMessageDialog({
                        message: "Не удалось подключиться к комнате. Очередь заполнена"
                    }) : e.code === Codes.ACCESS_DENIED ? dialogController.showMessageDialog({
                        message: "Не удалось подключиться к комнате"
                    }) : e.code === Codes.BANNED ? dialogController.showAccessDeniedDialog(t) : e.code === Codes.NO_ACCESS_TO_ROOM ? dialogController.showNoAccessToRoom({
                        leftMillis: t.leftTime
                    }) : dialogController.showMessageDialog({
                        message: "Не удалось подключиться к комнате. Произошла ошибка. <br/>Code:" + e.code
                    }),
                    p.roomId = i,
                    c.checkLastChangesFromBuffer()) : (c.resetRoom(),
                    e = f.parse(t.roomData),
                    u.lockSwitchRoomBtns(),
                    c.roundLoadingController.stop(),
                    e.isSummary ? c.showQueue(e) : c.communicator.config.onGetRoom(t.roomData, t.gifts, t.changeId, !!t.canSendFreeNote),
                    isMobi && (t = u.el.offset().top,
                    isNaN(t) || socialApi.scrollWindow(t)))
                }).send())
            };
            o()
        }),
        l.fromArray = function(e) {
            var i = [];
            return e.each(function(e, t) {
                i.push(new l(t))
            }),
            i
        }
        ,
        d.fromArray = function(e) {
            var i = [];
            return e.each(function(e, t) {
                i.push(new d(t))
            }),
            i
        }
        ,
        this.onGetResult = function(e) {
            a.setAttr({
                pending: !1
            });
            var t = e.meta
              , i = -1
              , n = -1;
            t && (i = t.place,
            n = t.spent),
            c.roomQueueController.showRoomPlaceInTopList(i);
            t = JSON.parse(e.json),
            e = t[0],
            t = t[1];
            e < 0 && (e = 0);
            e = util.formatMillisToTime(e, o.timeFormatter);
            o.$leftTimeEl.html(e);
            t = l.fromArray(t);
            s.showRooms(t, i, n)
        }
        ,
        this.model = a
    }
    ({
        $container: n.els["teems-wrap"],
        timeFormatter: function(e, t) {
            return "00" === t && "00" === e ? "Осталось меньше минуты" : "Осталось {1} мин.".format(e, t)
        },
        $leftTimeEl: n.els["teems-left-time"]
    })
      , l = 0;
    $body.mousemove(function(e) {
        e.pageX,
        l = e.pageY
    });
    function d() {
        var e, t;
        u.isVisible && (e = n.el.offset().top,
        t = n.el.height(),
        e <= l && l <= e + t || (t = m.indexOf(o.tabId),
        ++t >= m.length && (t = 0),
        o.setAttr({
            tabId: m[t]
        })))
    }
    var m = [1, 0, 2];
    this.view = n,
    this.model = o,
    this.start = function() {
        o.__isInit || (o.__isInit = !0,
        t.model.setAttr({
            pending: !0
        }),
        s.model.setAttr({
            pending: !0
        }),
        r.model.setAttr({
            pending: !0
        }),
        app.eventBus.on(app.EVENTS.ON_GET_ROOM_TOP_LIST, function(e) {
            t.onGetResult(e.roomTopListByDays),
            s.onGetResult(e.roomTopListByHours),
            r.onGetResult(e.roomTopListByRooms)
        }),
        appCommunicator.getRoomTopList(),
        isMobi || setInterval(d, 1e4),
        u.els["top-list-area"].append(n.el))
    }
    ,
    this.stop = function() {
        0
    }
}
,
app.controllers.LotteryController = function(e) {
    var t = "lottery-view"
      , o = lilo.createView(t, {
        controller: this
    })
      , i = app.ROOM_STATE
      , a = "hide-el"
      , s = e.roomView
      , r = e.roomModel
      , l = app.info.viewer_id
      , d = {
        __maxNumbers: 15,
        __price: 1,
        __stateId: 1,
        __expBonusPerNumber: 5,
        viewerNumbers: [],
        numbersIsFilled: !1,
        multiplier: 1,
        winCombination: null,
        canBet: !1
    };
    function c() {
        return d.viewerNumbers.length ? d.multiplier + "_" + d.viewerNumbers.join("_") : "-1"
    }
    function n() {
        p ? f = !0 : ((new Date).getTime(),
        f = !1,
        r.setAttr({
            canSpendMoney: !1
        }),
        r.roomId && r.__communicator && (p = !0,
        webSocketController.sendMessage({
            action: "room/answer",
            r: r.roomId,
            q: r.roundQuestion.id,
            a: c()
        }, {}, function(e) {
            p = !1,
            console.info("lottery response", e);
            var t = e.code
              , i = e.data || {}
              , e = i.result;
            t === Codes.NOT_ENOUGH_BALANCE ? (app.balanceModel.setAttr({
                balance: i.balance
            }),
            C(),
            d.viewerNumbers.length = 0,
            d.setAttr({
                winCombination: null,
                multiplier: 1
            }),
            o.onViewerNumbersChanges(),
            w(),
            f = !0) : t === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : t === Codes.OK ? e && "SUCCESS" !== e && dialogController.fadePopup({
                duration: 3e3,
                message: "Произошла ошибка при сохранении ответа. ResultCode: " + e
            }) : dialogController.fadePopup({
                message: "Произошла ошибка при сохранении ответа. Code: " + t,
                duration: 3e3
            }),
            f && v()
        })))
    }
    (this.view = o).roomView = s,
    o.setModel(d),
    d.onChange("canBet", function() {
        o.el[d.canBet ? "removeClass" : "addClass"]("bet-lock")
    });
    var u, p = !1, f = !1, m = 300;
    function v() {
        clearTimeout(u),
        u = setTimeout(n, m)
    }
    function h(e) {
        r.state === i.STARTED && b(d.viewerNumbers.length, e) && d.multiplier !== e && (d.setAttr({
            multiplier: e
        }),
        v(),
        app.soundManager.play(app.soundManager.SOUND_IDS.LOTO_CLICK))
    }
    function g(e, t) {
        var i = d.__price
          , i = e < 2 ? 0 : e * t * i - i;
        return i
    }
    function b(e, t) {
        return !(g(e, t) > app.balanceModel.balance) || (C(),
        !1)
    }
    function C() {
        dialogController.fadePopup({
            message: "У Вас недостаточно средств для данной ставки",
            duration: 2500
        })
    }
    function _() {
        var s = {};
        if (r.usersBets) {
            try {
                $.each(r.usersBets, function(e, t) {
                    if (t && t.length) {
                        var i = parseInt(e, 10);
                        if (i !== l)
                            for (var n = t[1], o = 0; o < n.length; o += 1) {
                                var a = n[o];
                                (s[a] || (s[a] = [])).push(i)
                            }
                    }
                })
            } catch (e) {}
            try {
                var i = r.usersToHash();
                $.each(r.usersBets, function(e, t) {
                    e = i[e];
                    e && (t ? e.setAttr({
                        betNumbersString: "total_bet_value" + (g(t[1].length, t[0]) + 1)
                    }) : e.setAttr({
                        betNumbersString: ""
                    }))
                })
            } catch (e) {}
            try {
                o.updateNumbers(s)
            } catch (e) {}
        }
    }
    function w() {
        var e, i = null;
        $.each(r.usersBets, function(e, t) {
            if (parseInt(e, 10) === l)
                return i = t,
                !1
        }),
        i ? (e = i[1],
        d.viewerNumbers.length = 0,
        o.onViewerNumbersChanges(),
        d.viewerNumbers.add(e),
        d.setAttr({
            multiplier: i[0]
        })) : (d.setAttr({
            multiplier: 1
        }),
        d.viewerNumbers.length = 0,
        o.onViewerNumbersChanges()),
        o.updateViewOfViewerBets()
    }
    o.on("reset:" + t, function(e) {
        r.state === i.STARTED && d.canBet && (d.setAttr({
            multiplier: 1
        }),
        d.viewerNumbers.length = 0,
        o.onViewerNumbersChanges(),
        o.resetSelection(),
        v())
    }),
    o.on("select-multiplier:" + t, function(e) {
        d.canBet && h(e.extraData.multiplier)
    }),
    this.selectMultiplier = h,
    o.on("click-number:" + t, function(e) {
        if (r.state === i.STARTED && d.canBet) {
            var t = e.extraData.number
              , e = d.viewerNumbers.indexOf(t);
            if (-1 === e) {
                if (15 === d.viewerNumbers.length)
                    return void dialogController.fadePopup({
                        message: "Можно выбрать только 15 чисел",
                        duration: 2e3
                    });
                if (1 === d.viewerNumbers.length && expController.getCurrentLevel() < 5)
                    return void dialogController.fadePopup({
                        message: "Выбирать больше одного числа можно начиная с {0} уровня".format(5),
                        duration: 2e3
                    });
                if (!b(d.viewerNumbers.length + 1, d.multiplier))
                    return;
                d.viewerNumbers.add(t)
            } else
                d.viewerNumbers.splice(e, 1),
                o.onViewerNumbersChanges();
            1 === d.viewerNumbers.length && d.setAttr({
                multiplier: 1
            }),
            o.updateViewOfViewerBets(),
            v(),
            app.soundManager.play(app.soundManager.SOUND_IDS.LOTO_CLICK)
        }
    }),
    this.canChangeBet = b,
    this.calcTotalPrice = g,
    this.showNotEnoughBalanceNotification = C,
    this.onRoundStart = function() {
        d.__stateId++,
        d.setAttr({
            canBet: !0
        }),
        s.els["main-area"].append(o.el),
        o.els["left-area"].css("visibility", ""),
        o.els.numbers.css("visibility", ""),
        o.els["left-area"].removeClass(a),
        o.els.controls.removeClass(a),
        o.els["left-area"].removeClass("hide-el"),
        o.els.controls.removeClass("hide-el"),
        isMobi && o.onRoundStart(),
        o.els.numbers.css("visibility", ""),
        o.els["btn-max-bet"].removeClass("with-hide-animation").removeClass(a),
        o.els["btn-max-bet"].css("left", "0"),
        setTimeout(function() {
            o.els["btn-max-bet"].addClass("with-hide-animation"),
            app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW, {
                showTimer: !0
            }),
            isMobi && s.timerController.show()
        }, 0),
        o.resetNumbers(),
        d.viewerNumbers.length = 0,
        o.onViewerNumbersChanges(),
        d.setAttr({
            winCombination: null,
            multiplier: 1
        }),
        _(),
        w()
    }
    ,
    this.updateStartedState = function() {
        _()
    }
    ,
    this.applyAllBetsToNumbers = _,
    this.onRoundPause = function(e) {
        d.setAttr({
            canBet: !1
        }),
        e = e || $.noop,
        d.__stateId++;
        var t = d.__stateId;
        if (isMobi && o.onRoundComplete(),
        _(),
        w(),
        "-1" !== c())
            try {
                var i = r.winCombination
                  , n = util.collectArrayInObjectByProperty(d.viewerNumbers);
                d.multiplier;
                i.each(function(e, t) {
                    n[t] && 0
                })
            } catch (e) {}
        o.els["left-area"].addClass(a),
        o.els.controls.addClass(a),
        o.els["btn-max-bet"].css("left", ""),
        o.els["btn-max-bet"].addClass(a),
        setTimeout(function() {
            t === d.__stateId && (o.els["left-area"].css("visibility", "hidden"),
            o.els.controls.css("visibility", "hidden"),
            o.els["btn-max-bet"].removeClass("with-hide-animation"))
        }, 1e3),
        d.setAttr({
            winCombination: r.winCombination.join(",")
        }),
        o.animateWinCombination(function() {
            setTimeout(function() {
                var n, o, e;
                t === d.__stateId && r.lotteryResults && (n = r.usersToHash(),
                o = !1,
                $.each(r.lotteryResults, function(e, t) {
                    var i = n[t.uid];
                    i && (0 < t.winValue && (o = !0),
                    i.setAttr({
                        betNumbersString: "winValue_" + t.winValue + "_" + t.winCurrency
                    }),
                    t.uid === l && (t.betValue && moneyBox.sync(),
                    t.expBonus && setTimeout(function() {
                        expController.animateBonus({
                            incValue: t.expBonus,
                            sourceOffset: isMobi ? {
                                left: 200,
                                top: 400
                            } : {
                                left: 365,
                                top: 300
                            }
                        })
                    }, 0),
                    0 < t.winValue && ((i = r.getViewer()) && i.setAttr({
                        lotteryWinsPerHour: i.lotteryWinsPerHour + t.winValue,
                        lotteryWinsPerDay: i.lotteryWinsPerDay + t.winValue
                    })),
                    app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW, {
                        showLotteryWin: !0,
                        data: t
                    })))
                }),
                o && app.soundManager.play(app.soundManager.SOUND_IDS.COINS_DROP),
                r.setAttr({
                    canSpendMoney: !0
                }),
                roomController.handlePopularityOfUsers(),
                e = r.__messageOfNewFortunateUser,
                r.__messageOfNewFortunateUser = null,
                e && e.from === r.fortunateUid && s.addChatMessages([e]))
            }, 3e3)
        }),
        s.elsMap.$questionText.hide(),
        s.elsMap.$timer.hide(),
        s.stopTimer();
        i = o.el[0].parentNode;
        i && i === s.els["main-area"][0] || s.els["main-area"].append(o.el)
    }
    ,
    this.updatePausedState = function() {}
    ,
    this.setCanBet = function(e) {
        d.setAttr({
            canBet: !!e
        })
    }
    ,
    this.stop = function() {
        o.el.detach(),
        d.__stateId++
    }
}
,
app.controllers.RadioController = function(e) {
    var a = this
      , l = app.info.viewer_id
      , s = e.roomModel
      , r = e.roomView
      , o = app.ROUND_TYPE
      , d = new app.controllers.SoundController
      , t = "radioVolume"
      , i = "closeRadio"
      , n = isMobi ? 100 : parseInt(util.lStorage.find(t), 10)
      , c = {}
      , u = {}
      , p = "radio-view"
      , e = "item-track"
      , f = lilo.createView(p)
      , m = 0
      , v = {
        items: [],
        type: null,
        __currentTrack: null,
        __alreadyVote: !1,
        __alreadyCoolLike: !1,
        __stateId: 1,
        hasCurrentTrack: !1,
        isDisabled: !!util.lStorage.find(i),
        isNotEnabled: !1,
        ytReady: !1,
        vkReady: !1,
        ownerAvatar: "",
        ownerFullName: "",
        ownerExp: 0,
        artist: "",
        title: "",
        volume: 0,
        __prevVolume: 0,
        progressAsMillis: 0,
        currentProgressAdMillis: 0,
        durationAsMillis: 0,
        isAdded: !1,
        positiveVotes: 0,
        negativeVotes: 0,
        coolLikes: 0,
        canAddTrack: !0,
        showList: !1,
        muted: !1,
        __waiting: !1,
        indexOfSelfTrack: -1,
        pending: !1
    };
    util.isDef(n) && !isNaN(n) || (n = 50),
    v.volume = v.__prevVolume = n,
    window.radioModel = v,
    window.radioView = f,
    0 === v.__prevVolume && (v.__prevVolume = 10),
    f.setModel(v),
    app.youtubePlayer && app.youtubePlayer.setRectEl(f.els["yt-rect"]),
    v.onChange("volume", function() {
        util.lStorage.save(t, v.volume)
    });
    var h = !1;
    a.canExtendWindowForOKPlatform = function() {
        return h
    }
    ,
    v.onChange("type", function() {
        d.setPlayerType(v.type),
        v.type === RadioPlayerType.YOUTUBE && g(),
        util.isOKPlatform() && (h = v.type === RadioPlayerType.YOUTUBE,
        roomController.updateWidth(),
        r.els["audio-player-el"][h ? "show" : "hide"]()),
        A()
    }),
    v.onChange("hasCurrentTrack", function() {
        app.youtubePlayer && (app.youtubePlayer.model.setAttr({
            hasTrack: v.hasCurrentTrack
        }),
        app.youtubePlayer._processVisibility())
    });
    var g = function() {
        app.youtubePlayer.model.setAttr({
            enabled: !v.isDisabled && v.type === RadioPlayerType.YOUTUBE
        })
    };
    v.onChange("isDisabled", g),
    g(),
    a.getType = function() {
        return v.type
    }
    ,
    a.updateVotes = function(e, t, i, n) {
        v.__currentTrack && v.__currentTrack.started === e && v.setAttr({
            positiveVotes: i,
            negativeVotes: t,
            coolLikes: n
        })
    }
    ,
    a.interruptCurrentTrack = function(e) {
        var t, i, n, o, a, s = v.__currentTrack;
        s && s.started === e && (t = v.volume,
        i = t / 30,
        n = t,
        o = function() {
            v.volume === t && d.setVolume(t)
        }
        ,
        (a = function() {
            v.__currentTrack && v.__currentTrack.started === e ? (n -= i) <= 0 ? (n = 0,
            d.closeMusicStream(),
            o()) : (d.setVolume(n),
            setTimeout(a, 100)) : o()
        }
        )())
    }
    ,
    a.updateTracks = function(e) {
        S(M.fromArray(e)),
        v.__currentTrack ? v.items.length ? v.setAttr({
            showList: !0
        }) : v.setAttr({
            showList: !1
        }) : v.setAttr({
            hasCurrentTrack: !1,
            showList: !1
        })
    }
    ,
    a.update = function(e, t) {
        var i, n = {
            type: (i = t ? e : JSON.parse(e))[0],
            tracks: M.fromArray(i[1]),
            currentTrack: function(e) {
                return e ? new O(e) : null
            }(i[2])
        };
        S(n.tracks),
        v.setAttr({
            type: n.type
        }),
        n.currentTrack ? (t = v.__currentTrack,
        e = v.__currentTrack = n.currentTrack,
        m = e.started,
        v.setAttr({
            isAdded: (i = e.audioOwnerId,
            n = e.audioId,
            i === l || c[i + "_" + n] || !!((n = e) && n.ytId && u[n.ytId])),
            ownerAvatar: e.avatar,
            ownerFullName: e.fullName || "",
            ownerExp: e.exp || 0,
            title: e.title,
            artist: e.artist,
            progressAsMillis: e.progressAsMillis,
            durationAsMillis: e.durationAsMillis,
            positiveVotes: e.positiveVotes,
            negativeVotes: e.negativeVotes,
            coolLikes: e.coolLikes
        }),
        (!v.hasCurrentTrack || t && t.started !== e.started) && (v.setAttr({
            muted: !1
        }),
        v.__alreadyVote = !1,
        v.__alreadyNegativeVote = !1,
        v.__alreadyCoolLike = !1,
        f.onTrackChange(),
        A()),
        v.setAttr({
            hasCurrentTrack: !0
        }),
        v.items.length ? v.setAttr({
            showList: !0
        }) : v.setAttr({
            showList: !1
        })) : (v.__currentTrack && d.closeMusicStream(),
        v.__currentTrack = null,
        v.setAttr({
            hasCurrentTrack: !1,
            showList: !1
        }))
    }
    ,
    a.clear = function() {
        v.__currentTrack && d.closeMusicStream(),
        v.__currentTrack = null,
        v.items.removeAll(),
        v.setAttr({
            hasCurrentTrack: !1,
            pending: !1,
            showList: !1
        })
    }
    ,
    f.on("add-track:" + p, function(e) {
        var n;
        v.pending || (e = e.extraData.withPayment,
        n = e ? 10 : v.type === RadioPlayerType.YOUTUBE ? 2 : 0,
        s.roundType !== o.LOTTERY || s.canSpendMoney ? (e = new app.controllers.dialog.AudiosList({
            cropBeforeSubmit: !0,
            type: v.type,
            price: n,
            submitBtnInnerHtml: e ? "<span>Подтвердить</span>&nbsp;&nbsp;<b>{0}</b><i class='coin-icon-el'></i>".format(n) : "",
            onSubmit: function(e) {
                var t, i;
                s.roundType !== o.LOTTERY || s.canSpendMoney ? (t = app.balanceModel.balance - n) < 0 ? dialogController.showInsufficientlyBalanceDialog(t) : app.balanceModel.canChange() && (i = e,
                e = n,
                s.roomId && (v.setAttr({
                    pending: !0
                }),
                s.__communicator.addRadioTrack({
                    roomId: s.roomId,
                    audio: i,
                    price: e
                }, function(e, t) {
                    v.setAttr({
                        pending: !1
                    }),
                    t && util.isDef(t.balance) && app.balanceModel.setAttr({
                        balance: t.balance
                    }),
                    e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : dialogController.fadePopup({
                        message: "Ошибка. Не получается добавить этот " + util.radioText("трек", "клип")
                    }) : (dialogController.fadePopup({
                        message: i.youtube ? "Клип добавлен в список" : "Аудиозапись добавлена в список"
                    }),
                    i.youtube ? cAnal.trackEvent({
                        r2: 1
                    }) : cAnal.trackEvent({
                        r1: 1
                    }))
                }))) : dialogController.lotteryIsActiveDialog()
            },
            maxDuration: 360
        }),
        isMobi && (dialogController.close(f),
        e.dialogWindow.onRemove(function() {
            dialogController.open(f, {
                mobiFullHeight: 1
            }),
            f.updateHeight()
        }))) : dialogController.lotteryIsActiveDialog())
    }),
    f.on("disable-radio:" + p, function(e) {
        d.closeMusicStream(),
        v.setAttr({
            isDisabled: !0
        }),
        util.lStorage.save(i, 1)
    }),
    f.on("enable-radio:" + p, function(e) {
        v.setAttr({
            isDisabled: !1
        }),
        util.lStorage.remove(i);
        var t = s.getCtm() - m;
        0 < t && t <= v.durationAsMillis && v.setAttr({
            progressAsMillis: t
        }),
        A()
    });
    function b(e, t) {
        e && (v.__alreadyCoolLike = !0),
        v.__alreadyVote = !0,
        e || t || (v.__alreadyNegativeVote = !0),
        v.__currentTrack && (util.lStorage.save(_, v.__currentTrack.started),
        e && util.lStorage.save(w, v.__currentTrack.started))
    }
    function C(e) {
        var t = v.__alreadyVote || v.__currentTrack && v.__currentTrack.started + "" === util.lStorage.find(_);
        return t && e && (t = v.__alreadyCoolLike || v.__currentTrack && v.__currentTrack.started + "" === util.lStorage.find(w)),
        (t = e && v.__alreadyNegativeVote ? !0 : t) && dialogController.fadePopup({
            message: "Можно голосовать только 1 раз за песню",
            duration: 2e3
        }),
        t
    }
    var _ = "radio.voted-track-id"
      , w = "radio.cool-voted-track-id";
    f.on("cool:" + p, function(e) {
        var t, i;
        v.pending || v.__coolIsSending || s.roomId && (C(!0) || (t = function(i) {
            var n = v.__currentTrack.started;
            v.setAttr({
                pending: !0
            }),
            v.__coolIsSending = !0;
            var o = s.roomId;
            api.roomV3.radio.cool({
                roomId: o,
                uid: v.__currentTrack.uid
            }, function(e, t) {
                v.__coolIsSending = !1,
                v.setAttr({
                    pending: !1
                }),
                s.roomId === o && (v.__currentTrack.started !== n || e || (b(!0),
                cAnal.trackEvent(i ? {
                    kt_free: 1
                } : {
                    kt_fee: 1
                }))),
                util.isDef(t.balance) && app.balanceModel.setAttr({
                    balance: t.balance
                }),
                e && (e.code === Codes.LIMIT ? (t = "Вы послали максимальное количество лайков этому пользователю. Попробуйте завтра.",
                v.__currentTrack && v.__currentTrack.uid === l && (t = "Вы послали себе максимальное количество лайков. Попробуйте завтра."),
                dialogController.fadePopup({
                    message: t,
                    duration: 4e3
                })) : e.code === Codes.LOTTERY_IS_ACTIVE && dialogController.lotteryIsActiveDialog())
            }).send()
        }
        ,
        util.currentMillis() < app.info.superLikeTs ? t(!0) : (i = lilo.createView("dialog-add-cool-like"),
        dialogController.open(i),
        i.bind("submit", function() {
            var e = app.balanceModel.balance - 5;
            e < 0 ? dialogController.showInsufficientlyBalanceDialog(e) : t(),
            dialogController.close(i)
        }),
        i.bind("subscribe", function() {
            app.openSuperLikeDialog(),
            dialogController.close(i)
        }),
        i.bind("cancel", function() {
            dialogController.close(i)
        }))))
    }),
    f.on("vote:" + p, function(i) {
        var n;
        v.pending || v.__voteIsSending || s.roomId && (n = v.__currentTrack.started,
        C() || (v.setAttr({
            pending: !0
        }),
        v.__voteIsSending = !0,
        s.__communicator.voteRadioTrack({
            roomId: s.roomId,
            vote: i.extraData.value
        }, function(e, t) {
            v.__voteIsSending = !1,
            v.setAttr({
                pending: !1
            }),
            v.__currentTrack.started !== n || e || b(!1, i.extraData.value)
        })))
    });
    function E(e) {
        var t = app.balanceModel.balance - 5;
        t < 0 ? dialogController.showInsufficientlyBalanceDialog(t) : s.roomId && (v.setAttr({
            pending: !0
        }),
        s.__communicator.raiseRadioTrack({
            roomId: s.roomId,
            id: e.id
        }, function(e, t) {
            v.setAttr({
                pending: !1
            }),
            e ? e.code === Codes.NOT_ENOUGH_BALANCE ? (app.balanceModel.setAttr({
                balance: t.balance
            }),
            dialogController.showInsufficientlyBalanceDialog(t.deficit)) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : dialogController.fadePopup({
                message: "Ошибка. Не удалось выполнить запрос"
            }) : t && app.balanceModel.setAttr({
                balance: t.balance
            })
        }))
    }
    f.on("raise:" + e, function(e) {
        v.pending || app.balanceModel.canChange() && E(e.extraData.model)
    });
    function y(e) {
        v.setAttr({
            pending: !0
        }),
        s.__communicator.removeRadioTrack({
            roomId: s.roomId,
            id: e.id
        }, function(e, t) {
            v.setAttr({
                pending: !1
            })
        })
    }
    f.on("delete:" + e, function(e) {
        v.pending || y(e.extraData.model)
    });
    function D(i) {
        var e = new app.controllers.dialog.AudiosList({
            cropBeforeSubmit: !0,
            onSubmit: function(e) {
                var t;
                t = i.id,
                e = e,
                s.roomId && (v.setAttr({
                    pending: !0
                }),
                s.__communicator.replaceRadioTrack({
                    id: t,
                    audio: e,
                    roomId: s.roomId,
                    duration: e.duration,
                    title: e.title,
                    artist: e.artist,
                    audio_owner_id: e.owner_id,
                    audio_id: e.id
                }, function(e, t) {
                    v.setAttr({
                        pending: !1
                    }),
                    e ? dialogController.fadePopup({
                        message: "Ошибка. Не получается добавить этот " + util.radioText("трек", "клип")
                    }) : dialogController.fadePopup({
                        message: v.type === RadioPlayerType.YOUTUBE ? "Клип заменён" : "Аудиозапись заменена"
                    })
                }))
            },
            maxDuration: 360
        });
        isMobi && (dialogController.close(f),
        e.dialogWindow.onRemove(function() {
            dialogController.open(f),
            f.updateHeight()
        }))
    }
    var T;
    function S(e) {
        var t = v.items.length !== e.length;
        if (!t)
            for (var i = 0, n = v.items.length; i < n; i += 1) {
                var o = v.items[i]
                  , a = e[i];
                if (o.uid !== a.uid || o.type !== a.type || !(o.audioId === a.audioId && o.type === RadioPlayerType.VK_AUDIO || o.ytId === a.ytId && o.type === RadioPlayerType.YOUTUBE)) {
                    t = !0;
                    break
                }
            }
        if (t) {
            for (var s = !1, r = -1, i = 0, n = e.length; i < n; i += 1)
                (o = e[i]).place = i + 1,
                o.uid !== l || s || (s = !0,
                r = i);
            v.setAttr({
                indexOfSelfTrack: r
            }),
            v.items.removeAll(),
            v.items.add(e)
        }
    }
    function A(t) {
        var e, i, n, o, a, s, r;
        clearTimeout(T),
        v.isDisabled || v.__waiting || v.type === RadioPlayerType.VK_AUDIO && isMobi && !isDirect || (t = t || 1,
        (e = v.__currentTrack) && (v.__stateId++,
        e.type === RadioPlayerType.VK_AUDIO && v.type === e.type && v.vkReady ? (i = v.__stateId,
        n = e.audioId,
        e.uid,
        o = e.audioOwnerId,
        a = e.title,
        s = e.durationAsMillis,
        r = e.artist,
        v.setAttr({
            currentProgressAdMillis: 0
        }),
        app.services.vk.getAudio(n, o, r, a, s, function(e) {
            v.isDisabled || i === v.__stateId && (e ? I(e.url) : (1 === t && dialogController.fadePopup({
                message: v.type === RadioPlayerType.YOUTUBE ? "Не удалось воспроизвести клип" : "Не удалось воспроизвести аудиозапись",
                duration: 2e3
            }),
            t < 5 && (T = setTimeout(function() {
                i === v.__stateId && A(t + 1)
            }, 3e3))))
        })) : e.type === RadioPlayerType.YOUTUBE && v.type === e.type && v.ytReady && I(e.ytId)))
    }
    function I(e, t) {
        var i, n;
        (app.mp3playerIsInit && v.type === RadioPlayerType.VK_AUDIO || v.type === RadioPlayerType.YOUTUBE && app.youtubePlayer.ready) && (t = t || 1,
        i = v.__stateId,
        v.setAttr({
            currentProgressAdMillis: 0
        }),
        0 < (n = s.getCtm() - m) && n <= v.durationAsMillis && v.setAttr({
            progressAsMillis: n
        }),
        d.playSound({
            url: e,
            volume: v.muted ? 0 : v.volume,
            position: v.progressAsMillis,
            onError: function() {
                i === v.__stateId && (v.isDisabled || (1 === t && dialogController.fadePopup({
                    message: "Не удалось воспроизвести аудиозапись",
                    duration: 2e3
                }),
                t < 5 && setTimeout(function() {
                    v.__stateId === i && I(e, t + 1)
                }, 2e3)))
            },
            onComplete: function() {
                isMobi && v.setAttr({
                    currentProgressAdMillis: v.durationAsMillis
                })
            },
            onUpdate: function(e) {
                v.__waiting || v.setAttr({
                    currentProgressAdMillis: e
                })
            }
        }))
    }
    function M(e) {
        this.type = e[0],
        this.id = e[1],
        this.uid = e[2],
        this.firstName = e[3],
        this.age = e[4],
        this.exp = e[5],
        this.avatar = e[6],
        this.durationAsMillis = e[7];
        this.type === RadioPlayerType.VK_AUDIO ? (this.audioId = e[8],
        this.audioOwnerId = e[9],
        this.artist = e[10],
        this.title = e[11],
        this.fullName = this.firstName + " " + this.age,
        this.fullTitle = this.artist + " - " + this.title,
        75 < this.fullName.length + this.fullTitle.length && (this.fullTitle = this.fullTitle.substr(0, 75 - this.fullName.length))) : (this.ytId = e[8],
        this.title = e[9],
        this.thumbnail = e[10],
        this.fullTitle = this.title,
        this.fullName = this.firstName + " " + this.age)
    }
    function O(e) {
        var t = new M(e[0]);
        this.started = e[1],
        this.progressAsMillis = e[2],
        this.positiveVotes = e[3],
        this.negativeVotes = e[4],
        this.coolLikes = e[5],
        $.extend(this, t),
        this.artist = this.artist || ""
    }
    f.on("change:" + e, function(e) {
        v.pending || D(e.extraData.model)
    }),
    f.on("change-mobi:" + e, function(e) {
        var t;
        v.pending || (t = e.extraData.model,
        (e = []).push({
            title: "Заменить " + util.radioText("трек", "клип"),
            handler: function() {
                return D(t),
                !1
            }
        }),
        1 < t.place && e.push({
            title: "Поднять <b>5</b><span class='smart-coin-wrap'><span class='smart-coin'></span></span>",
            handler: function() {
                return E(t),
                !1
            }
        }),
        e.push({
            title: "Удалить",
            handler: function() {
                return y(t),
                !1
            }
        }),
        new app.controllers.MobilePopup({
            btns: e
        }))
    }),
    f.on("add:" + p, function(e) {
        var t = v.__currentTrack;
        if (t)
            switch (t.type) {
            case RadioPlayerType.VK_AUDIO:
                var i = v.__stateId;
                if ((n = e.extraData.$target).hasClass("loading"))
                    return;
                n.addClass("loading"),
                app.services.vk.addSound({
                    ownerId: v.__currentTrack.uid,
                    audioId: v.__currentTrack.audioId
                }, function(e) {
                    n.removeClass("loading"),
                    v.__stateId === i && e.error
                }),
                v.setAttr({
                    isAdded: !0
                }),
                c[v.__currentTrack.audioOwnerId + "_" + v.__currentTrack.audioId] = !0,
                dialogController.fadePopup({
                    message: "Песня добавлена в ваши Аудиозаписи"
                });
                break;
            case RadioPlayerType.YOUTUBE:
                var n, i = v.__stateId;
                if ((n = e.extraData.$target).hasClass("loading"))
                    return;
                n.addClass("loading"),
                ServerApi("yt/my/add.php", {
                    id: t.ytId
                }, function(e, t) {
                    n.removeClass("loading"),
                    e && (e.code,
                    Codes.ALREADY_EXIST)
                }),
                u[t.ytId] = !0,
                v.setAttr({
                    isAdded: !0
                }),
                dialogController.fadePopup({
                    message: util.radioText("Трек", "Клип") + " добавлен в Мои " + util.radioText("треки", "клипы")
                })
            }
    }),
    f.on("change-volume:" + p, function(e) {
        e = e.extraData.volume;
        isNaN(e) && (e = 0),
        v.setAttr({
            volume: e = 100 < (e = e < 0 ? 0 : e) ? 100 : e
        }),
        0 === e && (v.__prevVolume = v.volume),
        0 === v.__prevVolume && (v.__prevVolume = 10),
        v.__currentTrack && d.setVolume(e)
    }),
    f.on("toggle-volume:" + p, function(e) {
        var t, i = 0 === v.volume ? v.__prevVolume : 0;
        0 === i && (t = v.volume,
        setTimeout(function() {
            v.__prevVolume = t
        }, 100)),
        v.setAttr({
            volume: i
        }),
        v.__currentTrack && d.setVolume(i)
    }),
    app.eventBus.on(app.EVENTS.AUDIO_PREVIEW_START, function() {
        v.__waiting = !0
    }),
    app.eventBus.on(app.EVENTS.AUDIO_PREVIEW_STOP, function(e) {
        v.__waiting && (v.__waiting = !1,
        v.__currentTrack && A())
    }),
    M.fromArray = function(e) {
        for (var t = [], i = 0, n = e.length; i < n; i += 1)
            t.push(new M(e[i]));
        return t
    }
    ,
    app.eventBus.on(app.EVENTS.LOAD_SELF_YT_TRACKS, function(e) {
        u = e.idsHash
    }),
    app.eventBus.on(app.EVENTS.DELETE_SELF_YT_TRACK, function(e) {
        delete c[e.id]
    }),
    function() {
        var e = $.noop
          , t = $.noop
          , i = function() {
            r.els["audio-player-el"].empty().append(f.el),
            i = $.noop
        }
          , n = function() {
            app.eventBus.trigger("radio_created", {
                radioController: a,
                radioView: f
            }),
            n = $.noop
        };
        isMobi ? (r.els["audio-player-el"].empty(),
        util.isOKPlatform() || window.isExternal || (e = function() {
            v.setAttr({
                vkReady: !0
            }),
            n()
        }
        ),
        t = function() {
            var e = !1;
            app.youtubePlayer.ready ? (v.setAttr({
                ytReady: !0
            }),
            n()) : app.youtubePlayer.onReady = function() {
                e || (e = !0,
                v.setAttr({
                    ytReady: !0
                }),
                n(),
                A(0))
            }
        }
        ) : (t = function() {
            var e;
            app.youtubePlayer.ready ? (v.setAttr({
                ytReady: !0
            }),
            i(),
            r.els["audio-player-el"].show()) : (e = !1,
            app.youtubePlayer.onReady = function() {
                e || (e = !0,
                v.setAttr({
                    ytReady: !0
                }),
                i(),
                r.els["audio-player-el"].show(),
                A(0))
            }
            )
        }
        ,
        util.isVKPlatform() && (e = function() {
            var e = !1;
            app.mp3playerIsInit ? (v.setAttr({
                vkReady: !0
            }),
            i()) : window.onMP3PlayerInitListener = function() {
                e || (e = !0,
                v.setAttr({
                    vkReady: !0
                }),
                i(),
                A(0))
            }
        }
        ));
        function o() {
            var e = !0;
            (v.type === RadioPlayerType.YOUTUBE && v.ytReady || v.type === RadioPlayerType.VK_AUDIO && v.vkReady) && (e = !1),
            v.setAttr({
                isNotEnabled: e
            })
        }
        v.onChange("ytReady", o),
        v.onChange("vkReady", o),
        v.onChange("type", o),
        e(),
        t(),
        util.isOKPlatform() && r.els["audio-player-el"].hide()
    }()
}
,
app.controllers.RoomChangesController = function(e) {
    function c(e) {
        return e === g.ROUND_WAITING || e === g.ROUND_PAUSED || e === g.ROUND_START
    }
    function u(e) {
        return {
            type: e[0],
            version: e[1],
            data: e.slice(2)
        }
    }
    var i, p = e.roomModel, f = e.roomView, m = e.roomController, v = app.info.viewer_id, n = 2 === app.info.sex, t = app.ROOM_STATE, a = app.ROUND_TYPE, o = app.ROOM_USER_STATE, h = new app.controllers.RoomResponseParser, s = 1, g = {
        MULTI: s++,
        ROUND_START: s++,
        ROUND_PAUSED: s++,
        ROUND_WAITING: s++,
        CREATE_USER: s++,
        REMOVE_USER: s++,
        UPDATE_USER_ON_ENTER_ROOM: s++,
        SEND_GIFT: s++,
        REMOVE_GIFT: s++,
        USER_EXP_TODAY: s++,
        USER_GIFT_COUNT_TOTAL: s++,
        USER_GIFT_COUNT_SENT: s++,
        USER_GIFT_COUNT_RECEIVED: s++,
        USER_LOTTERY_WINS: s++,
        USER_RADIO_LIKES_COUNT: s++,
        USER_AWAY: s++,
        VIEWER_ANSWER: s++,
        ROUND_ANSWER: s++,
        VIEWER_PRIVATE_MESSAGE_COUNTER_CHANGES: s++,
        VIEWER_PRIVATE_MESSAGES_CHANGE: s++,
        USER_ANSWER_STATE: s++,
        USER_WASTEFUL: s++,
        USER_POPULAR: s++,
        USER_DJ: s++,
        USER_FORTUNATE: s++,
        USER_LOTTERY_BET: s++,
        NEW_CHAT_MESSAGES: s++,
        RADIO: s++,
        RADIO_VOTES: s++,
        RADIO_COOL_LIKE: s++,
        RADIO_LIST: s++,
        CROWN_VOTE: s++,
        ROOM_INVITE: s++,
        EXIT_REASON: s++,
        RESQUE: s++,
        INTERRUPT_CURRENT_TRACK: s++,
        SENT_GIFTS_PER_ROOM: s++,
        RECEIVED_GIFTS_PER_ROOM: s++,
        PLACE_PURCHASE_IN_QUEUE: s++,
        PLACE_CONFIRM_TO_QUEUE: s++,
        QUEUE_IS_CHANGED: s++,
        QUEUE_IS_REORDER: s++,
        USER_HAS_BDATE_TODAY: s++,
        CHOOSE_COUPLE_ROUND: s++,
        USERS_COOL_LIKES: s++,
        USER_CHANGE_AVATAR: s++,
        LOADING_ROUND: s++,
        CHANGE_LIKES_OF_CHAT_MESSAGE: s++,
        MERGE_CHAT_MESSAGE: s++,
        USER_NAME_UPDATE: s++,
        REMOVE_CHAT_MESSAGES: s++,
        CHANGE_SUB_STATE_OF_ROUND_CHOOSE_EACH_OTHER: s++
    }, b = {};
    window.changesIds = g,
    b[g.CHANGE_SUB_STATE_OF_ROUND_CHOOSE_EACH_OTHER] = function(e) {
        var t = e[0]
          , i = e[1]
          , n = e[2]
          , o = e[3]
          , e = e[4];
        p.setCtm(i),
        console.info("CHANGE_SUB_STATE_OF_ROUND_CHOOSE_EACH_OTHER", t, i, n, n - i, o, e),
        p.roundType === a.CHOICE_EACH_OTHER && (p.subStateId = t,
        p.subStateEstimatedTime = n,
        p.coupleIds = o,
        p.winnerCoupleId = e,
        m.roundChoiceEachOther.showNewSubState())
    }
    ,
    b[g.USERS_COOL_LIKES] = function(e) {
        var t = e[0]
          , e = e[1]
          , t = p.findUser(t);
        null != t && t.setAttr({
            coolLikes: e
        })
    }
    ,
    b[g.CHOOSE_COUPLE_ROUND] = function(e) {
        e = e[0];
        p.roundType !== a.CHOOSE_COUPLE_FOR_FEMALE && p.roundType !== a.CHOOSE_COUPLE_FOR_MALE || m.applyVotesMapOfSelectCoupleRound(e, !0)
    }
    ,
    b[g.CHANGE_LIKES_OF_CHAT_MESSAGE] = function(e) {
        var i = e[0]
          , n = e[1]
          , o = e[2];
        f.getChatMessages().each(function(e, t) {
            if (t.from === n && t.uniqId === o)
                return t.__likedUids = i,
                t.updateLikesData(),
                !1
        })
    }
    ,
    b[g.MERGE_CHAT_MESSAGE] = function(e) {
        var t = e[0]
          , i = e[1]
          , e = new app.models.ChatMessage(e[2]);
        f.replaceChatMessage(t, i, e)
    }
    ,
    b[g.REMOVE_CHAT_MESSAGES] = function(e) {
        e = e[0];
        console.info("CHANGE_ID.REMOVE_CHAT_MESSAGES", e),
        f.removeChatMessage(e)
    }
    ,
    b[g.LOADING_ROUND] = function(e) {
        e[0];
        var t = e[1]
          , i = h.parseUserWithPhoto(e[2])
          , e = h.parseUserWithPhoto(e[3]);
        p.usersSnapshot = t || [],
        p.maleUserWithPhoto = i || null,
        p.femaleUserWithPhoto = e || null,
        m.roundLoadingController.showEvaluationPhotos()
    }
    ,
    b[g.USER_HAS_BDATE_TODAY] = function(e) {
        var t = e[0]
          , i = e[1]
          , e = e[2]
          , t = p.findUser(t);
        t && t.setAttr({
            age: e,
            hasBDate: i
        })
    }
    ,
    b[g.USER_CHANGE_AVATAR] = function(e) {
        var t = e[0]
          , i = e[1]
          , n = e[2] || i
          , e = e[3]
          , t = p.findUser(t);
        t && t.setAttr({
            photo: i,
            photo200: n,
            isVerified: e
        })
    }
    ,
    b[g.PLACE_CONFIRM_TO_QUEUE] = function(e) {
        var t = h.parseRoomQueuesUser(e[0]);
        p.pending ? t.uid === v && (m.roomQueueController.onPlaceConfirm(),
        e = t.price,
        (e = app.balanceModel.ruby - e) < 0 && (e = 0),
        app.balanceModel.setAttr({
            ruby: e
        })) : m.roomQueueController.removeUserFromShop(t.uid)
    }
    ,
    i = -1,
    b[g.PLACE_PURCHASE_IN_QUEUE] = function(e) {
        var t = h.parseRoomQueuesUser(e[0]);
        0 < t.price ? util.isDef(t.isMale) ? t.isMale === n && m.roomQueueController.addUserToShop(t) : (e = util.currentMillis()) - i < 300 || (i = e,
        VKApi("users.get", {
            user_ids: t.uid + "",
            fields: "sex"
        }, function(e) {
            e.response && e.response.length && e.response[0].sex === app.info.viewer_sex && m.roomQueueController.addUserToShop(t)
        })) : m.roomQueueController.removeUserFromShop(t.uid)
    }
    ,
    b[g.QUEUE_IS_CHANGED] = function(e) {
        e = e[0],
        e = h.parseRoomQueue(e);
        m.roomQueueController.onQueueChange(e)
    }
    ,
    b[g.QUEUE_IS_REORDER] = function(e) {
        e = e[0],
        e = h.parseRoomQueue(e);
        m.roomQueueController.onQueueReorder(e)
    }
    ,
    b[g.SENT_GIFTS_PER_ROOM] = function(e) {
        var t = e[0]
          , e = e[1]
          , t = p.findUser(t);
        t && (t.setAttr({
            sentGiftsPerRoom: e
        }),
        m.handlePopularityOfUsers())
    }
    ,
    b[g.RECEIVED_GIFTS_PER_ROOM] = function(e) {
        var t = e[0]
          , e = e[1]
          , t = p.findUser(t);
        t && (t.setAttr({
            receivedGiftsPerRoom: e
        }),
        m.handlePopularityOfUsers())
    }
    ,
    b[g.INTERRUPT_CURRENT_TRACK] = function(e) {
        e = e[0];
        m.radioController.interruptCurrentTrack(e)
    }
    ,
    b[g.EXIT_REASON] = function(e) {
        var t = e[0]
          , i = e[1]
          , e = h.parseExitReason(i)
          , i = p.findUser(t);
        i && e.deportationModel && i.deportationModel.update(e.deportationModel),
        t === v && (p.__communicator.isGetRoomInProcess() || m.handleExitReason(e))
    }
    ,
    b[g.RESQUE] = function(e) {
        e = e[0],
        e = p.findUser(e);
        e && e.deportationModel.reset()
    }
    ,
    b[g.ROOM_INVITE] = function(e) {
        var t = e[0]
          , i = e[1]
          , n = e[2]
          , o = e[3]
          , a = e[4]
          , s = e[5]
          , e = e[6];
        t === v && app.controllers.roomInvitesController.onRoomInvite({
            roomId: i,
            roomTitle: n,
            message: o,
            inviterUid: a,
            inviterFirstName: s,
            inviterAvatar: e
        })
    }
    ,
    b[g.MULTI] = function(e) {
        for (var t, i = e[0], n = 0, o = i.length; n < o; n += 1) {
            var a = u(i[n])
              , s = a.type
              , r = b[s];
            c(s) ? t = a : r ? r(a.data) : console.error("Strategy not found")
        }
        return t
    }
    ;
    function r(e) {
        p.setAttr({
            firstUidVotes: e
        })
    }
    function l(e) {
        p.setAttr({
            secondUidVotes: e
        })
    }
    b[g.CROWN_VOTE] = function(e) {
        var t = e[0]
          , e = e[1];
        t ? m.animateCounter("firstUidVotes", p.firstUidVotes, e, r) : m.animateCounter("secondUidVotes", p.secondUidVotes, e, l)
    }
    ,
    b[g.ROUND_START] = function(e) {
        e = e[0],
        e = h.parseRound(e);
        m.updateRoundData(e, t.STARTED),
        m.doStart()
    }
    ,
    b[g.ROUND_START] = function(e) {
        e = e[0],
        e = h.parseRound(e);
        m.updateRoundData(e, t.STARTED),
        m.doStart()
    }
    ,
    b[g.ROUND_PAUSED] = function(e) {
        e = e[0],
        e = h.parseRound(e);
        m.updateRoundData(e, t.PAUSED),
        m.doPause()
    }
    ,
    b[g.ROUND_WAITING] = function(e) {
        m.doWaiting()
    }
    ,
    b[g.RADIO_COOL_LIKE] = function(e) {}
    ,
    b[g.RADIO_VOTES] = function(e) {
        var t = e[0]
          , i = e[1]
          , n = e[2]
          , e = e[3];
        m.radioController.updateVotes(t, i, n, e)
    }
    ,
    b[g.RADIO] = function(e) {
        e = e[0];
        m.radioController.update(e, !0)
    }
    ,
    b[g.RADIO_LIST] = function(e) {
        e = e[0];
        m.radioController.updateTracks(e)
    }
    ,
    b[g.CREATE_USER] = function(e) {
        var i, t = e[0], e = h.parseUser(t);
        p.pending ? m.roomQueueController.onUserCame(e) : (t = (t = p.findUser(e.uid)) || m.findEmptyUser(e.male)) ? (t.setAttr({
            exp: e.exp,
            isEmpty: !1,
            age: e.age,
            male: e.male,
            isAway: e.isAway,
            freeMessageCountersMap: e.freeMessageCountersMap,
            djCounter: e.djCounter,
            coolLikes: e.coolLikes,
            hasExpBooster: e.hasExpBooster,
            sentGiftsPerDay: e.sentGiftsPerDay,
            receivedGiftsPerDay: e.receivedGiftsPerDay,
            expPerDay: e.expPerDay,
            lotteryWinsPerDay: e.lotteryWinsPerDay,
            sentGiftsPerHour: e.sentGiftsPerHour,
            receivedGiftsPerHour: e.receivedGiftsPerHour,
            expPerHour: e.expPerHour,
            lotteryWinsPerHour: e.lotteryWinsPerHour,
            realFirstName: e.firstName,
            firstName: e.firstName + util.formatProfileBdate(null, e.age),
            firstNameAcc: e.firstNameAcc,
            firstNameGen: e.firstNameGen,
            firstNameDat: e.firstNameDat,
            photo: e.photo_100,
            photo200: e.photo_200,
            isMobiUser: e.isMobiUser,
            counterMapOfGiftsForBeginners: e.counterMapOfGiftsForBeginners,
            hasBDate: e.hasBDate,
            isVerified: e.isVerified,
            clientType: e.clientType
        }),
        t.updateDeporationModelByExitReason(e.exitReason),
        t.setAttr({
            countryId: e.countryId
        }),
        t.setAttr({
            wins: e.wins,
            giftsCount: e.giftsCount,
            gameCounter1: e.gameCounter1,
            gameCounter2: e.gameCounter2,
            gameCounter3: e.gameCounter3,
            regionId: e.regionId,
            sentGiftsPerRoom: e.sentGiftsPerRoom,
            lotteryWinsPerRoom: e.lotteryWinsPerRoom,
            receivedGiftsPerRoom: e.receivedGiftsPerRoom
        }),
        m.isRoundWithoutAnswersState() && e.state === o.ANSWERED ? t.setAttr({
            state: o.IDLE
        }) : t.setAttr({
            state: e.state
        }),
        t.setAttr({
            uid: e.uid
        })) : (i = [],
        p.processUsers(function(e, t) {
            t.uid ? i.push(t.uid + "_" + (t.male ? 1 : 0)) : i.push("null")
        }),
        GA("AppError", "Empty user not found[2]"),
        dialogController.close(),
        dialogController.showMessageDialog({
            message: "Произошла ошибка при обновлении комнаты. Перезагрузите игру",
            isModal: !0,
            buttons: [{
                caption: "Перезагрузить игру",
                handler: function() {
                    return window.location.reload(),
                    !1
                }
            }]
        }),
        $(document.activeElement).blur())
    }
    ,
    b[g.REMOVE_USER] = function(e) {
        e = e[0];
        p.pending ? m.roomQueueController.onUserExit(e) : e === v || (e = p.findUser(e)) && e.setAttr({
            uid: null
        })
    }
    ,
    b[g.UPDATE_USER_ON_ENTER_ROOM] = function(e) {
        var t = e[0]
          , t = p.findUser(t);
        t && t.setAttr({
            isMobiUser: e[1],
            clientType: e[2]
        })
    }
    ,
    b[g.SEND_GIFT] = function(e) {
        var i, e = e[0], e = h.parseGifts(e), s = p.usersToHash(), r = {}, l = !1, d = !1;
        $.each(e, function(e, t) {
            if (t.version !== app.info.giftsVersion)
                return !(d = !0);
            var i = s[t.to];
            if (i && (i.uid === v && (l = !0),
            !i.__giftsHash[t.ts])) {
                i.__giftsHash[t.ts] = t;
                for (var n = (n = r[t.from]) || (r[t.from] = []), o = 0, a = t.count; o < a; o += 1)
                    n.push(t)
            }
        }),
        d ? dialogController.showAppRebootDialog({
            message: "Приложение обновилось. Необходим перезапуск"
        }) : ($.each(r, function(e, i) {
            var n = p.roomId
              , o = 0
              , a = 1 < i.length
              , s = a && 0 < rawGiftsHash[i[0].id].recipientBalanceBonus
              , r = i[0].id === app.info.roomGiftKissId
              , l = function() {
                var e, t;
                p.roomId === n && ((e = i[o++]).to === v && 0 < rawGiftsHash[e.id].recipientBalanceBonus && (app.balanceModel.__balanceUpdateIsLocked = !0,
                clearTimeout(app.balanceModel.__balanceUpdateLockTimeout),
                app.balanceModel.__balanceUpdateLockTimeout = setTimeout(function() {
                    app.balanceModel.__balanceUpdateIsLocked = !1
                }, 2e3)),
                t = {
                    totalExpBonus: d,
                    isLastGift: o === i.length
                },
                a ? (o === i.length ? t.countOfGifts = i.length : t.noExp = !0,
                s && (o === i.length ? t.countOfGifts = i.length : t.noBonus = !0)) : t.countOfGifts = i.length,
                r && windowVisibilityState() && (t.delay = 500 * o),
                m.animateGift(e.id, e.from, e.to, e, !1, t),
                o < i.length && (r ? l() : setTimeout(l, 500)))
            }
              , d = 0
              , t = i[0];
            t.from === v ? d = t.totalExpBonusForSender : t.to === v && (d = t.totalExpBonusForRecipient),
            l()
        }),
        !l || (e = p.findUser(v)) && (i = !1,
        $.each(e.__giftsHash, function(e, t) {
            if (rawGiftsHash[t.id].isViewerCanClean)
                return !(i = !0)
        }),
        e = f.getViewerEl(),
        i ? e.addClass("can-clear-gifts") : e.removeClass("can-clear-gifts open-popup")))
    }
    ,
    b[g.REMOVE_GIFT] = function(e) {
        var i, e = e[0], e = h.parseGifts(e), n = !1, o = p.usersToHash(), a = {};
        $.each(e, function(e, t) {
            var i = o[t.to];
            i && i.__giftsHash[t.ts] && ((a[i.uid] || (a[i.uid] = [])).push(t),
            delete i.__giftsHash[t.ts],
            i.uid === v && (n = !0))
        }),
        $.each(a, function(e, t) {
            m.roomGiftsController.removeGifts(t, e)
        }),
        !n || (e = p.findUser(v)) && (i = !1,
        $.each(e.__giftsHash, function(e, t) {
            if (rawGiftsHash[t.id].isViewerCanClean)
                return !(i = !0)
        }),
        e = f.getViewerEl(),
        i ? e.addClass("can-clear-gifts") : e.removeClass("can-clear-gifts open-popup"))
    }
    ,
    b[g.USER_EXP_TODAY] = function(e) {
        var t = e[0]
          , i = e[1]
          , n = e[2]
          , o = e[3]
          , a = e[4]
          , e = p.findUser(t);
        if (e)
            if (v === t) {
                if (expController.setRealExp(i),
                e.setAttr({
                    exp: expController.getCurrentExp(),
                    expPerDay: n,
                    expPerHour: o
                }),
                a) {
                    var s, r = a[0], l = a[1], d = a[2];
                    switch (r) {
                    case 1:
                    case 2:
                        expController.animateBonusByType(r, l);
                        break;
                    case 10:
                    case 11:
                        expController.animateBonusByType(r, l),
                        app.eventBus.trigger(app.EVENTS.P2P_LIKE, {
                            type: r,
                            expBonus: l,
                            uid: t,
                            data: d
                        });
                        break;
                    case 12:
                        d && (s = d.uid,
                        console.info("TYPE_INC_LUCKY_IN_CHOICE_EACH_OTHER_ROUND", s, l),
                        c = {
                            uid: d.uid,
                            exp: l
                        },
                        (s = p.getViewer()).setAttr({
                            luckyExpModifier: null
                        }),
                        s.setAttr({
                            luckyExpModifier: c
                        }));
                        break;
                    case 13:
                        var c = f.getViewerOffset();
                        expController.animateBonus({
                            incValue: l,
                            sourceOffset: {
                                left: c.left + 35,
                                top: c.top - 20
                            }
                        })
                    }
                }
            } else
                e.setAttr({
                    exp: i,
                    expPerDay: n,
                    expPerHour: o
                })
    }
    ,
    b[g.USER_GIFT_COUNT_TOTAL] = function(e) {}
    ,
    b[g.USER_GIFT_COUNT_SENT] = function(e) {
        var t = e[0]
          , i = e[1]
          , e = e[2]
          , t = p.findUser(t);
        t && t.setAttr({
            sentGiftsPerDay: i,
            sentGiftsPerHour: e
        })
    }
    ,
    b[g.USER_GIFT_COUNT_RECEIVED] = function(e) {
        var t = e[0]
          , i = e[1]
          , e = e[2]
          , t = p.findUser(t);
        t && t.setAttr({
            receivedGiftsPerDay: i,
            receivedGiftsPerHour: e
        })
    }
    ,
    b[g.USER_LOTTERY_WINS] = function(e) {
        var t = e[0]
          , i = e[1]
          , n = e[2]
          , e = e[3]
          , t = p.findUser(t);
        t && (t.setAttr({
            lotteryWinsPerDay: i,
            lotteryWinsPerHour: n,
            lotteryWinsPerRoom: e
        }),
        p.roundType === app.ROUND_TYPE.LOTTERY || m.handlePopularityOfUsers())
    }
    ,
    b[g.USER_RADIO_LIKES_COUNT] = function(e) {
        var t = e[0]
          , e = e[1]
          , t = p.findUser(t);
        t && (t.setAttr({
            djCounter: e
        }),
        m.handlePopularityOfUsers())
    }
    ,
    b[g.USER_AWAY] = function(e) {
        var t = e[0]
          , e = e[1]
          , t = p.findUser(t);
        t && t.setAttr({
            isAway: e
        })
    }
    ,
    b[g.VIEWER_ANSWER] = function(e) {
        var t = e[0]
          , e = e[1];
        t === v && m.selectViewerAnswer(e)
    }
    ,
    b[g.ROUND_ANSWER] = function(e) {
        var t = e[0]
          , i = e[1]
          , n = e[2]
          , e = e[3];
        m.onRoundAnswer(t, i, n, {
            isDailyExpLimitExceeded: e
        })
    }
    ,
    b[g.VIEWER_PRIVATE_MESSAGE_COUNTER_CHANGES] = function(e) {
        var t = e[0]
          , e = e[1]
          , t = p.findUser(t);
        t && t.setAttr({
            freeMessageCountersMap: e
        })
    }
    ,
    b[g.VIEWER_PRIVATE_MESSAGES_CHANGE] = function(e) {
        var t = e[0]
          , e = e[1];
        t === v && e && (e = h.parsePrivateMessages(e),
        m.handlePrivateMessages(e, !1))
    }
    ,
    b[g.USER_ANSWER_STATE] = function(e) {
        var t = e[0]
          , e = e[1]
          , t = p.findUser(t);
        t && (m.isRoundWithoutAnswersState() && e === o.ANSWERED ? t.setAttr({
            state: o.IDLE
        }) : t.setAttr({
            state: e
        }))
    }
    ,
    b[g.USER_WASTEFUL] = function(e) {
        p.wastefulUid = e[0],
        m.handlePopularityOfUsers()
    }
    ,
    b[g.USER_POPULAR] = function(e) {
        p.popularUid = e[0],
        m.handlePopularityOfUsers()
    }
    ,
    b[g.USER_DJ] = function(e) {
        p.djUid = e[0],
        m.handlePopularityOfUsers()
    }
    ,
    b[g.USER_FORTUNATE] = function(e) {
        p.fortunateUid = e[0],
        p.roundType === app.ROUND_TYPE.LOTTERY || m.handlePopularityOfUsers()
    }
    ,
    b[g.USER_NAME_UPDATE] = function(e) {
        var t = e[0]
          , i = e[1]
          , e = p.findUser(t);
        e && e.setAttr({
            realFirstName: i,
            firstName: i + util.formatProfileBdate(null, e.age),
            firstNameAcc: i,
            firstNameGen: i,
            firstNameDat: i
        }),
        t === app.info.viewer_id && (app.info.first_name = i,
        app.info.full_name = app.info.first_name + " " + app.info.last_name,
        $.each(["gen", "dat", "acc", "ins", "abl"], function(e, t) {
            app.info["first_name_" + t] = i,
            app.info["last_name_" + t] = i
        }),
        window.selfProfileController && selfProfileController.model.setAttr({
            firstName: app.info.first_name
        }))
    }
    ,
    b[g.USER_LOTTERY_BET] = function(e) {
        var t = e[0]
          , e = e[1];
        p.usersBets || (p.usersBets = {}),
        p.usersBets[t] = e,
        p.roundType === a.LOTTERY && m.lotteryController.applyAllBetsToNumbers()
    }
    ,
    b[g.NEW_CHAT_MESSAGES] = function(e) {
        e = e[0],
        e = app.models.ChatMessage.fromArray(e);
        m.handleChatMessages(e, !1)
    }
    ;
    this.handleChanges = function(e, t) {
        for (var i, n = 0, o = 0, a = e.length; o < a; o += 1) {
            var s, r, l = e[o], d = l;
            !(d = u(d)).version || d.version >= p.versionOfLastChange ? (s = d.type,
            r = b[s],
            c(s) ? i = d : s === g.MULTI ? (l = r(d.data)) && (i = l) : r ? r(d.data) : console.error("Strategy not found. changeType:" + s + "; change:" + JSON.stringify(d) + "; changesArray:" + JSON.stringify(e)),
            d.version && d.version > n && (n = d.version)) : d.version && console.error("[!] change is eliminate", p.versionOfLastChange, d.version, d)
        }
        i && (s = (d = i).type,
        (r = b[s]) && r(d.data)),
        n && (p.versionOfLastChange = n)
    }
    ,
    this.isImportantUpdate = function(e) {
        return e !== g.INTERRUPT_CURRENT_TRACK
    }
}
,
app.controllers.roomInvitesController = function() {
    function t(e) {
        i[e.roomId] || (i[e.roomId] = !0,
        o.push(e))
    }
    var i = {}
      , o = [];
    return app.eventBus.on(app.EVENTS.ON_GET_NEW_NOTIFICATIONS, function(e) {
        e.t === NotificationType.ROOM_INVITE && t({
            roomId: n.roomId
        })
    }),
    {
        getAllInvites: function() {
            return o
        },
        onRoomInvite: t
    }
}(),
app.controllers.RoomQueueController = function(e) {
    var o = app.info.viewer_id
      , l = 2 === app.info.sex
      , d = null
      , c = null
      , i = "roomQueueLockTime"
      , a = !1
      , u = e.controller
      , p = e.roomModel
      , f = e.roomView
      , m = $.noop;
    $body.click(function() {
        m()
    });
    var e = "room-queue-shop"
      , s = lilo.createView(e);
    function v(e) {
        e = 1 < e ? "Ожидаем свободного места среди {0}. Место в очереди: {1}".format(l ? "парней" : "девушек", e) : "Ожидаем свободного места среди {0}".format(l ? "парней" : "девушек");
        return e
    }
    function h(e) {
        c && c.els.btnBuyFirstPlace && c.els.btnBuyFirstPlace.css("display", 0 < e ? "inline-block" : "none")
    }
    function g() {
        var e = {
            millis: util.currentMillis()
        };
        util.cache.save(i, e, 1e4)
    }
    function b(e) {
        var t = util.cache.find(i);
        if (!t)
            return 1;
        t = 1e4 - (util.currentMillis() - t.millis);
        t < 1e3 && (t = 1e3);
        t = Math.floor(t / 1e3);
        dialogController.fadePopup(e.format(t))
    }
    s.setModel({
        extraTitle: ""
    }),
    f.locationView.els["right-block"].append(s.el),
    s.on("show-profile:" + e, function(e) {
        app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: e.extraData.uid
        })
    }),
    s.on("select:" + e, function(e) {
        var t, i, n;
        a || (t = e.extraData.uid,
        i = e.extraData.btn,
        e = e.extraData.price,
        app.balanceModel.balance,
        n = $(i),
        a = !0,
        n.addClass("loading"),
        api.roomV3.queue.giveUpPlace({
            target_uid: t,
            price: e,
            roomId: p.roomId
        }, function(e, t) {
            a = !1,
            n.removeClass("loading"),
            t && util.isDef(t.balance) && app.balanceModel.setAttr({
                balance: t.balance
            }),
            e ? e.code === Codes.LIMIT ? dialogController.fadePopup("Вы сможете принять заявку через " + util.formatMillisToTime(t.leftMillis, function(e, t, i) {
                return e + ":" + t + ":" + i
            })) : dialogController.fadePopup("Не удалось выполнить запрос") : (t.result,
            api.roomV3.exit({
                roomId: p.roomId
            }, $.noop).send(),
            u.resetRoom(),
            u.communicator.getRoom({
                force: !0
            }),
            dialogController.fadePopup({
                duration: 4e3,
                message: "Вы уступили место. Автоматическая смена комнаты"
            }))
        }).send())
    }),
    this.showRoomPlaceInTopList = function(e) {
        var t = "";
        0 <= e && !p.pending && (t = "Место топ комнат #{0}".format(e += 1)),
        s.showExtraTitle(t)
    }
    ,
    this.resetQueue = function() {
        d = null,
        p.setAttr({
            pending: !1
        }),
        s.showExtraTitle("")
    }
    ,
    this.removeUserFromShop = function(e) {
        s.removeItem(e)
    }
    ,
    this.addUserToShop = function(e) {
        s.addItem(e)
    }
    ,
    this.onPlaceConfirm = function() {
        c && (c.els.btnBuy.remove(),
        c.els.btnCancel.remove(),
        $(document.createElement("div")).addClass("queue-hint").text("Заявка принята. Вы войдете после завершения текущего раунда").appendTo(c.el))
    }
    ,
    this.onUserCame = function(e) {
        var t;
        e.uid === o ? u.communicator.getRoom({
            force: !0,
            skip_restrictions: !0
        }) : d && (t = l ? e.male ? "bottomUsers" : "topUsers" : e.male ? "topUsers" : "bottomUsers",
        e = {
            uid: e.uid,
            firstName: e.firstName + util.formatProfileBdate(null, e.age),
            photoUrl: e.photo_100,
            exp: e.exp
        },
        d[t].length < 6 && d[t].add(e))
    }
    ,
    this.onUserExit = function(n) {
        d && d.processUsers(function(e, t, i) {
            if (i.uid === n)
                return e.remove(i),
                !1
        })
    }
    ,
    this.onQueueReorder = function(e) {
        var i, t;
        p.pending && (t = l ? e.males : e.females,
        i = -1,
        $.each(t, function(e, t) {
            if (t.uid === o)
                return i = e,
                !1
        }),
        0 <= i && (e = 0 == i ? "Ваше новое место в очереди: 1" : "Кто-то купил первое место, ваше новое место в очереди: {0}".format(i + 1),
        t = v(i + 1),
        c && c.els.title.html() === t || dialogController.fadePopup(e)))
    }
    ,
    this.handleInitialStateWhenRequestSend = function() {
        try {
            c.els.btnBuy.hide(),
            c.els.btnCancel.css("display", "inline-block")
        } catch (e) {}
    }
    ,
    this.handleInitialStateWhenRequestCondirmed = function() {
        try {
            this.onPlaceConfirm()
        } catch (e) {}
    }
    ,
    this.onQueueChange = function(e) {
        var i, t, n;
        p.pending ? (t = l ? e.males : e.females,
        i = -1,
        $.each(t, function(e, t) {
            if (t.uid === o)
                return i = e,
                !1
        }),
        0 <= i && (t = v(i + 1),
        h(i),
        f.elsMap.$questionText.text("").hide(),
        c && c.els.title.html(t))) : (n = [],
        e[l ? "males" : "females"].each(function(e, t) {
            0 < t.price && !t.confirmedUid && n.push(t)
        }),
        n.sort(function(e, t) {
            return e.price === t.price ? 0 : e.price > t.price ? -1 : 1
        }),
        s.setUsers(n))
    }
    ,
    this.onGetQueueData = function(n) {
        p.roomId = n.roomId;
        var e = p.roomId;
        u.resetRoom(),
        p.setAttr({
            pending: !0
        }),
        p.roomId = e,
        p.setAttr({
            ownerId: n.roomOwner,
            title: n.title,
            accessDescr: {}
        });
        var t = v(n.indexInQueue + 1);
        f.elsMap.$questionText.text("").hide(),
        u.roundLoadingController.stop(),
        f.elsMap.$timer.hide(),
        f.elsMap.$waitUsersLoader.hide(),
        (d = n).topUsers = [],
        n.bottomUsers = [],
        n.processUsers = function(i) {
            n.topUsers.each(function(e, t) {
                i(n.topUsers, e, t)
            }),
            n.bottomUsers.each(function(e, t) {
                i(n.bottomUsers, e, t)
            })
        }
        ;
        var i = n.users;
        $.each(i, function(e, t) {
            var i = l ? t.male ? "bottomUsers" : "topUsers" : t.male ? "topUsers" : "bottomUsers";
            n[i].push(t),
            t.firstName = t.firstName + util.formatProfileBdate(null, t.age),
            t.photoUrl = t.photo_100
        });
        e = lilo.createView("item-room-preview"),
        i = $(document.createElement("div")).addClass("queue-title");
        e.el.append(i),
        e.els.title = i,
        e.setModel(n);
        var o = $(document.createElement("div")).addClass("btn buy-place").html("Предложить освободить место")
          , a = $(document.createElement("div")).addClass("btn buy-place").html("Стать первым в очереди {0}<i class='coin-icon-el'></i>".format(5))
          , s = $(document.createElement("div")).addClass("btn cancel-buy-place-request").html("Отменить заявку").hide()
          , r = $(document.createElement("div")).addClass("price-popup").hide().appendTo(o);
        m = function() {
            r.hide()
        }
        ;
        i = $(document.createElement("div")).addClass("btns-wrap-line");
        i.append(o),
        i.append(a),
        i.append(s),
        e.el.append(i),
        e.els.btnBuy = o,
        e.els.btnBuyFirstPlace = a,
        (e.els.btnCancel = s).click(function() {
            s.pending || b("Вы сможете отменить заявку через {0} сек.") && (s.pending = !0,
            api.roomV3.queue.dismissPlace({
                roomId: p.roomId
            }, function(e, t) {
                s.pending = !1,
                e || 5 === t.result ? dialogController.fadePopup("Не удалось выполнить запрос.") : (s.hide(),
                o.css("display", "inline-block"),
                dialogController.fadePopup("Заявка отменена"),
                g())
            }).send())
        }),
        o.click(function(e) {
            if (e.stopPropagation(),
            e.preventDefault(),
            o.pending)
                return !1;
            if (!b("Вы сможете отправить заявку через {0} сек."))
                return !1;
            r.empty();
            return [5, 10, 25].each(function(e, i) {
                var t = document.createElement("div");
                t.className = "item-select",
                t.innerHTML = "За <b>{0}</b> <i class='smart-ruby'></i>".format(i),
                t.onclick = function() {
                    var e, t;
                    e = i,
                    (t = app.balanceModel.ruby - e) < 0 ? dialogController.showInsufficientlyBalanceDialog(t, {
                        currency: StockCurrency.RUBIES
                    }) : (o.pending = !0,
                    api.roomV3.queue.buyPlace({
                        roomId: p.roomId,
                        price: e
                    }, function(e, t) {
                        o.pending = !1,
                        t && util.isDef(t.balance) && app.balanceModel.setAttr({
                            balance: t.balance
                        }),
                        t && util.isDef(t.ruby) && app.balanceModel.setAttr({
                            ruby: t.ruby
                        }),
                        e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit, {
                            currency: StockCurrency.RUBIES
                        }) : e.code === Codes.LIMIT ? dialogController.fadePopup("Вы сможете отправить заявку через " + util.formatMillisToTime(t.leftMillis, function(e, t, i) {
                            return e + ":" + t + ":" + i
                        })) : dialogController.fadePopup("Не удалось выполнить запрос") : 1 === t.result || 2 === t.result ? (dialogController.fadePopup("Заявкa отправлена"),
                        o.hide(),
                        s.css("display", "inline-block"),
                        g()) : dialogController.fadePopup("Не удалось выполнить запрос.")
                    }).send())
                }
                ,
                r.append(t)
            }),
            r.show(),
            !1
        }),
        a.click(function() {
            var e;
            a.pending || ((e = app.balanceModel.balance - 5) < 0 ? dialogController.showInsufficientlyBalanceDialog(e) : (a.pending = !0,
            api.roomV3.queue.buyFirstPlace({
                roomId: p.roomId
            }, function(e, t) {
                a.pending = !1,
                t && util.isDef(t.balance) && app.balanceModel.setAttr({
                    balance: t.balance
                }),
                e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : dialogController.fadePopup("Не удалось выполнить запрос") : 1 === t.result || 2 === t.result || dialogController.fadePopup("Не удалось выполнить запрос.")
            }).send()))
        }),
        f.els["room-preview"].empty().append(e.el),
        e.on("kick:item-user-v2", function(e) {
            u.doKick(e.extraData.model)
        }),
        e.on("click:item-user-v2", function(e) {
            e = e.extraData.model;
            app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: e.uid
            })
        }),
        (c = e).els.title.html(t),
        h(n.indexInQueue)
    }
}
,
app.controllers.RoundChoiceEachOther = function(i) {
    var r = app.RoundSubState
      , t = !1
      , h = i.roomModel
      , l = 300
      , p = -1
      , e = "show-small-zone-in-center"
      , g = "__localCounterOfSelectionOfUsers"
      , n = lilo.createView("couples-round")
      , a = {
        selfMatches: 0,
        matches: 0
    };
    function o(e, t) {
        this.price = e,
        this.probability = t
    }
    var b = [new o(1,0), new o(2,1), new o(3,2), new o(-1,3)];
    window.choiceEachOtherRoundProbabilityList = b;
    var d, f = -1, m = [], c = function() {
        clearTimeout(d)
    }, u = function(i, e) {
        w.each(function(e, t) {
            t.color = i
        }),
        e || O()
    };
    n.setModel(a);
    var s, v, C = app.info.viewer_id, _ = 2 === app.info.sex, w = [], E = -1, y = -1, D = "#d8d8d1", T = "#a93219", S = isMobi ? "#3676ff" : "#357dd5", A = document.createElement("canvas");
    A.className = "arrows-canvas";
    function I() {
        var e = isMobi ? appWidth : i.width
          , t = isMobi ? mobiUiHelper.getRoomHeight() : i.height;
        A.width = e,
        A.height = t,
        A.style.width = e + "px",
        A.style.height = t + "px",
        s = e,
        v = t,
        O()
    }
    isMobi && mobiUiHelper.on("resize", I),
    A.style.pointerEvents = "none";
    var M = A.getContext("2d");
    function O() {
        M.clearRect(0, 0, s, v),
        w.each(function(e, t) {
            t.isVisible && (M.beginPath(),
            M.strokeStyle = t.color,
            M.moveTo(t.x1, t.y1),
            M.lineTo(t.x1, t.y1 - y),
            t.x3 && (t.userIndex % 2 == 1 && M.lineTo(t.x1, t.y3 + t.y1),
            t.targetUserIndex % 2 == 0 && M.lineTo(t.x2, t.y4 + t.y2 - 1.5 * y)),
            M.lineTo(t.x2, t.y2),
            M.lineTo(t.x2, t.y2 - y),
            M.stroke())
        })
    }
    function x() {
        t && (c(),
        n.el.detach(),
        A.parentNode && (A.parentNode.removeChild(A),
        M.clearRect(0, 0, s, v)),
        roomView.el.removeClass(e),
        t = !1,
        w.length = 0,
        h.processUsers(function(e, t) {
            t.setAttr({
                voteCounter: 0,
                canShowVoteInfo: !1,
                canShowSelectBtn: !1
            })
        }))
    }
    function R(e, t, i) {
        this.user = e,
        this.targetUser = t,
        this.isTargetCouple = i,
        this.userIndex = e.orderIndex,
        this.targetUserIndex = t.orderIndex,
        this.uuid = util.nextCounter(),
        this.canRemove = !1,
        this.isMatchWithViewer = e.uid === C,
        this.color = D,
        this.isVisible = !1
    }
    function k(e, t, i) {
        e = {
            action: "room/answer",
            r: h.roomId,
            q: h.roundQuestion.id,
            a: e + ""
        };
        t && (e.d = t);
        var n = {
            left: 0,
            top: 0
        }
          , o = h.subStateId === app.RoundSubState.VOTING;
        !isMobi && o && ((n = i.offset()).top = 180,
        n.left += 10 + 16 * t,
        util.isOKPlatform() && (n.left -= $frameWrapper.offset().left)),
        webSocketController.sendMessage(e, {}, function(e) {
            e.code;
            "SUCCESS" === (e.data || {}).result && (e = expController.applyBooster(10 * (t || 1)),
            o && (expController.animateBonus({
                incValue: e,
                sourceOffset: n
            }),
            dialogController.fadePopup("Шанс повышен")))
        })
    }
    function P(e) {
        e = e.split("_");
        this.maleUid = parseInt(e[0], 10),
        this.femaleUid = parseInt(e[1], 10)
    }
    function N(t) {
        (t = t || {}).keepAnimation || c();
        function i() {
            e ? o() : d = setTimeout(o, l)
        }
        var e = h.subStateId !== r.SHOW_ARROWS
          , n = 0
          , o = function() {
            var e = w[n];
            e && (n += 1,
            e.isVisible = !0,
            t.withoutRender || (O(),
            a.setAttr({
                matches: a.matches + 1
            })),
            i())
        };
        u(D, !0),
        i()
    }
    function U() {
        if (!m) {
            c();
            function t() {
                var e;
                d = i ? setTimeout(function() {
                    var e, t, i;
                    e = 0,
                    t = w[f],
                    i = function() {
                        8 !== e && (t.color = e % 2 ? T : D,
                        O(),
                        e += 1,
                        d = setTimeout(i, 150))
                    }
                    ,
                    c(),
                    i()
                }, l) : (h.subStateId === r.SHOW_RESULT && ((e = h.getLeftTimeOfSubState()) < 2500 ? (o = function() {
                    return f
                }
                ,
                n = Math.max(0, Math.min(e / 2, n)),
                i = !0) : n = Math.min(500, n *= 1.05)),
                setTimeout(a, n))
            }
            var i = !1
              , n = l
              , o = function() {
                return -1
            }
              , a = function() {
                u(D, !0);
                var e = w[o()];
                e && (e.color = T,
                t()),
                O()
            };
            switch (h.subStateId) {
            case r.VOTING:
            case r.SHOW_RESULT:
                var s = [];
                util.repeat(w.length, function(e) {
                    s.push(e)
                }),
                util.shuffleArray(s),
                m = s;
                var e = 0
                  , o = function() {
                    return s[(e += 1) % s.length]
                };
                t()
            }
        }
    }
    I(),
    M.lineJoin = "round",
    $.extend(R.prototype, {
        getMaleUid: function() {
            return this[_ ? "user" : "targetUser"].uid
        },
        getFemaleUid: function() {
            return this[_ ? "targetUser" : "user"].uid
        },
        definePositions: function(e, t, i, n) {
            var o = {
                isChoiseEachOther: !0,
                _indexOfUser: this.userIndex,
                _indexOfAnswer: this.targetUserIndex,
                _isTop: !1,
                _getVerticalHeight: resultController.ArrowAnimation.prototype._getVerticalHeight,
                opts: {
                    indexOfLineOfTargetUser: i,
                    totalLinesOfTargetUser: n,
                    totalAnswers: t,
                    answerIndex: e
                }
            };
            resultController.ArrowAnimation.prototype.definePositions.apply(o, []),
            this.x1 = o._x1,
            this.x2 = o._x2,
            this.x3 = o._x3;
            t = E + 2;
            this.x2 += t * i - n * t,
            this.y1 = o._y1,
            this.y2 = o._y2,
            this.y3 = o._y3,
            this.y4 = o._y4,
            isMobi ? this.y2 += y + 6 * (isMobi ? mobiUiHelper.getRatioOfRoomHeight() : 1) : this.x2 -= 4 * e
        }
    }),
    this.onSelectBtnClick = function(e, t) {
        var i = e.uid
          , n = !1;
        switch (h.subStateId) {
        case app.RoundSubState.CHOOSING_PARTNER_FOR_KISS:
            var o = !0;
            if (-1 === h.usersSnapshot.indexOf(C))
                dialogController.fadePopup({
                    message: "Голосовать нельзя. Ожидаем конца раунда",
                    duration: 3e3
                }),
                o = !1;
            else if (h.viewerAnswer && h.viewerAnswer.split)
                for (var a = h.viewerAnswer.split(","), s = i + "", r = 0; r < a.length; r += 1)
                    if (s === a[r]) {
                        o = !1;
                        break
                    }
            if (o) {
                if (t && t.hasClass("loading"))
                    return;
                var l = h.viewerAnswer && h.viewerAnswer.length ? util.countMatches(h.viewerAnswer, ",") + 1 : 0
                  , d = 0;
                if ((l = h[g] ? h[g] : l) >= (10 <= expController.getCurrentLevel() ? 2 : 1)) {
                    var d = 1
                      , c = 1;
                    if ((v = app.balanceModel.balance - c) < 0)
                        return void dialogController.fadePopup("Не хватает монеток");
                    app.balanceModel.setAttr({
                        balance: v
                    })
                }
                h[g] = l + 1,
                t && (t.addClass("loading"),
                setTimeout(function() {
                    t.removeClass("loading")
                }, 2e3)),
                k(i, d, t),
                n = !0
            }
            break;
        case app.RoundSubState.VOTING:
            var o = !0
              , c = 1
              , u = 0
              , p = _ ? C + "_" + i : i + "_" + C;
            if (h.viewerAnswer && h.viewerAnswer.split)
                for (a = h.viewerAnswer.split(","),
                r = 0; r < a.length; r += 1) {
                    var f = a[r].split("=")
                      , m = f[0]
                      , f = parseInt(f[1], 10);
                    if (m === p) {
                        u = f;
                        break
                    }
                }
            d = b[u];
            if (o = !d || d.price < 0 ? !1 : o) {
                var v, c = d ? d.price : 1;
                if ((v = app.balanceModel.balance - c) < 0)
                    return void dialogController.fadePopup("Не хватает монеток");
                app.balanceModel.setAttr({
                    balance: v
                }),
                t && (t.addClass("loading"),
                setTimeout(function() {
                    t.removeClass("loading")
                }, 2e3)),
                k(p, c, t),
                n = !0
            }
        }
        return n
    }
    ,
    this.selectViewerAnswer = function() {
        var e, n;
        h.viewerAnswer && (h.subStateId === app.RoundSubState.CHOOSING_PARTNER_FOR_KISS ? (n = {},
        $.each(h.viewerAnswer.split(","), function(e, t) {
            t = parseInt(t, 10);
            if (!isNaN(t))
                return n[t] = t
        }),
        h.processUsers(function(e, t) {
            t.setAttr({
                isSelectedByViewer: !!n[t.uid]
            })
        }),
        (e = util.getKeys(n).length) >= (10 <= expController.getCurrentLevel() ? 2 : 1) && roomView.el.addClass("user-add-answer"),
        e === (_ ? h.getFemalesCount() : h.getMalesCount) && roomView.elsMap.$questionText.html("Ожидаем других игроков")) : h.subStateId === app.RoundSubState.VOTING && (n = {},
        $.each(h.viewerAnswer.split(","), function(e, t) {
            var i = t.split("=")
              , t = parseInt(i[0].split("_")[_ ? 1 : 0], 10)
              , t = parseInt(i[0].split("_")[_ ? 1 : 0], 10)
              , i = parseInt(i[1], 10);
            isNaN(t) || (n[t] = i)
        }),
        h.processUsers(function(e, t) {
            t.setAttr({
                voteCounter: n[t.uid] || 0
            })
        })))
    }
    ,
    this.showNewSubState = function() {
        switch (h.subStateId !== r.CHOOSING_PARTNER_FOR_KISS && function() {
            var e = h.startStateCtm + h.roomId
              , t = e !== p;
            p = e;
            function o(e) {
                r[e.uid] = (r[e.uid] || 0) + 1
            }
            var i = h.winnerCoupleId
              , e = h.coupleIds || []
              , n = 0
              , a = _ ? "maleUid" : "femaleUid"
              , s = _ ? "femaleUid" : "maleUid"
              , r = {}
              , l = i ? new P(i) : null;
            {
                var d, c, u;
                f = -1,
                t || w.length !== e.length ? (w.length = 0,
                e.each(function(e, t) {
                    var i = new P(t)
                      , n = h.findUser(i[a])
                      , t = h.findUser(i[s]);
                    n && t && (o(n),
                    o(t),
                    (i = new R(n,t,l && l.maleUid === i.maleUid && l.femaleUid === i.femaleUid)).isTargetCouple && (f = e),
                    w.push(i))
                }),
                console.info(w),
                $.each(r, function(e, t) {
                    n = Math.max(t, n)
                }),
                w.sort(function(e, t) {
                    return e.userIndex === t.userIndex ? e.targetUserIndex === t.targetUserIndex ? e.uuid > t.uuid ? -1 : 1 : e.targetUserIndex < t.targetUserIndex ? -1 : 1 : e.userIndex < t.userIndex ? -1 : 1
                }),
                d = [],
                c = null,
                u = {},
                w.each(function(e, t) {
                    c && c.uid === t.user.uid || (c = {
                        uid: t.user.uid,
                        lines: []
                    },
                    d.push(c)),
                    c.lines.push(t),
                    (u[t.targetUser.uid] || (u[t.targetUser.uid] = {
                        total: 0,
                        i: 0
                    })).total += 1
                }),
                d.each(function(e, t) {
                    var n = t.lines.length;
                    t.lines.each(function(e, t) {
                        var i = u[t.targetUser.uid];
                        t.definePositions(e, n, i.i, i.total),
                        i.i += 1
                    })
                }),
                m = null) : l && w.each(function(e, t) {
                    if (t.getMaleUid() === l.maleUid && t.getFemaleUid() === l.femaleUid)
                        return t.isTargetCouple = !0,
                        f = e,
                        !1
                })
            }
        }(),
        h.subStateId) {
        case r.CHOOSING_PARTNER_FOR_KISS:
            roomView.elsMap.$questionText.text("Выбери {0} тебе нравится".format(_ ? "девушку, которая" : "парня, который")).show(),
            a.setAttr({
                selfMatches: 0,
                matches: 0
            }),
            h.topUsers.each(function(e, t) {
                t.setAttr({
                    canShowSelectBtn: !0
                })
            }),
            w.length = 0,
            O(),
            n.showStage1(),
            roomView.startTimer({
                leftSeconds: Math.floor((h.getLeftTimeOfSubState() - 100) / 1e3)
            }),
            roomView.elsMap.$timer.show();
            break;
        case r.SHOW_ARROWS:
            a.setAttr({
                selfMatches: 0,
                matches: 0
            }),
            h.topUsers.each(function(e, t) {
                t.setAttr({
                    canShowSelectBtn: !1
                })
            }),
            n.showStage2(),
            N(),
            roomView.elsMap.$timer.hide();
            break;
        case r.SHOW_SELF_ARROWS:
            a.setAttr({
                selfMatches: 0,
                matches: w.length
            }),
            h.topUsers.each(function(e, t) {
                t.setAttr({
                    canShowSelectBtn: !1
                })
            }),
            n.showStage3(),
            N({
                withoutRender: !0
            }),
            function() {
                c();
                function n() {
                    e ? t() : d = setTimeout(t, l)
                }
                var e = h.subStateId !== r.SHOW_SELF_ARROWS
                  , o = 0
                  , t = function() {
                    var e, t, i = w[function() {
                        for (var e = -1; o < w.length; o += 1)
                            if (w[o].isMatchWithViewer) {
                                e = o;
                                break
                            }
                        return e
                    }()];
                    i && (o += 1,
                    i.color = S,
                    a.setAttr({
                        selfMatches: a.selfMatches + 1
                    }),
                    O(),
                    n(),
                    e = roomView.getViewerOffset(),
                    t = expController.applyBooster(30),
                    expController.animateBonus({
                        incValue: t,
                        sourceOffset: {
                            left: e.left + 35,
                            top: e.top - 20
                        }
                    }),
                    openCoupleMatchView(i.targetUser.firstNameDat, i.targetUser.uid))
                };
                u(D, !0),
                n()
            }(),
            roomView.elsMap.$timer.hide();
            break;
        case r.VOTING:
            n.showStage4(),
            N({
                withoutRender: !0
            }),
            U(),
            h.topUsers.each(function(e, t) {
                t.setAttr({
                    canShowSelectBtn: !1,
                    voteCounter: 0
                })
            }),
            w.each(function(e, t) {
                t.isMatchWithViewer && t.targetUser.setAttr({
                    canShowSelectBtn: !0
                })
            }),
            roomView.startTimer({
                leftSeconds: Math.floor((h.getLeftTimeOfSubState() - 100) / 1e3)
            }),
            roomView.elsMap.$timer.show();
            break;
        case r.SHOW_RESULT:
            n.showStage5(),
            N({
                withoutRender: !0,
                keepAnimation: !0
            }),
            h.topUsers.each(function(e, t) {
                t.setAttr({
                    canShowSelectBtn: !1
                })
            }),
            roomView.elsMap.$timer.hide(),
            U()
        }
        h.subStateId !== app.RoundSubState.CHOOSING_PARTNER_FOR_KISS ? (roomView.elsMap.$questionText.hide(),
        h.processUsers(function(e, t) {
            t.setAttr({
                isSelectedByViewer: !1
            })
        }),
        roomView.el.addClass(e)) : roomView.el.removeClass(e),
        w.each(function(e, t) {
            t.isMatchWithViewer && t.targetUser.setAttr({
                canShowVoteInfo: h.subStateId === r.VOTING || h.subStateId === r.SHOW_RESULT
            })
        }),
        h.processUsers(function(e, t) {
            t.setAttr({
                pairsRoundModCounter: t.pairsRoundModCounter + 1
            })
        }),
        app.eventBus.trigger(app.EVENTS.UPDATE_GAME_PREVIEW)
    }
    ,
    this.abort = x,
    this.start = function() {
        var e;
        x(),
        E = 1,
        y = 20 * (isMobi ? mobiUiHelper.getRatioOfRoomHeight() : 1),
        M.lineWidth = E,
        t || (t = !0,
        (e = n.el[0].parentNode) && e === roomView.els["main-area"][0] || (roomView.els["arrow-canvas"].append(A),
        roomView.els["main-area"].append(n.el)))
    }
}
,
function() {
    var n = !1;
    app.controllers.UIActivityHandler = function() {
        var e, t, i;
        n || (n = !0,
        t = function() {
            clearTimeout(e),
            e = setTimeout(i, 6e5)
        }
        ,
        i = function() {
            dialogController.showAppRebootDialog({
                message: "Игра перешла в режим ожидания."
            })
        }
        ,
        app.eventBus.on(app.EVENTS.ON_UI_ACTIVITY, t),
        $document.on("click", t),
        $document.on("mousemove", t),
        $document.on("mousedown", t),
        $document.on("mouseup", t),
        $document.on("keypress", t))
    }
}(),
app.controllers.ProfileController = function(a) {
    var e, s, r, l, d = !1, c = this, t = "profile", u = lilo.createView(t), p = a.uid, m = p === app.info.viewer_id, v = {
        profileAccessKey: null,
        isVKLinkHidden: !1,
        isDepositsDisabled: !1,
        isClosedProfile: !1,
        closedOnlyForInvisible: !1,
        isSelfProfile: m,
        likes: !1,
        abg: 0,
        uid: p,
        background: "",
        textColor: "",
        ratingColor: "",
        avatar: "",
        p200: "",
        fullName: "",
        firstName: "",
        first_name_gen: "",
        rating: 0,
        textStatus: null,
        canRemoveFromGuest: !1,
        isBlocked: !!app.info.blockedUids[p],
        wins: 0,
        rg: 0,
        vf: !1,
        sex: 1,
        online: !1,
        roomId: null,
        signIn: 0,
        gameCounter1: 0,
        gameCounter2: 0,
        gameCounter3: 0,
        pid: null,
        age: 0,
        cityName: "",
        regionId: -1,
        countryId: -1,
        exp: 0
    };
    function f(e, t) {
        r = new app.controllers.CommentsController({
            $container: u.$(".comments-area"),
            ownerId: p,
            comments: e,
            profileModel: v,
            targetComment: t,
            bootData: a.bootData
        })
    }
    function h() {
        try {
            u.els.ad.children().trigger("update:agg-profile")
        } catch (e) {}
    }
    function o(n) {
        if (s && s.onOpenProfile(),
        l && l.start(),
        d)
            return $contextArea.append(u.el),
            u.handleShow(),
            socialApi.setLocation("" + util.encodeUid(p)),
            n.targetComment && r && r.scrollToComment(n.targetComment),
            void (n.openAdDialog ? h() : "add-photos-dialog" === n.startAction ? (E(),
            setTimeout(function() {
                c.photosController.openAddPhotos()
            }, 200)) : "go-to-photos" === n.startAction && E(n.targetPid));
        var e, t, i, o;
        m ? (c.recentLikedPhotosController.start(),
        d = !0,
        $contextArea.append(u.el),
        v.setAttr({
            background: a.background,
            rating: a.rating,
            avatar: app.info.photo_200 || app.info.photo_100,
            p200: app.info.photo_200,
            fullName: app.info.first_name + " " + app.info.last_name,
            firstName: app.info.first_name
        }),
        c.photosController.init(),
        u.handleShow(),
        socialApi.setLocation("" + util.encodeUid(p)),
        e = new app.controllers.HaremController({
            $container: u.els.harem,
            $container2: u.els["harem-self"],
            profileModel: v
        }),
        e.start(),
        l = e,
        n.openAdDialog ? h() : "add-photos-dialog" === n.startAction ? (E(),
        setTimeout(function() {
            c.photosController.openAddPhotos()
        }, 200)) : "go-to-photos" === n.startAction ? E(n.targetPid) : "verify" === n.startAction && setTimeout(function() {
            u.els.verificationBtn.click()
        }, 200)) : (t = function(e, t) {
            var i;
            $appLoader.remove(),
            y && (e ? e.code === Codes.NOT_ENOUGH_BALANCE ? (setTimeout(function() {
                app.balanceModel.setAttr({
                    balance: t.balance
                }),
                dialogController.showInsufficientlyBalanceDialog(t.deficit)
            }, 200),
            a.onBackPress ? a.onBackPress() : a.onProfileClose()) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : e.code === Codes.BANNED ? (u.showBannedText(),
            d = !0,
            $contextArea.append(u.el),
            socialApi.setLocation("" + util.encodeUid(p)),
            socialApi.scrollWindow(0)) : (e.code === Codes.USER_NOT_FOUND || e.code === Codes.CLOSED_PROFILE || e.code === Codes.USER_IN_BLACK_LIST ? setTimeout(function() {
                dialogController.showMessageDialog({
                    title: "",
                    message: "Пользователь ограничил доступ к своему профилю",
                    buttons: [{
                        mobiClose: 1,
                        caption: "ОК",
                        handler: function() {
                            return !1
                        }
                    }]
                })
            }, 200) : e.code === Codes.USER_IS_DELETED ? setTimeout(function() {
                dialogController.showMessageDialog({
                    title: "",
                    message: "Пользователь удален",
                    buttons: [{
                        mobiClose: 1,
                        caption: "ОК",
                        handler: function() {
                            return !1
                        }
                    }]
                })
            }, 200) : setTimeout(function() {
                dialogController.showMessageDialog({
                    title: "",
                    message: "Не удалось выполнить запрос"
                })
            }, 200),
            a.onBackPress ? a.onBackPress() : a.onProfileClose()) : (setTimeout(function() {
                socialApi.scrollWindow(0)
            }, 50),
            util.isDef(t.balance) && app.balanceModel.setAttr({
                balance: t.balance
            }),
            $.isFunction(a.onGetProfileSuccess) && a.onGetProfileSuccess(),
            v.setAttr({
                profileAccessKey: t.profileAccessKey || 0,
                isClosedProfile: !!t.isClosedProfile,
                closedOnlyForInvisible: !!t.closedOnlyForInvisible
            }),
            v.setAttr({
                isVKLinkHidden: t.isVKLinkHidden,
                isDepositsDisabled: t.isDepositsDisabled,
                background: t.background,
                rating: t.rating,
                abg: t.abg,
                textStatus: t.status,
                textColor: t.textColor,
                ratingColor: t.ratingColor,
                canRemoveFromGuest: t.canRemoveFromGuest,
                wins: t.wins,
                rg: t.rg,
                gameCounter1: t.gameCounter1,
                gameCounter2: t.gameCounter2,
                gameCounter3: t.gameCounter3,
                age: t.age,
                exp: t.exp,
                sex: t.sex,
                vf: t.vf,
                online: t.online,
                roomId: t.roomId,
                signIn: t.signIn,
                countryId: t.countryId,
                regionId: t.regionId
            }),
            t.roomId && t.roomId.startsWith("3_") && v.setAttr({
                online: !1,
                roomId: null,
                signIn: -1
            }),
            v.setAttr({
                avatar: t.p200 || t.p100,
                p200: t.p200 || t.p100,
                fullName: t.fn + " " + t.ln,
                firstName: t.fn
            }),
            v.first_name = t.fn,
            v.setAttr({
                first_name_gen: t.fnGen || t.fn
            }),
            y && (d = !0,
            $contextArea.append(u.el),
            u.handleShow(),
            util.isDef(t.balance) && app.balanceModel.setAttr({
                balance: t.balance
            }),
            socialApi.setLocation("" + util.encodeUid(p)),
            c.photosController = new app.controllers.PhotosControllers({
                isSelfProfile: m,
                $container: u.els.photos,
                profileModel: v,
                photos: t.photos
            }),
            c.photosController.init(),
            v.setAttr({
                pid: t.pid
            }),
            i = new app.controllers.HaremController({
                $container: u.els.harem,
                profileModel: v,
                harem: t.harem || [],
                owner: t.owner,
                haremPrice: t.haremPrice
            }),
            v.isClosedProfile || i.start(),
            f(t.comments, a.targetComment),
            "go-to-photos" === n.startAction && c.photosController.openPhotos(n.targetPid))))
        }
        ,
        a.targetUserData ? t(null, a.targetUserData) : (i = (i = {}) || {},
        o = (o = {
            requestMinDuration: 200
        }) || {},
        api.user.getInfo($.extend(i, {
            targetUid: p,
            referrer: a.referrer,
            skip_invis: n.skip_invis,
            reduceBalance: a.reduceBalance,
            targetCommentTs: a.targetComment ? a.targetComment.ts : null,
            commentsLimit: a.targetComment ? 5 : null
        }), t).send(o.requestMinDuration || 0)))
    }
    m ? (window.selfProfileController = c,
    v.isVKLinkHidden = a.bootData.isVKLinkHidden,
    s = new app.controllers.GuestsController({
        $container: u.$(".guests-wrap"),
        profileModel: v,
        initialGuests: a.bootData.guests
    }),
    c.photosController = new app.controllers.PhotosControllers({
        isSelfProfile: m,
        $container: u.els.photos,
        profileModel: v,
        photos: a.bootData.photos
    }),
    c.recentLikedPhotosController = new app.controllers.RecentLikedPhotosController({
        isSelfProfile: m,
        $container: u.els["recent-liked-photos"],
        profileModel: v,
        items: a.bootData.recentLikedPhotos
    }),
    v.adByRegion = a.bootData.adByRegion,
    v.adAgeMin = a.bootData.adAgeMin,
    v.adAgeMax = a.bootData.adAgeMax,
    v.exp = a.bootData.exp,
    v.editorIsActivated = a.bootData.editorIsActivated,
    v.abg = a.bootData.abg,
    v.adStatus = a.bootData.adStatus,
    v.price = a.bootData.price,
    v.targetSex = a.bootData.targetSex,
    v.leftValues = a.bootData.leftValues,
    v.received = a.bootData.received,
    v.textStatus = a.bootData.status,
    v.textColor = a.bootData.textColor,
    v.ratingColor = a.bootData.ratingColor,
    v.colorTs = a.bootData.colorTs,
    v.colorPeriod = a.bootData.colorPeriod,
    v.guestsToday = a.bootData.guestsToday,
    v.newGuestsCount = a.bootData.newGuestsCount,
    v.photoViewsToday = a.bootData.photoViewsToday,
    v.totalGuests = a.bootData.totalGuests,
    v.totalPhotoViews = a.bootData.totalPhotoViews,
    v.regionId = a.bootData.regionId,
    v.countryId = a.bootData.countryId,
    v.wins = a.bootData.wins,
    v.rg = a.bootData.rg,
    v.gameCounter1 = a.bootData.gameCounter1,
    v.gameCounter2 = a.bootData.gameCounter2,
    v.gameCounter3 = a.bootData.gameCounter3,
    v.age = app.info.age,
    v.vf = app.commonState.verified,
    v.sex = app.info.sex,
    v.first_name_gen = app.info.first_name_gen,
    app.info.cityName && (v.cityName = app.info.cityName),
    app.commonState.onChange("photo100", function() {
        v.setAttr({
            avatar: app.commonState.photo100
        })
    }),
    app.commonState.onChange("photo200", function() {
        v.setAttr({
            p200: app.commonState.photo100
        })
    }),
    app.commonState.onChange("verified", function() {
        v.setAttr({
            vf: app.commonState.verified
        })
    }),
    (app.viewerProfile = v).followersStat = app.info.followersStat,
    app.eventBus.on(app.EVENTS.VIEWER_GAME_COUNTER_CHANGES, function(e) {
        var t = e.id
          , i = e.value;
        "1" !== t && "2" !== t && "3" !== t || ((e = {})["gameCounter" + t] = i,
        v.setAttr(e))
    }),
    app.eventBus.on(app.EVENTS.VIEWER_ROOM_GIFTS_CHANGES, function(e) {
        v.setAttr({
            rg: e.value
        })
    }),
    app.eventBus.on(app.EVENTS.VIEWER_ROOM_WINS_CHANGES, function(e) {
        v.setAttr({
            wins: e.value
        })
    }),
    app.eventBus.on(app.EVENTS.AGE_CHANGED, function(e) {
        v.setAttr({
            age: e.age
        })
    }),
    expController.on(expController.EVENTS.EXP_CHANGED, function(e) {
        v.setAttr({
            exp: e.exp
        })
    })) : v.canAddComment = !0,
    c.model = v,
    u.setModel(v),
    $.isFunction(a.onBackPress) && (u.showBack(),
    u.on("back:" + t, function() {
        a.onBackPress()
    })),
    m ? (window.profileModel = v,
    f(a.bootData.comments)) : window.currentProfileController = this,
    u.bind("open-photos-with-avatar", function(e) {
        c.photosController.openPhotos(e.extraData.pid)
    }),
    u.bind("open-closed-profile", function(e) {
        app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: v.uid,
            skip_invis: !0
        })
    });
    var i = !1;
    u.el.on("click", ".switch-version", function() {
        i || (i = 1,
        ServerApi("user/mobiTest.php", {
            value: !1
        }, function(e, t) {
            i = !1,
            e ? dialogController.showError(e) : setTimeout(function() {
                window.location.reload()
            }, 100)
        }))
    });
    var g = function(i) {
        g.pending || ServerApi("deposits/info.php", {
            uid: v.uid
        }, function(e, t) {
            g.pending = !1,
            e || (v.__depositInfo = t || {},
            i(v.__depositInfo),
            m && setTimeout(function() {
                v.__depositInfo = null
            }, 3e4))
        })
    }
      , b = !1;
    u.bind("buy-deposit", function(n) {
        var t;
        b || (t = function(e) {
            var f, t = expController.getCurrentLevel(), i = expController.expToLevel(v.exp);
            e || i <= 2 * t ? ((f = n.extraData.el).addClass("btn-loading"),
            g(function() {
                f.removeClass("btn-loading");
                function i() {
                    return e.haremUids.contains(v.uid) || v.uid === app.info.viewer_id
                }
                var n = lilo.createView("dialog-buy-deposit")
                  , e = v.__depositInfo || {}
                  , t = e.deposit || {
                    id: v.uid
                }
                  , o = e.expOf15Minutes || 0
                  , a = e.expOfHour || 0
                  , s = e.expOf3Hours || 0
                  , r = function(e) {
                    return Math.floor(e / Constants.FRIENDS_EXCHANGE_EXP_RATE)
                }
                  , l = t.estimatedTimeOfEnd || -1
                  , d = r(o)
                  , c = r(a)
                  , u = r(s)
                  , r = e.utc || util.currentUtcMillis()
                  , r = util.calcPriceOfDeposit(r, t);
                n.setModel({
                    depositIsExists: t.ownerId === app.info.viewer_id,
                    hasOwner: 0 < t.ownerId,
                    isFriend: i(),
                    name: v.firstName,
                    price: r,
                    sex: v.sex,
                    expOf15Minutes: o,
                    expOfHour: a,
                    expOf3Hours: s,
                    estimatedTimeOfEnd: l,
                    profitOf15Minutes: d,
                    profitOfHour: c,
                    profitOf3Hours: u
                }),
                dialogController.open(n, {
                    dialogClass: "no-padding"
                });
                function p() {
                    app.eventBus.trigger(app.EVENTS.OPEN_EXCHANGE_FRIENDS, {
                        openDeposits: !0
                    })
                }
                n.bind("open-deposits", function() {
                    dialogController.close(n),
                    p()
                }),
                n.bind("submit", function() {
                    var e;
                    app.balanceModel.canChange() && app.sdk.viewComponents.depositsPurchase({
                        isFriend: i(),
                        targetUid: v.uid,
                        hasOwner: n.model.hasOwner,
                        onError: function(e, t) {
                            e.code === Codes.ACCESS_DENIED && t.leftMillis && !i() && (n.model.setAttr({
                                hasOwner: !0,
                                estimatedTimeOfEnd: util.serverUtc() + t.leftMillis
                            }),
                            n.updateViewModel())
                        },
                        errorHandlers: ((e = {})[Codes.LIMIT] = function(e, t) {
                            dialogController.showMessageDialog({
                                message: "У вас нет свободной ячейки для этого игрока. Необходимо сначала освободить ячейку на Бирже",
                                buttons: [{
                                    caption: "Перейти на Биржу",
                                    handler: function() {
                                        return p(),
                                        dialogController.close(n),
                                        !1
                                    }
                                }, {
                                    caption: "Закрыть",
                                    handler: function() {
                                        return !1
                                    }
                                }]
                            })
                        }
                        ,
                        e),
                        onSuccess: function(e) {
                            dialogController.close(n),
                            p(),
                            m && (v.__depositInfo = null)
                        }
                    })
                })
            })) : dialogController.showMessageDialog({
                message: "Вы можете бронировать игроков, чей уровень не выше " + 2 * t
            })
        }
        ,
        v.isClosedProfile,
        b = 1,
        webSocketController.sendMessage({
            action: "deposit/canBuy",
            target_uid: v.uid
        }, {}, function(e) {
            b = 0;
            e = e.code;
            t(200 === e)
        }))
    }),
    u.bind("send-private-message", function(e) {
        var t = e.extraData.type
          , e = app.balanceModel.balance - (100 === t ? 3 : 1);
        e < 0 ? dialogController.showInsufficientlyBalanceDialog(e) : new app.controllers.dialog.RoomPrivateMessage({
            roomModel: roomModel,
            roomView: roomView,
            type: t,
            targetUid: v.uid,
            fromProfile: !0
        })
    }),
    u.bind("change-avatar", function() {
        var e;
        !!app.commonState.pid || app.commonState.verificationPhoto && 3 === app.commonState.verificationPhoto.s ? E() : (e = [],
        app.canVerify() && e.push({
            caption: "Пройти вeрификацию",
            handler: function() {
                return new app.controllers.dialog.VerificationStatus,
                !1
            }
        }),
        dialogController.showMessageDialog({
            message: "Чтобы установить другое фото в качестве аватара, необходимо пройти верификацию",
            buttons: e
        }))
    }),
    u.bind("change-avatar-area", function() {
        var e = c.photosController.findPhoto(app.commonState.pid);
        e ? 3 === e.status ? (e = {
            id: e.id,
            url: e.url,
            pending: !1
        },
        lilo.makeObservable(e),
        c.photosController.setPhotoAsAvatar({
            extraData: {
                model: e
            }
        })) : dialogController.showMessageDialog({
            message: "Вы не можете ставить на аватар неодобренное фото"
        }) : dialogController.showMessageDialog({
            message: "Вы удалили исходное фото, с которой можно сделать миниатюру"
        })
    });
    var C, _ = !1;
    function w(e) {
        m || v.setAttr({
            canRemoveFromGuest: e.invis
        })
    }
    function E(t) {
        setTimeout(function() {
            var e = u.els.photos.offset();
            e && (e = 40 + e.top,
            socialApi.scrollWindow(e),
            t && c.photosController.openPhotos(t))
        }, 100)
    }
    u.bind("reset-avatar", function(e) {
        var i, n;
        _ || (_ = !0,
        i = app.info.photo_100,
        n = app.info.photo_200,
        v.setAttr({
            avatar: app.info.vkPhoto200 || app.info.vkPhoto100,
            p200: app.info.vkPhoto200
        }),
        ServerApi("avatar/reset.php", {
            p_100: app.info.vkPhoto100,
            p_200: app.info.vkPhoto200
        }, function(e, t) {
            _ = !1,
            e ? (dialogController.showError(e),
            v.setAttr({
                avatar: i,
                p200: n
            })) : (dialogController.fadePopup("Аватар обновлен"),
            app.commonState.setAttr({
                pid: null,
                photo100: app.info.vkPhoto100,
                photo200: app.info.vkPhoto200,
                verified: !1
            }))
        }))
    }),
    u.bind("update-name", function() {
        app.controllers.dialog.updateName.open({
            checkData: !0
        })
    }),
    u.on("join:" + t, function() {
        var i = function() {
            api.roomV3.getRoom({
                sid: app.info.appSid,
                force: !0,
                target_uid: p,
                skip_restrictions: socialApi.isFriend(p),
                beforeSend: ajaxLoader.show
            }, function(e, t) {
                ajaxLoader.hide(),
                e ? e.code === Codes.TOO_FREQ_ROOM_SWITCH ? dialogController.showDialogRoomSwitchTooFreq(t ? t.left : 0, {
                    paymentJoin: i,
                    price: (t || {}).price
                }) : e.code === Codes.NOT_ENOUGH_EXP_TO_ADD_ROOM ? dialogController.showMessageDialog({
                    message: "У Вас недостаточно рейтинга, чтобы попасть в эту комнату"
                }) : e.code === Codes.ROOM_QUEUE_IS_FULL ? dialogController.showMessageDialog({
                    message: "Не удалось подключиться к комнате. Очередь заполнена"
                }) : e.code === Codes.ACCESS_DENIED ? dialogController.showMessageDialog({
                    message: "Не удалось подключиться к комнате"
                }) : e.code === Codes.LEAVE_FROM_CURRENT_ROOM_IS_NOT_ALLOWED ? roomController.onLeaveRoomIsNotAllowed(e.requestParams) : e.code === Codes.ROOM_ACCESS_DESCR ? dialogController.roomExpLimitDialog(t) : e.code === Codes.USER_IN_BLACK_LIST ? dialogController.showMessageDialog({
                    message: "Невозможно войти в комнату"
                }) : e.code === Codes.NO_ACCESS_TO_ROOM ? dialogController.showNoAccessToRoom({
                    leftMillis: t.leftTime
                }) : e.code === Codes.USER_NOT_FOUND ? (v.setAttr({
                    online: !1
                }),
                dialogController.showMessageDialog({
                    message: "Не удалось подключиться к комнате. Пользователь вышел"
                })) : dialogController.showMessageDialog({
                    message: "Не удалось подключиться к комнате. Произошла ошибка. <br/>Code:" + e.code
                }) : app.eventBus.trigger(app.EVENTS.JOIN_TO_ROOM, {
                    data: t
                })
            }).send(util.random(300, 450))
        };
        i()
    }),
    u.on("change-text-status:" + t, function() {
        var n, e;
        v.isSelfProfile && (e = "dialog-change-text-status",
        (n = lilo.createView(e)).on("ok:" + e, function(e) {
            var e = $.trim(e.extraData.text)
              , i = api.user.changeStatus({
                text: e,
                beforeSend: function() {
                    n.showLoader()
                }
            }, function(e, t) {
                n.hideLoader(),
                e ? (e.loc = "profile. change status",
                dialogController.showError(e, i)) : (dialogController.close(n),
                v.setAttr({
                    textStatus: t.text
                }))
            });
            i.send(util.random(100, 300))
        }),
        e = "",
        v.textStatus && (e = $("<div />").html(v.textStatus).text()),
        n.setModel({
            text: e
        }),
        dialogController.open(n),
        n.els.input.focus())
    }),
    u.on("select-img:" + t, function(e) {
        if (!IS_SUPPORT_IMAGE_EDITOR)
            return dialogController.warn({
                message: "Вaш браузер не поддерживает данную функцию.<br><br>Воспользуйтесь последней версией браузера<br><a class='link' target='_blank' href='https://www.google.ru/intl/ru/chrome/browser/'>Google Chrome</a> или <a class='link' target='_blank' href='https://www.mozilla.org/ru/firefox/new/'>Mozilla Firefox</a>"
            }),
            !1;
        util.readImage(e.extraData.fileList, function(e) {
            u.swapInputImage(),
            e ? new app.controllers.ImageEditor({
                image: e,
                cropWidth: 1600,
                cropHeight: 400,
                scale: .375,
                resultContentType: "image/jpeg",
                onOk: function(e) {
                    new app.controllers.ProfileBGUploader({
                        base64: e,
                        onSuccess: function(e) {
                            v.setAttr({
                                background: e
                            })
                        }
                    })
                }
            }) : dialogController.showMessageDialog({
                message: "Изображение не выбрано"
            })
        })
    }),
    u.on("show-color-picker:" + t, function(e) {
        dialogController.openSubscribeDialog({
            type: e.extraData.updateRating ? app.SUBSCRIBE_TYPES.RATING_COLOR : app.SUBSCRIBE_TYPES.TEXT_COLOR
        })
    }),
    u.on("rating-explain:" + t, function() {
        dialogController.showMessageDialog({
            message: "<strong>Рейтинг</strong> - это показатель вашего положения в игре. Чем выше ваш рейтинг, тем больше возможностей вам доступно.",
            justifyMessage: !0
        })
    }),
    u.on("show-rating-dialog:" + t, function() {
        var e, t;
        m && ((e = lilo.createView("dialog-popularity")).setModel(v),
        (t = dialogController.open(e)).els.close.hide(),
        t.els.dialogWrap.css({
            background: "#f2f2f2",
            "border-color": "#f2f2f2"
        }),
        setTimeout(function() {
            e.animateProgress(function() {
                t.els.close.show()
            })
        }, 300))
    }),
    u.on("change-age:" + t, function() {
        dialogController.ageDialog()
    }),
    u.bind("toggle-block", function(e) {
        var t, i = e.extraData.model;
        i.pending || (i.setAttr({
            pending: !0
        }),
        t = !!app.info.blockedUids[p],
        webSocketController.sendMessage({
            action: "user/toggleBan",
            target_uid: p,
            value: !t
        }, {}, function(e) {
            i.setAttr({
                pending: !1
            }),
            e.code === Codes.OK && (app.eventBus.trigger(t ? app.EVENTS.USER_UNBLOCKED : app.EVENTS.USER_BLOCKED, {
                uid: p
            }),
            dialogController.fadePopup({
                message: "Пользователь {0}".format(t ? "разблокирован" : "заблокирован")
            }),
            v.setAttr({
                isBlocked: !t
            }))
        }))
    }),
    u.bind("toggle-fav", function(e) {
        var i, n = e.extraData.model;
        n.pending || (n.setAttr({
            pending: !0
        }),
        i = v.uid,
        (app.info.favUsersUids[i] ? api.user.removeFromFav({
            targetUid: i
        }, function(e, t) {
            n.setAttr({
                pending: !1
            }),
            e ? dialogController.fadePopup({
                message: "Не удалось удалить пользователя из избранного"
            }) : (app.eventBus.trigger(app.EVENTS.USER_REMOVED_FROM_FAV, {
                uid: i
            }),
            n.setAttr({
                isFav: !1
            }))
        }) : api.user.addToFav({
            targetUid: i
        }, function(e, t) {
            n.setAttr({
                pending: !1
            }),
            e ? e.code === Codes.MAX_FAVORITE_USERS_REACHED ? dialogController.showMessageDialog({
                message: "Достигнут лимит избранных пользователей"
            }) : dialogController.fadePopup({
                message: "Не удалось добавить пользователя в избранное"
            }) : (app.eventBus.trigger(app.EVENTS.USER_ADDED_TO_FAV, {
                uid: i
            }),
            n.setAttr({
                isFav: !0
            }),
            dialogController.fadePopup({
                message: "Пользователь добавлен в избранное"
            }))
        })).send(util.random(200, 300)))
    }),
    u.on("toggle-profile-access:" + t, function() {
        var n = lilo.createView("dialog-toggle-vklink-access")
          , t = app.commonState.verified;
        n.setModel({
            pending: !1,
            checked: !(!t || !v.isVKLinkHidden),
            disabled: !t
        }),
        dialogController.open(n, {
            dialogClass: "no-padding"
        }),
        n.bind("save", function(e) {
            var i = e.extraData.checked;
            n.model.setAttr({
                pending: !0
            }),
            i !== n.model.checked && t ? ServerApi("user/vkaccess/toggle.php", {
                flag: i
            }, function(e, t) {
                n.model.setAttr({
                    pending: !1
                }),
                e ? dialogController.showError(e) : (dialogController.close(n),
                v.setAttr({
                    isVKLinkHidden: i
                }),
                dialogController.fadePopup("Настройка обновлена!"))
            }) : dialogController.close(n)
        })
    }),
    u.on("toggle-vk-levels:" + t, function() {
        var n = lilo.createView("dialog-toggle-vk-levels");
        n.setModel({
            pending: !1,
            checked: app.commonState.lvd
        }),
        dialogController.open(n, {
            dialogClass: "no-padding"
        }),
        n.bind("save", function(e) {
            var i = e.extraData.checked;
            n.model.setAttr({
                pending: !0
            }),
            i !== n.model.checked ? ServerApi("user/vklevels/toggle.php", {
                is_disabled: i
            }, function(e, t) {
                n.model.setAttr({
                    pending: !1
                }),
                e ? dialogController.showError(e) : (dialogController.close(n),
                app.commonState.lvd = i,
                dialogController.fadePopup("Настройка обновлена!"))
            }) : dialogController.close(n)
        })
    }),
    u.on("change-region:" + t, function() {
        new app.controllers.dialog.Regions({
            currentCountryId: app.info.countryId,
            currentRegionId: app.info.regionId
        })
    }),
    u.on("open-avatar-dialog:" + t, function() {
        dialogController.openSubscribeDialog({
            type: app.SUBSCRIBE_TYPES.AVATAR_BG
        })
    }),
    u.bind("open-special-users-dialog", function() {
        (new app.controllers.SpecialUsersController).openDialog()
    }),
    u.on("remove-self-from-guests:" + t, function(e) {
        var n, o;
        m || (n = e.extraData.$targetEl,
        (o = function(e) {
            var i = api.user.removeSelfFromGuest({
                targetUid: v.uid,
                force: e,
                beforeSend: function() {
                    n.addClass("loading")
                }
            }, function(e, t) {
                n.removeClass("loading"),
                e ? e.code === Codes.ACCESS_DENIED ? dialogController.warn({
                    message: v.fullName + " уже видел" + (2 === v.sex ? "" : "a") + ", что вы заходили сегодня",
                    buttons: [{
                        caption: "Все равно удалить",
                        handler: function() {
                            return o(!0),
                            !1
                        }
                    }, {
                        caption: "Закрыть",
                        handler: function() {
                            return !1
                        }
                    }]
                }) : e.code === Codes.INVISIBLE_NOT_BOUGHT ? (v.setAttr({
                    canRemoveFromGuest: !1
                }),
                app.eventBus.trigger(app.EVENTS.INVISIBILITY_EXPIRED)) : dialogController.showError(e, i) : v.setAttr({
                    canRemoveFromGuest: !1
                })
            });
            i.send(util.random(100, 300))
        }
        )(!1))
    }),
    c.scrollToPhotos = E;
    var y = !1;
    c.start = function(t) {
        try {
            socialApi.setAppWidth(800),
            $appLoader.remove(),
            y = !0,
            (t = t || {}).startAction && (C = 0),
            o(t)
        } catch (e) {
            t = (i = "https://sapps-static.ru/build/out/",
            n = "",
            e.stack.replace(new RegExp(i,"g"), n));
            dialogController.showMessageDialog({
                message: "При загрузке профиля произошла ошибка<br><div style='text-align: left;' class='f_s_11'>" + t + "</div>"
            })
        }
        var i, n;
        C && (clearTimeout(e),
        e = setTimeout(function() {
            socialApi.scrollWindow(C)
        }, 50)),
        app.eventBus.on(app.EVENTS.INVISIBILITY_STATE_CHANGED, w)
    }
    ,
    c.stop = function() {
        y = !1,
        s && s.onCloseProfile(),
        m ? (C = socialApi.getScroll(),
        u.el.detach()) : (u.remove(),
        r && r.stop && r.stop()),
        socialApi.setLocation("" + util.encodeUid(p)),
        clearTimeout(void 0),
        app.eventBus.off(app.EVENTS.INVISIBILITY_STATE_CHANGED, w)
    }
}
,
function() {
    var e, c = CDN_PREFIX + "v1/fire-sprite-sheet-v6.png", u = CDN_PREFIX + "v1/fire-sprite-sheet-v5.png", p = [], t = 0, i = function() {
        for (e = +new Date,
        t = 0; t < p.length; t += 1)
            p[t].update(e);
        requestAnimationFrame(i)
    };
    i();
    var f = function(e) {
        return 130 * -e + "px 0px"
    };
    app.controllers.ExpBoosterFlameController = function() {
        isMobi && (f = function(e) {
            return 26 * -e + "vw 0"
        }
        ),
        this.init = function(e, t) {
            function i() {
                return 10 < t.model.level && t.model.level % 10 == 0
            }
            function n() {
                a.backgroundImage = "url(" + (d ? c : u) + ")"
            }
            var o, a = e[0].style, s = 0, r = !1, l = 0, d = i();
            n(),
            p.push({
                update: function(e) {
                    62.5 <= e - l && (l = e,
                    t.isVisible() ? (16 === ++s && (s = 0),
                    a.backgroundPosition = f(s),
                    r || (r = !0,
                    a.display = "block"),
                    (o = i()) != d && (d = o,
                    n())) : r && (r = !1,
                    a.display = "none"))
                }
            })
        }
    }
}(),
function() {
    var t = new app.sdk.ResourceProvider({
        cacheTtl: 3e5,
        provideResource: function(t, n) {
            VKApi("photos.getAlbums", {
                need_system: 1,
                need_covers: 1,
                v: "5.120"
            }, function(e) {
                var i;
                e.error ? n(e.error) : (i = [],
                e.response.items.each(function(e, t) {
                    t.size && i.push({
                        id: t.id,
                        url: t.thumb_src,
                        title: t.title,
                        size: t.size
                    })
                }),
                t(i))
            })
        }
    })
      , l = new app.sdk.ResourceProvider({
        cacheTtl: 3e5,
        provideResource: function(t, i, n) {
            function o(e) {
                VKApi("photos.get", {
                    album_id: n.album.id,
                    offset: e,
                    photo_sizes: 1,
                    count: 1e3
                }, function(e) {
                    e.error ? s || (s = !0,
                    i(e.error)) : (e.response.items.each(function(e, i) {
                        i.sizes && i.sizes.each(function(e, t) {
                            switch (t.type) {
                            case "s":
                                i.photo_75 = t.src || t.url;
                                break;
                            case "m":
                                i.photo_130 = t.src || t.url;
                                break;
                            case "x":
                                i.photo_604 = t.src || t.url
                            }
                        })
                    }),
                    e.response.items.each(function(e, t) {
                        r.push({
                            id: t.id,
                            photo_130: t.photo_130,
                            photo_604: t.photo_604,
                            photo_807: t.photo_807,
                            date: t.date
                        })
                    }),
                    0 == --a && (r.sort(function(e, t) {
                        return e.date === t.date ? 0 : e.date > t.date ? -1 : 1
                    }),
                    t(r)))
                }, "5.120")
            }
            var e = n.album.size
              , a = Math.ceil(e / 1e3)
              , s = !1
              , r = [];
            util.repeat(a, function(e) {
                o(1e3 * e)
            })
        }
    });
    app.controllers.SelectPhotosController = function(i) {
        var n = (i = i || {}).urlHash || {}
          , o = lilo.createView("dialog-select-photos")
          , a = {}
          , s = {
            pending: !1,
            maxSelectedPhotosSize: i.maxSelectedPhotosSize && 0 < i.maxSelectedPhotosSize ? i.maxSelectedPhotosSize : 10,
            selectedPhotosSize: 0,
            albums: [],
            photos: []
        };
        o.setModel(s);
        function e() {
            s.albums.length ? o.showSlide(3) : (o.showSlide(1),
            t.get(function(e) {
                o.showSlide(3),
                s.albums.add(e)
            }, function(e) {
                dialogController.showError(e)
            }))
        }
        function r(e, t) {
            s.setAttr({
                pending: !0
            }),
            ServerApi("photo/add.php", {
                method: "POST",
                pids: t.join(","),
                imgs: e.join(",")
            }, function(e, t) {
                s.setAttr({
                    pending: !1
                }),
                e ? e.code === Codes.INVALID_VK_HOST ? dialogController.showMessageDialog({
                    message: "Ошибка при загрузке фото.<br>Пожалуйста сообщите об этом в группе<br>Invalid vk hosts:<br>" + t.urls.join("<br>")
                }) : dialogController.showError(e) : (dialogController.fadePopup("Фото успешно добавлены!"),
                dialogController.close(o),
                i.onAddPhotos && i.onAddPhotos(t.photos))
            })
        }
        o.on("select-album:item-album", function(e) {
            e = e.extraData.model,
            o.showSlide(1),
            l.get(function(e) {
                e.each(function(e, t) {
                    t.selected = !!a[t.id],
                    t.existing = !!n[t.photo_604]
                }),
                s.photos.removeAll(),
                s.photos.add(e),
                o.showSlide(2)
            }, function(e) {
                dialogController.showError(e)
            }, {
                album: e,
                cacheKey: e.id + "-"
            })
        }),
        o.on("select-photo:item-photo-for-select", function(e) {
            var t = e.extraData.model;
            if (!i.onSelectPhoto)
                return isMobi ? (t.setAttr({
                    selected: !0
                }),
                void new app.controllers.MobilePopup({
                    cancel: {
                        handler: function() {
                            t.setAttr({
                                selected: !1
                            })
                        }
                    },
                    btns: [{
                        title: "Подтвердить выбор",
                        handler: function() {
                            return t.setAttr({
                                selected: !1
                            }),
                            r([t.photo_604], [t.id]),
                            !1
                        }
                    }]
                })) : void (t.selected ? (t.setAttr({
                    selected: !1
                }),
                s.setAttr({
                    selectedPhotosSize: s.selectedPhotosSize - 1
                }),
                delete a[t.id]) : s.selectedPhotosSize < s.maxSelectedPhotosSize && (t.setAttr({
                    selected: !0
                }),
                s.setAttr({
                    selectedPhotosSize: s.selectedPhotosSize + 1
                }),
                a[t.id] = t));
            i.onSelectPhoto(t)
        }),
        o.bind("show-albums", e),
        o.bind("submit", function() {
            var i, n;
            s.selectedPhotosSize && (i = [],
            n = [],
            $.each(a, function(e, t) {
                i.push(t.photo_604),
                n.push(e)
            }),
            r(i, n))
        }),
        this.start = function() {
            window.dialogSelectPhotosWindow = dialogController.open(o, {
                dialogClass: "small-close no-padding",
                mobiFullHeight: 1
            }),
            e()
        }
        ,
        this.stop = function() {
            dialogController.close(o),
            delete window.dialogSelectPhotosWindow
        }
        ,
        this.dialogView = o
    }
}(),
function(e) {
    "object" == typeof exports && "undefined" != typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define([], e) : ("undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this).adapter = e()
}(function() {
    return function n(o, a, s) {
        function r(i, e) {
            if (!a[i]) {
                if (!o[i]) {
                    var t = "function" == typeof require && require;
                    if (!e && t)
                        return t(i, !0);
                    if (l)
                        return l(i, !0);
                    t = new Error("Cannot find module '" + i + "'");
                    throw t.code = "MODULE_NOT_FOUND",
                    t
                }
                t = a[i] = {
                    exports: {}
                };
                o[i][0].call(t.exports, function(e) {
                    var t = o[i][1][e];
                    return r(t || e)
                }, t, t.exports, n, o, a, s)
            }
            return a[i].exports
        }
        for (var l = "function" == typeof require && require, e = 0; e < s.length; e++)
            r(s[e]);
        return r
    }({
        1: [function(e, t, i) {
            var x = e("sdp");
            function s(e, t, i, n, o) {
                t = x.writeRtpDescription(e.kind, t);
                return t += x.writeIceParameters(e.iceGatherer.getLocalParameters()),
                t += x.writeDtlsParameters(e.dtlsTransport.getLocalParameters(), "offer" === i ? "actpass" : o || "active"),
                t += "a=mid:" + e.mid + "\r\n",
                e.rtpSender && e.rtpReceiver ? t += "a=sendrecv\r\n" : e.rtpSender ? t += "a=sendonly\r\n" : e.rtpReceiver ? t += "a=recvonly\r\n" : t += "a=inactive\r\n",
                e.rtpSender && (o = e.rtpSender._initialTrackId || e.rtpSender.track.id,
                e.rtpSender._initialTrackId = o,
                t += "a=" + (o = "msid:" + (n ? n.id : "-") + " " + o + "\r\n"),
                t += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " " + o,
                e.sendEncodingParameters[0].rtx && (t += "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " " + o,
                t += "a=ssrc-group:FID " + e.sendEncodingParameters[0].ssrc + " " + e.sendEncodingParameters[0].rtx.ssrc + "\r\n")),
                t += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " cname:" + x.localCName + "\r\n",
                e.rtpSender && e.sendEncodingParameters[0].rtx && (t += "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " cname:" + x.localCName + "\r\n"),
                t
            }
            function p(n, o) {
                function a(e, t) {
                    e = parseInt(e, 10);
                    for (var i = 0; i < t.length; i++)
                        if (t[i].payloadType === e || t[i].preferredPayloadType === e)
                            return t[i]
                }
                var s = {
                    codecs: [],
                    headerExtensions: [],
                    fecMechanisms: []
                };
                return n.codecs.forEach(function(i) {
                    for (var e = 0; e < o.codecs.length; e++) {
                        var t = o.codecs[e];
                        if (i.name.toLowerCase() === t.name.toLowerCase() && i.clockRate === t.clockRate && ("rtx" !== i.name.toLowerCase() || !i.parameters || !t.parameters.apt || function(e, t, i, n) {
                            i = a(e.parameters.apt, i),
                            n = a(t.parameters.apt, n);
                            return i && n && i.name.toLowerCase() === n.name.toLowerCase()
                        }(i, t, n.codecs, o.codecs))) {
                            (t = JSON.parse(JSON.stringify(t))).numChannels = Math.min(i.numChannels, t.numChannels),
                            s.codecs.push(t),
                            t.rtcpFeedback = t.rtcpFeedback.filter(function(e) {
                                for (var t = 0; t < i.rtcpFeedback.length; t++)
                                    if (i.rtcpFeedback[t].type === e.type && i.rtcpFeedback[t].parameter === e.parameter)
                                        return !0;
                                return !1
                            });
                            break
                        }
                    }
                }),
                n.headerExtensions.forEach(function(e) {
                    for (var t = 0; t < o.headerExtensions.length; t++) {
                        var i = o.headerExtensions[t];
                        if (e.uri === i.uri) {
                            s.headerExtensions.push(i);
                            break
                        }
                    }
                }),
                s
            }
            function a(e, t, i) {
                return -1 !== {
                    offer: {
                        setLocalDescription: ["stable", "have-local-offer"],
                        setRemoteDescription: ["stable", "have-remote-offer"]
                    },
                    answer: {
                        setLocalDescription: ["have-remote-offer", "have-local-pranswer"],
                        setRemoteDescription: ["have-local-offer", "have-remote-pranswer"]
                    }
                }[t][e].indexOf(i)
            }
            function R(e, t) {
                var i = e.getRemoteCandidates().find(function(e) {
                    return t.foundation === e.foundation && t.ip === e.ip && t.port === e.port && t.priority === e.priority && t.protocol === e.protocol && t.type === e.type
                });
                return i || e.addRemoteCandidate(t),
                !i
            }
            function f(e, t) {
                t = new Error(t);
                return t.name = e,
                t.code = {
                    NotSupportedError: 9,
                    InvalidStateError: 11,
                    InvalidAccessError: 15,
                    TypeError: void 0,
                    OperationError: void 0
                }[e],
                t
            }
            t.exports = function(I, M) {
                function O(e, t) {
                    t.addTrack(e),
                    t.dispatchEvent(new I.MediaStreamTrackEvent("addtrack",{
                        track: e
                    }))
                }
                function o(e, t, i, n) {
                    var o = new Event("track");
                    o.track = t,
                    o.receiver = i,
                    o.transceiver = {
                        receiver: i
                    },
                    o.streams = n,
                    I.setTimeout(function() {
                        e._dispatchEvent("track", o)
                    })
                }
                function n(e) {
                    var t, n, o, i = this, a = document.createDocumentFragment();
                    if (["addEventListener", "removeEventListener", "dispatchEvent"].forEach(function(e) {
                        i[e] = a[e].bind(a)
                    }),
                    this.canTrickleIceCandidates = null,
                    this.needNegotiation = !1,
                    this.localStreams = [],
                    this.remoteStreams = [],
                    this._localDescription = null,
                    this._remoteDescription = null,
                    this.signalingState = "stable",
                    this.iceConnectionState = "new",
                    this.connectionState = "new",
                    this.iceGatheringState = "new",
                    e = JSON.parse(JSON.stringify(e || {})),
                    this.usingBundle = "max-bundle" === e.bundlePolicy,
                    "negotiate" === e.rtcpMuxPolicy)
                        throw f("NotSupportedError", "rtcpMuxPolicy 'negotiate' is not supported");
                    switch (e.rtcpMuxPolicy || (e.rtcpMuxPolicy = "require"),
                    e.iceTransportPolicy) {
                    case "all":
                    case "relay":
                        break;
                    default:
                        e.iceTransportPolicy = "all"
                    }
                    switch (e.bundlePolicy) {
                    case "balanced":
                    case "max-compat":
                    case "max-bundle":
                        break;
                    default:
                        e.bundlePolicy = "balanced"
                    }
                    if (e.iceServers = (t = e.iceServers || [],
                    n = M,
                    o = !1,
                    (t = JSON.parse(JSON.stringify(t))).filter(function(e) {
                        if (e && (e.urls || e.url)) {
                            var t = e.urls || e.url;
                            e.url && !e.urls && console.warn("RTCIceServer.url is deprecated! Use urls instead.");
                            var i = "string" == typeof t
                              , t = (t = i ? [t] : t).filter(function(e) {
                                return 0 !== e.indexOf("turn:") || -1 === e.indexOf("transport=udp") || -1 !== e.indexOf("turn:[") || o ? 0 === e.indexOf("stun:") && 14393 <= n && -1 === e.indexOf("?transport=udp") : o = !0
                            });
                            return delete e.url,
                            e.urls = i ? t[0] : t,
                            !!t.length
                        }
                    })),
                    this._iceGatherers = [],
                    e.iceCandidatePoolSize)
                        for (var s = e.iceCandidatePoolSize; 0 < s; s--)
                            this._iceGatherers.push(new I.RTCIceGatherer({
                                iceServers: e.iceServers,
                                gatherPolicy: e.iceTransportPolicy
                            }));
                    else
                        e.iceCandidatePoolSize = 0;
                    this._config = e,
                    this.transceivers = [],
                    this._sdpSessionId = x.generateSessionId(),
                    this._sdpSessionVersion = 0,
                    this._dtlsRole = void 0,
                    this._isClosed = !1
                }
                Object.defineProperty(n.prototype, "localDescription", {
                    configurable: !0,
                    get: function() {
                        return this._localDescription
                    }
                }),
                Object.defineProperty(n.prototype, "remoteDescription", {
                    configurable: !0,
                    get: function() {
                        return this._remoteDescription
                    }
                }),
                n.prototype.onicecandidate = null,
                n.prototype.onaddstream = null,
                n.prototype.ontrack = null,
                n.prototype.onremovestream = null,
                n.prototype.onsignalingstatechange = null,
                n.prototype.oniceconnectionstatechange = null,
                n.prototype.onconnectionstatechange = null,
                n.prototype.onicegatheringstatechange = null,
                n.prototype.onnegotiationneeded = null,
                n.prototype.ondatachannel = null,
                n.prototype._dispatchEvent = function(e, t) {
                    this._isClosed || (this.dispatchEvent(t),
                    "function" == typeof this["on" + e] && this["on" + e](t))
                }
                ,
                n.prototype._emitGatheringStateChange = function() {
                    var e = new Event("icegatheringstatechange");
                    this._dispatchEvent("icegatheringstatechange", e)
                }
                ,
                n.prototype.getConfiguration = function() {
                    return this._config
                }
                ,
                n.prototype.getLocalStreams = function() {
                    return this.localStreams
                }
                ,
                n.prototype.getRemoteStreams = function() {
                    return this.remoteStreams
                }
                ,
                n.prototype._createTransceiver = function(e, t) {
                    var i = 0 < this.transceivers.length
                      , e = {
                        track: null,
                        iceGatherer: null,
                        iceTransport: null,
                        dtlsTransport: null,
                        localCapabilities: null,
                        remoteCapabilities: null,
                        rtpSender: null,
                        rtpReceiver: null,
                        kind: e,
                        mid: null,
                        sendEncodingParameters: null,
                        recvEncodingParameters: null,
                        stream: null,
                        associatedRemoteMediaStreams: [],
                        wantReceive: !0
                    };
                    return this.usingBundle && i ? (e.iceTransport = this.transceivers[0].iceTransport,
                    e.dtlsTransport = this.transceivers[0].dtlsTransport) : (i = this._createIceAndDtlsTransports(),
                    e.iceTransport = i.iceTransport,
                    e.dtlsTransport = i.dtlsTransport),
                    t || this.transceivers.push(e),
                    e
                }
                ,
                n.prototype.addTrack = function(t, e) {
                    if (this._isClosed)
                        throw f("InvalidStateError", "Attempted to call addTrack on a closed peerconnection.");
                    var i;
                    if (this.transceivers.find(function(e) {
                        return e.track === t
                    }))
                        throw f("InvalidAccessError", "Track already exists.");
                    for (var n = 0; n < this.transceivers.length; n++)
                        this.transceivers[n].track || this.transceivers[n].kind !== t.kind || (i = this.transceivers[n]);
                    return i = i || this._createTransceiver(t.kind),
                    this._maybeFireNegotiationNeeded(),
                    -1 === this.localStreams.indexOf(e) && this.localStreams.push(e),
                    i.track = t,
                    i.stream = e,
                    i.rtpSender = new I.RTCRtpSender(t,i.dtlsTransport),
                    i.rtpSender
                }
                ,
                n.prototype.addStream = function(t) {
                    var n, i = this;
                    15025 <= M ? t.getTracks().forEach(function(e) {
                        i.addTrack(e, t)
                    }) : (n = t.clone(),
                    t.getTracks().forEach(function(e, t) {
                        var i = n.getTracks()[t];
                        e.addEventListener("enabled", function(e) {
                            i.enabled = e.enabled
                        })
                    }),
                    n.getTracks().forEach(function(e) {
                        i.addTrack(e, n)
                    }))
                }
                ,
                n.prototype.removeTrack = function(t) {
                    if (this._isClosed)
                        throw f("InvalidStateError", "Attempted to call removeTrack on a closed peerconnection.");
                    if (!(t instanceof I.RTCRtpSender))
                        throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");
                    var e = this.transceivers.find(function(e) {
                        return e.rtpSender === t
                    });
                    if (!e)
                        throw f("InvalidAccessError", "Sender was not created by this connection.");
                    var i = e.stream;
                    e.rtpSender.stop(),
                    e.rtpSender = null,
                    e.track = null,
                    e.stream = null,
                    -1 === this.transceivers.map(function(e) {
                        return e.stream
                    }).indexOf(i) && -1 < this.localStreams.indexOf(i) && this.localStreams.splice(this.localStreams.indexOf(i), 1),
                    this._maybeFireNegotiationNeeded()
                }
                ,
                n.prototype.removeStream = function(e) {
                    var i = this;
                    e.getTracks().forEach(function(t) {
                        var e = i.getSenders().find(function(e) {
                            return e.track === t
                        });
                        e && i.removeTrack(e)
                    })
                }
                ,
                n.prototype.getSenders = function() {
                    return this.transceivers.filter(function(e) {
                        return !!e.rtpSender
                    }).map(function(e) {
                        return e.rtpSender
                    })
                }
                ,
                n.prototype.getReceivers = function() {
                    return this.transceivers.filter(function(e) {
                        return !!e.rtpReceiver
                    }).map(function(e) {
                        return e.rtpReceiver
                    })
                }
                ,
                n.prototype._createIceGatherer = function(i, e) {
                    var n = this;
                    if (e && 0 < i)
                        return this.transceivers[0].iceGatherer;
                    if (this._iceGatherers.length)
                        return this._iceGatherers.shift();
                    var o = new I.RTCIceGatherer({
                        iceServers: this._config.iceServers,
                        gatherPolicy: this._config.iceTransportPolicy
                    });
                    return Object.defineProperty(o, "state", {
                        value: "new",
                        writable: !0
                    }),
                    this.transceivers[i].bufferedCandidateEvents = [],
                    this.transceivers[i].bufferCandidates = function(e) {
                        var t = !e.candidate || 0 === Object.keys(e.candidate).length;
                        o.state = t ? "completed" : "gathering",
                        null !== n.transceivers[i].bufferedCandidateEvents && n.transceivers[i].bufferedCandidateEvents.push(e)
                    }
                    ,
                    o.addEventListener("localcandidate", this.transceivers[i].bufferCandidates),
                    o
                }
                ,
                n.prototype._gather = function(o, a) {
                    var e, s = this, r = this.transceivers[a].iceGatherer;
                    r.onlocalcandidate || (e = this.transceivers[a].bufferedCandidateEvents,
                    this.transceivers[a].bufferedCandidateEvents = null,
                    r.removeEventListener("localcandidate", this.transceivers[a].bufferCandidates),
                    r.onlocalcandidate = function(e) {
                        var t, i, n;
                        s.usingBundle && 0 < a || ((t = new Event("icecandidate")).candidate = {
                            sdpMid: o,
                            sdpMLineIndex: a
                        },
                        (e = !(i = e.candidate) || 0 === Object.keys(i).length) ? "new" !== r.state && "gathering" !== r.state || (r.state = "completed") : ("new" === r.state && (r.state = "gathering"),
                        i.component = 1,
                        i.ufrag = r.getLocalParameters().usernameFragment,
                        n = x.writeCandidate(i),
                        t.candidate = Object.assign(t.candidate, x.parseCandidate(n)),
                        t.candidate.candidate = n,
                        t.candidate.toJSON = function() {
                            return {
                                candidate: t.candidate.candidate,
                                sdpMid: t.candidate.sdpMid,
                                sdpMLineIndex: t.candidate.sdpMLineIndex,
                                usernameFragment: t.candidate.usernameFragment
                            }
                        }
                        ),
                        (n = x.getMediaSections(s._localDescription.sdp))[t.candidate.sdpMLineIndex] += e ? "a=end-of-candidates\r\n" : "a=" + t.candidate.candidate + "\r\n",
                        s._localDescription.sdp = x.getDescription(s._localDescription.sdp) + n.join(""),
                        n = s.transceivers.every(function(e) {
                            return e.iceGatherer && "completed" === e.iceGatherer.state
                        }),
                        "gathering" !== s.iceGatheringState && (s.iceGatheringState = "gathering",
                        s._emitGatheringStateChange()),
                        e || s._dispatchEvent("icecandidate", t),
                        n && (s._dispatchEvent("icecandidate", new Event("icecandidate")),
                        s.iceGatheringState = "complete",
                        s._emitGatheringStateChange()))
                    }
                    ,
                    I.setTimeout(function() {
                        e.forEach(function(e) {
                            r.onlocalcandidate(e)
                        })
                    }, 0))
                }
                ,
                n.prototype._createIceAndDtlsTransports = function() {
                    var e = this
                      , t = new I.RTCIceTransport(null);
                    t.onicestatechange = function() {
                        e._updateIceConnectionState(),
                        e._updateConnectionState()
                    }
                    ;
                    var i = new I.RTCDtlsTransport(t);
                    return i.ondtlsstatechange = function() {
                        e._updateConnectionState()
                    }
                    ,
                    i.onerror = function() {
                        Object.defineProperty(i, "state", {
                            value: "failed",
                            writable: !0
                        }),
                        e._updateConnectionState()
                    }
                    ,
                    {
                        iceTransport: t,
                        dtlsTransport: i
                    }
                }
                ,
                n.prototype._disposeIceAndDtlsTransports = function(e) {
                    var t = this.transceivers[e].iceGatherer;
                    t && (delete t.onlocalcandidate,
                    delete this.transceivers[e].iceGatherer);
                    t = this.transceivers[e].iceTransport;
                    t && (delete t.onicestatechange,
                    delete this.transceivers[e].iceTransport);
                    t = this.transceivers[e].dtlsTransport;
                    t && (delete t.ondtlsstatechange,
                    delete t.onerror,
                    delete this.transceivers[e].dtlsTransport)
                }
                ,
                n.prototype._transceive = function(e, t, i) {
                    var n = p(e.localCapabilities, e.remoteCapabilities);
                    t && e.rtpSender && (n.encodings = e.sendEncodingParameters,
                    n.rtcp = {
                        cname: x.localCName,
                        compound: e.rtcpParameters.compound
                    },
                    e.recvEncodingParameters.length && (n.rtcp.ssrc = e.recvEncodingParameters[0].ssrc),
                    e.rtpSender.send(n)),
                    i && e.rtpReceiver && 0 < n.codecs.length && ("video" === e.kind && e.recvEncodingParameters && M < 15019 && e.recvEncodingParameters.forEach(function(e) {
                        delete e.rtx
                    }),
                    e.recvEncodingParameters.length ? n.encodings = e.recvEncodingParameters : n.encodings = [{}],
                    n.rtcp = {
                        compound: e.rtcpParameters.compound
                    },
                    e.rtcpParameters.cname && (n.rtcp.cname = e.rtcpParameters.cname),
                    e.sendEncodingParameters.length && (n.rtcp.ssrc = e.sendEncodingParameters[0].ssrc),
                    e.rtpReceiver.receive(n))
                }
                ,
                n.prototype.setLocalDescription = function(e) {
                    var t, d, c, u = this;
                    return -1 === ["offer", "answer"].indexOf(e.type) ? Promise.reject(f("TypeError", 'Unsupported type "' + e.type + '"')) : !a("setLocalDescription", e.type, u.signalingState) || u._isClosed ? Promise.reject(f("InvalidStateError", "Can not set local " + e.type + " in state " + u.signalingState)) : ("offer" === e.type ? (t = x.splitSections(e.sdp),
                    d = t.shift(),
                    t.forEach(function(e, t) {
                        e = x.parseRtpParameters(e);
                        u.transceivers[t].localCapabilities = e
                    }),
                    u.transceivers.forEach(function(e, t) {
                        u._gather(e.mid, t)
                    })) : "answer" === e.type && (d = (t = x.splitSections(u._remoteDescription.sdp)).shift(),
                    c = 0 < x.matchPrefix(d, "a=ice-lite").length,
                    t.forEach(function(e, t) {
                        var i, n = u.transceivers[t], o = n.iceGatherer, a = n.iceTransport, s = n.dtlsTransport, r = n.localCapabilities, l = n.remoteCapabilities;
                        x.isRejected(e) && 0 === x.matchPrefix(e, "a=bundle-only").length || n.rejected || (i = x.getIceParameters(e, d),
                        e = x.getDtlsParameters(e, d),
                        c && (e.role = "server"),
                        u.usingBundle && 0 !== t || (u._gather(n.mid, t),
                        "new" === a.state && a.start(o, i, c ? "controlling" : "controlled"),
                        "new" === s.state && s.start(e)),
                        l = p(r, l),
                        u._transceive(n, 0 < l.codecs.length, !1))
                    })),
                    u._localDescription = {
                        type: e.type,
                        sdp: e.sdp
                    },
                    "offer" === e.type ? u._updateSignalingState("have-local-offer") : u._updateSignalingState("stable"),
                    Promise.resolve())
                }
                ,
                n.prototype.setRemoteDescription = function(w) {
                    var E = this;
                    if (-1 === ["offer", "answer"].indexOf(w.type))
                        return Promise.reject(f("TypeError", 'Unsupported type "' + w.type + '"'));
                    if (!a("setRemoteDescription", w.type, E.signalingState) || E._isClosed)
                        return Promise.reject(f("InvalidStateError", "Can not set remote " + w.type + " in state " + E.signalingState));
                    var y = {};
                    E.remoteStreams.forEach(function(e) {
                        y[e.id] = e
                    });
                    var D = []
                      , e = x.splitSections(w.sdp)
                      , T = e.shift()
                      , S = 0 < x.matchPrefix(T, "a=ice-lite").length
                      , A = 0 < x.matchPrefix(T, "a=group:BUNDLE ").length;
                    E.usingBundle = A;
                    var t = x.matchPrefix(T, "a=ice-options:")[0];
                    return E.canTrickleIceCandidates = !!t && 0 <= t.substr(14).split(" ").indexOf("trickle"),
                    e.forEach(function(e, t) {
                        var i, n, o, a, s, r, l, d, c, u, p, f, m = x.splitLines(e), v = x.getKind(e), h = x.isRejected(e) && 0 === x.matchPrefix(e, "a=bundle-only").length, g = m[0].substr(2).split(" ")[2], b = x.getDirection(e, T), C = x.parseMsid(e), _ = x.getMid(e) || x.generateIdentifier();
                        h || "application" === v && ("DTLS/SCTP" === g || "UDP/DTLS/SCTP" === g) ? E.transceivers[t] = {
                            mid: _,
                            kind: v,
                            protocol: g,
                            rejected: !0
                        } : (!h && E.transceivers[t] && E.transceivers[t].rejected && (E.transceivers[t] = E._createTransceiver(v, !0)),
                        o = x.parseRtpParameters(e),
                        h || (a = x.getIceParameters(e, T),
                        (s = x.getDtlsParameters(e, T)).role = "client"),
                        r = x.parseRtpEncodingParameters(e),
                        l = x.parseRtcpParameters(e),
                        d = 0 < x.matchPrefix(e, "a=end-of-candidates", T).length,
                        m = x.matchPrefix(e, "a=candidate:").map(function(e) {
                            return x.parseCandidate(e)
                        }).filter(function(e) {
                            return 1 === e.component
                        }),
                        ("offer" === w.type || "answer" === w.type) && !h && A && 0 < t && E.transceivers[t] && (E._disposeIceAndDtlsTransports(t),
                        E.transceivers[t].iceGatherer = E.transceivers[0].iceGatherer,
                        E.transceivers[t].iceTransport = E.transceivers[0].iceTransport,
                        E.transceivers[t].dtlsTransport = E.transceivers[0].dtlsTransport,
                        E.transceivers[t].rtpSender && E.transceivers[t].rtpSender.setTransport(E.transceivers[0].dtlsTransport),
                        E.transceivers[t].rtpReceiver && E.transceivers[t].rtpReceiver.setTransport(E.transceivers[0].dtlsTransport)),
                        "offer" !== w.type || h ? "answer" !== w.type || h || (g = (i = E.transceivers[t]).iceGatherer,
                        e = i.iceTransport,
                        h = i.dtlsTransport,
                        f = i.rtpReceiver,
                        c = i.sendEncodingParameters,
                        n = i.localCapabilities,
                        E.transceivers[t].recvEncodingParameters = r,
                        E.transceivers[t].remoteCapabilities = o,
                        E.transceivers[t].rtcpParameters = l,
                        m.length && "new" === e.state && (!S && !d || A && 0 !== t ? m.forEach(function(e) {
                            R(i.iceTransport, e)
                        }) : e.setRemoteCandidates(m)),
                        A && 0 !== t || ("new" === e.state && e.start(g, a, "controlling"),
                        "new" === h.state && h.start(s)),
                        E._transceive(i, "sendrecv" === b || "recvonly" === b, "sendrecv" === b || "sendonly" === b),
                        !f || "sendrecv" !== b && "sendonly" !== b ? delete i.rtpReceiver : (p = f.track,
                        C ? (y[C.stream] || (y[C.stream] = new I.MediaStream),
                        O(p, y[C.stream]),
                        D.push([p, f, y[C.stream]])) : (y.default || (y.default = new I.MediaStream),
                        O(p, y.default),
                        D.push([p, f, y.default])))) : ((i = E.transceivers[t] || E._createTransceiver(v)).mid = _,
                        i.iceGatherer || (i.iceGatherer = E._createIceGatherer(t, A)),
                        m.length && "new" === i.iceTransport.state && (!d || A && 0 !== t ? m.forEach(function(e) {
                            R(i.iceTransport, e)
                        }) : i.iceTransport.setRemoteCandidates(m)),
                        n = I.RTCRtpReceiver.getCapabilities(v),
                        M < 15019 && (n.codecs = n.codecs.filter(function(e) {
                            return "rtx" !== e.name
                        })),
                        c = i.sendEncodingParameters || [{
                            ssrc: 1001 * (2 * t + 2)
                        }],
                        m = !1,
                        "sendrecv" === b || "sendonly" === b ? (m = !i.rtpReceiver,
                        f = i.rtpReceiver || new I.RTCRtpReceiver(i.dtlsTransport,v),
                        m && (p = f.track,
                        (u = !C || "-" !== C.stream ? C ? (y[C.stream] || (y[C.stream] = new I.MediaStream,
                        Object.defineProperty(y[C.stream], "id", {
                            get: function() {
                                return C.stream
                            }
                        })),
                        Object.defineProperty(p, "id", {
                            get: function() {
                                return C.track
                            }
                        }),
                        y[C.stream]) : (y.default || (y.default = new I.MediaStream),
                        y.default) : u) && (O(p, u),
                        i.associatedRemoteMediaStreams.push(u)),
                        D.push([p, f, u]))) : i.rtpReceiver && i.rtpReceiver.track && (i.associatedRemoteMediaStreams.forEach(function(e) {
                            var t = e.getTracks().find(function(e) {
                                return e.id === i.rtpReceiver.track.id
                            });
                            t && (t = t,
                            (e = e).removeTrack(t),
                            e.dispatchEvent(new I.MediaStreamTrackEvent("removetrack",{
                                track: t
                            })))
                        }),
                        i.associatedRemoteMediaStreams = []),
                        i.localCapabilities = n,
                        i.remoteCapabilities = o,
                        i.rtpReceiver = f,
                        i.rtcpParameters = l,
                        i.sendEncodingParameters = c,
                        i.recvEncodingParameters = r,
                        E._transceive(E.transceivers[t], !1, m)))
                    }),
                    void 0 === E._dtlsRole && (E._dtlsRole = "offer" === w.type ? "active" : "passive"),
                    E._remoteDescription = {
                        type: w.type,
                        sdp: w.sdp
                    },
                    "offer" === w.type ? E._updateSignalingState("have-remote-offer") : E._updateSignalingState("stable"),
                    Object.keys(y).forEach(function(e) {
                        var t, n = y[e];
                        n.getTracks().length && (-1 === E.remoteStreams.indexOf(n) && (E.remoteStreams.push(n),
                        (t = new Event("addstream")).stream = n,
                        I.setTimeout(function() {
                            E._dispatchEvent("addstream", t)
                        })),
                        D.forEach(function(e) {
                            var t = e[0]
                              , i = e[1];
                            n.id === e[2].id && o(E, t, i, [n])
                        }))
                    }),
                    D.forEach(function(e) {
                        e[2] || o(E, e[0], e[1], [])
                    }),
                    I.setTimeout(function() {
                        E && E.transceivers && E.transceivers.forEach(function(e) {
                            e.iceTransport && "new" === e.iceTransport.state && 0 < e.iceTransport.getRemoteCandidates().length && (console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),
                            e.iceTransport.addRemoteCandidate({}))
                        })
                    }, 4e3),
                    Promise.resolve()
                }
                ,
                n.prototype.close = function() {
                    this.transceivers.forEach(function(e) {
                        e.iceTransport && e.iceTransport.stop(),
                        e.dtlsTransport && e.dtlsTransport.stop(),
                        e.rtpSender && e.rtpSender.stop(),
                        e.rtpReceiver && e.rtpReceiver.stop()
                    }),
                    this._isClosed = !0,
                    this._updateSignalingState("closed")
                }
                ,
                n.prototype._updateSignalingState = function(e) {
                    this.signalingState = e;
                    e = new Event("signalingstatechange");
                    this._dispatchEvent("signalingstatechange", e)
                }
                ,
                n.prototype._maybeFireNegotiationNeeded = function() {
                    var t = this;
                    "stable" === this.signalingState && !0 !== this.needNegotiation && (this.needNegotiation = !0,
                    I.setTimeout(function() {
                        var e;
                        t.needNegotiation && (t.needNegotiation = !1,
                        e = new Event("negotiationneeded"),
                        t._dispatchEvent("negotiationneeded", e))
                    }, 0))
                }
                ,
                n.prototype._updateIceConnectionState = function() {
                    var e, t = {
                        new: 0,
                        closed: 0,
                        checking: 0,
                        connected: 0,
                        completed: 0,
                        disconnected: 0,
                        failed: 0
                    };
                    this.transceivers.forEach(function(e) {
                        t[e.iceTransport.state]++
                    }),
                    e = "new",
                    0 < t.failed ? e = "failed" : 0 < t.checking ? e = "checking" : 0 < t.disconnected ? e = "disconnected" : 0 < t.new ? e = "new" : 0 < t.connected ? e = "connected" : 0 < t.completed && (e = "completed"),
                    e !== this.iceConnectionState && (this.iceConnectionState = e,
                    e = new Event("iceconnectionstatechange"),
                    this._dispatchEvent("iceconnectionstatechange", e))
                }
                ,
                n.prototype._updateConnectionState = function() {
                    var e, t = {
                        new: 0,
                        closed: 0,
                        connecting: 0,
                        connected: 0,
                        completed: 0,
                        disconnected: 0,
                        failed: 0
                    };
                    this.transceivers.forEach(function(e) {
                        t[e.iceTransport.state]++,
                        t[e.dtlsTransport.state]++
                    }),
                    t.connected += t.completed,
                    e = "new",
                    0 < t.failed ? e = "failed" : 0 < t.connecting ? e = "connecting" : 0 < t.disconnected ? e = "disconnected" : 0 < t.new ? e = "new" : 0 < t.connected && (e = "connected"),
                    e !== this.connectionState && (this.connectionState = e,
                    e = new Event("connectionstatechange"),
                    this._dispatchEvent("connectionstatechange", e))
                }
                ,
                n.prototype.createOffer = function() {
                    var a = this;
                    if (a._isClosed)
                        return Promise.reject(f("InvalidStateError", "Can not call createOffer after close"));
                    var t = a.transceivers.filter(function(e) {
                        return "audio" === e.kind
                    }).length
                      , i = a.transceivers.filter(function(e) {
                        return "video" === e.kind
                    }).length
                      , e = arguments[0];
                    if (e) {
                        if (e.mandatory || e.optional)
                            throw new TypeError("Legacy mandatory/optional constraints not supported.");
                        void 0 !== e.offerToReceiveAudio && (t = !0 === e.offerToReceiveAudio ? 1 : !1 === e.offerToReceiveAudio ? 0 : e.offerToReceiveAudio),
                        void 0 !== e.offerToReceiveVideo && (i = !0 === e.offerToReceiveVideo ? 1 : !1 === e.offerToReceiveVideo ? 0 : e.offerToReceiveVideo)
                    }
                    for (a.transceivers.forEach(function(e) {
                        "audio" === e.kind ? --t < 0 && (e.wantReceive = !1) : "video" === e.kind && --i < 0 && (e.wantReceive = !1)
                    }); 0 < t || 0 < i; )
                        0 < t && (a._createTransceiver("audio"),
                        t--),
                        0 < i && (a._createTransceiver("video"),
                        i--);
                    var n = x.writeSessionBoilerplate(a._sdpSessionId, a._sdpSessionVersion++);
                    a.transceivers.forEach(function(e, t) {
                        var i = e.track
                          , n = e.kind
                          , o = e.mid || x.generateIdentifier();
                        e.mid = o,
                        e.iceGatherer || (e.iceGatherer = a._createIceGatherer(t, a.usingBundle));
                        o = I.RTCRtpSender.getCapabilities(n);
                        M < 15019 && (o.codecs = o.codecs.filter(function(e) {
                            return "rtx" !== e.name
                        })),
                        o.codecs.forEach(function(t) {
                            "H264" === t.name && void 0 === t.parameters["level-asymmetry-allowed"] && (t.parameters["level-asymmetry-allowed"] = "1"),
                            e.remoteCapabilities && e.remoteCapabilities.codecs && e.remoteCapabilities.codecs.forEach(function(e) {
                                t.name.toLowerCase() === e.name.toLowerCase() && t.clockRate === e.clockRate && (t.preferredPayloadType = e.payloadType)
                            })
                        }),
                        o.headerExtensions.forEach(function(t) {
                            (e.remoteCapabilities && e.remoteCapabilities.headerExtensions || []).forEach(function(e) {
                                t.uri === e.uri && (t.id = e.id)
                            })
                        });
                        t = e.sendEncodingParameters || [{
                            ssrc: 1001 * (2 * t + 1)
                        }];
                        i && 15019 <= M && "video" === n && !t[0].rtx && (t[0].rtx = {
                            ssrc: t[0].ssrc + 1
                        }),
                        e.wantReceive && (e.rtpReceiver = new I.RTCRtpReceiver(e.dtlsTransport,n)),
                        e.localCapabilities = o,
                        e.sendEncodingParameters = t
                    }),
                    "max-compat" !== a._config.bundlePolicy && (n += "a=group:BUNDLE " + a.transceivers.map(function(e) {
                        return e.mid
                    }).join(" ") + "\r\n"),
                    n += "a=ice-options:trickle\r\n",
                    a.transceivers.forEach(function(e, t) {
                        n += s(e, e.localCapabilities, "offer", e.stream, a._dtlsRole),
                        n += "a=rtcp-rsize\r\n",
                        !e.iceGatherer || "new" === a.iceGatheringState || 0 !== t && a.usingBundle || (e.iceGatherer.getLocalCandidates().forEach(function(e) {
                            e.component = 1,
                            n += "a=" + x.writeCandidate(e) + "\r\n"
                        }),
                        "completed" === e.iceGatherer.state && (n += "a=end-of-candidates\r\n"))
                    });
                    e = new I.RTCSessionDescription({
                        type: "offer",
                        sdp: n
                    });
                    return Promise.resolve(e)
                }
                ,
                n.prototype.createAnswer = function() {
                    var n = this;
                    if (n._isClosed)
                        return Promise.reject(f("InvalidStateError", "Can not call createAnswer after close"));
                    if ("have-remote-offer" !== n.signalingState && "have-local-pranswer" !== n.signalingState)
                        return Promise.reject(f("InvalidStateError", "Can not call createAnswer in signalingState " + n.signalingState));
                    var o = x.writeSessionBoilerplate(n._sdpSessionId, n._sdpSessionVersion++);
                    n.usingBundle && (o += "a=group:BUNDLE " + n.transceivers.map(function(e) {
                        return e.mid
                    }).join(" ") + "\r\n");
                    var a = x.getMediaSections(n._remoteDescription.sdp).length;
                    n.transceivers.forEach(function(e, t) {
                        if (!(a < t + 1)) {
                            if (e.rejected)
                                return "application" === e.kind ? "DTLS/SCTP" === e.protocol ? o += "m=application 0 DTLS/SCTP 5000\r\n" : o += "m=application 0 " + e.protocol + " webrtc-datachannel\r\n" : "audio" === e.kind ? o += "m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n" : "video" === e.kind && (o += "m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),
                                void (o += "c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:" + e.mid + "\r\n");
                            e.stream && ("audio" === e.kind ? i = e.stream.getAudioTracks()[0] : "video" === e.kind && (i = e.stream.getVideoTracks()[0]),
                            i && 15019 <= M && "video" === e.kind && !e.sendEncodingParameters[0].rtx && (e.sendEncodingParameters[0].rtx = {
                                ssrc: e.sendEncodingParameters[0].ssrc + 1
                            }));
                            var i = p(e.localCapabilities, e.remoteCapabilities);
                            !i.codecs.filter(function(e) {
                                return "rtx" === e.name.toLowerCase()
                            }).length && e.sendEncodingParameters[0].rtx && delete e.sendEncodingParameters[0].rtx,
                            o += s(e, i, "answer", e.stream, n._dtlsRole),
                            e.rtcpParameters && e.rtcpParameters.reducedSize && (o += "a=rtcp-rsize\r\n")
                        }
                    });
                    var e = new I.RTCSessionDescription({
                        type: "answer",
                        sdp: o
                    });
                    return Promise.resolve(e)
                }
                ,
                n.prototype.addIceCandidate = function(r) {
                    var l, d = this;
                    return r && void 0 === r.sdpMLineIndex && !r.sdpMid ? Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")) : new Promise(function(e, t) {
                        if (!d._remoteDescription)
                            return t(f("InvalidStateError", "Can not add ICE candidate without a remote description"));
                        if (r && "" !== r.candidate) {
                            var i = r.sdpMLineIndex;
                            if (r.sdpMid)
                                for (var n = 0; n < d.transceivers.length; n++)
                                    if (d.transceivers[n].mid === r.sdpMid) {
                                        i = n;
                                        break
                                    }
                            var o = d.transceivers[i];
                            if (!o)
                                return t(f("OperationError", "Can not add ICE candidate"));
                            if (o.rejected)
                                return e();
                            var a = 0 < Object.keys(r.candidate).length ? x.parseCandidate(r.candidate) : {};
                            if ("tcp" === a.protocol && (0 === a.port || 9 === a.port))
                                return e();
                            if (a.component && 1 !== a.component)
                                return e();
                            if ((0 === i || 0 < i && o.iceTransport !== d.transceivers[0].iceTransport) && !R(o.iceTransport, a))
                                return t(f("OperationError", "Can not add ICE candidate"));
                            t = r.candidate.trim();
                            0 === t.indexOf("a=") && (t = t.substr(2)),
                            (l = x.getMediaSections(d._remoteDescription.sdp))[i] += "a=" + (a.type ? t : "end-of-candidates") + "\r\n",
                            d._remoteDescription.sdp = x.getDescription(d._remoteDescription.sdp) + l.join("")
                        } else
                            for (var s = 0; s < d.transceivers.length && (d.transceivers[s].rejected || (d.transceivers[s].iceTransport.addRemoteCandidate({}),
                            (l = x.getMediaSections(d._remoteDescription.sdp))[s] += "a=end-of-candidates\r\n",
                            d._remoteDescription.sdp = x.getDescription(d._remoteDescription.sdp) + l.join(""),
                            !d.usingBundle)); s++)
                                ;
                        e()
                    }
                    )
                }
                ,
                n.prototype.getStats = function(t) {
                    if (t && t instanceof I.MediaStreamTrack) {
                        var i = null;
                        if (this.transceivers.forEach(function(e) {
                            e.rtpSender && e.rtpSender.track === t ? i = e.rtpSender : e.rtpReceiver && e.rtpReceiver.track === t && (i = e.rtpReceiver)
                        }),
                        !i)
                            throw f("InvalidAccessError", "Invalid selector.");
                        return i.getStats()
                    }
                    var n = [];
                    return this.transceivers.forEach(function(t) {
                        ["rtpSender", "rtpReceiver", "iceGatherer", "iceTransport", "dtlsTransport"].forEach(function(e) {
                            t[e] && n.push(t[e].getStats())
                        })
                    }),
                    Promise.all(n).then(function(e) {
                        var t = new Map;
                        return e.forEach(function(e) {
                            e.forEach(function(e) {
                                t.set(e.id, e)
                            })
                        }),
                        t
                    })
                }
                ;
                ["RTCRtpSender", "RTCRtpReceiver", "RTCIceGatherer", "RTCIceTransport", "RTCDtlsTransport"].forEach(function(e) {
                    var t, e = I[e];
                    e && e.prototype && e.prototype.getStats && (t = e.prototype.getStats,
                    e.prototype.getStats = function() {
                        return t.apply(this).then(function(i) {
                            var n = new Map;
                            return Object.keys(i).forEach(function(e) {
                                var t;
                                i[e].type = {
                                    inboundrtp: "inbound-rtp",
                                    outboundrtp: "outbound-rtp",
                                    candidatepair: "candidate-pair",
                                    localcandidate: "local-candidate",
                                    remotecandidate: "remote-candidate"
                                }[(t = i[e]).type] || t.type,
                                n.set(e, i[e])
                            }),
                            n
                        })
                    }
                    )
                });
                var e = ["createOffer", "createAnswer"];
                return e.forEach(function(e) {
                    var i = n.prototype[e];
                    n.prototype[e] = function() {
                        var t = arguments;
                        return "function" == typeof t[0] || "function" == typeof t[1] ? i.apply(this, [arguments[2]]).then(function(e) {
                            "function" == typeof t[0] && t[0].apply(null, [e])
                        }, function(e) {
                            "function" == typeof t[1] && t[1].apply(null, [e])
                        }) : i.apply(this, arguments)
                    }
                }),
                (e = ["setLocalDescription", "setRemoteDescription", "addIceCandidate"]).forEach(function(e) {
                    var i = n.prototype[e];
                    n.prototype[e] = function() {
                        var t = arguments;
                        return "function" == typeof t[1] || "function" == typeof t[2] ? i.apply(this, arguments).then(function() {
                            "function" == typeof t[1] && t[1].apply(null)
                        }, function(e) {
                            "function" == typeof t[2] && t[2].apply(null, [e])
                        }) : i.apply(this, arguments)
                    }
                }),
                ["getStats"].forEach(function(e) {
                    var t = n.prototype[e];
                    n.prototype[e] = function() {
                        var e = arguments;
                        return "function" == typeof e[1] ? t.apply(this, arguments).then(function() {
                            "function" == typeof e[1] && e[1].apply(null)
                        }) : t.apply(this, arguments)
                    }
                }),
                n
            }
        }
        , {
            sdp: 2
        }],
        2: [function(e, t, i) {
            var d = {
                generateIdentifier: function() {
                    return Math.random().toString(36).substr(2, 10)
                }
            };
            d.localCName = d.generateIdentifier(),
            d.splitLines = function(e) {
                return e.trim().split("\n").map(function(e) {
                    return e.trim()
                })
            }
            ,
            d.splitSections = function(e) {
                return e.split("\nm=").map(function(e, t) {
                    return (0 < t ? "m=" + e : e).trim() + "\r\n"
                })
            }
            ,
            d.getDescription = function(e) {
                e = d.splitSections(e);
                return e && e[0]
            }
            ,
            d.getMediaSections = function(e) {
                e = d.splitSections(e);
                return e.shift(),
                e
            }
            ,
            d.matchPrefix = function(e, t) {
                return d.splitLines(e).filter(function(e) {
                    return 0 === e.indexOf(t)
                })
            }
            ,
            d.parseCandidate = function(e) {
                for (var t = (0 === e.indexOf("a=candidate:") ? e.substring(12) : e.substring(10)).split(" "), i = {
                    foundation: t[0],
                    component: parseInt(t[1], 10),
                    protocol: t[2].toLowerCase(),
                    priority: parseInt(t[3], 10),
                    ip: t[4],
                    port: parseInt(t[5], 10),
                    type: t[7]
                }, n = 8; n < t.length; n += 2)
                    switch (t[n]) {
                    case "raddr":
                        i.relatedAddress = t[n + 1];
                        break;
                    case "rport":
                        i.relatedPort = parseInt(t[n + 1], 10);
                        break;
                    case "tcptype":
                        i.tcpType = t[n + 1];
                        break;
                    case "ufrag":
                        i.ufrag = t[n + 1],
                        i.usernameFragment = t[n + 1];
                        break;
                    default:
                        i[t[n]] = t[n + 1]
                    }
                return i
            }
            ,
            d.writeCandidate = function(e) {
                var t = [];
                t.push(e.foundation),
                t.push(e.component),
                t.push(e.protocol.toUpperCase()),
                t.push(e.priority),
                t.push(e.ip),
                t.push(e.port);
                var i = e.type;
                return t.push("typ"),
                t.push(i),
                "host" !== i && e.relatedAddress && e.relatedPort && (t.push("raddr"),
                t.push(e.relatedAddress),
                t.push("rport"),
                t.push(e.relatedPort)),
                e.tcpType && "tcp" === e.protocol.toLowerCase() && (t.push("tcptype"),
                t.push(e.tcpType)),
                (e.usernameFragment || e.ufrag) && (t.push("ufrag"),
                t.push(e.usernameFragment || e.ufrag)),
                "candidate:" + t.join(" ")
            }
            ,
            d.parseIceOptions = function(e) {
                return e.substr(14).split(" ")
            }
            ,
            d.parseRtpMap = function(e) {
                var t = e.substr(9).split(" ")
                  , e = {
                    payloadType: parseInt(t.shift(), 10)
                }
                  , t = t[0].split("/");
                return e.name = t[0],
                e.clockRate = parseInt(t[1], 10),
                e.channels = 3 === t.length ? parseInt(t[2], 10) : 1,
                e.numChannels = e.channels,
                e
            }
            ,
            d.writeRtpMap = function(e) {
                var t = e.payloadType;
                void 0 !== e.preferredPayloadType && (t = e.preferredPayloadType);
                var i = e.channels || e.numChannels || 1;
                return "a=rtpmap:" + t + " " + e.name + "/" + e.clockRate + (1 !== i ? "/" + i : "") + "\r\n"
            }
            ,
            d.parseExtmap = function(e) {
                e = e.substr(9).split(" ");
                return {
                    id: parseInt(e[0], 10),
                    direction: 0 < e[0].indexOf("/") ? e[0].split("/")[1] : "sendrecv",
                    uri: e[1]
                }
            }
            ,
            d.writeExtmap = function(e) {
                return "a=extmap:" + (e.id || e.preferredId) + (e.direction && "sendrecv" !== e.direction ? "/" + e.direction : "") + " " + e.uri + "\r\n"
            }
            ,
            d.parseFmtp = function(e) {
                for (var t, i = {}, n = e.substr(e.indexOf(" ") + 1).split(";"), o = 0; o < n.length; o++)
                    i[(t = n[o].trim().split("="))[0].trim()] = t[1];
                return i
            }
            ,
            d.writeFmtp = function(t) {
                var i, e = "", n = t.payloadType;
                return void 0 !== t.preferredPayloadType && (n = t.preferredPayloadType),
                t.parameters && Object.keys(t.parameters).length && (i = [],
                Object.keys(t.parameters).forEach(function(e) {
                    t.parameters[e] ? i.push(e + "=" + t.parameters[e]) : i.push(e)
                }),
                e += "a=fmtp:" + n + " " + i.join(";") + "\r\n"),
                e
            }
            ,
            d.parseRtcpFb = function(e) {
                e = e.substr(e.indexOf(" ") + 1).split(" ");
                return {
                    type: e.shift(),
                    parameter: e.join(" ")
                }
            }
            ,
            d.writeRtcpFb = function(e) {
                var t = ""
                  , i = e.payloadType;
                return void 0 !== e.preferredPayloadType && (i = e.preferredPayloadType),
                e.rtcpFeedback && e.rtcpFeedback.length && e.rtcpFeedback.forEach(function(e) {
                    t += "a=rtcp-fb:" + i + " " + e.type + (e.parameter && e.parameter.length ? " " + e.parameter : "") + "\r\n"
                }),
                t
            }
            ,
            d.parseSsrcMedia = function(e) {
                var t = e.indexOf(" ")
                  , i = {
                    ssrc: parseInt(e.substr(7, t - 7), 10)
                }
                  , n = e.indexOf(":", t);
                return -1 < n ? (i.attribute = e.substr(t + 1, n - t - 1),
                i.value = e.substr(n + 1)) : i.attribute = e.substr(t + 1),
                i
            }
            ,
            d.getMid = function(e) {
                e = d.matchPrefix(e, "a=mid:")[0];
                if (e)
                    return e.substr(6)
            }
            ,
            d.parseFingerprint = function(e) {
                e = e.substr(14).split(" ");
                return {
                    algorithm: e[0].toLowerCase(),
                    value: e[1]
                }
            }
            ,
            d.getDtlsParameters = function(e, t) {
                return {
                    role: "auto",
                    fingerprints: d.matchPrefix(e + t, "a=fingerprint:").map(d.parseFingerprint)
                }
            }
            ,
            d.writeDtlsParameters = function(e, t) {
                var i = "a=setup:" + t + "\r\n";
                return e.fingerprints.forEach(function(e) {
                    i += "a=fingerprint:" + e.algorithm + " " + e.value + "\r\n"
                }),
                i
            }
            ,
            d.getIceParameters = function(e, t) {
                e = d.splitLines(e);
                return {
                    usernameFragment: (e = e.concat(d.splitLines(t))).filter(function(e) {
                        return 0 === e.indexOf("a=ice-ufrag:")
                    })[0].substr(12),
                    password: e.filter(function(e) {
                        return 0 === e.indexOf("a=ice-pwd:")
                    })[0].substr(10)
                }
            }
            ,
            d.writeIceParameters = function(e) {
                return "a=ice-ufrag:" + e.usernameFragment + "\r\na=ice-pwd:" + e.password + "\r\n"
            }
            ,
            d.parseRtpParameters = function(e) {
                for (var t = {
                    codecs: [],
                    headerExtensions: [],
                    fecMechanisms: [],
                    rtcp: []
                }, i = d.splitLines(e)[0].split(" "), n = 3; n < i.length; n++) {
                    var o = i[n]
                      , a = d.matchPrefix(e, "a=rtpmap:" + o + " ")[0];
                    if (a) {
                        var s = d.parseRtpMap(a)
                          , a = d.matchPrefix(e, "a=fmtp:" + o + " ");
                        switch (s.parameters = a.length ? d.parseFmtp(a[0]) : {},
                        s.rtcpFeedback = d.matchPrefix(e, "a=rtcp-fb:" + o + " ").map(d.parseRtcpFb),
                        t.codecs.push(s),
                        s.name.toUpperCase()) {
                        case "RED":
                        case "ULPFEC":
                            t.fecMechanisms.push(s.name.toUpperCase())
                        }
                    }
                }
                return d.matchPrefix(e, "a=extmap:").forEach(function(e) {
                    t.headerExtensions.push(d.parseExtmap(e))
                }),
                t
            }
            ,
            d.writeRtpDescription = function(e, t) {
                var i = "";
                i += "m=" + e + " ",
                i += 0 < t.codecs.length ? "9" : "0",
                i += " UDP/TLS/RTP/SAVPF ",
                i += t.codecs.map(function(e) {
                    return void 0 !== e.preferredPayloadType ? e.preferredPayloadType : e.payloadType
                }).join(" ") + "\r\n",
                i += "c=IN IP4 0.0.0.0\r\n",
                i += "a=rtcp:9 IN IP4 0.0.0.0\r\n",
                t.codecs.forEach(function(e) {
                    i += d.writeRtpMap(e),
                    i += d.writeFmtp(e),
                    i += d.writeRtcpFb(e)
                });
                var n = 0;
                return t.codecs.forEach(function(e) {
                    e.maxptime > n && (n = e.maxptime)
                }),
                0 < n && (i += "a=maxptime:" + n + "\r\n"),
                i += "a=rtcp-mux\r\n",
                t.headerExtensions && t.headerExtensions.forEach(function(e) {
                    i += d.writeExtmap(e)
                }),
                i
            }
            ,
            d.parseRtpEncodingParameters = function(e) {
                var t, i = [], n = d.parseRtpParameters(e), o = -1 !== n.fecMechanisms.indexOf("RED"), a = -1 !== n.fecMechanisms.indexOf("ULPFEC"), s = d.matchPrefix(e, "a=ssrc:").map(function(e) {
                    return d.parseSsrcMedia(e)
                }).filter(function(e) {
                    return "cname" === e.attribute
                }), r = 0 < s.length && s[0].ssrc, s = d.matchPrefix(e, "a=ssrc-group:FID").map(function(e) {
                    return e.substr(17).split(" ").map(function(e) {
                        return parseInt(e, 10)
                    })
                });
                0 < s.length && 1 < s[0].length && s[0][0] === r && (t = s[0][1]),
                n.codecs.forEach(function(e) {
                    "RTX" === e.name.toUpperCase() && e.parameters.apt && (e = {
                        ssrc: r,
                        codecPayloadType: parseInt(e.parameters.apt, 10)
                    },
                    r && t && (e.rtx = {
                        ssrc: t
                    }),
                    i.push(e),
                    o && ((e = JSON.parse(JSON.stringify(e))).fec = {
                        ssrc: t,
                        mechanism: a ? "red+ulpfec" : "red"
                    },
                    i.push(e)))
                }),
                0 === i.length && r && i.push({
                    ssrc: r
                });
                var l = d.matchPrefix(e, "b=");
                return l.length && (l = 0 === l[0].indexOf("b=TIAS:") ? parseInt(l[0].substr(7), 10) : 0 === l[0].indexOf("b=AS:") ? 1e3 * parseInt(l[0].substr(5), 10) * .95 - 16e3 : void 0,
                i.forEach(function(e) {
                    e.maxBitrate = l
                })),
                i
            }
            ,
            d.parseRtcpParameters = function(e) {
                var t = {}
                  , i = d.matchPrefix(e, "a=ssrc:").map(function(e) {
                    return d.parseSsrcMedia(e)
                }).filter(function(e) {
                    return "cname" === e.attribute
                })[0];
                i && (t.cname = i.value,
                t.ssrc = i.ssrc);
                i = d.matchPrefix(e, "a=rtcp-rsize");
                t.reducedSize = 0 < i.length,
                t.compound = 0 === i.length;
                e = d.matchPrefix(e, "a=rtcp-mux");
                return t.mux = 0 < e.length,
                t
            }
            ,
            d.parseMsid = function(e) {
                var t, i = d.matchPrefix(e, "a=msid:");
                if (1 === i.length)
                    return {
                        stream: (t = i[0].substr(7).split(" "))[0],
                        track: t[1]
                    };
                e = d.matchPrefix(e, "a=ssrc:").map(function(e) {
                    return d.parseSsrcMedia(e)
                }).filter(function(e) {
                    return "msid" === e.attribute
                });
                return 0 < e.length ? {
                    stream: (t = e[0].value.split(" "))[0],
                    track: t[1]
                } : void 0
            }
            ,
            d.generateSessionId = function() {
                return Math.random().toString().substr(2, 21)
            }
            ,
            d.writeSessionBoilerplate = function(e, t) {
                t = void 0 !== t ? t : 2,
                e = e || d.generateSessionId();
                return "v=0\r\no=thisisadapterortc " + e + " " + t + " IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"
            }
            ,
            d.writeMediaSection = function(e, t, i, n) {
                t = d.writeRtpDescription(e.kind, t);
                return t += d.writeIceParameters(e.iceGatherer.getLocalParameters()),
                t += d.writeDtlsParameters(e.dtlsTransport.getLocalParameters(), "offer" === i ? "actpass" : "active"),
                t += "a=mid:" + e.mid + "\r\n",
                e.direction ? t += "a=" + e.direction + "\r\n" : e.rtpSender && e.rtpReceiver ? t += "a=sendrecv\r\n" : e.rtpSender ? t += "a=sendonly\r\n" : e.rtpReceiver ? t += "a=recvonly\r\n" : t += "a=inactive\r\n",
                e.rtpSender && (t += "a=" + (n = "msid:" + n.id + " " + e.rtpSender.track.id + "\r\n"),
                t += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " " + n,
                e.sendEncodingParameters[0].rtx && (t += "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " " + n,
                t += "a=ssrc-group:FID " + e.sendEncodingParameters[0].ssrc + " " + e.sendEncodingParameters[0].rtx.ssrc + "\r\n")),
                t += "a=ssrc:" + e.sendEncodingParameters[0].ssrc + " cname:" + d.localCName + "\r\n",
                e.rtpSender && e.sendEncodingParameters[0].rtx && (t += "a=ssrc:" + e.sendEncodingParameters[0].rtx.ssrc + " cname:" + d.localCName + "\r\n"),
                t
            }
            ,
            d.getDirection = function(e, t) {
                for (var i = d.splitLines(e), n = 0; n < i.length; n++)
                    switch (i[n]) {
                    case "a=sendrecv":
                    case "a=sendonly":
                    case "a=recvonly":
                    case "a=inactive":
                        return i[n].substr(2)
                    }
                return t ? d.getDirection(t) : "sendrecv"
            }
            ,
            d.getKind = function(e) {
                return d.splitLines(e)[0].split(" ")[0].substr(2)
            }
            ,
            d.isRejected = function(e) {
                return "0" === e.split(" ", 2)[1]
            }
            ,
            d.parseMLine = function(e) {
                e = d.splitLines(e)[0].substr(2).split(" ");
                return {
                    kind: e[0],
                    port: parseInt(e[1], 10),
                    protocol: e[2],
                    fmt: e.slice(3).join(" ")
                }
            }
            ,
            d.parseOLine = function(e) {
                e = d.matchPrefix(e, "o=")[0].substr(2).split(" ");
                return {
                    username: e[0],
                    sessionId: e[1],
                    sessionVersion: parseInt(e[2], 10),
                    netType: e[3],
                    addressType: e[4],
                    address: e[5]
                }
            }
            ,
            "object" == typeof t && (t.exports = d)
        }
        , {}],
        3: [function(i, n, e) {
            !function(e) {
                var t = i("./adapter_factory.js");
                n.exports = t({
                    window: e.window
                })
            }
            .call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }
        , {
            "./adapter_factory.js": 4
        }],
        4: [function(p, e, t) {
            var f = p("./utils");
            e.exports = function(e, t) {
                var i, n = e && e.window, o = {
                    shimChrome: !0,
                    shimFirefox: !0,
                    shimEdge: !0,
                    shimSafari: !0
                };
                for (i in t)
                    hasOwnProperty.call(t, i) && (o[i] = t[i]);
                var a = f.log
                  , e = f.detectBrowser(n)
                  , s = p("./chrome/chrome_shim") || null
                  , r = p("./edge/edge_shim") || null
                  , l = p("./firefox/firefox_shim") || null
                  , d = p("./safari/safari_shim") || null
                  , c = p("./common_shim") || null
                  , u = {
                    browserDetails: e,
                    commonShim: c,
                    extractVersion: f.extractVersion,
                    disableLog: f.disableLog,
                    disableWarnings: f.disableWarnings
                };
                switch (e.browser) {
                case "chrome":
                    if (!s || !s.shimPeerConnection || !o.shimChrome)
                        return a("Chrome shim is not included in this adapter release."),
                        u;
                    a("adapter.js shimming chrome."),
                    u.browserShim = s,
                    c.shimCreateObjectURL(n),
                    s.shimGetUserMedia(n),
                    s.shimMediaStream(n),
                    s.shimSourceObject(n),
                    s.shimPeerConnection(n),
                    s.shimOnTrack(n),
                    s.shimAddTrackRemoveTrack(n),
                    s.shimGetSendersWithDtmf(n),
                    s.shimSenderReceiverGetStats(n),
                    s.fixNegotiationNeeded(n),
                    c.shimRTCIceCandidate(n),
                    c.shimMaxMessageSize(n),
                    c.shimSendThrowTypeError(n);
                    break;
                case "firefox":
                    if (!l || !l.shimPeerConnection || !o.shimFirefox)
                        return a("Firefox shim is not included in this adapter release."),
                        u;
                    a("adapter.js shimming firefox."),
                    u.browserShim = l,
                    c.shimCreateObjectURL(n),
                    l.shimGetUserMedia(n),
                    l.shimSourceObject(n),
                    l.shimPeerConnection(n),
                    l.shimOnTrack(n),
                    l.shimRemoveStream(n),
                    l.shimSenderGetStats(n),
                    l.shimReceiverGetStats(n),
                    l.shimRTCDataChannel(n),
                    c.shimRTCIceCandidate(n),
                    c.shimMaxMessageSize(n),
                    c.shimSendThrowTypeError(n);
                    break;
                case "edge":
                    if (!r || !r.shimPeerConnection || !o.shimEdge)
                        return a("MS edge shim is not included in this adapter release."),
                        u;
                    a("adapter.js shimming edge."),
                    u.browserShim = r,
                    c.shimCreateObjectURL(n),
                    r.shimGetUserMedia(n),
                    r.shimPeerConnection(n),
                    r.shimReplaceTrack(n),
                    c.shimMaxMessageSize(n),
                    c.shimSendThrowTypeError(n);
                    break;
                case "safari":
                    if (!d || !o.shimSafari)
                        return a("Safari shim is not included in this adapter release."),
                        u;
                    a("adapter.js shimming safari."),
                    u.browserShim = d,
                    c.shimCreateObjectURL(n),
                    d.shimRTCIceServerUrls(n),
                    d.shimCallbacksAPI(n),
                    d.shimLocalStreamsAPI(n),
                    d.shimRemoteStreamsAPI(n),
                    d.shimTrackEventTransceiver(n),
                    d.shimGetUserMedia(n),
                    d.shimCreateOfferLegacy(n),
                    c.shimRTCIceCandidate(n),
                    c.shimMaxMessageSize(n),
                    c.shimSendThrowTypeError(n);
                    break;
                default:
                    a("Unsupported browser!")
                }
                return u
            }
        }
        , {
            "./chrome/chrome_shim": 5,
            "./common_shim": 7,
            "./edge/edge_shim": 8,
            "./firefox/firefox_shim": 11,
            "./safari/safari_shim": 13,
            "./utils": 14
        }],
        5: [function(e, t, i) {
            var l = e("../utils.js")
              , n = l.log;
            function o(i, t, e) {
                var n = e ? "outbound-rtp" : "inbound-rtp"
                  , o = new Map;
                if (null === t)
                    return o;
                var a = [];
                return i.forEach(function(e) {
                    "track" === e.type && e.trackIdentifier === t.id && a.push(e)
                }),
                a.forEach(function(t) {
                    i.forEach(function(e) {
                        e.type === n && e.trackId === t.id && !function t(i, n, o) {
                            n && !o.has(n.id) && (o.set(n.id, n),
                            Object.keys(n).forEach(function(e) {
                                e.endsWith("Id") ? t(i, i.get(n[e]), o) : e.endsWith("Ids") && n[e].forEach(function(e) {
                                    t(i, i.get(e), o)
                                })
                            }))
                        }(i, e, o)
                    })
                }),
                o
            }
            t.exports = {
                shimGetUserMedia: e("./getusermedia"),
                shimMediaStream: function(e) {
                    e.MediaStream = e.MediaStream || e.webkitMediaStream
                },
                shimOnTrack: function(a) {
                    var e;
                    "object" != typeof a || !a.RTCPeerConnection || "ontrack"in a.RTCPeerConnection.prototype ? "RTCRtpTransceiver"in a || l.wrapPeerConnectionEvent(a, "track", function(e) {
                        return e.transceiver || (e.transceiver = {
                            receiver: e.receiver
                        }),
                        e
                    }) : (Object.defineProperty(a.RTCPeerConnection.prototype, "ontrack", {
                        get: function() {
                            return this._ontrack
                        },
                        set: function(e) {
                            this._ontrack && this.removeEventListener("track", this._ontrack),
                            this.addEventListener("track", this._ontrack = e)
                        },
                        enumerable: !0,
                        configurable: !0
                    }),
                    e = a.RTCPeerConnection.prototype.setRemoteDescription,
                    a.RTCPeerConnection.prototype.setRemoteDescription = function() {
                        var o = this;
                        return o._ontrackpoly || (o._ontrackpoly = function(n) {
                            n.stream.addEventListener("addtrack", function(t) {
                                var e = a.RTCPeerConnection.prototype.getReceivers ? o.getReceivers().find(function(e) {
                                    return e.track && e.track.id === t.track.id
                                }) : {
                                    track: t.track
                                }
                                  , i = new Event("track");
                                i.track = t.track,
                                i.receiver = e,
                                i.transceiver = {
                                    receiver: e
                                },
                                i.streams = [n.stream],
                                o.dispatchEvent(i)
                            }),
                            n.stream.getTracks().forEach(function(t) {
                                var e = a.RTCPeerConnection.prototype.getReceivers ? o.getReceivers().find(function(e) {
                                    return e.track && e.track.id === t.id
                                }) : {
                                    track: t
                                }
                                  , i = new Event("track");
                                i.track = t,
                                i.receiver = e,
                                i.transceiver = {
                                    receiver: e
                                },
                                i.streams = [n.stream],
                                o.dispatchEvent(i)
                            })
                        }
                        ,
                        o.addEventListener("addstream", o._ontrackpoly)),
                        e.apply(o, arguments)
                    }
                    )
                },
                shimGetSendersWithDtmf: function(e) {
                    var n, o, t, i, a, s;
                    "object" == typeof e && e.RTCPeerConnection && !("getSenders"in e.RTCPeerConnection.prototype) && "createDTMFSender"in e.RTCPeerConnection.prototype ? (n = function(e, t) {
                        return {
                            track: t,
                            get dtmf() {
                                return void 0 === this._dtmf && ("audio" === t.kind ? this._dtmf = e.createDTMFSender(t) : this._dtmf = null),
                                this._dtmf
                            },
                            _pc: e
                        }
                    }
                    ,
                    e.RTCPeerConnection.prototype.getSenders || (e.RTCPeerConnection.prototype.getSenders = function() {
                        return this._senders = this._senders || [],
                        this._senders.slice()
                    }
                    ,
                    o = e.RTCPeerConnection.prototype.addTrack,
                    e.RTCPeerConnection.prototype.addTrack = function(e, t) {
                        var i = o.apply(this, arguments);
                        return i || (i = n(this, e),
                        this._senders.push(i)),
                        i
                    }
                    ,
                    t = e.RTCPeerConnection.prototype.removeTrack,
                    e.RTCPeerConnection.prototype.removeTrack = function(e) {
                        t.apply(this, arguments);
                        e = this._senders.indexOf(e);
                        -1 !== e && this._senders.splice(e, 1)
                    }
                    ),
                    i = e.RTCPeerConnection.prototype.addStream,
                    e.RTCPeerConnection.prototype.addStream = function(e) {
                        var t = this;
                        t._senders = t._senders || [],
                        i.apply(t, [e]),
                        e.getTracks().forEach(function(e) {
                            t._senders.push(n(t, e))
                        })
                    }
                    ,
                    a = e.RTCPeerConnection.prototype.removeStream,
                    e.RTCPeerConnection.prototype.removeStream = function(e) {
                        var i = this;
                        i._senders = i._senders || [],
                        a.apply(i, [e]),
                        e.getTracks().forEach(function(t) {
                            var e = i._senders.find(function(e) {
                                return e.track === t
                            });
                            e && i._senders.splice(i._senders.indexOf(e), 1)
                        })
                    }
                    ) : "object" == typeof e && e.RTCPeerConnection && "getSenders"in e.RTCPeerConnection.prototype && "createDTMFSender"in e.RTCPeerConnection.prototype && e.RTCRtpSender && !("dtmf"in e.RTCRtpSender.prototype) && (s = e.RTCPeerConnection.prototype.getSenders,
                    e.RTCPeerConnection.prototype.getSenders = function() {
                        var t = this
                          , e = s.apply(t, []);
                        return e.forEach(function(e) {
                            e._pc = t
                        }),
                        e
                    }
                    ,
                    Object.defineProperty(e.RTCRtpSender.prototype, "dtmf", {
                        get: function() {
                            return void 0 === this._dtmf && ("audio" === this.track.kind ? this._dtmf = this._pc.createDTMFSender(this.track) : this._dtmf = null),
                            this._dtmf
                        }
                    }))
                },
                shimSenderReceiverGetStats: function(e) {
                    var i, t, n, a;
                    "object" == typeof e && e.RTCPeerConnection && e.RTCRtpSender && e.RTCRtpReceiver && ("getStats"in e.RTCRtpSender.prototype || ((i = e.RTCPeerConnection.prototype.getSenders) && (e.RTCPeerConnection.prototype.getSenders = function() {
                        var t = this
                          , e = i.apply(t, []);
                        return e.forEach(function(e) {
                            e._pc = t
                        }),
                        e
                    }
                    ),
                    (t = e.RTCPeerConnection.prototype.addTrack) && (e.RTCPeerConnection.prototype.addTrack = function() {
                        var e = t.apply(this, arguments);
                        return e._pc = this,
                        e
                    }
                    ),
                    e.RTCRtpSender.prototype.getStats = function() {
                        var t = this;
                        return this._pc.getStats().then(function(e) {
                            return o(e, t.track, !0)
                        })
                    }
                    ),
                    "getStats"in e.RTCRtpReceiver.prototype || ((n = e.RTCPeerConnection.prototype.getReceivers) && (e.RTCPeerConnection.prototype.getReceivers = function() {
                        var t = this
                          , e = n.apply(t, []);
                        return e.forEach(function(e) {
                            e._pc = t
                        }),
                        e
                    }
                    ),
                    l.wrapPeerConnectionEvent(e, "track", function(e) {
                        return e.receiver._pc = e.srcElement,
                        e
                    }),
                    e.RTCRtpReceiver.prototype.getStats = function() {
                        var t = this;
                        return this._pc.getStats().then(function(e) {
                            return o(e, t.track, !1)
                        })
                    }
                    ),
                    "getStats"in e.RTCRtpSender.prototype && "getStats"in e.RTCRtpReceiver.prototype && (a = e.RTCPeerConnection.prototype.getStats,
                    e.RTCPeerConnection.prototype.getStats = function() {
                        if (0 < arguments.length && arguments[0]instanceof e.MediaStreamTrack) {
                            var t, i, n, o = arguments[0];
                            return this.getSenders().forEach(function(e) {
                                e.track === o && (t ? n = !0 : t = e)
                            }),
                            this.getReceivers().forEach(function(e) {
                                return e.track === o && (i ? n = !0 : i = e),
                                e.track === o
                            }),
                            n || t && i ? Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")) : t ? t.getStats() : i ? i.getStats() : Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))
                        }
                        return a.apply(this, arguments)
                    }
                    ))
                },
                shimSourceObject: function(e) {
                    var i = e && e.URL;
                    "object" == typeof e && (!e.HTMLMediaElement || "srcObject"in e.HTMLMediaElement.prototype || Object.defineProperty(e.HTMLMediaElement.prototype, "srcObject", {
                        get: function() {
                            return this._srcObject
                        },
                        set: function(e) {
                            var t = this;
                            this._srcObject = e,
                            this.src && i.revokeObjectURL(this.src),
                            e ? (this.src = i.createObjectURL(e),
                            e.addEventListener("addtrack", function() {
                                t.src && i.revokeObjectURL(t.src),
                                t.src = i.createObjectURL(e)
                            }),
                            e.addEventListener("removetrack", function() {
                                t.src && i.revokeObjectURL(t.src),
                                t.src = i.createObjectURL(e)
                            })) : this.src = ""
                        }
                    }))
                },
                shimAddTrackRemoveTrackWithNative: function(e) {
                    e.RTCPeerConnection.prototype.getLocalStreams = function() {
                        var t = this;
                        return this._shimmedLocalStreams = this._shimmedLocalStreams || {},
                        Object.keys(this._shimmedLocalStreams).map(function(e) {
                            return t._shimmedLocalStreams[e][0]
                        })
                    }
                    ;
                    var n = e.RTCPeerConnection.prototype.addTrack;
                    e.RTCPeerConnection.prototype.addTrack = function(e, t) {
                        if (!t)
                            return n.apply(this, arguments);
                        this._shimmedLocalStreams = this._shimmedLocalStreams || {};
                        var i = n.apply(this, arguments);
                        return this._shimmedLocalStreams[t.id] ? -1 === this._shimmedLocalStreams[t.id].indexOf(i) && this._shimmedLocalStreams[t.id].push(i) : this._shimmedLocalStreams[t.id] = [t, i],
                        i
                    }
                    ;
                    var o = e.RTCPeerConnection.prototype.addStream;
                    e.RTCPeerConnection.prototype.addStream = function(e) {
                        var i = this;
                        this._shimmedLocalStreams = this._shimmedLocalStreams || {},
                        e.getTracks().forEach(function(t) {
                            if (i.getSenders().find(function(e) {
                                return e.track === t
                            }))
                                throw new DOMException("Track already exists.","InvalidAccessError")
                        });
                        var t = i.getSenders();
                        o.apply(this, arguments);
                        var n = i.getSenders().filter(function(e) {
                            return -1 === t.indexOf(e)
                        });
                        this._shimmedLocalStreams[e.id] = [e].concat(n)
                    }
                    ;
                    var t = e.RTCPeerConnection.prototype.removeStream;
                    e.RTCPeerConnection.prototype.removeStream = function(e) {
                        return this._shimmedLocalStreams = this._shimmedLocalStreams || {},
                        delete this._shimmedLocalStreams[e.id],
                        t.apply(this, arguments)
                    }
                    ;
                    var a = e.RTCPeerConnection.prototype.removeTrack;
                    e.RTCPeerConnection.prototype.removeTrack = function(i) {
                        var n = this;
                        return this._shimmedLocalStreams = this._shimmedLocalStreams || {},
                        i && Object.keys(this._shimmedLocalStreams).forEach(function(e) {
                            var t = n._shimmedLocalStreams[e].indexOf(i);
                            -1 !== t && n._shimmedLocalStreams[e].splice(t, 1),
                            1 === n._shimmedLocalStreams[e].length && delete n._shimmedLocalStreams[e]
                        }),
                        a.apply(this, arguments)
                    }
                },
                shimAddTrackRemoveTrack: function(o) {
                    var e = l.detectBrowser(o);
                    if (o.RTCPeerConnection.prototype.addTrack && 65 <= e.version)
                        return this.shimAddTrackRemoveTrackWithNative(o);
                    var i = o.RTCPeerConnection.prototype.getLocalStreams;
                    o.RTCPeerConnection.prototype.getLocalStreams = function() {
                        var t = this
                          , e = i.apply(this);
                        return t._reverseStreams = t._reverseStreams || {},
                        e.map(function(e) {
                            return t._reverseStreams[e.id]
                        })
                    }
                    ;
                    var n = o.RTCPeerConnection.prototype.addStream;
                    o.RTCPeerConnection.prototype.addStream = function(e) {
                        var t, i = this;
                        i._streams = i._streams || {},
                        i._reverseStreams = i._reverseStreams || {},
                        e.getTracks().forEach(function(t) {
                            if (i.getSenders().find(function(e) {
                                return e.track === t
                            }))
                                throw new DOMException("Track already exists.","InvalidAccessError")
                        }),
                        i._reverseStreams[e.id] || (t = new o.MediaStream(e.getTracks()),
                        i._streams[e.id] = t,
                        i._reverseStreams[t.id] = e,
                        e = t),
                        n.apply(i, [e])
                    }
                    ;
                    var a = o.RTCPeerConnection.prototype.removeStream;
                    function s(i, e) {
                        var n = e.sdp;
                        return Object.keys(i._reverseStreams || []).forEach(function(e) {
                            var t = i._reverseStreams[e]
                              , e = i._streams[t.id];
                            n = n.replace(new RegExp(e.id,"g"), t.id)
                        }),
                        new RTCSessionDescription({
                            type: e.type,
                            sdp: n
                        })
                    }
                    o.RTCPeerConnection.prototype.removeStream = function(e) {
                        var t = this;
                        t._streams = t._streams || {},
                        t._reverseStreams = t._reverseStreams || {},
                        a.apply(t, [t._streams[e.id] || e]),
                        delete t._reverseStreams[(t._streams[e.id] || e).id],
                        delete t._streams[e.id]
                    }
                    ,
                    o.RTCPeerConnection.prototype.addTrack = function(t, e) {
                        var i = this;
                        if ("closed" === i.signalingState)
                            throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");
                        var n = [].slice.call(arguments, 1);
                        if (1 !== n.length || !n[0].getTracks().find(function(e) {
                            return e === t
                        }))
                            throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");
                        if (i.getSenders().find(function(e) {
                            return e.track === t
                        }))
                            throw new DOMException("Track already exists.","InvalidAccessError");
                        i._streams = i._streams || {},
                        i._reverseStreams = i._reverseStreams || {};
                        n = i._streams[e.id];
                        return n ? (n.addTrack(t),
                        Promise.resolve().then(function() {
                            i.dispatchEvent(new Event("negotiationneeded"))
                        })) : (n = new o.MediaStream([t]),
                        i._streams[e.id] = n,
                        i._reverseStreams[n.id] = e,
                        i.addStream(n)),
                        i.getSenders().find(function(e) {
                            return e.track === t
                        })
                    }
                    ,
                    ["createOffer", "createAnswer"].forEach(function(e) {
                        var n = o.RTCPeerConnection.prototype[e];
                        o.RTCPeerConnection.prototype[e] = function() {
                            var t = this
                              , i = arguments;
                            return arguments.length && "function" == typeof arguments[0] ? n.apply(t, [function(e) {
                                e = s(t, e);
                                i[0].apply(null, [e])
                            }
                            , function(e) {
                                i[1] && i[1].apply(null, e)
                            }
                            , arguments[2]]) : n.apply(t, arguments).then(function(e) {
                                return s(t, e)
                            })
                        }
                    });
                    var t = o.RTCPeerConnection.prototype.setLocalDescription;
                    o.RTCPeerConnection.prototype.setLocalDescription = function() {
                        var i, e, n;
                        return arguments.length && arguments[0].type && (arguments[0] = (i = this,
                        n = (e = arguments[0]).sdp,
                        Object.keys(i._reverseStreams || []).forEach(function(e) {
                            var t = i._reverseStreams[e]
                              , e = i._streams[t.id];
                            n = n.replace(new RegExp(t.id,"g"), e.id)
                        }),
                        new RTCSessionDescription({
                            type: e.type,
                            sdp: n
                        }))),
                        t.apply(this, arguments)
                    }
                    ;
                    var r = Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype, "localDescription");
                    Object.defineProperty(o.RTCPeerConnection.prototype, "localDescription", {
                        get: function() {
                            var e = r.get.apply(this);
                            return "" === e.type ? e : s(this, e)
                        }
                    }),
                    o.RTCPeerConnection.prototype.removeTrack = function(t) {
                        var i, n = this;
                        if ("closed" === n.signalingState)
                            throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");
                        if (!t._pc)
                            throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");
                        if (!(t._pc === n))
                            throw new DOMException("Sender was not created by this connection.","InvalidAccessError");
                        n._streams = n._streams || {},
                        Object.keys(n._streams).forEach(function(e) {
                            n._streams[e].getTracks().find(function(e) {
                                return t.track === e
                            }) && (i = n._streams[e])
                        }),
                        i && (1 === i.getTracks().length ? n.removeStream(n._reverseStreams[i.id]) : i.removeTrack(t.track),
                        n.dispatchEvent(new Event("negotiationneeded")))
                    }
                },
                shimPeerConnection: function(i) {
                    var a, e = l.detectBrowser(i);
                    !i.RTCPeerConnection && i.webkitRTCPeerConnection ? (i.RTCPeerConnection = function(e, t) {
                        return n("PeerConnection"),
                        e && e.iceTransportPolicy && (e.iceTransports = e.iceTransportPolicy),
                        new i.webkitRTCPeerConnection(e,t)
                    }
                    ,
                    i.RTCPeerConnection.prototype = i.webkitRTCPeerConnection.prototype,
                    i.webkitRTCPeerConnection.generateCertificate && Object.defineProperty(i.RTCPeerConnection, "generateCertificate", {
                        get: function() {
                            return i.webkitRTCPeerConnection.generateCertificate
                        }
                    })) : (a = i.RTCPeerConnection,
                    i.RTCPeerConnection = function(e, t) {
                        if (e && e.iceServers) {
                            for (var i = [], n = 0; n < e.iceServers.length; n++) {
                                var o = e.iceServers[n];
                                !o.hasOwnProperty("urls") && o.hasOwnProperty("url") ? (l.deprecated("RTCIceServer.url", "RTCIceServer.urls"),
                                (o = JSON.parse(JSON.stringify(o))).urls = o.url,
                                i.push(o)) : i.push(e.iceServers[n])
                            }
                            e.iceServers = i
                        }
                        return new a(e,t)
                    }
                    ,
                    i.RTCPeerConnection.prototype = a.prototype,
                    Object.defineProperty(i.RTCPeerConnection, "generateCertificate", {
                        get: function() {
                            return a.generateCertificate
                        }
                    }));
                    var r = i.RTCPeerConnection.prototype.getStats;
                    i.RTCPeerConnection.prototype.getStats = function(e, t, i) {
                        var n = this
                          , o = arguments;
                        if (0 < arguments.length && "function" == typeof e)
                            return r.apply(this, arguments);
                        if (0 === r.length && (0 === arguments.length || "function" != typeof e))
                            return r.apply(this, []);
                        function a(e) {
                            var n = {};
                            return e.result().forEach(function(t) {
                                var i = {
                                    id: t.id,
                                    timestamp: t.timestamp,
                                    type: {
                                        localcandidate: "local-candidate",
                                        remotecandidate: "remote-candidate"
                                    }[t.type] || t.type
                                };
                                t.names().forEach(function(e) {
                                    i[e] = t.stat(e)
                                }),
                                n[i.id] = i
                            }),
                            n
                        }
                        function s(t) {
                            return new Map(Object.keys(t).map(function(e) {
                                return [e, t[e]]
                            }))
                        }
                        if (2 <= arguments.length)
                            return r.apply(this, [function(e) {
                                o[1](s(a(e)))
                            }
                            , e]);
                        return new Promise(function(t, e) {
                            r.apply(n, [function(e) {
                                t(s(a(e)))
                            }
                            , e])
                        }
                        ).then(t, i)
                    }
                    ,
                    e.version < 51 && ["setLocalDescription", "setRemoteDescription", "addIceCandidate"].forEach(function(e) {
                        var o = i.RTCPeerConnection.prototype[e];
                        i.RTCPeerConnection.prototype[e] = function() {
                            var i = arguments
                              , n = this
                              , e = new Promise(function(e, t) {
                                o.apply(n, [i[0], e, t])
                            }
                            );
                            return i.length < 2 ? e : e.then(function() {
                                i[1].apply(null, [])
                            }, function(e) {
                                3 <= i.length && i[2].apply(null, [e])
                            })
                        }
                    }),
                    e.version < 52 && ["createOffer", "createAnswer"].forEach(function(e) {
                        var o = i.RTCPeerConnection.prototype[e];
                        i.RTCPeerConnection.prototype[e] = function() {
                            var i = this;
                            if (arguments.length < 1 || 1 === arguments.length && "object" == typeof arguments[0]) {
                                var n = 1 === arguments.length ? arguments[0] : void 0;
                                return new Promise(function(e, t) {
                                    o.apply(i, [e, t, n])
                                }
                                )
                            }
                            return o.apply(this, arguments)
                        }
                    }),
                    ["setLocalDescription", "setRemoteDescription", "addIceCandidate"].forEach(function(e) {
                        var t = i.RTCPeerConnection.prototype[e];
                        i.RTCPeerConnection.prototype[e] = function() {
                            return arguments[0] = new ("addIceCandidate" === e ? i.RTCIceCandidate : i.RTCSessionDescription)(arguments[0]),
                            t.apply(this, arguments)
                        }
                    });
                    var t = i.RTCPeerConnection.prototype.addIceCandidate;
                    i.RTCPeerConnection.prototype.addIceCandidate = function() {
                        return arguments[0] ? t.apply(this, arguments) : (arguments[1] && arguments[1].apply(null),
                        Promise.resolve())
                    }
                },
                fixNegotiationNeeded: function(e) {
                    l.wrapPeerConnectionEvent(e, "negotiationneeded", function(e) {
                        if ("stable" === e.target.signalingState)
                            return e
                    })
                },
                shimGetDisplayMedia: function(e, i) {
                    "getDisplayMedia"in e.navigator || ("function" == typeof i ? navigator.getDisplayMedia = function(t) {
                        return i(t).then(function(e) {
                            return t.video = {
                                mandatory: {
                                    chromeMediaSource: "desktop",
                                    chromeMediaSourceId: e,
                                    maxFrameRate: t.video.frameRate || 3
                                }
                            },
                            navigator.mediaDevices.getUserMedia(t)
                        })
                    }
                    : console.error("shimGetDisplayMedia: getSourceId argument is not a function"))
                }
            }
        }
        , {
            "../utils.js": 14,
            "./getusermedia": 6
        }],
        6: [function(e, t, i) {
            var l = e("../utils.js")
              , d = l.log;
            t.exports = function(e) {
                function s(o) {
                    if ("object" != typeof o || o.mandatory || o.optional)
                        return o;
                    var a = {};
                    return Object.keys(o).forEach(function(t) {
                        var i, n, e;
                        "require" !== t && "advanced" !== t && "mediaSource" !== t && (void 0 !== (i = "object" == typeof o[t] ? o[t] : {
                            ideal: o[t]
                        }).exact && "number" == typeof i.exact && (i.min = i.max = i.exact),
                        n = function(e, t) {
                            return e ? e + t.charAt(0).toUpperCase() + t.slice(1) : "deviceId" === t ? "sourceId" : t
                        }
                        ,
                        void 0 !== i.ideal && (a.optional = a.optional || [],
                        e = {},
                        "number" == typeof i.ideal ? (e[n("min", t)] = i.ideal,
                        a.optional.push(e),
                        (e = {})[n("max", t)] = i.ideal) : e[n("", t)] = i.ideal,
                        a.optional.push(e)),
                        void 0 !== i.exact && "number" != typeof i.exact ? (a.mandatory = a.mandatory || {},
                        a.mandatory[n("", t)] = i.exact) : ["min", "max"].forEach(function(e) {
                            void 0 !== i[e] && (a.mandatory = a.mandatory || {},
                            a.mandatory[n(e, t)] = i[e])
                        }))
                    }),
                    o.advanced && (a.optional = (a.optional || []).concat(o.advanced)),
                    a
                }
                function n(i, n) {
                    if (61 <= t.version)
                        return n(i);
                    if ((i = JSON.parse(JSON.stringify(i))) && "object" == typeof i.audio && ((e = function(e, t, i) {
                        t in e && !(i in e) && (e[i] = e[t],
                        delete e[t])
                    }
                    )((i = JSON.parse(JSON.stringify(i))).audio, "autoGainControl", "googAutoGainControl"),
                    e(i.audio, "noiseSuppression", "googNoiseSuppression"),
                    i.audio = s(i.audio)),
                    i && "object" == typeof i.video) {
                        var o, a = (a = i.video.facingMode) && ("object" == typeof a ? a : {
                            ideal: a
                        }), e = t.version < 66;
                        if (a && ("user" === a.exact || "environment" === a.exact || "user" === a.ideal || "environment" === a.ideal) && (!r.mediaDevices.getSupportedConstraints || !r.mediaDevices.getSupportedConstraints().facingMode || e))
                            if (delete i.video.facingMode,
                            "environment" === a.exact || "environment" === a.ideal ? o = ["back", "rear"] : "user" !== a.exact && "user" !== a.ideal || (o = ["front"]),
                            o)
                                return r.mediaDevices.enumerateDevices().then(function(e) {
                                    var t = (e = e.filter(function(e) {
                                        return "videoinput" === e.kind
                                    })).find(function(t) {
                                        return o.some(function(e) {
                                            return -1 !== t.label.toLowerCase().indexOf(e)
                                        })
                                    });
                                    return (t = !t && e.length && -1 !== o.indexOf("back") ? e[e.length - 1] : t) && (i.video.deviceId = a.exact ? {
                                        exact: t.deviceId
                                    } : {
                                        ideal: t.deviceId
                                    }),
                                    i.video = s(i.video),
                                    d("chrome: " + JSON.stringify(i)),
                                    n(i)
                                });
                        i.video = s(i.video)
                    }
                    return d("chrome: " + JSON.stringify(i)),
                    n(i)
                }
                function o(e) {
                    return {
                        name: {
                            PermissionDeniedError: "NotAllowedError",
                            PermissionDismissedError: "NotAllowedError",
                            InvalidStateError: "NotAllowedError",
                            DevicesNotFoundError: "NotFoundError",
                            ConstraintNotSatisfiedError: "OverconstrainedError",
                            TrackStartError: "NotReadableError",
                            MediaDeviceFailedDueToShutdown: "NotAllowedError",
                            MediaDeviceKillSwitchOn: "NotAllowedError",
                            TabCaptureError: "AbortError",
                            ScreenCaptureError: "AbortError",
                            DeviceCaptureError: "AbortError"
                        }[e.name] || e.name,
                        message: e.message,
                        constraint: e.constraint || e.constraintName,
                        toString: function() {
                            return this.name + (this.message && ": ") + this.message
                        }
                    }
                }
                var t = l.detectBrowser(e)
                  , r = e && e.navigator;
                r.getUserMedia = function(e, t, i) {
                    n(e, function(e) {
                        r.webkitGetUserMedia(e, t, function(e) {
                            i && i(o(e))
                        })
                    })
                }
                ;
                function i(i) {
                    return new Promise(function(e, t) {
                        r.getUserMedia(i, e, t)
                    }
                    )
                }
                var a;
                r.mediaDevices || (r.mediaDevices = {
                    getUserMedia: i,
                    enumerateDevices: function() {
                        return new Promise(function(t) {
                            var i = {
                                audio: "audioinput",
                                video: "videoinput"
                            };
                            return e.MediaStreamTrack.getSources(function(e) {
                                t(e.map(function(e) {
                                    return {
                                        label: e.label,
                                        kind: i[e.kind],
                                        deviceId: e.id,
                                        groupId: ""
                                    }
                                }))
                            })
                        }
                        )
                    },
                    getSupportedConstraints: function() {
                        return {
                            deviceId: !0,
                            echoCancellation: !0,
                            facingMode: !0,
                            frameRate: !0,
                            height: !0,
                            width: !0
                        }
                    }
                }),
                r.mediaDevices.getUserMedia ? (a = r.mediaDevices.getUserMedia.bind(r.mediaDevices),
                r.mediaDevices.getUserMedia = function(e) {
                    return n(e, function(t) {
                        return a(t).then(function(e) {
                            if (t.audio && !e.getAudioTracks().length || t.video && !e.getVideoTracks().length)
                                throw e.getTracks().forEach(function(e) {
                                    e.stop()
                                }),
                                new DOMException("","NotFoundError");
                            return e
                        }, function(e) {
                            return Promise.reject(o(e))
                        })
                    })
                }
                ) : r.mediaDevices.getUserMedia = i,
                void 0 === r.mediaDevices.addEventListener && (r.mediaDevices.addEventListener = function() {
                    d("Dummy mediaDevices.addEventListener called.")
                }
                ),
                void 0 === r.mediaDevices.removeEventListener && (r.mediaDevices.removeEventListener = function() {
                    d("Dummy mediaDevices.removeEventListener called.")
                }
                )
            }
        }
        , {
            "../utils.js": 14
        }],
        7: [function(e, t, i) {
            var s = e("sdp")
              , l = e("./utils");
            t.exports = {
                shimRTCIceCandidate: function(t) {
                    var o;
                    !t.RTCIceCandidate || t.RTCIceCandidate && "foundation"in t.RTCIceCandidate.prototype || (o = t.RTCIceCandidate,
                    t.RTCIceCandidate = function(e) {
                        if ("object" == typeof e && e.candidate && 0 === e.candidate.indexOf("a=") && ((e = JSON.parse(JSON.stringify(e))).candidate = e.candidate.substr(2)),
                        e.candidate && e.candidate.length) {
                            var t = new o(e)
                              , i = s.parseCandidate(e.candidate)
                              , n = Object.assign(t, i);
                            return n.toJSON = function() {
                                return {
                                    candidate: n.candidate,
                                    sdpMid: n.sdpMid,
                                    sdpMLineIndex: n.sdpMLineIndex,
                                    usernameFragment: n.usernameFragment
                                }
                            }
                            ,
                            n
                        }
                        return new o(e)
                    }
                    ,
                    t.RTCIceCandidate.prototype = o.prototype,
                    l.wrapPeerConnectionEvent(t, "icecandidate", function(e) {
                        return e.candidate && Object.defineProperty(e, "candidate", {
                            value: new t.RTCIceCandidate(e.candidate),
                            writable: "false"
                        }),
                        e
                    }))
                },
                shimCreateObjectURL: function(e) {
                    var i, t, n, o, a, s, r = e && e.URL;
                    "object" == typeof e && e.HTMLMediaElement && "srcObject"in e.HTMLMediaElement.prototype && r.createObjectURL && r.revokeObjectURL && (i = r.createObjectURL.bind(r),
                    t = r.revokeObjectURL.bind(r),
                    n = new Map,
                    o = 0,
                    r.createObjectURL = function(e) {
                        if ("getTracks"in e) {
                            var t = "polyblob:" + ++o;
                            return n.set(t, e),
                            l.deprecated("URL.createObjectURL(stream)", "elem.srcObject = stream"),
                            t
                        }
                        return i(e)
                    }
                    ,
                    r.revokeObjectURL = function(e) {
                        t(e),
                        n.delete(e)
                    }
                    ,
                    a = Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype, "src"),
                    Object.defineProperty(e.HTMLMediaElement.prototype, "src", {
                        get: function() {
                            return a.get.apply(this)
                        },
                        set: function(e) {
                            return this.srcObject = n.get(e) || null,
                            a.set.apply(this, [e])
                        }
                    }),
                    s = e.HTMLMediaElement.prototype.setAttribute,
                    e.HTMLMediaElement.prototype.setAttribute = function() {
                        return 2 === arguments.length && "src" === ("" + arguments[0]).toLowerCase() && (this.srcObject = n.get(arguments[1]) || null),
                        s.apply(this, arguments)
                    }
                    )
                },
                shimMaxMessageSize: function(e) {
                    var o, a;
                    !e.RTCSctpTransport && e.RTCPeerConnection && (o = l.detectBrowser(e),
                    "sctp"in e.RTCPeerConnection.prototype || Object.defineProperty(e.RTCPeerConnection.prototype, "sctp", {
                        get: function() {
                            return void 0 === this._sctp ? null : this._sctp
                        }
                    }),
                    a = e.RTCPeerConnection.prototype.setRemoteDescription,
                    e.RTCPeerConnection.prototype.setRemoteDescription = function() {
                        var e, t, i, n;
                        return this._sctp = null,
                        function(e) {
                            e = s.splitSections(e.sdp);
                            return e.shift(),
                            e.some(function(e) {
                                e = s.parseMLine(e);
                                return e && "application" === e.kind && -1 !== e.protocol.indexOf("SCTP")
                            })
                        }(arguments[0]) && (t = function(e) {
                            e = e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);
                            if (null === e || e.length < 2)
                                return -1;
                            e = parseInt(e[1], 10);
                            return e != e ? -1 : e
                        }(arguments[0]),
                        i = t,
                        n = 65536,
                        n = n = "firefox" === o.browser ? o.version < 57 ? -1 === i ? 16384 : 2147483637 : o.version < 60 ? 57 === o.version ? 65535 : 65536 : 2147483637 : n,
                        t = function(e, t) {
                            var i = 65536;
                            "firefox" === o.browser && 57 === o.version && (i = 65535);
                            e = s.matchPrefix(e.sdp, "a=max-message-size:");
                            return 0 < e.length ? i = parseInt(e[0].substr(19), 10) : "firefox" === o.browser && -1 !== t && (i = 2147483637),
                            i
                        }(arguments[0], t),
                        e = 0 === n && 0 === t ? Number.POSITIVE_INFINITY : 0 === n || 0 === t ? Math.max(n, t) : Math.min(n, t),
                        t = {},
                        Object.defineProperty(t, "maxMessageSize", {
                            get: function() {
                                return e
                            }
                        }),
                        this._sctp = t),
                        a.apply(this, arguments)
                    }
                    )
                },
                shimSendThrowTypeError: function(e) {
                    var t;
                    function i(t, i) {
                        var n = t.send;
                        t.send = function() {
                            var e = arguments[0]
                              , e = e.length || e.size || e.byteLength;
                            if ("open" === t.readyState && i.sctp && e > i.sctp.maxMessageSize)
                                throw new TypeError("Message too large (can send a maximum of " + i.sctp.maxMessageSize + " bytes)");
                            return n.apply(t, arguments)
                        }
                    }
                    e.RTCPeerConnection && "createDataChannel"in e.RTCPeerConnection.prototype && (t = e.RTCPeerConnection.prototype.createDataChannel,
                    e.RTCPeerConnection.prototype.createDataChannel = function() {
                        var e = t.apply(this, arguments);
                        return i(e, this),
                        e
                    }
                    ,
                    l.wrapPeerConnectionEvent(e, "datachannel", function(e) {
                        return i(e.channel, e.target),
                        e
                    }))
                }
            }
        }
        , {
            "./utils": 14,
            sdp: 2
        }],
        8: [function(e, t, i) {
            var o = e("../utils")
              , a = e("./filtericeservers")
              , s = e("rtcpeerconnection-shim");
            t.exports = {
                shimGetUserMedia: e("./getusermedia"),
                shimPeerConnection: function(e) {
                    var i, t = o.detectBrowser(e);
                    e.RTCIceGatherer && (e.RTCIceCandidate || (e.RTCIceCandidate = function(e) {
                        return e
                    }
                    ),
                    e.RTCSessionDescription || (e.RTCSessionDescription = function(e) {
                        return e
                    }
                    ),
                    t.version < 15025 && (i = Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype, "enabled"),
                    Object.defineProperty(e.MediaStreamTrack.prototype, "enabled", {
                        set: function(e) {
                            i.set.call(this, e);
                            var t = new Event("enabled");
                            t.enabled = e,
                            this.dispatchEvent(t)
                        }
                    }))),
                    !e.RTCRtpSender || "dtmf"in e.RTCRtpSender.prototype || Object.defineProperty(e.RTCRtpSender.prototype, "dtmf", {
                        get: function() {
                            return void 0 === this._dtmf && ("audio" === this.track.kind ? this._dtmf = new e.RTCDtmfSender(this) : "video" === this.track.kind && (this._dtmf = null)),
                            this._dtmf
                        }
                    }),
                    e.RTCDtmfSender && !e.RTCDTMFSender && (e.RTCDTMFSender = e.RTCDtmfSender);
                    var n = s(e, t.version);
                    e.RTCPeerConnection = function(e) {
                        return e && e.iceServers && (e.iceServers = a(e.iceServers)),
                        new n(e)
                    }
                    ,
                    e.RTCPeerConnection.prototype = n.prototype
                },
                shimReplaceTrack: function(e) {
                    !e.RTCRtpSender || "replaceTrack"in e.RTCRtpSender.prototype || (e.RTCRtpSender.prototype.replaceTrack = e.RTCRtpSender.prototype.setTrack)
                }
            }
        }
        , {
            "../utils": 14,
            "./filtericeservers": 9,
            "./getusermedia": 10,
            "rtcpeerconnection-shim": 1
        }],
        9: [function(e, t, i) {
            var a = e("../utils");
            t.exports = function(e, n) {
                var o = !1;
                return (e = JSON.parse(JSON.stringify(e))).filter(function(e) {
                    if (e && (e.urls || e.url)) {
                        var t = e.urls || e.url;
                        e.url && !e.urls && a.deprecated("RTCIceServer.url", "RTCIceServer.urls");
                        var i = "string" == typeof t
                          , t = (t = i ? [t] : t).filter(function(e) {
                            return 0 !== e.indexOf("turn:") || -1 === e.indexOf("transport=udp") || -1 !== e.indexOf("turn:[") || o ? 0 === e.indexOf("stun:") && 14393 <= n && -1 === e.indexOf("?transport=udp") : o = !0
                        });
                        return delete e.url,
                        e.urls = i ? t[0] : t,
                        !!t.length
                    }
                })
            }
        }
        , {
            "../utils": 14
        }],
        10: [function(e, t, i) {
            t.exports = function(e) {
                var e = e && e.navigator
                  , t = e.mediaDevices.getUserMedia.bind(e.mediaDevices);
                e.mediaDevices.getUserMedia = function(e) {
                    return t(e).catch(function(e) {
                        return Promise.reject({
                            name: {
                                PermissionDeniedError: "NotAllowedError"
                            }[(e = e).name] || e.name,
                            message: e.message,
                            constraint: e.constraint,
                            toString: function() {
                                return this.name
                            }
                        })
                    })
                }
            }
        }
        , {}],
        11: [function(e, t, i) {
            var n = e("../utils");
            t.exports = {
                shimGetUserMedia: e("./getusermedia"),
                shimOnTrack: function(e) {
                    "object" != typeof e || !e.RTCPeerConnection || "ontrack"in e.RTCPeerConnection.prototype || Object.defineProperty(e.RTCPeerConnection.prototype, "ontrack", {
                        get: function() {
                            return this._ontrack
                        },
                        set: function(e) {
                            this._ontrack && (this.removeEventListener("track", this._ontrack),
                            this.removeEventListener("addstream", this._ontrackpoly)),
                            this.addEventListener("track", this._ontrack = e),
                            this.addEventListener("addstream", this._ontrackpoly = function(i) {
                                i.stream.getTracks().forEach(function(e) {
                                    var t = new Event("track");
                                    t.track = e,
                                    t.receiver = {
                                        track: e
                                    },
                                    t.transceiver = {
                                        receiver: t.receiver
                                    },
                                    t.streams = [i.stream],
                                    this.dispatchEvent(t)
                                }
                                .bind(this))
                            }
                            .bind(this))
                        }
                    }),
                    "object" == typeof e && e.RTCTrackEvent && "receiver"in e.RTCTrackEvent.prototype && !("transceiver"in e.RTCTrackEvent.prototype) && Object.defineProperty(e.RTCTrackEvent.prototype, "transceiver", {
                        get: function() {
                            return {
                                receiver: this.receiver
                            }
                        }
                    })
                },
                shimSourceObject: function(e) {
                    "object" == typeof e && (!e.HTMLMediaElement || "srcObject"in e.HTMLMediaElement.prototype || Object.defineProperty(e.HTMLMediaElement.prototype, "srcObject", {
                        get: function() {
                            return this.mozSrcObject
                        },
                        set: function(e) {
                            this.mozSrcObject = e
                        }
                    }))
                },
                shimPeerConnection: function(r) {
                    var e, a, i, l = n.detectBrowser(r);
                    "object" == typeof r && (r.RTCPeerConnection || r.mozRTCPeerConnection) && (r.RTCPeerConnection || (r.RTCPeerConnection = function(e, t) {
                        if (l.version < 38 && e && e.iceServers) {
                            for (var i = [], n = 0; n < e.iceServers.length; n++) {
                                var o = e.iceServers[n];
                                if (o.hasOwnProperty("urls"))
                                    for (var a = 0; a < o.urls.length; a++) {
                                        var s = {
                                            url: o.urls[a]
                                        };
                                        0 === o.urls[a].indexOf("turn") && (s.username = o.username,
                                        s.credential = o.credential),
                                        i.push(s)
                                    }
                                else
                                    i.push(e.iceServers[n])
                            }
                            e.iceServers = i
                        }
                        return new r.mozRTCPeerConnection(e,t)
                    }
                    ,
                    r.RTCPeerConnection.prototype = r.mozRTCPeerConnection.prototype,
                    r.mozRTCPeerConnection.generateCertificate && Object.defineProperty(r.RTCPeerConnection, "generateCertificate", {
                        get: function() {
                            return r.mozRTCPeerConnection.generateCertificate
                        }
                    }),
                    r.RTCSessionDescription = r.mozRTCSessionDescription,
                    r.RTCIceCandidate = r.mozRTCIceCandidate),
                    ["setLocalDescription", "setRemoteDescription", "addIceCandidate"].forEach(function(e) {
                        var t = r.RTCPeerConnection.prototype[e];
                        r.RTCPeerConnection.prototype[e] = function() {
                            return arguments[0] = new ("addIceCandidate" === e ? r.RTCIceCandidate : r.RTCSessionDescription)(arguments[0]),
                            t.apply(this, arguments)
                        }
                    }),
                    e = r.RTCPeerConnection.prototype.addIceCandidate,
                    r.RTCPeerConnection.prototype.addIceCandidate = function() {
                        return arguments[0] ? e.apply(this, arguments) : (arguments[1] && arguments[1].apply(null),
                        Promise.resolve())
                    }
                    ,
                    a = {
                        inboundrtp: "inbound-rtp",
                        outboundrtp: "outbound-rtp",
                        candidatepair: "candidate-pair",
                        localcandidate: "local-candidate",
                        remotecandidate: "remote-candidate"
                    },
                    i = r.RTCPeerConnection.prototype.getStats,
                    r.RTCPeerConnection.prototype.getStats = function(e, o, t) {
                        return i.apply(this, [e || null]).then(function(i) {
                            var t, n;
                            if (l.version < 48 && (t = i,
                            n = new Map,
                            Object.keys(t).forEach(function(e) {
                                n.set(e, t[e]),
                                n[e] = t[e]
                            }),
                            i = n),
                            l.version < 53 && !o)
                                try {
                                    i.forEach(function(e) {
                                        e.type = a[e.type] || e.type
                                    })
                                } catch (e) {
                                    if ("TypeError" !== e.name)
                                        throw e;
                                    i.forEach(function(e, t) {
                                        i.set(t, Object.assign({}, e, {
                                            type: a[e.type] || e.type
                                        }))
                                    })
                                }
                            return i
                        }).then(o, t)
                    }
                    )
                },
                shimSenderGetStats: function(e) {
                    var i, t;
                    "object" == typeof e && e.RTCPeerConnection && e.RTCRtpSender && (e.RTCRtpSender && "getStats"in e.RTCRtpSender.prototype || ((i = e.RTCPeerConnection.prototype.getSenders) && (e.RTCPeerConnection.prototype.getSenders = function() {
                        var t = this
                          , e = i.apply(t, []);
                        return e.forEach(function(e) {
                            e._pc = t
                        }),
                        e
                    }
                    ),
                    (t = e.RTCPeerConnection.prototype.addTrack) && (e.RTCPeerConnection.prototype.addTrack = function() {
                        var e = t.apply(this, arguments);
                        return e._pc = this,
                        e
                    }
                    ),
                    e.RTCRtpSender.prototype.getStats = function() {
                        return this.track ? this._pc.getStats(this.track) : Promise.resolve(new Map)
                    }
                    ))
                },
                shimReceiverGetStats: function(e) {
                    var i;
                    "object" == typeof e && e.RTCPeerConnection && e.RTCRtpSender && (e.RTCRtpSender && "getStats"in e.RTCRtpReceiver.prototype || ((i = e.RTCPeerConnection.prototype.getReceivers) && (e.RTCPeerConnection.prototype.getReceivers = function() {
                        var t = this
                          , e = i.apply(t, []);
                        return e.forEach(function(e) {
                            e._pc = t
                        }),
                        e
                    }
                    ),
                    n.wrapPeerConnectionEvent(e, "track", function(e) {
                        return e.receiver._pc = e.srcElement,
                        e
                    }),
                    e.RTCRtpReceiver.prototype.getStats = function() {
                        return this._pc.getStats(this.track)
                    }
                    ))
                },
                shimRemoveStream: function(e) {
                    !e.RTCPeerConnection || "removeStream"in e.RTCPeerConnection.prototype || (e.RTCPeerConnection.prototype.removeStream = function(t) {
                        var i = this;
                        n.deprecated("removeStream", "removeTrack"),
                        this.getSenders().forEach(function(e) {
                            e.track && -1 !== t.getTracks().indexOf(e.track) && i.removeTrack(e)
                        })
                    }
                    )
                },
                shimRTCDataChannel: function(e) {
                    e.DataChannel && !e.RTCDataChannel && (e.RTCDataChannel = e.DataChannel)
                },
                shimGetDisplayMedia: function(e, t) {
                    "getDisplayMedia"in e.navigator || (navigator.getDisplayMedia = function(e) {
                        if (e && e.video)
                            return !0 === e.video ? e.video = {
                                mediaSource: t
                            } : e.video.mediaSource = t,
                            navigator.mediaDevices.getUserMedia(e);
                        e = new DOMException("getDisplayMedia without video constraints is undefined");
                        return e.name = "NotFoundError",
                        e.code = 8,
                        Promise.reject(e)
                    }
                    )
                }
            }
        }
        , {
            "../utils": 14,
            "./getusermedia": 12
        }],
        12: [function(e, t, i) {
            var u = e("../utils")
              , p = u.log;
            t.exports = function(e) {
                function o(e) {
                    return {
                        name: {
                            InternalError: "NotReadableError",
                            NotSupportedError: "TypeError",
                            PermissionDeniedError: "NotAllowedError",
                            SecurityError: "NotAllowedError"
                        }[e.name] || e.name,
                        message: {
                            "The operation is insecure.": "The request is not allowed by the user agent or the platform in the current context."
                        }[e.message] || e.message,
                        constraint: e.constraint,
                        toString: function() {
                            return this.name + (this.message && ": ") + this.message
                        }
                    }
                }
                function n(e, t, i) {
                    function n(n) {
                        if ("object" != typeof n || n.require)
                            return n;
                        var o = [];
                        return Object.keys(n).forEach(function(e) {
                            var t, i;
                            "require" !== e && "advanced" !== e && "mediaSource" !== e && (void 0 === (t = n[e] = "object" == typeof n[e] ? n[e] : {
                                ideal: n[e]
                            }).min && void 0 === t.max && void 0 === t.exact || o.push(e),
                            void 0 !== t.exact && ("number" == typeof t.exact ? t.min = t.max = t.exact : n[e] = t.exact,
                            delete t.exact),
                            void 0 !== t.ideal && (n.advanced = n.advanced || [],
                            i = {},
                            "number" == typeof t.ideal ? i[e] = {
                                min: t.ideal,
                                max: t.ideal
                            } : i[e] = t.ideal,
                            n.advanced.push(i),
                            delete t.ideal,
                            Object.keys(t).length || delete n[e]))
                        }),
                        o.length && (n.require = o),
                        n
                    }
                    return e = JSON.parse(JSON.stringify(e)),
                    d.version < 38 && (p("spec: " + JSON.stringify(e)),
                    e.audio && (e.audio = n(e.audio)),
                    e.video && (e.video = n(e.video)),
                    p("ff37: " + JSON.stringify(e))),
                    c.mozGetUserMedia(e, t, function(e) {
                        i(o(e))
                    })
                }
                var t, i, a, s, r, l, d = u.detectBrowser(e), c = e && e.navigator, e = e && e.MediaStreamTrack;
                c.mediaDevices || (c.mediaDevices = {
                    getUserMedia: function(i) {
                        return new Promise(function(e, t) {
                            n(i, e, t)
                        }
                        )
                    },
                    addEventListener: function() {},
                    removeEventListener: function() {}
                }),
                c.mediaDevices.enumerateDevices = c.mediaDevices.enumerateDevices || function() {
                    return new Promise(function(e) {
                        e([{
                            kind: "audioinput",
                            deviceId: "default",
                            label: "",
                            groupId: ""
                        }, {
                            kind: "videoinput",
                            deviceId: "default",
                            label: "",
                            groupId: ""
                        }])
                    }
                    )
                }
                ,
                d.version < 41 && (t = c.mediaDevices.enumerateDevices.bind(c.mediaDevices),
                c.mediaDevices.enumerateDevices = function() {
                    return t().then(void 0, function(e) {
                        if ("NotFoundError" === e.name)
                            return [];
                        throw e
                    })
                }
                ),
                d.version < 49 && (i = c.mediaDevices.getUserMedia.bind(c.mediaDevices),
                c.mediaDevices.getUserMedia = function(t) {
                    return i(t).then(function(e) {
                        if (t.audio && !e.getAudioTracks().length || t.video && !e.getVideoTracks().length)
                            throw e.getTracks().forEach(function(e) {
                                e.stop()
                            }),
                            new DOMException("The object can not be found here.","NotFoundError");
                        return e
                    }, function(e) {
                        return Promise.reject(o(e))
                    })
                }
                ),
                55 < d.version && "autoGainControl"in c.mediaDevices.getSupportedConstraints() || (a = function(e, t, i) {
                    t in e && !(i in e) && (e[i] = e[t],
                    delete e[t])
                }
                ,
                s = c.mediaDevices.getUserMedia.bind(c.mediaDevices),
                c.mediaDevices.getUserMedia = function(e) {
                    return "object" == typeof e && "object" == typeof e.audio && (e = JSON.parse(JSON.stringify(e)),
                    a(e.audio, "autoGainControl", "mozAutoGainControl"),
                    a(e.audio, "noiseSuppression", "mozNoiseSuppression")),
                    s(e)
                }
                ,
                e && e.prototype.getSettings && (r = e.prototype.getSettings,
                e.prototype.getSettings = function() {
                    var e = r.apply(this, arguments);
                    return a(e, "mozAutoGainControl", "autoGainControl"),
                    a(e, "mozNoiseSuppression", "noiseSuppression"),
                    e
                }
                ),
                e && e.prototype.applyConstraints && (l = e.prototype.applyConstraints,
                e.prototype.applyConstraints = function(e) {
                    return "audio" === this.kind && "object" == typeof e && (e = JSON.parse(JSON.stringify(e)),
                    a(e, "autoGainControl", "mozAutoGainControl"),
                    a(e, "noiseSuppression", "mozNoiseSuppression")),
                    l.apply(this, [e])
                }
                )),
                c.getUserMedia = function(e, t, i) {
                    if (d.version < 44)
                        return n(e, t, i);
                    u.deprecated("navigator.getUserMedia", "navigator.mediaDevices.getUserMedia"),
                    c.mediaDevices.getUserMedia(e).then(t, i)
                }
            }
        }
        , {
            "../utils": 14
        }],
        13: [function(e, t, i) {
            var s = e("../utils");
            t.exports = {
                shimLocalStreamsAPI: function(e) {
                    var n;
                    "object" == typeof e && e.RTCPeerConnection && ("getLocalStreams"in e.RTCPeerConnection.prototype || (e.RTCPeerConnection.prototype.getLocalStreams = function() {
                        return this._localStreams || (this._localStreams = []),
                        this._localStreams
                    }
                    ),
                    "getStreamById"in e.RTCPeerConnection.prototype || (e.RTCPeerConnection.prototype.getStreamById = function(t) {
                        var i = null;
                        return this._localStreams && this._localStreams.forEach(function(e) {
                            e.id === t && (i = e)
                        }),
                        this._remoteStreams && this._remoteStreams.forEach(function(e) {
                            e.id === t && (i = e)
                        }),
                        i
                    }
                    ),
                    "addStream"in e.RTCPeerConnection.prototype || (n = e.RTCPeerConnection.prototype.addTrack,
                    e.RTCPeerConnection.prototype.addStream = function(t) {
                        this._localStreams || (this._localStreams = []),
                        -1 === this._localStreams.indexOf(t) && this._localStreams.push(t);
                        var i = this;
                        t.getTracks().forEach(function(e) {
                            n.call(i, e, t)
                        })
                    }
                    ,
                    e.RTCPeerConnection.prototype.addTrack = function(e, t) {
                        return t && (this._localStreams ? -1 === this._localStreams.indexOf(t) && this._localStreams.push(t) : this._localStreams = [t]),
                        n.call(this, e, t)
                    }
                    ),
                    "removeStream"in e.RTCPeerConnection.prototype || (e.RTCPeerConnection.prototype.removeStream = function(e) {
                        this._localStreams || (this._localStreams = []);
                        var t, i, n = this._localStreams.indexOf(e);
                        -1 !== n && (this._localStreams.splice(n, 1),
                        t = this,
                        i = e.getTracks(),
                        this.getSenders().forEach(function(e) {
                            -1 !== i.indexOf(e.track) && t.removeTrack(e)
                        }))
                    }
                    ))
                },
                shimRemoteStreamsAPI: function(e) {
                    "object" == typeof e && e.RTCPeerConnection && ("getRemoteStreams"in e.RTCPeerConnection.prototype || (e.RTCPeerConnection.prototype.getRemoteStreams = function() {
                        return this._remoteStreams || []
                    }
                    ),
                    "onaddstream"in e.RTCPeerConnection.prototype || Object.defineProperty(e.RTCPeerConnection.prototype, "onaddstream", {
                        get: function() {
                            return this._onaddstream
                        },
                        set: function(e) {
                            var i = this;
                            this._onaddstream && (this.removeEventListener("addstream", this._onaddstream),
                            this.removeEventListener("track", this._onaddstreampoly)),
                            this.addEventListener("addstream", this._onaddstream = e),
                            this.addEventListener("track", this._onaddstreampoly = function(e) {
                                e.streams.forEach(function(e) {
                                    var t;
                                    i._remoteStreams || (i._remoteStreams = []),
                                    0 <= i._remoteStreams.indexOf(e) || (i._remoteStreams.push(e),
                                    (t = new Event("addstream")).stream = e,
                                    i.dispatchEvent(t))
                                })
                            }
                            )
                        }
                    }))
                },
                shimCallbacksAPI: function(e) {
                    var n, o, a, s, r;
                    "object" == typeof e && e.RTCPeerConnection && (e = e.RTCPeerConnection.prototype,
                    n = e.createOffer,
                    o = e.createAnswer,
                    a = e.setLocalDescription,
                    s = e.setRemoteDescription,
                    r = e.addIceCandidate,
                    e.createOffer = function(e, t) {
                        var i = n.apply(this, [2 <= arguments.length ? arguments[2] : e]);
                        return t ? (i.then(e, t),
                        Promise.resolve()) : i
                    }
                    ,
                    e.createAnswer = function(e, t) {
                        var i = o.apply(this, [2 <= arguments.length ? arguments[2] : e]);
                        return t ? (i.then(e, t),
                        Promise.resolve()) : i
                    }
                    ,
                    e.setLocalDescription = function(e, t, i) {
                        e = a.apply(this, [e]);
                        return i ? (e.then(t, i),
                        Promise.resolve()) : e
                    }
                    ,
                    e.setRemoteDescription = function(e, t, i) {
                        e = s.apply(this, [e]);
                        return i ? (e.then(t, i),
                        Promise.resolve()) : e
                    }
                    ,
                    e.addIceCandidate = function(e, t, i) {
                        e = r.apply(this, [e]);
                        return i ? (e.then(t, i),
                        Promise.resolve()) : e
                    }
                    )
                },
                shimGetUserMedia: function(e) {
                    var n = e && e.navigator;
                    n.getUserMedia || (n.webkitGetUserMedia ? n.getUserMedia = n.webkitGetUserMedia.bind(n) : n.mediaDevices && n.mediaDevices.getUserMedia && (n.getUserMedia = function(e, t, i) {
                        n.mediaDevices.getUserMedia(e).then(t, i)
                    }
                    .bind(n)))
                },
                shimRTCIceServerUrls: function(e) {
                    var a = e.RTCPeerConnection;
                    e.RTCPeerConnection = function(e, t) {
                        if (e && e.iceServers) {
                            for (var i = [], n = 0; n < e.iceServers.length; n++) {
                                var o = e.iceServers[n];
                                !o.hasOwnProperty("urls") && o.hasOwnProperty("url") ? (s.deprecated("RTCIceServer.url", "RTCIceServer.urls"),
                                (o = JSON.parse(JSON.stringify(o))).urls = o.url,
                                delete o.url,
                                i.push(o)) : i.push(e.iceServers[n])
                            }
                            e.iceServers = i
                        }
                        return new a(e,t)
                    }
                    ,
                    e.RTCPeerConnection.prototype = a.prototype,
                    "generateCertificate"in e.RTCPeerConnection && Object.defineProperty(e.RTCPeerConnection, "generateCertificate", {
                        get: function() {
                            return a.generateCertificate
                        }
                    })
                },
                shimTrackEventTransceiver: function(e) {
                    "object" == typeof e && e.RTCPeerConnection && "receiver"in e.RTCTrackEvent.prototype && !e.RTCTransceiver && Object.defineProperty(e.RTCTrackEvent.prototype, "transceiver", {
                        get: function() {
                            return {
                                receiver: this.receiver
                            }
                        }
                    })
                },
                shimCreateOfferLegacy: function(e) {
                    var i = e.RTCPeerConnection.prototype.createOffer;
                    e.RTCPeerConnection.prototype.createOffer = function(e) {
                        var t;
                        return e && (void 0 !== e.offerToReceiveAudio && (e.offerToReceiveAudio = !!e.offerToReceiveAudio),
                        t = this.getTransceivers().find(function(e) {
                            return e.sender.track && "audio" === e.sender.track.kind
                        }),
                        !1 === e.offerToReceiveAudio && t ? "sendrecv" === t.direction ? t.setDirection ? t.setDirection("sendonly") : t.direction = "sendonly" : "recvonly" === t.direction && (t.setDirection ? t.setDirection("inactive") : t.direction = "inactive") : !0 !== e.offerToReceiveAudio || t || this.addTransceiver("audio"),
                        void 0 !== e.offerToReceiveAudio && (e.offerToReceiveVideo = !!e.offerToReceiveVideo),
                        t = this.getTransceivers().find(function(e) {
                            return e.sender.track && "video" === e.sender.track.kind
                        }),
                        !1 === e.offerToReceiveVideo && t ? "sendrecv" === t.direction ? t.setDirection("sendonly") : "recvonly" === t.direction && t.setDirection("inactive") : !0 !== e.offerToReceiveVideo || t || this.addTransceiver("video")),
                        i.apply(this, arguments)
                    }
                }
            }
        }
        , {
            "../utils": 14
        }],
        14: [function(e, t, i) {
            var n = !0
              , o = !0;
            function a(e, t, i) {
                t = e.match(t);
                return t && t.length >= i && parseInt(t[i], 10)
            }
            t.exports = {
                extractVersion: a,
                wrapPeerConnectionEvent: function(e, n, o) {
                    var a, s;
                    e.RTCPeerConnection && (e = e.RTCPeerConnection.prototype,
                    a = e.addEventListener,
                    e.addEventListener = function(e, t) {
                        if (e !== n)
                            return a.apply(this, arguments);
                        function i(e) {
                            (e = o(e)) && t(e)
                        }
                        return this._eventMap = this._eventMap || {},
                        this._eventMap[t] = i,
                        a.apply(this, [e, i])
                    }
                    ,
                    s = e.removeEventListener,
                    e.removeEventListener = function(e, t) {
                        if (e !== n || !this._eventMap || !this._eventMap[t])
                            return s.apply(this, arguments);
                        var i = this._eventMap[t];
                        return delete this._eventMap[t],
                        s.apply(this, [e, i])
                    }
                    ,
                    Object.defineProperty(e, "on" + n, {
                        get: function() {
                            return this["_on" + n]
                        },
                        set: function(e) {
                            this["_on" + n] && (this.removeEventListener(n, this["_on" + n]),
                            delete this["_on" + n]),
                            e && this.addEventListener(n, this["_on" + n] = e)
                        },
                        enumerable: !0,
                        configurable: !0
                    }))
                },
                disableLog: function(e) {
                    return "boolean" != typeof e ? new Error("Argument type: " + typeof e + ". Please use a boolean.") : (n = e) ? "adapter.js logging disabled" : "adapter.js logging enabled"
                },
                disableWarnings: function(e) {
                    return "boolean" != typeof e ? new Error("Argument type: " + typeof e + ". Please use a boolean.") : (o = !e,
                    "adapter.js deprecation warnings " + (e ? "disabled" : "enabled"))
                },
                log: function() {
                    "object" == typeof window && (n || "undefined" != typeof console && "function" == typeof console.log && console.log.apply(console, arguments))
                },
                deprecated: function(e, t) {
                    o && console.warn(e + " is deprecated, please use " + t + " instead.")
                },
                detectBrowser: function(e) {
                    var t = e && e.navigator
                      , i = {
                        browser: null,
                        version: null
                    };
                    if (void 0 === e || !e.navigator)
                        return i.browser = "Not a browser.",
                        i;
                    if (t.mozGetUserMedia)
                        i.browser = "firefox",
                        i.version = a(t.userAgent, /Firefox\/(\d+)\./, 1);
                    else if (t.webkitGetUserMedia)
                        i.browser = "chrome",
                        i.version = a(t.userAgent, /Chrom(e|ium)\/(\d+)\./, 2);
                    else if (t.mediaDevices && t.userAgent.match(/Edge\/(\d+).(\d+)$/))
                        i.browser = "edge",
                        i.version = a(t.userAgent, /Edge\/(\d+).(\d+)$/, 2);
                    else {
                        if (!e.RTCPeerConnection || !t.userAgent.match(/AppleWebKit\/(\d+)\./))
                            return i.browser = "Not a supported browser.",
                            i;
                        i.browser = "safari",
                        i.version = a(t.userAgent, /AppleWebKit\/(\d+)\./, 1)
                    }
                    return i
                }
            }
        }
        , {}]
    }, {}, [3])(3)
}),
app.controllers.P2PController = function(e) {
    var r, l, t, d, c, i, u, p, f = {
        info: function() {
            console.info.apply(console, arguments)
        },
        error: function() {
            console.error.apply(console, arguments)
        }
    }, m = e.roomModel, n = e.roomView, a = 0, o = function() {
        r && !a || A("getCredential")
    }, v = {
        canSendGoldLikes: !1,
        otherUserId: null,
        selfCameraIsOn: !1,
        otherUserCameraIsOn: !1,
        otherUserVideoMuted: !1,
        otherUserFirstName: null,
        otherUserAvatar: null,
        otherUserIsMale: !1,
        otherUserAge: 0,
        otherUserExp: 0,
        audioMuted: !1,
        videoMuted: !1,
        selfUsualLikes: 0,
        selfGoldLikes: 0,
        otherUserUsualLikes: 0,
        otherUserGoldLikes: 0,
        isStarted: !1
    }, e = function(t) {
        return {
            stopAndHide: function() {
                t.style.visibility = "hidden",
                t.srcObject = null,
                t.style.outline = ""
            },
            setStreamAndShow: function(e) {
                t.style.visibility = "",
                t.srcObject = e
            }
        }
    }, h = (c = 0,
    i = new s,
    u = new s,
    {
        toggleAudioMute: function(e) {
            var t = !e;
            if (l)
                for (var i = l.getAudioTracks(), n = 0; n < i.length; ++n)
                    i[n].enabled = t
        },
        toggleVideoMute: function(e) {
            var t = !e;
            if (l)
                for (var i = l.getVideoTracks(), n = 0; n < i.length; ++n)
                    i[n].enabled = t
        },
        removeLocalVideo: function() {
            D.stopAndHide(),
            l && (void 0 === l.getTracks ? l.stop() : l.getTracks().forEach(function(e) {
                e.stop()
            }),
            l = null)
        },
        removeRemoteVideo: function() {
            T.stopAndHide(),
            y.el.removeClass("has-remote-video"),
            t && (void 0 === t.getTracks ? t.stop() : t.getTracks().forEach(function(e) {
                e.stop()
            }),
            t = null)
        },
        abortConnection: function() {
            d && (d.close(),
            p += 1,
            c = d = null)
        },
        onOffer: function(e) {},
        onAnswer: function(e) {},
        onCandidate: function(e, t) {},
        setNewLocalVideoStream: function(e) {
            this.removeLocalVideo(),
            D.setStreamAndShow(e),
            l = e,
            M()
        },
        _setupNewRemoteVideo: function(e) {
            T.setStreamAndShow(e),
            t = e,
            y.el.addClass("has-remote-video")
        },
        _tryCreateOffer: function() {
            d.createOffer({
                offerToReceiveAudio: 1,
                offerToReceiveVideo: 1,
                voiceActivityDetection: !1
            }).then(function(e) {
                d.setLocalDescription(e, function() {
                    f.info("peerConnection.setLocalDescription, setLocalDescription complete"),
                    f.info("peerConnection.createOffer", e),
                    A("offer", {
                        sdp: encodeURIComponent(e.sdp)
                    })
                }, function(e) {
                    f.error("Failed to set session description in createOffer", e),
                    dialogController.fadePopup("Ошибка при создании подключения (createOffer,setLocalDescription)")
                })
            }).catch(function(e) {
                f.error("Failed to create session description", e.toString()),
                dialogController.fadePopup("Ошибка при создании подключения (createOffer)")
            })
        },
        _startIfBothUsersReady: function() {
            u.isReady(c) && i.isReady(c) && v.otherUserId && app.info.viewer_id > v.otherUserId && this._tryCreateOffer()
        },
        onOtherUserReady: function(e) {
            i.add(e),
            this._startIfBothUsersReady()
        },
        createConnection: function(e) {
            if (this.abortConnection(),
            !l)
                return f.error("local video stream is undefined");
            var t, i, n, o, a, s;
            c = e,
            r ? (t = ++p,
            n = {
                iceServers: [{
                    urls: ["stun:stun4.l.google.com:19302", "stun:stun3.l.google.com:19302", "stun:stun2.l.google.com:19302"]
                }, {
                    urls: ["turn:138.201.82.139:3478?transport=tcp", "turn:138.201.82.139:3478?transport=udp"],
                    credential: r.password,
                    username: r.username
                }]
            },
            o = !(i = function() {
                return t === p
            }
            ),
            f.info("RTCPeerConnection.configuration", n),
            (d = new RTCPeerConnection(n)).oniceconnectionstatechange = function(e) {
                d && i() && (f.info("peerConnection.iceconnectionstatechange ", d.iceConnectionState, arguments),
                "disconnected" === d.iceConnectionState && i() && (dialogController.fadePopup("Соединение с пользователем потеряно..."),
                v.setAttr({
                    otherUserCameraIsOn: !1
                })))
            }
            ,
            d.oniceconnectionstatechange = function(e) {}
            ,
            d.onicecandidate = function(e) {
                i() && e.candidate && (f.info("peerConnection.onicecandidate", e.candidate.sdpMid, e.candidate),
                A("candidate", {
                    candidate: encodeURIComponent(e.candidate.candidate),
                    sdpMLineIndex: e.candidate.sdpMLineIndex,
                    sdpMid: e.candidate.sdpMid
                }))
            }
            ,
            d.ontrack = function(e) {
                i() && (f.info("peerConnection.ontrack", e.streams[0].active, e.streams[0]),
                h._setupNewRemoteVideo(e.streams[0]))
            }
            ,
            this.onOffer = function(e) {
                i() && (f.info("onOffer", e),
                d.setRemoteDescription(new RTCSessionDescription({
                    type: "offer",
                    sdp: decodeURIComponent(e)
                })).then(function() {
                    d.createAnswer(function(e) {
                        d.setLocalDescription(e, function() {
                            f.info("peerConnection setLocalDescription success"),
                            A("answer", {
                                sdp: encodeURIComponent(e.sdp)
                            }),
                            o = !0,
                            s()
                        }, function(e) {
                            f.error("Failed to set session description in createAnswer", e),
                            dialogController.fadePopup("Ошибка при создании подключения (setLocalDescription)")
                        })
                    }, function(e) {
                        f.error("peerConnection.createAnswer", e),
                        dialogController.fadePopup("Ошибка при создании подключения (createAnswer)")
                    })
                }, function() {
                    f.error("peerConnection.setRemoteDescription", arguments)
                }))
            }
            ,
            this.onAnswer = function(e) {
                i() && (f.info("onAnswer", e),
                d.setRemoteDescription(new RTCSessionDescription({
                    type: "answer",
                    sdp: decodeURIComponent(e)
                })).then(function() {
                    f.info("peerConnection.setRemoteDescription"),
                    o = !0,
                    s()
                }, function() {
                    f.error("peerConnection.setRemoteDescription", arguments)
                }))
            }
            ,
            a = [],
            s = function() {
                o && i() && ($.each(a, function(e, t) {
                    d.addIceCandidate(t),
                    f.info("_peerConnection.addIceCandidate", t)
                }),
                a.length = 0)
            }
            ,
            this.onCandidate = function(e) {
                i() && (f.info("onCandidate", e),
                a.push(new RTCIceCandidate({
                    sdpMLineIndex: e.sdpMLineIndex,
                    candidate: e.candidate,
                    sdpMid: e.sdpMid
                })),
                s())
            }
            ,
            u.add(e),
            d.addStream(l),
            A("ready", {
                sid: e
            }),
            this._startIfBothUsersReady()) : dialogController.showMessageDialog({
                message: "Ошибка при создании подключения. Credentials is undefined"
            })
        }
    });
    function s() {
        var n = {};
        this.add = function(e) {
            if (n[e])
                f.error("Ready flag[{0}] already exists".format(e));
            else {
                var t, i = +new Date;
                for (t in n[e] = i,
                n)
                    n.hasOwnProperty(t) && 3e5 < i - n[t] && delete n[t]
            }
        }
        ,
        this.isReady = function(e) {
            return !!n[e]
        }
    }
    var g, b, C, _, w = (b = 0,
    C = !(p = 1),
    _ = function() {
        clearTimeout(g),
        g = setTimeout(E, 1e3)
    }
    ,
    {
        check: function() {
            try {
                C && (C = !1,
                clearTimeout(g)),
                v.isStarted && v.selfCameraIsOn && v.otherUserCameraIsOn && m.isConference() && app.info.viewer_id > v.otherUserId && (C || (C = !0,
                _()))
            } catch (e) {}
        }
    });
    function E() {
        C && (6e4 < (b += 1e3) && (b = 0,
        cAnal.trackEvent({
            p2p_time: 1
        })),
        _())
    }
    var y = lilo.createView("p2p")
      , D = e(y.els["local-video"][0])
      , T = e(y.els["remove-video"][0]);
    D.stopAndHide(),
    T.stopAndHide(),
    y.setModel(v);
    function S() {
        v.isStarted && v.selfCameraIsOn && v.otherUserCameraIsOn || h.abortConnection()
    }
    function A(e, t) {
        m.roomId && ((t = $.extend({}, t || {})).action = "p2p",
        t.cmd = e,
        t.room_id = m.roomId,
        webSocketController.sendMessage(t))
    }
    function I() {
        A("state", {
            cameraState: v.selfCameraIsOn ? 1 : 0,
            videoMuted: v.videoMuted ? 1 : 0
        })
    }
    function M() {
        h.toggleAudioMute(v.audioMuted),
        h.toggleVideoMute(v.videoMuted)
    }
    v.onChange("isStarted", function() {
        S(),
        w.check()
    }),
    v.onChange("selfCameraIsOn", function() {
        v.selfCameraIsOn || h.removeLocalVideo(),
        S(),
        w.check()
    }),
    v.onChange("otherUserCameraIsOn", function() {
        v.otherUserCameraIsOn || h.removeRemoteVideo(),
        S(),
        w.check()
    }),
    v.onChange("audioMuted", function() {
        h.toggleAudioMute(v.audioMuted)
    }),
    v.onChange("videoMuted", function() {
        h.toggleVideoMute(v.videoMuted)
    }),
    v.onChange("isStarted", function() {
        v.isStarted ? n.els.p2p.append(y.el) : (y.el.detach(),
        h.abortConnection(),
        v.setAttr({
            isStarted: !1,
            selfCameraIsOn: !1,
            otherUserCameraIsOn: !1,
            otherUserFirstName: null,
            otherUserAvatar: null
        })),
        v.setAttr({
            audioMuted: !1,
            videoMuted: !1,
            selfCameraIsOn: !1,
            otherUserCameraIsOn: !1
        })
    }),
    v.onChange("isStarted", function() {
        v.isStarted ? n.els.p2p.append(y.el) : y.el.detach(),
        v.setAttr({
            selfCameraIsOn: !1,
            otherUserCameraIsOn: !1
        })
    });
    var e = function() {
        function t() {
            o = +new Date,
            a = !0;
            var i = {}
              , e = n.gold
              , t = n.usual;
            e && (i.p2p_golds = e),
            t && (i.p2p_coins = t),
            webSocketController.sendMessage({
                action: "p2p/like",
                u: n.usual,
                g: n.gold,
                r: m.roomId
            }, {}, function(e) {
                var t;
                a = !1,
                e && e.data && (t = e.data,
                util.isDef(t.balance) && app.balanceModel.setAttr({
                    balance: t.balance
                }),
                util.isDef(t.rubies) && app.balanceModel.setAttr({
                    ruby: t.rubies
                }),
                window.moneyBox && util.isDef(t.moneyBox) && null != t.moneyBox && window.moneyBox.setValue(t.moneyBox)),
                e.code === Codes.NOT_ENOUGH_BALANCE || 200 === e.code && (s(),
                cAnal.trackEvent(i)),
                f.info(e)
            }),
            n.usual = 0,
            n.gold = 0
        }
        var i, n = {
            gold: 0,
            usual: 0
        }, o = 0, a = !1, s = function() {
            var e;
            a || (490 < (e = +new Date) - o && 0 < n.gold + n.usual || 15 <= n.gold + n.usual || 2e3 < e - o ? t() : (clearTimeout(i),
            i = setTimeout(s, 2001)))
        };
        return {
            addLike: function(e) {
                if (e) {
                    var t = +n.gold
                      , i = app.balanceModel.ruby - t - 1;
                    if (i < 0)
                        return void dialogController.showInsufficientlyBalanceDialog(i, {
                            currency: StockCurrency.RUBIES
                        });
                    n.gold += 1,
                    y.animateSentGoldLike()
                } else {
                    if (t = +n.usual,
                    (i = app.balanceModel.balance - t - 1) < 0)
                        return void dialogController.showInsufficientlyBalanceDialog(i, {
                            currency: StockCurrency.COINS
                        });
                    n.usual += 1,
                    y.animateSentLike()
                }
                s()
            }
        }
    }
      , O = function(i, t) {
        t = t || 0,
        i = i || {
            video: {
                width: 640,
                height: 480
            },
            audio: !0
        },
        navigator.mediaDevices.getUserMedia(i).then(function(e) {
            if (i.audio && !e.getAudioTracks().length || i.video && !e.getVideoTracks().length)
                throw e.getTracks().forEach(function(e) {
                    e.stop()
                }),
                new DOMException("","NotFoundError");
            h.setNewLocalVideoStream(e),
            v.setAttr({
                audioMuted: !1,
                videoMuted: !1,
                selfCameraIsOn: !0
            }),
            M(),
            I()
        }).catch(function(e) {
            return "NotFoundError" === e.name && 0 === t ? navigator.mediaDevices.enumerateDevices().then(function(e) {
                var t = e.find(function(e) {
                    return "videoinput" === e.kind
                })
                  , e = e.find(function(e) {
                    return "audioinput" === e.kind
                })
                  , e = {
                    video: t && i.video,
                    audio: e && i.audio
                };
                O(e, 1)
            }) : (dialogController.showMessageDialog({
                message: "Не удалось получить доступ к камере!<br> name: {0}{1}".format(e.name, e.message ? "<br>message:" + e.message : ""),
                buttons: [{
                    caption: "Как разблокировать?",
                    handler: function() {
                        try {
                            window.open(document.location.protocol + "//vk.com/page-75820678_50104561", "_blank").focus()
                        } catch (e) {}
                        return !1
                    }
                }]
            }),
            void f.error("mediaDevices.getUserMedia error", e))
        })
    };
    y.bind("make-call", function() {
        O()
    }),
    y.bind("hang-up", function() {
        h.removeRemoteVideo(),
        h.removeLocalVideo(),
        h.abortConnection(),
        v.setAttr({
            audioMuted: !1,
            videoMuted: !1,
            selfCameraIsOn: !1
        }),
        M(),
        I()
    }),
    y.bind("toggle-audio-off", function() {
        v.setAttr({
            audioMuted: !0
        })
    }),
    y.bind("toggle-audio-on", function() {
        v.setAttr({
            audioMuted: !1
        })
    }),
    y.bind("toggle-video-off", function() {
        v.setAttr({
            videoMuted: !0
        }),
        I()
    }),
    y.bind("toggle-video-on", function() {
        v.setAttr({
            videoMuted: !1
        }),
        I()
    });
    var x = new e
      , R = new e;
    y.bind("add-like", function(e) {
        R.addLike(!1)
    }),
    y.bind("add-gold-like", function(e) {
        v.canSendGoldLikes && x.addLike(!0)
    });
    function k(e) {
        v.setAttr({
            canSendGoldLikes: 12 <= e
        })
    }
    app.eventBus.on(app.EVENTS.VIEWER_LEVEL_CHANGED, function(e) {
        k(e.level)
    }),
    k(expController.getCurrentLevel()),
    app.eventBus.on(app.EVENTS.P2P_DATA, function(e) {
        !function(e) {
            if (e.roomId === m.roomId)
                switch (e.cmd) {
                case "ready":
                    f.info("other user is ready", e.sid),
                    h.onOtherUserReady(e.sid);
                    break;
                case "sid":
                    f.info("get sid", e.sid),
                    h.createConnection(e.sid);
                    break;
                case "credential":
                    a = +new Date,
                    r = {
                        username: e.username,
                        password: e.password
                    };
                    break;
                case "offer":
                    f.info("get offer", e),
                    h.onOffer(e.sdp);
                    break;
                case "answer":
                    f.info("get answer", e),
                    h.onAnswer(e.sdp);
                    break;
                case "candidate":
                    h.onCandidate({
                        sdpMLineIndex: e.sdpMLineIndex,
                        sdpMid: e.sdpMid,
                        candidate: decodeURIComponent(e.candidate)
                    });
                    break;
                case "state":
                    var t = e.guest
                      , i = e.owner
                      , n = i.id === app.info.viewer_id ? t : i
                      , o = i.id === app.info.viewer_id ? i : t
                      , i = (i.id === app.info.viewer_id ? t : i).id;
                    v.setAttr({
                        otherUserId: i,
                        otherUserCameraIsOn: !!n.camera,
                        otherUserFirstName: n.fn || "",
                        otherUserAvatar: n.avatar || "",
                        otherUserAge: n.age || 0,
                        otherUserExp: n.exp || 0,
                        otherUserVideoMuted: !!n.videoMuted,
                        otherUserIsMale: !!n.male,
                        selfUsualLikes: o.usualLikes,
                        selfGoldLikes: o.goldLikes,
                        otherUserUsualLikes: n.usualLikes,
                        otherUserGoldLikes: n.goldLikes
                    }),
                    e.newSession && (f.info("requestNewSessionId..."),
                    A("requestNewSessionId"))
                }
            else
                f.error("unnecessary p2p server-change", e)
        }(e)
    });
    function P() {
        api.syncBalance()
    }
    app.eventBus.on(app.EVENTS.P2P_LIKE, function(e) {
        f.info("p2p like", e);
        var t, i, n = e.type, o = e.expBonus, a = e.data, s = a.gl, r = a.ul, l = e.uid, d = app.info.viewer_id, e = l === app.info.viewer_id;
        switch (n) {
        case 10:
            l === d && (i = y.getPositionOfLikeButton());
            break;
        case 11:
            l === d && (i = y.getPositionOfLikeCounter(),
            s && (window.headerView && headerView.animateCoinsBonus ? (t = {
                left: i.left - 40,
                top: i.top + 50
            },
            headerView.animateCoinsBonus(s, t, P)) : P()),
            y.animateReceivedLikes(r),
            y.animateReceivedGoldLikes(s))
        }
        e && i && (expController.animateBonus({
            incValue: o,
            sourceOffset: i
        }),
        f.info("expController.animateBonus", o, i))
    }),
    m.onChange("modCounter", function() {
        m.isConference() ? (v.setAttr({
            isStarted: !0,
            selfCameraIsOn: !1,
            otherUserCameraIsOn: !1,
            otherUserFirstName: null,
            otherUserAvatar: null
        }),
        o(),
        I()) : v.setAttr({
            isStarted: !1
        })
    }),
    this.onRoomStart = function() {}
    ,
    this.onRoomStop = function() {
        v.isStarted && v.selfCameraIsOn && y.trigger("hang-up")
    }
    ,
    app.p2LikeAnimation = function(e, t, i, n, o) {
        var o = CDN_PREFIX + "p2p/like" + (o ? 2 : 1) + ".png"
          , o = PIXI.Texture.fromImage(o)
          , a = new PIXI.Sprite(o);
        a.anchor.x = .5,
        a.anchor.y = .5,
        a.width = i,
        a.height = n;
        var s = Math.sin
          , r = Math.sqrt
          , n = util.random;
        new Date;
        var l = !0
          , d = n(290, 310)
          , c = 1.7
          , n = 3
          , u = .005
          , p = e
          , f = t
          , m = new function(e, t) {
            this.progress = 0,
            this.speed = t,
            this.phase = e
        }
        (Math.random() * n,c + Math.random())
          , v = +new Date
          , h = Math.min;
        roomController.fxController.animateItem(a, {
            _pixiSprite: a,
            isObsolete: function() {
                return !l
            },
            update: function(e) {
                var t, i, n;
                l && (t = h(1e3 / 33, e - v) / (1e3 / 33),
                a.x = p + (i = m.progress,
                n = m.phase,
                s(n + r(i) / 2) * i / 6),
                a.y = f - m.progress,
                a.alpha = 1 - m.progress / d,
                m.speed > c && (m.speed -= u),
                m.progress += m.speed * t,
                m.progress > d && (l = !1),
                v = e)
            }
        })
    }
}
,
function() {
    var E = 750
      , y = 520
      , P = "#ffffff"
      , N = P;
    function U(e) {
        if (!0 === e.isPng || !1 === e.isPng)
            return e.isPng;
        var t = util.getContentTypeFromB64(e.src);
        return e.isPng = "image/png" === t
    }
    function D(e) {
        e.imageSmoothingEnabled = !0,
        e.webkitImageSmoothingEnabled = !0,
        e.mozImageSmoothingEnabled = !0
    }
    function T(k, e) {
        var t = k.height / k.width
          , i = document.createElement("canvas")
          , n = i.getContext("2d")
          , e = (Math.round(e * t),
        e / k.width);
        return i.width = k.width,
        i.height = k.height,
        D(n),
        n.fillStyle = P,
        n.rect(0, 0, i.width, i.height),
        n.fill(),
        n.drawImage(k, 0, 0, i.width, i.height),
        1 <= e ? i : function(e, t) {
            if (!(t < 1 && 0 < t))
                throw "scale must be a positive number <1 ";
            var i = (t = function(e) {
                if (1 < e)
                    throw "s must be <1";
                var t = function(e) {
                    var t = [2, 12, 240, 65280, 4294901760]
                      , i = [1, 2, 4, 8, 16]
                      , n = 0
                      , o = 0;
                    for (n = 4; 0 <= n; n--)
                        e & t[n] && (e >>= i[n],
                        o |= i[n]);
                    return o
                }(e = 0 | 1 / e)
                  , i = 1 << t
                  , n = 4;
                for (; n && t; )
                    i |= 1 << --t,
                    n--;
                return 1 / (e & i)
            }(t)) * t
              , n = e.width
              , o = e.height
              , a = Math.round(n * t)
              , s = Math.round(o * t)
              , r = 0
              , l = 0
              , d = 0
              , c = 0
              , u = 0
              , p = 0
              , f = 0
              , m = 0
              , v = 0
              , h = 0
              , g = 0
              , b = 0
              , C = 0
              , _ = 0
              , w = 0
              , E = !1
              , y = !1
              , D = e.getContext("2d").getImageData(0, 0, n, o).data
              , T = new Float32Array(3 * n * o)
              , S = 0
              , A = 0
              , I = 0;
            for (l = 0; l < o; l++)
                for (p = 3 * (v = 0 | (u = l * t)) * a,
                (y = v != (0 | u + t)) && (_ = 1 + v - u,
                w = u + t - v - 1),
                r = 0; r < n; r++,
                d += 4)
                    f = p + 3 * (m = 0 | (c = r * t)),
                    (E = m != (0 | c + t)) && (b = 1 + m - c,
                    C = c + t - m - 1),
                    S = D[d],
                    A = D[d + 1],
                    I = D[d + 2],
                    E || y ? E && !y ? (h = b * t,
                    T[f] += S * h,
                    T[f + 1] += A * h,
                    T[f + 2] += I * h,
                    g = C * t,
                    T[f + 3] += S * g,
                    T[f + 4] += A * g,
                    T[f + 5] += I * g) : !E && y ? (h = _ * t,
                    T[f] += S * h,
                    T[f + 1] += A * h,
                    T[f + 2] += I * h,
                    g = w * t,
                    T[f + 3 * a] += S * g,
                    T[f + 3 * a + 1] += A * g,
                    T[f + 3 * a + 2] += I * g) : (h = b * _,
                    T[f] += S * h,
                    T[f + 1] += A * h,
                    T[f + 2] += I * h,
                    g = C * _,
                    T[f + 3] += S * g,
                    T[f + 4] += A * g,
                    T[f + 5] += I * g,
                    g = b * w,
                    T[f + 3 * a] += S * g,
                    T[f + 3 * a + 1] += A * g,
                    T[f + 3 * a + 2] += I * g,
                    g = C * w,
                    T[f + 3 * a + 3] += S * g,
                    T[f + 3 * a + 4] += A * g,
                    T[f + 3 * a + 5] += I * g) : (T[f] += S * i,
                    T[f + 1] += A * i,
                    T[f + 2] += I * i);
            var M = document.createElement("canvas");
            M.width = a,
            M.height = s;
            var O = M.getContext("2d");
            O.fillStyle = U(k) ? N : P,
            O.fillRect(0, 0, a, s);
            var e = O.getImageData(0, 0, a, s)
              , x = e.data
              , R = 0;
            for (f = d = 0; R < a * s; d += 3,
            f += 4,
            R++)
                x[f] = 0 | T[d],
                x[f + 1] = 0 | T[d + 1],
                x[f + 2] = 0 | T[d + 2],
                x[f + 3] = 255;
            return O.putImageData(e, 0, 0),
            M
        }(i, e)
    }
    function S(e, t) {
        e.x /= t,
        e.y /= t,
        e.width /= t,
        e.height /= t
    }
    !function() {
        var i = window
          , n = !0;
        if ($.each(["FormData", "File", "FileReader", "FileList", "Blob", "Uint8Array", "Worker", "atob"], function(e, t) {
            if (!(t in i))
                return n = !1
        }),
        n)
            try {
                app.services.util.b64toBlob("iVBORw0KGgoAAAANSUhEUgAAACIAAAAKCAYAAADRuIyZAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIFdpbmRvd3MiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RTgyM0M3NThGNUZGMTFFMzg0OUVCOTBDNURFRkRGRUUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6fTgyM0M3NTlGNUZGMTFFMzg0OUVCOTBDNURFRkRGRUUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFODIzQzc1NkY1RkYxMUUzODQ5RUI5MEM1REVGREZFRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpFODIzQzc1N0Y1RkYxMUUzODQ5RUI5MEM1REVGREZFRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvChfgIAAAEOSURBVHjaYvz///8NBgYGPyC+xUAm0F7NQLEZTECsDsQngXgCEKuRaQ7FZjBBaQEgzgfi/UAcQo5BWzwYBBR4yTeDCY0vBcSrgfgMEAeTYpAiLwPDCmcGhgoDBimgg0g2gwmHuDEQrwHi6UCsQqxhvKwMDLGqDAzz7RkY3GRIM4OJgHwGEJ8G4omkOEiMk4Gh35KBYZULA4OrDHFmMBFhLij95EGD2o+k3CQITL1AB9UZMQjI8eA3g4kEc/mBeCMQHwFie1IcFK4MCZ1KAwZ+oIOwmsFERgaxBuJNQNwHxHKkpJ8YVYiDHKUwzWAEFmj/GcgHP4B4DrBAy7kaSprG82+AieYKMPG8hpgBEGAAHik+hxkg5woAAAAASUVORK5CYII=") || (n = !1)
            } catch (e) {
                n = !1
            }
        window.IS_SUPPORT_IMAGE_EDITOR = n
    }(),
    app.controllers.ImageEditor = function(c) {
        var e, u = util.isDef(c.scale) && 0 < c.scale && c.scale <= 1 ? c.scale : 1, t = c.image, i = t.width, n = t.height, o = i / n, a = isMobi ? appWidth / 500 : 1, s = Math.floor((c.cropWidth || 40) * u), r = Math.floor((c.cropHeight || 40) * u), l = c.minWidth || Math.floor(s / 2), d = c.minHeight || Math.floor(r / 2), p = "dialog-image-editor", f = lilo.createView(p);
        for (y = isMobi ? .5 * (E = mobiUiHelper.vw2px(94)) : (E = 750,
        520); E < i || y < n; )
            E < i && (n = (i = E) / o),
            y < n && (i = (n = y) * o);
        isMobi && (s *= a,
        r *= a,
        (a = .8 * mobiUiHelper.vw2px(94)) < s && (e = s / r,
        r = (s = a) / e),
        (e = appWidth / 500) < 1 && (l *= e,
        d *= e));
        var m = s
          , v = r
          , h = (E - s) / 2
          , g = (y - r) / 2
          , b = t
          , C = (E - i) / 2
          , _ = (y - n) / 2;
        f.els.area.css({
            width: E,
            height: y
        }),
        f.els.cropper.css({
            width: m,
            height: v,
            left: h,
            top: g
        }),
        f.els["main-image"].css({
            width: i,
            height: n,
            left: C,
            top: _,
            backgroundImage: "url(" + b.src + ")"
        }),
        f.els["view-box"].attr("src", t.src).css({
            width: i,
            height: n
        });
        function w(e) {
            f.els.cropper.css({
                width: m,
                height: v
            }),
            f.els["view-box"].css({
                "margin-left": -h - 1 + C + "px",
                "margin-top": -g - 1 + _ + "px"
            }),
            e && e.element && e.element.css({
                left: e.position.left = h,
                top: e.position.top = g,
                width: e.size.width = m,
                height: e.size.height = v
            })
        }
        w(),
        f.els.cropper.draggable({
            containment: f.els.area,
            drag: function(e, t) {
                h = t.position.left,
                g = t.position.top,
                w(t)
            },
            start: function(e, t) {
                h = t.position.left,
                g = t.position.top,
                w(t)
            },
            stop: function(e, t) {
                h = t.position.left,
                g = t.position.top,
                w(t)
            }
        }),
        f.els.cropper.resizable({
            containment: f.els.area,
            aspectRatio: !0,
            minWidth: l,
            minHeight: d,
            maxWidth: E,
            maxHeight: y,
            resize: function(e, t) {
                m = t.size.width,
                v = t.size.height,
                w(t)
            },
            start: function(e, t) {
                m = t.size.width,
                v = t.size.height,
                w(t)
            },
            stop: function(e, t) {
                m = t.size.width,
                v = t.size.height,
                w(t)
            }
        }),
        f.on("ok:" + p, function() {
            var e = function(e, t, i, n) {
                S(t, u),
                S(i, u),
                S(n, u);
                var o = T(e, i.width)
                  , a = document.createElement("canvas")
                  , s = document.createElement("canvas")
                  , r = document.createElement("canvas")
                  , l = a.getContext("2d")
                  , d = r.getContext("2d")
                  , a = s.getContext("2d");
                D(l),
                D(d),
                D(a);
                l = Math.ceil(t.width + 10),
                t = Math.ceil(t.height + 10);
                s.width = Math.max(1e3, l),
                s.height = Math.max(1e3, t),
                r.width = n.width,
                r.height = n.height,
                a.fillStyle = U(e) ? N : P,
                a.rect(0, 0, s.width, s.height),
                a.fill(),
                a.drawImage(o, i.x, i.y, i.width, i.height),
                d.fillStyle = U(e) ? N : P,
                d.rect(0, 0, n.width, n.height),
                d.fill(),
                d.drawImage(s, n.x, n.y, n.width, n.height, 0, 0, n.width, n.height);
                e = c.resultContentType || util.getContentTypeFromB64(e.src);
                return r.toDataURL(e, 1)
            }(b, {
                x: 0,
                y: 0,
                width: E,
                height: y
            }, {
                x: C,
                y: _,
                width: i,
                height: n
            }, {
                x: h,
                y: g,
                width: m,
                height: v
            });
            dialogController.close(f),
            c.onOk(e)
        }),
        f.on("cancel:" + p, function() {
            dialogController.close(f)
        }),
        dialogController.open(f, {
            dialogClass: "small-close no-padding"
        })
    }
}(),
app.controllers.ImageUploader = function() {
    var r = app.services.util.b64toBlob
      , u = "'Любовь с первого взгляда'"
      , p = "Альбом приложения " + u
      , a = function() {
        return +new Date
    };
    function o(l, d) {
        var c = (d = d || {}).albumDescription || p;
        VKApi("photos.getAlbums", {}, function(e) {
            if (e.error)
                l(e.error, null);
            else {
                for (var t = e.response.items, i = null, n = 0; n < t.length; n++) {
                    var o = t[n]
                      , a = o.size < 499
                      , s = o.description && 0 <= o.description.indexOf(c);
                    if (a && s) {
                        i = o.id;
                        break
                    }
                }
                i ? l(null, i) : (r = l,
                e = {
                    title: (e = (e = d) || {}).albumTitle || "Скрытый альбом с картинками для приложения " + u,
                    description: e.albumDescription || p,
                    privacy_view: "only_me",
                    privacy_comment: "only_me"
                },
                VKApi("photos.createAlbum", e, function(e) {
                    e.error ? r(e.error) : r(null, e.response.id)
                }, "5.120"))
            }
            var r
        })
    }
    function l(e, o) {
        a();
        api.uploadBinaryData({
            uploadUrl: e.uploadUrl,
            binary: e.binary,
            contentType: e.contentType,
            beforeSend: function() {
                ajaxLoader.show()
            }
        }, function(e, t) {
            ajaxLoader.hide();
            var i;
            a();
            if (e)
                o(e);
            else {
                try {
                    var n = JSON.parse(t.vkResponse)
                } catch (e) {
                    return void o({
                        code: Codes.UNKNOWN_ERROR,
                        label: "image upload",
                        message: "Unexpected vk response; " + t.vkResponse
                    }, null)
                }
                if (n.error) {
                    try {
                        n.error.code = Codes.UNKNOWN_ERROR
                    } catch (e) {}
                    o(n.error, null)
                } else
                    i = o,
                    (n = n).album_id = n.album_id || n.aid,
                    delete n.aid,
                    VKApi("photos.save", n, function(e) {
                        e.error ? i(e.error) : i(null, e.response)
                    }, "5.120")
            }
        }).send()
    }
    this.saveImage = function(a, s, t) {
        var i = s;
        function n(t, i) {
            if (t)
                s(t);
            else if (a.base64)
                try {
                    var n = util.getContentTypeFromB64(a.base64)
                      , o = util.getBodyFromB64(a.base64);
                    l({
                        binary: r(o, n),
                        contentType: n,
                        uploadUrl: i
                    }, s)
                } catch (e) {
                    s({
                        code: Codes.OLD_BROWSER_ERROR,
                        message: "Ошибка при конвертации изображения: " + e.message
                    })
                }
            else
                s({
                    code: Codes.OLD_BROWSER_ERROR,
                    message: "Ошибка при конвертации изображения: " + e.message
                })
        }
        s = function(e, t) {
            i(e, t)
        }
        ,
        o(function(e, t) {
            var i;
            e ? s(e) : (i = n,
            VKApi("photos.getUploadServer", {
                album_id: t
            }, function(e) {
                e.error ? i(e.error) : i(null, e.response.upload_url)
            }, "5.120"))
        }, t = t || {})
    }
}
,
app.controllers.TopListController = function(e) {
    var o, n, a, s, r = 20, l = "top-list", d = !1, c = !0, u = !0, p = 0, f = 0, m = "topListFilter", v = {
        showMales: "1" !== util.lStorage.find(m),
        countryName: "",
        regionName: "",
        currentTabIsAll: !0,
        __pending: !1,
        all: {
            males: [],
            females: [],
            viewerPos: -1
        },
        byCountry: {
            males: [],
            females: [],
            viewerPos: -1
        },
        byRegion: {
            males: [],
            females: [],
            viewerPos: -1
        },
        byHaremTotalPrice: {
            users: [],
            viewerPos: -1
        }
    };
    function t() {
        o.els.loader.show()
    }
    function h() {
        o.els.loader.hide()
    }
    function g() {
        o.els.reload.hide(),
        api.user.getTopList({
            all: v.currentTabIsAll,
            harem: !v.currentTabIsAll,
            beforeSend: t
        }, function(e, t) {
            var i, n;
            d && (e ? e.code !== Codes.CACHE_LOCK_TIMEOUT ? (h(),
            dialogController.fadePopup({
                message: "Произошла ошибка при получение данных"
            }),
            o.els.reload.show()) : setTimeout(function() {
                d && g()
            }, 1e3) : (i = {},
            (e = function(e) {
                e && $.each(e, function(e, t) {
                    i[t._id] = !0
                })
            }
            )(t.users1),
            e(t.users2),
            e(t.users3),
            e(t.usersByHaremTotalPrice),
            n = [],
            (e = function(e) {
                e && e.each(function(e, t) {
                    n.push({
                        id: t._id,
                        first_name: t.fn,
                        photo_100: t._id < 0 ? app.ANONYMOUS_IMG : t.p100
                    })
                })
            }
            )(t.users1),
            e(t.users2),
            e(t.users3),
            e(t.usersByHaremTotalPrice),
            function(e) {
                h();
                function a(e, t) {
                    return e.exp > t.exp ? -1 : 1
                }
                var n, i, o, s = util.collectArrayInObjectByProperty(e.users, "id");
                t.users1 ? ((e = function(e, i, t) {
                    var n = []
                      , o = [];
                    $.each(e, function(e, t) {
                        var i = s[t._id];
                        i && (t.exp = t.exp || 0,
                        t.haremPrice = t.haremPrice || 0,
                        t.photoUrl = i.photo_100,
                        t.firstName = i.id < 0 ? "" : i.first_name + util.formatProfileBdate(i.bdate, t.age),
                        (2 === t.sex ? n : o).push(t))
                    }),
                    n.sort(a),
                    o.sort(a),
                    o.length > r && (o = o.slice(0, r)),
                    n.length > r && (n = n.slice(0, r)),
                    (i = i || 0) < 0 && (i = 0),
                    $.each(2 === app.info.sex ? n : o, function(e, t) {
                        if (t._id === app.info.viewer_id)
                            return i = 0,
                            !1
                    }),
                    t.males.removeAll(),
                    t.females.removeAll(),
                    t.males.add(n),
                    t.females.add(o),
                    t.setAttr({
                        viewerPos: i
                    })
                }
                )(t.users1, t.position1, v.all),
                e(t.users2, t.position2, v.byCountry),
                e(t.users3, t.position3, v.byRegion),
                p = util.currentMillis(),
                c = !1) : (n = [],
                $.each(t.usersByHaremTotalPrice, function(e, t) {
                    var i = s[t._id];
                    i && (t.exp = t.exp || 0,
                    t.haremPrice = t.haremPrice || 0,
                    t.photoUrl = i.photo_100,
                    t.firstName = i.id < 0 ? "" : i.first_name + util.formatProfileBdate(i.bdate, t.age),
                    n.push(t))
                }),
                n.sort(function(e, t) {
                    return e.haremTotalPrice > t.haremTotalPrice ? -1 : 1
                }),
                n.length > r && (n = n.slice(0, r)),
                i = t.position || 0,
                o = !1,
                $.each(n, function(e, t) {
                    if (t._id === app.info.viewer_id)
                        return !(o = !(i = 0))
                }),
                (o || i <= r) && (i = 0),
                v.byHaremTotalPrice.users.removeAll(),
                v.byHaremTotalPrice.users.add(n),
                v.byHaremTotalPrice.setAttr({
                    viewerPos: i
                }),
                f = util.currentMillis(),
                u = !1)
            }({
                users: n
            }),
            o.el[-20 === app.info.regionId ? "addClass" : "removeClass"]("without-region")))
        }).send(0)
    }
    function b(e, t) {
        var i = 1 === e;
        if (!t) {
            if (i && !v.currentTabIsAll)
                return;
            if (!i && v.currentTabIsAll)
                return
        }
        a = e,
        v.setAttr({
            currentTabIsAll: !i
        }),
        (i && u || !i && c) && g()
    }
    app.eventBus.on(app.EVENTS.AGE_CHANGED, function(e) {
        e = e.age;
        util.isDef(s) && e !== s && (18 <= e && s < 18 || e < 18 && 18 <= s) && (s = e,
        c = !0)
    }),
    this.start = function() {
        d = !0,
        o || ((o = lilo.createView(l)).setModel(v),
        o.on("show-profile:item-top-user-by-harem", function(e) {
            app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: e.extraData.uid,
                referrer: GuestReferrer.TOP
            })
        }),
        o.on("show-males:" + l, function() {
            v.setAttr({
                showMales: !0
            }),
            util.lStorage.save(m, "2")
        }),
        o.on("show-females:" + l, function() {
            v.setAttr({
                showMales: !1
            }),
            util.lStorage.save(m, "1")
        }),
        o.on("show-profile:item-top-user-v2", function(e) {
            app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: e.extraData.uid,
                referrer: GuestReferrer.TOP
            })
        }),
        o.on("change-tab:" + l, function(e) {
            b(e.extraData.index)
        }),
        o.on("reload:" + l, function() {
            b(v.currentTab, !0)
        }));
        var e = app.viewerProfile.countryId
          , i = socialApi.getCountryName(app.viewerProfile.countryId)
          , t = app.viewerProfile.regionId;
        socialApi.getRegionName(e, t, function(e, t) {
            d && (o.el.removeClass("no-region"),
            t || (t = "Другой регион",
            o.el.addClass("no-region")),
            12e4 < util.currentMillis() - p && (c = !0),
            12e4 < util.currentMillis() - f && (u = !0),
            v.countryName === i && v.regionName === t || (c = !0),
            s = app.info.age,
            v.setAttr({
                countryName: i,
                regionName: t
            }),
            b(util.isDef(a) ? a : 0, !0),
            n && setTimeout(function() {
                socialApi.scrollWindow(n)
            }, 50))
        }),
        $contextArea.append(o.el)
    }
    ,
    this.stop = function() {
        d = !1,
        n = socialApi.getScroll(),
        o.el.detach()
    }
}
,
function() {
    var a = []
      , t = !1;
    function s(e, t, i, n) {
        return (1 - e) * (1 - e) * t + 2 * e * (1 - e) * i + e * e * n
    }
    function r(e, t, i) {
        return (1 - e) * t + e * i
    }
    function i() {
        for (var e = a.length - 1; 0 <= e; e--)
            a[e].update();
        t && (0 == a.length ? t = !1 : setTimeout(i, 33))
    }
    app.controllers.fx = {
        startRenderLoop: function() {
            t || (t = !0,
            i())
        },
        stopRenderLoop: function() {
            t = !1
        },
        onCoinWithdrew: function(e) {
            0
        },
        removeAnimObject: function(e) {},
        emitCoin: function(e, t, n) {
            if (n = n || {},
            !IS_DESKTOP)
                return n.onDropComplete && n.onDropComplete(),
                void (n.onCollectComplete && n.onCollectComplete());
            var i, o = i = {
                el: null,
                animationProgress: 0,
                currentPos: null,
                speed: .05,
                update: function() {
                    i.animationProgress += i.speed,
                    i.currentState.update(),
                    i.el.css({
                        top: i.currentPos.y,
                        left: i.currentPos.x
                    }),
                    1 <= i.animationProgress && (a.splice(a.indexOf(i), 1),
                    i.currentState.onComplete())
                }
            };
            o.dropState = {
                startPoint: {},
                centerPoint: {},
                endPoint: {},
                update: function() {
                    o.currentPos.x = s(o.animationProgress, this.startPoint.x, this.centerPoint.x, this.endPoint.x),
                    o.currentPos.y = s(o.animationProgress, this.startPoint.y, this.centerPoint.y, this.endPoint.y)
                },
                onComplete: function() {
                    var i = this;
                    o.el.one("mouseover", function(e) {
                        o.animationProgress = 0,
                        o.currentState = o.collectedState,
                        o.currentState.update = o.dropState.update,
                        o.currentState.init(i.endPoint);
                        var t = Math.max(Math.random(), .4);
                        o.currentState.centerPoint = {},
                        o.currentState.centerPoint.x = o.currentState.startPoint.x + (i.endPoint.x - o.currentState.startPoint.x) / 2,
                        o.currentState.centerPoint.y = Math.min(o.currentState.startPoint.y, i.endPoint.y) - 130 * t,
                        a.push(o),
                        app.controllers.fx.startRenderLoop()
                    }),
                    n.onDropComplete && n.onDropComplete()
                },
                init: function(e) {
                    o.currentPos = e,
                    this.startPoint = e;
                    e = Math.max(Math.random(), .4);
                    n.dropStateEndPoint && (this.endPoint.x = n.dropStateEndPoint.x,
                    this.endPoint.y = n.dropStateEndPoint.y),
                    this.centerPoint.x = this.startPoint.x + (this.endPoint.x - this.startPoint.x) / 2,
                    this.centerPoint.y = Math.min(this.startPoint.y, this.endPoint.y) - 130 * e
                }
            },
            o.collectedState = {
                startPoint: {},
                endPoint: {},
                update: function() {
                    o.currentPos.x = r(o.animationProgress, this.startPoint.x, this.endPoint.x),
                    o.currentPos.y = r(o.animationProgress, this.startPoint.y, this.endPoint.y)
                },
                onComplete: function() {
                    o.el.remove(),
                    n.onCollectComplete && n.onCollectComplete()
                },
                init: function(e) {
                    if (this.startPoint = e,
                    o.currentPos || (o.currentPos = e),
                    n.endPoint)
                        this.endPoint = n.endPoint;
                    else {
                        if (!n.endPointProvider)
                            throw new Error("end point not specified!");
                        this.endPoint = n.endPointProvider()
                    }
                }
            },
            o.currentState = t ? o.collectedState : o.dropState,
            o.currentState.init(e),
            o.el = n.$coinEl || $("<span/>").css({
                width: "25px",
                height: "28px",
                backgroundImage: "url(" + CDN_PREFIX + "progress-star.png)",
                backgroundPosition: "0 -28px",
                backgroundRepeat: "no-repeat",
                left: e.x + "px",
                top: e.y + "px",
                position: "absolute"
            }),
            e = o,
            (n.$container || $contextArea).append(e.el),
            a.push(e),
            app.controllers.fx.startRenderLoop()
        }
    }
}(),
app.controllers.CommentsController = function(r) {
    var o = app.models.CommentModel
      , l = app.models.SubCommentModel
      , a = this
      , e = "comments-view"
      , t = "item-comment"
      , s = "dialog-add-comment"
      , d = (o.ANONYMOUS_FULL_NAME,
    o.ANONYMOUS_SELF_FULL_NAME)
      , c = o.ANONYMOUS_PHOTO_URL
      , u = r.profileModel
      , p = u.uid
      , f = p === app.info.viewer_id
      , i = r.bootData
      , m = app.info.viewer_id
      , v = o.createArrayWithSubComments(r.comments).sort(function(e, t) {
        return e.ts > t.ts ? -1 : 1
    })
      , h = {
        allComments: v,
        currentComments: [],
        ownerId: p,
        count: 0,
        currentPageIndex: 0,
        pagesCount: 0
    }
      , g = 5
      , b = lilo.createView(e)
      , C = util.indexByBinarySearch;
    function _(e, t) {
        e.comments.add(t),
        e.setAttr({
            lastReply: t.uid
        }),
        b.viewModel.update(),
        app.eventBus.trigger(app.EVENTS.ADD_SUB_COMMENT, {
            subComment: t,
            commentId: e._id,
            sourceController: a
        })
    }
    function w(i, n) {
        -1 !== i && $.each(h.allComments, function(e, t) {
            t.from === i && (t.setAttr ? t.setAttr({
                isBlock: n
            }) : t.isBlock = n)
        })
    }
    function E() {
        dialogController.showMessageDialog({
            message: "Пользователь занес вас в черный список"
        })
    }
    function n(e) {
        app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: e.extraData.uid,
            currentProfileUid: p
        })
    }
    function y(e) {
        var t = e.index
          , i = e.onComplete
          , n = e.commentIndex
          , e = Math.ceil(h.allComments.length / g);
        util.isDef(n) && n <= h.allComments.length && (t = Math.floor(n / g));
        n = h.allComments.slice(g * (t = (t = e <= t ? e - 1 : t) < 0 ? 0 : t), g * t + g);
        h.currentComments.removeAll(),
        h.setAttr({
            currentPageIndex: t,
            pagesCount: e
        }),
        h.currentComments.add(n),
        $.isFunction(i) && i()
    }
    function D() {
        f && 0 === h.allComments.length ? b.els.noComments.show() : b.els.noComments.hide()
    }
    function T(t) {
        var e, i;
        t && t[0] && (e = t.offset().top,
        t.height(),
        i = 40 + Math.max(e, e - 50),
        setTimeout(function() {
            socialApi.scrollWindow(i);
            var e = "animate-background";
            t.addClass(e),
            setTimeout(function() {
                t.removeClass(e)
            }, 2100)
        }, 100))
    }
    function S(e) {
        app.eventBus.trigger(app.EVENTS.TARGET_COMMENT_NOT_FOUND, {
            targetComment: e
        }),
        dialogController.fadePopup({
            message: "Комментарий не найден",
            duration: 800
        })
    }
    b.setModel(h),
    b.on("delete-sub-comment:" + t, function(n) {
        dialogController.confirm({
            message: "Точно удалить ?",
            onOk: function() {
                var i = api.comment.deleteSub({
                    beforeSend: function() {
                        ajaxLoader.show()
                    },
                    commentOwnerId: n.extraData.comment.to,
                    commentId: n.extraData.comment._id,
                    subCommentTs: n.extraData.subComment.ts
                }, function(e, t) {
                    ajaxLoader.hide(),
                    e ? e.code === Codes.SUB_COMMENT_NOT_FOUND || e.code === Codes.PRIORITY_BREACH ? dialogController.fadePopup({
                        message: "Не удалось удалить комментарий.<br> Попробуйте позже"
                    }) : (e.loc = "comments. delete comment",
                    dialogController.showError(e, i)) : (n.extraData.comment.comments.remove(n.extraData.subComment),
                    n.extraData.comment.setAttr({
                        pub: t.isPublic,
                        lastReply: t.lastReplyUid
                    }),
                    dialogController.fadePopup({
                        message: "Комментарий был удален!"
                    }),
                    app.eventBus.trigger(app.EVENTS.DELETE_SUB_COMMENT, {
                        comment: n.extraData.comment,
                        subComment: n.extraData.subComment
                    }))
                });
                return i.send(util.random(100, 300)),
                !1
            }
        })
    }),
    b.on("ban:" + t, function(e) {
        var i = e.extraData.model
          , n = e.extraData.view
          , o = api.comment.ban({
            commentId: i._id,
            beforeSend: function() {
                n.showLoader()
            }
        }, function(e, t) {
            e ? e.code === Codes.COMMENT_NOT_FOUND ? (dialogController.fadePopup({
                message: "Комментарий не найден"
            }),
            app.eventBus.trigger(app.EVENTS.DELETE_COMMENT, {
                commentId: i._id,
                sourceController: a
            }),
            h.currentComments.remove(i)) : (e.loc = "comments.addBan",
            dialogController.showError(e, o)) : (n.hideLoader(),
            i.setAttr({
                isBlock: !0
            }),
            w(i.from, !0))
        });
        o.send(util.random(100, 300))
    }),
    b.on("remove-ban:" + t, function(e) {
        var i = e.extraData.model
          , n = e.extraData.view
          , o = api.comment.unban({
            commentId: i._id,
            beforeSend: function() {
                n.showLoader()
            }
        }, function(e, t) {
            n.hideLoader(),
            e ? e.code === Codes.COMMENT_NOT_FOUND ? (dialogController.fadePopup({
                message: "Комментарий не найден"
            }),
            app.eventBus.trigger(app.EVENTS.DELETE_COMMENT, {
                commentId: i._id,
                sourceController: a
            }),
            h.currentComments.remove(i)) : (e.loc = "comments. remove ban",
            dialogController.showError(e, o)) : (i.setAttr({
                isBlock: !1
            }),
            w(i.from, !1))
        });
        o.send(util.random(100, 300))
    }),
    b.on("add-sub-comment:" + t, function(e) {
        var i = e.extraData.model
          , n = lilo.createView(s);
        n.setModel({}),
        n.on("ok:" + s, function(e) {
            var t = e.extraData.text
              , e = api.comment.addSubComment({
                commentId: i._id,
                commentOwnerId: p,
                text: t,
                beforeSend: function() {
                    n.showLoader()
                }
            }, function(e, t) {
                dialogController.close(n),
                e ? e.code === Codes.COMMENT_NOT_FOUND ? (dialogController.fadePopup({
                    message: "Комментарий был удален"
                }),
                app.eventBus.trigger(app.EVENTS.DELETE_COMMENT, {
                    commentId: i._id,
                    sourceController: a
                }),
                h.currentComments.remove(i)) : e.code === Codes.USER_IN_BLACK_LIST ? (E(),
                r.profileModel.setAttr({
                    canAddComment: !1
                })) : e.code === Codes.COMMUNICATION_BLOCKED ? dialogController.communicationBlockedDialog() : e.code === Codes.MAX_SUB_COMMENTS_SIZE_REACHED ? dialogController.fadePopup({
                    message: "Не удалось добавить комментарий<br>Достигнуто максимальное количество",
                    duration: 1e3
                }) : e.code === Codes.PRIORITY_BREACH ? (i.setAttr({
                    lastReply: app.info.viewer_id
                }),
                dialogController.fadePopup({
                    message: "Не удалось добавить комментарий"
                })) : dialogController.showError(e) : (e = new l(t.comment,app.info.textColor,app.info.rating,app.viewerProfile.abg),
                i.isAnonymous && i.to !== m ? (e.photoUrl = c,
                e.fullName = d,
                e.rating = null,
                e.textColor = null,
                e.abg = null) : (e.photoUrl = app.info.photo_100,
                e.fullName = app.info.first_name,
                i.from === m && (e.exp = expController.getCurrentExp())),
                e.canDelete = !0,
                util.isDef(t.rating) && u.setAttr({
                    rating: t.rating
                }),
                _(i, e))
            });
            0 < t.length && e.send(util.random(100, 300))
        }),
        dialogController.open(n),
        setTimeout(function() {
            n.els.input.focus()
        }, 0)
    }),
    b.on("delete:" + t, function(e) {
        function i(e) {
            h.currentComments.remove(t),
            dialogController.fadePopup({
                message: "Комментарий удален!"
            }),
            app.eventBus.trigger(app.EVENTS.DELETE_COMMENT, {
                commentId: t._id,
                sourceController: a
            }),
            e && util.isDef(e.rating) && u.setAttr({
                rating: e.rating
            })
        }
        var t = e.extraData.model
          , n = (e.extraData.view,
        api.comment.remove({
            commentId: t._id,
            commentOwnerId: p,
            beforeSend: function() {
                b.showLoader()
            }
        }, function(e, t) {
            b.hideLoader(),
            !e || e.code === Codes.COMMENT_NOT_FOUND ? i(t) : e.code === Codes.ACCESS_DENIED ? (b.hideLoader(),
            dialogController.fadePopup({
                message: "Не удалось удалить комментарий :(",
                duration: 1e3
            })) : (e.loc = "comments. remove comment",
            dialogController.showError(e, n))
        }));
        dialogController.confirm({
            message: "Точно удалить ?",
            onOk: function() {
                return n.send(util.random(100, 300)),
                !1
            }
        })
    }),
    b.on("add-comment:" + e, function(e) {
        var n;
        f || ((n = lilo.createView(s)).setModel({}),
        i.invis ? !!u.profileAccessKey ? (n.els.checkBox.css({
            display: "none"
        }),
        n.els["anonymous-tip"].css({
            display: "none"
        }),
        n.setCheckboxSelected(!1)) : (n.els.checkBox.css({
            display: "inline-block"
        }),
        n.setCheckboxSelected(!0)) : n.els["anonymous-tip"].css({
            display: "inline-block"
        }),
        dialogController.open(n),
        setTimeout(function() {
            n.els.input.focus()
        }, 100),
        n.on("enable-invis:" + s, function() {
            dialogController.close(n),
            app.eventBus.trigger(app.EVENTS.OPEN_INVIS_PURCHASE_DIALOG)
        }),
        n.on("ok:" + s, function(e) {
            var t = e.extraData
              , e = t.text
              , i = !!t.isAnonymous;
            0 !== e.length && api.comment.add({
                beforeSend: function() {
                    n.showLoader()
                },
                profileAccessKey: u.profileAccessKey,
                targetUid: p,
                text: e,
                isAnonymous: i
            }, function(e, t) {
                dialogController.close(n),
                e ? e.code === Codes.USER_IN_BLACK_LIST ? (E(),
                r.profileModel.setAttr({
                    canAddComment: !1
                })) : e.code === Codes.INVISIBLE_NOT_BOUGHT ? (u.setAttr({
                    canRemoveFromGuest: !1
                }),
                app.eventBus.trigger(app.EVENTS.INVISIBILITY_EXPIRED)) : e.code === Codes.LIMIT ? dialogController.showMessageDialog({
                    message: "Вы отправляете комментарии слишком часто. Попробуйте позже"
                }) : e.code === Codes.MAX_COMMENTS_PER_PERIOD_LIMIT_EXCEEDED ? dialogController.showMessageDialog({
                    message: "Вы отправляете комментарии этому пользователю слишком часто. Попробуйте позже"
                }) : e.code === Codes.COMMUNICATION_BLOCKED ? dialogController.communicationBlockedDialog() : dialogController.showError(e) : (util.isDef(t.rating) && u.setAttr({
                    rating: t.rating
                }),
                function(e) {
                    e.comment._id = e.commentId;
                    e = new o(e.comment);
                    i ? (e.fromFullName = d,
                    e.fromPhotoUrl = c,
                    e.fromTextColor = null,
                    e.textColor = null,
                    e.rating = null) : (e.fromFullName = app.info.full_name,
                    e.fromPhotoUrl = app.info.photo_100,
                    e.fromTextColor = app.info.textColor,
                    e.textColor = app.info.textColor,
                    e.rating = app.info.rating),
                    e.toFullName = u.fullName,
                    e.toPhotoUrl = u.avatar,
                    e.toTextColor = u.textColor,
                    h.allComments.add(e, 0)
                }(t),
                dialogController.fadePopup({
                    message: "Ваш комментарий сохранен",
                    duration: 1500
                }))
            }).send(util.random(200, 400))
        }))
    }),
    b.on("show-profile:" + t, function(e) {
        n(e)
    }),
    b.on("show-profile:item-sub-comment", function(e) {
        n(e)
    }),
    a.stop = function() {}
    ,
    a.scrollToComment = function(i) {
        if (p !== app.info.viewer_id)
            throw new Error("AccessDenied. scrollToComment in another profile");
        var t, n = -1, o = C(h.allComments, "ts", i.ts);
        -1 !== o && $.each(h.allComments.slice(o), function(e, t) {
            if (t._id === i._id)
                return n = o + e,
                !1
        }),
        -1 !== n ? (t = n - g * Math.floor(n / g),
        y({
            commentIndex: n,
            onComplete: function() {
                var e = b.els.list.find(">");
                T($(e[t]))
            }
        })) : (S(i),
        y({
            index: h.currentPageIndex
        }))
    }
    ,
    p === app.info.viewer_id && (window.scrollToComment = self.scrollToComment),
    function() {
        function e() {
            h.setAttr({
                count: h.allComments.length
            })
        }
        var t, i;
        D(),
        t = "comments-pagination2",
        (i = lilo.createView(t)).setModel(h),
        b.els.pagination.append(i.el),
        i.on("show-page:" + t, function(e) {
            e = e.extraData.pageIndex;
            e !== h.currentPageIndex && y({
                index: e
            })
        }),
        h.allComments.on("add", "self", function() {
            y({
                index: h.currentPageIndex
            }),
            D()
        }),
        h.currentComments.on("remove", "self", function(e) {
            h.allComments.remove(e.newValue),
            y({
                index: h.currentPageIndex
            }),
            D()
        }),
        h.allComments.on("add", "self", e),
        h.allComments.on("remove", "self", e),
        h.allComments.on("removeAll", "self", e),
        e(),
        f && (webSocketController.on(webSocketController.EVENTS.NEW_COMMENT, function(e) {
            e = app.models.CommentModel.createArrayWithSubComments([e.comment]);
            h.allComments.add(e, 0),
            y({
                index: h.currentPageIndex
            })
        }),
        webSocketController.on(webSocketController.EVENTS.NEW_SUB_COMMENT, function(e) {
            var t = e.commentId
              , i = e.commentTs
              , e = e.subComment
              , i = C(h.allComments, "ts", i)
              , i = v[i];
            i && i._id === t && ((e = new l(e)).to === i.to ? (e.photoUrl = i.toPhotoUrl,
            e.fullName = i.toFullName) : (e.photoUrl = i.fromPhotoUrl,
            e.fullName = i.fromFullName),
            i.from === m ? e.exp = expController.getCurrentExp() : i.to === m && (e.canDelete = !0),
            _(i, e))
        }));
        var n, o, a, s = r.targetComment;
        r.targetComment = null,
        s ? ((n = -1) !== (o = C(h.allComments, "ts", s.ts)) && $.each(h.allComments.slice(o), function(e, t) {
            if (t._id === s._id)
                return n = o + e,
                !1
        }),
        -1 !== n ? (a = n - g * Math.floor(n / g),
        y({
            commentIndex: n,
            onComplete: function() {
                r.$container.append(b.el);
                var e = b.els.list.find(">");
                T($(e[a]))
            }
        })) : (S(s),
        y({
            index: 0,
            onComplete: function() {
                r.$container.append(b.el)
            }
        }))) : y({
            index: 0,
            onComplete: function() {
                r.$container.append(b.el)
            }
        })
    }()
}
,
app.controllers.ActiveCommentsController = function(e) {
    var t = "active-comments-view"
      , i = "item-active-comment-view"
      , l = lilo.createView(t)
      , n = app.models.CommentModel
      , o = n.createArrayWithSubComments(e.activeComments).sort(function(e, t) {
        return e.upd > t.upd ? -1 : 1
    })
      , a = C((e.notifications || []).sort(function(e, t) {
        return e.ts > t.ts ? -1 : 1
    }))
      , s = {
        comments: [],
        hasMore: 10 <= o.length,
        timeOfLastResetNotificationsCounter: e.timeOfLastResetNotificationsCounter
    }
      , r = (app.info.viewer_id,
    app.info.full_name,
    app.ANONYMOUS_IMG,
    !1)
      , d = e.activeCommentsCount || 0;
    function c(i, n, o) {
        var s = {}
          , r = {}
          , e = [];
        0 < e.length ? socialApi.getUsersInfo(e, function(e, t) {
            e ? (e.loc = "active comments. get vk data",
            dialogController.showError(e),
            l.hideLoader()) : ($.each(t.users, function(e, o) {
                var a = o.id
                  , t = s[a];
                t && $.each(t, function(e, t) {
                    var i, n = o.photo_100;
                    a === t.to ? (i = o.first_name + util.formatProfileBdate(o.bdate, t.toAge),
                    t._setToFullName(i),
                    t._setToPhotoUrl(n)) : a === t.from && (i = o.first_name + util.formatProfileBdate(o.bdate, t.fromAge),
                    t._setFromFullName(i),
                    t._setFromPhotoUrl(n))
                });
                t = r[a];
                t && $.each(t, function(e, t) {
                    t.t === NotificationType.FOR_GIRL || t.t === NotificationType.GIFT_FOR_GIRL ? (t.maleFirstName = o.first_name + util.formatProfileBdate(o.bdate, t.maleAge),
                    t.maleAvatar = o.photo_100) : t.t === NotificationType.ROOM_INVITE ? (t.inviterAvatar = o.photo_100,
                    t.inviterFirstName = o.first_name) : t.nextOwnerId === o.id ? (t.nextOwnerAvatar = o.photo_100,
                    t.nextOwnerFirstName = o.first_name + util.formatProfileBdate(o.bdate, t.nextOwnerAge)) : t.girlId === o.id && (t.girlAvatar = o.photo_100,
                    t.girlFirstName = o.first_name + util.formatProfileBdate(o.bdate, t.girlAge))
                })
            }),
            o(i, n))
        }) : o(i, n)
    }
    function u() {
        function e(e, t) {
            t.ts > s.timeOfLastResetNotificationsCounter && (i += 1),
            n += 1
        }
        var i = 0
          , n = 0;
        return r ? s.comments.each(e) : (o.each(e),
        a.each(e)),
        app.eventBus.trigger(app.EVENTS.ACTIVE_COMMENTS_COUNT_CHANGED, {
            count: i,
            total: n
        }),
        {
            count: i,
            total: n
        }
    }
    function p(e, t) {
        (t = e && e.extraData && e.extraData.uid ? e.extraData.uid : t) && app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: t,
            referrer: GuestReferrer.NOTIFICATIONS
        })
    }
    (d -= o.length) < 0 && (d = 0),
    l.setModel(s),
    app.eventBus.on(app.EVENTS.DELETE_COMMENT, function(i) {
        $.each(r ? s.comments : o, function(e, t) {
            if (t._id === i.commentId)
                return r ? s.comments.remove(t) : o.splice(e, 1),
                u(),
                !1
        })
    }),
    app.eventBus.on(app.EVENTS.ADD_SUB_COMMENT, function(i) {
        $.each(r ? s.comments : o, function(e, t) {
            if (i.commentId === t._id)
                return r ? s.comments.remove(t) : o.splice(e, 1),
                u(),
                !1
        })
    }),
    app.eventBus.on(app.EVENTS.TARGET_COMMENT_NOT_FOUND, function(e) {
        var i, n = e.targetComment;
        n && (i = null,
        $.each(r ? s.comments : o, function(e, t) {
            if (t._id === n._id)
                return i = t,
                r ? s.comments.remove(i) : o.splice(e, 1),
                u(),
                !1
        }),
        i && api.comment.checkActive({
            commentOwnerId: app.info.viewer_id,
            commentId: i._id
        }, $.noop).send())
    }),
    webSocketController.on(webSocketController.EVENTS.NEW_ACTIVE_COMMENT, function(e) {
        try {
            var t = e.activeComment
              , i = n.createArrayWithSubComments([t]);
            r ? c(i, [], function(e, t) {
                var i = [];
                $.each(e, function(e, t) {
                    1 < t.comments.length && (t.comments = [t.comments.lastEl()]),
                    i.push(t)
                });
                function n(e) {
                    return e.upd || e.ts
                }
                i.sort(function(e, t) {
                    return n(e) > n(t) ? -1 : 1
                }),
                s.comments.add(i, 0),
                u()
            }) : (util.insertArrayAt(o, 0, i),
            u())
        } catch (e) {
            console.error(e)
        }
    }),
    webSocketController.on(webSocketController.EVENTS.NEW_NOTIFICATION, function(e) {
        try {
            var t, i, n = e.notification, o = C([e.notification]);
            18 === n.t && (t = n.a,
            i = n.b,
            app.eventBus.trigger(app.EVENTS.INC_PHOTO_LIKE_COUNTER, {
                type: t,
                pid: i
            })),
            r ? c([], o, function(e, t) {
                var i = [];
                $.each(t, function(e, t) {
                    t.comments = [],
                    i.push(t)
                });
                s.comments.add(i, 0),
                u()
            }) : (util.insertArrayAt(a, 0, o),
            u()),
            app.eventBus.trigger(app.EVENTS.ON_GET_NEW_NOTIFICATIONS, n)
        } catch (e) {
            console.error(e)
        }
    });
    var f = {
        __queue: [],
        __pending: !1,
        __check: function() {
            var i;
            this.__pending || (i = this.__queue.shift()) && (f.__pending = !0,
            api.notification.remove({
                id: i._id
            }, function(e, t) {
                e || (s.comments.remove(i),
                u()),
                setTimeout(function() {
                    i.__pending = !1,
                    f.__pending = !1,
                    f.__check()
                }, 300)
            }).send())
        },
        push: function(e) {
            this.__queue.push(e),
            this.__check()
        }
    };
    function m(i) {
        h || (h = !0,
        webSocketController.sendMessage({
            action: "notification/open",
            id: i._id,
            tid: i.tid
        }, {}, function(e) {
            h = !1;
            var t = e.code;
            e.data;
            t === Codes.OK ? ($.each(r ? s.comments : a, function(e, t) {
                if (t._id === i._id)
                    return r ? s.comments.remove(t) : a.splice(e, 1),
                    !1
            }),
            u(),
            function(e) {
                var t = e.c
                  , i = e.r;
                switch (e.t) {
                case NotificationType.BONUS_ROOM_TOP_LIST:
                    var n = e.tid
                      , o = e.p
                      , a = e.cp
                      , s = {
                        rtp: {}
                    };
                    0 <= a && (s.rtp[n] = {},
                    s.rtp[n][o] = a),
                    s[n] = 10 < o ? "{0}_{1}_{2}".format(i < t ? t : i, i < t ? StockCurrency.COINS : StockCurrency.RUBIES, o) : o,
                    app.eventBus.trigger(app.EVENTS.ON_ROOM_TOP_LIST_WIN, s);
                    break;
                case NotificationType.BONUS_NEW_LEVEL:
                    s = e.l;
                    dialogController.levelCompleteDialog(s, {
                        roomView: roomView,
                        balanceBonus: t,
                        rubyBonus: i
                    })
                }
            }(i),
            i.t === NotificationType.BONUS_NEW_LEVEL && app.eventBus.trigger(app.EVENTS.GET_BONUS_FOR_NEW_LEVEL, {
                level: i.l
            })) : dialogController.showMessageDialog({
                message: "Не удалось выполнить запрос<br>Code:" + t
            })
        }))
    }
    function v(e) {
        g[e.t] ? m(e) : h || e.__pending || (e.__pending = !0,
        f.push(e))
    }
    l.on("show-girl:" + i, function(e) {
        p(e),
        v(e.extraData.model)
    }),
    l.on("show-profile:item-sub-comment", function(e) {
        p(e)
    }),
    l.on("show-profile:item-active-comment-content-18", function(e) {
        p(e)
    }),
    l.on("open-photo:item-active-comment-content-18", function(e) {
        selfProfileController.photosController.findPhoto(e.extraData.pid) && app.eventBus.trigger(app.EVENTS.GO_TO_PHOTOS, {
            pid: e.extraData.pid
        })
    }),
    l.on("show-profile:" + i, function(e) {
        p(e)
    }),
    l.on("open-room-invite:" + i, function(e) {
        e = e.extraData.model;
        v(e),
        app.eventBus.trigger(app.EVENTS.GO_TO_PRIVATE_ROOM, {
            private_room_id: e.roomId
        })
    }),
    l.on("go-to-user:" + i, function(e) {
        var t = e.extraData.model;
        t.t === NotificationType.FOR_GIRL ? p(null, t.maleId) : t.t === NotificationType.BOUGHT_UP_DEPOSIT ? p(null, t.du) : p(null, t.girlId),
        v(e.extraData.model)
    }),
    l.on("open-verification-dialog:" + i, function(e) {
        e.extraData.model;
        isMobi || new app.controllers.dialog.VerificationPhoto({}),
        v(e.extraData.model)
    }),
    l.on("go-to-comment:" + i, function(e) {
        var i = e.extraData.model
          , t = i.to
          , n = i.ts
          , e = i._id;
        app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: t,
            targetComment: {
                _id: e,
                ts: n
            }
        }),
        api.comment.markAsReaded({
            comment_id: e,
            comment_owner_id: t
        }, function(e, t) {
            e || (s.comments.remove(i),
            u())
        }).send()
    }),
    l.on("load-more:" + t, function(e) {
        var t = {
            beforeSend: function() {
                l.showLoader()
            }
        };
        0 < s.comments.length && (t.lastTs = s.comments.lastEl().upd);
        var i = api.comment.getActiveComments(t, function(e, t) {
            e ? (l.hideLoader(),
            dialogController.showError(e, i)) : (e = t.list,
            t = t.count - e.length,
            d = t = t < 0 ? 0 : t,
            c(n.createArray(e), [], function(e, t) {
                l.hideLoader(),
                s.comments.add(e),
                s.setAttr({
                    hasMore: 10 <= e.length
                }),
                u()
            }))
        });
        i.send(util.random(200, 400))
    });
    var h = !1
      , g = {};
    g[NotificationType.BONUS_NEW_LEVEL] = !0,
    g[NotificationType.BONUS_ROOM_TOP_LIST] = !0,
    g[NotificationType.BONUS_ROOM_TOP_LIST_MULTI] = !0;
    function b() {
        webSocketController.sendMessage({
            action: "resetCounterOfNotifications"
        }, {}, function(e) {
            e && e.data && (e = e.data,
            s.setAttr({
                timeOfLastResetNotificationsCounter: e.ts
            }),
            u())
        })
    }
    function C(e) {
        var n = [];
        return $.each(e, function(e, i) {
            i.t === NotificationType.BONUS_ROOM_TOP_LIST_MULTI ? $.each(i.c, function(e, t) {
                t.q || n.push({
                    _id: i._id,
                    c: t.c,
                    cp: t.z,
                    p: t.p,
                    r: t.r,
                    t: NotificationType.BONUS_ROOM_TOP_LIST,
                    tid: t.t,
                    ts: i.ts,
                    uid: i.uid
                })
            }) : n.push(i)
        }),
        n
    }
    l.bind("batch-delete", function(i) {
        var n, o, a;
        h || (n = [],
        o = [],
        a = [],
        l.viewModel.comments.each(function(e, t) {
            !!t.upd ? (o.push(t._id),
            n.push(t)) : g[t.t] || a.push(t._id)
        }),
        console.info("batch remove", o, a),
        (o.length || a.length) && (h = !0,
        i.extraData.$btn.addClass("loading"),
        ServerApi("notification/batchRemove.php", {
            comment_ids: o.join("_"),
            notification_ids: a.join("_")
        }, function(e, t) {
            i.extraData.$btn.removeClass("loading"),
            h = !1,
            e ? dialogController.showError(e) : (n.each(function(e, t) {
                s.comments.remove(t)
            }),
            u())
        })))
    }),
    l.on("delete:" + i, function(e) {
        var i;
        h || ((i = e.extraData.model).upd ? api.comment.markAsReaded({
            beforeSend: ajaxLoader.show,
            comment_id: i._id,
            comment_owner_id: i.to
        }, function(e, t) {
            ajaxLoader.hide(),
            e || (s.comments.remove(i),
            u())
        }).send() : v(e.extraData.model))
    });
    var _ = !1;
    this.start = function() {
        try {
            _ = !0,
            r ? ($contextArea.append(l.el),
            b()) : c(o, a, function(e, t) {
                r = !0;
                var i = [];
                $.each(e, function(e, t) {
                    1 < t.comments.length && (t.comments = [t.comments.lastEl()]),
                    i.push(t)
                }),
                $.each(t, function(e, t) {
                    t.comments = [],
                    i.push(t)
                });
                function n(e) {
                    return e.upd || e.ts
                }
                i.sort(function(e, t) {
                    return n(e) > n(t) ? -1 : 1
                }),
                s.comments.add(i),
                _ && ($contextArea.append(l.el),
                b())
            })
        } catch (e) {
            console.error(e)
        }
    }
    ,
    this.findNewLevelNotification = function(e) {
        var i = expController.expToLevel(e)
          , n = null;
        return $.each(r ? s.comments : a, function(e, t) {
            if (t.t === NotificationType.BONUS_NEW_LEVEL && t.l === i)
                return n = t,
                !1
        }),
        n
    }
    ,
    this.removeItem = function(e) {
        v(e)
    }
    ,
    this.stop = function() {
        _ = !1,
        socialApi.getScroll(),
        l.el.detach()
    }
    ,
    this.getUnAnsweredCount = u,
    this.getTsOfLastActiveComment = function() {
        var i = 0;
        return r ? $.each(s.comments, function(e, t) {
            if (t.upd)
                return i = t.upd,
                !1
        }) : i = o.length ? o[0].upd : 0,
        i
    }
    ,
    this.getTsOfLastNotification = function() {
        var i = 0;
        return r ? $.each(s.comments, function(e, t) {
            if (t.t)
                return i = t.ts,
                !1
        }) : i = a.length ? a[0].ts : 0,
        i
    }
}
,
app.controllers.GiftsController = function(e) {}
,
app.controllers.GuestsController = function(e) {
    var t = self.GUESTS_REQUEST_LIMIT = 12
      , i = "guests-view"
      , n = lilo.createView(i)
      , o = {
        guests: [],
        hasMoreGuests: !1
    }
      , a = !1
      , s = !1;
    function r(e) {
        var i = [];
        return $.each(e, function(e, t) {
            t = {
                _id: t._id,
                oid: t.oid,
                gid: t.gid,
                ts: t.ts,
                ad: t.ad,
                exp: t.exp,
                vf: !!t.vf,
                photoUrl: t.p100,
                firstName: t.fn + (t.age ? " " + t.age : ""),
                lastName: "",
                fullName: t.fn,
                sex: t.sex
            };
            t.gid === app.models.Guest.ANONYMOUS_GUEST_ID && (t.gid = t._id,
            t.photoUrl = CDN_PREFIX + "spy_icon_100.png?1",
            t.firstName = "Невидимка"),
            i.push(t)
        }),
        i
    }
    n.setModel(o),
    n.el.hide(),
    o.guests.on("add", "self", function() {
        0 < o.guests.length && n.el.show()
    }),
    n.on("load-guests:" + i, function() {
        n.showLoader();
        var i, e = o.guests.lastEl();
        e = e ? e.ts : null,
        i = function(e) {
            n.hideLoader(),
            e ? (o.setAttr({
                hasMoreGuests: e.length === t
            }),
            o.guests.add(r(e))) : dialogController.fadePopup({
                message: "Не удалось загрузить список гостей"
            })
        }
        ,
        api.user.getGuests({
            beforeSend: function() {
                n.showGuestsLoader()
            },
            lastTs: e || null,
            limit: t
        }, function(e, t) {
            i(e ? null : t.guests)
        }).send(util.random(100, 300))
    }),
    n.on("show-profile:item-guest", function(e) {
        e = e.extraData.uid;
        app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: e,
            referrer: GuestReferrer.GUESTS_LIST
        })
    }),
    this.onOpenProfile = function() {
        a = !0;
        try {
            var e = app.viewerProfile.newGuestsCount;
            0 < e ? (dialogController.fadePopup({
                message: "У вас {0} {1}".format(e, util.pluralize(e, {
                    one: "гость",
                    two: "гостя",
                    many: "гостей"
                })),
                duration: 1200
            }),
            webSocketController.sendMessage({
                action: "reset-guests-counter"
            }, {
                isSecure: !0
            }),
            app.viewerProfile.setAttr({
                newGuestsCount: 0
            })) : s || util.isOKPlatform() || setTimeout(function() {
                s = !0,
                app.services.vk.setCounter(0)
            }, 1e3)
        } catch (e) {}
    }
    ,
    this.onCloseProfile = function() {
        a = !1
    }
    ,
    e.$container.append(n.el),
    o.setAttr({
        hasMoreGuests: e.initialGuests.length >= t
    }),
    o.guests.add(r(e.initialGuests)),
    webSocketController.on(webSocketController.EVENTS.NEW_GUEST, function(e) {
        var e = e.guest
          , i = r([e])[0]
          , n = !1;
        $.each(o.guests, function(e, t) {
            if (i.gid === t.gid && Math.abs(i.ts - t.ts) < 36e5)
                return !(n = !0)
        }),
        n || ($.each(o.guests, function(e, t) {
            if (t.gid === i.gid)
                return o.guests.remove(t),
                !1
        }),
        o.guests.add(r([e]), 0),
        a ? setTimeout(function() {
            webSocketController.sendMessage({
                action: "reset-guests-counter"
            }, {
                isSecure: !0
            })
        }, 1e3) : app.viewerProfile.setAttr({
            newGuestsCount: app.viewerProfile.newGuestsCount + 1
        }))
    })
}
,
app.controllers.RecentLikedPhotosController = function(t) {
    function i(e) {
        this.url = e.url,
        this.likeType = e.e,
        this.pid = e.b,
        this.ownerId = e.a,
        this.ts = e.d,
        this.pending = !1,
        this.url ? this.valid = !0 : (this.url = CDN_PREFIX + "camera.jpg",
        this.valid = !1)
    }
    var n = util.createModels(t.items, i)
      , o = {
        items: n
    }
      , a = !1;
    isMobi || t.$container.detach(),
    n = n.sort(function(e, t) {
        return e.ts > t.ts ? -1 : 1
    }),
    lilo.makeObservable(n),
    this.start = function() {
        var e;
        a || (a = !0,
        (e = lilo.createView("recent-liked-photos")).setModel(o),
        t.$container.append(e.el),
        e.on("open:item-recent-photo", function(e) {
            e.extraData.model.ownerId === app.info.viewer_id ? selfProfileController.photosController.openPhotos(e.extraData.model.pid) : app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: e.extraData.model.ownerId,
                startAction: "go-to-photos",
                targetPid: e.extraData.model.pid
            })
        }))
    }
    ,
    app.eventBus.on(app.EVENTS.LIKE_PHOTO, function(e) {
        if (n.add(new i({
            url: e.url,
            e: e.likeType,
            b: e.pid,
            a: e.ownerId,
            d: util.currentMillis()
        }), 0),
        6 < n.length)
            for (; 6 !== n.length; ) {
                var t = n[n.length - 1];
                n.remove(t)
            }
    })
}
,
app.controllers.RecentLikesController = function(e) {
    function i(e) {
        this.url = e.url,
        this.likeType = e.e,
        this.pid = e.b,
        this.ownerId = e.a,
        this.ts = e.d,
        this.pending = !1,
        this.url ? this.valid = !0 : (this.url = CDN_PREFIX + "camera.jpg",
        this.valid = !1)
    }
    function t() {
        n.setAttr({
            hasItems: 0 < n.items.length
        })
    }
    var a = lilo.createView("recent-likes-view")
      , n = {
        hasItems: !1,
        items: [],
        pending: !1
    };
    a.setModel(n),
    n.items.on("add", "self", t),
    n.items.on("remove", "self", t),
    n.items.on("removeAll", "self", t),
    headerView.els["recent-likes"].append(a.el),
    a.on("click:item-recent-like-v2", function(e) {
        app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: e.extraData.model.ownerId,
            startAction: "go-to-photos",
            targetPid: e.extraData.model.pid
        }),
        a.closePopup()
    }),
    a.bind("clear-history", function(e) {
        n.pending || dialogController.confirm({
            message: "История оценок будет удалена, вы уверены?",
            onOk: function() {
                return n.pending = !0,
                webSocketController.sendMessage({
                    action: "clearLikesHistory"
                }, {}, function(e) {
                    n.pending = !1,
                    e && e.data && n.items.removeAll()
                }),
                !1
            }
        })
    }),
    app.eventBus.on(app.EVENTS.LIKE_PHOTO, function(e) {
        if (n.items.add(new i({
            url: e.url,
            e: e.likeType,
            b: e.pid,
            a: e.ownerId,
            d: util.serverUtc()
        }), 0),
        9 < n.items.length)
            for (; 9 !== n.items.length; ) {
                var t = n.items[n.items.length - 1];
                n.items.remove(t)
            }
        o(e.browserEvent, e.likeType)
    });
    e = e.items.sort(function(e, t) {
        return e.d === t.d ? 0 : e.d > t.d ? -1 : 1
    });
    9 < e.length && (e.length = 9),
    e.each(function(e, t) {
        n.items.add(new i(t))
    });
    var s = !1
      , o = function(e, t) {
        var i, n, o;
        e && e.target && (e = (o = e).touches && o.touches.length ? {
            x: o.touches[0].pageX,
            y: o.touches[0].pageY
        } : {
            x: o.pageX,
            y: o.pageY
        },
        i = a.els.btn.offset(),
        o = {
            left: 0,
            top: 0
        },
        util.isOKPlatform() && (o = $frameWrapper.offset()),
        i.left -= o.left,
        i.top += 10,
        i.left += 25,
        (n = document.createElement("div")).className = "recent-like-animated-icon",
        n.style.backgroundImage = "url(" + CDN_PREFIX + "/likes/" + t + ".png?v=1)",
        n.style.transform = "translate({0}px,{1}px)".format(e.x - o.left, e.y - o.top),
        $contextArea.append(n),
        setTimeout(function() {
            n.style.transform = "translate({0}px,{1}px)".format(i.left, i.top),
            setTimeout(function() {
                n.parentNode.removeChild(n),
                s || (s = !0,
                a.els.btn.addClass("animate-shake"),
                setTimeout(function() {
                    s = !1,
                    a.els.btn.removeClass("animate-shake")
                }, 600))
            }, 1e3)
        }, 100))
    }
}
,
function() {
    var c = app.UsersRoundQuestionStatus
      , n = (new Date).getTime();
    function u(e) {
        this._id = e._id || e.id,
        this.imgUrl = e.imgUrl
    }
    function r(e) {
        this._id = e._id,
        this.text = e.text,
        this.answers = u.fromArray(e.answers),
        this.status = e.status,
        this.upd = e.upd,
        this.sendToReviewTs = e.sendToReviewTs,
        this.reviewDate = e.reviewDate,
        this.deniedReason = e.deniedReason
    }
    function l(a, o) {
        o = $.extend({
            onRemove: $.noop,
            onCloseDialog: $.noop,
            calcOnModerationItems: $.noop
        }, o);
        var s, r, l, e = "dialog-edit-room-question", d = lilo.createView(e), i = (s = $.noop,
        l = r = !1,
        function i(e) {
            var n, o;
            s = e || $.noop,
            r ? l = !0 : (r = !0,
            a.text && a.text.length && a.setAttr({
                text: a.text[0].toUpperCase() + a.text.substr(1)
            }),
            e = a,
            n = [],
            $.each(e.answers, function(e, t) {
                n.push({
                    id: t._id,
                    imgUrl: t.imgUrl
                })
            }),
            e = {
                id: e._id,
                answers: JSON.stringify(n),
                text: e.text
            },
            (o = api.roomV3.editor.save({
                beforeSend: function() {
                    d.showLoader()
                },
                id: e.id,
                answers: e.answers,
                text: e.text
            }, function(e, t) {
                r = !1,
                d.hideLoader(),
                e ? (e.loc = "save question",
                dialogController.showError(e, o)) : (a.setAttr({
                    _id: t.id,
                    upd: util.currentMillis(),
                    status: c.PRIVATE
                }),
                s(),
                l && (l = !1,
                i()))
            })).send())
        }
        );
        d.on("go-back:" + e, function() {
            i(function() {
                dialogController.close(d),
                o.onCloseDialog()
            })
        }),
        d.on("public:" + e, function(e) {
            var i;
            a.isValid() ? 3 <= o.calcOnModerationItems() ? dialogController.showMessageDialog({
                message: "Нельзя посылать на проверку больше 3 вопросов"
            }) : (i = api.roomV3.editor.sendToModeration({
                beforeSend: d.showLoader,
                id: a._id
            }, function(e, t) {
                d.hideLoader(),
                e ? e.code === Codes.ACCESS_DENIED ? dialogController.showMessageDialog({
                    message: "Вам запрещено отправлять вопросы на проверку"
                }) : dialogController.showError(e, i) : (e = util.currentMillis(),
                a.setAttr({
                    upd: e,
                    sendToReviewTs: e,
                    status: c.ON_MODERATION
                }),
                dialogController.close(d),
                o.onCloseDialog(),
                dialogController.fadePopup({
                    message: "Вопрос отправлен на проверку",
                    duration: 1200
                }))
            })).send(300) : dialogController.showMessageDialog({
                message: "Введите текст и добавьте минимум 3 ответа"
            })
        }),
        d.on("open-image-editor:" + e, function(e) {
            app.controllers.imageSWFUploader.open(300, 300, 300, 300, function(e) {
                e = new u({
                    _id: "" + n++,
                    imgUrl: e
                });
                a.answers.add(e),
                i()
            })
        }),
        d.on("select-img:" + e, function(e) {
            util.readImage(e.extraData.fileList, function(e) {
                d.swapInputImage(),
                e ? new app.controllers.ImageEditor({
                    image: e,
                    cropWidth: 300,
                    cropHeight: 300,
                    resultContentType: "image/png",
                    onOk: function(e) {
                        d.showLoader(),
                        (new app.controllers.ImageUploader).saveImage({
                            base64: e
                        }, function(e, t) {
                            d.hideLoader(),
                            e ? (e.loc = "read image file list",
                            dialogController.showError(e)) : (t = t[0]) && function(e) {
                                e = new u({
                                    _id: "" + n++,
                                    imgUrl: e
                                });
                                a.answers.add(e),
                                i()
                            }(util.get604Photo(t))
                        })
                    }
                }) : dialogController.showMessageDialog({
                    message: "Изображение не выбрано"
                })
            })
        }),
        d.on("text-changed:" + e, function(e) {
            a.setAttr({
                text: e.extraData.value
            }),
            i()
        }),
        d.on("delete:" + e, function(e) {
            var n = e.extraData.model;
            dialogController.confirm({
                message: "Точно удалить?",
                onOk: function() {
                    var i = api.roomV3.editor.remove({
                        beforeSend: function() {
                            d.showLoader()
                        },
                        id: n._id
                    }, function(e, t) {
                        d.hideLoader(),
                        e ? dialogController.showError(e, i) : (o.onRemove(n),
                        dialogController.close(d),
                        o.onCloseDialog())
                    });
                    return i.send(200),
                    !1
                }
            })
        }),
        d.on("delete:item-answer-in-editor", function(e) {
            a.answers.remove(e.extraData.model),
            i()
        }),
        d.setModel(a),
        dialogController.open(d, {
            noClose: !0,
            dialogCss: {
                "background-color": "rgb(242, 242, 242)"
            }
        }),
        a._id || i()
    }
    u.fromArray = function(e) {
        var i = [];
        return $.each(e, function(e, t) {
            i.push(new u(t))
        }),
        i
    }
    ,
    $.extend(r.prototype, {
        isValid: function() {
            return 1 < this.text.length && this.text.length < 100 && 2 < this.answers.length
        }
    }),
    app.controllers.RoomQuestionsEditor = function() {
        var n = !1
          , o = {
            items: []
        }
          , e = "room-questions-editor"
          , t = "item-users-room-question"
          , i = lilo.createView(e);
        function a(e) {
            l(e, {
                onRemove: function(e) {
                    o.items.remove(e)
                },
                calcOnModerationItems: function() {
                    var i = 0;
                    return $.each(o.items, function(e, t) {
                        t.status === c.ON_MODERATION && i++
                    }),
                    i
                },
                onCloseDialog: function() {
                    s(!1)
                }
            })
        }
        function s(e) {
            var i = api.roomV3.editor.getList({
                beforeSend: ajaxLoader.show,
                activate_editor: e
            }, function(e, t) {
                ajaxLoader.hide(),
                n && (e ? dialogController.showError(e, i) : (app.viewerProfile.editorIsActivated = !0,
                o.items.removeAll(),
                t.list.sort(function(e, t) {
                    return e.upd > t.upd ? -1 : 1
                }),
                $.each(t.list, function(e, t) {
                    o.items.add(new r(t))
                })))
            });
            i.send()
        }
        i.setModel(o),
        i.on("add:" + e, function(e) {
            var t = new r({
                _id: null,
                text: "",
                answers: [],
                status: c.PRIVATE,
                upd: util.currentMillis()
            });
            o.items.add(t),
            a(t)
        }),
        i.on("show-denied-reason:" + t, function(e) {
            e = e.extraData.model.deniedReason,
            dialogController.showMessageDialog({
                message: e.replace(/\n/g, "<br />")
            })
        }),
        i.on("click:" + t, function(e) {
            var t;
            e.extraData.model.status !== c.PUBLIC ? e.extraData.model.status === c.ON_MODERATION ? (t = "Вопрос в очереди на модерацию. При изменении, он будет удален из очереди. Продолжить?",
            dialogController.confirm({
                message: t,
                onOk: function() {
                    return a(e.extraData.model),
                    !1
                }
            })) : a(e.extraData.model) : (t = "Ваш вопрос проверен и добавлен в игру. Любые изменения потребуют повторной проверки вопроса модератором. Продолжить?",
            dialogController.confirm({
                message: t,
                onOk: function() {
                    return a(e.extraData.model),
                    !1
                }
            }))
        }),
        this.start = function(e) {
            e = e || {},
            $contextArea.append(i.el);
            app.viewerProfile.editorIsActivated;
            if (n = !0,
            !IS_SUPPORT_IMAGE_EDITOR)
                return setTimeout(function() {
                    dialogController.warn({
                        message: "Вaш браузер не поддерживает данную функцию.<br><br>Воспользуйтесь последней версией браузера<br><a class='link' target='_blank' href='https://www.google.ru/intl/ru/chrome/browser/'>Google Chrome</a> или <a class='link' target='_blank' href='https://www.mozilla.org/ru/firefox/new/'>Mozilla Firefox</a>",
                        buttons: []
                    }).on("close:dialog-window", function() {
                        e.onBackPress()
                    })
                }, 100),
                !1;
            s(!1)
        }
        ,
        this.stop = function() {
            o.items.removeAll(),
            i.el.detach(),
            n = !1
        }
    }
}(),
function() {
    function i(e) {
        this.__allItems = e.items,
        this.__itemsPerPage = e.itemsPerPage || 1,
        this.__totalPages = this.__calcPages(),
        this.__currentPage = 0,
        this.__onPageSelect = e.onPageSelect
    }
    $.extend(i.prototype, {
        getAllItems: function() {
            return this.__allItems
        },
        __calcPages: function() {
            return this.__totalPages = Math.ceil(this.__allItems.length / this.__itemsPerPage),
            this.__totalPages
        },
        showPage: function(e) {
            this.__calcPages(),
            e > this.__totalPages - 1 && (e = Math.max(this.__totalPages - 1, 0));
            var t = this.__allItems.slice(this.__itemsPerPage * e, this.__itemsPerPage * e + this.__itemsPerPage);
            this.__currentPage = e,
            this.__onPageSelect({
                index: this.__currentPage,
                total: this.__totalPages,
                items: t,
                hasPrev: 0 !== e,
                hasNext: e !== this.__totalPages - 1
            })
        },
        showNext: function() {
            this.__currentPage !== this.__totalPages - 1 && this.showPage(this.__currentPage + 1)
        },
        showPrev: function() {
            0 !== this.__currentPage && this.showPage(this.__currentPage - 1)
        }
    }),
    i.Observable = function(e) {
        i.call(this, e),
        lilo.makeObservable(this.__allItems);
        var t = this
          , e = function() {
            t.showPage(t.__currentPage)
        };
        this.__allItems.on("add", "self", e),
        this.__allItems.on("remove", "self", e),
        this.__allItems.on("removeAll", "self", e)
    }
    ,
    $.extend(i.Observable.prototype, i.prototype),
    $.extend(app.controllers, {
        PaginationController: i
    })
}(),
function() {
    function e() {
        app.makeEventDispatcher(this),
        this.__guestsPollUUID = 1,
        this.__guestsPollTimeout = null,
        this.__pingInterval = null
    }
    var t = 1
      , o = $.proxy
      , i = util.isDef;
    $.extend(e.prototype, {
        EVENTS: {
            ON_UPDATE: t++,
            ON_GET_NEW_GUESTS: t++,
            ON_GET_TODAY_GUESTS_COUNT: t++,
            ON_GET_NEW_GUESTS_COUNT: t++
        },
        __pingFreq: 1e3,
        __roomPingFreq: 2e3,
        __guestFreq: 15e3,
        __roomTopListFreq: 12e3,
        __depositsFreq: 5e3,
        __lastRoomPingTs: 0,
        __lastGuestRequestTs: 0,
        __lastRoomTopListTs: 0,
        __lastDepositsTs: 0,
        __ping: function(e) {
            var t = {}
              , i = !1
              , n = util.currentMillis();
            isMobi || (e.forceRoomTopList || n - this.__lastRoomTopListTs > this.__roomTopListFreq) && (this.__lastRoomTopListTs = n,
            $.extend(t, {
                room_top: !0
            }),
            i = !0),
            n - this.__lastDepositsTs > this.__depositsFreq && app.__exchangeFriendsIsOpen && (this.__lastDepositsTs = n,
            $.extend(t, {
                deposits: !0
            }),
            i = !0),
            i && api.ping(t, o(this.__handleResponse, this)).send()
        },
        __handleResponse: function(e, t) {
            e || (util.isDef(t.roomTopListByDays) && util.isDef(t.roomTopListByHours) && app.eventBus.trigger(app.EVENTS.ON_GET_ROOM_TOP_LIST, {
                roomTopListByRooms: t.roomTopListByRooms,
                roomTopListByDays: t.roomTopListByDays,
                roomTopListByHours: t.roomTopListByHours
            }),
            util.isDef(t.nextData) && this.__onGetNewGuests(null, t.nextData),
            t.deposits && app.eventBus.trigger(app.EVENTS.ON_GET_DEPOSITS, t.deposits),
            t.serverWillReboot && app.serverRebootPopup ? app.serverRebootPopup.open() : app.serverRebootPopup.close(),
            app.onGetServerVersion(t.v))
        },
        __winPropertyNames: ["wpt1", "wpt2", "wpt3", "wpt4", "wpt1h", "wpt2h", "wpt3h", "wpt4h", "wpthh"],
        __onGetNewGuests: function(e, t) {
            e || (i(t.exp) && expController.setRealExp(t.exp),
            i(t.balance) && app.balanceModel.setAttr({
                balance: t.balance
            }),
            i(t.ruby) && app.balanceModel.setAttr({
                ruby: t.ruby
            }))
        },
        fetchNewGuestsAndResetCounter: function() {},
        getRoomTopList: function() {
            this.__ping({
                forceRoomTopList: !0
            }),
            this.restart()
        },
        restart: function() {
            var e = this
              , t = {};
            clearInterval(this.__pingInterval),
            this.__pingInterval = setInterval(function() {
                e.__ping(t)
            }, this.__pingFreq)
        },
        start: function() {
            this.restart()
        }
    }),
    app.controllers.AppCommunicator = e
}(),
app.controllers.HaremController = function(s) {
    var e = "harem-view"
      , i = lilo.createView(e)
      , r = s.profileModel
      , t = "item-harem"
      , n = 12e3
      , l = {
        sex: s.profileModel.sex,
        isSelfProfile: r.isSelfProfile,
        items: [],
        hasMore: !1,
        profileModel: s.profileModel,
        __isLoaded: !1,
        __items: [],
        pending: !1,
        owner: null,
        ownerData: null,
        haremPrice: s.haremPrice || (2 === s.profileModel.sex ? 10 : 5)
    };
    function o(e) {
        e = l.__items.splice(0, (e = e || {}).size || n);
        l.setAttr({
            hasMore: 0 < l.__items.length
        }),
        l.setAttr({
            pending: !0
        }),
        e.each(function(e, t) {
            t.haremPrice = t.haremPrice || 10,
            t.photoUrl = t.p100,
            t.firstName = t.fn + util.formatProfileBdate(null, t.age)
        }),
        l.items.add(e)
    }
    function a() {
        i.el.detach(),
        api.harem.getData({
            uid: s.profileModel.uid,
            beforeSend: function() {
                l.setAttr({
                    pending: !0
                })
            }
        }, function(e, t) {
            l.__isLoaded = !0,
            e ? l.setAttr({
                pending: !1
            }) : function(e) {
                s.$container.append(i.el),
                e.harem && (l.items.removeAll(),
                l.__items = e.harem.sort(function(e, t) {
                    return e.haremTs && t.haremTs ? e.haremTs < t.haremTs ? 1 : -1 : e.haremTs ? -1 : t.haremTs ? 1 : 0
                }),
                l.setAttr({
                    pending: !1
                }),
                o());
                l.setAttr({
                    haremPrice: e.haremPrice || (2 === l.sex ? 5 : 10),
                    owner: null,
                    ownerData: null
                }),
                e.owner ? l.setAttr({
                    owner: e.owner,
                    ownerData: {
                        photo_100: e.owner.p100,
                        first_name: e.owner.fn,
                        vf: e.owner.vf
                    }
                }) : l.setAttr({
                    pending: !1
                })
            }(t)
        }).send()
    }
    function d(i) {
        dialogController.confirm({
            message: "Точно удалить?",
            onOk: function() {
                return api.harem.remove({
                    uid: i._id,
                    beforeSend: ajaxLoader.show
                }, function(e, t) {
                    ajaxLoader.hide(),
                    e ? dialogController.fadePopup({
                        message: "Не удалось выполнить запрос"
                    }) : (l.items.remove(i),
                    l.items.length <= 6 && l.__items.length && o({
                        size: 6
                    }))
                }).send(util.random(100, 400)),
                !1
            }
        })
    }
    function c(n, o) {
        var a;
        app.balanceModel.canChange() && (a = n ? r.uid : o._id,
        api.harem.buy({
            uid: a,
            beforeSend: ajaxLoader.show
        }, function(e, t) {
            var i;
            ajaxLoader.hide(),
            e ? e.code === Codes.NOT_ENOUGH_BALANCE ? (app.balanceModel.setAttr({
                balance: t.balance
            }),
            dialogController.showInsufficientlyBalanceDialog(t.deficit)) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : e.code === Codes.HAREM_LIMIT_EXCEEDED ? dialogController.showMessageDialog({
                message: "Вы достигли максимального числа пользователей, за которыми вы можете {0}. Удалите кого-то из имеющихся, чтобы добавить нового пользователя".format(2 === app.info.sex ? "Ухаживать" : "Симпатизировать")
            }) : e.code === Codes.MAX_VALUES_PER_PERIOD_EXCEEDED || dialogController.fadePopup({
                message: "Не удалось выполнить запрос"
            }) : (util.isDef(t.balance) && app.balanceModel.setAttr({
                balance: t.balance
            }),
            t.leftMillis ? (e = t.leftMillis,
            i = Math.floor(e / 36e5),
            (e = Math.floor((e - 1e3 * i * 60 * 60) / 6e4)) < 1 && (e = 1),
            i = "Достигнут лимит получения рейтинга за эту операцию. Oграничение будет снято через" + " {0} {1} {2} {3}.".format(0 < i ? i : "", 0 < i ? util.pluralize(i, {
                one: "час",
                two: "часа",
                many: "часов"
            }) : "", e, util.pluralize(i, {
                one: "минуту",
                two: "минуты",
                many: "минут"
            })),
            dialogController.showMessageDialog({
                message: i
            })) : util.isDef(t.exp) && (expController.setRealExp(t.exp),
            i = 5 * l.haremPrice,
            isNaN(i) || (i = expController.applyBooster(i),
            expController.animateBonus({
                incValue: i,
                sourceOffset: {
                    left: 0,
                    top: 0
                }
            }),
            dialogController.fadePopup({
                message: "Вы получили +{0} очков рейтинга".format(i),
                duration: 4e3
            })),
            app.balanceModel.setAttr({
                balance: t.balance
            })),
            t.addedToFav && app.eventBus.trigger(app.EVENTS.USER_ADDED_TO_FAV, {
                uid: a
            }),
            app.eventBus.trigger(app.EVENTS.REQUEST_UPDATE_HAREM),
            n ? (l.setAttr({
                owner: {
                    _id: app.info.viewer_id,
                    age: app.info.age,
                    exp: expController.getCurrentExp()
                },
                ownerData: {
                    photo_100: app.info.photo_100,
                    first_name: app.info.first_name,
                    vf: app.commonState.verified
                }
            }),
            app.eventBus.trigger(app.EVENTS.ADD_TO_HAREM, {
                profileModel: s.profileModel,
                uid: r.uid,
                exp: r.exp,
                photoUrl: r.avatar,
                canSendMoney: t.canSendMoney,
                age: t.age,
                firstName: r.first_name,
                price: l.haremPrice + 10
            })) : (l.items.remove(o),
            app.eventBus.trigger(app.EVENTS.ADD_TO_HAREM, {
                uid: o.uid || o._id,
                exp: o.exp,
                photoUrl: o.photoUrl,
                canSendMoney: t.canSendMoney,
                age: t.age,
                firstName: o.firstName,
                price: l.haremPrice + 10
            })))
        }).send(util.random(100, 300)))
    }
    i.setModel(l),
    i.on("load-more:" + e, o),
    i.on("send-gift:" + t, function(e) {
        !function(t) {
            var e = expController.getCurrentLevel()
              , i = e + 1;
            i % 2 != 0 && (i += 1);
            var n = !0;
            e < 10 && (n = !(i = 10));
            var o = (a = [],
            10 <= e && a.push({
                title: "<b><span style='float: none;' class='price'>10</span></b>",
                price: 5,
                coins: 10,
                rubies: !0
            }),
            50 <= e && a.push({
                title: "<b><span style='float: none;' class='price'>50</span></b>",
                price: 25,
                coins: 50,
                rubies: !0
            }),
            100 <= e && a.push({
                title: "<b><span style='float: none;' class='price'>100</span></b>",
                price: 50,
                coins: 100,
                rubies: !0
            }),
            a)
              , a = 2 === app.info.sex ? "Подарок для девушки<div class='sub-title-v2'>" + (n ? (-1 === i ? "" : "<div>Сегодня на эту девушку вы можете потратить еще <b class='left-ruby'>-1</b><span class='smart-ruby'></span></div>") + (-1 === i ? "" : "<div>Лимит будет повышен после <span class='exp-level'></span> уровня</div>") : "<div>Вы сможете сделать подарок после <span class='exp-level'></span> уровня</div>") + "</div>" : "Подарок для мужчины<div class='sub-title-v2'>" + (n ? (-1 === i ? "" : "<div>Сегодня на этого мужчину вы можете потратить еще <b class='left-ruby'>-1</b><span class='smart-ruby'></span></div>") + (-1 === i ? "" : "<div>Лимит будет повышен после <span class='exp-level'></span> уровня</div>") : "<div>Вы сможете сделать подарок после <span class='exp-level'></span> уровня</div>") + "</div>"
              , s = dialogController.subscribe({
                dialogOpts: {
                    dialogClass: "small-close no-padding"
                },
                model: {
                    title: a,
                    descriptions: o
                },
                onOk: function(i) {
                    if (!n)
                        return !1;
                    var e = app.balanceModel.ruby = i.price;
                    if (!(e < 0))
                        return ServerApi("harem/sendCoins.php", {
                            girl_id: t,
                            price: i.price
                        }, function(e, t) {
                            t = t || {},
                            util.isDef(t.ruby) && app.balanceModel.setAttr({
                                ruby: t.ruby
                            }),
                            e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit, {
                                currency: 2
                            }) : e.code === Codes.LIMIT ? dialogController.fadePopup("Подарок не может быть отправлен - достигнут лимит.") : dialogController.showError(e) : (dialogController.fadePopup("Подарок успешно отправлен"),
                            cAnal.trackEvent({
                                girl_coins: i.coins
                            }))
                        }),
                        !1;
                    dialogController.showInsufficientlyBalanceDialog(e, {
                        currency: 2
                    })
                }
            });
            isMobi || s.$(".buttons .cancel").remove(),
            webSocketController.sendMessage({
                action: "user/getGiftsLimit",
                uid: t,
                level: e
            }, {}, function(e) {
                console.info("user/getGiftsLimit", e);
                var t = e.code
                  , e = e.data || {};
                t === Codes.OK && (s.$(".left-ruby").html(e.left),
                s.$(".sub-title-v2").css("opacity", "1"))
            }),
            -1 !== i && lilo.getSimpleBindHandler("exp-level-v2")(s.$(".exp-level"), expController.levelToExp(i))
        }(e.extraData.model._id)
    }),
    i.on("show-profile:" + t, function(e) {
        var t, i;
        e.extraData.model && e.extraData.model._id && !isNaN(parseInt(e.extraData.model._id, 10)) && (t = e.extraData.model._id,
        i = function() {
            app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: t,
                referrer: GuestReferrer.HAREM
            })
        }
        ,
        isMobi && l.isSelfProfile ? new app.controllers.MobilePopup({
            btns: [{
                title: "Удалить",
                handler: function() {
                    return d(e.extraData.model),
                    !1
                }
            }, {
                title: "Перейти в профиль",
                handler: function() {
                    return i(),
                    !1
                }
            }]
        }) : i())
    }),
    i.on("show-owner:" + e, function(e) {
        l.owner && l.owner._id && app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: l.owner._id,
            referrer: GuestReferrer.HAREM
        })
    }),
    i.on("delete:" + t, function(e) {
        e = e.extraData.model;
        e._id && d(e)
    }),
    i.on("buy:" + e, function(e) {
        c(!0)
    }),
    i.on("out-buy:" + e, function() {
        c(!0)
    }),
    i.on("out-buy:" + t, function(e) {
        c(!1, e.extraData.model)
    }),
    i.on("buy-back:" + e, function(i) {
        var e, n;
        app.balanceModel.canChange() && (e = 2 === app.info.sex,
        n = l.haremPrice * (e ? 2 : 1),
        dialogController.confirm({
            message: "Удалить за {0} {1}?".format(n, util.pluralize(n, {
                one: "монету",
                two: "монеты",
                many: "монет"
            })),
            onOk: function() {
                return api.harem.removeOwner({
                    beforeSend: ajaxLoader.show
                }, function(e, t) {
                    ajaxLoader.hide(),
                    e ? e.code === Codes.NOT_ENOUGH_BALANCE ? (app.balanceModel.setAttr({
                        balance: t.balance
                    }),
                    dialogController.showInsufficientlyBalanceDialog(t.deficit)) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : dialogController.fadePopup({
                        message: "Не удалось выполнить запрос"
                    }) : (util.isDef(t.balance) && app.balanceModel.setAttr({
                        balance: t.balance
                    }),
                    util.isDef(t.exp) && (expController.setRealExp(t.exp),
                    e = 10 * n,
                    isNaN(e) || (e = expController.applyBooster(e),
                    expController.animateBonus({
                        incValue: e,
                        sourceOffset: {
                            left: i.extraData.event.pageX,
                            top: i.extraData.event.pageY
                        }
                    })),
                    app.balanceModel.setAttr({
                        balance: t.balance
                    })),
                    l.setAttr({
                        owner: null,
                        ownerData: null
                    }))
                }).send(util.random(100, 200)),
                !1
            }
        }))
    }),
    l.isSelfProfile && 2 === l.sex && app.eventBus.on(app.EVENTS.ADD_TO_HAREM, function(e) {
        l.items.add([{
            _id: e.uid,
            exp: (e.profileModel || e).exp,
            photoUrl: e.photoUrl,
            firstName: e.firstName,
            canSendMoney: e.canSendMoney,
            age: e.age,
            haremPrice: e.price || 10,
            haremTs: util.currentMillis()
        }], 0),
        a()
    }),
    l.isSelfProfile && (app.eventBus.on(app.EVENTS.ON_GET_NEW_NOTIFICATIONS, function(e) {
        1 <= e.t && e.t <= 4 && l.__isLoaded && a()
    }),
    app.eventBus.on(app.EVENTS.REQUEST_UPDATE_HAREM, function(e) {
        l.__isLoaded && a()
    }),
    (t = document.createElement("div")).className = e,
    t.appendChild(i.els["owner-list"][0]),
    s.$container2.append(t)),
    this.start = function() {
        l.__isLoaded || setTimeout(a, 0)
    }
    ,
    this.isCoupleWithViewer = function() {
        if (l.owner && l.owner._id && l.owner._id === app.info.viewer_id)
            return !0;
        var i = !1;
        return l.items && l.items.each(function(e, t) {
            if (t._id === app.info.viewer_id)
                return !(i = !0)
        }),
        i
    }
    ,
    (window.haremctrl = this)._model = l,
    this._viewl = i
}
,
function() {
    let r = (()=>{
        let t = null;
        var e = {};
        return Object.defineProperty(e, "player", {
            get() {
                return t
            },
            set(e) {
                e !== t && (t && t.closeMusicStream(),
                t = e)
            }
        }),
        e
    }
    )();
    function e() {
        var n, o = !1, t = this, a = null;
        function s(t, i) {
            var e = null;
            try {
                var n = -1 === t.toLowerCase().indexOf("soundeffect") ? function() {
                    let e = r.player;
                    return e || (a === RadioPlayerType.VK_AUDIO && app.mp3playerIsInit ? e = window.mp3player : a === RadioPlayerType.YOUTUBE && app.youtubePlayer.ready && (e = app.youtubePlayer)),
                    r.player = e,
                    e
                }() : window.mp3player;
                n && (i = i || [],
                e = n[t].apply(n, i))
            } catch (e) {
                try {
                    GA("Radio", "SWFError", e.message + "[" + t, "; " + util.cloneArray(i).join(",") + "]")
                } catch (e) {
                    GA("Radio", "SWFError", "CallMethod:" + t)
                }
            }
            return e
        }
        this.setPlayerType = function(e) {
            a !== e && (t.closeMusicStream(),
            r.player = null,
            a = e)
        }
        ,
        this._play = function(e, t) {
            o = !0,
            a === RadioPlayerType.VK_AUDIO && app.mp3playerIsInit && (e && e.indexOf && -1 !== e.indexOf("m3u8") ? r.player = window.hlsPlayer : r.player = window.mp3player),
            s("playMusic", [e, t])
        }
        ,
        this.closeMusicStream = function() {
            o && (clearInterval(n),
            s("closeMusicStream"),
            o = !1)
        }
        ,
        this.setVolume = function(e) {
            o && s("setMusicVolume", [e / 100])
        }
        ,
        this.playSoundEffect = function(e, t) {
            s("setSoundEffectVolume", [t / 100]),
            s("playSoundEffect", [e])
        }
        ,
        this._playVKSound = function(t) {
            window.onMP3PlayerErrorListener = function() {
                o = !1,
                clearInterval(n),
                t.onError && t.onError(),
                window.onMP3PlayerErrorListener = null
            }
            ,
            window.onMP3PlayerCompleteListener = function() {
                o = !1,
                clearInterval(n),
                t.onComplete && t.onComplete(),
                window.onMP3PlayerCompleteListener = null
            }
            ;
            var e = util.isDef(t.volume) ? t.volume : 100
              , i = t.position || 0;
            this._play(t.url, i),
            this.setVolume(e),
            t.onUpdate && (n = setInterval(function() {
                var e = s("getMusicInfo");
                e && t.onUpdate(e.position)
            }, 1e3),
            t.onUpdate(i))
        }
        ,
        this._playYoutubeSound = function(t) {
            app.youtubePlayer.onErrorListenerr = function() {
                o = !1,
                clearInterval(n),
                t.onError && t.onError(),
                app.youtubePlayer.onErrorListener = null
            }
            ,
            app.youtubePlayer.onCompleteListener = function() {
                o = !1,
                clearInterval(n),
                t.onComplete && t.onComplete(),
                app.youtubePlayer.onCompleteListener = null
            }
            ;
            var e = util.isDef(t.volume) ? t.volume : 100
              , i = t.position || 0;
            this._play(t.url, i),
            this.setVolume(e),
            t.onUpdate && (n = setInterval(function() {
                var e = s("getMusicInfo");
                e && t.onUpdate(e.position)
            }, 1e3),
            t.onUpdate(i))
        }
        ,
        this.playSound = function(e) {
            return clearInterval(n),
            a === RadioPlayerType.VK_AUDIO ? this._playVKSound(e) : a === RadioPlayerType.YOUTUBE ? this._playYoutubeSound(e) : void 0
        }
    }
    var t;
    app.controllers.SoundController = function() {
        return t = t || new e
    }
}(),
function() {
    var e = 3
      , t = 4
      , i = 5
      , n = 6
      , o = 7
      , a = 8
      , s = 9
      , r = 10
      , l = 11
      , d = 13
      , c = 14
      , u = 15
      , p = 16
      , f = 17
      , m = 18
      , v = 19
      , h = 21
      , g = 22
      , b = 100
      , C = 777
      , _ = {}
      , w = +new Date
      , E = {}
      , y = $.noop;
    setInterval(function() {
        var e, t = +new Date;
        for (e in E)
            E.hasOwnProperty(e) && 12e4 < t - E[e].ts && delete E[e]
    }, 6e4);
    var D = {
        _isStarted: !1,
        _socket: void 0,
        _messagesQueue: [],
        _isOpen: !1,
        _pingTimerId: void 0,
        _lastTimeOfPing: 0,
        _lastTimeOfSendMessage: 0,
        _doPing: function() {
            var e = util.currentMillis()
              , t = e - this._lastTimeOfPing;
            window.roomModel && window.roomModel.roomId ? 3e3 < t && (this._lastTimeOfPing = e,
            t = {
                action: "pingRoom",
                room_id: window.roomModel.roomId
            },
            roomModel.pending ? t.pending = !0 : t.is_away = roomModel.__isAway,
            this.sendMessage(t)) : 2e4 < e - this._lastTimeOfSendMessage && this.sendMessage({
                action: "hand-shaking"
            })
        },
        _handleMessage: function(e) {
            e = JSON.parse(e);
            $.each(e, function(e, t) {
                var i = JSON.parse(t)
                  , t = i[1]
                  , t = _[t];
                t && t(i[2] || {})
            })
        },
        _disconnect: function() {
            this._socket && (this._socket.onclose = $.noop,
            this._socket.close(),
            this._socket = null,
            this._messagesQueue.length = 0)
        },
        _connect: function(o) {
            if (o = o || $.noop,
            !this._isStarted || !this._socket) {
                var a = "https:" === document.location.protocol
                  , t = a ? "wss" : "ws";
                let e = document.location.host;
                window.ODR && (e = BOOT_DATA.api_url.split("//")[1]);
                var i, t = "{0}://{1}{5}web/websocket?viewer_id={2}&{3}&tab_id={4}".format(t, e, app.info.viewer_id, (i = [],
                $.each(app.apiPrimaryParams ? $.extend({}, app.apiPrimaryParams) : isMobi && !isDirect ? $.extend({}, app.info.session, {
                    client_type: 3
                }) : isDirect ? {
                    auth_key: app.info.auth_key,
                    client_type: 5,
                    api_id: app.info.api_id
                } : {
                    auth_key: app.info.auth_key,
                    client_type: 1,
                    api_id: app.info.api_id
                }, function(e, t) {
                    i.push(encodeURIComponent(e) + "=" + encodeURIComponent(t))
                }),
                i.join("&")), encodeURIComponent(app.info.tabId), BOOT_DATA.appContext, util.nextCounter()), s = this;
                try {
                    var n = new window.WebSocket(t)
                } catch (e) {
                    throw new Error("Cannot initialize websocket. [" + e.message + "] [" + t + "]")
                }
                (s._socket = n).onopen = function(e, t, i, n) {
                    s._isOpen = !0,
                    s._pingTimerId = setInterval(function() {
                        s._doPing()
                    }, 5e3),
                    o({
                        open: !0
                    }),
                    o = $.noop,
                    s._flushMessagesQueue()
                }
                ,
                n.onclose = function(e) {
                    var t, i, n = s._isOpen;
                    s._isOpen = !1,
                    s.stop(),
                    clearInterval(s._pingTimerId),
                    4001 === e.code ? (D.isAppOpenInAnotherTab = !0,
                    dialogController.close(),
                    dialogController.showMessageDialog({
                        isModal: !0,
                        message: "Игра запущена в другой вкладке",
                        buttons: [{
                            caption: "Закончить игру в других вкладках",
                            lineBreakClass: isMobi ? "smart" : "",
                            handler: function() {
                                document.location.reload()
                            }
                        }]
                    }),
                    D.trigger(D.EVENTS.APP_OPEN_IN_OTHER_TAB)) : (n = {
                        wasOpen: n
                    },
                    app.serverRebootPopup.isOpen() ? dialogController.showAppRebootDialog() : ((n = n || {}).wasOpen && D.trigger(D.EVENTS.CONNECTION_LOST),
                    dialogController.close(),
                    D.stop(),
                    t = {
                        onTimerComplete: function() {
                            i.dialog.$(".message").html("Попытка подключения..."),
                            setTimeout(function() {
                                D.start(function(e) {
                                    e.open ? (setTimeout(function() {
                                        D._isOpen && D.trigger(D.EVENTS.CONNECTION_RESTORE)
                                    }, 300),
                                    dialogController.close(i)) : t.start()
                                })
                            }, util.random(100, 300))
                        }
                    },
                    i = dialogController.connectionLostDialog(t),
                    t.start())),
                    event.wasClean,
                    s._isOpen = !1,
                    4001 === e.code ? GA("Websocket", "Close", e.code + ";" + e.reason) : GA("Websocket", "Close", e.code + ";" + e.reason + ";wss:" + a)
                }
                ,
                n.onmessage = function(e) {
                    s._handleMessage(e.data)
                }
                ,
                n.onerror = function(e) {
                    GA("Websocket", "Error", "wss:" + a)
                }
                ;
                t = function() {
                    n.onclose = $.noop,
                    n.onerror = $.noop,
                    n.close()
                }
                ;
                window.onbeforeunload = t,
                window.onunload = t
            }
        },
        isSocketOpen: function() {
            return this._socket && this._isOpen
        },
        _flushMessagesQueue: function() {
            var i = this;
            this._messagesQueue.each(function(e, t) {
                i._sendJson(t)
            }),
            i._messagesQueue.length = 0
        },
        _sendJson: function(e) {
            this._lastTimeOfSendMessage = util.currentMillis(),
            this._socket.send(e)
        },
        sendMessage: function(e, t, i) {
            this._isStarted && this._socket && (e.viewer_id = app.info.viewer_id,
            i && (e.cb = w++,
            E[e.cb] = {
                ts: +new Date,
                fn: i
            }),
            e = JSON.stringify(e),
            this._isOpen ? this._sendJson(e) : this._messagesQueue.push(e))
        },
        stop: function() {
            this._isStarted = !1,
            this._disconnect()
        },
        start: function(e) {
            this._disconnect(),
            this._isStarted = !0,
            this._connect(e)
        },
        syncUtc: function() {
            var i = +new Date;
            y = function(e) {
                y = $.noop;
                var t = +new Date - i;
                util.serverUtc();
                util.serverUtc(e + Math.floor(t / 2))
            }
            ,
            this.sendMessage({
                action: "utc"
            })
        }
    };
    _[i] = function(e) {
        var i = e[1]
          , n = e[2]
          , e = JSON.parse(e[3]);
        $.isArray(e[0]) || (e = [e]),
        $.each(e, function(e, t) {
            D.trigger(D.EVENTS.ROOM_CHANGE, {
                roomId: i,
                ctm: n,
                change: t
            })
        })
    }
    ,
    _[e] = function(e) {
        e = {
            uid: e[1],
            warns: e[2]
        };
        D.trigger(D.EVENTS.WARNS_CHANGE, e)
    }
    ,
    _[s] = function(e) {
        dialogController.showAccessDeniedDialog(),
        D.stop()
    }
    ,
    _[t] = function(e) {
        e = {
            hasExpBonus: e[1],
            guest: e[2]
        };
        D.trigger(D.EVENTS.NEW_GUEST, e)
    }
    ,
    _[o] = function(e) {
        var t = e.activeComment
          , i = e.comment
          , e = e.subComment;
        t && D.trigger(D.EVENTS.NEW_ACTIVE_COMMENT, {
            activeComment: t
        }),
        i && D.trigger(D.EVENTS.NEW_COMMENT, {
            comment: i
        }),
        e && D.trigger(D.EVENTS.NEW_SUB_COMMENT, {
            commentTs: e[0],
            commentId: e[1],
            subComment: e[2]
        })
    }
    ,
    _[n] = function(e) {
        var t = e[1]
          , e = e[2];
        D.trigger(D.EVENTS.NEW_NOTIFICATION, {
            notification: t
        }),
        util.isDef(e) && app.balanceModel.setAttr({
            balance: e
        })
    }
    ,
    _[a] = function(e) {
        e = !!e[1];
        D.trigger(D.EVENTS.SERVER_WILL_REBOOT, {
            willReboot: e
        })
    }
    ,
    _[r] = function(e) {
        e = e[1];
        D.trigger(D.EVENTS.UPDATE_ROOM_GIFTS, {
            roomGifts: e
        })
    }
    ,
    _[l] = function(e) {
        e = e.photo;
        D.trigger(D.EVENTS.ADMIN_REVIEW_PHOTO, {
            photo: e
        })
    }
    ,
    _[d] = function(e) {
        e = e.photos;
        D.trigger(D.EVENTS.ADD_PHOTOS, {
            photos: e
        })
    }
    ,
    _[c] = function(e) {
        app.commonState.setAttr(e)
    }
    ,
    _[u] = function(e) {
        D.trigger(D.EVENTS.USER_ADD_TO_FAV, {
            user: e.user
        })
    }
    ,
    _[p] = function(e) {
        D.trigger(D.EVENTS.USER_REMOVE_FROM_FAV, {
            uid: e.uid
        })
    }
    ,
    _[f] = function(e) {
        D.trigger(D.EVENTS.ADMIN_REJECT_PHOTOS, {
            ids: e.ids
        })
    }
    ,
    _[m] = function(e) {
        D.trigger(D.EVENTS.NEW_PRIVATE_MESSAGE, {
            message: e.message,
            data: e
        })
    }
    ,
    _[v] = function(e) {
        var t = e.prevBalance
          , e = e.nextBalance;
        t !== app.balanceModel.balance && null != t || app.balanceModel.setAttr({
            balance: e
        })
    }
    ,
    _[h] = function(e) {
        app.info.freqGiftsData = function() {
            var i = {};
            try {
                JSON.parse(e[1]).each(function(e, t) {
                    i[t._id] = t.v
                })
            } catch (e) {}
            return util.repeat(4, function(e) {
                i[e += 1] = i[e] || []
            }),
            i
        }(),
        app.eventBus.trigger(app.EVENTS.UPDATE_FREQ_GIFTS)
    }
    ,
    _[b] = function(e) {
        y(e)
    }
    ,
    _[g] = function(e) {
        app.eventBus.trigger(app.EVENTS.P2P_DATA, e)
    }
    ,
    _[C] = function(e) {
        var t = E[e.cb];
        t && (delete E[e.cb],
        t.fn(e.response))
    }
    ,
    app.makeEventDispatcher(D);
    var T = 1;
    D.EVENTS = {
        APP_OPEN_IN_OTHER_TAB: T++,
        ROOM_CHANGE: T++,
        WARNS_CHANGE: T++,
        NEW_GUEST: T++,
        NEW_COMMENT: T++,
        NEW_SUB_COMMENT: T++,
        NEW_ACTIVE_COMMENT: T++,
        NEW_NOTIFICATION: T++,
        CONNECTION_LOST: T++,
        CONNECTION_RESTORE: T++,
        SERVER_WILL_REBOOT: T++,
        UPDATE_ROOM_GIFTS: T++,
        ADMIN_REVIEW_PHOTO: T++,
        ADD_PHOTOS: T++,
        USER_ADD_TO_FAV: T++,
        USER_REMOVE_FROM_FAV: T++,
        NEW_PRIVATE_MESSAGE: T++,
        ADMIN_REJECT_PHOTOS: T++
    },
    app.controllers.webSocketController = D,
    window.webSocketController = D
}(),
app.controllers.UsersSearchController = function(e) {
    var t = util.lStorage.find("usersSearchForm_v5")
      , i = 100
      , n = 12
      , o = lilo.createView("users-search-view")
      , r = "pending"
      , a = 14
      , s = 99
      , l = t ? JSON.parse(t) : p()
      , d = !1
      , c = lilo.createView("users-search-form")
      , u = lilo.createView("users-search-result-list");
    function p() {
        var e = 18 <= app.info.age;
        return {
            ageMin: e ? 18 : a,
            ageMax: e ? s : 17,
            sex: 2 === app.info.sex ? 1 : 2,
            regionId: app.info.regionId && (0 < app.info.regionId || -20 === app.info.regionId) ? app.info.regionId : -1,
            countryId: app.info.countryId && 0 < app.info.countryId ? app.info.countryId : 1,
            minLevel: 1,
            vfChecked: !0
        }
    }
    $.extend(l, {
        MINIMUM_AGE: a,
        MAXIMUM_AGE: s,
        __state: 1,
        pending: !1,
        saveToLocalStorage: function() {
            this.ageMin,
            this.ageMax,
            this.sex,
            this.regionId,
            this.countryId,
            this.minLevel,
            this.vfChecked
        },
        validate: function() {
            var e, t = this.ageMin, i = this.ageMax, n = app.info.age;
            i && t || (t = (e = p()).ageMin,
            i = e.ageMax),
            18 <= n ? (t < 18 && (t = 18),
            s < i && (i = s)) : (t < a && (t = a),
            17 < i && (i = 17)),
            this.__isObservable ? this.setAttr({
                ageMin: t,
                ageMax: i
            }) : (this.ageMax = i,
            this.ageMin = t)
        },
        toDefault: function() {
            var e = p();
            this.setAttr(e)
        }
    });
    var f = function() {
        d || (d = !0,
        o.els.result.append(u.el))
    };
    l.validate(),
    l.pending = !1,
    l.__state = 1,
    o.els.form.append(c.el),
    c.setModel(l);
    function m() {
        o.el.removeClass("loading")
    }
    function v(e, a) {
        if (u.model.__allItems.length = 0,
        u.model.setAttr({
            hasMoreItems: 0 < u.model.__allItems.length
        }),
        u.model.items.removeAll(),
        a.hasClass(r))
            return a.removeClass(r),
            l.setAttr({
                pending: !1
            }),
            void l.__state++;
        l.validate(),
        l.saveToLocalStorage(),
        l.setAttr({
            pending: !0
        });
        var s = l.__state
          , e = api.user.search(e, function(e, t) {
            var i, n, o;
            a.removeClass(r),
            l.__state === s && (b.stop(),
            l.setAttr({
                pending: !1
            }),
            e ? dialogController.fadePopup({
                duration: 3e3,
                message: "Пpи запросе произошла ошибка. Code:" + e.code
            }) : (e = u.model,
            i = function(e, t) {
                return e.exp === t.exp ? e.uid > t.uid ? -1 : e.uid === t.uid ? 0 : 1 : e.exp > t.exp ? -1 : 1
            }
            ,
            o = t.onlineUids ? (n = util.collectArrayInObjectByProperty(t.onlineUids),
            e.__allItems = w(t.part0, o = function(e) {
                return !!n[e]
            }
            ),
            util.insertArrayAt(e.__allItems, e.__allItems.length, w(t.part1, o)),
            util.insertArrayAt(e.__allItems, e.__allItems.length, w(t.part2, o)),
            function(e, t) {
                return e.online === t.online ? i(e, t) : e.online ? -1 : 1
            }
            ) : (e.__allItems = w(t.online, o = function(e) {
                return !0
            }
            ),
            i),
            e.__allItems.sort(o),
            e.items.removeAll(),
            C(),
            f()))
        });
        a.addClass(r),
        b.start(),
        e.send()
    }
    l.onChange("pending", function() {
        l.pending || m()
    }),
    u.setModel({
        __allItems: [],
        hasMoreItems: !1,
        items: []
    }),
    c.bind("reset-search", function(e) {
        l.pending || (l.toDefault(),
        E(),
        _(l.regionId, l.countryId))
    });
    var h, g, b = (g = function() {
        l.pending && (u.model.items.length < 12 ? (h = setTimeout(g, 800),
        u.model.items.add({
            dummy: !0
        })) : o.el.addClass("loading"))
    }
    ,
    {
        start: function() {
            b.stop(),
            h = setTimeout(g, 800),
            f(),
            m()
        },
        stop: function() {
            u.model.items.removeAll(),
            clearTimeout(h)
        }
    });
    function C() {
        var e = u.model
          , t = e.__allItems.splice(0, n);
        e.items.add(t),
        e.setAttr({
            hasMoreItems: 0 < e.__allItems.length
        })
    }
    function _(t, i) {
        function n() {
            var e = o ? "{0}, {1}".format(a, o) : "{0}".format(a);
            c.els.location.html(e),
            l.setAttr({
                regionId: t,
                countryId: i
            })
        }
        var o, a = socialApi.getCountryName(i);
        -1 === t || -20 === t ? n() : socialApi.getRegionName(i, t, function(e, t) {
            e || (o = t,
            n())
        })
    }
    function w(e, i) {
        var n = [];
        return e.each(function(e, t) {
            n.push({
                uid: t._id,
                exp: t.exp,
                photoUrl: t.p200 && t.p200.length ? t.p200 : t.p100,
                sex: t.sex,
                vf: t.vf,
                firstName: util.escapeHtml(t.fn, 0, 1) + " " + t.age,
                age: t.age,
                online: i(t._id)
            })
        }),
        n
    }
    function E() {
        v({
            limit_per_part: i,
            min_level: l.minLevel,
            age_min: l.ageMin,
            age_max: l.ageMax,
            country_id: l.countryId,
            vf: l.vfChecked,
            region_id: l.regionId && 0 < l.regionId ? l.regionId : null,
            sex: l.sex
        }, c.els["btn-search"])
    }
    c.bind("search", function(e) {
        return l.pending ? (l.__state += 1,
        b.stop(),
        u.model.items.removeAll(),
        u.model.__allItems.length = 0,
        u.model.setAttr({
            hasMoreItems: 0 < u.model.__allItems.length
        }),
        e.extraData.$btn.removeClass(r),
        void l.setAttr({
            pending: !1
        })) : (l.validate(),
        l.saveToLocalStorage(),
        void v({
            limit_per_part: i,
            min_level: l.minLevel,
            age_min: l.ageMin,
            age_max: l.ageMax,
            country_id: l.countryId,
            vf: l.vfChecked,
            region_id: l.regionId && 0 < l.regionId ? l.regionId : null,
            sex: l.sex
        }, e.extraData.$btn))
    }),
    c.bind("change-age-min", function(e) {
        e = e.extraData.ageMin;
        e !== l.ageMin && (l.setAttr({
            ageMin: e
        }),
        l.ageMax < l.ageMin && l.setAttr({
            ageMax: e
        }))
    }),
    c.bind("change-age-max", function(e) {
        e = e.extraData.ageMax;
        e !== l.ageMax && (l.setAttr({
            ageMax: e
        }),
        l.ageMin > l.ageMax && l.setAttr({
            ageMin: e
        }))
    }),
    c.bind("change-sex", function(e) {
        l.setAttr({
            sex: e.extraData.sex
        })
    }),
    c.bind("change-vf", function(e) {
        l.setAttr({
            vfChecked: e.extraData.value
        })
    }),
    c.bind("change-min-level", function(e) {
        l.setAttr({
            minLevel: e.extraData.level
        })
    }),
    c.bind("change-location", function(e) {
        var i = new app.controllers.dialog.Regions({
            withoutOtherCountry: 1,
            currentRegionId: l.regionId,
            currentCountryId: l.countryId,
            toggleRegions: 1,
            onSubmit: function(e, t) {
                _(e ? e.id : -1, t.id),
                dialogController.close(i.view)
            },
            validateMethod: function(e) {
                e.setAttr({
                    isValid: e.selectedCountry
                })
            }
        });
        i.view.$(".bottom-area .caption").remove(),
        i.view.$(".bottom-area .btn").html("Подтвердить"),
        i.view.$(".dialog-title").html("Выберите регион")
    }),
    u.on("show-user-profile:item-user-in-search-list", function(e) {
        app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: e.extraData.uid
        })
    }),
    u.bind("show-more-items", C);
    var y, D = !0;
    this.start = function(e) {
        $contextArea.append(o.el),
        _(l.regionId, l.countryId),
        D && (E(),
        D = !1),
        y && setTimeout(function() {
            socialApi.scrollWindow(y)
        }, 50)
    }
    ,
    this.stop = function() {
        y = socialApi.getScroll(),
        o.el.detach()
    }
}
,
app.controllers.nameImageGenerator = function() {
    function i(e, t, i) {
        this.color = e,
        this._words = util.shuffleArray(i.filter(function(e) {
            return e.length <= 14
        })),
        this._letter = t.toUpperCase(),
        this._index = 0
    }
    function a(e, t) {
        return new i(function() {
            for (var e = "0123456789ABCDEF".split(""), t = "#", i = 0; i < 6; i++)
                t += e[Math.floor(16 * Math.random())];
            return t
        }(),e,t[0].split(",").map(function(e) {
            return $.trim(e)
        }))
    }
    var s, r;
    function l(e) {
        var t, i, n = [], o = (t = {
            a: a("a", ["amazing, attractive,  amiable,  alluring,  adorable, adored, agreeable, angelic, adventurer,anchored, amorous, amative, attentive, admirable, astonishing, awesome, assertive, affable"]),
            b: a("b", ["beautiful, beauty, baby, bonny, big-hearted, benevolent, blithe, burning, brilliant, brave, beloved"]),
            c: a("c", ["cool, clever, courteous, complaisant, comely,  cute, charming, conscientious, corking, crackajack,coy, cryptic, cunning, creative, capricious, classy, communicative, coquettish, cautious"]),
            d: a("d", ["dear, delicious, darling, decent,  desired, divine, disciplined, debonair, diffident, droll,dreamy, direct, disobedient"]),
            e: a("e", ["experienced, enticing,  engaging, exclusive, eminent, eximious, enigmatic, enterprising, earnest,explicit, effervescent, efficient, extraordinary, educated, enchanting"]),
            f: a("f", ["friendly,  famous, fascinating, fervent, funny, frank, frisky, fantastic, flirtatious, fidget, faithful"]),
            g: a("g", ["gorgeous, gracious, gentle, goodly, glamorous, graceful, genial, golden, good-humoured"]),
            h: a("h", ["happy, handsome,  hearty, healthy, high-minded, hilarious, hardy, hospitable, humble, humorous,heavenly, heartfelt, hard-working, honest, hotsy-totsy, helpmate"]),
            i: a("i", ["inspiring, internal, interesting, inventive, ingenious, initiative, impulsive, impetuous, imposing,intelligent, inquiring, independent, inflexible, indefatigable, indescribable, irresistible,inaccessible, insubordinate, inspire"]),
            j: a("j", ["jolly, jocund, judicious, jocular, jokey, jiggish, jovial, jealous"]),
            k: a("k", ["kindly, kind-hearted, kind, keen, knowing"]),
            l: a("l", ["lovely,  lenient, large-hearted, laughable, lambent, leader, loving, lovable, likable"]),
            m: a("m", ["merciful,  mannerly, modest, magnanimous, marvelous, magnificent, mod, maty, moral, measured"]),
            n: a("n", ["nice, nice-looking, nicy, nonpareil, noble, nailing"]),
            o: a("o", ["obliging, orderly, outspoken, onefold, outgoing, observant, out-of-bounds, outlandish, organized,optimist, obedient, obeying"]),
            p: a("p", ["pretty, perennial, pleasant,  peaceful, peerless, precious, prodigious, playful, perfect, patient,pleasant, persistent, proof, positive, principled, popular, punctual, plucky"]),
            q: a("q", ["quick-witted"]),
            r: a("r", ["responsive, rightful, restrained,  regardful, resilient, remarkable, retiring, rich, resourceful,radiant, restless, responsible, rectilinear, resolute, risky"]),
            s: a("s", ["shine, bright, special, splendid, superb, suave, softhearted, seductive, sweety,  solicitous,sylphlike, soulful, sacrificing, swell, striking, super-duper, shy, sane, sober, spellbinding,sincere, schemer, spectacular, sexy, strong, stylish, sociable, shrewd, spunky"]),
            t: a("t", ["tolerant, tenderhearted, tempting, thoughtful, talented, tender, taciturn, traveler"]),
            u: a("u", ["unmatched, unfailing, uncommon, unique, unexceptionable, unfeigned, unexpected, unwearying,unbending, unrepeatable, unforgettable, unpredictable, unearthly, unbeaten"]),
            v: a("v", ["verecund, visionary, venturous, vulnerable"]),
            w: a("w", ["wonderful,  warm-hearted, well-wishing, wild, wholesome, waggish, wonder, wriggler, wayward, wise,winsome, winning, witty, wieldy"]),
            x: a("x", [""]),
            y: a("y", [""]),
            z: a("z", ["zealous"])
        },
        i = 2 === app.info.sex ? {
            "а": a("а", ["ангельский, артистичный, аккуратный, активный, авантюрист, амбициозный"]),
            "б": a("б", ["благоверный, балованный, благодарный,  беспокойный, безобидный, бурный,борец, божественный, безупречный, бескорыстный, блаженный, бесподобный, будоражающий"]),
            "в": a("в", ["внимательный, великодушный, впечатляющий, влиятельный, вдохновляющий, впечатлительный,выдумщик, верный,  влюбчивый, вдумчивый, веселый, восторженный, вежливый, взрывной, выносливый"]),
            "г": a("г", ["гармоничный, гостеприимный, гурман, грамотный, грациозный, главенствующий, галантный, горячий,гениальный, головокружительный"]),
            "д": a("д", ["доброжелательный, деликатный, домосед, дипломатичный, действенный, добрый, добросовестный, дисциплинированный, добродушный, домашний, дикий, дерзкий, добытчик, дивный, душевный, драгоценный"]),
            "е": a("е", ["единомышленник,  единственный, естественный"]),
            "ё": a("ё", ["единомышленник,  единственный, естественный"]),
            "ж": a("ж", ["жертвенный,  жизнерадостный, желанный, жгучий, жаркий"]),
            "з": a("з", ["заботливый, замечательный, застенчивый, здравомыслящий, здоровый, загадочный, завораживающий,забавный, заманчивый, золотой"]),
            "и": a("и", ["интересный, изумительный, изобретательный, инициативний, импульсивный, искренний,  интригант,изысканный, искрометный, игривый, идеальный, импозантный"]),
            "й": a("й", [""]),
            "к": a("к", ["капризный, крутой, классный, красивый, коммуникабельный, компанейский, карьерист, крепкий,кокетливый, креативный"]),
            "л": a("л", ["лидер, ласковый, любознательный, любезный, лояльный, логичный, лучезарный, любвеобильный, лиричный"]),
            "м": a("м", ["мягкий, мужественный, молчаливый, милый, мечтательный, манящий, модный, мудрый"]),
            "н": a("н", ["неожиданный, нежный, надежный, независимый, нравственный, настойчивый, непоседа,  независимый, наблюдательный, непреклонный, напористый, неторопливый, неусидчивый,  неутомимый, неповторимый, еописуемый, незабываемый, неотразимый, недоступный, непредсказуемый, непосредственный, необычайный, ненаглядный, неземной, непокорный, непревзойденный"]),
            "о": a("о", ["обоятельный, осторожный, организованный, ответственный, образованный, остроумный, общительный,обдумчивый, откровенный, отзывчивый, оптимист, организатор,  объективный, обалденный, обворожительный,очаровательный, ослепительный, обольстительный, одурманивающий, окрыляющий, отважны"]),
            "п": a("п", ["предприимчивый, помощник, подвижный, праведный, путешественник, победитель, послушный, положительный,прямолинейный, правдивый, проницательный, привязчивый, принципиальный, привлекательный, популярный,переживательный, покладистый, покорный, продумчивый,  приветливый, преданный, подозрительный, пунктуальный,понимающий, пылкий, прелестный, пригожий, примерный, потрясный, прямой"]),
            "р": a("р", ["решительный, разборчивый, рискованый, развивающийся, руководитель,  располагающий, расчетливый,робкий,  рассудительный, ранимый, ревнивый, романтичный, разносторонний, радушный"]),
            "с": a("с", ["стремительный, справедливый, спокойный, сильный, самостоятельный, смелый, симпатичный, смешной,сердечный, саможертвенный, сентиментальный, страстный,  сопереживательный, способный,  серьезный,стеснительный, самовластный, скромный, статный, сексуальный,  самолюбивый, славный, страстный,сногсшибательный, стильный, сказочный, совершенный, соблазнительный, сенсационный, солнечный"]),
            "т": a("т", ["терпеливый, трудолюбивый, талантливый, темпераментный, таинственный, творческий, тихий,тактичный, трогательный"]),
            "у": a("у", ["увлекающий, уравновешенный, упорный,  уступчивый, уверенный, умен,  усидчив, успешный, улыбчив,утончённый, умопомрачительный, уникальный, умелый, удачливый"]),
            "ф": a("ф", ["фантазер, фееричный, феноминальный, фантастический, фотогеничный"]),
            "х": a("х", ["храбрый, хороший, хозяйственный, хитрый, хвастливый"]),
            "ц": a("ц", ["царственный, целеустремленный, целомудренный, целенаправленный, ценный"]),
            "ч": a("ч", ["чувствительный, чувственный, честный, чистолюбивый, чистосердечный, чарующий, чудесный, чистоплотный"]),
            "ш": a("ш", ["шумный, шалунишка, шикарный, шаловливый, шокирующий"]),
            "щ": a("щ", ["щедрый"]),
            "ъ": a("ъ", [""]),
            "ы": a("ы", [""]),
            "ь": a("ь", [""]),
            "э": a("э", ["Экстравагантный, эмоциональный, энергичный, элегантный, эффектный, эпатажный"]),
            "ю": a("ю", ["юморист"]),
            "я": a("я", ["яркий"])
        } : {
            q: a("q", ["queen, quick-witted"]),
            "а": a("а", ["ангельская, артистичная,  аккуратная, активная, авантюристка, амбициозная, ароматная"]),
            "б": a("б", ["благоверная, балованная, благодарная, безобидная, бурная, божественная, безупречная,бескорыстная, блаженная, бесподобная, будоражащая"]),
            "в": a("в", ["внимательная, великодушная, впечатляющая, влиятельная, вдохновляющая, впечатлительная,верная,  влюбчивая, вдумчивая, веселая, восторженная, вежливая, взрывная, выносливая"]),
            "г": a("г", ["гармоничная, гостеприимная, грамотная, грациозная, главенствующая, галантная, горячая,гениальная, головокружительная"]),
            "д": a("д", ["доброжелательная, деликатная, дипломатичная, дружная, действенная, добрая, добросовестная,дисциплинированная, добродушная, домашняя, добытчица, дивная, душевная, драгоценная"]),
            "е": a("е", ["единомышленница, единственная, естественная"]),
            "ё": a("ё", ["единомышленница, единственная, естественная"]),
            "ж": a("ж", ["жертвенная, жизнерадостная, женственная, желанная, жгучая, жаркая"]),
            "з": a("з", ["заботливая, замечательная, застенчивая, здравомыслящая, здоровая, загадочная, завораживающая,забавная, заманчивая, золотая"]),
            "и": a("и", [" интересная, изумительная, изобретательная, инициативная, импульсивна, искренняя,  интриганка,изысканная, искрометная, игривая, идеальная, импозантная"]),
            "й": a("й", [""]),
            "к": a("к", ["капризная, крутая, классная, красивая, коммуникабельная, компанейская, карьеристка, крепкая,кокетливая, креативная"]),
            "л": a("л", ["ласковая, любознательная, любезная, лояльная, логичная, лучезарная, любвеобильная, лиричная"]),
            "м": a("м", ["мягкая, молчаливая, милая, мечтательная, манящяя, модная, мудрая"]),
            "н": a("н", ["неожиданная, нежная, надежная, нравственная, настойчивая, непоседа,  независимая, наблюдательная,непреклонная, напористая, неторопливая, неусидчивая, неутомимая, неповторимая, неописуемая,незабиваемая, неотразимая, недоступная, непредсказуемая, непосредственная, необычайная, ненаглядная,неземная, непокорная, непревзойденная"]),
            "о": a("о", ["обоятельная, осторожная,  организованная, ответственная, образованная, остроумная общительная,обдуманная, откровенная, отзывчивая, оптимистка, организатор,  объективная, обалденная, обворожительная,очаровательная, ослепительная, обольстительная, одурманивающая, окрыляющая, отважная"]),
            "п": a("п", ["предприимчивая, помощница, подвижная, праведная, путешественница, победительница, послушная,положительная, прямолинейная, правдивая, прямая, проницательная, принципиальная, привлекательная,популярная,  переживательная, покладистая, покорная, приветливая, преданная, подозрительная,пунктуальная, понимающая, пылкая, прелестная, пригожая, примерная, потрясная"]),
            "р": a("р", ["решительная, разборчивая, рискованная, развивающаяся, руководительница,  располагающая, расчетливая,робкая,  рассудительная, ранимая, ревнивая, романтичная, разносторонняя, радушная"]),
            "с": a("с", ["стремительная, справедливая, спокойная, сильная, сопереживательная, способная,  серьезная,стеснительная, самовластная, скромная, статная, сексуальная, самолюбивая, славная, страстная,сногсшибательная, стильная, сказочная, совершенная, соблазнительная, сенсационная, солнечная"]),
            "т": a("т", ["терпеливая, трудолюбивая, талантливая, темпераментная, таинственная, творческая, тихая, тактичная,трогательная"]),
            "у": a("у", ["увлекательная, уравновешенная, упорная,  уступчивая, уверенная, умная,  усидчивая, успешная,улыбчивая, утонченная, умопомрачительная, уникальная, умелая, удачливая"]),
            "ф": a("ф", ["фантазерка, фееричная, феноминальная, фантастическая, фотогеничная"]),
            "х": a("х", ["храбрая, хорошая, хозяйственная, хитрая, хвастливая"]),
            "ц": a("ц", ["царственная, целеустремленная. целомудренная, цветущая, целенаправленная, ценная"]),
            "ч": a("ч", ["чувствительная, чувственная, честная, чистолюбивая, чистосердечная, чарующая, чудесная, чистоплотная"]),
            "ш": a("ш", ["шумная, шалунишка, шикарная, шаловливая, шокирующая"]),
            "щ": a("щ", ["щедрая, щепетильная"]),
            "ъ": a("ъ", [""]),
            "ы": a("ы", [""]),
            "ь": a("ь", [""]),
            "э": a("э", ["экстравагантная, эмоциональная, энергичная, элегантная, эффектная, эпатажная"]),
            "ю": a("ю", ["юмористка"]),
            "я": a("я", ["яркая"])
        },
        $.extend(t, i),
        t);
        return e.split("").map(function(e) {
            return e.toLowerCase()
        }).each(function(e, t) {
            t = o[t];
            if (!t)
                return n = null,
                !1;
            n.push(t)
        }),
        n
    }
    return $.extend(i.prototype, {
        getWord: function() {
            return this._index += 1,
            this._index >= this._words.length && (this._index = 0),
            this._words[this._index] || ""
        },
        render: function(e, t) {
            var i = this.getWord()
              , n = this._letter
              , t = t * s + parseInt(s / 2, 10);
            e.font = "normal 96px Boomboom",
            e.textAlign = "center",
            e.textBaseline = "hanging",
            e.fillStyle = this.color,
            e.fillText(n, t, 12),
            e.font = "normal 12px 'Open Sans'",
            i && i.length && (i = i[0].toUpperCase() + i.substr(1)),
            e.fillText(i, t, 12 + r - 7)
        }
    }),
    {
        getCellWidth: function() {
            return s
        },
        generateImage: function(e) {
            s = 120,
            r = 90;
            var t, i, n = l(e), o = n ? (e = s * (t = n).length,
            n = r + 26,
            o = document.createElement("canvas"),
            i = o.getContext("2d"),
            o.width = e,
            o.height = n,
            t.each(function(e, t) {
                t.render(i, e)
            }),
            o) : null;
            return o
        }
    }
}(),
app.controllers.RecentPrivateMessagesController = function(e) {
    var t, d = e.headerView, i = e.bootData, o = 10, n = this, a = app.info.viewer_id, s = null, r = app.PrivateMessageState, l = app.PrivateMessageType;
    isMobi;
    var c = {
        allItems: [],
        visibleItems: [],
        totalSize: 0,
        recentMessage: null
    }
      , u = app.sdk.singleSequenceRequests({
        minDelay: 500,
        send: function(i, e) {
            var t = {};
            (e = e || {}).update_counter && (t.update_counter = !0),
            ServerApi("privatemessage/recent.php", t, function(e, t) {
                e || v(t.recentMessages, t.count),
                i.onComplete()
            })
        }
    });
    function p() {
        t.detachWhenRemove = !0,
        dialogController.open(t, {
            mobiFullHeight: 1
        })
    }
    function f(e) {
        $.isArray(e) || (e = [e]);
        var i = app.info.viewer_id
          , n = app.info.first_name
          , o = expController.getCurrentExp()
          , a = app.commonState.avatar
          , s = app.commonState.verified;
        e.each(function(e, t) {
            util.isDef(t.selected) || t.addProperty("selected", !1),
            t.from === i ? t.setAttr({
                fromExp: o,
                fromFirstName: n,
                fromAvatar: a,
                fromVF: s
            }) : t.setAttr({
                toExp: o,
                toFirstName: n,
                toAvatar: a,
                toVF: s
            })
        })
    }
    function m(i) {
        var n = !1;
        c.allItems.each(function(e, t) {
            if (!1 === i(e, t))
                return !(n = !0)
        }),
        n || c.visibleItems.each(function(e, t) {
            if (!1 === i(e, t))
                return !1
        })
    }
    function v(e, t) {
        var n = []
          , o = {};
        m(function(e, t) {
            n.push(t);
            t = t.from + "_" + t.id;
            o[t] = !0
        }),
        e.each(function(e, t) {
            var i = t.from + "_" + t.id;
            o[i] || n.push(t)
        }),
        n = n.sort(function(e, t) {
            return e.type === t.type ? e.ts > t.ts ? -1 : 1 : e.type === l.P2P_INVITE || t.type !== l.P2P_INVITE && (e.type === l.TYPE_GOLD || t.type !== l.TYPE_GOLD && e.ts > t.ts) ? -1 : 1
        }),
        c.setAttr({
            totalSize: t
        }),
        c.allItems.removeAll(),
        c.visibleItems.removeAll(),
        c.allItems.add(n),
        h()
    }
    function h() {
        for (; c.visibleItems.length < o && c.allItems.length; ) {
            var e = c.allItems[0];
            c.allItems.remove(e),
            f(e),
            c.visibleItems.add(e)
        }
        var t = 0 === c.allItems.length && c.totalSize > o;
        c.visibleItems.length < o && c.visibleItems.length !== c.totalSize ? g({
            update_counter: !0
        }) : t && g()
    }
    function g(e) {
        u.send(e)
    }
    function b(i) {
        var n = null;
        return m(function(e, t) {
            if (t.id === i.id && (t.from === i.from || i.z1 === t.z1))
                return n = t,
                !1
        }),
        n
    }
    function C(e) {
        var i, n, t = b(e);
        t && (c.setAttr({
            totalSize: Math.max(c.totalSize - 1, 0)
        }),
        c.allItems.remove(t),
        c.visibleItems.remove(t)),
        c.recentMessage && c.recentMessage.id === e.id && c.recentMessage.from === e.from && c.setAttr({
            recentMessage: null
        }),
        i = e,
        window.roomModel && (e = roomModel.getViewer().privateMessages,
        n = [],
        e && e.length && e.each(function(e, t) {
            t.from === i.from && t.id === i.id && n.push(t)
        }),
        n.length && roomModel.getViewer().privateMessages.remove(n))
    }
    function _() {
        var e = c.recentMessage
          , t = null;
        return (t = e ? b(e) : t) && w(t),
        c.setAttr({
            recentMessage: null
        }),
        t
    }
    !function() {
        (t = lilo.createView("recent-private-messages")).setModel(c);
        var e = function(t, e) {
            function i() {
                isMobi ? (a.css("display", t.totalSize ? "" : "none"),
                d.updatePrivateMessageCounter(t.totalSize)) : a.css("display", t.totalSize ? "" : "none"),
                r.text(t.totalSize),
                t.totalSize || d.closePrivateMessagesPopup(),
                t.totalSize > o && (l || isMobi || (l = !0,
                r.addClass("animated"),
                setTimeout(function() {
                    l = !1,
                    r.removeClass("animated")
                }, 550))),
                o = t.totalSize
            }
            function n() {
                var e = t.recentMessage;
                e ? (s.css({
                    top: "22px",
                    opacity: "0"
                }),
                s.html(util.escapeHtml(e.name)).css("display", "inline-block"),
                setTimeout(function() {
                    s.css({
                        top: "0px",
                        opacity: "1"
                    })
                }, 0)) : s.html("").hide()
            }
            var o, a = d.$(".private-messages-btn"), s = d.$(".recent-message-link"), r = (d.$(".private-messages-btn .counter"),
            a.find(".counter")), l = !1;
            n(),
            i(),
            t.onChange("totalSize", i),
            t.onChange("recentMessage", n),
            d.$(".private-messages-popup").append(e.el),
            isMobi && d.bind("open-private-messages", function() {
                _() || p()
            });
            return {
                $recentMessageLink: s
            }
        }(c, t);
        v(i.recentPrivateMessages, i.privateMessagesSize),
        c.visibleItems.on("remove", "self", function() {
            h()
        }),
        t.on("open:item-recent-private-message", function(e) {
            e = e.extraData.model;
            isMobi && dialogController.close(t),
            w(e)
        }),
        t.on("delete:item-recent-private-message", function(e) {
            var t = e.extraData.model
              , e = e.extraData.$btnEl;
            E(t, e)
        }),
        app.commonState.onChange("avatar", function() {
            f(c.visibleItems)
        }),
        webSocketController.on(webSocketController.EVENTS.NEW_PRIVATE_MESSAGE, function(e) {
            var i, t, n = e.message, e = e.data;
            switch (n.state) {
            case r.STATE_RESPONSE:
            case r.STATE_RESPONSE_REMOVE:
            case r.STATE_REQUEST:
                b(n) ? C(n) : n.owner === app.info.viewer_id && (lilo.makeObservable(n),
                f(n),
                c.setAttr({
                    totalSize: c.totalSize + 1
                }),
                n.type === app.PrivateMessageType.TYPE_GOLD ? c.visibleItems.add(n, 0) : (i = 0,
                c.visibleItems.each(function(e, t) {
                    if (t.type !== l.TYPE_GOLD)
                        return i = e,
                        !1
                }),
                c.visibleItems.add(n, i)),
                c.visibleItems.length > o && (t = c.visibleItems.lastEl(),
                c.visibleItems.remove(t),
                c.allItems.add(t, 0)));
                break;
            case r.STATE_COMPLETE:
                C(n)
            }
            e.conferenceId && (console.info("CONFERENCE ID: " + e.conferenceId),
            app.eventBus.trigger(app.EVENTS.MOVE_TO_CONFERENCE, {
                conferenceId: e.conferenceId
            }))
        }),
        app.eventBus.on(app.EVENTS.REMOVE_PRIVATE_MESSAGE, function(e) {
            e = b(e.model);
            e && E(e, $(document.createElement("div")))
        }),
        n.setRecentMessage = function(e) {
            c.setAttr({
                recentMessage: {
                    id: e.id,
                    from: e.from,
                    name: e.from === a ? e.toFirstName : e.fromFirstName
                }
            })
        }
        ,
        n.getLastMessage = function() {
            var e = c.recentMessage;
            return e ? b(e) : c.visibleItems[0]
        }
        ,
        e.$recentMessageLink.click(function() {
            _()
        })
    }();
    var w = function(e) {
        var i;
        e.__deletePending || (s && (s.setAttr({
            selected: !1
        }),
        s = null),
        e.setAttr({
            selected: !0
        }),
        s = e,
        new app.controllers.dialog.RoomPrivateMessage({
            privateMessage: e,
            onClose: function() {
                isMobi && p()
            },
            onDelete: function() {}
        }),
        (i = e).type !== app.PrivateMessageType.TYPE_GOLD || i.state != r.STATE_REQUEST || i.__fetchBonus || (i.__fetchBonus = !0,
        ServerApi("privatemessage/getBonus.php", {
            message_id: (i.z1 || i.from) + "_" + i.id
        }, function(e, t) {
            i.__fetchBonus = !1,
            e ? e.code === Codes.NOT_FOUND ? c.visibleItems.remove(i) : e.code === Codes.ACCESS_DENIED ? t.type && i.setAttr({
                type: t.type
            }) : dialogController.fadePopup("Не удалось выполнить запрос.. Code: " + e.code) : (app.balanceModel.setAttr({
                balance: t.balance
            }),
            dialogController.fadePopup("Вам зачислено +{0} монета".format(t.bonus)),
            i.setAttr({
                type: l.TYPE_GOLD_RECEIVED
            }))
        })),
        d.closePrivateMessagesPopup())
    }
      , E = function(i, n) {
        var e = {
            message_id: (i.z1 || i.from) + "_" + i.id,
            delete: !0,
            text: ""
        }
          , t = window.roomModel ? window.roomModel.roomId : null;
        t && (e.room_id = t),
        i.__deletePending || (i.__deletePending = !0,
        n.addClass("loading"),
        ServerApi("privatemessage/add.php", e, function(e, t) {
            e ? (n.removeClass("loading"),
            i.__deletePending = !1,
            dialogController.showError(e)) : (n.removeClass("loading"),
            i.__deletePending = !1,
            dialogController.fadePopup("Сообщение удалено"),
            C(i),
            i.state === r.STATE_REQUEST && cAnal.trackEvent({
                pm_remove: 1
            }))
        }))
    }
}
,
app.controllers.SpecialUsersController = function() {
    function l(e) {
        this.id = e._id,
        this.fullName = e.fn + "",
        this.__searchWord = this.fullName.toLowerCase(),
        this.avatar = e.p100
    }
    this.openDialog = function() {
        function e(e, t) {
            var i = app.sdk.viewComponents.searchInput(n.els.search_input, e, t, {
                maxSize: 1e9
            });
            return i.reset(),
            setTimeout(function() {
                i.focus()
            }, 100),
            i
        }
        function t(e) {
            e.searchComponent && (e.searchComponent.dispose(),
            e.searchComponent = null),
            o.setAttr({
                subTitle: ""
            })
        }
        var o = {
            pending: !1,
            subTitle: "",
            __blackList: [],
            __favList: [],
            resultArray: []
        }
          , n = lilo.createView("dialog-special-users");
        n.setModel(o);
        var i, a, s, r, d = new app.sdk.TabViewController({
            $container: n.els["tabs-block"],
            tabs: [{
                selected: !0,
                title: "Избранные",
                searchHandler: null,
                onOpen: function() {
                    this.searchComponent = e(o.__favList, o.resultArray)
                },
                onClose: function() {
                    t(this)
                }
            }, {
                title: "Черный список",
                searchHandler: null,
                onOpen: function() {
                    this.searchComponent = e(o.__blackList, o.resultArray),
                    o.setAttr({
                        subTitle: 'Пользователи в этом списке не могут отправить вам "Сообщение". Вы не видите их записи в чате.<br>Не смогут зайти в ваш профиль'
                    })
                },
                onClose: function() {
                    t(this)
                }
            }]
        });
        dialogController.open(n),
        o.setAttr({
            pending: !0
        }),
        i = function(e, t, i) {
            e ? dialogController.showError(e) : (o.setAttr({
                pending: !1
            }),
            o.__favList.pushArray(t),
            o.__blackList.pushArray(i),
            (i = d.getSelectedTab().descr.searchComponent).reset(),
            i.focus())
        }
        ,
        a = util.getKeys($.extend({}, app.info.blockedUids, app.info.favUsersUids)),
        s = [],
        r = [],
        app.controllers.SpecialUsersController.getUsers(a, function(e, t) {
            e ? i(e) : (t.each(function(e, t) {
                var i = t._id;
                app.info.favUsersUids[i] && r.push(new l(t)),
                app.info.blockedUids[i] && s.push(new l(t))
            }),
            i(null, r, s))
        }),
        n.bind("delete", function(e) {
            console.info("delete", e.extraData);
            var i, n, t = $(e.extraData.targetEl), a = e.extraData.uid, e = 0 === d.getIndexOfSelectedTab(), s = e ? o.__favList : o.__blackList, r = o.resultArray, l = d.getSelectedTab();
            t.hasClass("loading") || (t.addClass("loading"),
            i = function() {
                t.removeClass("loading")
            }
            ,
            n = function() {
                var i, n, o;
                i = a,
                o = r,
                (n = s).each(function(e, t) {
                    if (t.id === i)
                        return n.splice(e, 1),
                        !1
                }),
                o.each(function(e, t) {
                    if (t.id === i)
                        return o.remove(t),
                        !1
                });
                var e = l.searchComponent.getCurrentSearchWord();
                l.searchComponent.reset({
                    silence: !0
                }),
                l.searchComponent.search(e)
            }
            ,
            e ? ServerApi("user/removeFromFav.php", {
                target_uid: a
            }, function(e, t) {
                i(),
                e ? dialogController.showError(e) : (app.eventBus.trigger(app.EVENTS.USER_REMOVED_FROM_FAV, {
                    uid: a
                }),
                dialogController.fadePopup({
                    message: "Пользователь удален из избранного"
                }),
                n())
            }) : ServerApi("room/v3/toggleBlock.php", {
                value: !1,
                target_uid: a
            }, function(e, t) {
                i(),
                e ? dialogController.showError(e) : (app.eventBus.trigger(app.EVENTS.USER_UNBLOCKED, {
                    uid: a
                }),
                dialogController.fadePopup({
                    message: "Пользователь разблокирован"
                }),
                n())
            }))
        }),
        n.bind("open-profile", function(e) {
            dialogController.close(n),
            app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: e.extraData.uid
            })
        })
    }
}
,
app.controllers.SpecialUsersController.Cache = function() {
    var n = {};
    return {
        get: function(e, t) {
            e = n[e];
            if (e && (t = t || util.currentMillis()) - e.ts < 3e5)
                return JSON.parse(e.json)
        },
        set: function(e, t, i) {
            t = {
                ts: i = i || util.currentMillis(),
                json: JSON.stringify(t)
            };
            n[e] = t
        }
    }
}(),
app.controllers.SpecialUsersController.fetchUsersFromServer = function(e, a) {
    var s = app.controllers.SpecialUsersController.Cache
      , r = e.chunks(1e3)
      , l = []
      , d = function(i, o) {
        o = o || 1,
        i = i || r.shift(),
        ServerApi("b8cb335.php", {
            uids: i.join("_"),
            method: "POST"
        }, function(e, t) {
            var n;
            e ? 4 < o ? a(e) : setTimeout(function() {
                d(i, o + 1)
            }, 500) : (n = util.currentMillis(),
            t.list.each(function(e, t) {
                var i = t._id;
                s.set(i, t, n),
                l.push(t)
            }),
            r.length ? setTimeout(d, 500) : a(null, l))
        })
    };
    d()
}
,
app.controllers.SpecialUsersController.getUsers = function(e, i) {
    var n = app.controllers.SpecialUsersController.Cache
      , o = util.currentMillis()
      , a = []
      , s = [];
    e.each(function(e, t) {
        var i = n.get(t, o);
        i ? s.push(i) : a.push(t)
    }),
    a.length ? app.controllers.SpecialUsersController.fetchUsersFromServer(a, function(e, t) {
        e ? i(e, []) : (s.pushArray(t),
        i(null, s))
    }) : i(null, s)
}
,
app.controllers.ContentEditableController = function(e) {
    var t, s = e.$input, n = e.$placeHolderEl, o = e.onPlaceholderHandle || function(e) {}
    , l = e.isIgnoredNodeOnParseText || function(e) {
        return !1
    }
    , a = e.canShowPlaceHolder || function() {
        return !0
    }
    , d = e.needAddNBSPBeforeEmoji || function() {
        return !1
    }
    , i = e.maxLength || 100;
    IS_FIREFOX && s.attr("role", "textblock"),
    s.attr("contenteditable", !0).addClass("needsfocus");
    var c, u = app.controllers.Emoji, p = isMobi, f = p ? function(e, t) {
        var i, n, o, a, s = -1;
        if (t.length > (e = e || "").length) {
            for (i = t,
            n = e,
            o = 0; o < i.length && (a = i[o]) === n[o]; o += 1)
                ;
            a && (s = a.charCodeAt(0))
        } else
            t.length === e.length - 1 && (s = 8);
        return -1 !== s ? s : 229
    }
    : $.noop;
    function m(e) {
        var t, i = !0, i = e && e.hide ? (n.css("display", "none"),
        !1) : (t = !0,
        (e = s.html()) && "<br>" !== e && (t = !1),
        a() && t);
        n.css("display", i ? "block" : "none"),
        o(i)
    }
    function v(e) {
        var t, i;
        IS_MSIE ? document.selection ? (t = document.selection.createRange()).pasteHTML && t.pasteHTML(e) : (t = document.getSelection().getRangeAt(0),
        i = document.createElement("span"),
        t.surroundContents(i),
        i.innerHTML = e,
        t.collapse(!1)) : document.execCommand("insertHTML", !1, e)
    }
    s.on("focus", function() {
        c = s.html()
    }).on("blur keyup paste input", function(e) {
        var t = s.html();
        c !== t && (s.trigger($.Event("change", {
            initialEvent: e,
            extra: {
                keyCode: f(c, t)
            }
        })),
        c = t)
    }),
    s.on("paste", function(e) {
        e.preventDefault(),
        e.stopPropagation();
        var t = (e.originalEvent.clipboardData || window.clipboardData).getData("Text")
          , e = g().length
          , e = Math.max(i - e, 0);
        return t && t.length && (t.length > e && (t = t.substr(0, e)),
        v(t = util.replaceAppProfileLinks(t))),
        !1
    }),
    s.on("change", function(e) {
        m();
        var t, i = e.extra.keyCode;
        229 !== i || 0 < (t = s.html()).length && (i = t.charCodeAt(0)),
        i && s.trigger($.Event("c-kb-event", {
            which: i,
            initialEvent: e.initialEvent
        }))
    });
    function h(e, t, i) {
        var n, o, a = s[0];
        a.focus(),
        a.phonfocus && a.phonfocus(),
        void 0 !== window.getSelection && void 0 !== document.createRange ? (n = window.getSelection(),
        o = document.createRange(),
        e ? o.selectNode(e) : o.selectNodeContents(a),
        i || o.collapse(!t),
        (n = window.getSelection()).removeAllRanges(),
        n.addRange(o)) : void 0 !== document.body.createTextRange && ((o = document.body.createTextRange()).moveToElementText(e || a),
        o.collapse(!t),
        o.select())
    }
    function g() {
        var e = w();
        if (0 === e.length)
            return "";
        var t = u.getCountOfEmojiMasks(e);
        return e.length - 10 * t > i && (t = (e = e.substr(0, i)).lastIndexOf(" "),
        e = e.substr(0, t)),
        e
    }
    var b, C, _, w = (C = new RegExp("^(DIV|P|LI|OL|TR|TD|BLOCKQUOTE)$"),
    _ = function(e) {
        for (var t, i, n = e.firstChild, o = "", a = C; n; ) {
            switch (n.nodeType) {
            case 3:
                o += t = n.data.replace(/^\n|\n$/g, " ").replace(/[\n\xa0]/g, " ").replace(/[ ]+/g, " ");
                break;
            case 1:
                if (!l(n)) {
                    if (t = _(n),
                    n.tagName && n.tagName.match(a) && t) {
                        "\n" != t.substr(-1) && (t += "\n");
                        for (var s = n.previousSibling; s && 3 == s.nodeType && "" == $.trim(s.nodeValue); )
                            s = s.previousSibling;
                        !s || s.tagName && s.tagName.match(a) || (t = "\n" + t)
                    } else
                        "IMG" == n.tagName || "emoji" === n.className ? (i = u.getUtf8Code(n)) && (t += u.utf16toMask(i),
                        b.push(i)) : "BR" == n.tagName && (t += "\n");
                    o += t;
                    break
                }
            }
            n = n.nextSibling
        }
        return o
    }
    ,
    function() {
        b = [];
        var e = _(s[0])
          , i = [];
        return $.each(b, function(e, t) {
            i.push(t)
        }),
        t = i,
        e
    }
    );
    m(),
    this.isPrintableKeyCode = function(e) {
        return 47 < e && e < 58 || 32 == e || 13 == e || 64 < e && e < 91 || 95 < e && e < 112 || 185 < e && e < 193 || 218 < e && e < 223 || p && /^[^\x00-\x1F\x80-\x9F]+$/.test(String.fromCharCode(e))
    }
    ,
    this.editableFocus = h,
    this.createAndParseResultText = g,
    this.getCaretPosition = function() {
        return s.caret("pos")
    }
    ,
    this.getLastEnteredEmoji = function() {
        return t
    }
    ,
    this.maxLengthIsReached = function() {
        var e = w();
        return 0 !== e.length && e.length >= i
    }
    ,
    this.handlePlaceholder = m,
    this.insertEmoji = function(e) {
        var t = app.controllers.Emoji.createImgNode(e, {
            forContentEditable: !0
        })
          , i = document.createElement("div");
        i.appendChild(t);
        for (var e = (s.html() || IS_FIREFOX || d() ? "&nbsp;" : "") + i.innerHTML, n = s[0], i = !!window.getSelection && window.getSelection(), t = !(!i || !i.rangeCount) && ((i = i.getRangeAt(0)).commonAncestorContainer || (i.parentElement ? r.parentElement() : r.item(0))); t && t != n; )
            t = t.parentNode;
        !function() {
            if (IS_FIREFOX)
                for (var e = s[0].firstChild; e; ) {
                    if (1 === e.nodeType && "BR" === e.tagName) {
                        s[0].removeChild(e);
                        break
                    }
                    e = e.nextSibling
                }
        }();
        t || h(!1, !0),
        v(e),
        m(),
        isMobi
    }
    ,
    this.insertHTML = v
}
,
app.controllers.MoneyBoxController = function(t) {
    var i, n, o = !!isMobi && !isDirect && !util.isOKPlatform(), a = this, s = {
        value: t.value
    };
    o || ((i = lilo.createView("moneybox-counter")).setModel(s),
    (n = function(e) {
        15 <= e && (t.headerView.els["money-box"].append(i.el),
        n = $.noop)
    }
    )(expController.getCurrentLevel()),
    app.eventBus.on(app.EVENTS.VIEWER_LEVEL_CHANGED, function(e) {
        n(e.level)
    }),
    i.el.click(function() {
        var e = lilo.createView("dialog-gain-moneybox");
        e.setModel({
            value: i.viewModel.value,
            isLimitExceeded: i.viewModel.isLimitExceeded
        }),
        dialogController.open(e, {
            dialogClass: "no-padding"
        }),
        e.bind("submit", function() {
            socialApi.showOrderBox("item_258", function() {
                setTimeout(function() {
                    ServerApi("moneybox/get.php", {}, function(e, t) {
                        e || (app.balanceModel.setAttr({
                            balance: t.balance
                        }),
                        cAnal.trackEvent({
                            gain_moneybox: 1
                        }))
                    }),
                    e.complete(),
                    setTimeout(function() {
                        app.eventBus.trigger(app.EVENTS.PURCHASE)
                    }, 100)
                }, 0)
            })
        })
    })),
    this.setValue = function(e) {
        o || s.setAttr({
            value: e
        })
    }
    ,
    this.incValue = function(e) {
        o || s.setAttr({
            value: s.value + .08 * e
        })
    }
    ,
    this.sync = function() {
        o || ServerApi("moneybox/get.php", {}, function(e, t) {
            e || a.setValue(t.moneyBox)
        })
    }
}
,
app.controllers.ViralQuestionsTabController = function(e) {
    e = e || {};
    var p, f, t = "viral-view-v2", m = 1, v = this, h = lilo.createView(t), g = [], C = [], _ = [], i = !1, w = !1, E = !1, y = "1", D = "2", n = null;
    function T(e, t) {
        n !== e && (e === D ? (p.stop(),
        f.start(t),
        h.els["tab-answers"].addClass("selected"),
        h.els["tab-questions"].removeClass("selected")) : e === y && (f.stop(),
        p.start(t),
        h.els["tab-answers"].removeClass("selected"),
        h.els["tab-questions"].addClass("selected")),
        n = e)
    }
    function o(c) {
        c = c || {};
        var u = ++m
          , i = $.Deferred()
          , b = $.Deferred();
        $.when(b, i).done(function(e, t) {
            var i, n, o, a, s = e.friends, e = e.users;
            try {
                if (u === m) {
                    app.balanceModel.setAttr({
                        bonusCoins1: t.bonusCoins1,
                        bonusCoins2: t.bonusCoins2
                    }),
                    h.els.loading.hide(),
                    g = s,
                    C = t.questions,
                    _ = t.viewerAnswers,
                    o = !(E = !0),
                    a = t.stars,
                    n = function() {
                        return a
                    }
                    ,
                    (i = function(e) {
                        var t = (t = h.els.balance.$balance) || (h.els.balance.$balance = h.els.balance.find("span"));
                        !o && a < e && (o = !0,
                        h.els.balance.addClass("animated"),
                        setTimeout(function() {
                            h.els.balance.removeClass("animated"),
                            o = !1
                        }, 1e3)),
                        a = e,
                        t.text(e)
                    }
                    )(t.stars);
                    var r = [];
                    if ($.each(C, function(e, t) {
                        $.each(t.answers, function(e, t) {
                            r.push(t)
                        })
                    }),
                    p = new app.controllers.ViralQuestionsController({
                        vp: t.vp,
                        friends: g,
                        questions: C,
                        allAnswers: r,
                        stars: t.stars,
                        serverUtc: t.utc,
                        counters: t.counters,
                        leftTimeWhenCanAnswer: t.leftTimeWhenCanAnswer,
                        canGetBalanceBonuses: t.canGetBalanceBonuses,
                        leftAnswers: t.leftAnswers,
                        $container: h.els.content,
                        $balanceEl: h.els.balance,
                        updateStars: i
                    }),
                    f = new app.controllers.ViralAnswersController({
                        viewerAnswers: _,
                        allQuestions: C,
                        allAnswers: r,
                        friends: g,
                        vkUsers: e,
                        questionsController: p,
                        canGetBalanceBonuses: t.canGetBalanceBonusesForAnswer,
                        updateStars: i,
                        $container: h.els.content,
                        $counter: h.els["answers-counter"],
                        getStars: n,
                        showQuestionsTab: function() {
                            T(y)
                        },
                        showTargetFriendAndQuestion: function(e, t) {
                            T(y, {
                                friendId: e,
                                questionId: t
                            })
                        }
                    }),
                    v.answersController = f,
                    v.questionsController = p,
                    app.info.viralDataHandled = !0,
                    app.eventBus.trigger(app.EVENTS.BONUS_COINS_UPDATED),
                    headerView.updateVisibilityOfViralTab(),
                    0 === s.length)
                        return void (w && dialogController.fadePopup({
                            message: "У вас нет друзей",
                            duration: 3e3
                        }));
                    for (var l = !1, d = 0; d < C.length; d += 1)
                        if (!C[d].deactivated) {
                            l = !0;
                            break
                        }
                    if (app.eventBus.trigger(app.EVENTS.CAN_GET_BALANCE_BONUS_IN_VIRAL_GAME, {
                        canGetBonus: t.canGetBalanceBonuses
                    }),
                    app.eventBus.trigger(app.EVENTS.CAN_GET_BALANCE_BONUS_IN_VIRAL_GAME_FOR_OPEN_VIRAL_ANSWER, {
                        canGetBonus: t.canGetBalanceBonusesForAnswer
                    }),
                    !l)
                        return w && dialogController.fadePopup({
                            message: "Нет даннных",
                            duration: 3e3
                        }),
                        void (T = $.noop);
                    0 !== _.length && c.showAnswers ? T(D) : T(y)
                }
            } catch (e) {
                console.error(e)
            }
        }).fail(function(e) {
            u === m && h.els.loading.hide(),
            w && dialogController.fadePopup({
                message: "Не удалось загрузить данные",
                duration: 3e3
            })
        });
        function n(s, m) {
            var e = util.collectArrayInObjectByProperty(s, "v")
              , t = util.getKeys(e).chunks(900)
              , v = !1
              , h = {
                users: [],
                friends: []
            }
              , g = function() {
                var e, i, a;
                t.length || !v ? (t.length ? (e = t[t.length - 1],
                --t.length) : e = [],
                i = 0,
                (a = function(e) {
                    app.services.vk.getFriendsAndUsersForViralGame(e, function(e, t) {
                        if (e)
                            4 == i++ ? b.reject(e) : a(s, m),
                            GA("Viral", "getFriendsAndUsersForViralGame", errorHandler.getFullMessage(e));
                        else {
                            v = !0;
                            try {
                                var r = []
                                  , n = []
                                  , o = util.collectArrayInObjectByProperty(t.users_dat, "id")
                                  , l = util.collectArrayInObjectByProperty(t.friends_gen.items, "id")
                                  , d = util.collectArrayInObjectByProperty(t.friends_dat.items, "id")
                                  , c = util.collectArrayInObjectByProperty(t.friends_acc.items, "id")
                                  , u = util.collectArrayInObjectByProperty(t.friends_ins.items, "id")
                                  , p = util.collectArrayInObjectByProperty(t.friends_abl.items, "id");
                                try {
                                    var f = {};
                                    t.members1 && t.members1.items && t.members1.items.length && $.extend(f, util.collectArrayInObjectByProperty(t.members1.items)),
                                    t.members2 && t.members2.items && t.members2.items.length && $.extend(f, util.collectArrayInObjectByProperty(t.members2.items))
                                } catch (e) {
                                    f = {},
                                    GA.trackJSException(e, "viral.handleGroupMembers")
                                }
                                m.each(function(e, t) {
                                    delete f[t]
                                }),
                                $.each(t.users_nom, function(e, t) {
                                    var i = o[t.id];
                                    i && (t.first_name_dat = i.first_name,
                                    t.last_name_dat = i.last_name),
                                    n.push(t)
                                }),
                                $.each(t.friends_nom.items, function(e, t) {
                                    var i, n, o, a, s;
                                    t.deactivated || (i = l[t.id],
                                    n = d[t.id],
                                    o = c[t.id],
                                    a = u[t.id],
                                    s = p[t.id],
                                    i && n && o && a && s && (t.first_name_gen = i.first_name,
                                    t.last_name_gen = i.last_name,
                                    t.first_name_dat = n.first_name,
                                    t.last_name_dat = n.last_name,
                                    t.first_name_acc = o.first_name,
                                    t.last_name_acc = o.last_name,
                                    t.first_name_ins = a.first_name,
                                    t.last_name_ins = a.last_name,
                                    t.first_name_abl = s.first_name,
                                    t.last_name_abl = s.last_name,
                                    t.isMemberOfDevClub = !!f[t.id],
                                    r.push(t)))
                                }),
                                util.insertArrayAt(h.users, h.users.length, n),
                                util.insertArrayAt(h.friends, h.friends.length, r),
                                g()
                            } catch (e) {
                                b.reject(e),
                                GA.trackJSException(e, "viral.handleVkResponse")
                            }
                        }
                    })
                }
                )(e)) : setTimeout(function() {
                    b.resolve(h)
                }, 100)
            };
            g()
        }
        var o = api.viral.getViralData({}, function(e, t) {
            e ? e.code !== Codes.CACHE_LOCK_TIMEOUT ? i.reject(e) : setTimeout(function() {
                o.send()
            }, 1e3) : (i.resolve(t),
            n(t.viewerAnswers, t.whiteListUids || []))
        });
        e.initialData,
        o.send()
    }
    this.canShowTab = function() {
        return !1
    }
    ,
    h.on("show-tab:" + t, function(e) {
        "questions" === e.extraData.tabName ? T(y) : T(D)
    }),
    this.start = function(e) {
        app.eventBus.trigger(app.EVENTS.NUMBER_OF_CLOSED_VIRAL_ANSWERS_CHANGED, {
            count: 0
        }),
        e = e || {},
        $appLoader.remove(),
        w = !0,
        $contextArea.append(h.el),
        h.model || h.setModel({}),
        E ? e.showAnswers && T(D) : o(e),
        cAnal.trackEvent({
            viralTabComing: 1
        }),
        i = !0
    }
    ,
    this.stop = function() {
        m++,
        w = !1,
        f && app.eventBus.trigger(app.EVENTS.NUMBER_OF_CLOSED_VIRAL_ANSWERS_CHANGED, {
            count: f.calcLockedAnswers()
        }),
        h.el.detach()
    }
    ,
    this.fetchData = o,
    this.dataIsFetched = function() {
        return E
    }
    ,
    this.canAnswer = function() {
        return E && !i && p.canAnswer()
    }
}
,
app.controllers.ViralQuestionsController = function(e) {
    var c, u, t = e.$container, p = !1, d = !1, i = "viral-questions-v2", f = lilo.createView(i), n = CDN_PREFIX + "camera.jpg", s = app.info.age, m = util.collectArrayInObjectByProperty(e.allAnswers, "_id"), v = util.getCdnPath() + "res/sounds/throw_star.mp3", o = util.getCdnPath() + "res/sounds/0024_success_cue_04.mp3", h = {
        vp: e.vp,
        pending: !1,
        friendAvatar: n,
        questionText: "",
        bonusPerProgress: 5,
        leftAnswers: e.leftAnswers,
        progress: 0,
        realProgress: 0,
        stars: e.stars,
        realStars: e.stars,
        canGetBalanceBonuses: e.canGetBalanceBonuses,
        answers: [],
        firstAnswerUrl: n,
        secondAnswerUrl: n,
        thirdAnswerUrl: n,
        hasFriends: !0,
        firstAnswerId: null,
        secondAnswerId: null,
        thirdAnswerId: null
    }, r = function(e) {
        return !1
    }, g = function() {
        var e = expController.getCurrentLevel()
          , e = 1 === e ? "1" : 2 <= e && e <= 5 ? "2" : 6 <= e && e <= 10 ? "3" : 11 <= e && e <= 20 ? "4" : 21 <= e && e <= 30 ? "5" : "6";
        return e
    }, b = (r(app.info.viewer_id),
    new app.controllers.SoundController);
    f.setModel(h);
    var n = function() {
        app.eventBus.trigger(app.EVENTS.BONUS_COINS_UPDATED)
    };
    this.getMaxBonusCoins = function() {
        return Math.min(h.hasFriends ? h.leftAnswers : 0, app.balanceModel.bonusCoins1)
    }
    ,
    h.onChange("leftAnswers", n),
    h.onChange("hasFriends", n),
    n();
    var a, l, C, _, w, E, y, D = (l = !1,
    _ = C = -1,
    w = util.formatMillisToTime,
    E = !1,
    y = function() {
        clearTimeout(a),
        (_ -= 1e3) < 0 && (_ = 0),
        f.els["left-time-when-can-answer"].text(w(_, T)),
        _ <= 0 ? setTimeout(S, 1e3) : a = setTimeout(y, 1e3)
    }
    ,
    {
        refresh: function() {
            l && S()
        },
        isActive: function() {
            return l
        },
        pause: function() {
            l && (clearTimeout(a),
            C = util.currentMillis()),
            0
        },
        resume: function() {
            var e;
            l && !E && (e = util.currentMillis() - C,
            _ -= e,
            y()),
            0
        },
        start: function(e) {
            0 <= (e = isNaN(e) ? -1 : e) && (l = !0,
            _ = e += 1e3,
            e = h.vp < 4 && 6e5 < e && A(10),
            f.els.extend[e ? "show" : "hide"](),
            f.els["lock-overlay"].show(),
            f.els["question-text"].css("visibility", "hidden"),
            y(),
            p || this.pause())
        }
    });
    function T(e, t, i) {
        return e + ":" + t + ":" + i
    }
    function S() {
        E = !0,
        api.viral.getLeftTimeWhenCanAnswer({}, function(e, t) {
            var i;
            E = !1,
            e ? dialogController.fadePopup("Не удалось выполнить запрос") : (0 <= (i = t.leftTime) ? setTimeout(function() {
                D.start(i)
            }, 1e3) : (f.els["lock-overlay"].hide(),
            f.els["question-text"].css("visibility", ""),
            l = !1),
            h.setAttr({
                leftAnswers: t.leftAnswers,
                vp: t.vp
            }))
        }).send()
    }
    function A(e) {
        if (e = e || 1,
        h.hasFriends)
            for (var t = 0, i = 0; i < R.length; i += 1)
                for (var n = 0; n < N.length; n += 1)
                    if (R[i].canAnswer(N[n])) {
                        if (++t === e)
                            return !0;
                        break
                    }
        return !1
    }
    function I(e, t, i, n, o) {
        this._utcOfLastAnswer = (t = t || {}).t || i,
        delete t.t,
        this.friend = e,
        this.friend.sex = this.friend.sex || 1,
        this.friend.age = o,
        this._counters = t,
        this._isAppUser = n,
        this._answersCount = util.getKeys(t).length,
        this.hasManyWallPosts = !1
    }
    function M() {
        e.updateStars(h.stars)
    }
    $.extend(I.prototype, {
        ONE_WEEK: 6048e5,
        onAnswerCreate: function(e) {
            this._answersCount++,
            this._counters[e] = !0,
            this._utcOfLastAnswer = util.currentUtcMillis()
        },
        _questionIsSuitable: function(e) {
            return (0 === e.sex || e.sex === this.friend.sex) && (0 === e.ageGroup || (1 === e.ageGroup && s < 18 && this.friend.age < 18 || 3 === e.ageGroup && 34 < s && 34 < this.friend.age || 2 === e.ageGroup && 0 < s && 0 < this.friend.age))
        },
        canAnswer: function(e) {
            if (this.hasManyWallPosts || !this._questionIsSuitable(e))
                return !1;
            e = e._id;
            if (this._counters[e])
                return !1;
            e = this._isAppUser ? 3 : 5;
            return this._answersCount < e || util.currentUtcMillis() - this._utcOfLastAnswer > this.ONE_WEEK
        }
    }),
    M(),
    h.onChange("stars", M);
    var O, x, R = function(e, n) {
        n = n || {};
        var o = util.currentUtcMillis()
          , a = util.collectArrayInObjectByProperty(socialApi.getAppUsersUids())
          , s = [];
        return $.each(e, function(e, t) {
            var i = util.parseBDateString(t.bdate, 14, 50, 16);
            !r(t.id) && t.isMemberOfDevClub || s.push(new I(t,n[t.id],o,!!a[t.id],i))
        }),
        window.viralFriends = s
    }(e.friends, e.counters), k = function(e) {
        for (var t = 0; t < R.length; t += 1)
            if (R[t] === e)
                return void R.splice(t, 1)
    }, P = [], N = (n = (n = util.cloneArray(e.questions)).filter(function(e) {
        return !e.deactivated
    }),
    n = util.shuffleArray(n)), U = [];
    function L(a, s) {
        var o = []
          , r = 0;
        $.each(a, function(e, t) {
            var i = [];
            $.each(t, function(e, t) {
                i.push(t.friend.id)
            });
            var n = EXECUTE_STRINGS.getLast10WallPosts(i);
            o.push(["execute", {
                code: n
            }, function(o) {
                o.response && $.each(t, function(e, t) {
                    var i, n = o.response[t.friend.id];
                    n && (t.hasManyWallPosts = (i = 0,
                    (n = n) && n.items && $.each(n.items, function(e, t) {
                        t && "post" === t.post_type && t.text && t.text.contains("vk.com/love1v#a") && i++
                    }),
                    3 <= i))
                }),
                ++r === a.length && setTimeout(s, 400)
            }
            , "5.120"])
        }),
        VKApi(o)
    }
    function F() {
        if (0 === P.length) {
            if (0 === R.length)
                return null;
            P = util.cloneArray(R).reverse()
        }
        var e = P[P.length - 1];
        return P.length = P.length - 1,
        e
    }
    function V() {
        var e = (U = 0 === U.length ? util.cloneArray(N) : U)[U.length - 1];
        return U.length = U.length - 1,
        e
    }
    function B(i, e) {
        c = i,
        u = e,
        (t = util.cloneArray(e.answers).filter(function(e) {
            return !e.deactivated
        })).sort(function(e, t) {
            return e._id > t._id ? 1 : -1
        });
        var t = t.slice(0, 3)
          , n = ["first_name", "first_name_gen", "first_name_dat", "first_name_acc", "first_name_ins", "first_name_abl"]
          , o = {};
        $.each(n, function(e, t) {
            o[t] = i.friend[t],
            i.friend[t] = "<span style='color:#557FFF'>" + i.friend[t] + "</span>"
        }),
        i.friend.from_sex = app.info.sex;
        e = util.parseViralQuestionText(e.text, i.friend);
        $.each(n, function(e, t) {
            i.friend[t] = o[t]
        }),
        h.setAttr({
            friendAvatar: i.friend.photo_100,
            questionText: e,
            firstAnswerUrl: t[0].img,
            secondAnswerUrl: t[1].img,
            thirdAnswerUrl: t[2].img,
            firstAnswerId: t[0]._id,
            secondAnswerId: t[1]._id,
            thirdAnswerId: t[2]._id,
            pending: !1
        })
    }
    function G(e) {
        e = (e = d ? {} : e) || {};
        var t, i = function() {
            for (var e = null, t = null, i = R.length - 1; 0 <= i; ) {
                var n = F()
                  , o = N.length - 1;
                if (n) {
                    if (35 <= s && 35 <= n.friend.age)
                        for (; 0 <= o; ) {
                            var a = V();
                            if (3 === a.ageGroup && n.canAnswer(a)) {
                                e = a;
                                break
                            }
                            o--
                        }
                    if (!e)
                        for (o = N.length - 1; 0 <= o; ) {
                            if (a = V(),
                            n.canAnswer(a)) {
                                e = a;
                                break
                            }
                            o--
                        }
                    if (e) {
                        t = n;
                        break
                    }
                    k(n)
                }
                i--
            }
            return {
                friendWrap: t,
                question: e
            }
        }();
        i.friendWrap ? (h.setAttr({
            hasFriends: !0
        }),
        e.withAnimation ? (t = i,
        h.setAttr({
            pending: !0
        }),
        f.slideQuestionAndAnswersDown(function() {
            B(t.friendWrap, t.question),
            h.setAttr({
                pending: !0
            }),
            f.showNexFriendAvatar(function() {
                f.animateQuestionText(function() {
                    setTimeout(function() {
                        f.slideUpAnswers(function() {
                            h.setAttr({
                                pending: !1
                            })
                        })
                    }, 200)
                })
            })
        })) : (B(i.friendWrap, i.question),
        f.forceRestore())) : h.setAttr({
            hasFriends: !1
        })
    }
    function H(e) {
        h.stars + e <= h.realStars && h.setAttr({
            stars: h.stars + e
        })
    }
    function W(t, i, n, o) {
        var a, e, s, r, l;
        o = o || {},
        d ? n({
            shareSuccess: 1
        }) : (a = c.friend,
        e = m[t],
        s = "https://vk.com/love1v#a" + i,
        r = util.parseViralQuestionText(u.wallText, {
            sex: app.info.sex,
            first_name: a.first_name,
            to_sex: a.sex
        }),
        l = function(e) {
            (e = "viral_test" === app.info.hash ? {
                success: !0
            } : e).success ? n({
                success: !0
            }) : e.cancel ? o.attempts ? n({
                cancel: !0
            }) : dialogController.showMessageDialog({
                isModal: !0,
                minTopOffset: 170,
                message: "Если Вы не отправите другу ответ, то он никогда не узнает о нем и не сможет получить бонус",
                buttons: [{
                    caption: "Не отправлять",
                    className: "btn gray btn-x2",
                    handler: function() {
                        return n({
                            cancel: !0
                        }),
                        !1
                    }
                }, {
                    caption: "Отправить",
                    className: "btn green btn-x2",
                    handler: function() {
                        return W(t, i, n, {
                            attempts: 1
                        }),
                        !1
                    }
                }]
            }) : n({
                fail: !0
            })
        }
        ,
        a.can_post ? app.services.vk.wallPost({
            onComplete: function(e) {
                var t = !0;
                e.success || (e.block ? a.can_post = !1 : (e.cancel || e.error) && (t = !1)),
                l(e),
                t && ((t = {
                    viralPosts: 1
                })["viralPostsUniq" + g()] = 1,
                cAnal.trackEvent(t))
            },
            uid: a.id,
            attachment: e.attachment + "," + "{0}".format(s),
            message: r + " Узнай ответ здесь {0}".format(s)
        }) : app.services.vk.sendNotification({
            onComplete: function(e) {
                l(e)
            },
            uid: a.id,
            message: r + " Узнай ответ здесь"
        }))
    }
    O = R.chunks(20),
    x = function() {
        var e = function() {
            for (var e = []; 1 !== e.length && 0 < O.length; )
                e.push(O[O.length - 1]),
                --O.length;
            return e
        }();
        e.length && L(e, x)
    }
    ,
    O.reverse(),
    x();
    var j = !1;
    f.bind("extend-period", function(i) {
        var e;
        j || ((e = app.balanceModel.balance - 12) < 0 ? dialogController.showInsufficientlyBalanceDialog(e) : (j = !0,
        i.extraData.$btn.addClass("loading"),
        api.viral.buyExtra({}, function(e, t) {
            e ? (i.extraData.$btn.removeClass("loading"),
            j = !1,
            e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : e.code === Codes.ACCESS_DENIED ? D.refresh() : dialogController.showError(e)) : (app.balanceModel.setAttr({
                balance: t.balance,
                bonusCoins1: t.bonusCoins1,
                bonusCoins2: t.bonusCoins2
            }),
            h.setAttr({
                leftAnswers: t.leftAnswers,
                vp: h.vp + 1,
                canGetBalanceBonuses: t.canGetBalanceBonuses
            }),
            app.eventBus.trigger(app.EVENTS.CAN_GET_BALANCE_BONUS_IN_VIRAL_GAME, {
                canGetBonus: t.canGetBalanceBonuses
            }),
            app.eventBus.trigger(app.EVENTS.CAN_GET_BALANCE_BONUS_IN_VIRAL_GAME_FOR_OPEN_VIRAL_ANSWER, {
                canGetBonus: t.canGetBalanceBonusesForAnswer
            }),
            D.refresh(),
            setTimeout(function() {
                j = !1,
                i.extraData.$btn.removeClass("loading")
            }, 2e3),
            cAnal.trackEvent({
                q1: 1
            }))
        }).send()))
    }),
    f.on("answer:" + i, function(e) {
        var t, i, n, o;
        h.pending || D.isActive() ? 0 === f.els["lock-overlay"].parent().length && console.error("Verni overlay!!!") : (t = e.extraData.index,
        i = "first" === t ? h.firstAnswerId : "second" === t ? h.secondAnswerId : h.thirdAnswerId,
        n = e.extraData.pageX,
        o = e.extraData.pageY,
        api.viral.getNextAnswerId({
            target_uid: c.friend.id,
            beforeSend: function() {
                h.setAttr({
                    pending: !0
                })
            }
        }, function(e, t) {
            h.setAttr({
                pending: !1
            }),
            e ? dialogController.fadePopup("При отправке запроса произошла ошибка") : W(i, t.id, function(e) {
                !function n(o, a, s, r) {
                    var e = c.friend
                      , l = u
                      , d = util.currentMillis()
                      , t = !(!a.fail && !a.cancel);
                    api.viral.createAnswer({
                        question_id: l._id,
                        answer_id: o,
                        target_uid: e.id,
                        share: !!a.success,
                        ws: t,
                        sender_male: 2 === app.info.sex,
                        recipient_male: 2 === e.sex,
                        beforeSend: function() {
                            h.setAttr({
                                pending: !0
                            })
                        }
                    }, function(e, t) {
                        var i = util.currentMillis() - d;
                        e ? e.code !== Codes.CACHE_LOCK_TIMEOUT ? (h.setAttr({
                            pending: !1
                        }),
                        e.code === Codes.ACCESS_DENIED && t.leftTime ? (D.start(t.leftTime),
                        h.setAttr({
                            leftAnswers: t.leftAnswers
                        })) : (dialogController.fadePopup("Не удалось выполнить запрос"),
                        G())) : setTimeout(function() {
                            p ? n(o, a, s, r) : h.setAttr({
                                pending: !1
                            })
                        }, 1e3) : (app.balanceModel.setAttr({
                            bonusCoins1: t.bonusCoins1,
                            bonusCoins2: t.bonusCoins2
                        }),
                        c.onAnswerCreate(l._id),
                        app.eventBus.trigger(app.EVENTS.CAN_GET_BALANCE_BONUS_IN_VIRAL_GAME, {
                            canGetBonus: t.canGetBalanceBonuses
                        }),
                        h.setAttr({
                            vp: t.vp,
                            canGetBalanceBonuses: t.canGetBalanceBonuses,
                            leftAnswers: t.leftAnswers
                        }),
                        h.setAttr({
                            realStars: t.stars,
                            realProgress: t.progress
                        }),
                        t.balanceBonus && f.throwCoin(s, r, function() {
                            api.syncBalance(),
                            app.soundManager.play(app.soundManager.SOUND_IDS.COINS_DROP, {
                                force: 1
                            })
                        }),
                        t.starsBonus && (f.viewModel.soundEnabled && b.playSoundEffect(v, 100),
                        setTimeout(function() {
                            f.throwStar(s, r)
                        }, 400)),
                        (i = 1e3 - i) < 0 && (i = 0),
                        setTimeout(function() {
                            t.leftTime && 0 < t.leftTime ? (h.setAttr({
                                pending: !1
                            }),
                            D.start(t.leftTime)) : G({
                                withAnimation: !0
                            })
                        }, i + 200),
                        (i = {
                            viralAnswers: 1
                        })["viralAnswersUniq" + g()] = 1,
                        cAnal.trackEvent(i))
                    }).send()
                }(i, e, n, o)
            })
        }).send())
    }),
    f.on("star-collect:" + i, function() {
        var e = h.progress + 1;
        11 === e ? e = 1 : 10 === e && (f.viewModel.soundEnabled && b.playSoundEffect(o, 100),
        f.animateBonus(function() {
            H(h.bonusPerProgress),
            h.setAttr({
                progress: 0
            })
        })),
        h.setAttr({
            progress: e
        }),
        H(1)
    }),
    f.on("skip:" + i, function() {
        h.pending || D.isActive() ? 0 === f.els["lock-overlay"].parent().length && console.error("Verni overlay!!!") : G({
            withAnimation: !0
        })
    }),
    this.start = function(e) {
        e = e || {},
        p = !0,
        t.append(f.el),
        e && e.friendId ? function(e, t) {
            for (var i, n, o = R.length, a = N.length, s = 0, r = 0; s <= o; ) {
                var l = F();
                if (l.friend.id === e) {
                    i = l;
                    break
                }
                s++
            }
            if (i) {
                for (; r <= a; ) {
                    var d = V();
                    if (d._id !== t && i.canAnswer(d, i)) {
                        n = d;
                        break
                    }
                    r++
                }
                if (!n)
                    for (r = 0; r <= a; ) {
                        if (d = V(),
                        i.canAnswer(d, i)) {
                            n = d;
                            break
                        }
                        r++
                    }
            }
            i && n ? (B(i, n),
            f.forceRestore()) : G()
        }(e.friendId, e.questionId) : c || G(),
        D.resume()
    }
    ,
    this.stop = function() {
        p = !1,
        f.el.detach(),
        D.pause()
    }
    ,
    this.canShowTargetFriendAndTargetQuestion = function(e, t) {
        for (var i, n, o = 0; o < N.length; o += 1)
            if (N[o]._id === t) {
                i = N[o];
                break
            }
        if (i)
            for (o = 0; o < R.length; o += 1)
                if (R[o].friend.id === e) {
                    n = R[o];
                    break
                }
        return n && i
    }
    ,
    this.canShowTargetFriendAndOtherQuestion = function(e, t) {
        for (var i, n, o = 0; o < R.length; o += 1)
            if (R[o].friend.id === e) {
                n = R[o];
                break
            }
        if (n)
            for (var o = 0; o < N.length; o += 1)
                if (N[o]._id !== t && n.canAnswer(N[o])) {
                    i = N[o];
                    break
                }
        return n && i
    }
    ,
    this.canShowTargetFriend = function(e) {
        for (var t, i = 0; i < R.length; i += 1)
            if (R[i].friend.id === e) {
                t = R[i];
                break
            }
        if (t)
            for (var i = 0; i < N.length; i += 1)
                if (t.canAnswer(N[i]))
                    return !0;
        return !1
    }
    ,
    this.canAnswer = function() {
        if (D.isActive())
            return !1;
        if (!h.hasFriends)
            return !1;
        for (var e = 0; e < R.length; e += 1)
            for (var t = 0; t < N.length; t += 1)
                if (R[e].canAnswer(N[t]))
                    return !0;
        return !1
    }
    ,
    this.hasFriendsForAnswers = A,
    this.getFriendsSize = function() {
        return R.length
    }
    ,
    app.eventBus.on(app.EVENTS.CAN_GET_BALANCE_BONUS_IN_VIRAL_GAME, function(e) {
        h.setAttr({
            canGetBalanceBonuses: e.canGetBonus
        })
    }),
    D.start(e.leftTimeWhenCanAnswer)
}
,
app.controllers.ViralAnswersController = function(a) {
    function e(e) {
        e = e || 12;
        for (var t = 0; p < u.items.length && t < e; p += 1) {
            var i = u.items[p];
            u.viewItems.add(i),
            t += 1
        }
    }
    var t, s = 10, i = "item-viral-users-answer-v2", n = lilo.createView("viral-answers-v2"), o = util.collectArrayInObjectByProperty(a.friends, "id"), r = util.collectArrayInObjectByProperty(a.vkUsers, "id"), l = util.collectArrayInObjectByProperty(a.allAnswers, "_id"), d = util.collectArrayInObjectByProperty(a.allQuestions, "_id"), c = !1, u = {
        items: [],
        viewItems: []
    }, p = 0, f = a.canGetBalanceBonuses;
    function m() {
        return f
    }
    function v(e) {
        var t = d[e.q]
          , e = o[e.v];
        return t && e && !e.deactivated && !t.deactivated
    }
    function h(e) {
        var t = l[e.a]
          , i = r[e.v]
          , n = d[e.q];
        this.__raw = e,
        this.id = e._id,
        this.isLocked = e.l,
        this.friendAvatar = i.photo_100,
        this.friendFullName = i.first_name + " " + i.last_name,
        this.friendFirstNameDat = i.first_name_dat || i.first_name,
        this.text = util.parseViralQuestionText(n.wallText, {
            first_name: app.info.first_name,
            to_sex: e.y ? 2 : 1,
            sex: e.x ? 2 : 1
        }),
        this.img = t.img,
        this.blurImg = t.blurImg,
        this.canOpen = this.isLocked,
        this.canGetBonus = this.canOpen && m(e.v),
        this.canForward = !1,
        this.ts = e.t,
        this.isLocked || (this.canForward = v(e))
    }
    function g(e) {
        var t = Math.abs(a.getStars() - s);
        dialogController.showMessageDialog({
            message: "Не хватает <b>{0}</b> {1}, чтобы открыть ответ. Отвечайте на вопросы про друзей, чтобы заработать {1}".format(t, "<i class='star-icon-el'></i>"),
            buttons: [{
                caption: "Отвечать",
                className: "btn green",
                handler: function() {
                    return v(e.__raw) ? a.showTargetFriendAndQuestion(e.__raw.v, e.__raw.q) : a.showQuestionsTab(),
                    !1
                }
            }]
        })
    }
    function b(i) {
        i = i || Number.MAX_VALUE;
        var n = 0;
        return $.each(u.items, function(e, t) {
            if (t.isLocked && i === n++)
                return !1
        }),
        n
    }
    function C() {
        $.each(u.items, function(e, t) {
            t.__raw.v;
            t.setAttr({
                canGetBonus: t.isLocked && f
            })
        })
    }
    function _() {
        var e = b();
        0 === e ? a.$counter.hide() : a.$counter.text(100 <= e ? "99+" : e).css("display", "inline-block"),
        app.eventBus.trigger(app.EVENTS.BONUS_COINS_UPDATED)
    }
    n.setModel(u),
    (t = (h.fromArray = function(e) {
        var n = [];
        return $.each(e, function(e, t) {
            try {
                var i = new h(t);
                n.push(i)
            } catch (e) {}
        }),
        n
    }
    )(a.viewerAnswers)).sort(function(e, t) {
        return e.isLocked === t.isLocked ? e.ts > t.ts ? -1 : 1 : e.isLocked ? -1 : 1
    }),
    u.items.add(t),
    _(),
    window.showNotEnoughStarsDialog = g,
    n.on("forward-answer:" + i, function(e) {
        e = e.extraData.model;
        a.questionsController.canShowTargetFriendAndOtherQuestion(e.__raw.v, e.__raw.q) ? a.showTargetFriendAndQuestion(e.__raw.v, e.__raw.q) : (e = (e = o[e.__raw.v]) ? "Вы уже ответил {0} на доступные вопросы".format(e.first_name_dat) : "Вы уже ответили на доступные вопросы",
        dialogController.fadePopup(e))
    }),
    n.on("open:" + i, function(e) {
        var i = e.extraData.model
          , n = e.extraData.view
          , o = e.extraData.$el;
        a.getStars() - s < 0 ? g(i) : i.__lockIsAnimated || (o.addClass("loading"),
        api.viral.openAnswer({
            id: i.id
        }, function(e, t) {
            o.removeClass("loading"),
            e ? e.code === Codes.NOT_ENOUGH_BALANCE ? (a.updateStars(t.stars),
            g(i)) : dialogController.fadePopup("Не удалось выполнить запрос") : (app.eventBus.trigger(app.EVENTS.CAN_GET_BALANCE_BONUS_IN_VIRAL_GAME_FOR_OPEN_VIRAL_ANSWER, {
                canGetBonus: t.canGetBalanceBonusesForAnswer
            }),
            a.updateStars(t.stars),
            app.balanceModel.setAttr({
                bonusCoins1: t.bonusCoins1,
                bonusCoins2: t.bonusCoins2
            }),
            i.__lockIsAnimated = !0,
            n.animateUnlock(function() {
                t.balance && (t.balance > app.balanceModel.balance && app.soundManager.play(app.soundManager.SOUND_IDS.COINS_DROP, {
                    force: 1
                }),
                app.balanceModel.setAttr({
                    balance: t.balance
                })),
                i.setAttr({
                    canForward: v(i.__raw),
                    canOpen: !1,
                    isLocked: !1,
                    canGetBonus: !1
                }),
                _(),
                C()
            }))
        }).send(util.random(100, 300)))
    }),
    n.bind("load-more", function() {
        e()
    }),
    this.getMaxBonusCoins = function() {
        return Math.min(3 * b(3), app.balanceModel.bonusCoins2)
    }
    ,
    this.start = function() {
        a.$container.append(n.el),
        c || (c = !0,
        e(99))
    }
    ,
    this.stop = function() {
        n.el.detach()
    }
    ,
    this.calcLockedAnswers = b,
    app.eventBus.on(app.EVENTS.CAN_GET_BALANCE_BONUS_IN_VIRAL_GAME_FOR_OPEN_VIRAL_ANSWER, function(e) {
        f !== (f = e.canGetBonus) && C()
    })
}
,
app.controllers.ExchangeFriendsController = function(e) {
    var f = []
      , o = (e.headerView,
    null)
      , m = !0
      , v = !1
      , h = "item-friend-deposit"
      , g = "item-user-in-deposits-top-list";
    function b(e) {
        this.id = e.id || e._id,
        this.ownerId = e.ownerId,
        this.price = 10,
        this.updated = e.updated,
        this.lastProcessedExp = e.lastProcessedExp,
        this.extraBonus = e.extraBonus,
        this.age = e.age,
        this.sex = e.sex,
        this.exp = e.exp,
        this.fn = e.fn,
        this.p100 = e.p100,
        this.exp2d = e.exp2d || 0,
        this.firstName = this.fn + " " + this.age,
        this.vf = !!e.vf,
        this.gain = 0,
        this.sum = e.sum,
        this.expProgress = 0,
        this.estimatedTs = e.estimatedTs || e.estimatedTimeOfEnd,
        this.leftMillis = 0,
        this.isEmptyAndAllowable = !1,
        this.isLocked = !1,
        this.minLevel = 0,
        this.nextOwnerId = e.nextOwnerId,
        this.pending = !1,
        this.isFriend = f.contains(this.id),
        this.isPre = this.ownerId !== app.info.viewer_id
    }
    b.fromDBObject = function(e) {
        var t = e.exp2Days || 0;
        return new b({
            _id: e._id,
            ownerId: e.o,
            price: e.p,
            created: e.c,
            updated: e.u,
            lastProcessedExp: e.e,
            extraBonus: e.b,
            nextOwnerId: e.n,
            age: e.age,
            sex: e.sex,
            exp: e.exp,
            p100: e.p100,
            fn: e.fn,
            sum: e.s,
            vf: e.vf,
            estimatedTs: e.t,
            exp2d: t
        })
    }
    ,
    $.extend(b.prototype, {
        calcLeftTime: function() {
            var e = this.estimatedTs - util.serverUtc()
              , e = Math.max(0, e);
            this.setAttr({
                leftMillis: e
            })
        },
        calcData: function() {
            var e = this.exp - this.lastProcessedExp;
            e < 0 && (e = 0);
            var t = Constants.FRIENDS_EXCHANGE_EXP_RATE
              , i = Math.floor(e / t)
              , t = {
                gain: this.sum,
                expProgress: e - i * t
            };
            this.__isObservable ? this.setAttr(t) : $.extend(this, t)
        }
    });
    var C = {
        1: 10,
        2: 10,
        3: 10,
        4: 10,
        5: 20,
        6: 30,
        7: 35,
        8: 40,
        9: 50,
        10: 60
    }
      , _ = [10, 10, 10, 10, 20, 30, 35, 40, 50, 60];
    var w = null
      , E = null
      , y = !0
      , D = null
      , T = null;
    this.start = function(e) {
        if (e = e || {},
        v = !0,
        socialApi.setAppWidth(800),
        w)
            return e.openDeposits && D.selectTab(0),
            $contextArea.append(w.el),
            0 === D.getIndexOfSelectedTab() ? (E(),
            app.__exchangeFriendsIsOpen = !0) : e.openDeposits || D.selectTab(1),
            clearInterval(T),
            void (T = setInterval(p, 1e3));
        var s = lilo.createView("exchange-friends-view")
          , r = null
          , t = "friendDepositsListLoaded"
          , l = {
            __millisOfSetServerUtc: 0,
            sUtc: 0,
            items: [],
            topBy15Minutes: [],
            topByHour: [],
            topBy3Hours: [],
            maxDepositsSize: 0,
            pending: !1,
            getServerUtc: function() {
                var e = util.currentMillis() - this.__millisOfSetServerUtc;
                return this.sUtc + e
            }
        };
        function d(i) {
            var n = !1;
            return r && r.each(function(e, t) {
                if (t.id === i)
                    return !(n = !0)
            }),
            n
        }
        function c() {
            [l.topBy15Minutes, l.topByHour, l.topBy3Hours].each(function(e, t) {
                t.each(function(e, t) {
                    var i = t._id
                      , n = !1
                      , o = f.contains(i)
                      , a = !1
                      , n = i === app.info.viewer_id || d(i) ? !(a = !0) : o ? a = !1 : (a = !1,
                    !(0 < t.leftMillis));
                    t.setAttr({
                        disablePurchase: a,
                        canPurchase: n
                    })
                })
            })
        }
        function u(o) {
            (o = o || {}).silence || (l.topBy15Minutes.removeAll(),
            l.topByHour.removeAll(),
            l.topBy3Hours.removeAll(),
            s.els.loader.html("Загрузка списка игроков...").show()),
            api.exchangeFriends.getTopList({}, function(e, a) {
                var t, i, n;
                o.silence && !m || (s.els.loader.hide(),
                v && ($appLoader.remove(),
                e ? o.silence || (e.code === Codes.CACHE_LOCK_TIMEOUT ? (s.els.loader.show(),
                setTimeout(function() {
                    v && u()
                }, 1e3)) : dialogController.showError(e)) : (f = a.haremUids,
                i = function(e, n, o) {
                    return e.each(function(e, t) {
                        t.expDelta = t[n] || 0,
                        t.sum = t.sum || 0;
                        var i = t.age || "";
                        t.depositsDisabled = !!t.dd,
                        t.fullName = t.fn + " " + i,
                        t.potentialGain = Math.floor(t.expDelta / Constants.FRIENDS_EXCHANGE_EXP_RATE),
                        t.viewerIsOwner = d(t._id),
                        t.price = util.calcPriceOfDeposit(o, t),
                        t.canPurchase = !1,
                        t.disablePurchase = t.viewerIsOwner,
                        t.pending = !1,
                        t.estimatedTs = t.t || 0,
                        t.leftMillis = 0,
                        t.calcLeftTime = function() {
                            b.prototype.calcLeftTime.call(t),
                            this.setAttr({
                                viewerIsOwner: d(t._id)
                            }),
                            !this.viewerIsOwner && t._id !== app.info.viewer_id && (!this.leftMillis || t._id === app.info.viewer_id || a.haremUids.contains(this._id)) ? this.setAttr({
                                canPurchase: !0
                            }) : this.setAttr({
                                canPurchase: !1
                            })
                        }
                    }),
                    e
                }
                ,
                o.silence && (l.topBy15Minutes.removeAll(),
                l.topByHour.removeAll(),
                l.topBy3Hours.removeAll()),
                t = i(a.by15Minutes, "by15Minutes", a.utc),
                e = i(a.byHour, "byHour", a.utc),
                i = i(a.by3Hours, "by3Hours", a.utc),
                isMobi && (n = Math.max(i.length, e.length, i.length),
                [t, e, i].each(function(e, t) {
                    t.each(function(e, t) {
                        t.exists = !!t.potentialGain
                    });
                    for (e = t.length; e < n; e += 1)
                        t.push({
                            exists: !1,
                            calcLeftTime: $.noop,
                            disablePurchase: 1,
                            canPurchase: !1
                        })
                })),
                l.topBy15Minutes.add(t),
                l.topByHour.add(e),
                l.topBy3Hours.add(i),
                p(),
                c())))
            }).send()
        }
        function i() {
            l.items.removeAll(),
            s.els.loader.html("Загрузка активов...").show(),
            api.exchangeFriends.getDeposits({}, function(e, t) {
                s.els.loader.hide(),
                v && ($appLoader.remove(),
                e ? dialogController.showError(e) : n(t))
            }).send(util.random(100, 300))
        }
        function n(e) {
            var i;
            e.haremUids && (f = e.haremUids),
            l.sUtc < e.serverUtc && (l.setAttr({
                sUtc: e.serverUtc
            }),
            i = [],
            e.dbObjects.each(function(e, t) {
                t = b.fromDBObject(t);
                i.push(t)
            }),
            l.setAttr({
                maxDepositsSize: e.maxDeposits
            }),
            a(i),
            util.cache.save(t, 1, 864e5))
        }
        function a(i) {
            (r = i).sort(function(e, t) {
                return e.updated > t.updated ? -1 : 1
            });
            var n, o, e = expController.getCurrentLevel(), a = (n = e,
            o = 0,
            _.each(function(e, t) {
                return t <= n && void o++
            }),
            o), a = Math.max(a, l.maxDepositsSize), s = [];
            util.repeat(10, function(e) {
                var t;
                i[e] ? (t = i[e]).calcData() : (t = new b({}),
                e < a ? t.isEmptyAndAllowable = !0 : (t.isLocked = !0,
                t.minLevel = C[e + 1])),
                s.push(t)
            }),
            l.items.removeAll(),
            l.items.add(s),
            p()
        }
        function p() {
            function e(e, t) {
                t.calcLeftTime()
            }
            var t = w.model;
            t.items.each(e),
            t.topBy15Minutes.each(e),
            t.topByHour.each(e),
            t.topBy3Hours.each(e)
        }
        util.cache.remove(t),
        util.cache.remove("friendDepositsTopListLoaded"),
        s.setModel(l),
        l.onChange("sUtc", function() {
            l.__millisOfSetServerUtc = util.currentMillis(),
            l.sUtc
        }),
        D = new app.sdk.TabViewController({
            $container: s.els["tabs-block"],
            tabs: [{
                selected: !0,
                title: "Управление{0}активами".format(isMobi ? "<br>" : "&nbsp;"),
                onOpen: function() {
                    setTimeout(function() {
                        v && 0 === D.getIndexOfSelectedTab() && (app.__exchangeFriendsIsOpen = !0)
                    }, 5e3),
                    s.els.deposits.show(),
                    r && util.cache.find(t) || i()
                },
                onClose: function() {
                    app.__exchangeFriendsIsOpen = !1,
                    s.els.deposits.hide()
                }
            }, {
                title: "Топ самых {0}активных игроков".format(isMobi ? "<br>" : ""),
                onOpen: function() {
                    s.els["top-list"].show(),
                    u(),
                    clearInterval(o),
                    m = !0,
                    o = setInterval(function() {
                        1 === D.getIndexOfSelectedTab() && m && u({
                            silence: !0
                        })
                    }, 34e3)
                },
                onClose: function() {
                    clearInterval(o),
                    s.els["top-list"].hide()
                }
            }]
        }),
        E = i,
        s.on("add-friend:" + h, function(e) {
            (e = e && e.extraData ? e.extraData : {}).withPayment ? D.selectTab(1) : new app.controllers.dialog.ExchangeFriendsAddFriend({
                currentDeposits: r,
                withPayment: e.withPayment,
                onCreateDeposit: function(e) {
                    for (var t = new b(e), i = 0; i < r.length; i += 1)
                        if (r[i].id === t.id)
                            return;
                    r.push(t),
                    a(r)
                }
            })
        }),
        s.on("extend-period:" + h, function(e) {
            var n = e.extraData.model;
            m = y = !1,
            dialogController.subscribe({
                model: {
                    title: "Продление бронирования<div class='small'>Так как это особенный для вас игрок, вам доступна возможность продления бронирования</div>",
                    descriptions: [{
                        title: "+15 минут",
                        price: 5,
                        type: 3
                    }, {
                        title: "+1 час",
                        price: 20,
                        type: 4
                    }, {
                        title: "+3 часа",
                        price: 60,
                        type: 5
                    }]
                },
                onOk: function(i) {
                    var e = app.balanceModel.balance - i.price;
                    return e < 0 ? dialogController.showInsufficientlyBalanceDialog(e) : (n.setAttr({
                        pending: !0
                    }),
                    y = !1,
                    setTimeout(function() {
                        y = !1
                    }, 0),
                    ServerApi("deposits/extend.php", {
                        id: n.id,
                        type: i.type
                    }, function(e, t) {
                        n.setAttr({
                            pending: !1
                        }),
                        setTimeout(function() {
                            y = !0
                        }, 500),
                        util.isDef(t.balance) && app.balanceModel.setAttr({
                            balance: t.balance
                        }),
                        e ? (e.code === Codes.LOTTERY_IS_ACTIVE && dialogController.lotteryIsActiveDialog(),
                        e.code === Codes.LIMIT ? dialogController.fadePopup("Нельзя продлить больше чем на 12 часов") : e.code === Codes.DEPOSITS_DISABLED ? dialogController.fadePopup("Невозможно продлить бронь, так как пользователь отключил у себя Биржу") : dialogController.showError(e)) : (n.estimatedTs = t.estimatedTs,
                        n.calcLeftTime(),
                        dialogController.fadePopup("Вы продлили бронирование на " + i.title.substr(1)),
                        cAnal.trackEvent({
                            d_s_1: i.price
                        }))
                    })),
                    !1
                }
            }).onRemove(function() {
                y = !0,
                setTimeout(function() {
                    m = !0
                }, 2e3)
            })
        }),
        s.on("delete:" + h, function(e) {
            var i, n, o = e.extraData.model;
            o.pending || (i = function(e) {
                var t = "<i class='smart-coin' style='width:16px;height: 16px;margin-left: 2px;'></i>"
                  , e = "Удалить игрока можно через {0}<br>Вы можетe удалить прямо сейчас за <b>{1}</b>{2}".format(util.formatMillisToTime(e, function(e, t, i) {
                    return e + ":" + t + ":" + i
                }), 5, t);
                dialogController.showMessageDialog({
                    message: e,
                    buttons: [{
                        caption: "Удалить за <b>{0}</b>{1}".format(5, t),
                        handler: function() {
                            if (app.balanceModel.canChange()) {
                                var e = app.balanceModel.balance - 5;
                                if (!(e < 0))
                                    return n({
                                        payment: !0
                                    }),
                                    !1;
                                dialogController.showInsufficientlyBalanceDialog(e)
                            }
                        }
                    }, {
                        mobiClose: 1,
                        caption: "Отмена",
                        handler: function() {
                            return !1
                        }
                    }]
                })
            }
            ,
            n = function(e) {
                return e = e || {},
                o.setAttr({
                    pending: !0
                }),
                api.exchangeFriends.remove({
                    target_uid: o.id,
                    payment: e.payment
                }, function(e, t) {
                    o.setAttr({
                        pending: !1
                    }),
                    util.isDef(t.balance) && app.balanceModel.setAttr({
                        balance: t.balance
                    }),
                    e ? e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : e.code === Codes.ACCESS_DENIED && t.leftTime ? i(t.leftTime) : dialogController.fadePopup("Произошла ошибка") : (dialogController.fadePopup("Игрок удален"),
                    r.each(function(e, t) {
                        if (t.id === o.id)
                            return r.splice(e, 1),
                            !1
                    }),
                    a(r),
                    o.id === app.info.viewer_id && window.selfProfileController && (selfProfileController.model.__depositInfo = null))
                }).send(util.random(100, 300)),
                !1
            }
            ,
            0 < (e = 864e5 - (l.getServerUtc() - o.updated)) ? i(e) : dialogController.confirm({
                message: "Действительно хотите удалить ?",
                onOk: function() {
                    return n(),
                    !1
                }
            }))
        }),
        s.on("unlock:" + h, function(e) {
            l.pending || dialogController.confirm({
                message: "Разблокировать за {0} <span class='smart-coin'></span> ?".format(100),
                onOk: function() {
                    if (app.balanceModel.canChange()) {
                        var e = app.balanceModel.balance - 100;
                        if (!(e < 0))
                            return l.setAttr({
                                pending: !0
                            }),
                            api.exchangeFriends.incDepositsMaxCount({}, function(e, t) {
                                l.setAttr({
                                    pending: !1
                                }),
                                t && util.isDef(t.balance) && app.balanceModel.setAttr({
                                    balance: t.balance
                                }),
                                e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : e.code === Codes.LIMIT ? dialogController.fadePopup("Вы открыли максимальное количество ячеек") : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : dialogController.showError(e) : (l.setAttr({
                                    maxDepositsSize: t.maxDepositsSize
                                }),
                                a(r))
                            }).send(),
                            !1;
                        dialogController.showInsufficientlyBalanceDialog(e)
                    }
                }
            })
        }),
        s.on("profile-click:" + h, function(e) {
            app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: e.extraData.model.id
            })
        }),
        s.on("open-profile:" + g, function(e) {
            app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: e.extraData.model._id
            })
        }),
        s.on("buy:" + g, function(e) {
            e.extraData.view;
            var n = e.extraData.model;
            if (d(n._id))
                return dialogController.fadePopup("Вы уже бронировали этого игрока"),
                void n.setAttr({
                    disablePurchase: !0
                });
            app.balanceModel.canChange() && (n.depositsDisabled ? dialogController.fadePopup("Невозможно забронировать, так как пользователь отключил у себя Биржу") : n.pending || (e = n._id === app.info.viewer_id || f.contains(n._id),
            app.sdk.viewComponents.depositsPurchase({
                onChangePendingState: function(e) {
                    n.pending = e
                },
                lock: function(e) {
                    m = !e
                },
                isFriend: e,
                targetUid: n._id,
                hasOwner: 0 < n.o,
                onError: function(e, i) {
                    try {
                        i.leftMillis && ([l.topBy15Minutes, l.topByHour, l.topBy3Hours].each(function(e, t) {
                            t.each(function(e, t) {
                                t._id === n._id && t.setAttr({
                                    estimatedTs: util.serverUtc() + i.leftMillis
                                })
                            })
                        }),
                        c())
                    } catch (e) {
                        console.info(e)
                    }
                },
                onSuccess: function(e) {
                    var t = e.deposit;
                    app.balanceModel.setAttr({
                        balance: e.balance
                    }),
                    n.setAttr({
                        disablePurchase: !0
                    }),
                    t.age = n.age,
                    t.sex = n.sex,
                    t.exp = n.exp,
                    t.fn = n.fn,
                    t.p100 = n.p100;
                    t = new b(t);
                    r.push(t),
                    a(r),
                    dialogController.fadePopup("Вы успешно забронировали игрока"),
                    c()
                }
            })))
        }),
        w = s,
        $contextArea.append(s.el),
        app.eventBus.on(app.EVENTS.ON_GET_DEPOSITS, function(e) {
            y && n(e)
        }),
        cAnal.trackEvent({
            fe_tabComing_uniq: 1
        }),
        clearInterval(T),
        T = setInterval(p, 1e3)
    }
    ,
    this.stop = function() {
        v = !1,
        app.__exchangeFriendsIsOpen = !1,
        w && w.el.detach(),
        clearInterval(T),
        clearInterval(o)
    }
    ,
    this.canStart = function() {
        return !(expController.getCurrentLevel() < 10) || (dialogController.fadePopup({
            message: "Биржа доступна с {0}го уровня".format(10),
            duration: 4e3
        }),
        !1)
    }
}
,
app.controllers.dialog.ExchangeFriendsAddFriend = function(d) {
    var c = lilo.createView("dialog-add-friend-deposit")
      , e = "item-deposit-friend"
      , u = []
      , p = {
        __appFriends: [],
        __otherFriends: [],
        withPayment: d.withPayment,
        searchResultAppFriends: [],
        searchResultOtherFriends: [],
        preloading: !0,
        pending: !1
    }
      , f = new app.sdk.SearchHandler({
        resultArray: p.searchResultAppFriends,
        initialArray: p.__appFriends,
        maxResultSize: 15,
        targetProperty: "first_name"
    })
      , m = new app.sdk.SearchHandler({
        resultArray: p.searchResultOtherFriends,
        initialArray: p.__otherFriends,
        maxResultSize: 25,
        targetProperty: "first_name"
    });
    c.setModel(p);
    var t;
    c.bind("search", function(e) {
        f.search({
            word: e.extraData.word
        }),
        m.search({
            word: e.extraData.word
        })
    }),
    dialogController.open(c, {
        dialogClass: "small-close no-padding"
    }),
    t = function(e) {
        var t, n, a, i, o, s, r, l;
        e ? (n = [],
        e.each(function(e, t) {
            t.deactivated || n.push({
                id: t.id,
                photo_100: t.photo_100,
                first_name: t.first_name,
                fullName: t.fullName,
                pending: !1
            })
        }),
        t = util.collectArrayInObjectByProperty(socialApi.getAppUsersUids()),
        n = n.filter(function(e) {
            return !t[e.id]
        }),
        a = [],
        i = function(e, t) {
            var o, i;
            e ? (o = t,
            e.each(function(e, t) {
                var i = t.o
                  , n = t.n;
                i !== app.info.viewer_id && n !== app.info.viewer_id && (n = t.exp2Days || 0,
                a.push({
                    isAppFriend: !0,
                    id: t._id,
                    photo_100: t.p100,
                    age: t.age,
                    sex: t.sex,
                    first_name: t.fn || "",
                    fullName: t.fn + " " + t.age,
                    exp2d: n,
                    exp: t.exp,
                    price: util.calcPriceOfDeposit(o, t),
                    serverUtc: o,
                    expByPeriod: n,
                    pending: !1
                }))
            }),
            p.__appFriends.length = 0,
            p.__otherFriends.length = 0,
            a.sort(function(e, t) {
                return e.expByPeriod > t.expByPeriod ? -1 : 1
            }),
            i = util.collectArrayInObjectByProperty(d.currentDeposits, "id"),
            n = (n = util.cloneArray(n)).filter(function(e) {
                return !i[e.id]
            }),
            util.insertArrayAt(p.__appFriends, 0, a),
            util.insertArrayAt(p.__otherFriends, 0, n),
            p.setAttr({
                preloading: !1
            }),
            c.appFriendsEls.css("display", 0 < a.length ? "block" : "none"),
            f.resetSearchWord(),
            m.resetSearchWord(),
            f.search({
                word: ""
            }),
            m.search({
                word: ""
            })) : dialogController.fadePopup({
                message: "Не удалось получить список друзей",
                duration: 3e3
            })
        }
        ,
        s = [],
        r = util.cloneArray(socialApi.getAppUsersUids()).chunks(900),
        (l = function() {
            var e;
            r.length ? (e = r[r.length - 1],
            147863751 === app.info.viewer_id && e.push(209139338),
            --r.length,
            api.exchangeFriends.getDepositsByUids({
                ids: e
            }, function(e, t) {
                e ? i(null, e.code) : (u = t.haremUids,
                util.insertArrayAt(s, s.length, t.friendDeposits),
                o = t.utc,
                l())
            }).send()) : i(s, o)
        }
        )()) : dialogController.fadePopup({
            message: "Не удалось загрузить список друзей",
            duration: 3e3
        })
    }
    ,
    app.socialSpecificMethods.exchangeFriends.getFriends(t);
    c.on("invite-personal:" + e, function(e) {
        var t = e.extraData.model;
        c.copyTextToBuffer({
            withoutHint: !0
        });
        var i = lilo.createView("dialog-ef-invite");
        dialogController.open(i, {
            dialogClass: "no-padding small-close"
        }),
        i.el.on("click", ".btn", function() {
            var e;
            dialogController.close(i),
            window.open((e = t.id,
            util.isOKPlatform() ? "https://ok.ru/messages/" + util.convertAppOkUIdToNativeOkUid(e) : "https://vk.com/write" + e), "_blank").focus()
        })
    }),
    c.on("add:" + e, function(e) {
        var t = e.extraData.model;
        t.pending || p.pending || app.balanceModel.canChange() && app.sdk.viewComponents.depositsPurchase({
            onChangePendingState: function(e) {
                t.setAttr({
                    pending: e
                }),
                p.setAttr({
                    pending: e
                })
            },
            isFriend: u.contains(t.id) || t.id === app.info.viewer_id,
            targetUid: t.id,
            onError: function() {},
            onSuccess: function(e) {
                e = e.deposit;
                e.age = t.age,
                e.sex = t.sex,
                e.exp = t.exp,
                e.fn = t.first_name,
                e.p100 = t.photo_100,
                e.exp2d = t.exp2d,
                d.onCreateDeposit(e),
                setTimeout(function() {
                    dialogController.close(c)
                }, 100),
                cAnal.trackEvent({
                    fe_spent: t.price
                })
            }
        })
    })
}
,
app.controllers.Emoji = function() {
    var i, e = (i = [],
    [["D83DDE04", "D83DDE01", "D83DDE0A", "D83DDE03", "D83EDD23", "D83DDE06", "D83DDE09", "D83DDE1C", "D83DDE0B", "D83EDD17", "D83DDE0D", "D83DDE0E", "D83DDE12", "D83DDE0F", "D83DDE42", "D83DDE43", "D83DDE14", "D83DDE22", "D83DDE2D", "D83DDE29", "D83DDE28", "D83DDE10", "D83DDE0C", "D83EDD24", "D83DDE07", "D83DDE30", "D83EDD27", "D83DDE32", "D83EDD22", "D83DDE33", "D83DDE37", "D83DDE02", "2764", "D83DDC8B", "D83DDE1A", "D83DDE15", "D83DDE2F", "D83DDE26", "D83DDE35", "D83DDE44", "D83EDD14", "D83DDE20", "D83DDE21", "D83DDE1D", "D83DDE34", "D83DDE18", "D83DDE17", "D83DDE19", "D83DDE1F", "D83DDE41", "2639", "D83DDE2C", "D83DDE36", "D83EDD10", "D83DDE2B", "263A", "D83DDE00", "D83DDE25", "D83DDE1B", "D83DDE16", "D83DDE24", "D83DDE23", "D83DDE27", "D83DDE11", "D83DDE05", "D83DDE2E", "D83DDE1E", "D83DDE13", "D83DDE31", "D83EDD13", "D83EDD11", "D83DDE2A", "D83EDD12", "D83EDD15", "D83EDD25", "D83EDD20", "D83DDE08", "D83DDC7F", "D83DDC7D", "D83DDC7B", "D83DDE38", "D83DDE39", "D83DDE3C", "D83DDE3D", "D83DDE3E", "D83DDE3F", "D83DDE3B", "D83DDE40", "D83DDE3A", "D83DDE48", "D83DDE49", "D83DDE4A", "D83DDCA9", "D83DDC80", "D83DDC79", "D83DDC7A"], ["D83CDF31", "D83CDF32", "D83CDF33", "D83CDF34", "D83CDF37", "D83CDF38", "D83CDF45", "D83CDF46", "D83CDF47", "D83CDF48", "D83CDF49", "D83CDF4A", "D83CDF4B", "D83CDF4C", "D83CDF4D", "D83CDF4E", "D83CDF4F", "D83CDF50", "D83CDF51", "D83DDC00", "D83DDC01", "D83DDC02", "D83DDC03", "D83DDC04", "D83DDC05", "D83DDC06", "D83DDC07", "D83DDC08", "D83DDC09", "D83DDC0A", "D83DDC0B", "D83DDC0C", "D83DDC0D", "D83DDC0E", "D83DDC0F", "D83DDC10", "D83DDC11", "D83DDC12", "D83DDC13", "D83DDC14", "D83DDC15", "D83DDC16", "D83DDC17", "D83DDC18", "D83DDC19", "D83DDC1A", "D83DDC1B", "D83DDC1C", "D83DDC1D", "D83DDC1E", "D83DDC1F", "D83DDC20", "D83DDC21", "D83DDC22", "D83DDC23", "D83DDC24", "D83DDC25", "D83DDC26", "D83DDC27", "D83DDC28", "D83DDC2A", "D83DDC2B", "D83DDC2C", "D83DDC2D", "D83DDC2E", "D83DDC2F", "D83DDC30", "D83DDC32", "D83DDC33", "D83DDC34", "D83DDC35", "D83DDC36", "D83DDC37", "D83DDC38", "D83DDC39", "D83DDC3A", "D83DDC3B", "D83DDC3C", "D83DDC3D", "D83DDC3E", "D83CDF30", "D83CDF35", "D83CDF39", "D83CDF3A", "D83CDF3B", "D83CDF3C", "D83CDF3D", "D83CDF3E", "D83CDF3F", "D83CDF40", "D83CDF41", "D83CDF42", "D83CDF43", "D83CDF44", "D83DDCA6", "D83DDCA7", "D83EDD89", "D83EDD8D", "D83EDD8F", "D83EDD8B", "D83EDD8A", "D83EDD88", "D83EDD85", "D83EDD86", "D83EDD87", "D83EDD8E", "D83EDD90", "D83EDD91", "D83EDD40", "D83EDD8C"], ["D83DDC4D", "D83DDC4E", "261D", "270C", "D83DDC4C", "D83DDD95D83CDFFB", "D83EDD18D83CDFFB", "D83DDC4F", "D83DDC4A", "D83DDCAA", "270B", "D83DDD90D83CDFFB", "D83DDD96D83CDFFB", "D83DDE4F", "D83DDE4C", "270A", "D83DDC46", "D83DDC47", "D83DDC48", "D83DDC49", "D83DDC4B", "D83DDC50", "D83EDD1ED83CDFFB", "D83EDD1D", "D83EDD19D83CDFFB", "D83EDD1BD83CDFFB", "D83EDD1CD83CDFFB", "D83DDC40", "D83DDC42", "D83DDC43", "270DD83CDFFB", "D83DDC45", "D83DDC6B", "D83DDC6C", "D83DDC6D", "D83DDC8F", "D83DDC91", "D83DDC6F", "D83DDC6A", "D83DDC70", "D83DDC66", "D83DDC67", "D83DDC68", "D83DDC69", "D83DDC71", "D83DDC6E", "D83DDC72", "D83DDC73", "D83DDC82", "D83DDC74", "D83DDC75", "D83DDC76", "D83DDC77", "D83DDC78", "D83DDC7C", "D83DDE47", "D83EDD30D83CDFFB", "D83DDC85", "D83DDC84", "D83DDC44", "D83DDC83", "D83CDF8E", "D83CDF85", "D83DDEB6", "D83DDC71200D2640FE0F", "D83DDC6E200D2640FE0F", "D83DDC77200D2640FE0F", "D83DDD75200D2640FE0F", "D83DDE47200D2640FE0F", "D83DDE4B200D2642FE0F", "D83DDE4B", "D83DDC81200D2642FE0F", "D83DDC81", "D83DDE45200D2642FE0F", "D83DDE45", "D83DDE46200D2642FE0F", "D83DDE46", "D83DDE4E200D2642FE0F", "D83DDE4E", "D83DDC86200D2642FE0F", "D83DDC86", "D83DDC87200D2642FE0F", "D83DDC87", "D83EDD37D83CDFFB200D2642FE0F", "D83EDD37D83CDFFB200D2640FE0F", "D83EDD26D83CDFFB200D2642FE0F", "D83EDD26200D2640FE0F", "D83DDE4D200D2642FE0F", "D83DDEB6200D2640FE0F", "D83EDD33D83CDFFB", "D83CDFC3200D2640FE0F", "D83DDC6F200D2642FE0F", "D83CDFCC200D2640FE0F", "D83DDC31", "D83EDD21", "D83DDD7A", "D83DDC73200D2640FE0F", "D83DDC82200D2640FE0F", "D83EDD35", "D83EDD34", "D83EDD39200D2642FE0F", "D83EDD39200D2640FE0F", "D83DDC68200D2696FE0F", "D83DDC69200D2696FE0F", "D83DDC68200D2708FE0F", "D83DDC69200D2708FE0F", "D83DDC68200DD83DDE92FE0F", "D83DDC69200DD83DDE92FE0F", "D83DDC68200DD83CDFA4FE0F", "D83DDC69200DD83CDFA4FE0F", "D83DDC68200DD83CDF93FE0F", "D83DDC69200DD83CDF93FE0F", "D83DDC68200DD83CDFEBFE0F", "D83DDC69200DD83CDFEBFE0F", "D83DDC68200DD83CDF3EFE0F", "D83DDC69200DD83CDF3EFE0F", "D83DDC68200DD83CDF73FE0F", "D83DDC69200DD83CDF73FE0F", "D83DDC68200DD83DDD27FE0F", "D83DDC69200DD83DDD27FE0F", "D83DDC68200DD83CDFEDFE0F", "D83DDC69200DD83CDFEDFE0F", "D83DDC68200DD83DDCBCFE0F", "D83DDC69200DD83DDCBCFE0F", "D83DDC68200DD83DDD2CFE0F", "D83DDC69200DD83DDD2CFE0F", "D83DDC68200DD83DDCBBFE0F", "D83DDC69200DD83DDCBBFE0F", "D83DDC68200DD83CDFA8FE0F", "D83DDC69200DD83CDFA8FE0F", "D83DDC68200DD83DDE80FE0F", "D83DDC69200DD83DDE80FE0F", "D83DDC68200D2695FE0F", "D83DDC69200D2695FE0F"], ["D83CDF52", "D83CDF53", "D83CDF54", "D83CDF55", "D83CDF56", "D83CDF57", "D83CDF5A", "D83CDF5B", "D83CDF5C", "D83CDF5D", "D83CDF5E", "D83CDF5F", "D83CDF60", "D83CDF61", "D83CDF62", "D83CDF63", "D83CDF64", "D83CDF65", "D83CDF66", "D83CDF67", "D83CDF68", "D83CDF69", "D83CDF6A", "D83CDF6B", "D83CDF6C", "D83CDF6D", "D83CDF6E", "D83CDF6F", "D83CDF70", "D83CDF71", "D83CDF72", "D83CDF73", "D83CDF74", "D83CDF75", "D83CDF76", "D83CDF77", "D83CDF78", "D83CDF79", "D83CDF7A", "D83CDF7B", "D83CDF7C", "D83EDD59", "D83EDD5D", "D83EDD5C", "D83EDD58", "D83EDD57", "D83EDD56", "D83EDD53", "D83EDD50", "D83EDD42", "D83EDD51", "D83EDD43", "D83EDD55", "D83EDD54", "D83EDD52", "D83EDD5E", "D83EDD5A", "D83EDD5B"], ["26BD", "26BE", "D83CDFAF", "D83CDFB1", "D83CDFBD", "D83CDFBE", "D83CDFBF", "D83CDFC0", "D83CDFC1", "D83CDFC2", "D83CDFC3", "D83CDFC4", "D83CDFC6", "D83CDFC7", "D83CDFC8", "D83CDFC9", "D83CDFCA", "D83DDC5F", "D83DDEA3", "D83DDEB4", "D83DDEB5", "26F3", "26EA", "D83EDD3DD83CDFFB200D2642FE0F", "D83EDD3DD83CDFFB200D2640FE0F", "D83EDD3ED83CDFFB200D2642FE0F", "D83EDD3C200D2642FE0F", "D83EDD38D83CDFFB200D2642FE0F", "D83CDFCB200D2640FE0F", "26F9200D2640FE0F", "D83CDFC4200D2640FE0F", "D83CDFCA200D2640FE0F", "D83DDEB5200D2640FE0F", "D83DDEB4200D2640FE0F", "D83EDD3A", "D83DDEF4", "D83DDEF6", "D83EDD4A", "D83EDD4B", "D83EDD45", "D83EDD41"], ["D83DDE85", "D83DDE86", "D83DDE87", "D83DDE88", "D83DDE8A", "D83DDE8C", "D83DDE8D", "D83DDE8E", "D83DDE8F", "D83DDE90", "D83DDE91", "D83DDE92", "D83DDE93", "D83DDE94", "D83DDE95", "D83DDE96", "D83DDE97", "D83DDE98", "D83DDE99", "D83DDE9A", "D83DDE9B", "D83DDE9C", "D83DDE9D", "D83DDE9E", "D83DDE9F", "D83DDEA0", "D83DDEA1", "D83DDEA4", "D83DDEA7", "D83DDEA8", "26F5", "D83DDE80", "D83DDE81", "D83DDE82", "D83DDE83", "D83DDE84", "26FD", "2708", "D83DDEF5", "D83CDFDC"], ["23F0", "23F3", "260E", "2615", "267B", "26A1", "2702", "2709", "270F", "2712", "D83CDC04", "D83CDCCF", "D83CDF02", "D83CDF1F", "D83CDF80", "D83CDF81", "D83CDF82", "D83CDF83", "D83CDF84", "D83CDF88", "D83CDF89", "D83CDF8A", "D83CDF8B", "D83CDF8C", "D83CDF8D", "D83CDF8F", "D83CDF90", "D83CDF92", "D83CDF93", "D83CDFA3", "D83CDFA4", "D83CDFA7", "D83CDFA8", "D83CDFA9", "D83CDFAA", "D83CDFAB", "D83CDFAC", "D83CDFAD", "D83CDFB0", "D83CDFB2", "D83CDFB3", "D83CDFB4", "D83CDFB7", "D83CDFB8", "D83CDFB9", "D83CDFBA", "D83CDFBB", "D83DDC51", "D83DDC52", "D83DDC53", "D83DDC54", "D83DDC55", "D83DDC56", "D83DDC57", "D83DDC58", "D83DDC59", "D83DDC5A", "D83DDC5B", "D83DDC60", "D83DDC5C", "D83DDC5D", "D83DDC5E", "D83DDC61", "D83DDC62", "D83DDC63", "D83DDC7E", "D83DDC88", "D83DDC89", "D83DDC8A", "D83DDC8C", "D83DDC8D", "D83DDC8E", "D83DDC90", "D83DDC92", "D83DDCA1", "D83DDCA3", "D83DDCA5", "D83DDCB0", "D83DDCB3", "D83DDCB4", "D83DDCB5", "D83DDCB6", "D83DDCB7", "D83DDCB8", "D83DDCBA", "D83DDCBB", "D83DDCBC", "D83DDCBD", "D83DDCBE", "D83DDCBF", "D83DDCC4", "D83DDCC5", "D83DDCC7", "D83DDCC8", "D83DDCC9", "D83DDCCA", "D83DDCCB", "D83DDCCC", "D83DDCCD", "D83DDCCE", "D83DDCD0", "D83DDCD1", "D83DDCD2", "D83DDCD3", "D83DDCD4", "D83DDCD5", "D83DDCD6", "D83DDCD7", "D83DDCD8", "D83DDCD9", "D83DDCDA", "D83DDCDC", "D83DDCDD", "D83DDCDF", "D83DDCE0", "D83DDCE1", "D83DDCE2", "D83DDCE6", "D83DDCED", "D83DDCEE", "D83DDCEF", "D83DDCF0", "D83DDCF1", "D83DDCF7", "D83DDCF9", "D83DDCFA", "D83DDCFB", "D83DDCFC", "D83DDD06", "D83DDD0E", "D83DDD11", "D83DDD14", "D83DDD16", "D83DDD26", "D83DDD27", "D83DDD28", "D83DDD29", "D83DDD2A", "D83DDD2B", "D83DDD2C", "D83DDD2D", "D83DDD2E", "D83DDD31", "D83DDDFF", "D83DDEAA", "D83DDEAC", "D83DDEBD", "D83DDEBF", "D83DDEC0", "D83EDD44", "D83EDD47", "D83EDD48", "D83EDD49", "D83DDED2"], ["D83DDC93", "D83DDC94", "D83DDC95", "D83DDC96", "D83DDC97", "D83DDC98", "D83DDC99", "D83DDC9A", "D83DDC9B", "D83DDC9C", "D83DDC9D", "D83DDC9E", "D83DDC9F", "D83DDCAC", "D83DDCAD", "D83DDD1E", "26A0", "26D4", "D83DDC29", "D83CDD98", "D83CDF1A", "D83DDDA4", "D83DDCA8", "D83DDD25", "2600", "2601", "26C4", "26C5", "2728", "D83CDF0D", "D83CDF1B", "D83CDF1D", "D83CDF1E", "2604", "D83CDF08", "D83CDF16", "2695"], ["D83CDDE8D83CDDF3", "D83CDDE9D83CDDEA", "D83CDDEAD83CDDF8", "D83CDDEBD83CDDF7", "D83CDDECD83CDDE7", "D83CDDEED83CDDF9", "D83CDDEFD83CDDF5", "D83CDDF0D83CDDF7", "D83CDDF7D83CDDFA", "D83CDDFAD83CDDF8", "D83CDDFAD83CDDE6", "D83CDDF0D83CDDFF", "D83CDDE7D83CDDFE", "D83CDDE6D83CDDFA", "D83CDDE6D83CDDF9", "D83CDDE7D83CDDEA", "D83CDDE7D83CDDF7", "D83CDDFBD83CDDF3", "D83CDDEDD83CDDF0", "D83CDDE9D83CDDF0", "D83CDDEED83CDDF1", "D83CDDEED83CDDF3", "D83CDDEED83CDDE9", "D83CDDEED83CDDEA", "D83CDDE8D83CDDE6", "D83CDDE8D83CDDF4", "D83CDDF2D83CDDF4", "D83CDDF2D83CDDFE", "D83CDDF2D83CDDFD", "D83CDDF3D83CDDF1", "D83CDDF3D83CDDFF", "D83CDDF3D83CDDF4", "D83CDDE6D83CDDEA", "D83CDDF5D83CDDF1", "D83CDDF5D83CDDF9", "D83CDDF5D83CDDF7", "D83CDDF8D83CDDE6", "D83CDDF8D83CDDEC", "D83CDDF9D83CDDF7", "D83CDDF5D83CDDED", "D83CDDEBD83CDDEE", "D83CDDE8D83CDDF1", "D83CDDE8D83CDDED", "D83CDDF8D83CDDEA", "D83CDDFFD83CDDE6", "D83CDFF3200DD83CDF08FE0F"]].each(function(e, t) {
        t.each(function(e, t) {
            i.push(t)
        })
    }),
    i), t = util.collectArrayInObjectByProperty(e), n = /:([A-Z0-9]+?):/g, o = $(document.createElement("div")), a = {
        createImgNode: function(e, t) {
            return t && t.forContentEditable ? $("<img/>").attr("src", this.getUrl(e, t)).attr("code", e).addClass("emoji")[0] : (el = document.createElement("span"),
            el.style.backgroundImage = "url(" + this.getUrl(e, t) + ")",
            el.className = "emoji",
            el.setAttribute("code", e),
            el)
        },
        createImgHtml: function(e, t) {
            t = this.createImgNode(e, t);
            return o.empty().append(t),
            o.html()
        },
        getUrl: function(e, t) {
            return "https://vk.com/" + (t && t.path ? t.path : "images/emoji/") + e + (2 <= window.devicePixelRatio || isMobi ? "_2x" : "") + ".png"
        },
        getAllHexCodes: function() {
            return {
                array: e,
                hash: t
            }
        },
        getUtf8Code: function(e) {
            return e.getAttribute("code")
        },
        utf8toChar: function(e) {
            for (var t = e.length / 4, i = "", n = 0; t--; )
                i += String.fromCharCode(parseInt(e.substr(n, 4), 16)),
                n += 4;
            return i
        },
        utf16toMask: function(e) {
            return ":" + e + ":"
        },
        __replaceAllUTF8Symbols: function(e) {
            e = e.substr(1, e.length - 2);
            return " " + a.createImgHtml(e) + " "
        },
        replaceAllUTF8Symbols: function(e, t) {
            return e = (e = (e = util.escapeHtml(e, t ? t.ownerUid : null)).replace(/([\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2694-\u2697]|\uD83E[\uDD10-\uDD5D])/g, function(e) {
                e = encodeURIComponent(e).replace(/%/g, "").toLowerCase();
                return " " + a.createImgHtml(e, {
                    path: "emoji/e/"
                }) + " "
            })) && e.match(n) ? e.replace(n, this.__replaceAllUTF8Symbols).replace(/\uFE0F/g, "") : e
        },
        getCountOfEmojiMasks: function(e) {
            for (var t = 0; n.exec(e); )
                t++;
            return t
        }
    };
    return a
}(),
function() {
    function n() {
        return a in window
    }
    var o = +new Date
      , a = "cAnalytics"
      , s = []
      , r = function() {
        var e;
        s.length && (e = s[s.length - 1],
        s.length--,
        window[a].trackEvent.apply(window[a], e),
        setTimeout(r, 1e3))
    }
      , l = function(e) {
        return e
    }
      , d = util.collectArrayInObjectByProperty(["pageView", "uniqPageView", "payment", "paymentGroup16", "paymentGroup16_17", "paymentGroup18_24", "paymentGroup25_30", "paymentGroup31", "payment_coins", "payment_rubies", "firstPayment", "gifts_1", "gifts_2", "gifts_3", "gifts_4", "stcr", "p_1", "p_2", "p_3", "p_4", "pl1", "pl2"]);
    window.isExternal || (util.isOKPlatform() ? l = function(e) {
        var i = {};
        return $.each(e, function(e, t) {
            e.startWith("lv_ok_") ? i[e] = t : i["ok_" + e + (isMobi ? "Mobi" : "")] = t
        }),
        i
    }
    : isDirect && (l = function(e) {
        var i = {};
        return $.each(e, function(e, t) {
            d[e] ? i[e + "_direct"] = t : i[e] = t
        }),
        i
    }
    )),
    window.cAnal = {
        trackCommonEvent: function() {
            BOOT_DATA.testServer || n() && window[a].trackCommonEvent && window[a].trackCommonEvent.apply(window[a], arguments)
        },
        trackEvent: function() {
            if (!BOOT_DATA.testServer)
                if (n()) {
                    if (window.isExternal)
                        try {
                            var e, t = util.queryParamsToObject(), i = t.signature;
                            for (e in t)
                                t.hasOwnProperty(e) && (t[e] = t[e] + "");
                            delete t.signature,
                            window[a].initExternal({
                                app_id: "ios_application" === t.platform ? 100 : 101,
                                viewer_id: app.info.viewer_id,
                                params: t,
                                sig: i
                            })
                        } catch (e) {}
                    else if (util.isOKPlatform())
                        try {
                            window[a].initOk({
                                auth: {
                                    viewer_id: app.info.logged_user_id,
                                    ok_session_key: app.info.session_key,
                                    app_id: BOOT_DATA.app_id,
                                    ok_sig: app.info.auth_sig
                                }
                            })
                        } catch (e) {}
                    else
                        app.info.session ? window[a].init({
                            uid: app.info.viewer_id,
                            appId: app.info.mainAppId,
                            expire: app.info.session.expire,
                            secret: app.info.session.secret,
                            sid: app.info.session.sid,
                            sig: app.info.session.sig
                        }) : window[a].init({
                            uid: app.info.viewer_id,
                            appId: app.info.api_id,
                            secret: app.info.auth_key
                        });
                    arguments[0] = l(arguments[0]),
                    cAnal.trackEvent = function() {
                        arguments[0] = l(arguments[0]),
                        window[a].trackEvent.apply(window[a], arguments)
                    }
                    ,
                    window[a].trackEvent.apply(window[a], arguments),
                    setTimeout(r, 1e3)
                } else
                    +new Date < 6e4 + o ? s.push(arguments) : (cAnal.trackEvent = $.noop,
                    s.length = 0)
        }
    }
}(),
function() {
    function g(e, t, i, n, o, a) {
        a.updateFinalPosition = a.updateFinalPosition || g._defaultUpdateFinalPosition,
        this._opts = a,
        this._duration = t,
        this._onComplete = o,
        this._millisOfLastUptate = b(),
        this._millisOfLastUpdateFinalPosition = this._millisOfLastUptate,
        this._from = i,
        this._to = n;
        e = PIXI.Texture.fromImage(e);
        this._pixiSprite = new PIXI.Sprite(e),
        this._pixiSprite.anchor.x = .5,
        this._pixiSprite.anchor.y = .5,
        this._started = !0,
        this._canRemove = !1,
        this._millisOfComplete = 0,
        this._applyProgress(0)
    }
    function b() {
        return (new Date).getTime()
    }
    app.controllers.FX2 = function(e) {
        app.controllers.ExpBoosterFlameController && new app.controllers.ExpBoosterFlameController;
        var i = e.$container;
        i.width(e.width).height(e.height);
        var t, n, o, a = Math.floor(1e3 / app.info.animationFps), s = [], r = new PIXI.Container, l = [], d = window.requestAnimFrame, c = "_pixiSprite", u = "_pixiGraphics", p = isMobi ? function(e, t) {
            var i = e[t].miniMobi ? isGamePreviewVisible() : !isGamePreviewVisible();
            i !== e[t].visible && (e._pixiSprite.visible = i)
        }
        : $.noop, f = PIXI.autoDetectRenderer(e.width, e.height, {
            transparent: !0,
            antialias: !0
        }), m = new PIXI.Container, v = !1, h = function() {
            for (t = b(),
            n = s.length; n--; )
                o = s[n],
                p(o, c),
                o.update(t),
                o.isObsolete() && (s.splice(n, 1),
                m.removeChild(o[c]));
            for (n = l.length; n--; )
                o = l[n],
                p(o, u),
                o.update(t),
                o.isObsolete() && (l.splice(n, 1),
                r.removeChild(o[u]));
            a < +t && f.render(m),
            s.length || l.length ? d(h) : v = !1
        };
        i.append(f.view),
        m.addChild(r),
        isMobi && ((e = function() {
            var e = appWidth
              , t = mobiUiHelper.getRoomHeight();
            i.width(e).height(t),
            f.resize(e, t)
        }
        )(),
        mobiUiHelper.on("resize", e)),
        this.animateImage = function(e, t, i, n, o, a) {
            a = new g(e,t,i,n,o,a);
            m.addChild(a._pixiSprite),
            s.push(a),
            v || (v = !0,
            d(h))
        }
        ,
        this.animateItem = function(e, t) {
            m.addChild(e),
            s.push(t),
            v || (v = !0,
            d(h))
        }
        ,
        this.addGraphics = function(e) {
            r.addChild(e[u]),
            l.push(e),
            v || (v = !0,
            d(h))
        }
        ,
        this.getStage = function() {
            return m
        }
        ,
        this.forceRender = function() {
            f.render(m)
        }
    }
    ,
    g._defaultUpdateFinalPosition = {
        update: $.noop,
        delay: 1e7
    },
    $.extend(g.prototype, {
        _applyProgress: function(e) {
            var t, i, n, o;
            for (t in this._to)
                n = this._from[t],
                o = this._to[t],
                i = e,
                n = n,
                o = o,
                this._pixiSprite[t] = (1 - i) * n + i * o;
            this._pixiSprite.x += this._pixiSprite.width / 2,
            this._pixiSprite.y += this._pixiSprite.height / 2
        },
        _updateFinalPosition: function(e) {
            roomView.isVisible && e - this._millisOfLastUpdateFinalPosition > this._opts.updateFinalPosition.delay && (e = this._opts.updateFinalPosition.update(),
            this._to.x = e.x,
            this._to.y = e.y)
        },
        update: function(e) {
            var t;
            this._started ? (t = e - this._millisOfLastUptate,
            t = Math.min(t / this._duration, 1),
            this._updateFinalPosition(e),
            this._applyProgress(t),
            1 === t && (this._onComplete(),
            this._started = !1,
            this._millisOfComplete = e)) : 100 < e - this._millisOfComplete && (this._canRemove = !0)
        },
        isObsolete: function() {
            return this._canRemove || this._opts.isObsolete()
        }
    })
}(),
function() {
    function p(e) {
        console.info(e)
    }
    var f = {
        enabled: !1,
        unmuted: !1,
        init: function() {
            browserInfo.isChrome && util.isOKPlatform() && (f.enabled = !0,
            $body.addClass("yt-chrome-fix"))
        }
    };
    p();
    function m() {
        return window.radioModel && radioModel.type === RadioPlayerType.YOUTUBE && !radioModel.isDisabled && radioModel.hasCurrentTrack && h && (2 === h._currentState || -1 === h._currentState)
    }
    window.gapi_onload = function() {
        console.info("gapi_onload", arguments)
    }
    ;
    var e, v = "yt-player", h = {
        model: (e = {
            visible: !1,
            enabled: !1,
            hasTrack: !1
        },
        lilo.makeObservable(e),
        e),
        $container: function() {
            var e = $(document.createElement("div"));
            e.attr("id", "yt-wrapper");
            var t = document.createElement("div");
            return t.id = v,
            e.append(t),
            isMobi ? $(document.createElement("div")).addClass("yt-click-overlay").css({
                position: "absolute",
                left: "0",
                top: "0",
                width: "100%",
                height: "100%"
            }).appendTo(e) : util.isOKPlatform() && (t = $(document.createElement("div")).addClass("close-radio-btn"),
            e.append(t),
            t.click(function() {
                app.radioView.trigger("disable-radio")
            })),
            e
        }(),
        _initInProgress: !1,
        ready: !1,
        videoId: "",
        progressAsMillis: 0,
        events: {
            "-1": "(unstarted)",
            0: "(ended)",
            1: "(playing)",
            2: "(paused)",
            3: "(buffering)",
            5: "(video cued)"
        },
        _currentState: -1,
        _modCounter: 1,
        width: 260,
        height: 130,
        mobiTimer: null,
        init: function() {
            var e, t, i, n, o, a, s, r;
            function l(e) {
                console.info("onPlayerReady", e),
                h.$iframe = $("#{0}".format(v)),
                h.ready = !0,
                h.onReady();
                var t, i;
                isMobi ? ((t = function() {
                    dialogController.isDialogOpenByName("radio-view") ? (h.updatePosition(),
                    h.show(),
                    1 === dialogController.countOfOpenedDialogs() ? h.$container.css("zIndex", app.controllers.MobilePopup.hasPopup() ? "499" : "500").css("position", "fixed") : h.$container.css("zIndex", "").css("position", "")) : (h.hide(),
                    h.$container.css("zIndex", ""))
                }
                )(),
                dialogController.on("open-dialog", t),
                dialogController.on("close-dialog", t),
                dialogController.on("open-mobile-popup", t),
                dialogController.on("close-mobile-popup", t)) : (t = function() {
                    h._visible = h.model.visible,
                    h._processVisibility()
                }
                ,
                h.model.onChange("visible", t),
                h.model.onChange("hasTrack", t),
                t()),
                f.init(),
                f.enabled || (i = -1,
                [$contextArea, $dialogArea, $document, $appArea].each(function(e, t) {
                    t.on("click", function() {
                        try {
                            m() && ((e = +new Date) - i < 1500 || (i = e,
                            radioView.trigger("enable-radio")))
                        } catch (e) {}
                        var e
                    })
                }))
            }
            function d(e) {
                switch (console.info("onPlayerStateChange", h.events[e.data], e),
                p(h.events[e.data]),
                h._currentState = e.data,
                n.stop(),
                e.data) {
                case -1:
                    break;
                case 0:
                    h._onEnded();
                    break;
                case 1:
                    h._onPlay();
                    break;
                case 2:
                    var t;
                    f.enabled && !f.unmuted && h.ytPlayer.isMuted() && (h.ytPlayer.unMute(),
                    t = h._modCounter,
                    setTimeout(function() {
                        h.ytPlayer.isMuted() || (f.unmuted = !0,
                        $body.addClass("yt-hint-disabled"),
                        h._modCounter === t && 2 === h._currentState && radioModel.type === RadioPlayerType.YOUTUBE && !radioModel.isDisabled && radioModel.hasCurrentTrack && h.ytPlayer.playVideo())
                    }, 300));
                    break;
                case 3:
                    n.start()
                }
            }
            function c(e) {
                console.info("onPlayerError", e);
                try {
                    window.ytLastError = JSON.stringify(e)
                } catch (e) {}
            }
            function u(e) {
                var t = h.model;
                isMobi || (h.$container.parent()[t.visible && t.hasTrack ? "show" : "hide"](),
                h.$container[t.enabled ? "show" : "hide"]()),
                clearTimeout(r),
                r = setTimeout(function() {
                    h.updatePosition()
                }, 100)
            }
            h._initInProgress || (h._initInProgress = !0,
            197333171 === app.info.viewer_id && isDirect && IS_ANDROID,
            $("#yt-layer").addClass("yt-hidden").append(h.$container),
            (e = document.createElement("script")).src = "https://www.youtube.com/iframe_api",
            e.async = !0,
            console.info("init youtube #1"),
            t = document.getElementsByTagName("script")[0],
            console.info("init youtube #2", t),
            window.onYouTubeIframeAPIReady = function() {
                console.info("init youtube #3"),
                window.YouTubeIframeAPIReady = !0,
                i = h.ytPlayer = new YT.Player(v,{
                    height: h.height,
                    width: h.width,
                    playerVars: {
                        fs: 0,
                        autoplay: 0,
                        rel: 0,
                        version: 3,
                        origin: "*",
                        enablejsapi: 1,
                        allowfullscreen: !1,
                        wmode: "transparent",
                        cc_load_policy: 0,
                        iv_load_policy: 3,
                        modestbranding: 1,
                        disablekb: 1,
                        playsinline: isMobi || IS_IOS ? 1 : 0,
                        showinfo: 0,
                        controls: 0
                    },
                    events: {
                        onReady: l,
                        onStateChange: d,
                        onError: c
                    }
                })
            }
            ,
            t.parentNode.insertBefore(e, t),
            o = null,
            s = a = 0,
            n = {
                _reset: function() {
                    clearInterval(o)
                },
                start: function() {
                    this._reset(),
                    s = i.getVideoBytesLoaded();
                    var t = +new Date;
                    o = setInterval(function() {
                        var e;
                        s < i.getVideoBytesLoaded() ? (s = i.getVideoBytesLoaded(),
                        a = 0) : a += 1,
                        50 <= a && (h.ytPlayer.stopVideo(),
                        e = +new Date - t,
                        h.ytPlayer.seekTo(Math.floor((h._startPosition + e) / 1e3), !0))
                    }, 100)
                },
                stop: function() {
                    this._reset()
                },
                restart: function() {}
            },
            u(),
            h.model.onChange("*", u))
        },
        onErrorListener: null,
        onCompleteListener: null,
        onInit: null,
        onReady: $.noop,
        _hasTrack: !1,
        _onPlay: $.noop,
        _onError: $.noop,
        _onEnded: $.noop,
        _audioLoaded: !1,
        playMusic: function(e, t) {
            this._hasTrack && this.closeMusicStream(),
            this._currentUrl = e,
            this._startPosition = t,
            this._modCounter += 1;
            new Date;
            var i = this._modCounter;
            this._audioLoaded = !1,
            this._onPlay = function() {
                var e;
                i === h._modCounter && (h._audioLoaded = !0,
                h._modCounter === i && (h.ytPlayer.setVolume(h._volume),
                e = !1,
                (e = f.enabled ? !0 : e) || h.ytPlayer.unMute()))
            }
            ,
            this._onError = function() {
                h._modCounter === i && h.onErrorListener && h.onErrorListener()
            }
            ,
            this._onEnded = function() {
                h._modCounter === i && h.onCompleteListener && h.onCompleteListener()
            }
            ,
            this._hasTrack = !0,
            this._processVisibility(),
            this.ytPlayer.setVolume(0),
            f.enabled && f.unmuted || this.ytPlayer.mute(),
            this._startTime = +new Date,
            this.ytId = e,
            this.ytPlayer.loadVideoById({
                videoId: e,
                startSeconds: Math.floor(t / 1e3),
                suggestedQuality: "small"
            }),
            f.enabled && setTimeout(function() {
                h._modCounter !== i || radioModel.type !== RadioPlayerType.YOUTUBE || radioModel.isDisabled || !radioModel.hasCurrentTrack || -1 !== h._currentState || h.ytPlayer.isMuted() || isDirect && f.unmuted || (f.unmuted = !1,
                $body.removeClass("yt-hint-disabled"),
                h.playMusic(e, t + 1e3))
            }, 1e3)
        },
        closeMusicStream: function() {
            this._hasTrack && (this._hasTrack = !1,
            this._processVisibility(),
            this._modCounter += 1,
            this.ytPlayer.stopVideo(),
            this.ytPlayer.clearVideo())
        },
        pauseMusic: function() {
            this._hasTrack && this.ytPlayer.pauseVideo()
        },
        resumeMusic: function() {
            this._hasTrack && this.ytPlayer.playVideo()
        },
        getMusicInfo: function() {
            if (this._hasTrack && this._audioLoaded) {
                var e, t = {};
                return m() ? (e = +new Date - h._startTime,
                t.position = h._startPosition + e) : t.position = Math.round(1e3 * h.ytPlayer.getCurrentTime()),
                t
            }
            return null
        },
        setMusicVolume: function(e) {
            e = Math.min(100, 100 * e),
            this._volume = e,
            this._hasTrack && this._audioLoaded && this.ytPlayer.setVolume(e)
        },
        setMusicPosition: function() {},
        playSoundEffect: function() {},
        setSoundEffectVolume: function() {},
        getInfo: function() {
            var e = {};
            return e.screenWidth = screen.width,
            e.screenHeight = screen.height,
            e
        },
        _enabled: !1,
        _visible: !1,
        _processVisibility: function() {
            var e, t;
            isMobi ? (e = this,
            (t = function() {
                return e._visible && e._hasTrack && radioModel.hasCurrentTrack
            }
            )() ? setTimeout(function() {
                t() && e.$container.parent().removeClass("yt-hidden")
            }, window.isNewDesign ? 350 : 0) : this.$container.parent().addClass("yt-hidden")) : this._visible && this._hasTrack && radioModel.hasCurrentTrack ? this.$container.parent().show() : this.$container.parent().hide()
        },
        show: function() {
            this._visible || (this._visible = !0,
            this._processVisibility())
        },
        hide: function() {
            this._visible && (this._visible = !1,
            this._processVisibility())
        },
        transform: function(e, t, i, n) {
            var o;
            isMobi && (e = mobiUiHelper.vw2px(5),
            t = mobiUiHelper.vw2px(7.6),
            this.$container.css({
                transform: "scale(" + (o = i / 324) + "," + o + ")"
            }),
            i = 324,
            n = 188),
            this.ytPlayer.setSize(i, n),
            this.$container.width(i).height(n).css({
                left: e + "px",
                top: t + "px"
            })
        },
        $rect: null,
        setRectEl: function(e) {
            if (!e)
                throw new Error("$el is not specified!");
            this.$rect = e,
            this.updatePosition()
        },
        updatePosition: function() {
            if (this.$rect) {
                var e = this.$rect.offset()
                  , t = this.$rect.width()
                  , i = this.$rect.height();
                if (e && t && i) {
                    if (0 === e.left && 0 === e.top)
                        return !1;
                    var n = $appArea.offset();
                    return this.transform(e.left - n.left, e.top - n.top, t, i),
                    !0
                }
            }
            return !1
        }
    };
    app.youtubePlayer = h
}(),
(()=>{
    const t = Hls.isSupported();
    let s = 0
      , r = null
      , l = 1;
    let d = null;
    console.info("HSL supported", t);
    let c = "onMP3PlayerError"
      , u = $.noop
      , p = $.noop
      , f = $.noop
      , m = $.noop
      , v = $.noop;
    const h = {
        playMusic: function(o, a) {
            try {
                if (!t)
                    return void window[c]({
                        type: "EVENT",
                        msg: "hls not supported"
                    });
                d && h.closeMusicStream();
                let i = l += 1
                  , n = (new Date).getTime();
                r = document.createElement("video"),
                r.style.position = "absolute",
                r.style.width = "10px",
                r.style.height = "10px",
                r.style.top = "0",
                r.style.left = "0",
                r.style.pointerEvents = "none",
                r.style.opacity = "0",
                console.info("video.canPlayType('application/vnd.apple.mpegurl')", r.canPlayType("application/vnd.apple.mpegurl"));
                let e = document.querySelector("div");
                e.parentElement.insertBefore(r, e),
                r.volume = 0,
                r.muted = !0,
                r.__loaded = !1,
                d = new Hls,
                d.loadSource(o),
                d.attachMedia(r),
                window._video = r,
                window._hls = d,
                d.on(Hls.Events.ERROR, function(e, t) {
                    t.type,
                    t.details,
                    t.fatal;
                    console.info("hls error", e, t);
                    window[c]({
                        type: "EVENT",
                        msg: "hls error"
                    })
                }),
                d.on(Hls.Events.MEDIA_ATTACHED, function() {
                    console.info("video and hls.js are now bound together !"),
                    i === l && d.on(Hls.Events.MANIFEST_PARSED, function(e, t) {
                        console.info("manifest loaded, found " + t.levels.length + " quality level"),
                        m = function() {}
                        ,
                        u = function() {}
                        ,
                        p = function() {
                            var e;
                            i !== l || r.__loaded || (e = (new Date).getTime() - n,
                            a += e,
                            r.currentTime = Math.floor(a / 1e3),
                            r.__loaded = !0,
                            setTimeout(function() {
                                i === l && (r.muted = !1,
                                r.volume = s)
                            }, 50))
                        }
                        ,
                        f = function(e) {
                            i === l && window[c]({
                                type: "EVENT",
                                msg: e.message
                            })
                        }
                        ,
                        v = function(e) {
                            i === l && window.onMP3PlayerComplete()
                        }
                        ,
                        r.addEventListener("canplay", u, !1),
                        r.addEventListener("canplaythrough", p, !1),
                        r.addEventListener("error", f, !1),
                        r.addEventListener("load", m, !1),
                        r.addEventListener("ended", v, !1),
                        console.info("play sound url", o),
                        r.play()
                    })
                })
            } catch (e) {
                console.error(e)
            }
        },
        closeMusicStream: function() {
            l += 1,
            d && (d.destroy(),
            d = null),
            r && (r.pause(),
            r.removeEventListener("canplay", u, !1),
            r.removeEventListener("canplaythrough", p, !1),
            r.removeEventListener("error", f, !1),
            r.removeEventListener("load", m, !1),
            r.removeEventListener("ended", v, !1),
            r.src = null,
            r.parentNode && r.parentNode.removeChild(r),
            r = null)
        },
        pauseMusic: function() {
            r && r.pause()
        },
        resumeMusic: function() {
            r && r.play()
        },
        getMusicInfo: function() {
            if (r) {
                let e = {};
                return e.position = Math.round(1e3 * r.currentTime),
                e
            }
            return null
        },
        setMusicVolume: function(e) {
            s = e,
            r && (r.volume = e)
        },
        setMusicPosition: function() {},
        playSoundEffect: function(e) {},
        setSoundEffectVolume: function(e) {},
        getInfo: function() {
            var e = {};
            return e.screenWidth = screen.width,
            e.screenHeight = screen.height,
            e
        }
    };
    window.hlsPlayer = h
}
)(),
app.controllers.dialog.RoomsList = function(s) {
    var d, c, u, p, e, t, o = this, a = 2 === app.info.sex, i = isMobi ? Math.floor(mobiUiHelper.appHeight() / mobiUiHelper.vw2px(50)) : 4, f = s.roomModel, n = (s.roomView,
    "dialog-room-list"), m = lilo.createView(n), r = "roomsSort", l = {
        sortBySpent: "spent" === util.lStorage.find(r),
        sortByMessages: "messages" === util.lStorage.find(r),
        sortByTracks: "tracks" === util.lStorage.find(r),
        sortByInvites: !1,
        sortBySpecial: !1,
        selectedRoom: null,
        items: [],
        pending: !1,
        lock: !1,
        __UID: 1
    }, v = {
        currentPageIndex: 0,
        pagesCount: 0
    }, h = !1, g = new app.controllers.RoomResponseParser, b = function(e) {
        l.pending || l.lock || !d || d.showPage(e)
    };
    function C(e) {
        var i = e.room
          , n = i.roomId
          , e = parseInt(n.substr(3), 10);
        l.setAttr({
            pending: !0
        }),
        api.roomV3.privateRooms.removeInvite({
            id: e
        }, function(e, t) {
            l.setAttr({
                pending: !1
            }),
            e ? dialogController.showError(e) : (d.__allItems.each(function(e, t) {
                if (t.roomId === n)
                    return d.__allItems.splice(e, 1),
                    !1
            }),
            l.setAttr({
                selectedRoom: null
            }),
            i.setAttr({
                selected: !1
            }),
            b(v.currentPageIndex))
        }).send()
    }
    function _(e) {
        return new app.controllers.PaginationController({
            items: e,
            itemsPerPage: i,
            onPageSelect: function(e) {
                l.__UID++;
                var n = null;
                l.selectedRoom && (n = l.selectedRoom.roomId,
                l.selectedRoom.setAttr({
                    selected: !1
                })),
                l.setAttr({
                    selectedRoom: null,
                    pending: !0
                }),
                w(e.items, function(e) {
                    l.setAttr({
                        pending: !1
                    });
                    var i = null;
                    $.each(e, function(e, t) {
                        t.selected = t.roomId === n,
                        t.selected && (i = t)
                    }),
                    l.items.removeAll(),
                    l.items.add(e),
                    i && l.setAttr({
                        selectedRoom: i
                    }),
                    new y(l.__UID).start()
                }),
                v.setAttr({
                    currentPageIndex: e.index,
                    pagesCount: e.total
                })
            }
        })
    }
    function w(e, t) {
        t = t || $.noop;
        var o = [];
        $.each(e, function(e, t) {
            t.topUsers = t.topUsers || [],
            t.bottomUsers = t.bottomUsers || [],
            t.topUsers.length = t.bottomUsers.length = 0;
            var i = t.users
              , n = t;
            o.push(n),
            $.each(i, function(e, t) {
                var i = a ? t.male ? "bottomUsers" : "topUsers" : t.male ? "topUsers" : "bottomUsers";
                n[i].push(t),
                t.firstName = t.firstName + util.formatProfileBdate(null, t.age),
                t.photoUrl = t.photo_100
            })
        }),
        t(o)
    }
    l.sortByMessages || l.sortBySpent || l.sortByTracks || (l.sortBySpent = !0),
    m.setModel(l),
    m.onRemove(function() {
        h = !1
    }),
    e = "comments-pagination2",
    t = lilo.createView(e, {
        itemsPerBound: 4
    }),
    m.els.pagination.append(t.el),
    t.setModel(v),
    m.on("show-page:" + e, function(e) {
        b(e.extraData.pageIndex)
    }),
    m.on("show-next:" + n, function() {
        b(v.currentPageIndex + 1)
    }),
    m.on("show-prev:" + n, function() {
        b(v.currentPageIndex - 1)
    }),
    m.on("sort:" + n, function(e) {
        l.pending || l.lock || (e = e.extraData.sort,
        l.setAttr({
            sortBySpent: "spent" === e,
            sortByMessages: "messages" === e,
            sortByTracks: "tracks" === e,
            sortByInvites: "invites" === e,
            sortBySpecial: "special" === e
        }),
        "invites" === e ? d = u : "special" === e ? d = p : (util.lStorage.save(r, e),
        I((d = c).getAllItems())),
        d.showPage(0))
    }),
    m.on("delete:item-room-preview", function(e) {
        C({
            room: e.extraData.model
        })
    }),
    m.on("select:item-room-preview", function(e) {
        if (isMobi) {
            l.setAttr({
                selectedRoom: e.extraData.model
            });
            var t = [{
                title: "Перейти",
                handler: function() {
                    return E(),
                    !1
                }
            }];
            return e.extraData.model.roomId.startWith("10_") && t.push({
                title: "Удалить из списка",
                handler: function() {
                    return C({
                        room: e.extraData.model
                    }),
                    !1
                }
            }),
            void new app.controllers.MobilePopup({
                btns: t
            })
        }
        t = e.extraData.model;
        t !== l.selectedRoom && (l.selectedRoom && l.selectedRoom.setAttr({
            selected: !1
        }),
        t.setAttr({
            selected: !0
        }),
        l.setAttr({
            selectedRoom: t
        }))
    });
    var E = function() {
        m.viewModel.canSubmit && (6 === l.selectedRoom.bottomUsers.length ? dialogController.confirm({
            message: "Комната занята. Встать в очередь?",
            onOk: function() {
                return M(l.selectedRoom),
                !1
            }
        }) : M(l.selectedRoom))
    };
    function y(e) {
        this.__uid = e
    }
    m.on("submit:" + n, E),
    $.extend(y.prototype, {
        FREQ: 2e3,
        start: function() {
            setTimeout($.proxy(this.__doUpdate, this), 500)
        },
        __isNotActual: function() {
            return this.__uid !== l.__UID || !h || 0 === l.items.length
        },
        __doUpdate: function() {
            var i;
            this.__isNotActual() || (i = [],
            $.each(l.items, function(e, t) {
                t.roomId && i.push(t.roomId)
            }),
            api.roomV3.getList({
                ids: i
            }, $.proxy(this.__handleApiResponse, this)).send())
        },
        __handleApiResponse: function(e, t) {
            var i, n;
            this.__isNotActual() || (e ? setTimeout($.proxy(this.__doUpdate, this), this.FREQ) : (i = [],
            $.each(t.jsonList, function(e, t) {
                t = JSON.parse(t);
                i.push(g.parse(t.roomData))
            }),
            t.privateRoomsData && (n = util.collectArrayInObjectByProperty(i, "roomId"),
            $.each(t.privateRoomsData, function(e, t) {
                n[e = "10_" + e] || i.push({
                    isActivePrivateRoom: !1,
                    chatMessagesCount: 0,
                    accessDescr: {},
                    isSummary: !0,
                    roomId: e,
                    roomOwner: t.ownerId,
                    spent: 0,
                    title: null,
                    tracksCount: 0,
                    users: [],
                    roomOwnerFirstName: t.ownerFirstName,
                    roomOwnerLastName: t.ownerLastName,
                    roomOwnerAvatar: t.ownerAvatar
                })
            })),
            i.length === l.items.length || l.sortByInvites ? this.__roomsIsDiffer(i, l.items) ? w(i, $.proxy(this.__handleVKResponse, this)) : setTimeout($.proxy(this.__doUpdate, this), this.FREQ) : function() {
                l.setAttr({
                    lock: !0
                });
                var n = v.currentPageIndex
                  , e = api.roomV3.getList({}, function(e, t) {
                    if (h && (l.setAttr({
                        lock: !1
                    }),
                    !e)) {
                        var i = [];
                        if ($.each(JSON.parse(t.jsonList), function(e, t) {
                            t = g.parse(t.roomData);
                            t.roomId !== f.roomId && i.push(t)
                        }),
                        0 === (i = I(i)).length)
                            return o.close(),
                            void dialogController.fadePopup({
                                message: "Список комнат пуст"
                            });
                        t = d.getAllItems();
                        t.length = 0,
                        util.insertArrayAt(t, 0, i),
                        b(n)
                    }
                });
                D && util.currentMillis() - D < 100 ? setTimeout(function() {
                    e.send(util.random(200, 300)),
                    D = util.currentMillis()
                }, 200) : (e.send(util.random(200, 300)),
                D = util.currentMillis())
            }()))
        },
        __handleVKResponse: function(t) {
            var i, n;
            this.__isNotActual() || (l.sortByInvites ? $.each(l.items, function(e, i) {
                var n = !1;
                $.each(t, function(e, t) {
                    i && i.roomId === t.roomId && (n = !0,
                    i.topUsers.removeAll(),
                    i.bottomUsers.removeAll(),
                    i.topUsers.add(t.topUsers),
                    i.bottomUsers.add(t.bottomUsers),
                    t.spent = i.spent,
                    t.tracksCount = i.tracksCount,
                    t.chatMessagesCount = i.chatMessagesCount,
                    i.roomOwnerAvatar = t.roomOwnerAvatar,
                    i.roomOwnerFirstName = t.roomOwnerFirstName,
                    i.roomOwnerLastName = t.roomOwnerLastName)
                }),
                n || (i.topUsers.removeAll(),
                i.bottomUsers.removeAll()),
                i.setAttr({
                    isActivePrivateRoom: i.topUsers.length || i.bottomUsers.length
                }),
                i.updateView && i.updateView()
            }) : (i = null,
            l.selectedRoom && (i = l.selectedRoom.roomId,
            l.selectedRoom.setAttr({
                selected: !1
            })),
            l.setAttr({
                selectedRoom: null
            }),
            n = null,
            $.each(t, function(e, t) {
                t.selected = t.roomId === i;
                e = l.items[e];
                e && e.roomId === t.roomId && (t.spent = e.spent,
                t.tracksCount = e.tracksCount,
                t.chatMessagesCount = e.chatMessagesCount),
                t.selected && (n = t)
            }),
            l.items.removeAll(),
            l.items.add(t),
            n && l.setAttr({
                selectedRoom: n
            })),
            setTimeout($.proxy(this.__doUpdate, this), this.FREQ))
        },
        __roomsIsDiffer: function(e, t) {
            if (e.length !== t.length)
                return !0;
            for (var i, n, o, a = 0; a < e.length; a += 1) {
                if (i = e[a],
                n = t[a],
                i.roomId !== n.roomId || i.users.length !== n.users.length)
                    return !0;
                for (o = 0; o < i.users.length; o += 1)
                    if (i.users[o].uid !== n.users[o].uid)
                        return !0;
                if (i.roomId.startWith("10_") && (i.roomOwnerAvatar !== n.roomOwnerAvatar || i.roomOwnerFirstName !== n.roomOwnerFirstName || i.roomOwnerLastName !== n.roomOwnerLastName))
                    return !0
            }
            return !1
        }
    });
    var D = 0;
    function T(e, t) {
        return e.spent === t.spent ? 0 : e.spent > t.spent ? -1 : 1
    }
    function S(e, t) {
        return e.chatMessagesCount === t.chatMessagesCount ? 0 : e.chatMessagesCount > t.chatMessagesCount ? -1 : 1
    }
    function A(e, t) {
        return e.tracksCount === t.tracksCount ? 0 : e.tracksCount > t.tracksCount ? -1 : 1
    }
    function I(e) {
        $.each(e, function(e, t) {
            t.isNotEnough = !1
        });
        var t = T;
        return l.sortByMessages ? t = S : l.sortByTracks && (t = A),
        e.sort(t),
        e
    }
    function M(e) {
        var t, a, i;
        e.isNotEnough ? dialogController.fadePopup({
            message: "Нельзя войти, комната почти пустая",
            duration: 2e3
        }) : (t = {
            force: !0
        },
        a = function(n) {
            ajaxLoader.show();
            var o = f.roomId;
            f.roomId = null,
            t.skip_restrictions = n,
            api.roomV3.getRoom(t, function(e, t, i) {
                ajaxLoader.hide(),
                e ? (e.code === Codes.TOO_FREQ_ROOM_SWITCH ? dialogController.showDialogRoomSwitchTooFreq(t ? t.left : 0, {
                    price: (t || {}).price,
                    paymentJoin: function() {
                        a(n)
                    }
                }) : e.code === Codes.LEAVE_FROM_CURRENT_ROOM_IS_NOT_ALLOWED ? (roomController.onLeaveRoomIsNotAllowed(e.requestParams),
                dialogController.close(m)) : e.code === Codes.ROOM_ACCESS_DESCR ? dialogController.roomExpLimitDialog(t) : e.code === Codes.NOT_ENOUGH_EXP_TO_ADD_ROOM ? dialogController.showMessageDialog({
                    message: "У Вас недостаточно рейтинга, чтобы попасть в эту комнату"
                }) : e.code === Codes.USER_IN_BLACK_LIST ? dialogController.showMessageDialog({
                    message: "Невозможно войти в комнату"
                }) : e.code === Codes.ROOM_NOT_FOUND ? dialogController.showMessageDialog({
                    message: "Комната не найдена"
                }) : e.code === Codes.ROOM_QUEUE_IS_FULL ? dialogController.showMessageDialog({
                    message: "Не удалось подключиться к комнате. Очередь заполнена"
                }) : e.code === Codes.ACCESS_DENIED ? dialogController.showMessageDialog({
                    message: "Не удалось подключиться к комнате"
                }) : e.code === Codes.BANNED ? dialogController.showAccessDeniedDialog(t) : e.code === Codes.NO_ACCESS_TO_ROOM ? dialogController.showNoAccessToRoom({
                    leftMillis: t.leftTime
                }) : dialogController.showMessageDialog({
                    message: "Не удалось подключиться к комнате. Произошла ошибка. <br/>Code:" + e.code
                }),
                s.onSubmit(null, o)) : s.onSubmit(t, o)
            }).send(0)
        }
        ,
        e.roomId.startWith("10_") ? (t.target_private_room_id = e.roomId,
        a()) : (t.target_room_id = e.roomId,
        i = !1,
        e.users.each(function(e, t) {
            if (socialApi.isFriend(t.uid))
                return !(i = !0)
        }),
        a(i)))
    }
    this.open = function(r) {
        var l = api.roomV3.getList({}, function(e, t, i) {
            if (e)
                return e.code === Codes.CACHE_LOCK_TIMEOUT ? void setTimeout(function() {
                    m.isVisible && l.send()
                }, 1e3) : (r(),
                void (e.code === Codes.LEAVE_FROM_CURRENT_ROOM_IS_NOT_ALLOWED ? dialogController.showDialogSwitchRoomIsNotAllowed() : e.code === Codes.ROOM_ACCESS_DESCR ? dialogController.roomExpLimitDialog(t) : dialogController.fadePopup({
                    message: "Не удалось загрузить список комнат"
                })));
            var n = []
              , o = [];
            $.each(JSON.parse(t.jsonList), function(e, t) {
                t = g.parse(t.roomData);
                t.roomId !== f.roomId && (4 === t.accessDescr.type ? t.accessDescr.regionId === app.info.regionId && t.accessDescr.countryId === app.info.countryId && (o.push(t),
                n.push(t)) : 5 === t.accessDescr.type ? t.accessDescr.countryId === app.info.countryId && (o.push(t),
                n.push(t)) : 3 === t.accessDescr.type || 6 === t.accessDescr.type ? (o.push(t),
                n.push(t)) : (2 !== t.accessDescr.type || expController.getCurrentExp() < 185850) && n.push(t))
            });
            var o = o.sort(function(e, t) {
                return e.users.length > t.users.length ? -1 : 1
            })
              , n = I(n)
              , a = []
              , e = t.inviteIds
              , t = t.activePrivateRoomsIds
              , s = util.collectArrayInObjectByProperty(t);
            if ($.each(e, function(e, t) {
                t = "10_" + t;
                t !== f.roomId && a.push({
                    isActivePrivateRoom: !!s[t],
                    chatMessagesCount: 0,
                    accessDescr: {},
                    isSummary: !0,
                    roomId: t,
                    roomOwner: null,
                    spent: 0,
                    title: null,
                    tracksCount: 0,
                    users: [],
                    roomOwnerFirstName: "",
                    roomOwnerLastName: "",
                    roomOwnerAvatar: ""
                })
            }),
            n.filter(function(e) {
                return 0 < e.users.length
            }),
            0 === n.length && 0 === a.length)
                return r(),
                void dialogController.fadePopup({
                    message: "Список комнат пуст"
                });
            0 === a.length && m.$(".by-invites").remove(),
            0 === o.length && m.$(".by-special").remove(),
            a.sort(function(e, t) {
                return e.isActivePrivateRoom === t.isActivePrivateRoom ? 0 : e.isActivePrivateRoom ? -1 : 1
            }),
            c = _(n),
            u = _(a),
            p = _(o),
            d = c,
            h = !0,
            dialogController.open(m, {
                mobiFullHeight: 1
            }),
            b(0),
            r()
        });
        return l.send(util.random(150, 400)),
        this
    }
    ,
    this.close = function() {
        dialogController.close(m)
    }
}
,
function() {
    function v(e, t) {
        return Math.floor(e * t)
    }
    function h(t) {
        function i(e) {
            util.cache.save(b, e, 2e4),
            app.info.stocks = e,
            app.eventBus.trigger(app.EVENTS.CHANGE_STOCK_LIST),
            t()
        }
        window.adminMode ? api.user.getStocks({}, function(e, t) {
            i(e ? [] : t.stocks)
        }).send() : webSocketController.sendMessage({
            action: "user/getStocks"
        }, {}, function(e) {
            var t = e.code
              , e = (e.data || {}).stocks;
            i(200 === t && e ? e : [])
        })
    }
    var g = $.noop
      , b = "stock-list";
    app.eventBus.on(app.EVENTS.CHANGE_STOCK_LIST, function() {
        g()
    });
    function C(e) {
        var i = (e = e || {}).currency || StockCurrency.COINS
          , n = []
          , o = null
          , a = !1;
        return (app.info.stocks || []).each(function(e, t) {
            t.currency !== i && t.type !== StockType.FIRST_PAYMENT || n.push(t)
        }),
        (n = n.sort(function(e, t) {
            return e.isPromo === t.isPromo ? e.type === t.type ? 0 : e.type === StockType.FIRST_PAYMENT ? -1 : 1 : e.isPromo ? -1 : 1
        })).each(function(e, t) {
            t.isPromo && (a = !0)
        }),
        n.each(function(e, t) {
            if (!a || t.isPromo) {
                switch (t.type) {
                case StockType.FIRST_PAYMENT:
                    app.info.hasOrders || ((o = t).currency = i,
                    o.dialogPreviewTitle = "Акция!",
                    o.dialogPreviewDescr = "Совершив любой платеж первый раз, вы<br> получите +50% бонусных {0}".format(1 === i ? "монет" : "рубинов"),
                    o.dialogPurchaseTitle = "<span style='color:{1}'>Акция!</span>&nbsp;Совершив любой платеж первый раз,<br> вы получите +50% бонусных {0}.".format(1 === i ? "монет" : "рубинов", 1 === i ? "#9200b9" : "#fc5635"));
                    break;
                case StockType.EXTRA_LIMITED_COINS:
                    t.currency === i && (1 === i && 1e3 < t.leftCoins && (o = t),
                    2 === i && 5 < t.leftCoins && (o = t));
                    break;
                case StockType.EXTRA_COINS_WITH_TIMER:
                    t.currency === i && 2e3 < app.controllers.dialog.Purchase.calcStockLeftMillis(t) && (o = t)
                }
                return !o && void 0
            }
        }),
        o
    }
    function _() {
        return !util.isOKPlatform() && (!window.isExternal && (!!window.ODR || isMobi && IS_IOS && !isMvk))
    }
    app.controllers.dialog.Purchase = function(s) {
        var d, c, r, u, p, e, t, i, n, l, o;
        function f(e, t, i) {
            var n, o, a;
            window.isExternal || e && (n = {
                payment: e
            },
            o = "paymentGroup16",
            16 <= (a = app.info.age) && a <= 17 ? o = "paymentGroup16_17" : 18 <= a && a <= 24 ? o = "paymentGroup18_24" : 25 <= a && a <= 30 ? o = "paymentGroup25_30" : 31 <= a && (o = "paymentGroup31"),
            n[o] = e,
            app.info.appRefString && app.info.appRefString.startWith && (app.info.appRefString.startWith("ref_idlv_ok_") ? n[app.info.appRefString.substr(6) + "_amount"] = e : n[app.info.appRefString + "_amount"] = e),
            r || (n.firstPayment = 1),
            i && i.type === StockType.FIRST_PAYMENT && (n.s_x2 = 1),
            i = i ? v(t.totalBonus, i.bonusRatio) : t.totalBonus,
            $.isNumeric(i) && (1 === t.currency ? n.payment_coins = i : n.payment_rubies = i),
            cAnal.trackEvent(n))
        }
        function m(e, t) {
            if (!s.fromMobi && t)
                return o = e,
                a = t,
                i = lilo.createView("dialog-success-purchase-stock"),
                n = {
                    extraBonus: v(o.totalBonus, a.bonusRatio),
                    bonus: o.totalBonus,
                    item: o
                },
                a.type !== StockType.FIRST_PAYMENT && 1 === o.currency && i.el.addClass("stock-3"),
                i.setModel(n),
                dialogController.open(i, {
                    dialogClass: "no-padding hide-close",
                    minTopOffset: 180
                }),
                i.onRemove(function() {
                    isDirect && api.syncBalance()
                }),
                void f(o.voices, o, a);
            var i, n, o = lilo.createView("dialog-success-purchase"), a = e.currency === StockCurrency.COINS, a = {
                imgUrl: e.icon,
                text: "Поздравляем! <br> <b>{1} {2}</b> уже на вашем счету!".format(e.text, e.bonus + e.freeBonus, util.pluralize(e.bonus + e.freeBonus, {
                    one: a ? "монета" : "рубин",
                    two: a ? "монеты" : "рубина",
                    many: a ? "монет" : "рубинов"
                })),
                currency: e.currency
            };
            o.setModel(a),
            dialogController.open(o),
            o.onRemove(function() {
                isDirect && api.syncBalance()
            }),
            f(e.voices, e, t)
        }
        function a(e) {
            var o, a;
            function t() {
                setTimeout(function() {
                    app.eventBus.trigger(app.EVENTS.PURCHASE)
                }, 100);
                var e = o.stock;
                if (e && util.cache.remove(b),
                s.fromMobi)
                    return util.lStorage.save("bcm", util.currentMillis()),
                    void dialogController.close(c);
                var t = o.bonus + (isNaN(o.freeBonus) ? 0 : o.freeBonus);
                e && (t += v(t, a.bonusRatio)),
                e && e.type === StockType.EXTRA_LIMITED_COINS && (e.leftCoins -= t,
                e.leftCoins < 0 && (e.leftCoins = 0),
                c.viewModel.setAttr({
                    leftCoins: e.leftCoins
                })),
                api.syncBalance(),
                app.info.hasOrders = !0,
                app.info.stock = !1;
                var i = lilo.clone(o)
                  , n = e ? lilo.clone(e) : null;
                c.isVisible && (dialogController.close(c),
                new app.controllers.dialog.Purchase({
                    currency: 1 === l.getIndexOfSelectedTab() ? 2 : 1
                })),
                setTimeout(function() {
                    m(i, n)
                }, 10)
            }
            function i() {
                a.stock && h(function() {
                    dialogController.close(c),
                    new app.controllers.dialog.Purchase
                })
            }
            function n() {}
            (s.fromMobi || app.balanceModel.canChange({
                message: "В данный момент вы не можете совершать покупки"
            })) && (o = e.extraData.model,
            a = o.itemName,
            window.isExternal ? socialApi.showOrderBox(o.productId, t, i, n, o.stock) : socialApi.showOrderBox(a, t, i, n, o.stock))
        }
        _() ? dialogController.fadePopup("Магазин временно не работает") : ((s = s || {}).first = !1,
        d = util.isOKPlatform(),
        o = "dialog-purchase3",
        c = lilo.createView(o),
        r = app.info.hasOrders,
        p = {
            pending: !(u = function(e, t, i, n, o, a, s, r, l) {
                this.itemName = e,
                this.icon = t,
                this.voices = d ? 7 * i : i,
                this.bonus = n,
                this.freeBonus = o || 0,
                this.totalBonus = this.bonus + this.freeBonus,
                this.bonusRatio = 0,
                this.rubles = 0,
                this.currency = a,
                this.stock = s,
                this.index = r,
                this.productId = l,
                s && (this.bonusRatio = s.bonusRatio),
                1 === app.info.countryId && util.isOKPlatform()
            }
            ),
            hasOffers: !!util.isVKPlatform() && 0 !== app.services.vk.getOffers().length,
            items: [],
            stock: null
        },
        c.setModel(p),
        e = function(e) {
            var n = e.currency
              , o = C({
                currency: n
            });
            p.items.removeAll();
            var a = e.defaultId
              , s = !1
              , r = !1;
            if (o)
                switch (o.type) {
                case StockType.FIRST_PAYMENT:
                    a = e.firstPaymentId,
                    s = !0;
                    break;
                case StockType.EXTRA_COINS_WITH_TIMER:
                case StockType.EXTRA_LIMITED_COINS:
                    a = e.stockId,
                    r = !0
                }
            function l(e, t, i) {
                if (isExternal) {
                    t = externalAppPrices[t];
                    if (t)
                        return i ? t.baseBonus : t.extraBonus
                }
                return 1 === n ? e : Math.floor(e / 2)
            }
            var d = [];
            [{
                price: 1,
                baseBonus: 10,
                freeBonus: 0
            }, {
                price: 5,
                baseBonus: 50,
                freeBonus: 10
            }, {
                price: 10,
                baseBonus: 100,
                freeBonus: 25
            }, {
                price: 50,
                baseBonus: 500,
                freeBonus: 200
            }, {
                price: 100,
                baseBonus: 1e3,
                freeBonus: 500
            }, {
                price: 300,
                baseBonus: 3e3,
                freeBonus: 2e3
            }].each(function(e, t) {
                var i = function(e) {
                    e += 1;
                    e = n === StockCurrency.COINS ? "store_coin_" + e : "store_ruby_" + e;
                    return s ? e += "_first_payment" : r && (e += "_stock"),
                    window.externalPricesRussian && (e += "_ru"),
                    e
                }(e)
                  , i = new u("item_" + (a + e),CDN_PREFIX + "magaz/{0}-{1}.png?v=1".format(n === StockCurrency.COINS ? "coins" : "ruby", t.baseBonus),t.price,l(t.baseBonus, i, !0),l(t.freeBonus, i, !1),n,o,e,i);
                d.push(i)
            }),
            d.reverse(),
            p.items.removeAll(),
            p.items.add(d),
            t(),
            p.setAttr({
                stock: o
            }),
            c.startTimer()
        }
        ,
        t = function() {
            var e = p.stock;
            e && e.leftCoins && (e.leftCoins = Math.max(0, c.viewModel.leftCoins))
        }
        ,
        i = function() {
            c.els.ruby.hide(),
            c.els.coins.show(),
            c.el.removeClass("ruby-currency").addClass("coins-currency"),
            e({
                currency: StockCurrency.COINS,
                defaultId: 201,
                firstPaymentId: 259,
                stockId: 700
            })
        }
        ,
        n = function() {
            c.els.ruby.show(),
            c.els.coins.hide(),
            c.el.addClass("ruby-currency").removeClass("coins-currency"),
            e({
                currency: StockCurrency.RUBIES,
                defaultId: 501,
                firstPaymentId: 507,
                stockId: 513
            })
        }
        ,
        l = new app.sdk.TabViewController({
            $container: c.els["tabs-block"],
            tabs: [{
                selected: !1,
                title: "<i class='icon-coins'></i>" + (isMobi ? "Монеты" : "Пополнить монеты"),
                onOpen: function() {
                    i()
                },
                onClose: function() {
                    c.els.coins.hide()
                }
            }, {
                selected: !1,
                title: "<i class='icon-ruby'></i>" + (isMobi ? "Рубины" : "Пополнить рубины"),
                onOpen: function() {
                    n()
                },
                onClose: function() {
                    c.els.ruby.hide()
                }
            }]
        }),
        s.currency === StockCurrency.RUBIES ? l.selectTab(1) : l.selectTab(0),
        c.on("purchase:item-purchase", a),
        c.on("purchase:item-purchase-v2", a),
        c.on("purchase:item-purchase-v3", a),
        c.on("purchase-item:" + o, a),
        c.on("show-offers:" + o, function() {
            VK.callMethod("showOrderBox", {
                type: "offers",
                currency: 1
            }),
            s.fromMobi || dialogController.close(c)
        }),
        c.bind("do-exchange", function(e) {
            function i(e) {
                dialogController.fadePopup("Вам не хватает {0} {1}".format(e, util.pluralize(e, "рубина", "рубинов", "рубинов")))
            }
            var n = e.extraData.ruby
              , e = n - app.balanceModel.ruby;
            0 < e ? i(e) : (p.setAttr({
                pending: !0
            }),
            ServerApi("user/ruby/exchange.php", {
                rubies: n
            }, function(e, t) {
                p.setAttr({
                    pending: !1
                }),
                t && util.isDef(t.ruby) && app.balanceModel.setAttr({
                    ruby: t.ruby
                }),
                t && util.isDef(t.balance) && app.balanceModel.setAttr({
                    balance: t.balance
                }),
                e ? e.code === Codes.NOT_ENOUGH_BALANCE ? i(t.deficit) : dialogController.showError(e) : (c.els["ruby-input"].val(0),
                c.els["coin-input"].html(0),
                t = lilo.createView("dialog-success-purchase"),
                e = 2 * n,
                t.setModel({
                    imgUrl: CDN_PREFIX + "magaz/{0}-{1}.png?v=1".format("coins", 50),
                    text: "Поздравляем! <br> <b>{1} {2}</b> уже на вашем счету!".format("", e, util.pluralize(e, {
                        one: "монета",
                        two: "монеты",
                        many: "монет"
                    })),
                    currency: 1
                }),
                dialogController.open(t))
            }))
        }),
        o = dialogController.open(c, {
            dialogClass: "no-padding small-close"
        }),
        s.onDialogRemove && o.onRemove(s.onDialogRemove),
        c.els.loader.show(),
        h(function() {
            c.els.loader.hide(),
            (1 === l.getIndexOfSelectedTab() ? n : i)(),
            g = function() {
                (1 === l.getIndexOfSelectedTab() ? n : i)()
            }
            ,
            p.setAttr({
                pending: !1
            })
        }))
    }
    ,
    app.controllers.dialog.Purchase.stockPreview = function(e, t) {
        var i, n;
        _() || (e = e || C()) && ((i = lilo.createView("dialog-stock-preview")).setModel(e),
        dialogController.open(i, {
            dialogClass: "no-padding small-close"
        }),
        i.startTimer(),
        i.el.on("click", ".btn", n = function() {
            dialogController.close(i),
            new app.controllers.dialog.Purchase({
                currency: e.currency
            })
        }
        ),
        i.el.on("click", ".mobi-btn.open-store", n),
        t && t.className && i.el.addClass(t.className))
    }
    ,
    app.controllers.dialog.Purchase.calcStockLeftMillis = function(i) {
        var e = -1;
        if (i || (app.info.stocks || []).each(function(e, t) {
            if (5 === t.type)
                return i = t,
                !1
        }),
        i) {
            if (i.endTs)
                return i.endTs - util.serverUtc();
            var t = util.currentMillis() - app.info.startTime
              , e = Math.max(i.leftMillis - t, 0)
        }
        return e
    }
    ,
    app.controllers.dialog.Purchase.getStock = C
}(),
app.controllers.dialog.RoomPrivateMessage = function(r) {
    var e, l = r.roomModel || window.roomModel, d = app.PrivateMessageState, c = app.PrivateMessageType, u = r.isFreePrivateMessage, p = r.privateMessage || {}, f = r.targetUid || p.from, t = app.info.viewer_id, m = r.fromProfile, v = r.isAgain, h = r.roomId, g = !p.id, i = !!h, b = r.type || (r.p2pInvite ? c.P2P_INVITE : p.type || c.TYPE_USUAL), C = function() {
        var e = {
            __privateMessage: p,
            pending: !1,
            hasBan: !!app.info.blockedUids[f],
            viewerFullName: app.info.first_name,
            viewerAvatar: app.info.photo_100,
            viewerExp: expController.getCurrentExp(),
            viewerId: app.info.viewer_id,
            viewerVF: app.commonState.verified,
            senderUid: p.from,
            senderFullName: p.from === t ? app.info.first_name : p.fromFirstName,
            senderAvatar: p.from === t ? app.info.photo_100 : p.fromAvatar,
            senderExp: p.from === t ? p.toExp : p.fromExp,
            senderVF: p.from === t ? p.toVF : p.fromVF,
            sentTs: p.requestTs || 0,
            sentText: p.requestText || "...",
            sentBase64: p.requestAttachment,
            replyTs: p.responseTs || 0,
            replyText: p.responseText || "...",
            recipientBase64: p.responseAttachment,
            type: b,
            price: u || !g ? 0 : (c.TYPE_GOLD,
            1),
            currency: b === c.TYPE_GOLD ? 2 : 1,
            sendAnonymous: !1,
            isFreePrivateMessage: u,
            editableBase64: null
        };
        switch (p.state) {
        case d.STATE_REQUEST:
            break;
        case d.STATE_RESPONSE:
        case d.STATE_RESPONSE_REMOVE:
            e.replyText = p.requestText || "...",
            e.recipientBase64 = p.requestAttachment,
            e.replyTs = p.requestTs || 0,
            e.sentBase64 = p.responseAttachment,
            e.sentText = p.responseText || (p.responseAttachment ? "..." : ""),
            e.sentTs = p.responseTs || 0,
            e.senderUid = p.to,
            e.senderFullName = p.toFirstName,
            e.senderAvatar = p.toAvatar,
            e.senderExp = p.toExp,
            e.senderVF = p.toVF,
            f = p.to
        }
        return e
    }(), n = "dialog-room-private-message-v2", _ = lilo.createView(n), w = function() {
        var e, i;
        !g && l && (e = l.getViewer().privateMessages,
        i = null,
        e && e.length && e.each(function(e, t) {
            if (t.from === p.from && t.id === p.id)
                return i = t,
                !1
        }),
        i && l.getViewer().privateMessages.remove(i))
    };
    if (C.price)
        if (1 === C.currency) {
            if ((e = app.balanceModel.balance - C.price) < 0)
                return void dialogController.showInsufficientlyBalanceDialog(e)
        } else if ((e = app.balanceModel.ruby - C.price) < 0)
            return void dialogController.showInsufficientlyBalanceDialog(e, {
                currency: 2
            });
    _.setModel(C);
    var o = dialogController.open(_, {
        dialogClass: "no-padding small-close",
        isModal: !isMobi && !g
    });
    p.readed || p.state !== d.STATE_REQUEST || webSocketController.sendMessage({
        action: "pm/markAsReaded",
        id: (p.z1 || p.from) + "_" + p.id
    }, {}, function(e) {
        console.info("pm/markAsReaded", e)
    }),
    webSocketController.sendMessage({
        action: "pm/open",
        id: (p.z1 || p.from) + "_" + p.id
    }, {}, function(e) {
        console.info("pm/open", e)
    }),
    _.onRemove(function() {});
    var a = !1;
    function s(e) {
        a || (w(),
        g || y(e || "", function() {
            a = !0
        }, {
            p2pStatus: 2
        }))
    }
    var E = !1;
    function y(e, o, t) {
        if (!g || u || app.balanceModel.canChange()) {
            if (g && i && !l.hasUser(f))
                return dialogController.fadePopup("Пользователь вышел"),
                void dialogController.close(_);
            o = o || $.noop;
            var a, s = {
                target_uid: f,
                text: e || "",
                free: u
            };
            C.type === c.P2P_INVITE && t && t.p2pStatus && (a = s.p2pStatus = t.p2pStatus);
            t = l ? l.roomId : null;
            t && (s.room_id = t),
            g ? s.type = C.type : 0 < p.z1 ? s.message_id = p.z1 + "_" + p.id : s.message_id = p.from + "_" + p.id,
            C.editableBase64 && (s.attachment = C.editableBase64),
            C.sendAnonymous && (s.z1 = !0),
            C.setAttr({
                pending: !0
            }),
            ServerApi("privatemessage/add.php", s, function(e, t) {
                var i, n;
                C.setAttr({
                    pending: !1
                }),
                t && util.isDef(t.balance) && app.balanceModel.setAttr({
                    balance: t.balance
                }),
                t && util.isDef(t.ruby) && app.balanceModel.setAttr({
                    ruby: t.ruby
                }),
                E = !0,
                _.isVisible && (n = !0,
                e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit, {
                    currency: t.currency
                }) : e.code === Codes.TARGET_ROOM_USER_NOT_FOUND ? (dialogController.fadePopup({
                    message: "Пользователь вышел"
                }),
                w()) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog() : e.code === Codes.USER_IN_BLACK_LIST ? dialogController.fadePopup("Вы не можете отправить сообщение, так как этот пользователь добавил вас в Черный список") : e.code === Codes.LIMIT ? t.hasActiveInvites ? dialogController.fadePopup("Вы не можете отправить приглашение, т.к. у вас имеются активные входящие приглашения") : (i = "Вы сможете отправить приглашение через: {0}",
                g || (n = !1,
                i = "Вы сможете принять новое приглашение через: {0}"),
                dialogController.fadePopup(i.format(util.formatMillisToTime(t.leftMillis, function(e, t, i) {
                    return t + ":" + i
                })))) : e.code === Codes.NOT_FOUND ? dialogController.fadePopup("Вы сможете отправить приглашение через: {0}".format(util.formatMillisToTime(t.leftMillis, function(e, t, i) {
                    return t + ":" + i
                }))) : dialogController.fadePopup({
                    message: "Не удалось добавить сообщение. Code:" + e.code
                }) : (w(),
                C.sendAnonymous || !h && p.roomId !== l.roomId || new app.controllers.RoomGiftsController(r).animatePrivateMessage(app.info.viewer_id, f, {
                    message: {
                        type: C.type
                    }
                }),
                o()),
                n && dialogController.close(_)),
                e || (n = {},
                C.type === c.P2P_INVITE ? p.state === d.STATE_REQUEST ? 1 === a ? n.p2p_accept = 1 : 2 === a && (n.p2p_deny = 1) : g && (n.p2p_invite = 1) : p.state === d.STATE_REQUEST ? s.text || s.attachment ? n.pm_answer = 1 : n.pm_cancel = 1 : g && (u ? n.pm_free = 1 : (e = b === c.TYPE_GOLD ? "_g" : "_u",
                v ? n["pm_again" + e] = 1 : m ? n["pm_profile" + e] = 1 : n.pm_fee = 1)),
                s.attachment && (n.pm_photo = 1),
                cAnal.trackEvent(n))
            })
        }
    }
    _.bind("do-cancel", function(e) {
        var t;
        E || (t = "",
        s(t = e && e.extraData && e.extraData.text ? e.extraData.text : t),
        r.onClose && r.onClose())
    }),
    _.bind("open-profile", function() {
        app.recentPrivateMessagesController && app.recentPrivateMessagesController.setRecentMessage(p);
        var e = p.from === t ? p.to : p.from;
        0 < e && (dialogController.close(_),
        app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
            uid: e
        }))
    });
    var D = app.__toggleBanMap || (app.__toggleBanMap = {});
    _.bind("toggle-ban", function(e) {
        var i = C.hasBan
          , n = !i
          , o = e.extraData.$btnEl
          , a = util.currentMillis()
          , e = D[f] || 0;
        a - e < 6e4 ? dialogController.fadePopup({
            message: "Вы можете пользоваться этой функцией не чаще 1 раза в минуту",
            duration: 2e3
        }) : (e = {
            target_uid: f,
            value: n
        },
        window.roomModel && l.findUser(app.info.viewer_id) && l.findUser(f) && (e.r = l.roomId),
        o.addClass("loading"),
        ServerApi("room/v3/toggleBlock.php", e, function(e, t) {
            o.removeClass("loading"),
            e ? e.code === Codes.ACCESS_DENIED ? app.eventBus.trigger(n ? app.EVENTS.USER_BLOCKED : app.EVENTS.USER_UNBLOCKED, {
                uid: f
            }) : dialogController.showError(e) : (app.eventBus.trigger(n ? app.EVENTS.USER_BLOCKED : app.EVENTS.USER_UNBLOCKED, {
                uid: f
            }),
            dialogController.fadePopup({
                message: "Пользователь {0}".format(i ? "заблокирован" : "разблокирован")
            }),
            C.setAttr({
                hasBan: n
            }),
            D[f] = a)
        }))
    }),
    _.on("submit:" + n, function(e) {
        var e = e.extraData.text
          , t = "Сообщение отправлено";
        C.sendAnonymous && (t = " Валентинка отправлена"),
        (C.editableBase64 || e.length || C.type === c.P2P_INVITE && p && p.state && p.state === d.STATE_REQUEST) && (y(e, function() {
            p.type === c.P2P_INVITE && p.state === d.STATE_REQUEST || dialogController.fadePopup(t)
        }, {
            p2pStatus: 1
        }),
        r.giftsDialog && dialogController.close(r.giftsDialog))
    }),
    _.bind("take-photo", function() {
        var e, s, t;
        e = {
            dialogView: o,
            onError: function(e) {
                isMobi && o.el.show(),
                o.el.show(),
                dialogController.fadePopup("Произошла ошибка. " + e.message)
            },
            onComplete: function(e) {
                o.el.show(),
                S(util.convertBase64ToByteArray(e), util.getContentTypeFromB64(e), function(e) {
                    C.setAttr({
                        editableBase64: e
                    })
                })
            }
        },
        s = lilo.createView("dialog-webcam"),
        t = new app.sdk.WebCamController({
            mimeType: "image/jpeg",
            width: 400,
            video: s.els.video[0],
            onError: e.onError,
            onComplete: e.onComplete,
            onStartPlay: function() {
                isMobi && e.dialogView.el.hide(),
                dialogController.open(s, {
                    dialogClass: "small-close"
                })
            },
            onCanPlay: function(e, t) {
                if (isMobi) {
                    for (var i = mobiUiHelper.vw2px(94), n = i - e, o = i - t, a = e / t; n < 0 || o < 0; )
                        n < 0 ? t = (e = i) / a : o < 0 && (e = (t = i) * a),
                        n = i - e,
                        o = i - t;
                    s.els.video.width(e).height(t)
                }
            }
        }),
        s.onRemove(function() {
            t.finalize(),
            isMobi && e.dialogView.el.show()
        }),
        s.bind("take-photo", function() {
            t.takePhoto(function() {
                isMobi && e.dialogView.el.show(),
                dialogController.close(s)
            })
        })
    });
    function T(e) {
        var i = lilo.createView("dialog-private-message-photo-preview");
        i.setModel({
            img: e
        }),
        o.el.hide(),
        i.onRemove(function() {
            o.el.show()
        }),
        dialogController.open(i, {
            mobiFullHeight: 1
        });
        var n = new Image;
        n.onload = function() {
            var e = n.width / n.height
              , t = i.el.height()
              , t = Math.max(400 / e, t - 80);
            isMobi || (i.els.content.css({
                height: t + "px",
                lineHeight: t + "px"
            }),
            i.el.css({
                minHeight: t + 80 + "px"
            }))
        }
        ,
        n.src = e
    }
    var S = function(e, t, i) {
        var n = new FormData;
        if (n.append("binary", e),
        util.isOKPlatform())
            var o = "https://sapps-static2.ru/static/secure/cors/upload"
              , a = {
                uid: app.info.viewer_id,
                auth_sig: app.info.auth_sig,
                session_key: app.info.session_key,
                app_id: BOOT_DATA.app_id,
                is_private_message_photo: !0,
                mimeType: t
            };
        else {
            let e = document.location.protocol;
            window.ORD && (e = "https:"),
            console.info("upload cors#1", o),
            o = e + "//sapps-static1.ru/static/secure/cors/upload",
            a = {
                app_id: app.info.api_id,
                auth_key: app.info.auth_key,
                uid: app.info.viewer_id,
                is_private_message_photo: !0,
                mimeType: t
            }
        }
        app.info.session && (a.expire = app.info.session.expire,
        a.mid = app.info.session.mid,
        a.secret = app.info.session.secret,
        a.sid = app.info.session.sid,
        a.sig = app.info.session.sig),
        window.isExternal && (a.external_access_key = app.apiPrimaryParams.access_token,
        a.app_id = BOOT_DATA.app_id);
        var s = [];
        o += "?",
        $.each(a, function(e, t) {
            util.isDef(t) && s.push(e + "=" + t)
        }),
        o += s.join("&"),
        a = n,
        C.setAttr({
            pending: !0
        }),
        $.ajax({
            url: o,
            type: "POST",
            data: a,
            dataType: "json",
            processData: !1,
            contentType: !1,
            success: function(e) {
                C.setAttr({
                    pending: !1
                }),
                200 === e.code ? i(e.data.url) : dialogController.showMessageDialog({
                    message: "При загрузке фото Произошла ошибка:<br>Code:{0}{1}".format(e.code, e.data ? "<br>" + JSON.stringify(e.data) : e.message ? "<br>" + e.message : "")
                })
            },
            error: function(e, t) {
                C.setAttr({
                    pending: !1
                }),
                ajaxLoader.hide(),
                dialogController.showMessageDialog({
                    message: "Произошлa ошибка<br>code:" + e.status
                }),
                console.info(arguments)
            }
        })
    };
    _.bind("preview-sent", function() {
        T(C.sentBase64)
    }),
    _.bind("delete-message", function() {
        dialogController.close(_),
        app.eventBus.trigger(app.EVENTS.REMOVE_PRIVATE_MESSAGE, {
            model: p
        }),
        r.onClose && r.onClose()
    }),
    isMobi && o.bind("click-close", function() {
        r.onClose && r.onClose()
    }),
    _.bind("preview-recipient", function() {
        T(C.recipientBase64)
    }),
    _.bind("show-photo-preview", function(e) {
        T(e.extraData.base64)
    }),
    _.bind("remove-photo-preview", function() {
        C.setAttr({
            editableBase64: null
        })
    }),
    o.on("again:" + n, function(e) {
        dialogController.close(_),
        s(),
        new app.controllers.dialog.RoomPrivateMessage({
            targetUid: f,
            type: e && e.extraData ? e.extraData.type : null,
            roomModel: l,
            roomId: h,
            isAgain: !0
        })
    })
}
,
app.controllers.dialog.GiftShootingRange = function(U) {
    CDN_PREFIX;
    var L, F = 200, V = 200, B = 50, G = 50, H = lilo.createView("dialog-shooter-range");
    this.getDialogWindow = function() {
        return e
    }
    ;
    var W = {};
    (U.giftDescription.type === ROOM_GIFT_TYPE.WITH_TARGET ? function() {
        (L = H.$(".range")).css("cursor", "none"),
        util.watch(function() {
            return "#debug" === location.hash
        });
        var n, o = H.$(".sight"), a = 0, s = 0, r = !1, i = !1, l = $.noop, e = 0, t = 0, d = function(e, t) {
            e < 0 || t < 0 || F < e || V < t ? i = r = !1 : (r = !0,
            o.css({
                left: e - B / 2 + "px",
                top: t - G / 2 + "px"
            }),
            a = e,
            s = t,
            l())
        }, c = function(e) {
            U.onComplete(e),
            dialogController.close(H)
        };
        setTimeout(function() {
            n = L.offset(),
            !IS_DESKTOP ? (d(100, 100),
            L.on("touchstart", function(e) {
                if (r) {
                    var t = e.originalEvent.touches;
                    if (t.length) {
                        var i = t[0].pageX
                          , t = t[0].pageY;
                        return n = L.offset(),
                        d(i - n.left, t - n.top),
                        c({
                            x: parseInt(a / 2, 10),
                            y: parseInt(s / 2, 10)
                        }),
                        e.preventDefault(),
                        e.stopPropagation(),
                        !1
                    }
                }
            })) : (L.on("mousemove", function(e) {
                n = L.offset(),
                d(e.pageX - n.left, e.pageY - n.top)
            }),
            d(100, 100),
            o.show(),
            L.on("mousedown", function() {
                r && (c({
                    x: parseInt(a / 2, 10),
                    y: parseInt(s / 2, 10)
                }),
                i = !0,
                e = a,
                t = s)
            }),
            L.on("mouseup", function() {
                i = !1
            }))
        }, 100);
        var u = U.giftDescription.id;
        L.off("click");
        var p, f, m = Math.abs, l = function() {
            i && r && (23 < m(a - e) || 23 < m(s - t)) && (c({
                x: parseInt(a / 2, 10),
                y: parseInt(s / 2, 10)
            }),
            e = a,
            t = s)
        }, v = 1e3, h = [], g = H.$(".coin"), b = function() {
            g[0].innerHTML = (U.giftDescription.price || U.giftDescription.rubyPrice) * h.length
        };
        U.giftDescription.rubyPrice && H.el.addClass("ruby-price"),
        U.giftDescription && U.giftDescription.recipientBalanceBonus && (p = H.$(".bonus-hint"),
        f = b,
        H.el.addClass("bonus-gift"),
        b = function() {
            f();
            var e = h.length * U.giftDescription.recipientBalanceBonus;
            p[0].innerHTML = "Бонус получателю: <b>+" + e + "</b>"
        }
        ),
        b();
        var C, _, w, E, y, D, T, S, A, I, M, O = H.$(".normal-gift  .btn-submit").click(function() {
            0 < h.length && U.onComplete(h, H)
        }).css({
            visibility: "hidden"
        }), x = (H.$(".btn-cancel").click(function() {
            dialogController.close(H)
        }),
        H.$(".normal-gift .hint"),
        U.giftDescription), R = U.giftDescription.imgSight || U.giftDescription.img, k = 2 * (x.w || 24), P = 2 * (x.h || 24), N = function() {
            return R
        };
        x.isMulticolor && x.landingImages && x.landingImages.length && (R = x.landingImages[0],
        C = 0,
        N = function() {
            return C++,
            x.landingImages[C % x.landingImages.length]
        }
        ),
        c = function(e) {
            var t = document.createElement("div")
              , i = t.style;
            i.position = "absolute",
            i.width = k + "px",
            i.height = P + "px",
            i.left = 2 * e.x - k / 2 + "px",
            i.top = 2 * e.y - P / 2 + "px",
            i.background = "url({0}) no-repeat center".format(N()),
            i.backgroundSize = "100% 100%",
            L[0].appendChild(t),
            h.push({
                x: e.x,
                y: e.y,
                w: null,
                h: null,
                a: null
            }),
            b(),
            O[0].style.visibility = "",
            h.length === v && (c = $.noop,
            o.hide(),
            L[0].style.cursor = "default")
        }
        ,
        u === app.info.roomGiftKissId ? (v = 10,
        H.el.addClass("kisses-round"),
        R = CDN_PREFIX + "game-gift-v2/1023_80_1.png",
        P = k = 70,
        _ = expController.getCurrentLevel(),
        y = E = w = 0,
        D = 1,
        90 <= _ ? D = 10 : (E = (w = 10 * (D = Math.floor(_ / 10) + 1)) - _,
        y = D + 1),
        $.extend(W, {
            isModal: !0
        }),
        T = {
            title: U.headerText,
            count: 0,
            price: 0,
            nextKisses: y,
            leftKisses: D,
            leftLevels: E,
            levelForAccess: w,
            freeKisses: D,
            avatar: U.photo200
        },
        H.setModel(T),
        T.onChange("count", function() {
            T.setAttr({
                leftKisses: D - T.count
            })
        }),
        H.bind("submit", S = function() {
            0 === h.length && util.repeat(D, function() {
                A({
                    x: util.random(20, 80),
                    y: util.random(20, 80)
                })
            }),
            c = d = $.noop,
            U.onComplete(h, H, {
                giftId: u
            })
        }
        ),
        H.bind("clear", function() {
            h.length = 0,
            T.setAttr({
                count: 0
            }),
            L.empty().append(o),
            L.css("cursor", "")
        }),
        A = c,
        c = function(e) {
            var t = T.count + 1;
            D < t || (A(e),
            T.setAttr({
                count: h.length
            }),
            h.length === D && (o.detach(),
            L.css("cursor", "default")))
        }
        ,
        I = U.leftSeconds,
        M = function() {
            H.isVisible && (H.els.timer.html(I),
            I <= 0 ? S() : (I--,
            setTimeout(M, 1e3)))
        }
        ,
        setTimeout(M, 0)) : (T = {
            title: U.headerText,
            avatar: U.photo200
        },
        H.setModel(T),
        H.el.addClass("normal-gift"))
    }
    : function() {
        var d, t = 40, c = 50, u = 260, p = 260;
        H.$(".sight").remove(),
        setTimeout(function() {
            var r = document.createElement("canvas");
            H.el.addClass("transform-range"),
            (L = H.$(".range")).append(r),
            H.setModel({
                title: U.headerText,
                avatar: U.photo200
            }),
            r.width = 340,
            r.height = 385;
            var l = new fabric.Canvas(r);
            fabric.Object.prototype.transparentCorners = !1,
            fabric.Image.fromURL(U.giftDescription.img, function(n) {
                var o, a, i = parseInt((u - 100) / 2, 10) + t + 50, s = parseInt((p - 100) / 2, 10) + c + 50;
                n.width = 100,
                n.height = 100,
                n.left = i,
                n.top = s,
                n.originX = "center",
                n.originY = "center",
                n.cornerColor = n.borderColor = "rgba(56, 121, 217, 1)",
                n.originY = "center",
                isMobi && n.setControlsVisibility({
                    mtr: !1,
                    bl: !1,
                    br: !1,
                    tl: !1,
                    tr: !1,
                    mt: !1,
                    mb: !1,
                    ml: !1,
                    mr: !1
                }),
                l.add(n),
                l.setActiveObject(n),
                d = function() {
                    n.setCoords();
                    var e = n.getBoundingRect()
                      , e = e.left < t || e.top < c || e.left + e.width > u + t || e.top + e.height > p + c;
                    return f.css("visibility", e ? "visible" : "hidden"),
                    m[e ? "addClass" : "removeClass"]("disabled"),
                    e
                }
                ,
                n.observe("rotating", d),
                n.observe("scaling", d),
                n.observe("moving", d),
                window.oImg = n,
                window.fabricCanvas = l,
                isMobi ? (o = function(e) {
                    var t = n.getBoundingRect();
                    (t.left > r.width || t.left + t.width < 0 || t.top > r.height || t.top + t.height < 0) && (n.left = i,
                    n.top = s),
                    d(),
                    l.renderAll()
                }
                ,
                a = Math.round(.1 * n.width),
                H.el.on("touchstart", ".img-inc", function(e) {
                    var t = n.width + a
                      , i = n.height + a;
                    return u < t || p < i || (n.width = t,
                    n.height = i),
                    o()
                }),
                H.el.on("touchstart", ".img-dec", function(e) {
                    var t = n.width - a
                      , i = n.height - a;
                    return t < a || i < a || (n.width = t,
                    n.height = i),
                    o()
                }),
                H.el.on("touchstart", ".img-rotate-left", function(e) {
                    return n.angle = (n.angle - 10) % 360,
                    o()
                }),
                H.el.on("touchstart", ".img-rotate-right", function(e) {
                    return n.angle = (n.angle + 10) % 360,
                    o()
                }),
                H.el.on("touchstart", ".img-left", function(e) {
                    return n.left -= 10,
                    o()
                }),
                H.el.on("touchstart", ".img-right", function(e) {
                    return n.left += 10,
                    o()
                }),
                H.el.on("touchstart", ".img-top", function(e) {
                    return n.top -= 10,
                    o()
                }),
                H.el.on("touchstart", ".img-bottom", function(e) {
                    return n.top += 10,
                    o()
                })) : l.on("mouse:up", function() {
                    n.setCoords();
                    var e = n.getBoundingRect();
                    (e.left > r.width || e.left + e.width < 0 || e.top > r.height || e.top + e.height < 0) && (n.left = i,
                    n.top = s,
                    l.renderAll(),
                    d())
                }),
                d()
            })
        }, 150);
        var f = H.$(".error-hint")
          , m = H.$(".transform-range .btn-submit").click(function() {
            var e;
            d() || (e = {
                x: parseInt((oImg.left - oImg.getWidth() / 2 - t - 30) / 2, 10),
                y: parseInt((oImg.top - oImg.getHeight() / 2 - c - 30) / 2, 10),
                width: parseInt(oImg.getWidth() / 2, 10),
                height: parseInt(oImg.getHeight() / 2, 10),
                angle: util.degreeToRadians(oImg.angle)
            },
            U.onComplete({
                rect: e
            }),
            dialogController.close(H))
        })
    }
    )();
    var e = dialogController.open(H, W);
    return {
        dialogWindow: e,
        controller: this,
        dialogView: H
    }
}
,
app.controllers.dialog.Referrals = function(e) {}
,
app.COUNTRIES_WITH_REGIONS = [1, 2, 3, 4],
app.controllers.dialog.Regions = function(o) {
    o = o || {};
    var e = "dialog-select-region"
      , a = lilo.createView(e)
      , t = util.cloneArray(socialApi.getCountries()).sort(function(e, t) {
        return e.id > t.id ? 1 : -1
    })
      , s = function(e) {
        return {
            selected: !1,
            id: -20,
            title: socialApi.getCountryName(e)
        }
    }
      , r = {
        countries: [],
        regions: [],
        selectedCountry: null,
        selectedRegion: null,
        isCountryWithRegions: !0,
        isValid: !1,
        pending: !1
    }
      , l = function() {
        i(-1, -1)
    }
      , i = function(i, n) {
        api.user.updateRegion({
            beforeSend: ajaxLoader.show,
            region_id: i,
            country_id: n
        }, function(e, t) {
            ajaxLoader.hide(),
            e ? dialogController.fadePopup({
                message: "Не удалось обновить данные"
            }) : (app.info.regionId = i,
            app.info.countryId = n,
            app.viewerProfile && app.viewerProfile.setAttr({
                regionId: i,
                countryId: n
            }),
            app.eventBus.trigger(app.EVENTS.REGION_CHANGED, {
                regionId: i
            }),
            o.onComplete && o.onComplete(),
            l = $.noop,
            dialogController.close(a))
        }).send()
    }
      , d = 1;
    function n() {
        r.setAttr({
            isValid: r.selectedCountry
        })
    }
    a.setModel(r),
    a.onRemove(function() {
        l()
    }),
    (n = o.validateMethod ? function() {
        o.validateMethod(r)
    }
    : n)(),
    r.onChange("selectedCountry", n),
    r.onChange("selectedCountry", function() {
        r.setAttr({
            isCountryWithRegions: r.selectedCountry && -1 !== app.COUNTRIES_WITH_REGIONS.indexOf(r.selectedCountry.id)
        })
    }),
    r.onChange("selectedRegion", n),
    o.withoutOtherCountry,
    $.each(t, function(e, t) {
        t.isCountry = !0,
        t.selected = !1
    }),
    r.countries.add(t),
    r.countries.length;
    var c, u, p, f, m = null;
    function v(e) {
        e = e.extraData.model;
        (e.isCountry ? g : b)(e)
    }
    function h() {
        r.isValid && (o.onSubmit ? o.onSubmit(r.selectedRegion, r.selectedCountry) : (r.selectedRegion || (r.selectedRegion = s(r.selectedCountry.id)),
        i(r.selectedRegion.id, r.selectedCountry.id)))
    }
    function g(e) {
        r.selectedCountry && e.id === r.selectedCountry.id || (r.selectedCountry && r.selectedCountry.setAttr({
            selected: !1
        }),
        e.setAttr({
            selected: !0
        }),
        r.setAttr({
            selectedCountry: e
        }),
        setTimeout(function() {
            r.isCountryWithRegions ? function() {
                if (r.selectedCountry) {
                    var i = d += 1;
                    if (r.regions.removeAll(),
                    r.setAttr({
                        selectedRegion: null
                    }),
                    r.setAttr({
                        pending: !0
                    }),
                    -1 === r.selectedCountry.id)
                        return r.setAttr({
                            pending: !1
                        }),
                        r.regions.add({
                            selected: !1,
                            id: -1,
                            title: "Другой регион"
                        });
                    var n = r.selectedCountry.id;
                    socialApi.getRegions({
                        country_id: n
                    }, function(e, t) {
                        i === d && (r.setAttr({
                            pending: !1
                        }),
                        t && ($.each(t, function(e, t) {
                            t.selected = !1,
                            1 === r.selectedCountry.id && (1045244 === t.id ? (t.title = "Санкт-Петербург и Ленинградская область",
                            t.title = "Санкт-Петербург и Ленинградская область") : 1053480 === t.id && (t.title = "Москва и Московская область"))
                        }),
                        0 === t.length && r.regions.add(s(n)),
                        r.regions.add(t),
                        m && (m(),
                        m = null)))
                    })
                }
            }() : (r.regions.removeAll(),
            r.setAttr({
                selectedRegion: null
            }))
        }, 0))
    }
    function b(e) {
        r.selectedRegion && e.id === r.selectedRegion.id ? o.toggleRegions && (e.setAttr({
            selected: !1
        }),
        r.setAttr({
            selectedRegion: null
        })) : (r.selectedRegion && r.selectedRegion.setAttr({
            selected: !1
        }),
        e.setAttr({
            selected: !0
        }),
        r.setAttr({
            selectedRegion: e
        }))
    }
    a.on("select:item-in-dialog-select-region", v),
    a.bind("select-item-mobi", v),
    a.on("submit:" + e, h),
    o.onSubmit && (l = $.noop),
    dialogController.open(a, {
        dialogClass: "small-close",
        mobiCloseCaption: "Сохранить",
        mobiCloseHandler: h
    }),
    -1 == o.currentCountryId && (o.currentCountryId = o.currentRegionId = null),
    o.currentCountryId && o.currentRegionId ? (p = 0,
    r.countries.each(function(e, t) {
        if (t.id === o.currentCountryId)
            return c = t,
            p = e,
            !1
    }),
    c ? (g(c),
    a.scrollToCountry(p),
    f = 0,
    r.regions.each(function(e, t) {
        if (t.id === o.currentRegionId)
            return f = e,
            u = t,
            !1
    }),
    u ? (b(u),
    setTimeout(function() {
        a.scrollToRegion(f)
    }, 100)) : m = function() {
        var i;
        r.selectedCountry === c && (i = 0,
        r.regions.each(function(e, t) {
            if (t.id === o.currentRegionId)
                return i = e,
                u = t,
                !1
        }),
        u && (b(u),
        setTimeout(function() {
            a.scrollToRegion(i)
        }, 100)))
    }
    ) : g(t[0])) : g(t[0]),
    this.view = a,
    this.model = r
}
,
app.controllers.dialog.AudiosList = function(o) {
    if (o.type = o.type || roomController.radioController.getType(),
    o.type === RadioPlayerType.YOUTUBE)
        return new app.controllers.dialog.YTTracks(o);
    var n = 80
      , e = o.type
      , a = "self_yt_tracks"
      , i = e === RadioPlayerType.YOUTUBE
      , s = i ? 200 : 80
      , t = i ? "dialog-yt-tracks" : "dialog-audios-list"
      , r = lilo.createView(t)
      , l = 197333171 === app.info.viewer_id ? 600 : o.maxDuration || 360
      , d = i ? "item-yt-track" : "item-audio";
    !i && r.showVKPrivacyHint && r.showVKPrivacyHint();
    var c, u = dialogController.open(r, i ? {
        dialogClass: "no-padding hide-close",
        mobiFullHeight: 1
    } : {
        mobiFullHeight: 1
    }), p = new app.controllers.SoundController, f = !1, m = null;
    function v(e) {
        e.youtube || (e.img = e.preview,
        e.duration = Math.floor(e.duration / 1e3),
        e.youtube = !0)
    }
    function h() {
        m && m.isPlaying && (m.setAttr({
            isPlaying: !1
        }),
        m = null,
        p.closeMusicStream())
    }
    i && (c = {
        searchId: 1,
        searchResultItems: [],
        searchPopularItems: [],
        searchRecentItems: [],
        searchMyItems: [],
        pending: !1
    },
    e = lilo.createView("list-yt-tracks"),
    r.onRemove(function() {
        var i;
        c.items.length && (i = [],
        c.items.each(function(e, t) {
            i.push({
                id: t.id,
                ytId: t.ytId,
                preview: t.preview,
                img: t.img,
                highPreview: t.highPreview,
                title: t.title,
                duration: t.duration
            })
        }),
        util.cache.save(a, i))
    }),
    e.setModel(c),
    r.els["my-tracks"].append(e.el),
    r.bind("add-track-by-link", function() {
        new app.controllers.dialog.AddYtTrack({
            onTrackCreate: function(e) {
                v(e),
                c.items.add(e, 0)
            }
        })
    }),
    new app.sdk.TabViewController({
        $container: r.els["tabs-block"],
        tabs: [{
            selected: !1,
            title: "Поиск",
            onOpen: function() {
                r.els["search-result"].show()
            },
            onClose: function() {
                r.els["search-result"].hide()
            }
        }, {
            selected: !0,
            title: "Популярные",
            onOpen: function() {
                r.els["search-result"].show()
            },
            onClose: function() {
                r.els["search-result"].hide()
            }
        }, {
            selected: !1,
            title: "Новые",
            onOpen: function() {
                r.els["search-result"].show()
            },
            onClose: function() {
                r.els["search-result"].hide()
            }
        }, {
            title: "Мои клипы",
            onOpen: function() {
                var i, e;
                r.els["my-tracks"].show(),
                c.items.length || (i = function(e) {
                    c.items.add(e)
                }
                ,
                c.pending || (c.setAttr({
                    pending: !0
                }),
                (e = util.cache.find(a)) ? (i(e),
                c.setAttr({
                    pending: !1
                })) : ServerApi("yt/my.php", {}, function(e, t) {
                    c.setAttr({
                        pending: !1
                    }),
                    e ? dialogController.showError(e) : ((t = t.videos.sort(function(e, t) {
                        return e.id === t.id ? 0 : e.id > t.id ? -1 : 1
                    })).each(function(e, t) {
                        v(t)
                    }),
                    util.cache.save(a, t),
                    i(t))
                })))
            },
            onClose: function() {
                r.els["my-tracks"].hide()
            }
        }]
    })),
    r.on("play:" + d, function(e) {
        var t = e.extraData.model;
        t.__hasError ? dialogController.fadePopup("Не удалось воспроизвести аудиозапись") : (h(),
        m = t,
        app.eventBus.trigger(app.EVENTS.AUDIO_PREVIEW_START),
        f = !0,
        p.playSound({
            url: i ? t.id : t.url,
            id: "yt-dialog-preview",
            position: 0,
            volume: 100,
            onError: function() {
                t.setAttr({
                    isPlaying: !1
                }),
                t.__hasError = !0,
                dialogController.fadePopup("Не удалось воспроизвести аудиозапись"),
                m = null
            },
            onComplete: function() {
                t.setAttr({
                    isPlaying: !1
                }),
                m = null
            }
        }),
        t.setAttr({
            isPlaying: !0
        }))
    }),
    r.on("stop:" + d, h),
    r.on("search:" + t, h);
    var g = !1;
    function b(e) {
        $.each(e, function(e, t) {
            t.isPlaying = !1
        });
        e = {
            items: e,
            type: o.type
        };
        r.setModel(e),
        r.on("submit:" + t, function(e) {
            var i = e.extraData.model;
            l && i.duration > l ? (e = parseInt(l / 60, 10),
            dialogController.fadePopup({
                message: "Нельзя добавлять песни длиннее {0} {1}".format(e, util.pluralize(e, {
                    one: "минуты",
                    two: "минут",
                    many: "минут"
                }))
            })) : function(e, t) {
                e.artist,
                e.title;
                e.__hasError ? t(!1) : t(!0)
            }(i, function(e) {
                var t;
                e ? (o.cropBeforeSubmit && (t = i.artist,
                e = i.title,
                t = $.trim(t),
                e = $.trim(e),
                t = t.substr(0, n),
                e = e.substr(0, s),
                i.artist = (e = [t, e])[0],
                i.title = e[1]),
                o.onSubmit(i),
                dialogController.close(r)) : dialogController.fadePopup({
                    message: "Ошибка. Не получается добавить эту песню"
                })
            })
        })
    }
    return r.bind("search-audio-by-world", function(e) {
        var t = e.extraData.key
          , n = e.extraData.searchId;
        o.type === RadioPlayerType.VK_AUDIO ? app.services.vk.searchAudios(t, function(e) {
            r.displaySearchResult(n, e)
        }) : g || (t = function(e) {
            var e = e.replace(/,|\.|\+|\-|\=|/g, "").split(" ")
              , i = [];
            if (e.each(function(e, t) {
                if ((t = $.trim(t).toLowerCase()).length && (30 < t.length && (t = t.substr(0, 30)),
                i.push(t),
                3 === i.length))
                    return !1
            }),
            i.length)
                return JSON.stringify(i);
            return null
        }(t)) && (r.showLoader("Поиск клипов..."),
        g = !0,
        setTimeout(function() {
            g = !1
        }, 200),
        ServerApi("yt/search.php", {
            key_worlds: t
        }, function(e, t) {
            var i;
            r.hideLoader(),
            e || (i = [],
            t.list.each(function(e, t) {
                i.push((t = t,
                {
                    artist: "",
                    duration: Math.floor(t.duration / 1e3),
                    youtube: !0,
                    id: t._id,
                    viewCount: 0,
                    thumbnail: t.photo,
                    img: t.photo,
                    title: t.title
                }))
            }),
            r.displaySearchResult(n, i))
        }))
    }),
    r.onRemove(function() {
        h(),
        f && app.eventBus.trigger(app.EVENTS.AUDIO_PREVIEW_STOP)
    }),
    r.showLoader(),
    o.submitBtnInnerHtml && r.els["submit-btn"].html(o.submitBtnInnerHtml),
    o.type === RadioPlayerType.VK_AUDIO ? app.services.vk.getAudios(function(e, t) {
        if (r.hideLoader(),
        dialogController.dialogIsOpen(r)) {
            if (e)
                return dialogController.fadePopup({
                    message: "Не удалось загрузить список аудиозаписей :(",
                    duration: 1e3
                }),
                void dialogController.close(r);
            b(t)
        }
    }) : b([]),
    {
        dialogWindow: u
    }
}
,
function() {
    var f = {};
    app.controllers.dialog.InviteUsersIntoRoom = function(t) {
        var e = t.roomModel
          , i = (t.roomView,
        e.roomId,
        app.info.viewer_id,
        util.isDef)
          , n = util.cloneArray(socialApi.getFriends()).filter(function(e) {
            return !i(e.deactivated)
        })
          , o = !1
          , u = {
            pending: !1,
            currentTab: null,
            resultList: [],
            tabFavUsers: {
                users: [],
                isFetch: !1,
                fetch: function() {
                    a.els["no-results"].hide();
                    function i() {
                        u.setAttr({
                            pending: !1
                        });
                        var e, t = u.tabFavUsers.users;
                        u.tabFavUsers.isFetch || r.setItems(t),
                        u.tabFavUsers.setAttr({
                            isFetch: !0
                        }),
                        0 === t.length ? (a.els.search.hide(),
                        a.els["no-results"].html("Избранные пользователи не найдены").show(),
                        u.resultList.removeAll()) : (u.resultList.removeAll(),
                        u.resultList.add(t),
                        a.els.search.show(),
                        e = r.getSearchWord() || "",
                        r.resetSearchWord(),
                        r.search(e),
                        setTimeout(function() {
                            a.els.search_input.val(e),
                            isMobi || a.els.search_input.focus()
                        }, 100))
                    }
                    {
                        var e;
                        u.tabFavUsers.isFetch || 0 === (e = util.getKeys(app.info.favUsersUids)).length ? i() : (u.setAttr({
                            pending: !0
                        }),
                        socialApi.getUsersInfo(e, function(e, t) {
                            o && (e ? (u.setAttr({
                                pending: !1
                            }),
                            dialogController.fadePopup("Не удалось загрузить список пользователей")) : (u.tabFavUsers.users.add(t.users),
                            i()))
                        }))
                    }
                },
                selected: !1
            },
            tabFriendsUsers: {
                users: n,
                isFetch: !0,
                fetch: function() {
                    {
                        var e;
                        a.els["no-results"].hide(),
                        0 === n.length ? (a.els["no-results"].html(t.friends ? "Список пуст" : "У вас нет друзей!").show(),
                        a.els.search.hide(),
                        u.resultList.removeAll()) : (a.els["no-results"].hide(),
                        a.els.search.show(),
                        e = l.getSearchWord() || "",
                        l.resetSearchWord(),
                        l.search(e),
                        setTimeout(function() {
                            a.els.search_input.val(e),
                            isMobi || a.els.search_input.focus()
                        }, 100))
                    }
                },
                selected: !1
            }
        }
          , e = "dialog-invite-users-into-self-room"
          , a = lilo.createView(e);
        function s(i) {
            function t(e) {
                e.sort(function(e, t) {
                    return e.online === t.online ? 0 : e.online ? -1 : 1
                }),
                $.each(e, function(e, t) {
                    t.__realFirstName = t.__realFirstName || util.escapeHtml(t.first_name),
                    t.__realLastName = t.__realLastName || util.escapeHtml(t.last_name)
                })
            }
            var n = null;
            function s(e) {
                return "<b>" + e + "</b>"
            }
            i && i.length && t(i),
            this.resetSearchWord = function() {
                n = null
            }
            ,
            this.getSearchWord = function() {
                return n
            }
            ,
            this.search = function(e) {
                var o, t, a;
                (e = e.toLowerCase()) !== n && (n = e,
                o = [],
                u.resultList.removeAll(),
                "" === e ? (t = i.slice(0, 40),
                $.each(t, function(e, t) {
                    t.first_name = t.__realFirstName,
                    t.last_name = t.__realLastName
                }),
                u.resultList.add(t)) : (a = new RegExp(e,"gi"),
                u.currentTab,
                $.each(i, function(e, t) {
                    var i = t.__realFirstName.replace(a, s)
                      , n = t.__realLastName.replace(a, s);
                    if (i !== t.__realFirstName && (t.first_name = i,
                    t.last_name = n,
                    o.push(t),
                    40 === o.length))
                        return !1
                }),
                u.resultList.add(o)))
            }
            ,
            this.setItems = function(e) {
                t(e),
                i = e
            }
        }
        a.onRemove(function() {
            o = !1
        }),
        a.setModel(u),
        a.on("show-tab:" + e, function(e) {
            c(e.extraData.index)
        }),
        a.on("search:" + e, function(e) {
            d && d.search(e.extraData.word)
        }),
        a.on("invite-user:" + e, function(e) {
            var d, c;
            t.onItemClick ? t.onItemClick(e.extraData.uid, e.extraData.targetEl) : (d = e.extraData.uid,
            0 < (e = function(e) {
                e = f[e] || 0;
                return 6e5 - (util.currentMillis() - e)
            }(d)) ? (e = 6e4 < e ? util.formatMillisToTime(e, function(e, t, i) {
                return (t = parseInt(t, 10)) + " " + util.pluralize(t, {
                    one: "минуту",
                    two: "минуты",
                    many: "минут"
                })
            }) : util.formatMillisToTime(e, function(e, t, i) {
                return (i = parseInt(i, 10)) + " " + util.pluralize(i, {
                    one: "секунду",
                    two: "секунды",
                    many: "секунд"
                })
            }),
            dialogController.fadePopup("Вы уже пригласили этого человека. Повторное приглашение будет доступно через " + e)) : (c = 1 !== u.currentTab || function(e) {
                for (var t = 0; t < n.length; t += 1)
                    if (n[t].id === e)
                        return !0;
                return !1
            }(d),
            u.setAttr({
                pending: !0
            }),
            app.services.vk.getUserOnlineAndAppUser(d, function(e, t) {
                u.setAttr({
                    pending: !1
                });
                var i, n = (util.isOKPlatform() ? 1 : 2) != (util.isOKAppUid(d) ? 1 : 2);
                if (e || !t || 0 === (!t.user || t.user.length) && !n)
                    dialogController.fadePopup("Не удалось выполнить запрос");
                else {
                    n && (t.user = [{
                        online: !1,
                        can_post: !1
                    }]);
                    var o = !0
                      , e = !!t.user[0].can_post && !isExternal;
                    t.user[0].online;
                    if (util.isVKPlatform() && !o)
                        try {
                            o = socialApi.getAppUsersUids().contains(d)
                        } catch (e) {}
                    var a = "Приглашаю тебя в мою приватную комнату"
                      , s = c && e
                      , r = c && !isExternal && !n
                      , l = function() {
                        u.setAttr({
                            pending: !0
                        }),
                        api.roomV3.privateRooms.sendInvite({
                            target_uid: d
                        }, function(e, t) {
                            u.setAttr({
                                pending: !1
                            }),
                            e && e.code === Codes.USER_IN_BLACK_LIST ? p() : e || !t.result ? dialogController.fadePopup("Не удалось отправить приглашение") : (dialogController.fadePopup("Приглашение успешно отправлено"),
                            f[d] = util.currentMillis())
                        }).send()
                    };
                    n = d,
                    i = function() {
                        s && isTester() ? app.services.vk.wallPost({
                            uid: d,
                            onComplete: function(e) {
                                e.cancel || l()
                            },
                            message: a,
                            attachment: "photo147863751_357948120"
                        }) : r ? app.services.vk.sendNotification({
                            uid: d,
                            message: a,
                            onComplete: function(e) {
                                e.cancel || l()
                            }
                        }) : s ? app.services.vk.wallPost({
                            uid: d,
                            onComplete: function(e) {
                                e.cancel || l()
                            },
                            message: a,
                            attachment: "photo147863751_357948120"
                        }) : l()
                    }
                    ,
                    u.setAttr({
                        pending: !0
                    }),
                    ServerApi("user/hasBlock.php", {
                        target_uid: n
                    }, function(e, t) {
                        u.setAttr({
                            pending: !1
                        }),
                        e ? dialogController.showError(e) : (t.hasBlock ? p : i)()
                    })
                }
            })))
        });
        var r = new s
          , l = new s(n)
          , d = null;
        function c(e) {
            u.currentTab !== e && (1 === (u.currentTab = e) ? (u.tabFriendsUsers.setAttr({
                selected: !1
            }),
            u.tabFavUsers.setAttr({
                selected: !0
            }),
            d = r,
            u.tabFavUsers.fetch()) : (u.tabFavUsers.setAttr({
                selected: !1
            }),
            u.tabFriendsUsers.setAttr({
                selected: !0
            }),
            d = l,
            u.tabFriendsUsers.fetch()),
            a.els.tab_fav[1 === e ? "addClass" : "removeClass"]("selected"),
            a.els.tab_friends[1 !== e ? "addClass" : "removeClass"]("selected"))
        }
        function p() {
            dialogController.fadePopup("Пользователь вас заблокировал")
        }
        this.open = function() {
            o = !0,
            dialogController.open(a, {
                mobiFullHeight: 1
            }),
            t.onlyFriends ? (c(2),
            a.$(".tabs-block").remove()) : c(1)
        }
        ,
        this.close = function() {
            o = !1,
            dialogController.close(a)
        }
        ,
        this.getModel = function() {
            return u
        }
        ,
        t.friends && t.favUsers ? (n = t.friends,
        u.tabFavUsers.users = t.favUsers,
        u.tabFavUsers.isFetch = !0,
        u.tabFriendsUsers.users = n,
        r = new s(t.favUsers),
        l = new s(t.friends),
        a.el.addClass("online-friends-dialog")) : t.needUpdateFavUsersFromServer && (u.setAttr({
            pending: !0
        }),
        a.els["no-results"].hide(),
        ServerApi("room/v3/dialogOnlineUsers/getData.php", {
            online_uids: util.getKeys(app.info.favUsersUids).join("_"),
            uids: util.getKeys(app.info.favUsersUids).join("_")
        }, function(e, n) {
            var i, o;
            u.setAttr({
                pending: !1
            }),
            e ? dialogController.showError("Произошла ошибка при получении данных") : (i = function(e, t) {
                return {
                    online: (i = e._id,
                    !!n.roomIds[i]),
                    id: e._id,
                    photo_100: e.p100,
                    first_name: e.fn,
                    last_name: e.ln
                };
                var i
            }
            ,
            o = [],
            n.users.each(function(e, t) {
                o.push(i(t))
            }),
            o.sort(function(e, t) {
                return e.online === t.online ? 0 : e.online ? -1 : 1
            }),
            u.tabFavUsers.users = o,
            u.tabFavUsers.isFetch = !0,
            r = new s(o),
            u.currentTab = -100500,
            c(1))
        }))
    }
}(),
app.controllers.dialog.OnlineFriends = function(e) {
    var l = e.roomModel
      , n = e.onFriendListLoad || $.noop
      , d = new app.controllers.RoomResponseParser
      , c = e.roomController
      , t = app.services.vk.getAppUsersUids()
      , u = $.map(util.getKeys(app.info.favUsersUids), function(e) {
        return parseInt(e, 10)
    })
      , p = {};
    function i(o) {
        function n(e, t) {
            return {
                inRoom: !!t,
                online: !!t,
                id: e.id,
                roomId: t,
                photo_100: e.photo_100,
                first_name: e.first_name,
                last_name: e.last_name
            }
        }
        function e(e, t) {
            return e.inRoom === t.inRoom ? e.online === t.online ? 0 : e.online ? -1 : 1 : e.inRoom ? -1 : 1
        }
        var a = []
          , s = [];
        $.each(t, function(e, t) {
            var i = p[t];
            i && !i.deactivated && (t = o[t],
            s.push(n(i, t)))
        }),
        $.each(u, function(e, t) {
            var i = p[t];
            i && !i.deactivated && (t = o[t],
            a.push(n(i, t)))
        }),
        s.sort(e),
        a.sort(e);
        var r = new app.controllers.dialog.InviteUsersIntoRoom({
            roomModel: l,
            favUsers: a,
            friends: s,
            onItemClick: function(e, t) {
                var i = p[e]
                  , n = o[e];
                i && n ? dialogController.showMessageDialog({
                    message: "Хотите перейти в комнату с этим пользователем?",
                    buttons: [{
                        caption: "Да",
                        className: isMobi ? "" : "btn blue",
                        handler: function() {
                            return r.close(),
                            n === l.roomId && l.hasUser(app.info.viewer_id) && l.hasUser(e) ? dialogController.fadePopup("Вы уже находитесь в одной комнате") : function(e) {
                                ajaxLoader.show();
                                var n = function(i) {
                                    l.__communicator.getRoom({
                                        beforeSend: ajaxLoader.show,
                                        force: !0,
                                        skip_restrictions: i,
                                        target_uid: e,
                                        onComplete: function(e, t) {
                                            ajaxLoader.hide(),
                                            e ? e.code === Codes.TOO_FREQ_ROOM_SWITCH ? dialogController.showDialogRoomSwitchTooFreq(t ? t.left : 0, {
                                                price: (t || {}).price,
                                                paymentJoin: function() {
                                                    n(i)
                                                }
                                            }) : e.code === Codes.NOT_ENOUGH_EXP_TO_ADD_ROOM ? dialogController.showMessageDialog({
                                                message: "У Вас недостаточно рейтинга, чтобы попасть в эту комнату"
                                            }) : e.code === Codes.ROOM_QUEUE_IS_FULL ? dialogController.showMessageDialog({
                                                message: "Не удалось подключиться к комнате. Очередь заполнена"
                                            }) : e.code === Codes.USER_IN_BLACK_LIST ? dialogController.showMessageDialog({
                                                message: "Невозможно войти в комнату"
                                            }) : e.code === Codes.ACCESS_DENIED ? dialogController.showMessageDialog({
                                                message: "Не удалось подключиться к комнате"
                                            }) : e.code === Codes.LEAVE_FROM_CURRENT_ROOM_IS_NOT_ALLOWED ? c.onLeaveRoomIsNotAllowed(e.requestParams) : e.code === Codes.ROOM_ACCESS_DESCR ? dialogController.roomExpLimitDialog(t) : e.code === Codes.USER_NOT_FOUND ? dialogController.showMessageDialog({
                                                message: "Не удалось подключиться к комнате. Пользователь вышел"
                                            }) : dialogController.showMessageDialog({
                                                message: "При запросе произошла ошибка<br>" + errorHandler.getFullMessage(e)
                                            }) : (t.ctm && l.setCtm(t.ctm),
                                            (e = d.parse(t.roomData)).isSummary ? (l.setAttr({
                                                pending: !0
                                            }),
                                            l.roomId = e.roomId,
                                            c.showQueue(e)) : (l.setAttr({
                                                pending: !1
                                            }),
                                            l.__communicator.config.onGetRoom(t.roomData, t.gifts, t.changeId, !!t.canSendFreeNote)))
                                        }
                                    })
                                };
                                app.services.vk.isFriend(e) ? n(!0) : c.checkRoomForFriends({
                                    target_uid: e
                                }, function(e) {
                                    n(e)
                                })
                            }(e),
                            !1
                        }
                    }, {
                        mobiClose: 1,
                        caption: "Нет",
                        handler: function() {
                            return !1
                        }
                    }]
                }) : dialogController.fadePopup("В данный момент этот пользователь отсутствует в игре")
            }
        });
        r.open()
    }
    var o, a;
    o = $.Deferred(),
    a = {},
    t.each(function(e, t) {
        a[t] = t
    }),
    u.each(function(e, t) {
        util.isOKAppUid(t) || (a[t] = t)
    }),
    o.resolve(util.getValues(a)),
    o.promise().then(function(e) {
        var t, i, n, o = $.Deferred();
        return e.length ? (t = [],
        i = e.chunks(900),
        (n = function() {
            var e;
            i.length ? (e = i[i.length - 1],
            --i.length,
            VKApi("users.get", {
                user_ids: e.join(","),
                fields: "online,first_name,last_name,photo_100"
            }, function(e) {
                e.error ? o.reject(e.error) : (e = e.response,
                util.insertArrayAt(t, t.length, e),
                n())
            }, "5.120")) : o.resolve(t)
        }
        )()) : o.resolve([]),
        o.promise()
    }).then(function(e) {
        var t = $.Deferred();
        e.each(function(e, t) {
            p[t.id] = t
        });
        var i = {};
        e.each(function(e, t) {
            t.online,
            i[t.id] = t.id
        }),
        u.each(function(e, t) {
            util.isOKAppUid(t) && (i[t] = t)
        });
        e = {
            inlineUids: util.getValues(i),
            socialApiUsers: e
        };
        return t.resolve(e),
        t.promise()
    }).then(function(e) {
        var i = $.Deferred();
        return ServerApi("room/v3/dialogOnlineUsers/getData.php", {
            method: "POST",
            online_uids: e.inlineUids.join("_"),
            uids: u.join("_")
        }, function(e, t) {
            e ? i.reject(e) : i.resolve(t)
        }),
        i.promise()
    }).then(function(e) {
        n(),
        console.info("data", e),
        e.users.each(function(e, t) {
            p[t._id] = {
                id: t._id,
                photo_100: t.p100,
                first_name: t.fn,
                last_name: t.ln
            }
        }),
        i(e.roomIds)
    }).fail(function(e) {
        var t, i;
        n(),
        console.info("err", e);
        try {
            t = e.error_code || e.code
        } catch (e) {}
        try {
            i = errorHandler.getFullMessage(e)
        } catch (e) {}
        e = "Произошла ошибка при получении списка друзей";
        t && (e = e + "<br>Code:" + t),
        i && (e = e + "<br>" + i),
        dialogController.fadePopup({
            message: e,
            duration: 6e3
        })
    })
}
,
function() {
    var o = {
        GIRL: 1,
        BOY: 2,
        NICHOSI: 3,
        MEM: 4,
        MUZHIK: 5,
        SEXY_GIRL: 6,
        MEM2: 7,
        ZVEREK: 8,
        SNEZHOK: 10,
        CIPA: 11,
        HARLEY: 12,
        HALLOWEEN: 13,
        ZOLOTOI: 14,
        FENEK: 15,
        KOKO: 16,
        ZAZA: 17,
        RED_PANDA: 18,
        F_2016: 20,
        COMBO_MALE: 30,
        COMBO_FEMALE: 31,
        COMBO_RESULT: 32,
        SIBU: 33,
        KHASKI: 34,
        KOALA_MAN: 35,
        KOALA_GIRL: 36,
        EZH: 37,
        SKANI: 38,
        B_BO: 39,
        KATERINA: 40,
        STALIN: 41,
        PINGVI: 42,
        DANCE_MALE: 43,
        DANCE_FEMALE: 44,
        DANCE_RESULT: 45,
        ZABIVAKA: 46,
        RED_CAT: 47,
        HRU: 48,
        TEDDY: 49,
        PUTIN_23: 50,
        CAT1: 1001,
        CAT2: 1002
    };
    function a(e) {
        return 1 === e ? "girl" : 2 === e ? "boy" : 3 === e ? "nichosi" : 4 === e ? "mem" : 5 === e ? "muzhik" : 6 === e ? "sexy_girl" : 7 === e ? "mem2" : 8 === e ? "zverek" : 10 === e ? "snezhok" : 11 === e ? "cipa" : 12 === e ? "harley" : 13 === e ? "halloween" : 14 === e ? "zolotoi" : 15 === e ? "fenek" : 16 === e ? "koko" : 17 === e ? "zaza" : 18 === e ? "red_panda" : 1001 === e ? "cat1" : 1002 === e ? "cat2" : 20 === e ? "f2016" : 30 === e ? "combo-male" : 31 === e ? "combo-female" : 32 === e ? "combo-result" : 33 === e ? "sibu" : 34 === e ? "khaski" : 35 === e ? "koala_man" : 36 === e ? "koala_girl" : 37 === e ? "ezh" : 38 === e ? "skani" : 39 === e ? "b_bo" : 40 === e ? "katerina" : 41 === e ? "stalin" : 42 === e ? "pingvi" : 43 === e ? "dance-male" : 44 === e ? "dance-female" : 45 === e ? "dance-result" : 46 === e ? "zabivaka" : 47 === e ? "red_cat" : 48 === e ? "hru" : 49 === e ? "teddy" : 50 === e ? "putin_23" : "null"
    }
    function n(e) {
        $.extend(this, e)
    }
    n.parse = function(e) {
        try {
            if (e && e.v)
                return new n(e)
        } catch (e) {}
        return null
    }
    ,
    n.getViewerConfig = function(e, t) {
        t = t || app.info.sex,
        e = e || 0;
        var i = n.parse(app.info["stickerConfig" + (1 === t || 2 === t ? "" : t + "")]);
        return i && (i.id = e,
        i.v !== t && (i = null)),
        (i = !i || !i.isValidForViewer() ? n.createDefault(t) : i).id = e,
        i
    }
    ,
    n.parseOrDefault = function(e, t) {
        var i, t = t ? 2 : 1;
        try {
            i = new n("string" == typeof e ? JSON.parse(e) : e)
        } catch (e) {}
        return i = !i || !i.isValid() ? n.createDefault(t) : i
    }
    ,
    n.createDefault = function(e) {
        return new n(1 === (e = e || app.info.sex) ? {
            v: 1,
            id: 0,
            bodyColor: 2,
            eyeColor: 1,
            hairColor: 2,
            hairId: 0,
            skinColor: 0
        } : 2 === e ? {
            v: 2,
            id: 0,
            beardColor: 0,
            beardId: -1,
            bodyColor: 0,
            eyeColor: 3,
            hairColor: 0,
            hairId: 3,
            skinColor: 0
        } : {
            v: e,
            id: 0,
            color: 0
        })
    }
    ,
    n.getPrice = function(e) {
        return 1
    }
    ,
    $.extend(n.prototype, {
        __layersQueue: ["hair-back", "body", "heads", "eyes", "beards", "hair", "faces", "hands", "base"],
        toDocumentFragment: function() {
            var n = this.toUrls()
              , o = document.createDocumentFragment();
            return this.__layersQueue.each(function(e, t) {
                var i;
                n[t] && o.appendChild((i = n[t],
                (t = document.createElement("div")).style.backgroundImage = "url(" + i + ")",
                t))
            }),
            o
        },
        getUrl: function(e, t, i) {
            return CDN_PREFIX + "stickers/{0}/stick{1}/{2}/color{3}/{4}.png".format(a(this.v), this.id, e, t, i)
        },
        toUrls: function() {
            var e = this
              , i = CDN_PREFIX + "stickers/{0}/stick{1}/".format(a(e.v), this.id)
              , n = e.v === o.BOY || e.v === o.GIRL ? {
                beards: 0 <= e.beardId ? "color" + e.beardColor + "/" + e.beardId : null,
                faces: "color" + e.eyeColor + "/0",
                hands: "color" + e.skinColor + "/0",
                heads: "color" + e.skinColor + "/" + e.hairId,
                hair: "color" + e.hairColor + "/" + e.hairId,
                "hair-back": "color" + e.hairColor + "/" + e.hairId,
                body: "color" + e.bodyColor + "/0"
            } : {
                base: "color0/0"
            };
            return $.each(n, function(e, t) {
                t && (n[e] = i + e + "/" + t + ".png?v=4")
            }),
            n
        },
        serializeToObj: function() {
            var i = {}
              , n = this;
            return ["v", "hairColor", "skinColor", "bodyColor", "eyeColor", "hairId", "beardColor", "beardId"].each(function(e, t) {
                -1 <= n[t] && (i[t] = n[t])
            }),
            i
        },
        __isValid: function(e) {
            var t = this;
            return e === o.NICHOSI ? 0 <= t.id && t.id <= 6 : e === o.MEM ? 0 <= t.id && t.id <= 27 : e === o.MUZHIK ? 0 <= t.id && t.id <= 15 : e === o.ZVEREK ? 0 <= t.id && t.id <= 21 : e === o.F_2016 ? 0 <= t.id && t.id <= 15 : e === o.SNEZHOK || e === o.CIPA ? 0 <= t.id && t.id <= 19 : e === o.HARLEY ? 0 <= t.id && t.id <= 15 : e === o.HALLOWEEN || e === o.ZOLOTOI || e === o.FENEK ? 0 <= t.id && t.id <= 19 : e === o.KOKO ? 0 <= t.id && t.id <= 23 : e === o.ZAZA ? 0 <= t.id && t.id <= 17 : e === o.RED_PANDA ? 0 <= t.id && t.id <= 19 : e === o.CAT1 || e === o.CAT2 ? 0 <= t.id && t.id <= 20 : e === o.SEXY_GIRL ? 0 <= t.id && t.id <= 19 : e === o.MEM2 ? 0 <= t.id && t.id <= 23 : e === o.SIBU ? 0 <= t.id && t.id <= 27 : e === o.KHASKI ? 0 <= t.id && t.id <= 19 : e === o.KOALA_MAN || e === o.KOALA_GIRL ? 0 <= t.id && t.id <= 15 : e === o.EZH || e === o.SKANI || e === o.B_BO || e === o.KATERINA || e === o.STALIN || e === o.PINGVI || e === o.COMBO_MALE || e === o.COMBO_FEMALE ? 0 <= t.id && t.id <= 19 : e === o.COMBO_RESULT ? 0 <= t.id && t.id <= 50 : e === o.DANCE_MALE || e === o.DANCE_FEMALE || e === o.DANCE_RESULT ? 0 <= t.id && t.id <= 16 : e === o.ZABIVAKA ? 0 <= t.id && t.id <= 15 : e === o.RED_CAT ? 0 <= t.id && t.id <= 19 : e === o.HRU ? 0 <= t.id && t.id <= 15 : e === o.TEDDY ? 0 <= t.id && t.id <= 19 : e === o.PUTIN_23 ? 0 <= t.id && t.id <= 11 : t.v === e && 0 <= t.id && t.id <= 15 && 0 <= t.hairColor && t.hairColor <= (2 === t.v ? 2 : 3) && 0 === t.skinColor && 0 <= t.bodyColor && t.bodyColor <= 4 && 0 <= t.eyeColor && t.eyeColor <= 4 && 0 <= t.hairId && t.hairId <= 4 && (2 !== e || 0 <= t.beardColor && t.beardColor <= 2 && -1 <= t.beardId && t.beardId <= 4)
        },
        isValid: function() {
            var i = !1
              , n = this;
            return $.each(o, function(e, t) {
                if (n.__isValid(t))
                    return !(i = !0)
            }),
            i
        },
        isValidForViewer: function() {
            return this.__isValid(app.info.sex)
        }
    }),
    app.controllers.dialog.Stickers = function() {
        this.openEditor = function(e) {
            e = e || {};
            var e = app.info.stickerConfig && app.info.stickerConfig.id ? app.info.stickerConfig.id : e.id || 0
              , t = lilo.createView("dialog-stickers-editor")
              , i = n.getViewerConfig(e);
            t.setModel(i),
            t.bind("save", function() {
                var e;
                i.v !== app.info.sex && 1 === i.v || ((e = i.serializeToObj()).id = i.id,
                app.info.stickerConfig = e,
                app.eventBus.trigger(app.EVENTS.STICKER_CONFIG_CHANGED, {
                    config: e
                }),
                dialogController.close(t),
                api.user.sticker.save({
                    requestParams: {
                        serialized_config: JSON.stringify(e)
                    }
                }, function(e, t) {}).send())
            }),
            t.bind("change-property", function(e) {
                var t = {};
                t[e.extraData.propertyName] = e.extraData.value,
                i.setAttr(t)
            }),
            2 === i.v && i.onChange("hairColor", function() {
                i.setAttr({
                    beardColor: i.hairColor
                })
            }),
            t.el.on("click", ".next", function() {
                var e = i.id + 1;
                i.setAttr({
                    id: e = 15 < e ? 0 : e
                })
            }),
            t.el.on("click", ".prev", function() {
                var e = i.id - 1;
                i.setAttr({
                    id: e = e < 0 ? 15 : e
                })
            }),
            dialogController.open(t, {
                dialogCss: {
                    padding: "0px"
                },
                dialogClass: "small-close"
            })
        }
    }
    ,
    app.controllers.dialog.Stickers.Configuration = n,
    app.controllers.dialog.Stickers.SET_TYPE = o,
    app.controllers.dialog.Stickers.getFolderOfSetType = a
}(),
app.controllers.dialog.InvisSettings = function(e) {
    function i() {
        return o.isVisible
    }
    var n = e.bootData
      , o = lilo.createView("dialog-invis-setiings")
      , a = {
        priceForExtend: 50,
        expired: n.invisTs,
        hasInvis: n.invis,
        hasHiddenPlayer: n.hp,
        pending: !1
    };
    o.addOption('Опция "Гость невидимка"', n.invis, ['Отображаться как "Невидимка" в списках гостей', "Писать анонимные комментарии на страницах", 'Включать опцию "Скрытая игра" (статус офлайн в игре, невидимка в топе и прочих разделах)'], function(e) {
        a.setAttr({
            hasInvis: e
        })
    }),
    o.addOption('Опция "Скрытая игра в комнате"', n.hp, ["Вас видят только игроки внутри комнаты", 'Ваш статус становится "офлайн" и скрывается дата последнего захода в игру', 'В топе "Комнаты-Лидеры" Ваша аватарка будет "Невидимка"', 'В разделе "Играть с друзьями" (Избранные/Друзья) Ваш статус офлайн', 'В разделе "Поиск" Ваш профиль будет отображаться среди пользователей офлайн'], function(e) {
        a.setAttr({
            hasHiddenPlayer: e
        })
    }),
    o.bind("extend-period", function() {
        var e;
        a.pending || app.balanceModel.canChange() && (e = a.priceForExtend,
        (e = app.balanceModel.balance - e) < 0 ? dialogController.showInsufficientlyBalanceDialog(e) : api.user.extendInvisible({
            beforeSend: function() {
                a.setAttr({
                    pending: !0
                })
            }
        }, function(e, t) {
            a.setAttr({
                pending: !1
            }),
            util.isDef(t.balance) && app.balanceModel.setAttr({
                balance: t.balance
            }),
            e ? e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit) : e.code === Codes.LOTTERY_IS_ACTIVE ? dialogController.lotteryIsActiveDialog(o) : e.code === Codes.INVISIBLE_NOT_BOUGHT ? (app.eventBus.trigger(app.EVENTS.INVISIBILITY_EXPIRED),
            dialogController.close(o)) : i() && dialogController.fadePopup("Произошла ошибка. Code:" + e.code) : (n.invisTs = t.invisTs,
            a.setAttr({
                expired: t.invisTs
            }))
        }).send(util.random(100, 300)))
    }),
    o.bind("save", function() {
        a.pending || (a.hasInvis !== n.invis || a.hasHiddenPlayer !== n.hp ? api.user.updateInvisible({
            requestParams: {
                hidden_player: !!a.hasHiddenPlayer,
                invis: !!a.hasInvis
            },
            beforeSend: function() {
                a.setAttr({
                    pending: !0
                })
            }
        }, function(e, t) {
            a.setAttr({
                pending: !1
            }),
            e ? e.code === Codes.INVISIBLE_NOT_BOUGHT ? (app.eventBus.trigger(app.EVENTS.INVISIBILITY_EXPIRED),
            dialogController.close(o)) : i() && dialogController.fadePopup("Произошла ошибка. Code:" + e.code) : (n.invis = t.invis,
            n.hp = t.hp,
            i() && dialogController.fadePopup("Настройки обновлены"),
            dialogController.close(o))
        }).send(util.random(100, 300)) : dialogController.close(o))
    }),
    this.open = function() {
        o.isVisible = !0,
        o.setModel(a),
        dialogController.open(o, {
            dialogCss: {
                padding: "0px"
            },
            dialogClass: "small-close"
        }),
        o.onRemove(function() {
            o.isVisible = !1
        })
    }
    ,
    this.dialogView = o
}
,
app.controllers.dialog.WheelOfFortune = function() {
    var u = this
      , L = 1500
      , F = 0
      , V = $.noop;
    function B(e, t, i) {
        return 3 * i * (1 - i) * (1 - i) * e + 3 * i * i * (1 - i) * t + i * i * i
    }
    function p(u, p) {
        var l = parseInt(1e3 / 30)
          , d = l
          , c = (Math.max,
        Math.min,
        Math.abs)
          , i = Math.sqrt
          , f = Math.sin
          , m = (Math.asin,
        Math.cos,
        Math.PI)
          , v = 2 * Math.PI
          , h = function(e) {
            return e * m / 180
        }
          , g = new n(51,200)
          , b = {
            stageWidth: 478,
            stageHeight: 394,
            arrowOrigin: new n(51,200),
            drumOrigin: new n(278,200),
            handleRadius: 7,
            handlesCount: 20,
            drumRadius: 184,
            arrowLength: 50,
            arrowBaseLength: 70,
            drumAngle: h(9),
            arrowAngle: 0,
            drumSpeed: 1,
            arrowSpeed: 1
        };
        function n(e, t) {
            this.x = e,
            this.y = t
        }
        function C(e) {
            function t() {
                r.clearRect(0, 0, e.width, e.height),
                T.render(r),
                D.render(r)
            }
            function i(e) {
                var t = (util.currentMillis() - U) / L
                  , i = !1;
                1 < t && (i = !0,
                t = 1),
                t <= 1 && (t = function(e, t, i, n, o) {
                    for (var a = F; 0 < o - B(e, i, a) && a < 1; )
                        a += .001;
                    return B(t, n, F = a)
                }(.28, .94, .71, 1, t),
                T.angle = (P + k * t) % v,
                t = c(N - T.angle),
                T.speed = (t = m < t ? m - t : t) / e,
                N = T.angle,
                function(e) {
                    for (var t = !1, i = 0; i < b.handlesCount; i += 1) {
                        for (; function(e, t) {
                            if (T.speed > M) {
                                if (D.angle > S[0])
                                    return !0;
                                t = t || l;
                                var i = util.currentMillis();
                                return 1e3 * t < i - A && (A = i,
                                !0)
                            }
                            var n = (2 * m / b.handlesCount * e + T.angle) % (2 * m);
                            if (0 <= n) {
                                if (Math.abs(n - h(180)) > h(10))
                                    return !1
                            } else if (Math.abs(2 * Math.PI + n - h(180)) > h(10))
                                return !1;
                            t = O(n, T.radius, T.origin),
                            i = O(D.angle, b.arrowLength, g),
                            e = O(D.angle + Math.PI / 2, b.arrowBaseLength / 2, g),
                            n = x(i, e),
                            e = x(i, t),
                            e = n - e,
                            i = t.distance(i),
                            i = f(e) * i;
                            return c(i) < b.handleRadius
                        }(i, e); )
                            D.angle -= m / 180,
                            t = !0;
                        D.angle < _ ? D.angle = _ : 0 < D.angle && (D.angle = 0)
                    }
                    t && function() {
                        var e = util.currentMillis()
                          , t = !1;
                        95 < e - E && (t = !0);
                        E = e,
                        t ? w() : I() && (E = e,
                        e = 80 * (M / T.speed),
                        app.soundManager.play(app.soundManager.SOUND_IDS.WF_ARROW_HIT, {
                            minDelay: e,
                            force: !0
                        }))
                    }()
                }(e)),
                D.angle < 0 && (D.angle += e * b.arrowSpeed,
                0 < D.angle && (D.angle = 0)),
                i && (-.02 < D.angle || isMobi) && (y.stop(),
                setTimeout(V, isMobi ? 600 : 0))
            }
            var n = !1
              , o = 0
              , a = 0
              , s = function() {
                try {
                    var e;
                    u.isVisible && n && (e = (new Date).getTime(),
                    l < e - o && (i((e - o) / 1e3),
                    o = e),
                    d < e - a && (t(),
                    a = e),
                    requestAnimationFrame(s))
                } catch (e) {
                    console.error(e)
                }
            }
              , r = e.canvas.getContext("2d");
            e.canvas.width = e.width,
            e.canvas.height = e.height,
            e.canvas.style.width = e.width + "px",
            e.canvas.style.height = e.height + "px",
            this.start = function() {
                n = !0,
                o = (new Date).getTime(),
                s()
            }
            ,
            this.draw = t,
            this.stop = function() {
                n = !1
            }
            ,
            this.isStarted = function() {
                return n
            }
        }
        isMobi && (b = {
            stageWidth: 478,
            stageHeight: 394,
            arrowOrigin: new n(80,200),
            drumOrigin: new n(278,200),
            handleRadius: 7,
            handlesCount: 20,
            drumRadius: 184,
            arrowLength: 50,
            arrowBaseLength: 70,
            drumAngle: h(9),
            arrowAngle: 0,
            drumSpeed: 1,
            arrowSpeed: 1
        }),
        n.prototype = {
            distanceByCoords: function(e, t) {
                e = this.x - e,
                t = this.y - t;
                return i(e * e + t * t)
            },
            distance: function(e) {
                return this.distanceByCoords(e.x, e.y)
            }
        };
        var _ = h(-45)
          , e = {
            minDelay: 1,
            force: !0
        }
          , w = function() {
            app.soundManager.play(app.soundManager.SOUND_IDS.WF_ARROW_HIT, e)
        }
          , E = 0;
        var y, D, T, S = [h(-37), h(-34)], A = 0, I = function() {
            return T.speed > M && D.angle <= S[1] && D.angle <= S[0]
        }, M = 2.5;
        function O(e, t, i) {
            return new n(Math.cos(e) * t + i.x,Math.sin(e) * t + i.y)
        }
        function x(e, t) {
            return Math.abs(e.x - t.x) < .001 ? 0 : Math.atan((t.y - e.y) / (t.x - e.x))
        }
        function R(e) {
            e.width;
            this.radius = e.radius,
            this.angle = e.angle || 0,
            this.speed = 0,
            this.acceleration = 0,
            this.origin = e.origin,
            this.update = $.noop,
            this.render = $.noop,
            this.angleAsRad = function() {
                return this.angle
            }
            ,
            this.angleAsDegree = function() {
                return this.angle * (180 / m)
            }
        }
        var k = 0
          , P = 0
          , N = 0
          , U = 0;
        u.startSpin = function(e, t, i) {
            var n = h(t)
              , o = 0
              , t = T.angle % (2 * m)
              , o = t < n ? n - t : 2 * m - t + n
              , n = 4;
            isMobi && (L = 1500 + 3e3 * e / 100,
            n = 7);
            e = Math.floor(Math.max(1, Math.round(n * e / 100)));
            F = 0,
            k = e * m * 2 + o,
            P = t,
            U = util.currentMillis(),
            N = P,
            V = i,
            y.start()
        }
        ,
        u.loadImagesAndRender = function() {
            function e() {
                i || (i = !0,
                u.trigger("initial-render-error"))
            }
            function t() {
                var t, i, n, o;
                ++a === s && (y = u.stageInstance = window.wheelStage = new C({
                    canvas: u.$("canvas")[0],
                    width: b.stageWidth,
                    height: b.stageHeight
                }),
                D = u.arrowInstance = new R({
                    radius: b.arrowLength,
                    origin: b.arrowOrigin,
                    angle: b.arrowAngle
                }),
                T = u.wheelInstance = new R({
                    radius: b.drumRadius,
                    origin: b.drumOrigin,
                    angle: b.drumAngle + h(isMobi ? 53 : 306)
                }),
                window._drum = T,
                t = !0,
                isMobi && (c.width = 76,
                c.height = 76,
                t = !1),
                D.render = function(e) {
                    e.save(),
                    e.translate(this.origin.x, this.origin.y),
                    t && e.rotate(this.angle),
                    e.drawImage(c, -c.width / 2, -c.height / 2, c.width, c.height),
                    e.restore()
                }
                ,
                i = isMobi ? 150 : 108,
                n = h(-9),
                o = isMobi ? function(e) {
                    e.save(),
                    e.translate(T.origin.x, T.origin.y),
                    e.drawImage(r, -188, -188, 376, 376),
                    e.restore()
                }
                : $.noop,
                T.render = function(e) {
                    e.save(),
                    e.translate(this.origin.x, this.origin.y),
                    e.rotate(this.angle + n),
                    e.drawImage(d, -189, -189, 378, 378),
                    e.restore(),
                    o(e),
                    e.save(),
                    e.translate(this.origin.x, this.origin.y),
                    e.drawImage(l, -i / 2, -i / 2, i, i),
                    e.restore()
                }
                ,
                y.draw(),
                u.setModel(p),
                u.trigger("initial-render-complete"))
            }
            var i = !1
              , a = 0
              , s = isMobi ? 4 : 3
              , r = new Image
              , l = new Image
              , d = new Image
              , c = new Image;
            d.onload = t,
            c.onload = t,
            l.onload = t,
            r.onload = t,
            d.onerror = e,
            c.onerror = e,
            l.onerror = e,
            r.onerror = e,
            l.src = CDN_PREFIX + (isMobi ? "wheel-mobi-v2/heart.png" : "wheel/wheel_heart.png"),
            d.src = CDN_PREFIX + (isMobi ? "wheel-mobi-v2/koleso3_1.png" : "wheel/wheel.png?v=2"),
            c.src = CDN_PREFIX + (isMobi ? "wheel-mobi-v2/arrow.png" : "wheel/pointerl.png"),
            isMobi && (r.src = CDN_PREFIX + "wheel-mobi-v2/wheel-overlay.png")
        }
    }
    u.openReceivedGiftsDialog = function(e, t) {
        (t = t || {}).onClose = t.onClose || $.noop;
        function o() {
            dialogController.fadePopup("Вы приняли максимальное количество вращений за сутки")
        }
        var i = lilo.createView("dialog-wf-rg")
          , n = []
          , a = "item-free-spin-gift"
          , s = 5
          , r = {
            items: [],
            pending: !1
        }
          , l = {};
        socialApi.getFriends().each(function(e, t) {
            l[t.id] = t
        }),
        e.each(function(e, t) {
            var i = l[t.s]
              , i = i && i.can_post;
            n.push({
                senderUid: t.s,
                ts: t.t,
                giftsCount: t.v,
                flag: t.f,
                senderSex: t.sex,
                senderFullName: t.fn + " " + t.age,
                senderPhoto: t.p100,
                _id: t._id,
                pending: !1,
                canPost: i
            })
        }),
        i.setModel(r),
        dialogController.open(i, {
            dialogClass: "small-close no-padding full-screen"
        }),
        setTimeout(function() {
            r.items.add(n)
        }, 100),
        i.onRemove(function() {
            try {
                t.onClose()
            } catch (e) {
                console.error(e)
            }
        }),
        i.on("receive:" + a, function(i) {
            var n;
            r.pending || (s <= 0 ? o() : (n = i.extraData.model).pending || (n.setAttr({
                pending: !0
            }),
            r.setAttr({
                pending: !0
            }),
            api.wheeloffortune.freeSpin.receive({
                requestParams: {
                    id: n._id
                }
            }, function(e, t) {
                n.setAttr({
                    pending: !1
                }),
                r.setAttr({
                    pending: !1
                }),
                e ? e.code === Codes.LIMIT ? (o(),
                s = 0) : dialogController.showError(e) : (s = t.leftGifts,
                app.info.spins = t.spins,
                n.setAttr({
                    flag: t.flag
                }),
                e = i.extraData.view,
                2 === t.flag && e.trigger("reply", {
                    model: n,
                    view: e
                }))
            }).send(util.random(100, 300))))
        }),
        i.on("reply:" + a, function(e) {
            var i;
            r.pending || ((i = e.extraData.model).pending || app.socialSpecificMethods.wheelOfFortune.reply(i.senderUid, i.canPost, function(e) {
                e.isSuccess && (i.setAttr({
                    pending: !0
                }),
                r.setAttr({
                    pending: !0
                }),
                api.wheeloffortune.freeSpin.sendReply({
                    requestParams: {
                        id: i._id
                    }
                }, function(e, t) {
                    i.setAttr({
                        pending: !1
                    }),
                    r.setAttr({
                        pending: !1
                    }),
                    e ? e.code === Codes.ACCESS_DENIED && t && t.flag ? i.setAttr({
                        flag: t.flag
                    }) : dialogController.showError(e) : i.setAttr({
                        pending: !1,
                        flag: 3
                    })
                }).send(util.random(100, 300)))
            }))
        })
    }
    ,
    u.openSendGiftsDialog = function(e) {
        (e = e || {}).onClose = e.onClose || $.noop,
        (e = e || {}).onClose = e.onClose || $.noop;
        function l(e) {
            var t = this;
            t.isGiftSend = !1,
            t.online = e.online,
            t.can_post = e.can_post,
            t.id = e.id,
            t.photo_100 = e.photo_100,
            t.first_name = e.first_name,
            t.last_name = e.last_name,
            t.bdate = e.bdate;
            var i = util.parseBDateString(t.bdate, 10, 100, -1);
            t.fullName = -1 === i ? t.first_name : t.first_name + " " + i,
            t.tsWhenLastGiftSend = e.tsWhenLastGiftSend || 0,
            t.pending = !1
        }
        var n = 0
          , t = "wfExchangeFriends_"
          , d = function() {
            if (t = util.lStorage.find("wsTsHash"))
                try {
                    var e, t, i = util.currentMillis();
                    for (e in t = JSON.parse(t))
                        t.hasOwnProperty(e) && 864e5 < i - t[e] && delete t[e]
                } catch (e) {
                    t = {},
                    console.error(e)
                }
            else
                t = {};
            return t
        }();
        l.fromAppCache = function(e) {
            return util.cache.find(t + e)
        }
        ,
        $.extend(l.prototype, {
            checkCanSendGift: function() {
                var e = util.currentMillis() - this.tsWhenLastGiftSend < 864e5;
                this.__isObservable ? this.setAttr({
                    isGiftSend: e
                }) : this.isGiftSend = e
            },
            saveToCache: function() {
                var e = t + this.id;
                util.cache.save(e, new l(this), 432e6)
            }
        });
        function i(e) {
            function i(e) {
                return t[e] || 0
            }
            function n(e) {
                return !!r[e]
            }
            var o, a, s = [], t = (a = {},
            (o = e).each(function(e, t) {
                a[t.id] = o.length - e
            }),
            a), r = util.collectArrayInObjectByProperty(socialApi.getAppUsersUids());
            return e.each(function(e, t) {
                var i;
                (i = t).deactivated || ((t = l.fromAppCache(i.id)) || ((t = new l(i)).tsWhenLastGiftSend = d[t.id] || 0,
                t.checkCanSendGift()),
                s.push(t))
            }),
            s.sort(function(e, t) {
                if (n(e.id) !== n(t.id))
                    return n(e.id) ? -1 : 1;
                e = i(e.id),
                t = i(t.id);
                return e === t ? 0 : t < e ? -1 : 1
            }),
            s
        }
        var o = {
            __allFriends: [],
            friendsResultList: [],
            spinGifts: e.giftsCount || 0,
            pending: !1
        }
          , a = new app.sdk.SearchHandler({
            resultArray: o.friendsResultList,
            initialArray: o.__allFriends,
            maxResultSize: 150,
            targetProperty: "first_name"
        })
          , s = lilo.createView("dialog-wf-exchange");
        s.setModel(o),
        dialogController.open(s, {
            dialogClass: "no-padding small-close"
        }),
        s.onRemove(function() {
            e.onClose(n)
        }),
        s.bind("search", function(e) {
            a.search({
                word: e.extraData.word
            })
        }),
        s.on("send:item-friend-in-wf-exchange-dialog", function(e) {
            var i;
            o.pending || ((i = e.extraData.model).pending || i.isGiftSend || (o.spinGifts <= 0 ? dialogController.fadePopup("У вас закончились подарки") : app.socialSpecificMethods.wheelOfFortune.sendSpinsToFriend(i, function(e) {
                e.isSuccess && (o.setAttr({
                    pending: !0
                }),
                i.setAttr({
                    pending: !0
                }),
                api.wheeloffortune.freeSpin.sendSpin({
                    requestParams: {
                        target_uid: i.id
                    }
                }, function(e, t) {
                    o.setAttr({
                        pending: !1
                    }),
                    i.setAttr({
                        pending: !1
                    }),
                    e ? e.code === Codes.NOT_ENOGH_SPINS ? (o.setAttr({
                        spinGifts: 0
                    }),
                    dialogController.fadePopup("У вас закончились подарки")) : dialogController.showError(e) : (o.setAttr({
                        spinGifts: t.spinGifts
                    }),
                    i.setAttr({
                        tsWhenLastGiftSend: util.currentMillis()
                    }),
                    i.checkCanSendGift(),
                    i.saveToCache(),
                    d[i.id] = i.tsWhenLastGiftSend,
                    function() {
                        try {
                            var e = JSON.stringify(d);
                            util.lStorage.save("wsTsHash", e)
                        } catch (e) {
                            console.error(e)
                        }
                    }(),
                    cAnal.trackEvent({
                        wf_send: 1
                    }),
                    dialogController.fadePopup("Подарок отправлен"),
                    n++)
                }).send(util.random(100, 300)))
            })))
        }),
        function(e, t) {
            var i, n, o = 0, a = "wf_searchFriendsList";
            try {
                var s = util.cache.find(a)
            } catch (e) {
                console.error(e)
            }
            s ? t(s) : (i = null,
            (n = function() {
                e <= o ? t(i) : (o++,
                VKApi("friends.search", {
                    count: 1e3,
                    fields: "online,can_post,photo_100,bdate"
                }, function(e) {
                    try {
                        e && e.response ? 0 === (i = e.response.items).length ? n() : (util.cache.save(a, i, 864e5),
                        t(i)) : (i = null,
                        n())
                    } catch (e) {
                        console.error(e)
                    }
                }, "5.120"))
            }
            )())
        }(3, function(e) {
            if (s.isVisible)
                if (e) {
                    try {
                        var t = i(e)
                    } catch (e) {
                        console.error(e)
                    }
                    0 === t.length && dialogController.showMessageDialog({
                        message: "Список друзей пуст"
                    });
                    try {
                        util.insertArrayAt(o.__allFriends, 0, t)
                    } catch (e) {
                        console.error(e)
                    }
                    s.els.preloader.remove();
                    try {
                        a.resetSearchWord(),
                        a.search({
                            word: ""
                        })
                    } catch (e) {
                        console.error(e)
                    }
                } else
                    dialogController.showMessageDialog({
                        message: "Произошла ошибка при получении списка друзей"
                    })
        })
    }
    ,
    u.openWheelDialog = function(e) {
        function d(e) {
            i || s.isVisible && (i = !0,
            e = e || 1e3,
            api.wheeloffortune.checkSpins({}, function(e, t) {
                i = !1,
                e || (app.info.spins = t.spins,
                app.info.spinsGifts = t.spinsGifts,
                a.setAttr({
                    spins: t.spins
                }),
                app.info.spinsMeta = t.spinsMeta,
                s.model.dailyItems.removeAll(),
                s.model.dailyItems.add(n()))
            }).send(e))
        }
        var t = (e = e || {}).freeSpinGifts || 0
          , o = [{
            bonus: 3
        }, {
            bonus: 2
        }, {
            spinGifts: 5
        }, {
            bonus: 5
        }, {
            bonus: 10
        }, {
            bonus: 5
        }, {
            bonus: 3
        }, {
            bonus: 5
        }, {
            bonus: 1
        }, {
            freeSpins: 3
        }, {
            bonus: 2
        }, {
            bonus: 1
        }, {
            spinGifts: 5
        }, {
            freeSpins: 1
        }, {
            bonus: 2
        }, {
            bonus: 100
        }, {
            bonus: 1
        }, {
            bonus: 0
        }, {
            bonus: 3
        }, {
            bonus: 10
        }]
          , c = (window.UTC_CORRECTION,
        null)
          , i = !1
          , n = function() {
            function n(e) {
                var t = new Date(i);
                return t.setHours(0, 0, 0, 0),
                (e = new Date(e)).setHours(0, 0, 0, 0),
                0 === (e = Math.floor((t.getTime() - e.getTime()) / 864e5)) ? 2 : 1 === e ? 1 : 2 === e ? 0 : -1 === e ? 3 : -2 === e ? 4 : 0
            }
            var e = app.info.spinsMeta.split(",")
              , o = parseInt(e[1], 10)
              , a = o + 1
              , s = parseInt(e[0], 10) + app.info.timeDiff + 0 + 864e5
              , i = util.currentMillis()
              , r = []
              , l = 0
              , e = n(s);
            if (3 <= a && (2 === e || 3 === e))
                if (2 === e)
                    switch (a) {
                    case 3:
                        l = 1;
                        break;
                    case 4:
                        l = 2;
                        break;
                    default:
                        l = a - 1
                    }
                else
                    l = a - 2;
            util.repeat(3, function(e) {
                var t = s + 864e5 * ((e += l) - a)
                  , i = n(t)
                  , t = {
                    bonus: Math.min(e + 1, 3),
                    isComplete: e <= o,
                    isTargetDay: a === e,
                    dayTextIndex: i,
                    millis: t
                };
                r.push(t)
            }),
            clearTimeout(c);
            e = s - i + 2e3;
            return e < 0 && (e = 6e4),
            c = setTimeout(d, e),
            r
        }
          , a = {
            spins: app.info.spins,
            power: 0,
            spinDisabled: !1,
            dailyItems: n()
        }
          , s = lilo.createView("dialog-wheel-of-fortune");
        p(s, a),
        s.bind("initial-render-error", function() {
            e.onClose && e.onClose()
        }),
        s.bind("initial-render-complete", function() {
            socialApi.setAppWidth(1e3);
            var e = dialogController.open(s, {
                dialogCss: {
                    padding: "0px"
                },
                dialogClass: "room-bg unset-dialog-bg"
            });
            s.initView && s.initView(),
            e.el.css("opacity", "0"),
            setTimeout(function() {
                dialogController.dialogToCenter(s)
            }, 200),
            setTimeout(function() {
                e.el.css("opacity", "1")
            }, 400),
            s.ready(),
            0 < a.spins ? s.ready() : s.niceGame(),
            t && (r(t),
            t = 0)
        }),
        s.loadImagesAndRender(),
        s.bind("start-spin", function(e) {
            var t;
            0 !== a.spins ? a.spinDisabled || (t = e.extraData.power,
            a.setAttr({
                spinDisabled: !0
            }),
            api.wheeloffortune.spin({}, function(e, i) {
                var n;
                e ? (a.setAttr({
                    spinDisabled: !1
                }),
                e.code === Codes.NOT_ENOGH_SPINS ? (app.info.spins = 0,
                a.setAttr({
                    spins: 0
                }),
                l()) : dialogController.fadePopup("Произошла ошибка<br>" + errorHandler.getFullMessage(e))) : (n = i.id,
                e = 360 / o.length * n,
                e += 9,
                e += isMobi ? 0 : 3,
                s.goodLuck(),
                a.setAttr({
                    spins: Math.max(a.spins - 1, 0)
                }),
                s.startSpin(t, e, function() {
                    var t = o[n];
                    app.soundManager.play(app.soundManager.SOUND_IDS.WF_WIN);
                    try {
                        2 < s.arrowInstance.angle * (180 / Math.PI) % 360 && (s.arrowInstance.angle = 0,
                        s.stageInstance.draw());
                        var e = s.wheelInstance.angle * (180 / Math.PI) % 360;
                        Math.floor(e / (360 / o.length))
                    } catch (e) {
                        console.error(e)
                    }
                    s.showWin(t, function() {
                        a.setAttr({
                            spins: i.spins
                        }),
                        util.isDef(i.balance) && app.balanceModel.setAttr({
                            balance: i.balance
                        }),
                        a.setAttr({
                            power: 0,
                            spinDisabled: !1
                        });
                        var e = 3e3;
                        isDirect && (e = t.spinGifts ? 0 : 2e3),
                        setTimeout(function() {
                            s.stageInstance.isStarted() || (0 < a.spins ? s.ready() : s.niceGame())
                        }, e),
                        t.spinGifts && (r(t.spinGifts),
                        cAnal.trackEvent({
                            wf_gs_win: 1
                        })),
                        t.bonus && cAnal.trackEvent({
                            wf_coins: t.bonus
                        })
                    })
                }))
            }).send()) : l()
        }),
        s.bind("send-gifts", function() {
            u.openSendGiftsDialog()
        });
        var r = function(e) {
            var t = lilo.createView("dialog-wf-gift");
            t.bind("send-to-friends", function() {
                u.openSendGiftsDialog({
                    giftsCount: e,
                    onClose: function(e) {
                        0 < e && dialogController.close(t)
                    }
                })
            }),
            t.bind("take", function() {
                socialApi.showOrderBox("item_1000", function() {
                    dialogController.close(t),
                    d(1),
                    cAnal.trackEvent({
                        wf_buy: 1
                    })
                })
            });
            function i() {
                dialogController.close(t),
                api.wheeloffortune.freeSpin.resetCounter({}, $.noop).send()
            }
            t.bind("dismiss", i),
            dialogController.open(t, {
                isModal: !isMobi,
                dialogCss: {
                    padding: "0px"
                },
                mobiCloseCaption: "Отказаться",
                mobiCloseHandler: i
            })
        }
          , l = function() {
            var e, t, i, n = -1, o = 0;
            a.setAttr({
                power: 0
            }),
            a.dailyItems.each(function(e, t) {
                if (!t.isComplete)
                    return n = t.millis,
                    o = t.bonus,
                    !1
            }),
            -1 === n && (o = 1,
            n = a.dailyItems.lastEl().millis + 864e5),
            isMobi ? dialogController.fadePopup("У вас недостаточно вращений") : (e = n - util.currentMillis(),
            t = lilo.createView("dialog-wf-spins-deficit"),
            i = function() {
                t.isVisible && ((e -= 1e3) < 0 && (e = 0),
                t.model.setAttr({
                    time: util.formatMillisToTime(e, function(e, t, i) {
                        return e + ":" + t + ":" + i
                    })
                }),
                0 < e ? setTimeout(i, 1e3) : setTimeout(function() {
                    dialogController.close(t)
                }, 1e3))
            }
            ,
            t.setModel({
                caption: "Вы получите <span class='value'>{0}</span> <i class='spin-icon'></i> через:".format(o),
                time: ""
            }),
            dialogController.open(t, {
                dialogClass: "w`heel-clos`e no-padding"
            }),
            i()),
            app.info.spins = 0
        };
        s.onRemove(function() {
            e.onClose && e.onClose()
        })
    }
}
,
app.controllers.dialog.RoomGifts = function() {
    function t(e, t) {
        if (e = rawGiftsHash[e]) {
            var i = e.categories;
            if (i && i.length)
                for (var n = 0; n < i.length; n += 1)
                    if (t === i[n])
                        return !0
        }
        return !1
    }
    function h(e) {
        return t(e, x)
    }
    function g(e) {
        return t(e, R)
    }
    function b(e) {
        return t(e, k)
    }
    function C(e) {
        return t(e, U)
    }
    function _(e) {
        return t(e, N)
    }
    function w(e) {
        return t(e, L)
    }
    function E(e) {
        return t(e, P)
    }
    function y(e) {
        return t(e, F)
    }
    var d, D, T, S = "item-room-gift-v3", A = "popup-of-game-gift", i = "roomFavGifts", I = "roomgiftsLastTab", c = window.ROOM_GIFT_TYPE, M = window.ROOM_GIFT_ACTION, O = app.models.PopupModel, x = 10, R = 11, k = 12, P = 13, N = 14, U = 15, L = 16, F = 17, V = function(e) {
        return e === app.info.roomGiftMelodyId
    }, B = function(e) {
        e = rawGiftsHash[e].type;
        return e === c.WITH_TARGET || e === c.MUSTACHE || e === c.GLASSES || e === c.HORNS
    }, G = (function() {
        try {
            var e = util.lStorage.find(i, void 0);
            if (e)
                return JSON.parse(e)
        } catch (e) {
            return
        }
    }(),
    util.isDef,
    util.collectArrayInObjectByProperty,
    app.info.viewer_id), s = (app.info.sex,
    function(e) {
        return 10 <= e.level - expController.getCurrentLevel() || (e.id === app.info.roomGiftKissId || !(e.id !== app.info.roomGiftMelodyId || !(util.isOKAppUid(app.info.viewer_id) || util.isOKAppUid(Q) || window.isExternal) || window.radioModel && radioModel.type === RadioPlayerType.YOUTUBE && !isMobi))
    }
    ), H = null, W = null, j = function() {
        H && (dialogController.close(H),
        H = null)
    };
    function K(e, t, i, n, o) {
        this.x = e || 0,
        this.y = t || 0,
        this.w = i || 0,
        this.h = n || 0,
        this.a = o || 0
    }
    Math.cos,
    Math.sin,
    Math.PI,
    Math.sqrt;
    function m(i, n) {
        n = n || 0;
        var o = [];
        return util.repeat(i.length, function(e) {
            var t = i[n];
            o.push(t),
            (n += 1) >= i.length && (n = 0)
        }),
        o
    }
    function v(i, e) {
        e.each(function(e, t) {
            i.push(t)
        })
    }
    function u(e, t, i, o, n, a) {
        if (roomModel.roomId && roomModel.roomId === W)
            if (!isMobi || roomModel.roundType !== app.ROUND_TYPE.LOTTERY || roomModel.canSpendMoney) {
                var s, r, l, d, c, u, p, f;
                if (a = a || {},
                !!n)
                    return s = e,
                    r = t,
                    l = i,
                    u = [],
                    p = 2 === (v = n),
                    f = roomModel.roomId,
                    roomModel.processActualUsers(function(e) {
                        e.uid !== G && e.male === p && u.push(e.uid)
                    }),
                    0 !== u.length && (v = u.length * l * r.getPrice(),
                    (v = (1 === r.currency ? app.balanceModel.balance : app.balanceModel.ruby) - v) < 0 ? dialogController.showInsufficientlyBalanceDialog(v, {
                        currency: r.currency
                    }) : (d = !0,
                    (c = function() {
                        var e;
                        0 !== u.length && f === roomModel.roomId ? (e = u.shift(),
                        e = {
                            roomId: f,
                            targetUid: e,
                            count: l,
                            giftId: r.id,
                            action_id: s
                        },
                        rawGiftsHash[r.id].type === ROOM_GIFT_TYPE.WITH_TARGET && (e.coordinates = K.createRandomCoords(r.id, l)),
                        e.type = d ? 2 : 1,
                        roomController.communicator.addGameGift(e, function(e, t) {
                            try {
                                e || (util.isDef(t.balance) && roomController.communicator.config.onBalanceUpdate(t.balance),
                                util.isDef(t.ruby) && app.balanceModel.setAttr({
                                    ruby: t.ruby
                                }),
                                c())
                            } catch (e) {}
                        }),
                        d = !1) : roomModel.__batchGiftsIsProcessing = !1
                    }
                    )(),
                    j())),
                    void j();
                !a.coordinates && B(t.id) && (a.coordinates = K.createRandomCoords(t.id, i)),
                a.coordinates && (i = a.coordinates.length);
                var m, v = t.getPrice() * i, v = (1 === t.currency ? app.balanceModel.balance : app.balanceModel.ruby) - v, h = V(t.id) && roomModel.canSendFreeNote;
                !h && !a.isForBeginner && v < 0 ? dialogController.showInsufficientlyBalanceDialog(v, {
                    currency: t.currency
                }) : (a.dialogRange && dialogController.close(a.dialogRange),
                a.dialogView && dialogController.close(a.dialogView),
                m = {
                    roomId: roomModel.roomId,
                    targetUid: o,
                    giftId: t.id,
                    count: i,
                    extraRequestParams: a.extraRequestParams
                },
                util.isDef(a.x) && (m.x = a.x,
                m.y = a.y),
                util.isDef(a.isForBeginner) && (m.beginner = !0),
                util.isDef(a.angle) && (m.angle = a.angle,
                m.width = a.width,
                m.height = a.height),
                util.isDef(a.coordinates) && (m.coordinates = a.coordinates),
                m.action_id = e,
                roomController.communicator.addGameGift(m, function(e, t) {
                    var i, n;
                    util.isDef(t.ruby) && app.balanceModel.setAttr({
                        ruby: t.ruby
                    }),
                    util.isDef(t.balance) && app.balanceModel.setAttr({
                        balance: t.balance
                    }),
                    e && roomController.communicator.config.onAddGiftFail(e, t),
                    !m.beginner || e && e.code !== Codes.ACCESS_DENIED || ((i = roomModel.findUser(o)) && (t = i[n = "counterMapOfGiftsForBeginners"][app.info.viewer_id] || 0,
                    i[n][app.info.viewer_id] = t + 1,
                    n = i[n],
                    i.setAttr({
                        counterMapOfGiftsForBeginners: {}
                    }),
                    i.setAttr({
                        counterMapOfGiftsForBeginners: n
                    })),
                    e || cAnal.trackEvent({
                        g_b: 1
                    })),
                    e || h && roomModel.setAttr({
                        canSendFreeNote: !1
                    })
                }),
                j(),
                roomModel.findUser(o))
            } else
                dialogController.lotteryIsActiveDialog()
    }
    function Y(i, n, o, a, s, r) {
        if (i.locked)
            dialogController.showInsufficientlyLevelDialog({
                needLevel: i.level,
                currentLevel: expController.getCurrentLevel()
            });
        else {
            var e = roomModel.findUser(o);
            o || dialogController.fadePopup({
                message: "Пользователь вышел",
                duration: 2e3
            });
            var t = rawGiftsHash[i.id];
            if (V(i.id)) {
                var l = i.price ? "<span>Подтвердить</span>&nbsp;&nbsp;<b>{0}</b><i class='coin-icon-el'></i>".format(i.price) : "<span>Подтвердить</span>";
                new app.controllers.dialog.AudiosList({
                    cropBeforeSubmit: !0,
                    submitBtnInnerHtml: l,
                    price: 0,
                    onSubmit: function(e) {
                        e = {
                            track: util.serializeAudioTrack(e)
                        };
                        u(s, i, n, o, null, {
                            extraRequestParams: e
                        })
                    }
                })
            } else if (a)
                u(s, i, n, o, a);
            else if (B(i.id) && 1 === n) {
                if (!e || e.uid !== o)
                    return j(),
                    void dialogController.fadePopup("Пользователь вышел");
                t.type === c.WITH_TARGET && r && r.isForBeginner ? (l = K.createRandomCoords(i.id, 3, {
                    onBorders: !0
                }),
                u(s, i, n, o, a, {
                    isForBeginner: !0,
                    coordinates: l
                })) : (t = t.dialogTitle || "Куда хотите прикрепить подарок?",
                d = new app.controllers.dialog.GiftShootingRange({
                    headerText: t,
                    onComplete: function(e, t) {
                        (e = $.isArray(e) ? {
                            coordinates: e
                        } : {
                            coordinates: [new K(e.rect.x,e.rect.y,e.rect.width,e.rect.height,e.rect.angle)]
                        }).dialogRange = t,
                        r && (e.isForBeginner = !!r.isForBeginner),
                        u(s, i, n, o, a, e)
                    },
                    giftDescription: rawGiftsHash[i.id],
                    photo200: e.photo200
                }))
            } else
                u(s, i, n, o, a, r)
        }
    }
    function q(e, t) {
        var i = this;
        i.id = e.id,
        i.img = e.img,
        i.currency = e.price || app.info.roomGiftMelodyId === e.id ? 1 : 2,
        i.price = V(i.id) && roomModel.canSendFreeNote ? 0 : e.price,
        i.rubyPrice = e.rubyPrice,
        i.bonus = e.recipientBalanceBonus,
        i.locked = !1,
        i.caption = e.title || "",
        i.level = e.minLevel || 0,
        i.isForBeginner = e.isForBeginner && t,
        i.beginnerSex = e.beginnerSex,
        i.isFav = !1,
        app.info.roomGiftMelodyId === e.id && window.radioModel && radioModel.type === RadioPlayerType.YOUTUBE && (i.caption = "Клип")
    }
    function z(e, t, i, n) {
        this.selected = !1,
        this.title = e.title,
        this.iconIndex = e.icon;
        var o = []
          , a = 0;
        t.each(function(e, t) {
            if (!s(t) && i(t.id) && (o.push(t),
            100500 === ++a))
                return !1
        }),
        n && (o = o.sort(function(e, t) {
            e = D(n, e.id),
            t = D(n, t.id);
            return t < e ? -1 : e < t ? 1 : 0
        })),
        this.gifts = o,
        this.id = this.title + "_" + this.iconIndex
    }
    K.createRandomCoords = function(e, t, i) {
        i = i || {};
        rawGiftsHash[e];
        if (1 === t)
            return [new K(5,5,0,0,0)];
        if (50 === t) {
            var n, o = [], a = 0, s = 0, r = [];
            return util.repeat(t, function(e) {
                0 <= s && s % 7 == 0 && (s = 0,
                a += 1),
                e === t - 1 ? n = new K(util.random(52, 54),util.random(49, 51)) : (e = new K(14 * s + util.random(0, 3) + 6,14 * a + util.random(0, 3) - 7),
                r.push({
                    x: a,
                    y: s,
                    coordinate: e
                })),
                s++
            }),
            r.each(function(e, t) {
                o.push(t.coordinate)
            }),
            o.push(n),
            util.shuffleArray(o),
            o
        }
        if (30 === t) {
            for (var l, d, o = [], c = [[], [], [], []], a = 0; a < 4; a += 1)
                for (r = c[a],
                s = 0; s < (a % 2 == 0 ? 7 : 8); s += 1)
                    0 === a ? (l = 0,
                    d = 13 * s + 5) : 1 === a ? (d = 0,
                    l = 14 * s) : 2 === a ? (l = 95,
                    d = 13 * s + 5) : (d = 95,
                    l = 14 * s),
                    r.push(new K(l,d));
            return c[2].reverse(),
            c[1].reverse(),
            v(o, c[0]),
            v(o, c[3]),
            v(o, c[2]),
            v(o, c[1]),
            2 === util.random(1, 2) && o.reverse(),
            o = m(o, util.random(0, o.length - 1)),
            util.shuffleArray(o),
            o
        }
        if (10 === t || i.onBorders) {
            o = [];
            var u = 2 === util.random(1, 2);
            for (a = 0; a < 4; a += 1)
                for (s = 0; s < (a % 2 == 0 ? 3 : 2); s += 1)
                    0 === a ? (l = 0,
                    d = util.random(32, 36) * s + util.random(14, 19)) : 1 === a ? (d = 0,
                    l = util.random(30, 34) * s + util.random(25, 40)) : 2 === a ? (l = 95,
                    d = util.random(32, 36) * s + util.random(16, 19)) : (d = 95,
                    l = util.random(32, 36) * s + util.random(25, 40)),
                    o.push(new K(u ? l : d,u ? d : l));
            r = [o[0], o[1], o[2], o[8], o[9], o[7], o[6], o[5], o[4], o[3]];
            return (o = m(r, util.random(0, r.length - 1))).length = t,
            o
        }
        o = [];
        var p = []
          , f = [];
        return util.repeat(10, function(e) {
            p.push(9 * e + 5),
            f.push(9 * e + 5)
        }),
        util.shuffleArray(p),
        util.shuffleArray(f),
        p = p.splice(0, t),
        f = f.splice(0, t),
        util.repeat(t, function(e) {
            o.push(new K(p[e] + util.random(0, 3),f[e] + util.random(0, 3)))
        }),
        o
    }
    ,
    $.extend(q.prototype, {
        getPrice: function() {
            return 1 === this.currency ? this.price : this.rubyPrice
        },
        checkIsLocked: function(e) {
            e = e < this.level;
            this.__isObservable ? this.setAttr({
                locked: e
            }) : this.locked = e
        }
    });
    var n, o, X = $.noop;
    app.eventBus.on(app.EVENTS.VIEWER_LEVEL_CHANGED, function(e) {
        X(e.level)
    }),
    app.eventBus.on(app.EVENTS.ROOM_GIFTS_LIST_UPDATED, function(e) {
        H && H.isVisible && (j(),
        dialogController.fadePopup("Магазин подарков обновился!"),
        d && d.dialogView.isVisible && dialogController.close(d.dialogView))
    }),
    n = [],
    o = [],
    setInterval(function() {
        var e = n.shift();
        e && (e = [e.id, e.count, e.comboId, 18 <= app.info.age ? 1 : 0, isMobi ? 2 : 1, app.info.viewer_id, expController.getCurrentLevel(), app.info.hasOrders ? 1 : 0],
        cAnal.trackCommonEvent("Love1vCommon", "gifts", e.join("_")))
    }, 700),
    setInterval(function() {
        var e, t = o.shift();
        t && ((e = {})[t.key] = t.value,
        cAnal.trackEvent(e))
    }, 500),
    app.eventBus.on(app.EVENTS.SEND_ROOM_GIFT, function(e) {
        var t, i;
        e.beginner || ((i = roomModel.findUser(e.requestParams.targetUid)) && n.push({
            id: e.id,
            count: e.count,
            comboId: Z(i.male ? 2 : 1)
        }),
        util.isDef(e.responseData.moneyBox) && i && (t = 2 === app.info.sex ? i.male ? "gifts_1" : "gifts_2" : i.male ? "gifts_3" : "gifts_4",
        isMobi && !isDirect && !util.isOKPlatform() || (i = rawGiftsHash[e.id]) && (e = (i.price || 2 * i.rubyPrice) * e.count,
        o.push({
            key: t,
            value: e
        }))))
    });
    var Q, J = function() {
        function n() {
            var e = JSON.stringify(o);
            util.lStorage.save(t, e)
        }
        var o, a, t = "recent-room-gifts", e = util.lStorage.find(t);
        if (e)
            try {
                o = JSON.parse(e)
            } catch (e) {
                o = null
            }
        function s(e) {
            var i = []
              , e = o["hashSex" + e];
            $.each(e, function(e, t) {
                i.push({
                    id: e,
                    count: t.v,
                    ts: t.ts
                })
            });
            var i = i.sort(function(e, t) {
                return e.count === t.count ? e.ts == t.ts ? 0 : e.ts > t.ts ? -1 : 1 : e.count > t.count ? -1 : 1
            })
              , n = [];
            return i.each(function(e, t) {
                n.push(t.id)
            }),
            n
        }
        return o && 6 === o.v || (o = {
            v: 6,
            hashSex1: {},
            hashSex2: {}
        }),
        app.eventBus.on(app.EVENTS.SEND_ROOM_GIFT, function(e) {
            var t, i;
            e.requestParams.beginner || (t = roomModel.findUser(e.requestParams.targetUid)) && (i = t.male ? 2 : 1,
            (i = (t = o["hashSex" + i])[e.id] || {
                ts: 0,
                v: 0
            }).ts = +new Date,
            i.v += e.count,
            t[e.id] = i,
            clearTimeout(a),
            a = setTimeout(n, 2e3),
            app.eventBus.trigger(app.EVENTS.UPDATE_RECENT_GIFTS))
        }),
        {
            getRecentGiftsIds: s,
            getRecentGifts: function(e, i, t) {
                var n, t = s(t), o = [];
                return t.length && (n = util.collectArrayInObjectByProperty(e, "id"),
                t.each(function(e, t) {
                    t = n[t];
                    if (t && (o.push(t),
                    o.length === i))
                        return !1
                })),
                o
            }
        }
    }(), Z = function(e) {
        e = 2 === app.info.sex ? 2 === e ? 1 : 2 : 2 === e ? 3 : 4;
        return e
    };
    this.recentGifts = J,
    this.open = function(r, i) {
        var e, t, l, a, d, n, o, s, c, u, p, f, m, v;
        i = i || {},
        W = roomModel.roomId,
        r !== app.info.viewer_id && ((e = roomModel.findUser(r)) ? i.popupItemModel ? (t = i.popupItemModel.count,
        o = i.popupItemModel.sex,
        Y(new q(i.gift), t, r, o, i.popupItemModel.__actionId)) : (l = e.male ? 2 : 1,
        Q = r,
        a = {},
        (o = l,
        app.info.giftsOrder[Z(o)]).each(function(e, t) {
            var i = t._id
              , n = t.g
              , o = {};
            n.each(function(e, t) {
                o[t] = n.length - e
            }),
            a[i] = o
        }),
        D = function(e, t) {
            e = a[e];
            return e && e[t] || 0
        }
        ,
        d = lilo.createView(i.forBeginner ? "dialog-room-gifts-for-beginner" : "dialog-room-gifts-v3"),
        (H = d).ITEM_VIEW_NAME = S,
        n = [],
        i.forBeginner ? rawGifts.each(function(e, t) {
            t.isForBeginner && util.isGiftAllowed(app.info.sex, l, t.sexCombo) && n.push(new q(t,!0))
        }) : rawGifts.each(function(e, t) {
            t.id,
            util.isGiftAllowed(app.info.sex, l, t.sexCombo) && n.push(new q(t))
        }),
        T = expController.getCurrentLevel(),
        o = [new z({
            title: "Новые!",
            icon: 1
        },n,h,x), new z({
            title: "На аватарку",
            icon: 3
        },n,b,k), new z({
            title: "С текстом",
            icon: 8
        },n,y,F), new z({
            title: "Обычные",
            icon: 2
        },n,g,R), new z({
            title: "Короны",
            icon: 5
        },n,_,N), new z({
            title: "С бонусом",
            icon: 4
        },n,E,P), new z({
            title: "Маски",
            icon: 6
        },n,C,U), new z({
            title: "Напитки",
            icon: 7
        },n,w,L)],
        (X = function(i, e) {
            (d.isVisible || e) && n.each(function(e, t) {
                t.checkIsLocked(i)
            })
        }
        )(T, !0),
        d.setTabs(o, {
            targetUserSex: l,
            recentGifts: J.getRecentGifts(n, isMobi ? 4 : 5, l)
        }),
        d.setModel({
            hasFreePrivateMessage: !!e.freeMessageCountersMap[G],
            avatar: e.photo,
            firstName: e.firstName,
            recipientExp: e.exp
        }),
        dialogController.open(d, {
            watch: !0,
            dialogClass: "small-close no-padding dialog-purchase"
        }),
        d.el.css("opacity", "0"),
        s = !1,
        setTimeout(function() {
            d.updateScroll(),
            m && (m.setAttr({
                selected: !0
            }),
            d.scrollToTabSublist(m, !0, {
                initial: !0
            })),
            s = !0,
            d.el.css("opacity", "1")
        }, 100),
        u = null,
        p = function() {
            u && (u.el.remove(),
            u.model.dispose(),
            isMobi || u.giftView.el.removeClass("hovered"),
            u = null)
        }
        ,
        o[c = 0],
        isMobi || d.els.scroll.bind("jsp-scroll-y", function(e, t, i, n) {
            c = t,
            p()
        }),
        d.on("hover:" + S, function(e) {
            var t, i, n, o, a = e.extraData.model, s = e.extraData.view;
            p(),
            a.locked ? dialogController.showInsufficientlyLevelDialog({
                needLevel: a.level,
                currentLevel: expController.getCurrentLevel()
            }) : (n = new O(a,r,l,{
                rawGiftsHash: rawGiftsHash
            }),
            (t = lilo.createView(A)).setModel(n),
            t.giftView = s,
            t.bind("toggle-fav", function(e) {
                e.extraData.model.__gift,
                d.trigger("hover:" + S, e.extraData)
            }),
            u = t,
            i = s.el.position(),
            e = s.el.height(),
            n = s.el.width(),
            isMobi ? 1 === (o = util.cloneArray(t.getModelsForMobi())).length ? f(u.model.__items[0], a) : (o.each(function(e, t) {
                t.mobiHandler = function(e) {
                    var t;
                    u && (t = u.model.__gift,
                    f(e, t))
                }
            }),
            o = o.sort(function(e, t) {
                return e.opts.group === t.opts.group ? e.opts.sortIndex === t.opts.sortIndex ? 0 : e.opts.sortIndex > t.opts.sortIndex ? -1 : 1 : e.opts.group > t.opts.group ? -1 : 1
            }),
            new app.controllers.MobilePopup({
                btns: o,
                layerTopOfDialogs: !0
            })) : d.els["gifts-wrap"].append(t.el),
            o = t.el.outerHeight(),
            t.arrowToCenter(o),
            t.el.css({
                left: i.left + .8 * n + "px",
                top: i.top - c + (e - o) / 2 + "px"
            }),
            isMobi || s.el.addClass("hovered"))
        }),
        d.on("blur:" + S, function(e) {
            e.extraData.model,
            e.extraData.view;
            !function(e) {
                e.extraData.model,
                e.extraData.view;
                var t = e.extraData.toElement;
                if (t) {
                    if ("arrow" === t.className || t.className === A)
                        return 1;
                    for (; t.parentNode; ) {
                        if (t.parentNode.className === A)
                            return 1;
                        t = t.parentNode
                    }
                }
            }(e) && p()
        }),
        d.bind("send-private-message", function() {
            d.model.hasFreePrivateMessage || roomModel.canSpendMoney ? (isMobi && j(),
            new app.controllers.dialog.RoomPrivateMessage({
                isFreePrivateMessage: d.model.hasFreePrivateMessage,
                roomModel: roomModel,
                roomId: roomModel.roomId,
                roomView: roomView,
                targetUid: r,
                giftsDialog: d
            })) : dialogController.lotteryIsActiveDialog()
        }),
        d.bind("send-message", function() {
            j(),
            roomModel.findUser(r) ? setTimeout(function() {
                i.view.trigger("send-private-message", {
                    model: i.view.model
                })
            }, 100) : dialogController.fadePopup({
                message: "Пользователь вышел",
                duration: 2e3
            })
        }),
        d.bind("open-profile", function() {
            j();
            var e = roomModel.findUser(r);
            e ? isMobi ? app.eventBus.trigger(app.EVENTS.SHOW_PROFILE, {
                uid: e.uid
            }) : i.view.trigger("open-profile", {
                model: i.view.model
            }) : dialogController.fadePopup({
                message: "Пользователь вышел",
                duration: 2e3
            })
        }),
        d.bind("options", function(e) {
            j();
            var t = i.view.popupModel
              , t = (i.view.model,
            t.getButtonsForMobi());
            (t = (t = util.cloneArray(t).filter(function(e) {
                return "Подарок" !== e.title
            })).filter(function(e) {
                return "Отправить сообщение" !== e.title && "Открыть профиль" !== e.title
            })).length && (roomModel.findUser(r) ? new app.controllers.MobilePopup({
                btns: t
            }) : dialogController.fadePopup({
                message: "Пользователь вышел",
                duration: 2e3
            }))
        }),
        f = function(e, t) {
            p();
            var i = e.count
              , n = e.sex;
            Y(t, i, r, n, e.__actionId)
        }
        ,
        d.on("click-item:" + A, function(e) {
            var t = e.extraData.model;
            u && (e = u.model.__gift,
            f(t, e))
        }),
        d.on("click:" + S, function(e) {
            e = e.extraData.model;
            p(),
            Y(e, 1, r, null, M.ONE_USER_X1, {
                isForBeginner: i.forBeginner
            })
        }),
        d.bind("click-tab", function(e) {
            var t = e.extraData.model;
            0 < t.gifts.length && (t.selected || (m && m.setAttr({
                selected: !1
            }),
            t.setAttr({
                selected: !0
            }),
            m = t,
            d.scrollToTabSublist(t, !0, e.extraData)))
        }),
        d.bind("select-tab-by-scroll", function(e) {
            !s || 0 < (e = e.extraData.model).gifts.length && (e.selected || (m && m.setAttr({
                selected: !1
            }),
            e.setAttr({
                selected: !0
            }),
            m = e))
        }),
        m = null,
        v = (v = util.cache.find(I)) || o[1].id,
        o.each(function(e, t) {
            if (v) {
                if (0 < t.gifts.length && t.id === v)
                    return m = t,
                    !1
            } else if (0 < t.gifts.length)
                return m = t,
                !1
        }),
        o.each(function(e, t) {
            t.onChange("selected", function() {
                t.selected && util.cache.save(I, t.id, 864e5)
            })
        })) : dialogController.fadePopup("Пользователь вышел"))
    }
}
,
app.controllers.dialog.VerificationPhoto = function(e) {
    e = e || {};
    var s, r = lilo.createView("dialog-verification-photo"), c = {
        title: "",
        viewerAvatar: app.info.photo_200 || app.info.photo_100,
        viewerName: app.info.first_name + " " + app.info.age,
        pending: !1,
        resultImg: null,
        viewerAvatarWithRect: null,
        isWebCamPlay: !1,
        denyReasonText: "",
        verificationId: null
    }, u = 2;
    function l() {
        c.setAttr({
            viewerAvatar: app.info.photo_200 || app.info.photo_100,
            title: "Верификация вашего профиля"
        }),
        r.showSlide(4)
    }
    function d(e) {
        c.setAttr({
            title: "Верификация вашего профиля",
            viewerAvatarWithRect: e,
            resultImg: app.commonState.verificationPhoto.u
        }),
        r.showSlide(5)
    }
    function t(e) {
        var l;
        c.setAttr({
            title: "Сделать фото с жестом",
            resultImg: null,
            isWebCamPlay: !1,
            verificationId: (e = e || {}).verificationId || util.random(1, 4)
        }),
        r.showSlide(3);
        var d = n();
        r.els["video-wrap"].empty().append(d);
        (i = new app.sdk.WebCamController({
            width: 600,
            video: d,
            onError: o,
            onCameraAccessDenied: o,
            onStartPlay: function() {},
            onCanPlay: function() {
                var e, t, i = d.videoWidth, n = d.videoHeight, o = 180, a = 180;
                isMobi && ((e = appWidth) < (t = .3 * appWidth) ? t = e : e = t,
                r.els["video-wrap"].css({
                    width: o = e,
                    height: a = t
                })),
                i < 200 || n < 200 ? function() {
                    var e = dialogController.showMessageDialog({
                        message: "Полученное изображение с камеры слишком маленькое"
                    });
                    isMobi && dialogController.rotate(s, e);
                    r.showSlide(u)
                }() : (l = {
                    rect: t = 1 == (t = i / n) ? {
                        x: 0,
                        y: 0,
                        w: o,
                        h: a
                    } : 1 < t ? {
                        x: -1 * (a * t - a) / 2,
                        y: 0,
                        w: a * t,
                        h: a
                    } : {
                        x: 0,
                        y: -1 * (o / t - o) / 4,
                        w: o,
                        h: o / t
                    },
                    videoWidth: i,
                    videoHeight: n,
                    targetWidth: o,
                    targetHeight: a
                },
                (a = d.style).width = t.w + "px",
                a.height = t.h + "px",
                a.marginTop = t.y + "px",
                a.marginLeft = t.x + "px",
                c.setAttr({
                    isWebCamPlay: !0
                }))
            }
        })).takePhoto = function() {
            var e, t, i, n, o, a, s, r;
            l && (a = l.rect,
            s = l.videoWidth / a.w,
            e = l.targetWidth * s,
            t = l.targetHeight * s,
            i = function(e) {
                return Math.abs(Math.floor(e))
            }
            ,
            n = (r = document.createElement("canvas")).getContext("2d"),
            d.width = l.videoWidth,
            d.height = l.videoHeight,
            r.width = e,
            r.height = t,
            o = i(a.x * s),
            a = i(a.y * s),
            n.drawImage(d, o, a, e, t, 0, 0, r.width, r.height),
            600 < e && (a = (o = document.createElement("canvas")).getContext("2d"),
            s = e / t,
            o.width = 600,
            o.height = parseInt(600 / s, 10),
            a.drawImage(r, 0, 0, o.width, o.height),
            r = o,
            n = a),
            r = r.toDataURL("image/jpeg"),
            c.setAttr({
                resultImg: r
            }),
            p())
        }
    }
    r.bind("pick-avatar", function() {
        var e = new app.controllers.SelectPhotosController({
            onSelectPhoto: function(o) {
                e.stop();
                var a = util.obtainMaxPhotoUrl(o);
                a && (e = new app.controllers.dialog.ImageCropper({
                    url: a,
                    onCrop: function(t, i) {
                        var n = new Image;
                        n.onload = function() {
                            var e = n.width / t.width;
                            i.x = Math.floor(i.x * e),
                            i.y = Math.floor(i.y * e),
                            i.width = Math.floor(i.width * e),
                            i.height = Math.floor(i.height * e),
                            d({
                                url: a,
                                pid: o.id,
                                rect: i,
                                __image: n
                            })
                        }
                        ,
                        n.src = a
                    }
                }),
                dialogController.rotate(s, e.dialogWindow))
            }
        });
        e.dialogView.$(".head").html("Выберите фото"),
        e.dialogView.$(".submit.btn").remove(),
        e.start(),
        dialogController.rotate(s, dialogSelectPhotosWindow)
    }),
    r.bind("confirm-avatar", l),
    r.bind("do-verification", function() {
        c.setAttr({
            title: "Сделать фото с жестом",
            verificationId: util.generateVerificationId(app.info.viewer_id)
        }),
        r.showSlide(u),
        cAnal.trackEvent({
            p_1: 1
        })
    }),
    r.bind("start-webcam", function() {
        t({
            verificationId: c.verificationId
        })
    }),
    r.bind("remake", function() {
        t({
            verificationId: c.verificationId
        })
    }),
    r.bind("send-avatar", function() {
        var e = c.viewerAvatarWithRect;
        !function(e, t, i) {
            i = {
                img: e,
                pid: t,
                r1x: i.x,
                r1y: i.y,
                r1w: i.width,
                r1h: i.height,
                method: "POST"
            };
            c.setAttr({
                pending: !0
            }),
            ServerApi("photo/addFirst.php", i, function(e, t) {
                if (c.setAttr({
                    pending: !1
                }),
                e)
                    if (e.code === Codes.DAILY_LIMIT_EXCEEDED)
                        dialogController.fadePopup("Вы сможете отправить фото на проверку через " + util.formatMillisToTime(t.leftMillis));
                    else if (e.code === Codes.ACCESS_DENIED) {
                        var i = !1;
                        try {
                            var n, o, a = t.leftMillis;
                            0 < a && (n = new Date(+new Date + a),
                            o = Constants.PHOTO_VERIFICATION_BLOCK_TEXT + util.formatDate(+n, function(e, t, i, n, o) {
                                return e + "." + t + "." + i + " " + n + ":" + o
                            }),
                            dialogController.showMessageDialog({
                                message: o
                            }),
                            i = !0)
                        } catch (e) {}
                        i || dialogController.showMessageDialog({
                            message: "Доступ запрещен. Code: 403"
                        })
                    } else
                        dialogController.showError(e);
                else
                    dialogController.fadePopup("Фото отправлено на проверку"),
                    dialogController.close(r),
                    cAnal.trackEvent({
                        p_4: 1
                    })
            })
        }(e.url, e.pid, e.rect)
    }),
    r.bind("send-current-avatar", function() {
        var t, i, n = app.info.avatarCrop;
        n ? (t = util.obtainMaxPhotoUrl(n.photo),
        (i = new Image).onload = function() {
            function s(e, t, i) {
                return {
                    x: Math.floor(i.x / 100 * e),
                    x2: Math.floor(i.x2 / 100 * e),
                    y: Math.floor(i.y / 100 * t),
                    y2: Math.floor(i.y2 / 100 * t)
                }
            }
            i.width,
            i.height;
            var e = function(e, t, i, n) {
                var o = s(e, t, i)
                  , a = o.x
                  , i = o.y;
                e = o.x2 - o.x,
                t = o.y2 - o.y;
                n = s(e, t, n);
                return {
                    x: a += n.x,
                    y: i += n.y,
                    width: e = n.x2 - n.x,
                    height: t = n.y2 - n.y
                }
            }(i.width, i.height, n.crop, n.rect);
            d({
                url: t,
                pid: n.photo.id,
                rect: e,
                __image: i
            })
        }
        ,
        i.src = t) : dialogController.showMessageDialog({
            message: "Похоже, что у вас очень старая фотография на аватаре ВК. Мы не можем использовать ее, так как она слишком маленькая. Выберете другую фотографию."
        })
    }),
    r.setModel(c);
    var i = null
      , p = function() {
        i && (i.finalize(),
        i = null)
    }
      , n = function() {
        var e = document.createElement("video");
        return e.setAttribute("width", "200"),
        e.setAttribute("height", "200"),
        e.setAttribute("autoplay", "true"),
        e
    };
    function o() {
        setTimeout(function() {
            r.showSlide(u);
            var e = dialogController.showMessageDialog({
                message: "Не удалось получить доступ к камере",
                buttons: [{
                    caption: "Как разблокировать?",
                    handler: function() {
                        try {
                            window.open("https://vk.com/page-75820678_50104561", "_blank").focus()
                        } catch (e) {}
                    }
                }]
            });
            isMobi && dialogController.rotate(s, e)
        }, isMobi ? 500 : 0)
    }
    r.bind("take-photo", function() {
        i && (i.takePhoto(),
        cAnal.trackEvent({
            p_2: 1
        }))
    }),
    r.bind("send-photo", function() {
        var e = util.convertBase64ToByteArray(c.resultImg);
        e ? e && function(e, t) {
            let i = new FormData;
            i.append("binary", e);
            let n = {
                app_id: app.info.api_id,
                auth_key: app.info.auth_key,
                uid: app.info.viewer_id,
                verification: !0,
                verification_id: c.verificationId,
                mimeType: t
            };
            app.info.session && (n.expire = app.info.session.expire,
            n.mid = app.info.session.mid,
            n.secret = app.info.session.secret,
            n.sid = app.info.session.sid,
            n.sig = app.info.session.sig),
            window.isExternal && (n.external_access_key = app.apiPrimaryParams.access_token,
            n.app_id = BOOT_DATA.app_id);
            let o = document.location.protocol;
            window.ODR && (o = "https:");
            t = o + "//sapps-static1.ru/static/secure/cors/upload";
            let a = [];
            t += "?",
            $.each(n, function(e, t) {
                util.isDef(t) && a.push(e + "=" + t)
            }),
            t += a.join("&"),
            n = i,
            c.setAttr({
                pending: !0
            }),
            $.ajax({
                url: t,
                type: "POST",
                data: n,
                dataType: "json",
                processData: !1,
                contentType: !1,
                success: function(e) {
                    if (c.setAttr({
                        pending: !1
                    }),
                    200 === e.code) {
                        dialogController.fadePopup("Фото отправлено на проверку");
                        var t = app.commonState.verificationPhoto || {};
                        t.u = e.data.url,
                        app.commonState.setAttr({
                            verificationPhoto: t
                        }),
                        selfProfileController.photosController.canAddFirstPhoto() ? l() : dialogController.close(r),
                        cAnal.trackEvent({
                            p_3: 1
                        })
                    } else if (403 === e.code && e.data && e.data.response && 403 === e.data.response.code) {
                        t = !1;
                        try {
                            var i, n, o = e.data.response.data.leftMillis;
                            0 < o && (i = new Date(+new Date + o),
                            n = Constants.PHOTO_VERIFICATION_BLOCK_TEXT + util.formatDate(+i, function(e, t, i, n, o) {
                                return e + "." + t + "." + i + " " + n + ":" + o
                            }),
                            dialogController.showMessageDialog({
                                message: n
                            }),
                            t = !0)
                        } catch (e) {}
                        t || dialogController.showMessageDialog({
                            message: "Вы уже загружали проверочное фото!"
                        })
                    } else
                        dialogController.showMessageDialog({
                            message: "Произошла ошибка:<br>Code:{0}{1}".format(e.code, e.data ? "<br>" + JSON.stringify(e.data) : e.message ? "<br>" + e.message : "")
                        })
                },
                error: function(e, t) {
                    c.setAttr({
                        pending: !1
                    }),
                    ajaxLoader.hide(),
                    dialogController.showError("Произошлa ошибка.<br>Status: " + e.status + (t ? "<br>" + t : "")),
                    console.info(arguments)
                }
            })
        }(e, util.getContentTypeFromB64(c.resultImg)) : dialogController.fadePopup("Произошла ошибка при конвертации изображения")
    }),
    r.onRemove(function() {
        p()
    }),
    e.selectAvatar ? l() : (c.setAttr({
        title: "Верификация вашего профиля"
    }),
    r.showSlide(1)),
    app.canVerifyPhotos(app.info.age) && (s = dialogController.open(r, {
        dialogClass: "small-close no-padding"
    }))
}
,
app.controllers.dialog.VerificationStatus = function() {
    if (!app.canVerifyPhotos(app.info.age))
        return this;
    if (!app.canVerify())
        return this;
    var a = lilo.createView("dialog-verification-status")
      , s = {
        status: -1,
        pending: !0,
        verificationPhotoRejectReasonText: "",
        verificationPhotoTs: null,
        photoTs: null,
        photoRejectReasonText: "",
        verificationError: "",
        photo: !1
    };
    a.setModel(s),
    a.bind("go-to-photos", function() {
        app.eventBus.trigger(app.EVENTS.GO_TO_PHOTOS),
        dialogController.close(a)
    }),
    a.bind("add-verification-photo", function() {
        new app.controllers.dialog.VerificationPhoto,
        dialogController.close(a)
    }),
    a.bind("add-avatar", function() {
        new app.controllers.dialog.VerificationPhoto({
            selectAvatar: !0
        }),
        dialogController.close(a)
    }),
    dialogController.open(a, {
        dialogClass: "no-padding small-close"
    });
    var r = 31536e6;
    ServerApi("user/verification/status.php", {}, function(e, t) {
        var i, n, o;
        e ? (dialogController.showError(e),
        dialogController.close(a)) : ((t = (e = t.statusObject).data) && ((i = t.photo) && (s.setAttr({
            photoTs: (n = i.t,
            o = util.serverUtc(),
            n = 10 * r < n - o ? n - 50 * r + 1e3 * (new Date).getTimezoneOffset() * 60 : n)
        }),
        (o = VerificationRejectReasons.get(i.r)) && s.setAttr({
            photoRejectReasonText: "Причина: " + o
        })),
        (n = t.verificationPhoto) && (s.setAttr({
            verificationPhotoTs: n.t
        }),
        (o = VerificationRejectReasons.get(n.a) || n.b) && s.setAttr({
            verificationPhotoRejectReasonText: "Причина: " + o
        }))),
        s.setAttr({
            pending: !1,
            status: e.status
        }),
        i ? s.setAttr({
            photo: util.cloneObject(i)
        }) : s.setAttr({
            photo: null
        }),
        n && app.commonState.setAttr({
            verificationPhoto: n
        }),
        app.commonState.setAttr({
            verified: 9 === e.status
        }))
    })
}
,
app.controllers.dialog.ImageCropper = function(t) {
    var i = lilo.createView("dialog-image-cropper")
      , e = {
        sourceImageUrl: t.url
    };
    i.bind("submit", function() {
        var e = i.getData();
        t.onCrop(e.rect1, e.rect2),
        dialogController.close(i)
    }),
    this.dialogWindow = dialogController.open(i, {
        mobiFullHeight: 1
    }),
    i.setModel(e)
}
,
app.controllers.dialog.AddYtTrack = function(i) {
    var o = lilo.createView("dialog-add-my-yt-track")
      , a = {
        iM: null,
        iS: null,
        iH: null,
        id: "",
        title: "",
        duration: 0,
        categoryId: null,
        link: "",
        errors: "",
        hasTrack: !1
    };
    function s(e) {
        var i = [];
        e.each(function(e, t) {
            i.push("<p>" + (e + 1) + ". " + t + "</p>")
        }),
        a.setAttr({
            errors: i.join("")
        }),
        i.length && o.hightLightErrors()
    }
    o.setModel(a),
    o.bind("submit-link", function(e) {
        var i, n, t = e.extraData.link;
        t !== a.link && ((e = util.getYTIdFromLink(t)) ? (a.setAttr({
            hasTrack: !1,
            iS: null,
            iH: null,
            iM: null,
            id: e,
            title: "",
            duration: 0,
            categoryId: null,
            link: t,
            errors: ""
        }),
        i = e,
        n = function(e) {
            a.setAttr({
                iM: e.previewMedium,
                iS: e.previewStandard,
                iH: e.previewHigh,
                categoryId: e.categoryId,
                title: e.title,
                duration: e.duration,
                hasTrack: !0
            }),
            e = [],
            a.hasTrack && (a.title || e.push("У клипа пустой заголовок."),
            a.duration < 6e4 ? e.push("Минимальная длина клипа 1 мин.") : 3e5 < a.duration && e.push("Максимальная длина клипа 5 мин."),
            "10" === a.categoryId || "24" === a.categoryId || e.push("Клип может быть только музыкальным")),
            s(e)
        }
        ,
        o.showLoader("Получение данных..."),
        ServerApi("yt/info.php", {
            id: i
        }, function(e, t) {
            o.hideLoader(),
            e ? e.code === Codes.LIMIT ? dialogController.fadePopup("Вы достигли лимита на сегодня") : e.code === Codes.NOT_FOUND ? dialogController.showMessageDialog({
                message: "Не удалось получить информацию по клипу #" + i
            }) : dialogController.showError(e) : n(t.video)
        })) : s(["Не удалось распознать ссылку"]))
    }),
    o.bind("submit", function(e) {
        a.hasTrack && (a.errors ? o.hightLightErrors() : (o.showLoader("Сохранение..."),
        ServerApi("yt/save.php", {
            id: a.id
        }, function(e, t) {
            o.hideLoader(),
            e ? e.code === Codes.ALREADY_EXIST ? dialogController.fadePopup("Вы уже добавляли этот клип") : dialogController.showError(e) : (t = {
                id: t.id,
                ytId: a.id,
                duration: a.duration,
                title: a.title,
                iS: a.iS,
                iH: a.iH,
                iM: a.iM
            },
            i.onTrackCreate(t),
            dialogController.close(o))
        })))
    }),
    dialogController.open(o, {
        dialogClass: "no-padding",
        mobiFullHeight: 1
    })
}
,
app.controllers.dialog.YTTracks = function(a) {
    function s() {
        return dialogController.dialogIsOpen(d)
    }
    function r(e) {
        e.youtube || (e.youtube = !0,
        e.ytId = e.ytId || e._id || e.id,
        e.appId = e.id || 0,
        e.duration = e.duration || e.d,
        e.title = e.title || e.t)
    }
    function n(e) {
        return e ? {
            u: e.u,
            w: e.w,
            h: e.h
        } : null
    }
    function l(e) {
        $.isArray(e) || (e = [e]);
        var i = [];
        return e.each(function(e, t) {
            i.push({
                youtube: !0,
                preview: t.preview,
                ytId: t.ytId,
                appId: t.appId,
                duration: t.duration,
                title: t.title,
                iM: n(t.iM),
                iS: n(t.iS),
                iH: n(t.iH)
            })
        }),
        i
    }
    var t, o = "yt_video_tags", d = lilo.createView("dialog-yt-tracks"), e = "item-yt-track", i = isMobi ? mobiUiHelper.vw2px(32) : 0, c = function() {
        if (isMobi) {
            var e = mobiUiHelper.vw2px(55)
              , e = mobiUiHelper.appHeight() - e;
            return 2 * Math.floor(e / i)
        }
        return 12
    }(), u = lilo.createView("comments-pagination2", {
        alwaysPresent: isMobi
    }), p = {
        currentPageIndex: 0,
        pagesCount: 0
    }, f = {
        searchParameter: null,
        hasTags: !!util.lStorage.find(o),
        q: 1,
        items: []
    }, m = dialogController.open(d, {
        dialogClass: "no-padding"
    });
    isMobi && d.els.list.height(c * i / 2 + "px");
    var v = new app.sdk.TabViewController({
        $container: d.els["tabs-block"],
        tabs: [new g({
            id: "search",
            title: isMobi ? "Поиск" : "Результаты поиска",
            _pending: !1,
            handleShow: function() {
                this._pending || this.items.length || d.els["no-results"].html("Ничего не найдено").show()
            },
            fetch: function() {
                d.els["no-results"].hide(),
                d.showLoader("Поиск..."),
                this.empty();
                var n = this;
                this._pending = !0,
                ServerApi("yt/search.php", {
                    key_worlds: f.searchParameter
                }, function(e, t) {
                    var i;
                    d.hideLoader(),
                    n._pending = !1,
                    e ? s() && m.showError(e) : (n.isDataReceived = !0,
                    i = [],
                    t.list.each(function(e, t) {
                        r(t),
                        i.push(t)
                    }),
                    n.items = i,
                    n.pageIndex = 0,
                    n.refreshView(),
                    n.handleShow())
                })
            }
        }), new g({
            id: "popular",
            title: "Популярные",
            handleShow: function() {
                this.items.length || d.els["no-results"].html("Нет популярных клипов").show()
            },
            fetch: function() {
                d.els["no-results"].hide(),
                d.showLoader("Загрузка популярных клипов..."),
                this.empty();
                var n = this;
                ServerApi("yt/popular.php", {
                    get_tags: !f.hasTags
                }, function(e, t) {
                    var i;
                    d.hideLoader(),
                    e ? s() && m.showError(e) : (n.isDataReceived = !0,
                    t.tags && (e = JSON.parse(t.tags),
                    util.cache.save(o, e, 864e5),
                    f.setAttr({
                        hasTags: !0
                    })),
                    i = [],
                    t.list.each(function(e, t) {
                        r(t),
                        i.push(t)
                    }),
                    n.items = i,
                    n.pageIndex = 0,
                    n.refreshView(),
                    n.handleShow())
                })
            }
        }), new g({
            id: "recent",
            title: "Новые",
            handleShow: function() {
                this.items.length || d.els["no-results"].html("Нет новых клипов").show()
            },
            fetch: function() {
                d.els["no-results"].hide(),
                d.showLoader("Загрузка новых клипов..."),
                this.empty();
                var n = this;
                ServerApi("yt/recent.php", {
                    get_tags: !f.hasTags
                }, function(e, t) {
                    var i;
                    d.hideLoader(),
                    e ? s() && m.showError(e) : (n.isDataReceived = !0,
                    i = [],
                    t.list.each(function(e, t) {
                        r(t),
                        i.push(t)
                    }),
                    t.tags && (t = JSON.parse(t.tags),
                    util.cache.save(o, t, 864e5),
                    f.setAttr({
                        hasTags: !0
                    })),
                    n.items = i,
                    n.pageIndex = 0,
                    n.refreshView(),
                    n.handleShow())
                })
            }
        }), new g({
            id: "my-tracks",
            title: "Мои клипы",
            itemsPerPage: c - 1,
            fetch: function() {
                d.els["no-results"].hide(),
                d.showLoader("Загрузка моих клипов..."),
                this.empty();
                var o = this;
                ServerApi("yt/my.php", {}, function(e, t) {
                    var i, n;
                    d.hideLoader(),
                    e ? s() && m.showError(e) : (o.isDataReceived = !0,
                    i = [],
                    n = {},
                    t.videos.each(function(e, t) {
                        r(t),
                        i.push(t),
                        n[t.ytId] = !0
                    }),
                    i = i.sort(function(e, t) {
                        return e.appId === t.appId ? 0 : e.appId > t.appId ? -1 : 1
                    }),
                    o.items = i,
                    o.pageIndex = 0,
                    o.refreshView(),
                    i.length,
                    app.eventBus.trigger(app.EVENTS.LOAD_SELF_YT_TRACKS, {
                        idsHash: n
                    }))
                })
            }
        })]
    });
    function h(i) {
        var n = null;
        return v.getTabs().each(function(e, t) {
            if (t.descr.id === i)
                return n = t,
                !1
        }),
        n
    }
    function g(e) {
        var o = this;
        e = $.extend({
            items: [],
            itemsPerPage: c,
            selected: !1,
            handleShow: function() {},
            onOpen: function() {
                d.els["no-results"].hide(),
                o.isDataReceived ? (o.refreshView(),
                o.handleShow()) : o.fetch(),
                d.els["main-block"].addClass(o.id)
            },
            onClose: function() {
                d.els["main-block"].removeClass(o.id)
            },
            fetch: function() {},
            empty: function() {
                o.items = [],
                o.pageIndex = 0,
                o.refreshView()
            }
        }, e),
        isMobi && (e.createTab = function(e) {
            var t = document.createElement("div");
            return t.className = "select-tab",
            t.innerHTML = e.caption,
            t
        }
        ),
        $.extend(o, e),
        this.refreshView = function() {
            isMobi ? d.setItems({
                pageIndex: this.pageIndex,
                items: l(this.items),
                itemsPerPage: c,
                isSelfItems: "my-tracks" === o.id,
                price: a.price || 0
            }) : (t = new app.controllers.PaginationController({
                itemsPerPage: e.itemsPerPage,
                items: o.items,
                onPageSelect: function(e) {
                    var t = e.index
                      , i = e.total
                      , n = e.items;
                    e.hasNext,
                    e.hasPrev;
                    f.items.removeAll();
                    n = l(n);
                    n.each(function(e, t) {
                        t.canRemove = "my-tracks" === o.id,
                        t.price = a.price || 0
                    }),
                    f.items.add(n),
                    p.setAttr({
                        currentPageIndex: t,
                        pagesCount: i
                    }),
                    o.pageIndex = t
                }
            })).showPage(this.pageIndex)
        }
    }
    d.setModel(f),
    u.setModel(p),
    d.$(".pagination").append(u.el),
    u.bind("show-page", function(e) {
        e = e.extraData.pageIndex;
        t.showPage(e)
    }),
    d.bind("search-yt-track", function(e) {
        var i, e = (e = (e = e.extraData.key).replace(/,|\.|\+|\-|\=|/g, "").split(" "),
        i = [],
        e.each(function(e, t) {
            if ((t = $.trim(t).toLowerCase()).length && (30 < t.length && (t = t.substr(0, 30)),
            i.push(t),
            3 === i.length))
                return !1
        }),
        i.length ? JSON.stringify(i) : null);
        e && (f.setAttr({
            searchParameter: e
        }),
        (e = h("search")).isDataReceived = !1,
        e.$tabEl.css("display", "inline-block"),
        e.select(),
        isMobi && d.el.addClass("visible-4-tabs"))
    }),
    d.on("add:" + e, function(e) {
        e.extraData.el;
        e = e.extraData.model;
        a.onSubmit(e),
        dialogController.close(d)
    }),
    d.on("click:" + e, function(e) {
        !function(i) {
            var e = lilo.createView("dialog-yt-preview")
              , n = null;
            ["iH", "iS", "iM"].each(function(e, t) {
                if (i[t])
                    return !(n = {
                        w: i[t].w,
                        u: i[t].u,
                        h: i[t].h
                    })
            }),
            e.setModel({
                preview: n ? n.u : null,
                progress: 0,
                duration: i.duration,
                volume: 100,
                lastActiveVolume: 100,
                paused: !1
            });
            dialogController.open(e, {
                dialogClass: "no-padding hide-close yt-preview-dialog top-right-close-hint",
                staticTop: 112 + d.el.offset().top
            });
            e.onRemove(function() {
                b.stop(),
                app.eventBus.trigger(app.EVENTS.AUDIO_PREVIEW_STOP)
            }),
            b.start(i.ytId, e)
        }(e.extraData.model)
    });
    var b = function() {
        var c = "yt-preview-wrapper"
          , u = "yt.preview.volume"
          , p = parseInt(util.lStorage.find(u), 10);
        function i(e, t) {
            var i = {
                enabled: !1,
                unmuted: !1
            };
            browserInfo.isChrome && util.isOKPlatform() && (i.enabled = !0);
            function n() {
                clearInterval(o),
                o = setInterval(function() {
                    var e;
                    d ? clearInterval(o) : 1 === l && (e = a.getCurrentTime(),
                    s.setAttr({
                        progress: 1e3 * (e || 0)
                    }))
                }, 500)
            }
            var o, a, s = t.model, r = !1, l = null, d = !1;
            t.els["player-container"].html("<div id='" + c + "'></div>"),
            a = new YT.Player(c,{
                height: 340,
                width: 604,
                playerVars: {
                    fs: 0,
                    autoplay: 0,
                    rel: 0,
                    version: 3,
                    origin: "*",
                    enablejsapi: 1,
                    allowfullscreen: !1,
                    wmode: "transparent",
                    cc_load_policy: 0,
                    iv_load_policy: 3,
                    modestbranding: 1,
                    disablekb: 1,
                    playsinline: isMobi ? 1 : 0,
                    showinfo: 0,
                    controls: 0
                },
                events: {
                    onReady: function() {
                        r = !0,
                        console.info("yt-onReady", arguments),
                        a.setVolume(s.volume),
                        n(),
                        r && !d && (app.eventBus.trigger(app.EVENTS.AUDIO_PREVIEW_START),
                        app.youtubePlayer.closeMusicStream(),
                        i.enabled && (i.unmuted || a.mute()),
                        a.loadVideoById({
                            videoId: e,
                            startSeconds: 0,
                            suggestedQuality: "large"
                        })),
                        t.el.addClass("ready")
                    },
                    onStateChange: function(e) {
                        console.info("yt-onStateChange", arguments),
                        0 === (l = e.data) || 5 === l || -1 === l || 2 === l ? s.setAttr({
                            paused: !0
                        }) : s.setAttr({
                            paused: !1
                        }),
                        2 === l && i.enabled && !i.unmuted && a.isMuted() && (a.unMute(),
                        setTimeout(function() {
                            a.isMuted() || (i.unmuted = !0)
                        }, 300))
                    },
                    onError: function() {
                        console.info("yt-onError", arguments)
                    }
                }
            }),
            t.bind("pause", function(e) {
                r && a.pauseVideo()
            }),
            t.bind("play", function(e) {
                r && a.playVideo()
            }),
            t.bind("change-volume", function(e) {
                s.setAttr({
                    volume: e.extraData.value
                }),
                p = s.volume
            }),
            t.bind("on-volume", function(e) {
                s.setAttr({
                    volume: p || 30
                })
            }),
            t.bind("off-volume", function(e) {
                s.setAttr({
                    volume: 0
                })
            }),
            t.bind("change-progress", function(e) {
                r && (clearInterval(o),
                e = e.extraData.value,
                e = s.duration * e,
                a.seekTo(Math.floor(e / 1e3), !0),
                s.setAttr({
                    progress: e
                }),
                setTimeout(n, 2e3))
            }),
            s.onChange("volume", function() {
                r && a.setVolume(s.volume)
            }),
            s.setAttr({
                volume: p
            }),
            this.stop = function() {
                d = !0,
                a && r && e && (a.stopVideo(),
                a.clearVideo(),
                e = null),
                util.lStorage.save(u, p)
            }
        }
        isNaN(p) && (p = 50);
        function n() {
            o && (o.stop(),
            o = null)
        }
        var o;
        return {
            start: function(e, t) {
                n(),
                o = new i(e,t)
            },
            stop: function() {
                n()
            }
        }
    }();
    return d.on("delete:" + e, function(e) {
        var t = e.extraData.el
          , a = e.extraData.model;
        t.css("opacity", "0.6"),
        d.showLoader("Удаление..."),
        ServerApi("yt/my/delete.php", {
            id: a.appId
        }, function(e, t) {
            var i, n, o;
            d.hideLoader(),
            s() && (e ? dialogController.showError(e) : (i = h("my-tracks"),
            -1 !== (e = (e = i.descr.items,
            n = a,
            o = -1,
            e.each(function(e, t) {
                if (t.ytId === n.ytId)
                    return o = e,
                    !1
            }),
            o)) && (i.descr.items.splice(e, 1),
            i.descr.refreshView(),
            app.eventBus.trigger(app.EVENTS.DELETE_SELF_YT_TRACK, {
                id: a.ytId
            }))))
        })
    }),
    d.bind("add-track-by-link", function(e) {
        new app.controllers.dialog.AddYtTrack({
            onTrackCreate: function(e) {
                r(e);
                var t = h("my-tracks").descr;
                t.items.splice(0, 0, e),
                t.refreshView()
            }
        })
    }),
    f.onChange("searchParameter", function() {
        h("search").descr.fetch()
    }),
    h("search").$tabEl.hide(),
    h("recent").select(),
    {
        dialogWindow: m
    }
}
,
app.controllers.dialog.SwitchRoomLimit = function(i) {
    var t = i.price || 1
      , n = $.noop
      , o = $.noop;
    function e() {
        var e = app.balanceModel.ruby - t;
        e < 0 ? dialogController.showInsufficientlyBalanceDialog(e, {
            currency: 2
        }) : (o(),
        ServerApi("room/v3/resetTimer.php", {}, function(e, t) {
            t && util.isDef(t.ruby) && app.balanceModel.setAttr({
                ruby: t.ruby
            }),
            e ? (e.code === Codes.NOT_ENOUGH_BALANCE ? dialogController.showInsufficientlyBalanceDialog(t.deficit, {
                currency: 2
            }) : dialogController.showError(e),
            n(!1)) : (n(!0),
            i.paymentJoin())
        }))
    }
    var a, s, r, l, d, c = "_price_" + util.nextCounter(), u = "_price_" + util.nextCounter(), p = $(document.createElement("div"));
    d = isMobi ? (a = document.createElement("div"),
    s = document.createElement("span"),
    a.innerHTML = "Вы сможете сменить комнату через&nbsp;",
    a.appendChild(s),
    {
        isOpen: function() {
            return app.controllers.MobilePopup.hasPopup()
        },
        open: function() {
            new app.controllers.MobilePopup({
                textContent: a,
                btns: [{
                    title: "Сменить сейчас<span id='{2}'>&nbsp;<b id='{1}'>{0}</b><span style='width: 6vw;height: 5vw;'  class='smart-ruby high-res'></span><span>".format(t, c, u),
                    handler: function() {
                        return e(),
                        !1
                    }
                }]
            }),
            p = $("#" + c)
        },
        update: function(e) {
            s.innerHTML = e,
            p.html(t)
        },
        hideTimerAndPrice: function() {
            a.style.visibility = "hidden",
            $("#" + u).hide()
        },
        close: function() {
            app.controllers.MobilePopup.close()
        }
    }) : {
        isOpen: function() {
            return r && r.dialog.isVisible
        },
        open: function() {
            r = dialogController.showMessageDialog({
                message: "Вы сможете сменить комнату через <span class='timer'><span>",
                buttons: [{
                    caption: "Сменить сейчас&nbsp;<span id='{2}'><b id='{1}'>{0}</b> <span style='width: 18px;height: 14px;' class='smart-ruby'></span></span>".format(t, c, u),
                    handler: function() {
                        return e(),
                        !1
                    }
                }, {
                    mobiClose: 1,
                    caption: "Отмена",
                    handler: function() {
                        return !1
                    }
                }]
            }),
            l = r.dialog.$(".timer"),
            p = r.el.find("#" + c)
        },
        update: function(e) {
            l.html(e),
            p.html(t)
        },
        hideTimerAndPrice: function() {
            r.el.find(".message").hide(),
            $("#" + u).hide()
        },
        close: function() {
            dialogController.close(r)
        }
    };
    function f() {
        if (0 < v) {
            var e = Math.max(Math.floor(v / 1e3) - 1, 0);
            return 1 + Math.floor(e / 30)
        }
        return 0
    }
    function m(e, t, i) {
        return t + ":" + i
    }
    var v = i.leftMillis + 4e3
      , h = function() {
        t = f(),
        function(e) {
            e = util.formatMillisToTime(e, m);
            d.update(e)
        }(v),
        0 === v ? d.hideTimerAndPrice() : d.isOpen() && (v = Math.max(0, v - 1e3),
        setTimeout(h, 1e3))
    }
      , t = f();
    d.open(),
    h()
}
;
var EXECUTE_STRINGS = {
    getLast10WallPosts: function(e) {
        var i = [];
        return $.each(e, function(e, t) {
            i.push('"{0}":API.wall.get({"owner_id":{0},"count":10,"v":"5.120"})'.format(t))
        }),
        "return {" + i.join(",") + "};"
    },
    searchFriendsByNameCase: function(e, t) {
        return 'return {friends_nom:API.friends.search({fields:"{0}",count:1000,q:"",v:"5.120"}),friends_{1}:API.friends.search({name_case:"{1}",count:1000,q:"",v:"5.120"})};'.format(e, t)
    },
    getFriendsAndUsersForViralGame: function(e) {
        e = e.join(",");
        return 'return {friends_nom:API.friends.search({v:"5.120",fields:"photo_100,first_name,last_name,sex,bdate,can_post",count:1000,q:""}),friends_gen:API.friends.search({v:"5.120",fields:"{0}",name_case:"gen",count:1000,q:""}),friends_dat:API.friends.search({v:"5.120",fields:"{0}",name_case:"dat",count:1000,q:""}),friends_acc:API.friends.search({v:"5.120",fields:"{0}",name_case:"acc",count:1000,q:""}),friends_ins:API.friends.search({v:"5.120",fields:"{0}",name_case:"ins",count:1000,q:""}),friends_abl:API.friends.search({v:"5.120",fields:"{0}",name_case:"abl",count:1000,q:""}),users_nom:API.users.get({v:"5.120",user_ids:"{1}",fields:"photo_100,first_name,last_name,bdate,can_post"}),users_dat:API.users.get({v:"5.120",user_ids:"{1}",fields:"{0}",name_case:"dat"}),members1:API.groups.getMembers({v:"5.120",group_id:9713780,count:1000,filter:"friends"}),members2:API.groups.getMembers({v:"5.120",group_id:1,count:1000,filter:"friends"})};'.format("first_name,last_name", e)
    },
    getUserOnlineAndAppUser: function(e) {
        return 'return {"isAppUser":API.users.isAppUser({user_id:"{0}",v:"5.120"}),"user":API.users.get({v:"5.120",user_ids:"{0}",fields:"online,can_post"})};'.format(e)
    },
    getAudio: function(e, t, i) {
        return 'var audios = "{0}", artist = "{1}", title="{2}",audios = API.audio.getById({"audios":audios,v:"5.120"});var temp = audios;if(!audios.length){var query = artist + " " + title;audios = API.audio.search({"q":query,"sort":2,"count":100,v:"5.120"});}else {audios = {items:temp};}return { "result":audios };'.format(e, t, i)
    },
    getRoomUsers: function(e) {
        e = e.join(",");
        return 'var users = API.users.get({"user_ids":"' + e + '","fields":"photo_100,photo_200,bdate,sex","v":"5.120"});var usersAcc = API.users.get({"user_ids":"' + e + '",name_case:"acc","v":"5.120"});var usersGen = API.users.get({"user_ids":"' + e + '",name_case:"gen","v":"5.120"});var usersDat = API.users.get({"user_ids":"' + e + '",name_case:"dat","v":"5.120"});return {users:users,usersAcc:usersAcc,usersDat:usersDat,usersGen:usersGen};'
    },
    getFriendsAndWallLikesAndAppFriends: function(e) {
        return 'var wallPosts = API.wall.get({v:"5.120","count":15}).items@.id;var allLikes = [];var index = 1;while(index < wallPosts.length){allLikes.push(API.likes.getList({item_id:wallPosts[index],type:"post",friends_only:0}));index = index+1;}return {"likes":allLikes,"appFriends":API.friends.getAppUsers({v:"5.120"}),"friends": API.friends.get( {v:"5.120", "fields": "' + e + '" } )};'
    },
    getAlbums: function(e) {
        return 'var albums = API.photos.getAlbums({"need_system":1,"owner_id":' + e + ',"v":"5.120"});var publicAlbums = [];var thumbIds = [];var resultArray = [];var i =0;if(albums){while(i!=albums.count){var item = albums.items[i];i = i+1;if(item.size>0&&((item.id==-6||item.id==-7||item.id==-15)||(!!item.privacy_view && item.privacy_view.type == "all" && !item.except_lists && !item.except_users))){var albumModel = {title:item.title,id:item.id,thumb_id:item.thumb_id};publicAlbums.push(albumModel);thumbIds.push(item.owner_id + "_" +item.thumb_id );}}if(!!thumbIds.length){i=0;while(i!=publicAlbums.length){var album = publicAlbums[i];resultArray.push({title:album.title,thumb_id:album.thumb_id,id:album.id});i=i+1;}}}return {albums:resultArray,thumbIds:thumbIds,vkAlbums:albums};'
    }
};
!function() {
    function t(i, e) {
        var n = [];
        return $.each(e, function(e, t) {
            n.push(new i(t))
        }),
        n
    }
    function i(e) {
        this.pending = !1,
        this._id = e._id,
        this.uid = e.uid,
        this.pid = e.pid,
        this.__width = 0,
        this.__height = 0,
        this.imgUrl = ""
    }
    function a(e) {
        var t = this;
        t._id = e._id,
        t.oid = e.oid,
        t.gid = e.gid,
        t.ts = e.ts,
        t.ad = e.ad,
        t.exp = e.exp,
        t.photoUrl = "",
        t.firstName = "",
        t.lastName = "",
        t.fullName = "",
        t.sex = 1
    }
    function s(e, t) {
        this.ts = e.ts,
        this.text = e.text,
        this.uid = e.uid,
        this.photoUrl = "",
        this.fullName = "",
        this.exp = t
    }
    function n(e) {
        var t = e.fromR === app.info.viewer_id
          , i = e.to === app.info.viewer_id;
        this.fromAge = e.fromAge,
        this.toAge = e.toAge,
        this.__canDeleteComment = i,
        this.fromExp = e.fromExp,
        this.toExp = e.toExp,
        this.exp = this.fromExp,
        this.pub = e.pub,
        this.isAnonymous = -1 === e.from,
        this._id = e._id,
        this.ts = e.ts,
        this.upd = e.upd || e.ts,
        this.fromReal = e.fromR,
        this.from = t ? e.fromR : e.from,
        this.to = e.to,
        this.text = e.text,
        this.isBlock = !!e.isBlock,
        e.ban && (this.isBlock = !0),
        this.lastReply = e.lastReply,
        this.comments = this.createComments(e.comments),
        this.fromPhotoUrl = e.fromPhotoUrl || "",
        this.toPhotoUrl = e.toPhotoUrl || "",
        this.fromFullName = util.escapeHtml(e.fromFullName || "", 0, 1),
        this.toFullName = util.escapeHtml(e.toFullName || "", 0, 1),
        this.toVF = !!e.toVF,
        this.fromVF = !!e.fromVF,
        this.isAnonymous && (this.exp = null,
        t && (this.fromFullName = n.ANONYMOUS_SELF_FULL_NAME,
        this.fromPhotoUrl = n.ANONYMOUS_PHOTO_URL))
    }
    function o(e) {
        $.extend(this, e)
    }
    function e(e, t, i, n) {
        var o = this;
        o.__opts = n || {},
        o.__popupId = n.popupId,
        o.__giftDescrpitionsHash = n.giftDescrpitionsHash,
        o.__gift = e,
        o.__giftId = e.id,
        o.__recipientUid = t,
        o.__recipientSex = i,
        o.isFav = e.isFav,
        o.dispose = function() {}
        ,
        o.__items = [],
        o._createItems()
    }
    function r(e) {
        var t = 0;
        this.reasonId = e[t++],
        this.anon = e[t++],
        this.price = e[t++],
        this.initiatorId = e[t++],
        this.initiatorName = e[t++],
        this.initiatorIsMale = e[t++],
        this.initiatorAge = e[t++],
        this.startTime = e[t++],
        this.duration = e[t++],
        this.currentMillis = e[+t],
        this.leftMillis = e[10],
        this.timeMarker = +new Date,
        this.updateCounter = 1,
        this.leftTime = 0
    }
    i.mergeWithVKData = function(e, t) {
        var n = []
          , o = util.collectArrayInObjectByProperty(e, "_id");
        return $.each(t, function(e, t) {
            var i = t.owner_id + "_" + t.id
              , i = o[i];
            i && (i.imgUrl = t.photo_604,
            i.__width = t.width,
            i.__height = t.height,
            n.push(i))
        }),
        n
    }
    ,
    i.createArray = function(e) {
        return t(i, e)
    }
    ,
    a.ANONYMOUS_GUEST_ID = -100,
    a.createArray = function(e) {
        return t(a, e)
    }
    ,
    a.mergeWithVKData = function(i, e) {
        var o = [];
        return $.each(e, function(e, n) {
            var t = i[n.id];
            t && $.each(t, function(e, t) {
                var i = new a(t);
                i.photoUrl = n.photo_100,
                i.firstName = n.first_name + util.formatProfileBdate(n.bdate, t.age),
                i.lastName = n.last_name,
                i.fullName = n.first_name + " " + n.last_name,
                i.sex = n.sex,
                o.push(i)
            })
        }),
        o.sort(function(e, t) {
            return e.ts > t.ts ? -1 : 1
        }),
        o
    }
    ,
    n.ANONYMOUS_SELF_FULL_NAME = (n.ANONYMOUS_FULL_NAME = "Анонимно") + " (Ваша запись)",
    n.ANONYMOUS_PHOTO_URL = app.ANONYMOUS_IMG,
    n.createArray = function(e) {
        var i = [];
        return $.each(e, function(e, t) {
            i.push(new n(t))
        }),
        i
    }
    ,
    n.createArrayWithSubComments = function(e) {
        var i = [];
        return $.each(e, function(e, t) {
            t = new n(t);
            t.__applyDataToComments(),
            i.push(t)
        }),
        i
    }
    ,
    $.extend(n.prototype, {
        createComments: function(n) {
            var o = []
              , a = this;
            return $.each(n, function(e, t) {
                a.to === t.uid ? i = a.toExp : a.isAnonymous || (i = a.fromExp);
                var i = new s(t,i);
                i.canDelete = a.__canDeleteComment,
                e === n.length - 1 && (i.uid === app.info.viewer_id || a.from === app.info.viewer_id && -1 === i.uid) && (i.canDelete = !0),
                o.push(i)
            }),
            o
        },
        __applyDataToComments: function() {
            var i, n, o;
            this.fromPhotoUrl && this.fromFullName && (i = this.from,
            o = this,
            $.each(this.comments, function(e, t) {
                (t.uid === i || i === app.info.viewer_id && o.isAnonymous) && (t.fullName = o.fromFullName,
                t.photoUrl = o.fromPhotoUrl)
            })),
            this.toPhotoUrl && this.toFullName && (n = this.to,
            o = this,
            $.each(this.comments, function(e, t) {
                t.uid === n && (t.fullName = o.toFullName,
                t.photoUrl = o.toPhotoUrl)
            })),
            n = this.to,
            i = this.from,
            $.each(this.comments, function(e, t) {
                t.uid === n ? t.vf = o.toVF : t.uid === i && (t.vf = o.fromVF)
            })
        },
        _setFromFullName: function(e) {
            this.fromFullName = e,
            this.__applyDataToComments()
        },
        _setToFullName: function(e) {
            this.toFullName = e,
            this.__applyDataToComments()
        },
        _setFromPhotoUrl: function(e) {
            this.fromPhotoUrl = e,
            this.__applyDataToComments()
        },
        _setToPhotoUrl: function(e) {
            this.toPhotoUrl = e,
            this.__applyDataToComments()
        },
        applyData: function(e, t, i, n) {
            this._setFromFullName(e),
            this._setToFullName(t),
            this._setFromPhotoUrl(i),
            this._setToPhotoUrl(n),
            this.__applyDataToComments()
        }
    }),
    o.normalizeUrl = function(e) {
        return e ? GIFT_IMGS_SERVER + e + ".png" : ""
    }
    ,
    o.imgUrlToId = function(e) {
        e = e.substr(GIFT_IMGS_SERVER.length);
        return e.substr(0, e.length - ".png".length)
    }
    ,
    o.normalizeSoundUrl = function(e) {
        return e ? GIFT_SOUNDS_SERVER + e + ".wav" : ""
    }
    ,
    o.soundUrlToId = function(e) {
        e = e.substr(GIFT_SOUNDS_SERVER.length);
        return e.substr(0, e.length - ".wav".length)
    }
    ,
    o.fromArray = function(e) {
        var n = [];
        return e.each(function(e, t) {
            var i = 0;
            n.push(new o({
                id: t[i++],
                type: t[i++],
                price: t[i++],
                rubyPrice: t[i++],
                expBonusForSender: t[i++],
                expBonusForRecipient: t[i++],
                recipientBalanceBonus: t[i++],
                categories: t[i++] || [],
                status: t[i++],
                title: t[i++],
                dialogTitle: t[i++],
                img: o.normalizeUrl(t[i++]),
                imgLanding: o.normalizeUrl(t[i++]),
                imgFly: o.normalizeUrl(t[i++]),
                imgSight: o.normalizeUrl(t[i++]),
                ttl: t[i++],
                x: t[i++],
                y: t[i++],
                w: t[i++],
                h: t[i++],
                a: t[i++],
                popupId: t[i++],
                minLevel: t[i++],
                isIncGiftCounter: t[i++],
                isViewerCanClean: t[i++],
                chatMessagesArray: t[i++] || {},
                randomAngle: t[i++] || 0,
                updated: t[i++],
                soundSending: o.normalizeSoundUrl(t[i++]),
                soundLanding: o.normalizeSoundUrl(t[i++]),
                isForBeginner: t[i++],
                beginnerSex: t[i++] || 0,
                targetUserSex: t[i++] || 0,
                sexCombo: t[i++] || [1, 2, 3, 4],
                isMulticolor: t[+i] || !1,
                landingImages: t[35] || []
            }))
        }),
        n
    }
    ,
    $.extend(e.prototype, {
        _createItems: function() {
            function e(e, t, i) {
                n._append(e, t, i)
            }
            var n = this
              , t = n.__recipientSex
              , i = window.ROOM_GIFT_ACTION
              , o = rawGiftsHash;
            switch (n.__popupId || o[n.__gift.id].popupId) {
            case 1:
                e(i.ONE_USER_X10, 10),
                e(i.ONE_USER_X50, 50),
                e(i.ONE_USER_X1, 1),
                e(i.MANY_USERS_X30, 30, t),
                e(i.MANY_USERS_X50, 50, t);
                break;
            case 2:
                e(i.ONE_USER_X10, 10),
                e(i.ONE_USER_X30, 30),
                e(i.ONE_USER_X50, 50),
                e(i.ONE_USER_X1, 1),
                e(i.MANY_USERS_X10, 10, t),
                e(i.MANY_USERS_X30, 30, t),
                e(i.MANY_USERS_X50, 50, t);
                break;
            case 3:
                e(i.ONE_USER_X3, 3),
                e(i.ONE_USER_X1, 1),
                e(i.ONE_USER_X10, 10);
                break;
            case 4:
                e(i.ONE_USER_X10, 10),
                e(i.ONE_USER_X30, 30),
                e(i.ONE_USER_X1, 1),
                e(i.MANY_USERS_X1, 1, t);
                break;
            case 5:
                e(i.ONE_USER_X1, 1),
                e(i.MANY_USERS_X1, 1, t);
                break;
            case 6:
                e(i.ONE_USER_X1, 1)
            }
        },
        _append: function(e, t, i) {
            this.__items.push({
                __actionId: e,
                sex: i,
                count: t
            })
        }
    });
    var l = Math.max;
    $.extend(r.prototype, {
        calcLeftMillis: function() {
            var e = +new Date - this.timeMarker
              , e = this.leftMillis - e;
            return l(0, e)
        },
        PROPS: ["reasonId", "anon", "price", "initiatorId", "initiatorName", "initiatorIsMale", "initiatorAge", "startTime", "duration", "currentMillis", "leftMillis"],
        update: function(i) {
            var n = {};
            $.each(this.PROPS, function(e, t) {
                n[t] = i[t]
            }),
            this.setAttr(n),
            this.timeMarker = +new Date,
            this.tick(),
            this.setAttr({
                updateCounter: this.updateCounter + 1
            })
        },
        reset: function() {
            var e = r.createDefault();
            this.update(e)
        },
        tick: function() {
            this.setAttr({
                leftTime: this.calcLeftMillis()
            })
        }
    }),
    r.createDefault = function() {
        return new r([0, !1, 0, 0, "", !1, 0, 0, 0, 0, 0])
    }
    ,
    app.models = {
        UsersDeportation: r,
        PopupModel: e,
        Guest: a,
        Photo: i,
        RawGift: o,
        SubCommentModel: s,
        CommentModel: n,
        AD_STATUS: {
            NOT_ACTIVE: 1,
            STOPPED: 2,
            STARTED: 3,
            SHUTDOWN: 5
        },
        VIRAL_ANSWER_TYPE: {
            YES: -1,
            NO: -2,
            PERHAPS: -3
        }
    }
}(),
function() {
    function c(e, t) {
        var i = document.createElement("div");
        return i.className = e || "",
        i.innerHTML = t || "",
        i
    }
    var e = lilo.registerSimpleBindHandler
      , t = lilo.registerBindHandler
      , n = 0
      , a = app.GLOBAL_COLORS
      , i = app.GLOBAL_COLORS_HASH
      , l = document.createElement("div")
      , s = function() {
        for (var e = {}, t = 1; t < 22; t += 1)
            e[t] = CDN_PREFIX + "ava_back/back" + t + ".jpg";
        return e
    }();
    function r(e, t) {
        e.css("background", "")
    }
    function o(e, t) {
        "http" !== (t = "/" === (t = (t = util.fixVkUrl(t)) || "res/camera.jpg")[0] ? t.substr(1) : t).substr(0, 4) && (t = BOOT_DATA.appContext + t),
        e.css({
            backgroundImage: "url(" + t + ")",
            backgroundRepeat: "no-repeat",
            backgroundPosition: "0 0",
            backgroundSize: "100% 100%"
        })
    }
    e("ava-back", r),
    t("ava-back-v2", function(e, t, i, n, o) {
        r(t, i.abg),
        i[t.attr("uidProperty") || "uid"],
        app.info.viewer_id
    }),
    e("bg-by-like-type", function(e, t) {
        0 < t && t < 6 && e.css("backgroundImage", "url(" + CDN_PREFIX + "/likes/" + t + ".png?v=1)")
    }),
    e("photo-like", function(e, t) {
        0 < t ? e.css({
            backgroundImage: "url(" + CDN_PREFIX + "/likes/" + e.attr("type") + ".png?v=1)",
            display: ""
        }).text(t) : e.css("display", "none")
    }),
    e("photo-like-v2", function(e, t) {
        0 < t ? e.css({
            backgroundImage: "url(" + CDN_PREFIX + "/likes/" + e.attr("type") + ".png?v=1)",
            display: ""
        }) : e.css("display", "none")
    }),
    e("verification-photo", function(e, t) {
        t ? e.css({
            backgroundImage: "url(" + CDN_PREFIX + "verification/" + t + "s.jpg)",
            backgroundRepeat: "no-repeat",
            backgroundPosition: "0 0",
            backgroundSize: "100% 100%"
        }) : e.css({
            backgroundImage: "none"
        })
    }),
    e("verification-icon", function(e, t) {
        t ? e.css("display", "inline-block") : e.hide()
    }),
    e("item-photo", function(a, s) {
        s = util.fixVkUrl(s);
        var r = parseInt(a.attr("rect-width"), 10)
          , l = parseInt(a.attr("rect-height"), 10)
          , d = new Image;
        isMobi && (r = appWidth * (r / 500),
        l = appWidth * (l / 500)),
        d.onload = function() {
            var e, t, i, n, o = d.width / d.height;
            d.width >= r && d.height >= l ? 1 == o ? (e = "100% 100%",
            t = "0 0") : e = (t = 1 < o ? "{0}px {1}px".format(-1 * ((i = (n = l) * o) - n) / 2, 0) : "{0}px {1}px".format(0, -1 * ((n = (i = r) / o) - i) / 4),
            "{0}px {1}px".format(i, n)) : (e = "{0}px {1}px".format(d.width, d.height),
            t = "center"),
            a.css({
                backgroundImage: "url(" + s + ")",
                backgroundRepeat: "no-repeat",
                backgroundSize: e,
                backgroundPosition: t
            })
        }
        ,
        d.src = s
    }),
    e("pretty-counter", function(e, t) {
        t = t || 0;
        for (var i = parseInt(e.attr("capacity"), 10), n = c("pretty-counter"), o = t + "", a = (i = (i = isNaN(i) ? 1e6 : i) < t ? t : i) + "", s = 0; o.length !== a.length; )
            o = "0" + o,
            s++;
        var t = o.split("").reverse()
          , i = t.chunks(3).reverse()
          , r = 0
          , l = !0;
        t.each(function(e, t) {
            if ("0" !== t)
                return l = !1
        }),
        i.each(function(e, t) {
            var i = c("capacity");
            t.reverse().each(function(e, t) {
                i.appendChild(c("pretty-number" + (++r <= s || l ? " empty" : ""), t))
            }),
            n.appendChild(i)
        });
        for (var d = t.length - 1; 0 <= d; d -= 3)
            ;
        e.html("").append(n)
    }),
    e("relativeWidth", function(e, t) {
        var i = parseInt(e.attr("max-value"), 10);
        e.css("width", t / i * 100 + "%")
    }),
    e("userNameTextColor", function(e, t) {
        e.css("color", (e = "#222222",
        i[t] || e))
    }),
    e("checkbox", function(e, t) {
        e.prop("checked", !!t)
    }),
    e("webcam-photo", function(t, i) {
        var n, o = parseInt(t.attr("width"), 10), a = parseInt(t.attr("state"), 10);
        !a || isNaN(a) ? a = 1 : a += 1,
        t.attr("state", a + ""),
        i ? (i = util.fixVkUrl(i),
        (n = new Image).onload = function() {
            var e;
            parseInt(t.attr("state"), 10) === a && (isNaN(o) && (o = n.width),
            e = n.width / n.height,
            e = Math.round(o / e),
            t.css({
                width: o + "px",
                height: e + "px",
                backgroundImage: "url(" + i + ")"
            }))
        }
        ,
        n.src = i) : t.css({
            height: "",
            width: "",
            backgroundImage: ""
        })
    }),
    e("webcam-photo-js", function(r, l) {
        var d, c = parseFloat(r.attr("width"), 10) * mobiUiHelper.vw2px(88), u = parseInt(r.attr("state"), 10);
        !u || isNaN(u) ? u = 1 : u += 1,
        r.attr("state", u + ""),
        l ? (l = util.fixVkUrl(l),
        (d = new Image).onload = function() {
            if (parseInt(r.attr("state"), 10) === u) {
                isNaN(c) && (c = d.width);
                for (var e = d.width / d.height, t = Math.round(c / e), i = appWidth, n = .7 * util.mobiHeight(), o = i - c, a = n - t, s = c / t; o < 0 || a < 0; )
                    o < 0 ? t = (c = i) / s : a < 0 && (c = (t = n) * s),
                    o = i - c,
                    a = n - t;
                r.css({
                    width: c + "px",
                    height: t + "px",
                    backgroundImage: "url(" + l + ")"
                })
            }
        }
        ,
        d.src = l) : r.css({
            height: "",
            width: "",
            backgroundImage: ""
        })
    }),
    e("relativeWidth", function(e, t) {
        var i = parseInt(e.attr("max-value"), 10);
        e.css("width", t / i * 100 + "%")
    }),
    t("userNameTextColorPicker", function(i, n, e, t, o) {
        $.each(a, function(t, e) {
            e && $("<div/>").css("background", e).addClass("item-color-picker").click(function(e) {
                i.trigger("pick-color", {
                    colorId: t,
                    $el: $(this)
                })
            }).appendTo(n)
        })
    }),
    t("avatars-list", function(i, n, e, t, o) {
        $.each(s, function(t, e) {
            $("<div/>").css("backgroundImage", "url(" + e + ")").addClass("item-avatar-bg avatar" + t).click(function(e) {
                i.trigger("pick-avatar", {
                    id: t,
                    $el: $(this)
                })
            }).appendTo(n)
        })
    }),
    e("bImg", function(e, t) {
        t = (t = util.fixVkUrl(t)) || CDN_PREFIX + "camera.jpg",
        e.css({
            backgroundImage: "url(" + t + ")",
            backgroundRepeat: "no-repeat",
            backgroundPosition: "0 0",
            backgroundSize: "100% 100%"
        })
    }),
    e("bImg_ssl", function(e, t) {
        t = (t = (t = util.fixVkUrl(t)) || CDN_PREFIX + "camera.jpg").replace("http://", "https://"),
        e.css({
            backgroundImage: "url(" + t + ")",
            backgroundRepeat: "no-repeat",
            backgroundPosition: "0 0",
            backgroundSize: "100% 100%"
        })
    }),
    e("relativeBImg", o);
    var d = {
        0: "Всем",
        1: "Ж",
        2: "М"
    };
    function u(e, t, i, n, o) {
        for (var a = t - n, s = i - o, r = n / o; a < 0 || s < 0; )
            a < 0 ? o = (n = t) / r : s < 0 && (n = (o = i) * r),
            a = t - n,
            s = i - o;
        e.css({
            left: (t - n) / 2 + "px",
            top: (i - o) / 2 + "px",
            width: n,
            height: o
        })
    }
    e("sexText", function(e, t) {
        e.text(d[t])
    }),
    e("fitBImg2", function(t, i) {
        i = util.fixVkUrl(i);
        var n, o = parseInt(t.attr("rect-width"), 10), a = parseInt(t.attr("rect-height"), 10);
        t.css({
            width: o,
            height: a,
            position: "relative"
        }).empty(),
        i && ((n = new Image).onload = function() {
            var e = util.fit(n.width, n.height, o, a);
            t.empty().append($("<div/>").css({
                width: e.w + "px",
                height: e.h + "px",
                left: e.x + "px",
                top: e.y + "px",
                position: "absolute",
                backgroundImage: "url(" + i + ")",
                backgroundRepeat: "no-repeat",
                backgroundPosition: "0 0",
                backgroundSize: "100% 100%"
            }))
        }
        ,
        n.src = i)
    }),
    e("fitBImg", function(n, o) {
        var a, s = parseInt(n.attr("rect_width"), 10), r = parseInt(n.attr("rect_height"), 10);
        n.css({
            width: s,
            height: r,
            position: "relative"
        }),
        o && ((a = new Image).onload = function() {
            var e = a.width
              , t = a.height
              , i = $("<div/>");
            i.css({
                position: "absolute",
                backgroundImage: "url(" + o + ")",
                backgroundRepeat: "no-repeat",
                backgroundPosition: "0 0",
                backgroundSize: "100% 100%"
            }),
            u(i, s, r, e, t),
            n.empty().append(i)
        }
        ,
        a.src = o)
    }),
    e("fitBImg-mobi", function(n, o) {
        var a, s = parseInt(n.attr("rect_width"), 10), r = parseInt(n.attr("rect_height"), 10), e = appWidth / 500, s = Math.min(e * s, s), r = Math.min(e * r, r);
        n.css({
            width: s,
            height: r,
            position: "relative"
        }),
        o && ((a = new Image).onload = function() {
            var e = a.width
              , t = a.height
              , i = $("<div/>");
            i.css({
                position: "absolute",
                backgroundImage: "url(" + o + ")",
                backgroundRepeat: "no-repeat",
                backgroundPosition: "0 0",
                backgroundSize: "100% 100%"
            }),
            u(i, s, r, e, t),
            n.empty().append(i)
        }
        ,
        a.src = o)
    }),
    e("secondsTime", function(e, t) {
        var i, n = $.isNumeric(t) ? (i = (n = Math.floor(t / 60)) + "",
        n = parseInt(t - 60 * n, 10) + "",
        (1 === i.length ? "0" + i : i) + ":" + (1 === n.length ? "0" + n : n)) : "";
        e.text(n)
    }),
    e("audioTimer", function(e, t) {
        t = t || 0;
        var i = Math.floor(t / 1e3)
          , n = Math.floor(i / 60)
          , t = n + ""
          , n = parseInt(i - 60 * n, 10) + "";
        e[0].innerHTML = (1 === t.length ? "0" + t : t) + ":" + (1 === n.length ? "0" + n : n)
    });
    function p(e, t, i) {
        return e + ":" + t + ":" + i
    }
    e("timer", function(e, t) {
        e[0].innerHTML = util.formatMillisToTime(t, p)
    }),
    e("mobi-chat-close-btn-handler", function(e, t) {
        e.css({
            opacity: t ? 1 : 0,
            "pointer-events": t ? "" : "none"
        })
    }),
    e("present", function(e, t) {
        t || e.remove()
    }),
    e("present-v2", function(e, t) {
        e.attr("inverse") && (t = !t),
        e.__parent || (e.__parent = e.parent()),
        t ? e.__parent && e.__parent.append(e) : e.detach()
    }),
    e("timer-without-sec", function(e, t) {
        var i = util.millisToDateComponents(t)
          , t = util.pluralize;
        0 === i.seconds && i.minutes,
        i = i.days ? "{0} {1} {2} {3} {4} {5}".format(i.days, t(i.days, "день", "дня", "дней"), i.hours, "час.", i.minutes, "мин.", i.seconds, "сек.") : i.hours ? "{0} {1} {2} {3}".format(i.hours, "час.", i.minutes, "мин.", i.seconds, "сек.") : i.minutes < 1 ? "{0} {1}".format(i.seconds, "сек.") : "{0} {1} {2} {3}".format(i.minutes, "мин.", i.seconds, "сек."),
        e[0].innerHTML = i
    }),
    e("stock-timer", function(e, t) {
        var i = util.millisToDateComponents(t)
          , t = util.pluralize;
        0 === i.seconds && i.minutes,
        i = i.days ? "{0} {1} {2} {3} {4} {5} {6} {7}".format(i.days, t(i.days, "день", "дня", "дней"), i.hours, "час.", i.minutes, "мин.", i.seconds, "сек.") : i.hours ? "{0} {1} {2} {3} {4} {5}".format(i.hours, "час.", i.minutes, "мин.", i.seconds, "сек.") : i.minutes < 1 ? "{0} {1}".format(i.seconds, "сек.") : "{0} {1} {2} {3}".format(i.minutes, "мин.", i.seconds, "сек."),
        e[0].innerHTML = i
    }),
    e("secondsTimeV2", function(e, t) {
        var i = $.isNumeric(t) ? 1 === (i = t + "").length ? "0" + i : i : "";
        e.text(i)
    }),
    e("vkHref", function(e, t) {
        e.attr("href", "https://vk.com/id" + t)
    }),
    e("social-profile-link", function(e, t) {
        t = parseInt(t, 10),
        util.isOKAppUid(t) ? (t = util.convertAppOkUIdToNativeOkUid(t),
        e.attr("href", "https://ok.ru/profile/" + t)) : e.attr("href", "https://vk.com/id" + t)
    }),
    e("html", function(e, t) {
        e.html(t)
    }),
    e("visible-and-html", function(e, t) {
        t ? e.html(t).show() : e.html("").hide()
    }),
    e("val", function(e, t) {
        e.val(t)
    }),
    $.fn.textWidth = function(e, t) {
        $.fn.textWidth.fakeEl && $.fn.textWidth.fakeEl.remove();
        var i = $.fn.textWidth.fakeEl = this.clone();
        return i.css({
            position: "absolute",
            left: "-100000px",
            top: "-100000px"
        }),
        i.appendTo(document.body),
        i.width()
    }
    ;
    var f = document.createElement("div");
    f.className = "div-measure-text",
    $(function() {
        try {
            document.body.appendChild(f)
        } catch (e) {}
    }),
    e("val-auto-width", function(e, t) {
        f.innerHTML = t = (t || "") + "",
        e.val(t).width(f.clientWidth)
    }),
    e("pluralize", function(e, t) {
        e.text(e.attr(util.pluralize(t)))
    }),
    e("pluralize-by-platform", function(e, t) {
        var i = util.isOKPlatform() ? "_ok" : "_vk"
          , i = {
            one: e.attr("one" + i),
            two: e.attr("two" + i),
            many: e.attr("many" + i)
        };
        e.text(util.pluralize(t, i))
    });
    var m, v, h, g, b = {
        1: "female",
        2: "male"
    };
    function C(e, t) {
        var i = e.attr("true")
          , n = e.attr("false")
          , t = e.attr("evaluate").format(t);
        util.safeEval(t) ? (util.isDef(n) && e.removeClass(n),
        util.isDef(i) && e.addClass(i)) : (util.isDef(i) && e.removeClass(i),
        util.isDef(n) && e.addClass(n))
    }
    function _(e) {
        var t = 1;
        return t = !isNaN(e) && 0 <= e ? expController.calcMinLevelAndProgress(e).level : t
    }
    e("bySex", function(e, t) {
        e.text(e.attr(b[t] || b[1]))
    }),
    e("userRoundState", function(e, t) {
        var i = t.sex === Constants.SEX.MALE
          , n = app.models.UserRoundState.STATE
          , o = "Готов";
        t.state === n.ANSWERED && (o = "Ответил"),
        e.text(o += i ? "" : "a")
    }),
    e("profile-bg", function(e, t) {
        t = util.fixVkUrl(t),
        e.css("backgroundImage", t ? 'url("' + t + '")' : "")
    }),
    e("vkPhotohref", function(e, t) {
        e.attr("href", "https://vk.com/photo" + t._id)
    }),
    t("message-dialog-buttons", function(n, o, e, t, i) {
        $.each(i, function(e, t) {
            var i;
            t.anchor ? ((i = document.createElement("a")).target = t.target || "_blank",
            i.className = t.className || "btn gray no-text-decoration",
            i.href = t.href,
            i.innerHTML = t.caption || "",
            o.append(i)) : $("<div/>").html(t.caption).addClass(t.className || "btn gray").click(function(e) {
                !1 === t.handler(e) && n.trigger("close")
            }).appendTo(o)
        })
    }),
    e("simple-date", function(e, t) {
        e.text(util.formatDate(t + app.info.timeDiff))
    }),
    e("date", function(e, t) {
        util.isDef(t) && e.text(util.formatDate(t))
    }),
    e("date-with-time", function(e, t) {
        (t += app.info.timeDiff) > util.currentMillis() && (t = util.currentMillis() - 2e4);
        var i = moment(t)
          , i = 432e5 < Math.abs(util.currentMillis() - t) ? i.format("D MMM, HH:mm") : i.calendar();
        e.text(i.toLowerCase()).css("text-transform")
    }),
    e("question-pretty-time", function(a, e) {
        util.formatDate(e + app.info.timeDiff, function(e, t, i, n, o) {
            a.text(e + "/" + t + "/" + i + " - " + n + ":" + o)
        })
    }),
    e("ad-status", function(e, t) {
        t === app.models.AD_STATUS.STARTED ? e.text("Продвижение запущено").css({
            color: "#71C971"
        }) : e.text("Продвижение остановлено").css({
            color: ""
        })
    }),
    e("answer-bubble", function(e, t) {
        var i, t = 1 === t ? (i = "Да",
        "yes") : 2 === t ? (i = "Нет",
        "no") : (i = "Возможно",
        "perhaps");
        e.text(i).addClass(t)
    }),
    m = {},
    v = {},
    h = app.models.VIRAL_ANSWER_TYPE,
    v[h.YES] = {
        text: "Да",
        type: h.YES
    },
    v[h.NO] = {
        text: "Нет",
        type: h.NO
    },
    v[h.PERHAPS] = {
        text: "Возможно",
        type: h.PERHAPS
    },
    m[h.YES] = "yes",
    m[h.NO] = "no",
    m[h.PERHAPS] = "perhaps",
    app.eventBus.once(app.EVENTS.GET_BOOT_DATA, function(e) {
        e = e.bootData.viralAnswers;
        $.each(e, function(e, t) {
            v[t._id] = t
        })
    }),
    e("answer-bubble-v2", function(e, t) {
        var i = v[t];
        i && (t = i.text,
        i = m[i.type],
        t = util.parseQuestionText(t, {
            friendIsMale: !1,
            userIsMale: app.info.sex === Constants.SEX.MALE
        }),
        e.text(t).addClass(i))
    }),
    e("answer-bubble-class", function(e, t) {
        var t = v[t];
        t && (t = m[t.type],
        e.addClass(t))
    }),
    e("answer-bubble-text", function(e, t) {
        var t = v[t];
        t && (t = t.text,
        t = util.parseQuestionText(t, {
            friendIsMale: !1,
            userIsMale: app.info.sex === Constants.SEX.MALE
        }),
        e.text(t))
    }),
    e("ad-target-title", function(e, t) {
        t ? 2 === t ? e.text("Муж.") : e.text("Дев.") : e.text("Всем")
    }),
    e("simpleDate", function(e, t) {
        t += app.info.timeDiff;
        var i = moment(t)
          , i = 432e5 < Math.abs(util.currentMillis() - t) ? i.format("D MMM, HH:mm") : i.calendar();
        e.text(i.toLowerCase()).css("text-transform")
    }),
    e("condition-html", function(e, t) {
        e.html(t ? e.attr("true") || "" : e.attr("false") || "")
    }),
    e("equals", C),
    e("addClassIfEquals", C),
    e("ad-guest-time", function(e, t) {
        t += app.info.timeDiff;
        t = moment(t).format("HH:mm");
        e.text(t.toLowerCase())
    }),
    e("setVisibleInlineBlock", function(e, t) {
        (t = e.attr("inverse") ? !t : t) ? "none" === e.css("display") && e.css("display", "inline-block") : e.hide()
    }),
    e("setVisibleFlex", function(e, t) {
        (t = e.attr("inverse") ? !t : t) ? "none" === e.css("display") && e.css("display", "flex") : e.hide()
    }),
    e("exp2d", function(e, t) {
        var i, t = t < 1500 ? (i = "Низкий",
        "#FF2A2A") : t < 3e3 ? (i = "Средний",
        "#FFAA00") : t < 15e3 ? (i = "Высокий",
        "#24BC06") : (i = "Огромный",
        "#AA55FF");
        e.text(i).css("color", t)
    }),
    g = {},
    app.eventBus.once(app.EVENTS.GET_BOOT_DATA, function(e) {
        $.each(e.bootData.allGifts, function(e, t) {
            g[t._id] = t
        })
    }),
    e("giftBg", function(e, t) {
        t = g[t];
        t && o(e, t.img)
    }),
    e("safeText", function(e, t) {
        e.text(t || "")
    }),
    e("safeHtml", function(e, t) {
        e.html(t || "")
    }),
    e("textWithBracket", function(e, t) {
        e.html("(" + t + ")")
    }),
    e("room-answers-container-id", function(e, t) {
        e.attr("id", "room-answer-container" + t)
    }),
    e("uid-id", function(e, t) {
        var i = e.attr("uid-prefix") || n++ + "_undef_";
        e.attr("id", i + t)
    }),
    t("room-user-state", function(e, t, i, n, o) {
        function a() {
            var e;
            t[(e = i.viewState === app.models.UserRoundState.STATE.ANSWERED) ? "addClass" : "removeClass"]("answered"),
            e && app.playUserReadySound()
        }
        function s() {
            t[i.selected ? "addClass" : "removeClass"]("selected")
        }
        a(),
        s(),
        i.onChange("viewState", a),
        i.onChange("selected", s),
        e.onRemove(function() {
            i.offChange("viewState", a),
            i.offChange("selected", s)
        })
    }),
    e("rounded-rating", function(e, t) {
        $.isNumeric(t) && e.text(Math.floor(t / 10))
    }),
    e("formatted", function(e, t) {
        var i = e.attr("template") + "";
        e.text(i.format(t))
    }),
    e("formattedHtml", function(e, t) {
        var i = e.attr("template") + "";
        e.html(i.format(t))
    }),
    e("profileFullName", function(i, n) {
        function e() {
            var e = n.fullName
              , t = n.uid
              , e = $(document.createElement("a")).attr({
                target: "_blank",
                href: "//www.vk.com/id" + t
            }).text(e);
            i.empty().append(e)
        }
        e(),
        n.onChange("fullName", e)
    }),
    e("html-linkify", function(e, t) {
        t = t || "",
        t = util.sanitizeHtml(t),
        l.innerHTML = t,
        t = util.findAndCreateAppLinksInText(util.escapeHtml(l.innerText)),
        e.html(t),
        e.linkify && e.linkify()
    }),
    e("abs", function(e, t) {
        t < 0 && (t *= -1),
        e.html(t)
    }),
    t("html-linkify-of-model", function(e, t, i, n, o) {
        var a = t.attr("text-property") || "text"
          , s = t.attr("uid-property") || "uid"
          , a = i[a]
          , s = i[s]
          , a = util.sanitizeHtml(a || "");
        l.innerHTML = a,
        a = util.findAndCreateAppLinksInText(util.escapeHtml(l.innerText, s)),
        t.html(a)
    }),
    e("escape-html", function(e, t) {
        t = t || "",
        e.html(util.escapeHtml(t, null, !0))
    }),
    t("escape-html-of-model", function(e, i, n, t, o) {
        function a() {
            var e = n[s]
              , t = n[r]
              , e = util.sanitizeHtml(e || "");
            l.innerHTML = e,
            e = util.findAndCreateAppLinksInText(util.escapeHtml(l.innerText, t)),
            i.html(e)
        }
        var s = i.attr("text-property") || "text"
          , r = i.attr("uid-property") || "uid";
        i.is("[observe-text]") && n.onChange(s, a),
        a()
    }),
    e("text-with-emoji", function(e, t) {
        t && (t = app.controllers.Emoji.replaceAllUTF8Symbols(t),
        e.html(t))
    }),
    t("text-with-emoji-of-model", function(e, t, i, n, o) {
        var a = t.attr("text-property") || "text"
          , s = t.attr("uid-property") || "uid"
          , a = i[a]
          , s = i[s]
          , s = app.controllers.Emoji.replaceAllUTF8Symbols(a, {
            ownerUid: s
        });
        t.html(s)
    }),
    t("text-with-emoji-of-model-v2", function(e, t, i, n, o) {
        var a = t.attr("text-property") || "text"
          , s = t.attr("uid-property") || "uid"
          , r = i[a]
          , s = i[s]
          , s = app.controllers.Emoji.replaceAllUTF8Symbols(r, {
            ownerUid: s
        });
        t.html(s);
        for (var l = t[0].firstChild, d = 0, c = 0; l && !(100 < c++); ) {
            if (3 === l.nodeType) {
                if (r = $.trim(l.data))
                    return
            } else {
                if ("SPAN" !== l.tagName || "emoji" !== l.className) {
                    d = 0;
                    break
                }
                d += 1
            }
            l = l.nextSibling
        }
        2 === d && t.addClass("large_x2")
    }),
    e("visibility", function(e, t) {
        e.attr("inverse") && (t = !t),
        e.css("visibility", t ? "visible" : "hidden")
    }),
    e("ruble-price", function(e, t) {
        1 === app.info.countryId ? e.text((t *= 7) + " " + util.pluralize(t, {
            one: "рубль",
            two: "рубля",
            many: "рублей"
        })) : e.text(t + " " + util.pluralize(t, {
            one: "голос",
            two: "голоса",
            many: "голосов"
        }))
    }),
    e("exp-level", function(e, t) {
        var i = _(t)
          , t = E(i);
        e.css({
            color: t.text,
            border: "2px solid " + t.border
        }).attr("level", i).text(i)
    });
    window.LEVEL_GOLD = 240,
    window.LEVEL_PURPLE = 500;
    let w = "#670003";
    function E(e) {
        return e < 7 ? {
            text: "rgb(30, 30, 30)",
            border: "#aaa",
            chatBg: "#666"
        } : e < 15 ? {
            text: "rgb(5, 104, 57)",
            border: "rgb(11, 161, 75)",
            chatBg: "#468c2f"
        } : e < 20 ? {
            text: "rgb(15, 117, 188)",
            border: "rgb(37, 170, 225)",
            chatBg: "#1C7CA5"
        } : e < 31 ? {
            text: "rgb(236, 0, 140)",
            border: "rgb(237, 32, 146)",
            chatBg: "#BB1973"
        } : 44 < e && e < 60 ? {
            text: "rgb(170, 42, 255)",
            border: "rgb(170, 42, 255)",
            chatBg: "rgb(170, 42, 255)"
        } : 59 < e && e < 100 ? {
            text: "#D89600",
            border: "#D89600",
            chatBg: "#D89600"
        } : 99 < e && e < 150 ? {
            text: "#C69B2D",
            border: "#C69B2D",
            chatBg: "#C69B2D"
        } : 149 < e ? {
            text: "#AF7B2B",
            border: "#AF7B2B",
            chatBg: "#AF7B2B"
        } : {
            text: "rgb(239, 12, 12)",
            border: "rgb(237, 32, 32)",
            chatBg: "#C12020"
        }
    }
    window.colorPurple = w,
    e("exp-level-v2", function(e, t) {
        var i = _(t)
          , t = E(i);
        500 <= i ? e.addClass("purple-level").addClass("gold-level-gradient").css({
            "background-color": "",
            color: "#fff",
            border: ""
        }).html(`<div class='gold-level-inner'>${i}</div>`) : 240 <= i ? e.addClass("gold-level-gradient").removeClass("purple-level").css({
            "background-color": "",
            color: "#fff",
            border: ""
        }).html(`<div class='gold-level-inner' style="background-color: ">${i}</div>`) : e.removeClass("gold-level-gradient").removeClass("purple-level").css({
            "background-color": t.border,
            border: "2px solid " + t.border
        }).html(i),
        e.attr("level", i)
    }),
    e("exp-level-v3", function(e, t) {
        var i = _(t)
          , t = E(i);
        500 <= i ? e.addClass("purple-level").addClass("gold-level-gradient").css({
            "background-color": "",
            color: "#fff",
            border: ""
        }).html(`<div class='gold-level-inner'>${i}</div>`) : 240 <= i ? e.addClass("gold-level-gradient").removeClass("purple-level").css({
            "background-color": "",
            border: "none",
            color: "#fff"
        }).html(`<div class='gold-level-inner'">${i}</div>`) : e.removeClass("gold-level-gradient").removeClass("purple-level").css({
            "background-color": t.border,
            border: "2px solid " + t.border,
            color: "#fff"
        }).html(i),
        e.attr("level", i)
    }),
    e("by-level", function(e, t) {
        var i, n = E(t);
        240 <= t ? (i = 500 <= t ? w : "",
        e.addClass("gold-level-gradient").css({
            "background-color": 500 <= t ? w : "",
            color: "#fff"
        }).html(`<div class='gold-level-inner' style="background-color: ${i}">${t}</div>`)) : e.removeClass("gold-level-gradient").css({
            "background-color": n.border,
            border: "2px solid " + n.border,
            color: "#fff"
        }).html(t)
    }),
    app.getTextAndBorderColorAndByLevel = E,
    e("color-by-level", function(e, t) {
        t = E(_(t));
        e.css({
            color: t.text
        })
    }),
    e("border-by-level-v2", function(e, t) {
        t = E(_(t));
        e.css({
            "border-color": t.text
        })
    }),
    e("chat-bg-color-by-exp-level", function(e, t) {
        t = E(_(t));
        e.css({
            "background-color": t.chatBg
        })
    }),
    e("pretty-radio-buttons", function(e, t) {
        var a, s, r, l, d;
        t = t,
        a = e,
        s = document.createDocumentFragment(),
        l = r = null,
        d = "selected",
        $.each(t, function(e, t) {
            var i = $("<div/>", {
                class: "radio-wrap"
            })
              , n = $("<span/>", {
                text: t.text,
                class: "text"
            })
              , o = $("<input/>", {
                class: "radio-input",
                type: "radio"
            }).css("pointer-events", "none");
            t.selected && ((r = i).addClass(d),
            a.attr("value", t.value),
            o.prop("checked", !0),
            l = o),
            i.append(o).append(n).click(function() {
                i !== r && (r && r.removeClass(d),
                l && (l.prop("checked", !1),
                l = null),
                r = i,
                (l = o).prop("checked", !0),
                i.addClass(d),
                a.attr("value", t.value))
            }),
            s.appendChild(i[0])
        }),
        a.empty().append(s)
    }),
    e("bg-with-loading", function(e, t) {
        t = util.fixVkUrl(t);
        var i = (i = e.attr("modCounter")) ? parseInt(i, 10) : util.nextCounter();
        e.attr("modCounter", ++i),
        e.css("background-image", "").addClass("loading");
        var n = new Image;
        n.onload = function() {
            parseInt(e.attr("modCounter"), 10) === i && e.css("background-image", "url(" + t + ")").removeClass("loading")
        }
        ,
        e.addClass("loading"),
        n.src = t
    }),
    e("flexible-font-size", function(e, t) {
        var i = e.attr("length" + (t += "").length);
        e.html(t).css("font-size", i ? i + "px" : "")
    }),
    e("setVisibleV2", function(e, t) {
        t ? e.show() : e.hide()
    }),
    e("secondsTimer", function(e, t) {
        var i = Math.floor(t / 60)
          , n = i + ""
          , i = parseInt(t - 60 * i, 10) + "";
        e[0].innerHTML = (1 === n.length ? "0" + n : n) + ":" + (1 === i.length ? "0" + i : i)
    }),
    e("radio-text", function(e, t) {}),
    lilo.registerSimpleBindHandler("yt-photo-preview", function(e, t) {
        var i, n, o, a, s, r;
        e.html(""),
        t && (i = t.u,
        n = t.w,
        o = t.h,
        a = parseInt(e.attr("target-width"), 10),
        r = parseInt(e.attr("target-height"), 10),
        t = (s = document.createElement("div")).style,
        r = util.fit(n, o, a, r),
        t.left = r.x + "px",
        t.top = r.y + "px",
        t.width = r.w + "px",
        t.height = r.h + "px",
        t.backgroundImage = "url(" + i + ")",
        t.backgroundSize = "100% 100%",
        t.backgroundPosition = "center",
        t.backgroundRepeat = "no-repeat",
        t.position = "absolute",
        s.className = "yt-track-preview-image",
        e.append(s))
    }),
    lilo.registerSimpleBindHandler("menu-counter", function(e, t) {
        var i;
        t ? (e.show().html(99 < (i = t) ? "99+" : i + ""),
        (e._prev || 0) < t && setTimeout(function() {
            e.addClass("animated"),
            setTimeout(function() {
                e.removeClass("animated")
            }, 600)
        }, 100),
        e._prev = t) : e.hide()
    }),
    lilo.registerSimpleBindHandler("yt-photo-preview-mobi", function(e, t) {
        var i, n, o, a, s, r;
        e.html(""),
        t && (i = t.u,
        n = t.w,
        o = t.h,
        s = parseInt(e.attr("target-width"), 10),
        r = parseInt(e.attr("target-height"), 10),
        t = (a = document.createElement("div")).style,
        s = mobiUiHelper.fixPx(s),
        r = mobiUiHelper.fixPx(r),
        r = util.fit(n, o, s, r),
        t.left = r.x + "px",
        t.top = r.y + "px",
        t.width = r.w + "px",
        t.height = r.h + "px",
        t.backgroundImage = "url(" + i + ")",
        t.backgroundSize = "100% 100%",
        t.backgroundPosition = "center",
        t.backgroundRepeat = "no-repeat",
        t.position = "absolute",
        a.className = "yt-track-preview-image",
        e.append(a))
    }),
    e("visible-by-sex", function(e, t) {
        var i = parseInt(e.attr("target-sex"), 10);
        e.css("display", i === t ? "" : "none")
    }),
    e("visible-if-viewer-male", function(e, t) {
        e.css("display", 2 === app.info.sex ? "" : "none")
    }),
    e("visible-if-viewer-female", function(e, t) {
        e.css("display", 1 === app.info.sex ? "" : "none")
    }),
    e("by-viewer-sex", function(e, t) {
        var i = b[app.info.sex];
        e.text(e.attr(i = i || b[1]))
    })
}();
